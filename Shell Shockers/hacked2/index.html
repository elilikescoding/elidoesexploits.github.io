<!DOCTYPE html>
<html>
  <head>
    <link rel="icon" href="whs.JPG">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width" content="height=device-height">
    <title>Shell Shockers</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <script>var pposx = 0;
var pposy = 0;
var pposz = 0;
var aimtoggle = -1;
var me = null;
var playersObj = {};
var players = [];
var mainPlayerName = "";
var aimCheck = null;
var htmlSet = false;
var isScoped = false;
var aimType = "FOV";
var fovSliderMade = false;
var fov = 0.3;
var updatedHTML = false;
var sliderAim;
var outputAim;
var c;
var ctx;
var espSet = false;
var FOV = 90;
var aimPatch = true; // V4.2 Aimbot Patch (Workaround not really fixed)
var fakeMouse = null; // V4.2 Fake Mouse Movement Packet
var keyBindings = { // V4.3 Key Bindings Obj
  toggleModMenu : 'KeyP',
  toggleAimbot : 'KeyO',
  toggleEsp : 'KeyI'
}
var inGame = false; // V4.3 In Game Variable

function interceptKeyDown(e){ // V4.3 Intercept Key Down For Hack Menu
  var code = e.code;
  if (code == "ArrowUp"){

  }else if (code == "ArrowDown"){

  }else if (code == "ArrowLeft"){

  }else if (code == "ArrowRight"){

  }else {
    // Check Key Bindings
  }
}

function setupEsp(){
  if(document.getElementById("minimap") != undefined) {
    c = document.getElementById("minimap");
    ctx = c.getContext("2d");
    ctx.clearRect(0, 0, 1280, 720);
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  } else {
    var newdiv = document.createElement('canvas');
    newdiv.id = "minimap";
    newdiv.style.pointerEvents = "none";
    newdiv.style.width = "100%";
    newdiv.width = 1000;
    newdiv.height = 500;
    newdiv.style.height = "100%";
    newdiv.style.position = "fixed";
    newdiv.style.top = "1px";
    document.body.appendChild(newdiv);
    c = document.getElementById("minimap");
    ctx = c.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  espSet = true;
}

function espCalc(){
  ctx.clearRect(0, 0, 9999, 9999);
  //ctx.clearRect(0, 0, canvas.width, canvas.height);
  var box_size_x=2;
  var box_size_y=2.5;
  function calcDistance(mx, my, mz, ex, ey, ez) {
   return Math.sqrt((mx - ex) ** 2 + (my - ey) ** 2 + (mz - ez) ** 2)
  };
  for(var ply = 0; ply < players.length; ply++) {
    var plys = players[ply];
     if(plys != undefined) {
          if(plys.id != me.id) {
               var distance = calcDistance(me.x, me.y, me.z, plys.x, plys.y, plys.z);
                 if(me.id != plys.id && plys["playing"] && plys["hp"] > 0) {
                    var aim_pitch;
                    var aim_yaw;
                    var mx = me.x;
                    var my = me.y;
                    var mz = me.z;
                    var ex = plys.x;
                    var ey = plys.y;
                    var ez = plys.z
                    var dx = mx - ex;
                    var dy = my - ey;
                    var dz = mz - ez;
                    var pitch_radi;
                    var yaw_radi;
               var colour = "red";
                    var pitch_radi = (Math.atan2(dy, Math.sqrt(dx * dx + dz * dz)));
                    var yaw_radi = -1 * (Math.atan2(dz, dx) - 1.57);
               if(dy >= 0) {
                   yaw_radi += Math.PI;
               } else {
                         yaw_radi -= Math.PI;
               }
                    var ANG = yaw_radi - me.yaw
                    var A = ex - mx;
                    var B = ez - mz;
                    var XZ = Math.sqrt(A ** 2 + B ** 2);
                    var DZ = Math.sin(ANG) * XZ;
                    var DX = Math.cos(ANG) * XZ
                    var DF = Math.tan(FOV / 2) * DX;
                    var W = c.width / 2;
                    var H = c.height / 2;
                    var WX = W + ((DZ / DF) * W)
               var ANGY = pitch_radi - me.pitch;
               var AY = ey - my;
               var XY = Math.sqrt(A ** 2 + AY ** 2);
               var DY = Math.sin(ANGY) * XY;
               var DFY = Math.cos(FOV / 2) * DY;
               var WY = ((c.height / 2) + (-1) * ((me.pitch - pitch_radi)) * (500)) - distance * 0.6;
                   function drawBorder(xPos, yPos, width, height, clr) {
                     xPos -= width/2;
                     yPos -= height/2;
                     thickness = 1;
                     ctx.fillStyle = clr;
                     ctx.fillRect(xPos - (thickness), yPos - (thickness), width + (thickness * 2), height + (thickness * 2));
                     ctx.fillStyle = clr;
                     ctx.clearRect(xPos + thickness, yPos + thickness, width - thickness, height - thickness);
               }
                    function drawLine(x, y, clr) {
                         if(x >= 0 && x <= c.width && y >= 0 && y <= c.height) {
                             ctx.fillStyle = clr;
                             ctx.beginPath();
                             ctx.moveTo(c.width / 2, c.height / 2);
                             ctx.lineTo(x, y);
                             ctx.strokeStyle = clr;
                             ctx.stroke();
                   }
               }
               function drawText(text, x, y, clr) {
                   ctx.font = "10px Georgia";
                   ctx.fillStyle = clr;
                   ctx.fillText(plys.name, x, y);
               }
               if (me.team == 0) {
                   colour = "#ff5005"
               };
               if (plys["team"] == 1) {
                   colour = "#5092fc"
               };
               if (plys["team"] == 2) {
                   colour = "#ff5005"
               };
               var angd = yaw_radi - (me.yaw)
               var degrees_me_y = me.yaw * (180 / Math.PI);
                var degrees_them_y = yaw_radi * (180 / Math.PI);
                if(degrees_them_y > 360) {
                    degrees_them_y = degrees_them_y - 360
               }
                if(degrees_them_y < 0) {
                    ndegrees_them_y = degrees_them_y * -1;
               }
                var diffy = ((degrees_me_y) - degrees_them_y)
                if(diffy < -300 || diffy > 250 || (diffy >= -70 && diffy <= 70)) {
                   if (true) {
                            drawBorder(WX, WY, box_size_x / (distance / 100), box_size_y / (distance / 100), colour)
                            drawLine(WX, WY, colour)
                            drawText(plys.name, WX, WY, colour)
                   }
               }
           }
       }
   }
  }
}

function setAimbotDist() {
    dis = document.getElementById("aimdist").value;
    console.log("set aimbot to", dis);
}

function nRespawn(Y, Er, Zt, Nn, Vn, V, Oe, getStoredNumber, Dt, Kr, Hr, Cn, Ae, K, xe, x, xr) {
  refreshPlayers();
  if (Y) return Er.playing = !0, void canvas.requestPointerLock();
  if (!Er.playing){
    console.log("Respawn pressed - respawnTime: " + Zt), Zt < 0 && (Nn.clearAll(), Vn.clearAll(), V.autoDetail && Cn(), function() {
        if (Oe) return Kr();
        if (!0 === K.hideAds) return !1;
        var e = getStoredNumber("lastPreRoll", Date.now());
        let t = 42e4;
        Ae && (t = 12e4);
        xe && (t = 3e4);
        x > 1 && xr > 1 && Date.now() > e + t ? Dt(Hr) : Kr()
    }())
  }else {
    vueApp.hideGameMenu();
    canvas.requestPointerLock();
  }
}

function aimBtnClick(){
  if (aimtoggle == 1){
    aimtoggle = -1;
    document.getElementById('aimBtn').style.backgroundColor = "red";
  }else {
    aimtoggle = 1;
    document.getElementById('aimBtn').style.backgroundColor = "green";
  }
}

function aimTypeClick(){
  if (aimType == "FOV"){
    document.getElementById('sliderCont').style.display = "none";
    document.getElementById('aimTypeBtn').innerText = "Aim Type: DIST";
    aimType = "DIST";
  }else if (aimType == "DIST"){
    document.getElementById('sliderCont').style.display = "block";
    document.getElementById('aimTypeBtn').innerText = "Aim Type: FOV";
    aimType = "FOV";
  }else {
    console.error("unknown aimType");
  }
}

function fovSliderHandle(){
  outputAim.innerHTML=this.value/2/10;
  fov = this.value/2/10;
}

function updateHtml(){
  if (aimType == "FOV"){
    document.getElementById('sliderCont').style.display = "block";
    document.getElementById('aimTypeBtn').innerText = "Aim Type: FOV";
  }else if (aimType == "DIST"){
    document.getElementById('sliderCont').style.display = "none";
    document.getElementById('aimTypeBtn').innerText = "Aim Type: DIST";
  }else {
    console.error("unknown aimType");
  }
  sliderAim = document.getElementById("aimFovSlider");
  outputAim = document.getElementById("aimSlideVal");
  outputAim.innerHTML = sliderAim.value/2/10;
  sliderAim.oninput = fovSliderHandle;
  fovSliderMade = true;
  updatedHTML = true;
}

function htmlMenuSetup(){
  htmlSet = true;
  var aimBtnHtml = `<div class="btn-container"><button id='aimBtn' onclick='aimBtnClick()' class="btn_red bevel_red" style="color: white;text-align: center;display: block;font-weight: bold;"><i class=""></i>AIMBOT</button></div>`;
  var sliderStyle = `<style>.slidecontainer{width:100%}.slider{-webkit-appearance:none;width:100%;height:25px;background:#d3d3d3;outline:0;opacity:.7;-webkit-transition:.2s;transition:opacity .2s}.slider:hover{opacity:1}.slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:25px;height:25px;background:#4caf50;cursor:pointer}.slider::-moz-range-thumb{width:25px;height:25px;background:#4caf50;cursor:pointer}</style>`
  var sliderHtml = `<div class="slidecontainer" id="sliderCont"> <input type="range" min="1" max="80" value="6" class="slider" id="aimFovSlider"> <p>Aim Dif: <span id="aimSlideVal"></span> (Recommended is 0.3 or <0.3)</p></div>`
  var toggleHtml = `<div class="btn-container"><button id='aimTypeBtn' onclick='aimTypeClick()' class="btn_red bevel_red" style="background-color: #2261ce;color: white;text-align: center;display: block;font-weight: bold;"><i class=""></i>Aim Type: FOV</button></div>`;
  // if (document.getElementsByClassName('pauseButtons')){
  //   var elm_ = {};
  //   for (i in document.getElementsByClassName('pauseButtons')){
  //     if (document.getElementsByClassName('pauseButtons')[i].innerHTML){
  //       if (document.getElementsByClassName('pauseButtons')[i].innerHTML.search("btn-container switch-teams-btn") != -1){
  //         elm_ = document.getElementsByClassName('pauseButtons')[i];
  //       }else {console.error('1')}
  //     }else {console.error('2')}
  //   }
  //   if (elm_ != {}){
  //     elm_.innerHTML += aimBtnHtml;
  //     elm_.innerHTML += sliderStyle;
  //     elm_.innerHTML += sliderHtml;
  //     elm_.innerHTML += toggleHtml;
  //   }else {
  //     console.error("Elm Not Defined?");
  //   }
  //
  //
  // }else {
  //   console.error('No pauseButtons');
  // }
  // if (document.getElementById('game-play-switch')){
  //   var html = document.getElementById('game-play-switch').innerHTML;
  //   html = '<div class="pauseButtons">' + aimBtnHtml + sliderStyle + sliderHtml + toggleHtml + '</div>' + html;
  //   document.getElementById('game-play-switch').innerHTML = html;
  // }
  if (document.getElementsByClassName('pauseButtons')[1]){
    var html = document.getElementsByClassName('pauseButtons')[1].innerHTML;
    html = aimBtnHtml + sliderStyle + sliderHtml + toggleHtml
    document.getElementsByClassName('pauseButtons')[1].innerHTML = html;
  }
}

function wallHack(p){
  if (p.actor){
    if (p.actor.bodyMesh){
      p.actor.bodyMesh.renderingGroupId = 1;
    }
    if (p.actor.hand){
      p.actor.hand.renderingGroupId = 1;
    }
    if (p.actor.hat){
      p.actor.hat.renderingGroupId = 1;
    }
  }
}

function updatePlayer(p){
  if (!document.getElementById('aimBtn')){
    htmlMenuSetup();
  }
  if (document.getElementById('aimFovSlider') && !updatedHTML){
    updateHtml();
  }
  //console.log(p.name);
  wallHack(p);
  if (me != null){
    if (!playersObj[p.uniqueId]){
      players.push(p)
    }
    playersObj[p.uniqueId] = p;
  }
}

function tryHtmlUpdate(){
  console.log('Here1');
  if (!document.getElementById('aimBtn')){
    htmlMenuSetup();
    console.log('Here2');
  }
  if (document.getElementById('aimFovSlider') && !updatedHTML){
    updateHtml();
  }
}

function mapDone(){
  console.log('Map Done');
}

function addPlayer(player, isMe){
  if (isMe) {
    me = player;
    startAimCheck();
  };
  if (!playersObj[player.uniqueId]){
    players.push(player)
    console.log('Added : ' + player.name + "(" + player.uniqueId + ")");
  }
  playersObj[player.uniqueId] = player;
}

function removePlayer(player){
  if (playersObj[player.uniqueId]){
    for (let i in players){
      if (players[i].uniqueId == player.uniqueId){
        players.splice(i, 1);
      }
    }
    delete playersObj[player.uniqueId];
    console.log('Removed : ' + + player.name + "(" + player.uniqueId + ")");
  }
}

function refreshPlayers(){
  console.log('REFRESHED PLAYERS!');
  players = [];
  playersObj = {};
}

function distAimbot(){
  let shortest = 100000;
  let cords = null;
  var playerIdxs = [];
  if (players != null){
  for (var i = 0; i < players.length; i++) {
          if (players[i]) {
              if (players[i].playing && players[i].name != mainPlayerName){
                playerIdxs.push(i);
              }
          }
  }
   for (i = 0; i < playerIdxs.length; i++) {
          var player = players[playerIdxs[i]];
    if (me){
      var dify = Math.sqrt((me.y - player.y)**2);
      dist = Math.sqrt(  (parseFloat(me.x)-parseFloat(player.x))**2 +  (parseFloat(me.y)-parseFloat(player.y))**2 + (parseFloat(me.z)-parseFloat(player.z))**2  )
      if (dist < shortest && isScoped && aimtoggle === 1 && dist != 0 && parseInt(player["hp"]) > 0 && dify < 2 && dist <= 7 && !player["name"].includes("-TDS-")){
      shortest = dist;
      cords = player;
      }



    }
   }
  }
  if (shortest != 100000 && cords != null){
    var PP = [me.x, me.y, me.z];

    var nx = cords.x + (cords.x - pposx)*shortest;
    var ny = cords.y + (cords.y - pposy)*shortest;
    var nz = cords.z + (cords.z - pposz)*shortest;


    var EP = [nx, ny, nz]

    var dx = PP[0]-EP[0];
    var dy = PP[1]-EP[1];
    var dz = PP[2]-EP[2];
    var pitch_radi = (Math.atan2(dy, Math.sqrt(dx*dx+dz*dz)));
    var yaw_radi = -1*(Math.atan2(dz,dx)-1.57);
    if(dy >= 0){
    yaw_radi += Math.PI;
    }else{
    yaw_radi -= Math.PI;
    }
    me.pitch = pitch_radi;
    me.yaw = yaw_radi;
    if (aimPatch){
      if (fakeMouse){
        fakeMouse({movementX: 0, movementY:1});
        fakeMouse({movementX: 0, movementY:-1});
      }
    }
    pposx = cords.x
    pposy = cords.y
    pposz = cords.z
  }
}

function fovAimbot(){
  var smallestDif = 99999999;
  var aim_for_smallest = [];
  var smallest_cords = {x:0, y:0, z:0};
  for (i in players){
    if (players[i] != me && players[i].playing && !players[i].isDead() && players[i].actor.bodyMesh.isVisible){
      var player = players[i];
      var dify = Math.sqrt((me.y - player.y)**2);
      var dist = Math.sqrt(  (parseFloat(me.x)-parseFloat(player.x))**2 +  (parseFloat(me.y)-parseFloat(player.y))**2 + (parseFloat(me.z)-parseFloat(player.z))**2)
      var cords = player;
      var PP = [me.x, me.y, me.z];

      var nx = cords.x;
      var ny = cords.y;
      var nz = cords.z;


      var EP = [nx, ny, nz]

      var dx = PP[0]-EP[0];
      var dy = PP[1]-EP[1];
      var dz = PP[2]-EP[2];
      var pitch_radi = (Math.atan2(dy, Math.sqrt(dx*dx+dz*dz)));
      var yaw_radi = -1*(Math.atan2(dz,dx)-1.57);
      if(dy >= 0){
      yaw_radi += Math.PI;
      }else{
      yaw_radi -= Math.PI;
      }
      var mePY = [me.pitch, me.yaw];
      var aimPY = [pitch_radi, yaw_radi];
      var difPitch;
      if ((aimPY[0] > 0 && mePY[0] < 0) || (aimPY[0] < 0 && mePY[0] > 0)){
        difPitch = Math.abs(aimPY[0]) + Math.abs(mePY[0]);
      }else {
        difPitch = Math.abs(aimPY[0] - mePY[0]);
      }
      var difYaw;
      if (aimPY[1] > mePY[1]){
        if ((aimPY[1] - mePY[1]) >= Math.PI){
          difYaw = (2 * Math.PI) - aimPY[1] + mePY[1]
        }else {
          difYaw = aimPY[1] - mePY[1]
        }
      }else if (aimPY[1] < mePY[1]){
        if ((mePY[1] - aimPY[1]) >= Math.PI){
          difYaw = (2 * Math.PI) - mePY[1] + aimPY[1]
        }else {
          difYaw = mePY[1] - aimPY[1]
        }
      }else {
        difYaw = 0;
      }
      var difMeAim = Math.sqrt(Math.pow(difPitch,2) + Math.pow(difYaw,2));
      if (difMeAim < smallestDif){
        smallestDif = difMeAim;
        aim_for_smallest = aimPY;
        smallest_cords = cords;
      }
    }
  }
  if (aim_for_smallest.length > 0){
    function setaim(){
      pposx = smallest_cords.x
      pposy = smallest_cords.y
      pposz = smallest_cords.z
      me.pitch = aim_for_smallest[0];
      me.yaw = aim_for_smallest[1];
      if (aimPatch){
        if (fakeMouse){
          fakeMouse({movementX: 0, movementY:1});
          fakeMouse({movementX: 0, movementY:-1});
        }
      }
    }
    if (fovSliderMade){
      if (smallestDif <= fov){
        setaim();
      }
    }else {
      if (smallestDif <= 0.3){
        setaim();
      }
    }

  }
}

function startAimCheck(){
  clearInterval(aimCheck);
  aimCheck = setInterval(function(){
    if (isScoped){
      if (aimType == "DIST"){
        distAimbot();
      }else if (aimType == "FOV" && aimtoggle == 1){
        fovAimbot();
      }
    }
    // esp
    if (espSet){
      espCalc();
    }else {
      setupEsp();
    }

	}, 1);
}

function gameStarted(v) {
    console.log("My Player : " + v.playerName);
    mainPlayerName = v.playerName;
    startAimCheck();
    refreshPlayers();
}

function updateMainPlayer(p) {
    if (!aimCheck){
      startAimCheck();
    }
    me = p;
}
var extern = function() {
    !function(e, t) {
        var r = []
          , i = e.CANNON || this.CANNON
          , n = e.OIMO || this.OIMO
          , o = e.earcut || this.earcut;
        if ("object" == typeof exports && "object" == typeof module) {
            try {
                i = i || require("cannon")
            } catch (e) {}
            try {
                n = n || require("oimo")
            } catch (e) {}
            try {
                o = o || require("earcut")
            } catch (e) {}
            module.exports = t(i, n, o)
        } else if ("function" == typeof define && define.amd)
            require.specified && require.specified("cannon") && r.push("cannon"),
            require.specified && require.specified("oimo") && r.push("oimo"),
            require.specified && require.specified("earcut") && r.push("earcut"),
            define("babylonjs", r, t);
        else if ("object" == typeof exports) {
            try {
                i = i || require("cannon")
            } catch (e) {}
            try {
                n = n || require("oimo")
            } catch (e) {}
            try {
                o = o || require("earcut")
            } catch (e) {}
            exports.babylonjs = t(i, n, o)
        } else
            e.BABYLON = t(i, n, o)
    }(this, (function(e, t, r) {
        e = e || this.CANNON,
        t = t || this.OIMO,
        r = r || this.earcut;
        var i, n = this && this.__decorate || function(e, t, r, i) {
            var n, o = arguments.length, a = o < 3 ? t : null === i ? i = Object.getOwnPropertyDescriptor(t, r) : i;
            if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
                a = Reflect.decorate(e, t, r, i);
            else
                for (var s = e.length - 1; s >= 0; s--)
                    (n = e[s]) && (a = (o < 3 ? n(a) : o > 3 ? n(t, r, a) : n(t, r)) || a);
            return o > 3 && a && Object.defineProperty(t, r, a),
            a
        }
        , o = this && this.__extends || (i = Object.setPrototypeOf || {
            __proto__: []
        }instanceof Array && function(e, t) {
            e.__proto__ = t
        }
        || function(e, t) {
            for (var r in t)
                t.hasOwnProperty(r) && (e[r] = t[r])
        }
        ,
        function(e, t) {
            function r() {
                this.constructor = e
            }
            i(e, t),
            e.prototype = null === t ? Object.create(t) : (r.prototype = t.prototype,
            new r)
        }
        );
        !function(e) {
            var t = function() {
                function e() {
                    this._defines = {},
                    this._currentRank = 32,
                    this._maxRank = -1
                }
                return e.prototype.unBindMesh = function() {
                    this._mesh = null
                }
                ,
                e.prototype.addFallback = function(e, t) {
                    this._defines[e] || (e < this._currentRank && (this._currentRank = e),
                    e > this._maxRank && (this._maxRank = e),
                    this._defines[e] = new Array),
                    this._defines[e].push(t)
                }
                ,
                e.prototype.addCPUSkinningFallback = function(e, t) {
                    this._mesh = t,
                    e < this._currentRank && (this._currentRank = e),
                    e > this._maxRank && (this._maxRank = e)
                }
                ,
                Object.defineProperty(e.prototype, "isMoreFallbacks", {
                    get: function() {
                        return this._currentRank <= this._maxRank
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype.reduce = function(e, t) {
                    if (this._mesh && this._mesh.computeBonesUsingShaders && this._mesh.numBoneInfluencers > 0 && this._mesh.material) {
                        this._mesh.computeBonesUsingShaders = !1,
                        e = e.replace("#define NUM_BONE_INFLUENCERS " + this._mesh.numBoneInfluencers, "#define NUM_BONE_INFLUENCERS 0"),
                        t._bonesComputationForcedToCPU = !0;
                        for (var r = this._mesh.getScene(), i = 0; i < r.meshes.length; i++) {
                            var n = r.meshes[i];
                            if (n.material && (n.computeBonesUsingShaders && 0 !== n.numBoneInfluencers))
                                if (n.material.getEffect() === t)
                                    n.computeBonesUsingShaders = !1;
                                else if (n.subMeshes)
                                    for (var o = 0, a = n.subMeshes; o < a.length; o++) {
                                        if (a[o].effect === t) {
                                            n.computeBonesUsingShaders = !1;
                                            break
                                        }
                                    }
                        }
                    } else {
                        var s = this._defines[this._currentRank];
                        if (s)
                            for (i = 0; i < s.length; i++)
                                e = e.replace("#define " + s[i], "");
                        this._currentRank++
                    }
                    return e
                }
                ,
                e
            }();
            e.EffectFallbacks = t;
            var r = function() {};
            e.EffectCreationOptions = r;
            var i = function() {
                function t(r, i, n, o, a, s, y, l, c, h) {
                    void 0 === o && (o = null),
                    void 0 === s && (s = null),
                    void 0 === y && (y = null),
                    void 0 === l && (l = null),
                    void 0 === c && (c = null);
                    var u, d, x = this;
                    if (this.uniqueId = 0,
                    this.onCompileObservable = new e.Observable,
                    this.onErrorObservable = new e.Observable,
                    this._bonesComputationForcedToCPU = !1,
                    this._uniformBuffersNames = {},
                    this._isReady = !1,
                    this._compilationError = "",
                    this.name = r,
                    i.attributes) {
                        var p = i;
                        if (this._engine = n,
                        this._attributesNames = p.attributes,
                        this._uniformsNames = p.uniformsNames.concat(p.samplers),
                        this._samplers = p.samplers.slice(),
                        this.defines = p.defines,
                        this.onError = p.onError,
                        this.onCompiled = p.onCompiled,
                        this._fallbacks = p.fallbacks,
                        this._indexParameters = p.indexParameters,
                        this._transformFeedbackVaryings = p.transformFeedbackVaryings,
                        p.uniformBuffersNames)
                            for (var f = 0; f < p.uniformBuffersNames.length; f++)
                                this._uniformBuffersNames[p.uniformBuffersNames[f]] = f
                    } else
                        this._engine = a,
                        this.defines = s,
                        this._uniformsNames = n.concat(o),
                        this._samplers = o ? o.slice() : [],
                        this._attributesNames = i,
                        this.onError = c,
                        this.onCompiled = l,
                        this._indexParameters = h,
                        this._fallbacks = y;
                    this.uniqueId = t._uniqueIdSeed++,
                    r.vertexElement ? (u = document.getElementById(r.vertexElement)) || (u = r.vertexElement) : u = r.vertex || r,
                    r.fragmentElement ? (d = document.getElementById(r.fragmentElement)) || (d = r.fragmentElement) : d = r.fragment || r,
                    this._loadVertexShader(u, (function(e) {
                        x._processIncludes(e, (function(e) {
                            x._processShaderConversion(e, !1, (function(e) {
                                x._loadFragmentShader(d, (function(t) {
                                    x._processIncludes(t, (function(t) {
                                        x._processShaderConversion(t, !0, (function(t) {
                                            if (r) {
                                                var i = r.vertexElement || r.vertex || r
                                                  , n = r.fragmentElement || r.fragment || r;
                                                x._vertexSourceCode = "#define SHADER_NAME vertex:" + i + "\n" + e,
                                                x._fragmentSourceCode = "#define SHADER_NAME fragment:" + n + "\n" + t
                                            } else
                                                x._vertexSourceCode = e,
                                                x._fragmentSourceCode = t;
                                            x._prepareEffect()
                                        }
                                        ))
                                    }
                                    ))
                                }
                                ))
                            }
                            ))
                        }
                        ))
                    }
                    ))
                }
                return Object.defineProperty(t.prototype, "onBindObservable", {
                    get: function() {
                        return this._onBindObservable || (this._onBindObservable = new e.Observable),
                        this._onBindObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "key", {
                    get: function() {
                        return this._key
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.isReady = function() {
                    return this._isReady
                }
                ,
                t.prototype.getEngine = function() {
                    return this._engine
                }
                ,
                t.prototype.getProgram = function() {
                    return this._program
                }
                ,
                t.prototype.getAttributesNames = function() {
                    return this._attributesNames
                }
                ,
                t.prototype.getAttributeLocation = function(e) {
                    return this._attributes[e]
                }
                ,
                t.prototype.getAttributeLocationByName = function(e) {
                    var t = this._attributesNames.indexOf(e);
                    return this._attributes[t]
                }
                ,
                t.prototype.getAttributesCount = function() {
                    return this._attributes.length
                }
                ,
                t.prototype.getUniformIndex = function(e) {
                    return this._uniformsNames.indexOf(e)
                }
                ,
                t.prototype.getUniform = function(e) {
                    return this._uniforms[this._uniformsNames.indexOf(e)]
                }
                ,
                t.prototype.getSamplers = function() {
                    return this._samplers
                }
                ,
                t.prototype.getCompilationError = function() {
                    return this._compilationError
                }
                ,
                t.prototype.executeWhenCompiled = function(e) {
                    this.isReady() ? e(this) : this.onCompileObservable.add((function(t) {
                        e(t)
                    }
                    ))
                }
                ,
                t.prototype._loadVertexShader = function(r, i) {
                    var n;
                    if (e.Tools.IsWindowObjectExist() && r instanceof HTMLElement)
                        return void i(e.Tools.GetDOMTextContent(r));
                    "base64:" !== r.substr(0, 7) ? t.ShadersStore[r + "VertexShader"] ? i(t.ShadersStore[r + "VertexShader"]) : (n = "." === r[0] || "/" === r[0] || r.indexOf("http") > -1 ? r : e.Engine.ShadersRepository + r,
                    this._engine._loadFile(n + ".vertex.fx", i)) : i(window.atob(r.substr(7)))
                }
                ,
                t.prototype._loadFragmentShader = function(r, i) {
                    var n;
                    if (e.Tools.IsWindowObjectExist() && r instanceof HTMLElement)
                        return void i(e.Tools.GetDOMTextContent(r));
                    "base64:" !== r.substr(0, 7) ? t.ShadersStore[r + "PixelShader"] ? i(t.ShadersStore[r + "PixelShader"]) : t.ShadersStore[r + "FragmentShader"] ? i(t.ShadersStore[r + "FragmentShader"]) : (n = "." === r[0] || "/" === r[0] || r.indexOf("http") > -1 ? r : e.Engine.ShadersRepository + r,
                    this._engine._loadFile(n + ".fragment.fx", i)) : i(window.atob(r.substr(7)))
                }
                ,
                t.prototype._dumpShadersSource = function(t, r, i) {
                    var n = (this._engine.webGLVersion > 1 ? "#version 300 es\n#define WEBGL2 \n" : "") + (i ? i + "\n" : "");
                    r = n + r;
                    var o = 2
                      , a = /\n/gm
                      , s = "\n1\t" + (t = n + t).replace(a, (function() {
                        return "\n" + o++ + "\t"
                    }
                    ));
                    o = 2;
                    var y = "\n1\t" + r.replace(a, (function() {
                        return "\n" + o++ + "\t"
                    }
                    ));
                    this.name.vertexElement ? (e.Tools.Error("Vertex shader: " + this.name.vertexElement + s),
                    e.Tools.Error("Fragment shader: " + this.name.fragmentElement + y)) : this.name.vertex ? (e.Tools.Error("Vertex shader: " + this.name.vertex + s),
                    e.Tools.Error("Fragment shader: " + this.name.fragment + y)) : (e.Tools.Error("Vertex shader: " + this.name + s),
                    e.Tools.Error("Fragment shader: " + this.name + y))
                }
                ,
                t.prototype._processShaderConversion = function(e, t, r) {
                    var i = this._processPrecision(e);
                    if (1 != this._engine.webGLVersion)
                        if (-1 === i.indexOf("#version 3")) {
                            var n = -1 !== i.search(/#extension.+GL_EXT_draw_buffers.+require/)
                              , o = i.replace(/#extension.+(GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g, "");
                            o = (o = (o = o.replace(/varying(?![\n\r])\s/g, t ? "in " : "out ")).replace(/attribute[ \t]/g, "in ")).replace(/[ \t]attribute/g, " in"),
                            t && (o = (o = (o = (o = (o = (o = (o = (o = o.replace(/texture2DLodEXT\s*\(/g, "textureLod(")).replace(/textureCubeLodEXT\s*\(/g, "textureLod(")).replace(/texture2D\s*\(/g, "texture(")).replace(/textureCube\s*\(/g, "texture(")).replace(/gl_FragDepthEXT/g, "gl_FragDepth")).replace(/gl_FragColor/g, "glFragColor")).replace(/gl_FragData/g, "glFragData")).replace(/void\s+?main\s*\(/g, (n ? "" : "out vec4 glFragColor;\n") + "void main(")),
                            r(o)
                        } else
                            r(i.replace("#version 300 es", ""));
                    else
                        r(i)
                }
                ,
                t.prototype._processIncludes = function(r, i) {
                    for (var n = this, o = /#include<(.+)>(\((.*)\))*(\[(.*)\])*/g, a = o.exec(r), s = new String(r); null != a; ) {
                        var y = a[1];
                        if (-1 !== y.indexOf("__decl__") && (y = y.replace(/__decl__/, ""),
                        this._engine.supportsUniformBuffers && (y = (y = y.replace(/Vertex/, "Ubo")).replace(/Fragment/, "Ubo")),
                        y += "Declaration"),
                        !t.IncludesShadersStore[y]) {
                            var l = e.Engine.ShadersRepository + "ShadersInclude/" + y + ".fx";
                            return void this._engine._loadFile(l, (function(e) {
                                t.IncludesShadersStore[y] = e,
                                n._processIncludes(s, i)
                            }
                            ))
                        }
                        var c = t.IncludesShadersStore[y];
                        if (a[2])
                            for (var h = a[3].split(","), u = 0; u < h.length; u += 2) {
                                var d = new RegExp(h[u],"g")
                                  , x = h[u + 1];
                                c = c.replace(d, x)
                            }
                        if (a[4]) {
                            var p = a[5];
                            if (-1 !== p.indexOf("..")) {
                                var f = p.split("..")
                                  , m = parseInt(f[0])
                                  , z = parseInt(f[1])
                                  , _ = c.slice(0);
                                c = "",
                                isNaN(z) && (z = this._indexParameters[f[1]]);
                                for (var g = m; g < z; g++)
                                    this._engine.supportsUniformBuffers || (_ = _.replace(/light\{X\}.(\w*)/g, (function(e, t) {
                                        return t + "{X}"
                                    }
                                    ))),
                                    c += _.replace(/\{X\}/g, g.toString()) + "\n"
                            } else
                                this._engine.supportsUniformBuffers || (c = c.replace(/light\{X\}.(\w*)/g, (function(e, t) {
                                    return t + "{X}"
                                }
                                ))),
                                c = c.replace(/\{X\}/g, p)
                        }
                        s = s.replace(a[0], c),
                        a = o.exec(r)
                    }
                    i(s)
                }
                ,
                t.prototype._processPrecision = function(e) {
                    return -1 === e.indexOf("precision highp float") ? e = this._engine.getCaps().highPrecisionShaderSupported ? "precision highp float;\n" + e : "precision mediump float;\n" + e : this._engine.getCaps().highPrecisionShaderSupported || (e = e.replace("precision highp float", "precision mediump float")),
                    e
                }
                ,
                t.prototype._rebuildProgram = function(t, r, i, n) {
                    var o = this;
                    this._isReady = !1,
                    this._vertexSourceCodeOverride = t,
                    this._fragmentSourceCodeOverride = r,
                    this.onError = function(e, t) {
                        n && n(t)
                    }
                    ,
                    this.onCompiled = function() {
                        for (var t = o.getEngine().scenes, r = 0; r < t.length; r++)
                            t[r].markAllMaterialsAsDirty(e.Material.TextureDirtyFlag);
                        i && i(o._program)
                    }
                    ,
                    this._fallbacks = null,
                    this._prepareEffect()
                }
                ,
                t.prototype.getSpecificUniformLocations = function(e) {
                    return this._engine.getUniforms(this._program, e)
                }
                ,
                t.prototype._prepareEffect = function() {
                    var t = this._attributesNames
                      , r = this.defines
                      , i = this._fallbacks;
                    this._valueCache = {};
                    var n = this._program;
                    try {
                        var o, a = this._engine;
                        if (this._vertexSourceCodeOverride && this._fragmentSourceCodeOverride ? this._program = a.createRawShaderProgram(this._vertexSourceCodeOverride, this._fragmentSourceCodeOverride, void 0, this._transformFeedbackVaryings) : this._program = a.createShaderProgram(this._vertexSourceCode, this._fragmentSourceCode, r, void 0, this._transformFeedbackVaryings),
                        this._program.__SPECTOR_rebuildProgram = this._rebuildProgram.bind(this),
                        a.supportsUniformBuffers)
                            for (var s in this._uniformBuffersNames)
                                this.bindUniformBlock(s, this._uniformBuffersNames[s]);
                        for (this._uniforms = a.getUniforms(this._program, this._uniformsNames),
                        this._attributes = a.getAttributes(this._program, t),
                        o = 0; o < this._samplers.length; o++) {
                            null == this.getUniform(this._samplers[o]) && (this._samplers.splice(o, 1),
                            o--)
                        }
                        a.bindSamplers(this),
                        this._compilationError = "",
                        this._isReady = !0,
                        this.onCompiled && this.onCompiled(this),
                        this.onCompileObservable.notifyObservers(this),
                        this.onCompileObservable.clear(),
                        this._fallbacks && this._fallbacks.unBindMesh(),
                        n && this.getEngine()._deleteProgram(n)
                    } catch (r) {
                        this._compilationError = r.message,
                        e.Tools.Error("Unable to compile effect:"),
                        e.Tools.Error("Uniforms: " + this._uniformsNames.map((function(e) {
                            return " " + e
                        }
                        ))),
                        e.Tools.Error("Attributes: " + t.map((function(e) {
                            return " " + e
                        }
                        ))),
                        e.Tools.Error("Error: " + this._compilationError),
                        n && (this._program = n,
                        this._isReady = !0,
                        this.onError && this.onError(this, this._compilationError),
                        this.onErrorObservable.notifyObservers(this)),
                        i && i.isMoreFallbacks ? (e.Tools.Error("Trying next fallback."),
                        this.defines = i.reduce(this.defines, this),
                        this._prepareEffect()) : (this.onError && this.onError(this, this._compilationError),
                        this.onErrorObservable.notifyObservers(this),
                        this.onErrorObservable.clear(),
                        this._fallbacks && this._fallbacks.unBindMesh())
                    }
                }
                ,
                Object.defineProperty(t.prototype, "isSupported", {
                    get: function() {
                        return "" === this._compilationError
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._bindTexture = function(e, t) {
                    this._engine._bindTexture(this._samplers.indexOf(e), t)
                }
                ,
                t.prototype.setTexture = function(e, t) {
                    this._engine.setTexture(this._samplers.indexOf(e), this.getUniform(e), t)
                }
                ,
                t.prototype.setDepthStencilTexture = function(e, t) {
                    this._engine.setDepthStencilTexture(this._samplers.indexOf(e), this.getUniform(e), t)
                }
                ,
                t.prototype.setTextureArray = function(e, t) {
                    if (-1 === this._samplers.indexOf(e + "Ex"))
                        for (var r = this._samplers.indexOf(e), i = 1; i < t.length; i++)
                            this._samplers.splice(r + i, 0, e + "Ex");
                    this._engine.setTextureArray(this._samplers.indexOf(e), this.getUniform(e), t)
                }
                ,
                t.prototype.setTextureFromPostProcess = function(e, t) {
                    this._engine.setTextureFromPostProcess(this._samplers.indexOf(e), t)
                }
                ,
                t.prototype.setTextureFromPostProcessOutput = function(e, t) {
                    this._engine.setTextureFromPostProcessOutput(this._samplers.indexOf(e), t)
                }
                ,
                t.prototype._cacheMatrix = function(e, t) {
                    var r = this._valueCache[e]
                      , i = t.updateFlag;
                    return (void 0 === r || r !== i) && (this._valueCache[e] = i,
                    !0)
                }
                ,
                t.prototype._cacheFloat2 = function(e, t, r) {
                    var i = this._valueCache[e];
                    if (!i)
                        return i = [t, r],
                        this._valueCache[e] = i,
                        !0;
                    var n = !1;
                    return i[0] !== t && (i[0] = t,
                    n = !0),
                    i[1] !== r && (i[1] = r,
                    n = !0),
                    n
                }
                ,
                t.prototype._cacheFloat3 = function(e, t, r, i) {
                    var n = this._valueCache[e];
                    if (!n)
                        return n = [t, r, i],
                        this._valueCache[e] = n,
                        !0;
                    var o = !1;
                    return n[0] !== t && (n[0] = t,
                    o = !0),
                    n[1] !== r && (n[1] = r,
                    o = !0),
                    n[2] !== i && (n[2] = i,
                    o = !0),
                    o
                }
                ,
                t.prototype._cacheFloat4 = function(e, t, r, i, n) {
                    var o = this._valueCache[e];
                    if (!o)
                        return o = [t, r, i, n],
                        this._valueCache[e] = o,
                        !0;
                    var a = !1;
                    return o[0] !== t && (o[0] = t,
                    a = !0),
                    o[1] !== r && (o[1] = r,
                    a = !0),
                    o[2] !== i && (o[2] = i,
                    a = !0),
                    o[3] !== n && (o[3] = n,
                    a = !0),
                    a
                }
                ,
                t.prototype.bindUniformBuffer = function(e, r) {
                    var i = this._uniformBuffersNames[r];
                    void 0 !== i && t._baseCache[i] !== e && (t._baseCache[i] = e,
                    this._engine.bindUniformBufferBase(e, i))
                }
                ,
                t.prototype.bindUniformBlock = function(e, t) {
                    this._engine.bindUniformBlock(this._program, e, t)
                }
                ,
                t.prototype.setInt = function(e, t) {
                    var r = this._valueCache[e];
                    return void 0 !== r && r === t ? this : (this._valueCache[e] = t,
                    this._engine.setInt(this.getUniform(e), t),
                    this)
                }
                ,
                t.prototype.setIntArray = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setIntArray(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setIntArray2 = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setIntArray2(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setIntArray3 = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setIntArray3(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setIntArray4 = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setIntArray4(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setFloatArray = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setFloatArray(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setFloatArray2 = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setFloatArray2(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setFloatArray3 = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setFloatArray3(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setFloatArray4 = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setFloatArray4(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setArray = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setArray(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setArray2 = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setArray2(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setArray3 = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setArray3(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setArray4 = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setArray4(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setMatrices = function(e, t) {
                    return t ? (this._valueCache[e] = null,
                    this._engine.setMatrices(this.getUniform(e), t),
                    this) : this
                }
                ,
                t.prototype.setMatrix = function(e, t) {
                    return this._cacheMatrix(e, t) && this._engine.setMatrix(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setMatrix3x3 = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setMatrix3x3(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setMatrix2x2 = function(e, t) {
                    return this._valueCache[e] = null,
                    this._engine.setMatrix2x2(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setFloat = function(e, t) {
                    var r = this._valueCache[e];
                    return void 0 !== r && r === t ? this : (this._valueCache[e] = t,
                    this._engine.setFloat(this.getUniform(e), t),
                    this)
                }
                ,
                t.prototype.setBool = function(e, t) {
                    var r = this._valueCache[e];
                    return void 0 !== r && r === t ? this : (this._valueCache[e] = t,
                    this._engine.setBool(this.getUniform(e), t ? 1 : 0),
                    this)
                }
                ,
                t.prototype.setVector2 = function(e, t) {
                    return this._cacheFloat2(e, t.x, t.y) && this._engine.setFloat2(this.getUniform(e), t.x, t.y),
                    this
                }
                ,
                t.prototype.setFloat2 = function(e, t, r) {
                    return this._cacheFloat2(e, t, r) && this._engine.setFloat2(this.getUniform(e), t, r),
                    this
                }
                ,
                t.prototype.setVector3 = function(e, t) {
                    return this._cacheFloat3(e, t.x, t.y, t.z) && this._engine.setFloat3(this.getUniform(e), t.x, t.y, t.z),
                    this
                }
                ,
                t.prototype.setFloat3 = function(e, t, r, i) {
                    return this._cacheFloat3(e, t, r, i) && this._engine.setFloat3(this.getUniform(e), t, r, i),
                    this
                }
                ,
                t.prototype.setVector4 = function(e, t) {
                    return this._cacheFloat4(e, t.x, t.y, t.z, t.w) && this._engine.setFloat4(this.getUniform(e), t.x, t.y, t.z, t.w),
                    this
                }
                ,
                t.prototype.setFloat4 = function(e, t, r, i, n) {
                    return this._cacheFloat4(e, t, r, i, n) && this._engine.setFloat4(this.getUniform(e), t, r, i, n),
                    this
                }
                ,
                t.prototype.setColor3 = function(e, t) {
                    return this._cacheFloat3(e, t.r, t.g, t.b) && this._engine.setColor3(this.getUniform(e), t),
                    this
                }
                ,
                t.prototype.setColor4 = function(e, t, r) {
                    return this._cacheFloat4(e, t.r, t.g, t.b, r) && this._engine.setColor4(this.getUniform(e), t, r),
                    this
                }
                ,
                t.prototype.setDirectColor4 = function(e, t) {
                    return this._cacheFloat4(e, t.r, t.g, t.b, t.a) && this._engine.setDirectColor4(this.getUniform(e), t),
                    this
                }
                ,
                t.RegisterShader = function(e, r, i) {
                    r && (t.ShadersStore[e + "PixelShader"] = r),
                    i && (t.ShadersStore[e + "VertexShader"] = i)
                }
                ,
                t.ResetCache = function() {
                    t._baseCache = {}
                }
                ,
                t._uniqueIdSeed = 0,
                t._baseCache = {},
                t.ShadersStore = {},
                t.IncludesShadersStore = {},
                t
            }();
            e.Effect = i
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {}
                return e.KEYDOWN = 1,
                e.KEYUP = 2,
                e
            }();
            e.KeyboardEventTypes = t;
            var r = function(e, t) {
                this.type = e,
                this.event = t
            };
            e.KeyboardInfo = r;
            var i = function(e) {
                function t(t, r) {
                    var i = e.call(this, t, r) || this;
                    return i.type = t,
                    i.event = r,
                    i.skipOnPointerObservable = !1,
                    i
                }
                return o(t, e),
                t
            }(r);
            e.KeyboardInfoPre = i
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {}
                return e.POINTERDOWN = 1,
                e.POINTERUP = 2,
                e.POINTERMOVE = 4,
                e.POINTERWHEEL = 8,
                e.POINTERPICK = 16,
                e.POINTERTAP = 32,
                e.POINTERDOUBLETAP = 64,
                e
            }();
            e.PointerEventTypes = t;
            var r = function(e, t) {
                this.type = e,
                this.event = t
            };
            e.PointerInfoBase = r;
            var i = function(t) {
                function r(r, i, n, o) {
                    var a = t.call(this, r, i) || this;
                    return a.ray = null,
                    a.skipOnPointerObservable = !1,
                    a.localPosition = new e.Vector2(n,o),
                    a
                }
                return o(r, t),
                r
            }(r);
            e.PointerInfoPre = i;
            var n = function(e) {
                function t(t, r, i) {
                    var n = e.call(this, t, r) || this;
                    return n.pickInfo = i,
                    n
                }
                return o(t, e),
                t
            }(r);
            e.PointerInfo = n
        }(s || (s = {})),
        function(e) {
            e.ToGammaSpace = 1 / 2.2,
            e.ToLinearSpace = 2.2,
            e.Epsilon = .001;
            var t = function() {
                function t(e, t, r) {
                    void 0 === e && (e = 0),
                    void 0 === t && (t = 0),
                    void 0 === r && (r = 0),
                    this.r = e,
                    this.g = t,
                    this.b = r
                }
                return t.prototype.toString = function() {
                    return "{R: " + this.r + " G:" + this.g + " B:" + this.b + "}"
                }
                ,
                t.prototype.getClassName = function() {
                    return "Color3"
                }
                ,
                t.prototype.getHashCode = function() {
                    var e = this.r || 0;
                    return e = 397 * (e = 397 * e ^ (this.g || 0)) ^ (this.b || 0)
                }
                ,
                t.prototype.toArray = function(e, t) {
                    return void 0 === t && (t = 0),
                    e[t] = this.r,
                    e[t + 1] = this.g,
                    e[t + 2] = this.b,
                    this
                }
                ,
                t.prototype.toColor4 = function(e) {
                    return void 0 === e && (e = 1),
                    new r(this.r,this.g,this.b,e)
                }
                ,
                t.prototype.asArray = function() {
                    var e = new Array;
                    return this.toArray(e, 0),
                    e
                }
                ,
                t.prototype.toLuminance = function() {
                    return .3 * this.r + .59 * this.g + .11 * this.b
                }
                ,
                t.prototype.multiply = function(e) {
                    return new t(this.r * e.r,this.g * e.g,this.b * e.b)
                }
                ,
                t.prototype.multiplyToRef = function(e, t) {
                    return t.r = this.r * e.r,
                    t.g = this.g * e.g,
                    t.b = this.b * e.b,
                    this
                }
                ,
                t.prototype.equals = function(e) {
                    return e && this.r === e.r && this.g === e.g && this.b === e.b
                }
                ,
                t.prototype.equalsFloats = function(e, t, r) {
                    return this.r === e && this.g === t && this.b === r
                }
                ,
                t.prototype.scale = function(e) {
                    return new t(this.r * e,this.g * e,this.b * e)
                }
                ,
                t.prototype.scaleToRef = function(e, t) {
                    return t.r = this.r * e,
                    t.g = this.g * e,
                    t.b = this.b * e,
                    this
                }
                ,
                t.prototype.scaleAndAddToRef = function(e, t) {
                    return t.r += this.r * e,
                    t.g += this.g * e,
                    t.b += this.b * e,
                    this
                }
                ,
                t.prototype.clampToRef = function(t, r, i) {
                    return void 0 === t && (t = 0),
                    void 0 === r && (r = 1),
                    i.r = e.Scalar.Clamp(this.r, t, r),
                    i.g = e.Scalar.Clamp(this.g, t, r),
                    i.b = e.Scalar.Clamp(this.b, t, r),
                    this
                }
                ,
                t.prototype.add = function(e) {
                    return new t(this.r + e.r,this.g + e.g,this.b + e.b)
                }
                ,
                t.prototype.addToRef = function(e, t) {
                    return t.r = this.r + e.r,
                    t.g = this.g + e.g,
                    t.b = this.b + e.b,
                    this
                }
                ,
                t.prototype.subtract = function(e) {
                    return new t(this.r - e.r,this.g - e.g,this.b - e.b)
                }
                ,
                t.prototype.subtractToRef = function(e, t) {
                    return t.r = this.r - e.r,
                    t.g = this.g - e.g,
                    t.b = this.b - e.b,
                    this
                }
                ,
                t.prototype.clone = function() {
                    return new t(this.r,this.g,this.b)
                }
                ,
                t.prototype.copyFrom = function(e) {
                    return this.r = e.r,
                    this.g = e.g,
                    this.b = e.b,
                    this
                }
                ,
                t.prototype.copyFromFloats = function(e, t, r) {
                    return this.r = e,
                    this.g = t,
                    this.b = r,
                    this
                }
                ,
                t.prototype.set = function(e, t, r) {
                    return this.copyFromFloats(e, t, r)
                }
                ,
                t.prototype.toHexString = function() {
                    var t = 255 * this.r | 0
                      , r = 255 * this.g | 0
                      , i = 255 * this.b | 0;
                    return "#" + e.Scalar.ToHex(t) + e.Scalar.ToHex(r) + e.Scalar.ToHex(i)
                }
                ,
                t.prototype.toLinearSpace = function() {
                    var e = new t;
                    return this.toLinearSpaceToRef(e),
                    e
                }
                ,
                t.prototype.toLinearSpaceToRef = function(t) {
                    return t.r = Math.pow(this.r, e.ToLinearSpace),
                    t.g = Math.pow(this.g, e.ToLinearSpace),
                    t.b = Math.pow(this.b, e.ToLinearSpace),
                    this
                }
                ,
                t.prototype.toGammaSpace = function() {
                    var e = new t;
                    return this.toGammaSpaceToRef(e),
                    e
                }
                ,
                t.prototype.toGammaSpaceToRef = function(t) {
                    return t.r = Math.pow(this.r, e.ToGammaSpace),
                    t.g = Math.pow(this.g, e.ToGammaSpace),
                    t.b = Math.pow(this.b, e.ToGammaSpace),
                    this
                }
                ,
                t.FromHexString = function(e) {
                    if ("#" !== e.substring(0, 1) || 7 !== e.length)
                        return new t(0,0,0);
                    var r = parseInt(e.substring(1, 3), 16)
                      , i = parseInt(e.substring(3, 5), 16)
                      , n = parseInt(e.substring(5, 7), 16);
                    return t.FromInts(r, i, n)
                }
                ,
                t.FromArray = function(e, r) {
                    return void 0 === r && (r = 0),
                    new t(e[r],e[r + 1],e[r + 2])
                }
                ,
                t.FromInts = function(e, r, i) {
                    return new t(e / 255,r / 255,i / 255)
                }
                ,
                t.Lerp = function(e, r, i) {
                    var n = new t(0,0,0);
                    return t.LerpToRef(e, r, i, n),
                    n
                }
                ,
                t.LerpToRef = function(e, t, r, i) {
                    i.r = e.r + (t.r - e.r) * r,
                    i.g = e.g + (t.g - e.g) * r,
                    i.b = e.b + (t.b - e.b) * r
                }
                ,
                t.Red = function() {
                    return new t(1,0,0)
                }
                ,
                t.Green = function() {
                    return new t(0,1,0)
                }
                ,
                t.Blue = function() {
                    return new t(0,0,1)
                }
                ,
                t.Black = function() {
                    return new t(0,0,0)
                }
                ,
                t.White = function() {
                    return new t(1,1,1)
                }
                ,
                t.Purple = function() {
                    return new t(.5,0,.5)
                }
                ,
                t.Magenta = function() {
                    return new t(1,0,1)
                }
                ,
                t.Yellow = function() {
                    return new t(1,1,0)
                }
                ,
                t.Gray = function() {
                    return new t(.5,.5,.5)
                }
                ,
                t.Teal = function() {
                    return new t(0,1,1)
                }
                ,
                t.Random = function() {
                    return new t(Math.random(),Math.random(),Math.random())
                }
                ,
                t
            }();
            e.Color3 = t;
            var r = function() {
                function t(e, t, r, i) {
                    void 0 === e && (e = 0),
                    void 0 === t && (t = 0),
                    void 0 === r && (r = 0),
                    void 0 === i && (i = 1),
                    this.r = e,
                    this.g = t,
                    this.b = r,
                    this.a = i
                }
                return t.prototype.addInPlace = function(e) {
                    return this.r += e.r,
                    this.g += e.g,
                    this.b += e.b,
                    this.a += e.a,
                    this
                }
                ,
                t.prototype.asArray = function() {
                    var e = new Array;
                    return this.toArray(e, 0),
                    e
                }
                ,
                t.prototype.toArray = function(e, t) {
                    return void 0 === t && (t = 0),
                    e[t] = this.r,
                    e[t + 1] = this.g,
                    e[t + 2] = this.b,
                    e[t + 3] = this.a,
                    this
                }
                ,
                t.prototype.add = function(e) {
                    return new t(this.r + e.r,this.g + e.g,this.b + e.b,this.a + e.a)
                }
                ,
                t.prototype.subtract = function(e) {
                    return new t(this.r - e.r,this.g - e.g,this.b - e.b,this.a - e.a)
                }
                ,
                t.prototype.subtractToRef = function(e, t) {
                    return t.r = this.r - e.r,
                    t.g = this.g - e.g,
                    t.b = this.b - e.b,
                    t.a = this.a - e.a,
                    this
                }
                ,
                t.prototype.scale = function(e) {
                    return new t(this.r * e,this.g * e,this.b * e,this.a * e)
                }
                ,
                t.prototype.scaleToRef = function(e, t) {
                    return t.r = this.r * e,
                    t.g = this.g * e,
                    t.b = this.b * e,
                    t.a = this.a * e,
                    this
                }
                ,
                t.prototype.scaleAndAddToRef = function(e, t) {
                    return t.r += this.r * e,
                    t.g += this.g * e,
                    t.b += this.b * e,
                    t.a += this.a * e,
                    this
                }
                ,
                t.prototype.clampToRef = function(t, r, i) {
                    return void 0 === t && (t = 0),
                    void 0 === r && (r = 1),
                    i.r = e.Scalar.Clamp(this.r, t, r),
                    i.g = e.Scalar.Clamp(this.g, t, r),
                    i.b = e.Scalar.Clamp(this.b, t, r),
                    i.a = e.Scalar.Clamp(this.a, t, r),
                    this
                }
                ,
                t.prototype.multiply = function(e) {
                    return new t(this.r * e.r,this.g * e.g,this.b * e.b,this.a * e.a)
                }
                ,
                t.prototype.multiplyToRef = function(e, t) {
                    return t.r = this.r * e.r,
                    t.g = this.g * e.g,
                    t.b = this.b * e.b,
                    t.a = this.a * e.a,
                    t
                }
                ,
                t.prototype.toString = function() {
                    return "{R: " + this.r + " G:" + this.g + " B:" + this.b + " A:" + this.a + "}"
                }
                ,
                t.prototype.getClassName = function() {
                    return "Color4"
                }
                ,
                t.prototype.getHashCode = function() {
                    var e = this.r || 0;
                    return e = 397 * (e = 397 * (e = 397 * e ^ (this.g || 0)) ^ (this.b || 0)) ^ (this.a || 0)
                }
                ,
                t.prototype.clone = function() {
                    return new t(this.r,this.g,this.b,this.a)
                }
                ,
                t.prototype.copyFrom = function(e) {
                    return this.r = e.r,
                    this.g = e.g,
                    this.b = e.b,
                    this.a = e.a,
                    this
                }
                ,
                t.prototype.copyFromFloats = function(e, t, r, i) {
                    return this.r = e,
                    this.g = t,
                    this.b = r,
                    this.a = i,
                    this
                }
                ,
                t.prototype.set = function(e, t, r, i) {
                    return this.copyFromFloats(e, t, r, i)
                }
                ,
                t.prototype.toHexString = function() {
                    var t = 255 * this.r | 0
                      , r = 255 * this.g | 0
                      , i = 255 * this.b | 0
                      , n = 255 * this.a | 0;
                    return "#" + e.Scalar.ToHex(t) + e.Scalar.ToHex(r) + e.Scalar.ToHex(i) + e.Scalar.ToHex(n)
                }
                ,
                t.prototype.toLinearSpace = function() {
                    var e = new t;
                    return this.toLinearSpaceToRef(e),
                    e
                }
                ,
                t.prototype.toLinearSpaceToRef = function(t) {
                    return t.r = Math.pow(this.r, e.ToLinearSpace),
                    t.g = Math.pow(this.g, e.ToLinearSpace),
                    t.b = Math.pow(this.b, e.ToLinearSpace),
                    t.a = this.a,
                    this
                }
                ,
                t.prototype.toGammaSpace = function() {
                    var e = new t;
                    return this.toGammaSpaceToRef(e),
                    e
                }
                ,
                t.prototype.toGammaSpaceToRef = function(t) {
                    return t.r = Math.pow(this.r, e.ToGammaSpace),
                    t.g = Math.pow(this.g, e.ToGammaSpace),
                    t.b = Math.pow(this.b, e.ToGammaSpace),
                    t.a = this.a,
                    this
                }
                ,
                t.FromHexString = function(e) {
                    if ("#" !== e.substring(0, 1) || 9 !== e.length)
                        return new t(0,0,0,0);
                    var r = parseInt(e.substring(1, 3), 16)
                      , i = parseInt(e.substring(3, 5), 16)
                      , n = parseInt(e.substring(5, 7), 16)
                      , o = parseInt(e.substring(7, 9), 16);
                    return t.FromInts(r, i, n, o)
                }
                ,
                t.Lerp = function(e, r, i) {
                    var n = new t(0,0,0,0);
                    return t.LerpToRef(e, r, i, n),
                    n
                }
                ,
                t.LerpToRef = function(e, t, r, i) {
                    i.r = e.r + (t.r - e.r) * r,
                    i.g = e.g + (t.g - e.g) * r,
                    i.b = e.b + (t.b - e.b) * r,
                    i.a = e.a + (t.a - e.a) * r
                }
                ,
                t.FromColor3 = function(e, r) {
                    return void 0 === r && (r = 1),
                    new t(e.r,e.g,e.b,r)
                }
                ,
                t.FromArray = function(e, r) {
                    return void 0 === r && (r = 0),
                    new t(e[r],e[r + 1],e[r + 2],e[r + 3])
                }
                ,
                t.FromInts = function(e, r, i, n) {
                    return new t(e / 255,r / 255,i / 255,n / 255)
                }
                ,
                t.CheckColors4 = function(e, t) {
                    if (e.length === 3 * t) {
                        for (var r = [], i = 0; i < e.length; i += 3) {
                            var n = i / 3 * 4;
                            r[n] = e[i],
                            r[n + 1] = e[i + 1],
                            r[n + 2] = e[i + 2],
                            r[n + 3] = 1
                        }
                        return r
                    }
                    return e
                }
                ,
                t
            }();
            e.Color4 = r;
            var i = function() {
                function t(e, t) {
                    void 0 === e && (e = 0),
                    void 0 === t && (t = 0),
                    this.x = e,
                    this.y = t
                }
                return t.prototype.toString = function() {
                    return "{X: " + this.x + " Y:" + this.y + "}"
                }
                ,
                t.prototype.getClassName = function() {
                    return "Vector2"
                }
                ,
                t.prototype.getHashCode = function() {
                    var e = this.x || 0;
                    return e = 397 * e ^ (this.y || 0)
                }
                ,
                t.prototype.toArray = function(e, t) {
                    return void 0 === t && (t = 0),
                    e[t] = this.x,
                    e[t + 1] = this.y,
                    this
                }
                ,
                t.prototype.asArray = function() {
                    var e = new Array;
                    return this.toArray(e, 0),
                    e
                }
                ,
                t.prototype.copyFrom = function(e) {
                    return this.x = e.x,
                    this.y = e.y,
                    this
                }
                ,
                t.prototype.copyFromFloats = function(e, t) {
                    return this.x = e,
                    this.y = t,
                    this
                }
                ,
                t.prototype.set = function(e, t) {
                    return this.copyFromFloats(e, t)
                }
                ,
                t.prototype.add = function(e) {
                    return new t(this.x + e.x,this.y + e.y)
                }
                ,
                t.prototype.addToRef = function(e, t) {
                    return t.x = this.x + e.x,
                    t.y = this.y + e.y,
                    this
                }
                ,
                t.prototype.addInPlace = function(e) {
                    return this.x += e.x,
                    this.y += e.y,
                    this
                }
                ,
                t.prototype.addVector3 = function(e) {
                    return new t(this.x + e.x,this.y + e.y)
                }
                ,
                t.prototype.subtract = function(e) {
                    return new t(this.x - e.x,this.y - e.y)
                }
                ,
                t.prototype.subtractToRef = function(e, t) {
                    return t.x = this.x - e.x,
                    t.y = this.y - e.y,
                    this
                }
                ,
                t.prototype.subtractInPlace = function(e) {
                    return this.x -= e.x,
                    this.y -= e.y,
                    this
                }
                ,
                t.prototype.multiplyInPlace = function(e) {
                    return this.x *= e.x,
                    this.y *= e.y,
                    this
                }
                ,
                t.prototype.multiply = function(e) {
                    return new t(this.x * e.x,this.y * e.y)
                }
                ,
                t.prototype.multiplyToRef = function(e, t) {
                    return t.x = this.x * e.x,
                    t.y = this.y * e.y,
                    this
                }
                ,
                t.prototype.multiplyByFloats = function(e, r) {
                    return new t(this.x * e,this.y * r)
                }
                ,
                t.prototype.divide = function(e) {
                    return new t(this.x / e.x,this.y / e.y)
                }
                ,
                t.prototype.divideToRef = function(e, t) {
                    return t.x = this.x / e.x,
                    t.y = this.y / e.y,
                    this
                }
                ,
                t.prototype.divideInPlace = function(e) {
                    return this.divideToRef(e, this)
                }
                ,
                t.prototype.negate = function() {
                    return new t(-this.x,-this.y)
                }
                ,
                t.prototype.scaleInPlace = function(e) {
                    return this.x *= e,
                    this.y *= e,
                    this
                }
                ,
                t.prototype.scale = function(e) {
                    var r = new t(0,0);
                    return this.scaleToRef(e, r),
                    r
                }
                ,
                t.prototype.scaleToRef = function(e, t) {
                    return t.x = this.x * e,
                    t.y = this.y * e,
                    this
                }
                ,
                t.prototype.scaleAndAddToRef = function(e, t) {
                    return t.x += this.x * e,
                    t.y += this.y * e,
                    this
                }
                ,
                t.prototype.equals = function(e) {
                    return e && this.x === e.x && this.y === e.y
                }
                ,
                t.prototype.equalsWithEpsilon = function(t, r) {
                    return void 0 === r && (r = e.Epsilon),
                    t && e.Scalar.WithinEpsilon(this.x, t.x, r) && e.Scalar.WithinEpsilon(this.y, t.y, r)
                }
                ,
                t.prototype.floor = function() {
                    return new t(Math.floor(this.x),Math.floor(this.y))
                }
                ,
                t.prototype.fract = function() {
                    return new t(this.x - Math.floor(this.x),this.y - Math.floor(this.y))
                }
                ,
                t.prototype.length = function() {
                    return Math.sqrt(this.x * this.x + this.y * this.y)
                }
                ,
                t.prototype.lengthSquared = function() {
                    return this.x * this.x + this.y * this.y
                }
                ,
                t.prototype.normalize = function() {
                    var e = this.length();
                    if (0 === e)
                        return this;
                    var t = 1 / e;
                    return this.x *= t,
                    this.y *= t,
                    this
                }
                ,
                t.prototype.clone = function() {
                    return new t(this.x,this.y)
                }
                ,
                t.Zero = function() {
                    return new t(0,0)
                }
                ,
                t.One = function() {
                    return new t(1,1)
                }
                ,
                t.FromArray = function(e, r) {
                    return void 0 === r && (r = 0),
                    new t(e[r],e[r + 1])
                }
                ,
                t.FromArrayToRef = function(e, t, r) {
                    r.x = e[t],
                    r.y = e[t + 1]
                }
                ,
                t.CatmullRom = function(e, r, i, n, o) {
                    var a = o * o
                      , s = o * a;
                    return new t(.5 * (2 * r.x + (-e.x + i.x) * o + (2 * e.x - 5 * r.x + 4 * i.x - n.x) * a + (-e.x + 3 * r.x - 3 * i.x + n.x) * s),.5 * (2 * r.y + (-e.y + i.y) * o + (2 * e.y - 5 * r.y + 4 * i.y - n.y) * a + (-e.y + 3 * r.y - 3 * i.y + n.y) * s))
                }
                ,
                t.Clamp = function(e, r, i) {
                    var n = e.x;
                    n = (n = n > i.x ? i.x : n) < r.x ? r.x : n;
                    var o = e.y;
                    return new t(n,o = (o = o > i.y ? i.y : o) < r.y ? r.y : o)
                }
                ,
                t.Hermite = function(e, r, i, n, o) {
                    var a = o * o
                      , s = o * a
                      , y = 2 * s - 3 * a + 1
                      , l = -2 * s + 3 * a
                      , c = s - 2 * a + o
                      , h = s - a;
                    return new t(e.x * y + i.x * l + r.x * c + n.x * h,e.y * y + i.y * l + r.y * c + n.y * h)
                }
                ,
                t.Lerp = function(e, r, i) {
                    return new t(e.x + (r.x - e.x) * i,e.y + (r.y - e.y) * i)
                }
                ,
                t.Dot = function(e, t) {
                    return e.x * t.x + e.y * t.y
                }
                ,
                t.Normalize = function(e) {
                    var t = e.clone();
                    return t.normalize(),
                    t
                }
                ,
                t.Minimize = function(e, r) {
                    return new t(e.x < r.x ? e.x : r.x,e.y < r.y ? e.y : r.y)
                }
                ,
                t.Maximize = function(e, r) {
                    return new t(e.x > r.x ? e.x : r.x,e.y > r.y ? e.y : r.y)
                }
                ,
                t.Transform = function(e, r) {
                    var i = t.Zero();
                    return t.TransformToRef(e, r, i),
                    i
                }
                ,
                t.TransformToRef = function(e, t, r) {
                    var i = e.x * t.m[0] + e.y * t.m[4] + t.m[12]
                      , n = e.x * t.m[1] + e.y * t.m[5] + t.m[13];
                    r.x = i,
                    r.y = n
                }
                ,
                t.PointInTriangle = function(e, t, r, i) {
                    var n = .5 * (-r.y * i.x + t.y * (-r.x + i.x) + t.x * (r.y - i.y) + r.x * i.y)
                      , o = n < 0 ? -1 : 1
                      , a = (t.y * i.x - t.x * i.y + (i.y - t.y) * e.x + (t.x - i.x) * e.y) * o
                      , s = (t.x * r.y - t.y * r.x + (t.y - r.y) * e.x + (r.x - t.x) * e.y) * o;
                    return a > 0 && s > 0 && a + s < 2 * n * o
                }
                ,
                t.Distance = function(e, r) {
                    return Math.sqrt(t.DistanceSquared(e, r))
                }
                ,
                t.DistanceSquared = function(e, t) {
                    var r = e.x - t.x
                      , i = e.y - t.y;
                    return r * r + i * i
                }
                ,
                t.Center = function(e, t) {
                    var r = e.add(t);
                    return r.scaleInPlace(.5),
                    r
                }
                ,
                t.DistanceOfPointFromSegment = function(e, r, i) {
                    var n = t.DistanceSquared(r, i);
                    if (0 === n)
                        return t.Distance(e, r);
                    var o = i.subtract(r)
                      , a = Math.max(0, Math.min(1, t.Dot(e.subtract(r), o) / n))
                      , s = r.add(o.multiplyByFloats(a, a));
                    return t.Distance(e, s)
                }
                ,
                t
            }();
            e.Vector2 = i;
            var n = function() {
                function t(e, t, r) {
                    void 0 === e && (e = 0),
                    void 0 === t && (t = 0),
                    void 0 === r && (r = 0),
                    this.x = e,
                    this.y = t,
                    this.z = r
                }
                return t.prototype.toString = function() {
                    return "{X: " + this.x + " Y:" + this.y + " Z:" + this.z + "}"
                }
                ,
                t.prototype.getClassName = function() {
                    return "Vector3"
                }
                ,
                t.prototype.getHashCode = function() {
                    var e = this.x || 0;
                    return e = 397 * (e = 397 * e ^ (this.y || 0)) ^ (this.z || 0)
                }
                ,
                t.prototype.asArray = function() {
                    var e = [];
                    return this.toArray(e, 0),
                    e
                }
                ,
                t.prototype.toArray = function(e, t) {
                    return void 0 === t && (t = 0),
                    e[t] = this.x,
                    e[t + 1] = this.y,
                    e[t + 2] = this.z,
                    this
                }
                ,
                t.prototype.toQuaternion = function() {
                    return e.Quaternion.RotationYawPitchRoll(this.x, this.y, this.z)
                }
                ,
                t.prototype.addInPlace = function(e) {
                    return this.x += e.x,
                    this.y += e.y,
                    this.z += e.z,
                    this
                }
                ,
                t.prototype.add = function(e) {
                    return new t(this.x + e.x,this.y + e.y,this.z + e.z)
                }
                ,
                t.prototype.addToRef = function(e, t) {
                    return t.x = this.x + e.x,
                    t.y = this.y + e.y,
                    t.z = this.z + e.z,
                    this
                }
                ,
                t.prototype.subtractInPlace = function(e) {
                    return this.x -= e.x,
                    this.y -= e.y,
                    this.z -= e.z,
                    this
                }
                ,
                t.prototype.subtract = function(e) {
                    return new t(this.x - e.x,this.y - e.y,this.z - e.z)
                }
                ,
                t.prototype.subtractToRef = function(e, t) {
                    return t.x = this.x - e.x,
                    t.y = this.y - e.y,
                    t.z = this.z - e.z,
                    this
                }
                ,
                t.prototype.subtractFromFloats = function(e, r, i) {
                    return new t(this.x - e,this.y - r,this.z - i)
                }
                ,
                t.prototype.subtractFromFloatsToRef = function(e, t, r, i) {
                    return i.x = this.x - e,
                    i.y = this.y - t,
                    i.z = this.z - r,
                    this
                }
                ,
                t.prototype.negate = function() {
                    return new t(-this.x,-this.y,-this.z)
                }
                ,
                t.prototype.scaleInPlace = function(e) {
                    return this.x *= e,
                    this.y *= e,
                    this.z *= e,
                    this
                }
                ,
                t.prototype.scale = function(e) {
                    return new t(this.x * e,this.y * e,this.z * e)
                }
                ,
                t.prototype.scaleToRef = function(e, t) {
                    return t.x = this.x * e,
                    t.y = this.y * e,
                    t.z = this.z * e,
                    this
                }
                ,
                t.prototype.scaleAndAddToRef = function(e, t) {
                    return t.x += this.x * e,
                    t.y += this.y * e,
                    t.z += this.z * e,
                    this
                }
                ,
                t.prototype.equals = function(e) {
                    return e && this.x === e.x && this.y === e.y && this.z === e.z
                }
                ,
                t.prototype.equalsWithEpsilon = function(t, r) {
                    return void 0 === r && (r = e.Epsilon),
                    t && e.Scalar.WithinEpsilon(this.x, t.x, r) && e.Scalar.WithinEpsilon(this.y, t.y, r) && e.Scalar.WithinEpsilon(this.z, t.z, r)
                }
                ,
                t.prototype.equalsToFloats = function(e, t, r) {
                    return this.x === e && this.y === t && this.z === r
                }
                ,
                t.prototype.multiplyInPlace = function(e) {
                    return this.x *= e.x,
                    this.y *= e.y,
                    this.z *= e.z,
                    this
                }
                ,
                t.prototype.multiply = function(e) {
                    return new t(this.x * e.x,this.y * e.y,this.z * e.z)
                }
                ,
                t.prototype.multiplyToRef = function(e, t) {
                    return t.x = this.x * e.x,
                    t.y = this.y * e.y,
                    t.z = this.z * e.z,
                    this
                }
                ,
                t.prototype.multiplyByFloats = function(e, r, i) {
                    return new t(this.x * e,this.y * r,this.z * i)
                }
                ,
                t.prototype.divide = function(e) {
                    return new t(this.x / e.x,this.y / e.y,this.z / e.z)
                }
                ,
                t.prototype.divideToRef = function(e, t) {
                    return t.x = this.x / e.x,
                    t.y = this.y / e.y,
                    t.z = this.z / e.z,
                    this
                }
                ,
                t.prototype.divideInPlace = function(e) {
                    return this.divideToRef(e, this)
                }
                ,
                t.prototype.minimizeInPlace = function(e) {
                    return this.minimizeInPlaceFromFloats(e.x, e.y, e.z)
                }
                ,
                t.prototype.maximizeInPlace = function(e) {
                    return this.maximizeInPlaceFromFloats(e.x, e.y, e.z)
                }
                ,
                t.prototype.minimizeInPlaceFromFloats = function(e, t, r) {
                    return e < this.x && (this.x = e),
                    t < this.y && (this.y = t),
                    r < this.z && (this.z = r),
                    this
                }
                ,
                t.prototype.maximizeInPlaceFromFloats = function(e, t, r) {
                    return e > this.x && (this.x = e),
                    t > this.y && (this.y = t),
                    r > this.z && (this.z = r),
                    this
                }
                ,
                Object.defineProperty(t.prototype, "isNonUniform", {
                    get: function() {
                        var e = Math.abs(this.x)
                          , t = Math.abs(this.y);
                        if (e !== t)
                            return !0;
                        var r = Math.abs(this.z);
                        return e !== r || t !== r
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.floor = function() {
                    return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))
                }
                ,
                t.prototype.fract = function() {
                    return new t(this.x - Math.floor(this.x),this.y - Math.floor(this.y),this.z - Math.floor(this.z))
                }
                ,
                t.prototype.length = function() {
                    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z)
                }
                ,
                t.prototype.lengthSquared = function() {
                    return this.x * this.x + this.y * this.y + this.z * this.z
                }
                ,
                t.prototype.normalize = function() {
                    var e = this.length();
                    if (0 === e || 1 === e)
                        return this;
                    var t = 1 / e;
                    return this.x *= t,
                    this.y *= t,
                    this.z *= t,
                    this
                }
                ,
                t.prototype.normalizeToNew = function() {
                    var e = new t(0,0,0);
                    return this.normalizeToRef(e),
                    e
                }
                ,
                t.prototype.normalizeToRef = function(e) {
                    var t = this.length();
                    if (0 === t || 1 === t)
                        return e.set(this.x, this.y, this.z),
                        e;
                    var r = 1 / t;
                    return this.scaleToRef(r, e),
                    e
                }
                ,
                t.prototype.clone = function() {
                    return new t(this.x,this.y,this.z)
                }
                ,
                t.prototype.copyFrom = function(e) {
                    return this.x = e.x,
                    this.y = e.y,
                    this.z = e.z,
                    this
                }
                ,
                t.prototype.copyFromFloats = function(e, t, r) {
                    return this.x = e,
                    this.y = t,
                    this.z = r,
                    this
                }
                ,
                t.prototype.set = function(e, t, r) {
                    return this.copyFromFloats(e, t, r)
                }
                ,
                t.GetClipFactor = function(e, r, i, n) {
                    var o = t.Dot(e, i) - n;
                    return o / (o - (t.Dot(r, i) - n))
                }
                ,
                t.GetAngleBetweenVectors = function(e, r, i) {
                    var n = T.Vector3[1].copyFrom(e).normalize()
                      , o = T.Vector3[2].copyFrom(r).normalize()
                      , a = t.Dot(n, o)
                      , s = T.Vector3[3];
                    return t.CrossToRef(n, o, s),
                    t.Dot(s, i) > 0 ? Math.acos(a) : -Math.acos(a)
                }
                ,
                t.FromArray = function(e, r) {
                    return r || (r = 0),
                    new t(e[r],e[r + 1],e[r + 2])
                }
                ,
                t.FromFloatArray = function(e, r) {
                    return t.FromArray(e, r)
                }
                ,
                t.FromArrayToRef = function(e, t, r) {
                    r.x = e[t],
                    r.y = e[t + 1],
                    r.z = e[t + 2]
                }
                ,
                t.FromFloatArrayToRef = function(e, r, i) {
                    return t.FromArrayToRef(e, r, i)
                }
                ,
                t.FromFloatsToRef = function(e, t, r, i) {
                    i.x = e,
                    i.y = t,
                    i.z = r
                }
                ,
                t.Zero = function() {
                    return new t(0,0,0)
                }
                ,
                t.One = function() {
                    return new t(1,1,1)
                }
                ,
                t.Up = function() {
                    return new t(0,1,0)
                }
                ,
                t.Down = function() {
                    return new t(0,-1,0)
                }
                ,
                t.Forward = function() {
                    return new t(0,0,1)
                }
                ,
                t.Backward = function() {
                    return new t(0,0,-1)
                }
                ,
                t.Right = function() {
                    return new t(1,0,0)
                }
                ,
                t.Left = function() {
                    return new t(-1,0,0)
                }
                ,
                t.TransformCoordinates = function(e, r) {
                    var i = t.Zero();
                    return t.TransformCoordinatesToRef(e, r, i),
                    i
                }
                ,
                t.TransformCoordinatesToRef = function(e, t, r) {
                    var i = e.x * t.m[0] + e.y * t.m[4] + e.z * t.m[8] + t.m[12]
                      , n = e.x * t.m[1] + e.y * t.m[5] + e.z * t.m[9] + t.m[13]
                      , o = e.x * t.m[2] + e.y * t.m[6] + e.z * t.m[10] + t.m[14]
                      , a = e.x * t.m[3] + e.y * t.m[7] + e.z * t.m[11] + t.m[15];
                    r.x = i / a,
                    r.y = n / a,
                    r.z = o / a
                }
                ,
                t.TransformCoordinatesFromFloatsToRef = function(e, t, r, i, n) {
                    var o = e * i.m[0] + t * i.m[4] + r * i.m[8] + i.m[12]
                      , a = e * i.m[1] + t * i.m[5] + r * i.m[9] + i.m[13]
                      , s = e * i.m[2] + t * i.m[6] + r * i.m[10] + i.m[14]
                      , y = e * i.m[3] + t * i.m[7] + r * i.m[11] + i.m[15];
                    n.x = o / y,
                    n.y = a / y,
                    n.z = s / y
                }
                ,
                t.TransformNormal = function(e, r) {
                    var i = t.Zero();
                    return t.TransformNormalToRef(e, r, i),
                    i
                }
                ,
                t.TransformNormalToRef = function(e, t, r) {
                    var i = e.x * t.m[0] + e.y * t.m[4] + e.z * t.m[8]
                      , n = e.x * t.m[1] + e.y * t.m[5] + e.z * t.m[9]
                      , o = e.x * t.m[2] + e.y * t.m[6] + e.z * t.m[10];
                    r.x = i,
                    r.y = n,
                    r.z = o
                }
                ,
                t.TransformNormalFromFloatsToRef = function(e, t, r, i, n) {
                    n.x = e * i.m[0] + t * i.m[4] + r * i.m[8],
                    n.y = e * i.m[1] + t * i.m[5] + r * i.m[9],
                    n.z = e * i.m[2] + t * i.m[6] + r * i.m[10]
                }
                ,
                t.CatmullRom = function(e, r, i, n, o) {
                    var a = o * o
                      , s = o * a;
                    return new t(.5 * (2 * r.x + (-e.x + i.x) * o + (2 * e.x - 5 * r.x + 4 * i.x - n.x) * a + (-e.x + 3 * r.x - 3 * i.x + n.x) * s),.5 * (2 * r.y + (-e.y + i.y) * o + (2 * e.y - 5 * r.y + 4 * i.y - n.y) * a + (-e.y + 3 * r.y - 3 * i.y + n.y) * s),.5 * (2 * r.z + (-e.z + i.z) * o + (2 * e.z - 5 * r.z + 4 * i.z - n.z) * a + (-e.z + 3 * r.z - 3 * i.z + n.z) * s))
                }
                ,
                t.Clamp = function(e, r, i) {
                    var n = e.x;
                    n = (n = n > i.x ? i.x : n) < r.x ? r.x : n;
                    var o = e.y;
                    o = (o = o > i.y ? i.y : o) < r.y ? r.y : o;
                    var a = e.z;
                    return new t(n,o,a = (a = a > i.z ? i.z : a) < r.z ? r.z : a)
                }
                ,
                t.Hermite = function(e, r, i, n, o) {
                    var a = o * o
                      , s = o * a
                      , y = 2 * s - 3 * a + 1
                      , l = -2 * s + 3 * a
                      , c = s - 2 * a + o
                      , h = s - a;
                    return new t(e.x * y + i.x * l + r.x * c + n.x * h,e.y * y + i.y * l + r.y * c + n.y * h,e.z * y + i.z * l + r.z * c + n.z * h)
                }
                ,
                t.Lerp = function(e, r, i) {
                    var n = new t(0,0,0);
                    return t.LerpToRef(e, r, i, n),
                    n
                }
                ,
                t.LerpToRef = function(e, t, r, i) {
                    i.x = e.x + (t.x - e.x) * r,
                    i.y = e.y + (t.y - e.y) * r,
                    i.z = e.z + (t.z - e.z) * r
                }
                ,
                t.Dot = function(e, t) {
                    return e.x * t.x + e.y * t.y + e.z * t.z
                }
                ,
                t.Cross = function(e, r) {
                    var i = t.Zero();
                    return t.CrossToRef(e, r, i),
                    i
                }
                ,
                t.CrossToRef = function(e, t, r) {
                    T.Vector3[0].x = e.y * t.z - e.z * t.y,
                    T.Vector3[0].y = e.z * t.x - e.x * t.z,
                    T.Vector3[0].z = e.x * t.y - e.y * t.x,
                    r.copyFrom(T.Vector3[0])
                }
                ,
                t.Normalize = function(e) {
                    var r = t.Zero();
                    return t.NormalizeToRef(e, r),
                    r
                }
                ,
                t.NormalizeToRef = function(e, t) {
                    t.copyFrom(e),
                    t.normalize()
                }
                ,
                t.Project = function(e, r, i, n) {
                    var o = n.width
                      , a = n.height
                      , s = n.x
                      , l = n.y
                      , c = t._viewportMatrixCache ? t._viewportMatrixCache : t._viewportMatrixCache = new y;
                    y.FromValuesToRef(o / 2, 0, 0, 0, 0, -a / 2, 0, 0, 0, 0, .5, 0, s + o / 2, a / 2 + l, .5, 1, c);
                    var h = T.Matrix[0];
                    return r.multiplyToRef(i, h),
                    h.multiplyToRef(c, h),
                    t.TransformCoordinates(e, h)
                }
                ,
                t.UnprojectFromTransform = function(r, i, n, o, a) {
                    var s = T.Matrix[0];
                    o.multiplyToRef(a, s),
                    s.invert(),
                    r.x = r.x / i * 2 - 1,
                    r.y = -(r.y / n * 2 - 1);
                    var y = t.TransformCoordinates(r, s)
                      , l = r.x * s.m[3] + r.y * s.m[7] + r.z * s.m[11] + s.m[15];
                    return e.Scalar.WithinEpsilon(l, 1) && (y = y.scale(1 / l)),
                    y
                }
                ,
                t.Unproject = function(e, r, i, n, o, a) {
                    var s = t.Zero();
                    return t.UnprojectToRef(e, r, i, n, o, a, s),
                    s
                }
                ,
                t.UnprojectToRef = function(e, r, i, n, o, a, s) {
                    t.UnprojectFloatsToRef(e.x, e.y, e.z, r, i, n, o, a, s)
                }
                ,
                t.UnprojectFloatsToRef = function(r, i, n, o, a, s, y, l, c) {
                    var h = T.Matrix[0];
                    s.multiplyToRef(y, h),
                    h.multiplyToRef(l, h),
                    h.invert();
                    var u = T.Vector3[0];
                    u.x = r / o * 2 - 1,
                    u.y = -(i / a * 2 - 1),
                    u.z = 2 * n - 1,
                    t.TransformCoordinatesToRef(u, h, c);
                    var d = u.x * h.m[3] + u.y * h.m[7] + u.z * h.m[11] + h.m[15];
                    e.Scalar.WithinEpsilon(d, 1) && c.scaleInPlace(1 / d)
                }
                ,
                t.Minimize = function(e, t) {
                    var r = e.clone();
                    return r.minimizeInPlace(t),
                    r
                }
                ,
                t.Maximize = function(e, t) {
                    var r = e.clone();
                    return r.maximizeInPlace(t),
                    r
                }
                ,
                t.Distance = function(e, r) {
                    return Math.sqrt(t.DistanceSquared(e, r))
                }
                ,
                t.DistanceSquared = function(e, t) {
                    var r = e.x - t.x
                      , i = e.y - t.y
                      , n = e.z - t.z;
                    return r * r + i * i + n * n
                }
                ,
                t.Center = function(e, t) {
                    var r = e.add(t);
                    return r.scaleInPlace(.5),
                    r
                }
                ,
                t.RotationFromAxis = function(e, r, i) {
                    var n = t.Zero();
                    return t.RotationFromAxisToRef(e, r, i, n),
                    n
                }
                ,
                t.RotationFromAxisToRef = function(e, t, r, i) {
                    var n = T.Quaternion[0];
                    s.RotationQuaternionFromAxisToRef(e, t, r, n),
                    n.toEulerAnglesToRef(i)
                }
                ,
                t
            }();
            e.Vector3 = n;
            var o = function() {
                function t(e, t, r, i) {
                    this.x = e,
                    this.y = t,
                    this.z = r,
                    this.w = i
                }
                return t.prototype.toString = function() {
                    return "{X: " + this.x + " Y:" + this.y + " Z:" + this.z + " W:" + this.w + "}"
                }
                ,
                t.prototype.getClassName = function() {
                    return "Vector4"
                }
                ,
                t.prototype.getHashCode = function() {
                    var e = this.x || 0;
                    return e = 397 * (e = 397 * (e = 397 * e ^ (this.y || 0)) ^ (this.z || 0)) ^ (this.w || 0)
                }
                ,
                t.prototype.asArray = function() {
                    var e = new Array;
                    return this.toArray(e, 0),
                    e
                }
                ,
                t.prototype.toArray = function(e, t) {
                    return void 0 === t && (t = 0),
                    e[t] = this.x,
                    e[t + 1] = this.y,
                    e[t + 2] = this.z,
                    e[t + 3] = this.w,
                    this
                }
                ,
                t.prototype.addInPlace = function(e) {
                    return this.x += e.x,
                    this.y += e.y,
                    this.z += e.z,
                    this.w += e.w,
                    this
                }
                ,
                t.prototype.add = function(e) {
                    return new t(this.x + e.x,this.y + e.y,this.z + e.z,this.w + e.w)
                }
                ,
                t.prototype.addToRef = function(e, t) {
                    return t.x = this.x + e.x,
                    t.y = this.y + e.y,
                    t.z = this.z + e.z,
                    t.w = this.w + e.w,
                    this
                }
                ,
                t.prototype.subtractInPlace = function(e) {
                    return this.x -= e.x,
                    this.y -= e.y,
                    this.z -= e.z,
                    this.w -= e.w,
                    this
                }
                ,
                t.prototype.subtract = function(e) {
                    return new t(this.x - e.x,this.y - e.y,this.z - e.z,this.w - e.w)
                }
                ,
                t.prototype.subtractToRef = function(e, t) {
                    return t.x = this.x - e.x,
                    t.y = this.y - e.y,
                    t.z = this.z - e.z,
                    t.w = this.w - e.w,
                    this
                }
                ,
                t.prototype.subtractFromFloats = function(e, r, i, n) {
                    return new t(this.x - e,this.y - r,this.z - i,this.w - n)
                }
                ,
                t.prototype.subtractFromFloatsToRef = function(e, t, r, i, n) {
                    return n.x = this.x - e,
                    n.y = this.y - t,
                    n.z = this.z - r,
                    n.w = this.w - i,
                    this
                }
                ,
                t.prototype.negate = function() {
                    return new t(-this.x,-this.y,-this.z,-this.w)
                }
                ,
                t.prototype.scaleInPlace = function(e) {
                    return this.x *= e,
                    this.y *= e,
                    this.z *= e,
                    this.w *= e,
                    this
                }
                ,
                t.prototype.scale = function(e) {
                    return new t(this.x * e,this.y * e,this.z * e,this.w * e)
                }
                ,
                t.prototype.scaleToRef = function(e, t) {
                    return t.x = this.x * e,
                    t.y = this.y * e,
                    t.z = this.z * e,
                    t.w = this.w * e,
                    this
                }
                ,
                t.prototype.scaleAndAddToRef = function(e, t) {
                    return t.x += this.x * e,
                    t.y += this.y * e,
                    t.z += this.z * e,
                    t.w += this.w * e,
                    this
                }
                ,
                t.prototype.equals = function(e) {
                    return e && this.x === e.x && this.y === e.y && this.z === e.z && this.w === e.w
                }
                ,
                t.prototype.equalsWithEpsilon = function(t, r) {
                    return void 0 === r && (r = e.Epsilon),
                    t && e.Scalar.WithinEpsilon(this.x, t.x, r) && e.Scalar.WithinEpsilon(this.y, t.y, r) && e.Scalar.WithinEpsilon(this.z, t.z, r) && e.Scalar.WithinEpsilon(this.w, t.w, r)
                }
                ,
                t.prototype.equalsToFloats = function(e, t, r, i) {
                    return this.x === e && this.y === t && this.z === r && this.w === i
                }
                ,
                t.prototype.multiplyInPlace = function(e) {
                    return this.x *= e.x,
                    this.y *= e.y,
                    this.z *= e.z,
                    this.w *= e.w,
                    this
                }
                ,
                t.prototype.multiply = function(e) {
                    return new t(this.x * e.x,this.y * e.y,this.z * e.z,this.w * e.w)
                }
                ,
                t.prototype.multiplyToRef = function(e, t) {
                    return t.x = this.x * e.x,
                    t.y = this.y * e.y,
                    t.z = this.z * e.z,
                    t.w = this.w * e.w,
                    this
                }
                ,
                t.prototype.multiplyByFloats = function(e, r, i, n) {
                    return new t(this.x * e,this.y * r,this.z * i,this.w * n)
                }
                ,
                t.prototype.divide = function(e) {
                    return new t(this.x / e.x,this.y / e.y,this.z / e.z,this.w / e.w)
                }
                ,
                t.prototype.divideToRef = function(e, t) {
                    return t.x = this.x / e.x,
                    t.y = this.y / e.y,
                    t.z = this.z / e.z,
                    t.w = this.w / e.w,
                    this
                }
                ,
                t.prototype.divideInPlace = function(e) {
                    return this.divideToRef(e, this)
                }
                ,
                t.prototype.minimizeInPlace = function(e) {
                    return e.x < this.x && (this.x = e.x),
                    e.y < this.y && (this.y = e.y),
                    e.z < this.z && (this.z = e.z),
                    e.w < this.w && (this.w = e.w),
                    this
                }
                ,
                t.prototype.maximizeInPlace = function(e) {
                    return e.x > this.x && (this.x = e.x),
                    e.y > this.y && (this.y = e.y),
                    e.z > this.z && (this.z = e.z),
                    e.w > this.w && (this.w = e.w),
                    this
                }
                ,
                t.prototype.floor = function() {
                    return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))
                }
                ,
                t.prototype.fract = function() {
                    return new t(this.x - Math.floor(this.x),this.y - Math.floor(this.y),this.z - Math.floor(this.z),this.w - Math.floor(this.w))
                }
                ,
                t.prototype.length = function() {
                    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)
                }
                ,
                t.prototype.lengthSquared = function() {
                    return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w
                }
                ,
                t.prototype.normalize = function() {
                    var e = this.length();
                    if (0 === e)
                        return this;
                    var t = 1 / e;
                    return this.x *= t,
                    this.y *= t,
                    this.z *= t,
                    this.w *= t,
                    this
                }
                ,
                t.prototype.toVector3 = function() {
                    return new n(this.x,this.y,this.z)
                }
                ,
                t.prototype.clone = function() {
                    return new t(this.x,this.y,this.z,this.w)
                }
                ,
                t.prototype.copyFrom = function(e) {
                    return this.x = e.x,
                    this.y = e.y,
                    this.z = e.z,
                    this.w = e.w,
                    this
                }
                ,
                t.prototype.copyFromFloats = function(e, t, r, i) {
                    return this.x = e,
                    this.y = t,
                    this.z = r,
                    this.w = i,
                    this
                }
                ,
                t.prototype.set = function(e, t, r, i) {
                    return this.copyFromFloats(e, t, r, i)
                }
                ,
                t.FromArray = function(e, r) {
                    return r || (r = 0),
                    new t(e[r],e[r + 1],e[r + 2],e[r + 3])
                }
                ,
                t.FromArrayToRef = function(e, t, r) {
                    r.x = e[t],
                    r.y = e[t + 1],
                    r.z = e[t + 2],
                    r.w = e[t + 3]
                }
                ,
                t.FromFloatArrayToRef = function(e, r, i) {
                    t.FromArrayToRef(e, r, i)
                }
                ,
                t.FromFloatsToRef = function(e, t, r, i, n) {
                    n.x = e,
                    n.y = t,
                    n.z = r,
                    n.w = i
                }
                ,
                t.Zero = function() {
                    return new t(0,0,0,0)
                }
                ,
                t.One = function() {
                    return new t(1,1,1,1)
                }
                ,
                t.Normalize = function(e) {
                    var r = t.Zero();
                    return t.NormalizeToRef(e, r),
                    r
                }
                ,
                t.NormalizeToRef = function(e, t) {
                    t.copyFrom(e),
                    t.normalize()
                }
                ,
                t.Minimize = function(e, t) {
                    var r = e.clone();
                    return r.minimizeInPlace(t),
                    r
                }
                ,
                t.Maximize = function(e, t) {
                    var r = e.clone();
                    return r.maximizeInPlace(t),
                    r
                }
                ,
                t.Distance = function(e, r) {
                    return Math.sqrt(t.DistanceSquared(e, r))
                }
                ,
                t.DistanceSquared = function(e, t) {
                    var r = e.x - t.x
                      , i = e.y - t.y
                      , n = e.z - t.z
                      , o = e.w - t.w;
                    return r * r + i * i + n * n + o * o
                }
                ,
                t.Center = function(e, t) {
                    var r = e.add(t);
                    return r.scaleInPlace(.5),
                    r
                }
                ,
                t.TransformNormal = function(e, r) {
                    var i = t.Zero();
                    return t.TransformNormalToRef(e, r, i),
                    i
                }
                ,
                t.TransformNormalToRef = function(e, t, r) {
                    var i = e.x * t.m[0] + e.y * t.m[4] + e.z * t.m[8]
                      , n = e.x * t.m[1] + e.y * t.m[5] + e.z * t.m[9]
                      , o = e.x * t.m[2] + e.y * t.m[6] + e.z * t.m[10];
                    r.x = i,
                    r.y = n,
                    r.z = o,
                    r.w = e.w
                }
                ,
                t.TransformNormalFromFloatsToRef = function(e, t, r, i, n, o) {
                    o.x = e * n.m[0] + t * n.m[4] + r * n.m[8],
                    o.y = e * n.m[1] + t * n.m[5] + r * n.m[9],
                    o.z = e * n.m[2] + t * n.m[6] + r * n.m[10],
                    o.w = i
                }
                ,
                t
            }();
            e.Vector4 = o;
            var a = function() {
                function e(e, t) {
                    this.width = e,
                    this.height = t
                }
                return e.prototype.toString = function() {
                    return "{W: " + this.width + ", H: " + this.height + "}"
                }
                ,
                e.prototype.getClassName = function() {
                    return "Size"
                }
                ,
                e.prototype.getHashCode = function() {
                    var e = this.width || 0;
                    return e = 397 * e ^ (this.height || 0)
                }
                ,
                e.prototype.copyFrom = function(e) {
                    this.width = e.width,
                    this.height = e.height
                }
                ,
                e.prototype.copyFromFloats = function(e, t) {
                    return this.width = e,
                    this.height = t,
                    this
                }
                ,
                e.prototype.set = function(e, t) {
                    return this.copyFromFloats(e, t)
                }
                ,
                e.prototype.multiplyByFloats = function(t, r) {
                    return new e(this.width * t,this.height * r)
                }
                ,
                e.prototype.clone = function() {
                    return new e(this.width,this.height)
                }
                ,
                e.prototype.equals = function(e) {
                    return !!e && (this.width === e.width && this.height === e.height)
                }
                ,
                Object.defineProperty(e.prototype, "surface", {
                    get: function() {
                        return this.width * this.height
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.Zero = function() {
                    return new e(0,0)
                }
                ,
                e.prototype.add = function(t) {
                    return new e(this.width + t.width,this.height + t.height)
                }
                ,
                e.prototype.subtract = function(t) {
                    return new e(this.width - t.width,this.height - t.height)
                }
                ,
                e.Lerp = function(t, r, i) {
                    return new e(t.width + (r.width - t.width) * i,t.height + (r.height - t.height) * i)
                }
                ,
                e
            }();
            e.Size = a;
            var s = function() {
                function e(e, t, r, i) {
                    void 0 === e && (e = 0),
                    void 0 === t && (t = 0),
                    void 0 === r && (r = 0),
                    void 0 === i && (i = 1),
                    this.x = e,
                    this.y = t,
                    this.z = r,
                    this.w = i
                }
                return e.prototype.toString = function() {
                    return "{X: " + this.x + " Y:" + this.y + " Z:" + this.z + " W:" + this.w + "}"
                }
                ,
                e.prototype.getClassName = function() {
                    return "Quaternion"
                }
                ,
                e.prototype.getHashCode = function() {
                    var e = this.x || 0;
                    return e = 397 * (e = 397 * (e = 397 * e ^ (this.y || 0)) ^ (this.z || 0)) ^ (this.w || 0)
                }
                ,
                e.prototype.asArray = function() {
                    return [this.x, this.y, this.z, this.w]
                }
                ,
                e.prototype.equals = function(e) {
                    return e && this.x === e.x && this.y === e.y && this.z === e.z && this.w === e.w
                }
                ,
                e.prototype.clone = function() {
                    return new e(this.x,this.y,this.z,this.w)
                }
                ,
                e.prototype.copyFrom = function(e) {
                    return this.x = e.x,
                    this.y = e.y,
                    this.z = e.z,
                    this.w = e.w,
                    this
                }
                ,
                e.prototype.copyFromFloats = function(e, t, r, i) {
                    return this.x = e,
                    this.y = t,
                    this.z = r,
                    this.w = i,
                    this
                }
                ,
                e.prototype.set = function(e, t, r, i) {
                    return this.copyFromFloats(e, t, r, i)
                }
                ,
                e.prototype.add = function(t) {
                    return new e(this.x + t.x,this.y + t.y,this.z + t.z,this.w + t.w)
                }
                ,
                e.prototype.addInPlace = function(e) {
                    return this.x += e.x,
                    this.y += e.y,
                    this.z += e.z,
                    this.w += e.w,
                    this
                }
                ,
                e.prototype.subtract = function(t) {
                    return new e(this.x - t.x,this.y - t.y,this.z - t.z,this.w - t.w)
                }
                ,
                e.prototype.scale = function(t) {
                    return new e(this.x * t,this.y * t,this.z * t,this.w * t)
                }
                ,
                e.prototype.scaleToRef = function(e, t) {
                    return t.x = this.x * e,
                    t.y = this.y * e,
                    t.z = this.z * e,
                    t.w = this.w * e,
                    this
                }
                ,
                e.prototype.scaleInPlace = function(e) {
                    return this.x *= e,
                    this.y *= e,
                    this.z *= e,
                    this.w *= e,
                    this
                }
                ,
                e.prototype.scaleAndAddToRef = function(e, t) {
                    return t.x += this.x * e,
                    t.y += this.y * e,
                    t.z += this.z * e,
                    t.w += this.w * e,
                    this
                }
                ,
                e.prototype.multiply = function(t) {
                    var r = new e(0,0,0,1);
                    return this.multiplyToRef(t, r),
                    r
                }
                ,
                e.prototype.multiplyToRef = function(e, t) {
                    var r = this.x * e.w + this.y * e.z - this.z * e.y + this.w * e.x
                      , i = -this.x * e.z + this.y * e.w + this.z * e.x + this.w * e.y
                      , n = this.x * e.y - this.y * e.x + this.z * e.w + this.w * e.z
                      , o = -this.x * e.x - this.y * e.y - this.z * e.z + this.w * e.w;
                    return t.copyFromFloats(r, i, n, o),
                    this
                }
                ,
                e.prototype.multiplyInPlace = function(e) {
                    return this.multiplyToRef(e, this),
                    this
                }
                ,
                e.prototype.conjugateToRef = function(e) {
                    return e.copyFromFloats(-this.x, -this.y, -this.z, this.w),
                    this
                }
                ,
                e.prototype.conjugateInPlace = function() {
                    return this.x *= -1,
                    this.y *= -1,
                    this.z *= -1,
                    this
                }
                ,
                e.prototype.conjugate = function() {
                    return new e(-this.x,-this.y,-this.z,this.w)
                }
                ,
                e.prototype.length = function() {
                    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)
                }
                ,
                e.prototype.normalize = function() {
                    var e = 1 / this.length();
                    return this.x *= e,
                    this.y *= e,
                    this.z *= e,
                    this.w *= e,
                    this
                }
                ,
                e.prototype.toEulerAngles = function(e) {
                    void 0 === e && (e = "YZX");
                    var t = n.Zero();
                    return this.toEulerAnglesToRef(t, e),
                    t
                }
                ,
                e.prototype.toEulerAnglesToRef = function(e, t) {
                    void 0 === t && (t = "YZX");
                    var r = this.z
                      , i = this.x
                      , n = this.y
                      , o = this.w
                      , a = o * o
                      , s = r * r
                      , y = i * i
                      , l = n * n
                      , c = n * r - i * o;
                    return c < -.4999999 ? (e.y = 2 * Math.atan2(n, o),
                    e.x = Math.PI / 2,
                    e.z = 0) : c > .4999999 ? (e.y = 2 * Math.atan2(n, o),
                    e.x = -Math.PI / 2,
                    e.z = 0) : (e.z = Math.atan2(2 * (i * n + r * o), -s - y + l + a),
                    e.x = Math.asin(-2 * (r * n - i * o)),
                    e.y = Math.atan2(2 * (r * i + n * o), s - y - l + a)),
                    this
                }
                ,
                e.prototype.toRotationMatrix = function(e) {
                    var t = this.x * this.x
                      , r = this.y * this.y
                      , i = this.z * this.z
                      , n = this.x * this.y
                      , o = this.z * this.w
                      , a = this.z * this.x
                      , s = this.y * this.w
                      , y = this.y * this.z
                      , l = this.x * this.w;
                    return e.m[0] = 1 - 2 * (r + i),
                    e.m[1] = 2 * (n + o),
                    e.m[2] = 2 * (a - s),
                    e.m[3] = 0,
                    e.m[4] = 2 * (n - o),
                    e.m[5] = 1 - 2 * (i + t),
                    e.m[6] = 2 * (y + l),
                    e.m[7] = 0,
                    e.m[8] = 2 * (a + s),
                    e.m[9] = 2 * (y - l),
                    e.m[10] = 1 - 2 * (r + t),
                    e.m[11] = 0,
                    e.m[12] = 0,
                    e.m[13] = 0,
                    e.m[14] = 0,
                    e.m[15] = 1,
                    e._markAsUpdated(),
                    this
                }
                ,
                e.prototype.fromRotationMatrix = function(t) {
                    return e.FromRotationMatrixToRef(t, this),
                    this
                }
                ,
                e.FromRotationMatrix = function(t) {
                    var r = new e;
                    return e.FromRotationMatrixToRef(t, r),
                    r
                }
                ,
                e.FromRotationMatrixToRef = function(e, t) {
                    var r, i = e.m, n = i[0], o = i[4], a = i[8], s = i[1], y = i[5], l = i[9], c = i[2], h = i[6], u = i[10], d = n + y + u;
                    d > 0 ? (r = .5 / Math.sqrt(d + 1),
                    t.w = .25 / r,
                    t.x = (h - l) * r,
                    t.y = (a - c) * r,
                    t.z = (s - o) * r) : n > y && n > u ? (r = 2 * Math.sqrt(1 + n - y - u),
                    t.w = (h - l) / r,
                    t.x = .25 * r,
                    t.y = (o + s) / r,
                    t.z = (a + c) / r) : y > u ? (r = 2 * Math.sqrt(1 + y - n - u),
                    t.w = (a - c) / r,
                    t.x = (o + s) / r,
                    t.y = .25 * r,
                    t.z = (l + h) / r) : (r = 2 * Math.sqrt(1 + u - n - y),
                    t.w = (s - o) / r,
                    t.x = (a + c) / r,
                    t.y = (l + h) / r,
                    t.z = .25 * r)
                }
                ,
                e.Dot = function(e, t) {
                    return e.x * t.x + e.y * t.y + e.z * t.z + e.w * t.w
                }
                ,
                e.AreClose = function(t, r) {
                    return e.Dot(t, r) >= 0
                }
                ,
                e.Zero = function() {
                    return new e(0,0,0,0)
                }
                ,
                e.Inverse = function(t) {
                    return new e(-t.x,-t.y,-t.z,t.w)
                }
                ,
                e.Identity = function() {
                    return new e(0,0,0,1)
                }
                ,
                e.IsIdentity = function(e) {
                    return e && 0 === e.x && 0 === e.y && 0 === e.z && 1 === e.w
                }
                ,
                e.RotationAxis = function(t, r) {
                    return e.RotationAxisToRef(t, r, new e)
                }
                ,
                e.RotationAxisToRef = function(e, t, r) {
                    var i = Math.sin(t / 2);
                    return e.normalize(),
                    r.w = Math.cos(t / 2),
                    r.x = e.x * i,
                    r.y = e.y * i,
                    r.z = e.z * i,
                    r
                }
                ,
                e.FromArray = function(t, r) {
                    return r || (r = 0),
                    new e(t[r],t[r + 1],t[r + 2],t[r + 3])
                }
                ,
                e.RotationYawPitchRoll = function(t, r, i) {
                    var n = new e;
                    return e.RotationYawPitchRollToRef(t, r, i, n),
                    n
                }
                ,
                e.RotationYawPitchRollToRef = function(e, t, r, i) {
                    var n = .5 * r
                      , o = .5 * t
                      , a = .5 * e
                      , s = Math.sin(n)
                      , y = Math.cos(n)
                      , l = Math.sin(o)
                      , c = Math.cos(o)
                      , h = Math.sin(a)
                      , u = Math.cos(a);
                    i.x = u * l * y + h * c * s,
                    i.y = h * c * y - u * l * s,
                    i.z = u * c * s - h * l * y,
                    i.w = u * c * y + h * l * s
                }
                ,
                e.RotationAlphaBetaGamma = function(t, r, i) {
                    var n = new e;
                    return e.RotationAlphaBetaGammaToRef(t, r, i, n),
                    n
                }
                ,
                e.RotationAlphaBetaGammaToRef = function(e, t, r, i) {
                    var n = .5 * (r + e)
                      , o = .5 * (r - e)
                      , a = .5 * t;
                    i.x = Math.cos(o) * Math.sin(a),
                    i.y = Math.sin(o) * Math.sin(a),
                    i.z = Math.sin(n) * Math.cos(a),
                    i.w = Math.cos(n) * Math.cos(a)
                }
                ,
                e.RotationQuaternionFromAxis = function(t, r, i) {
                    var n = new e(0,0,0,0);
                    return e.RotationQuaternionFromAxisToRef(t, r, i, n),
                    n
                }
                ,
                e.RotationQuaternionFromAxisToRef = function(t, r, i, n) {
                    var o = T.Matrix[0];
                    y.FromXYZAxesToRef(t.normalize(), r.normalize(), i.normalize(), o),
                    e.FromRotationMatrixToRef(o, n)
                }
                ,
                e.Slerp = function(t, r, i) {
                    var n = e.Identity();
                    return e.SlerpToRef(t, r, i, n),
                    n
                }
                ,
                e.SlerpToRef = function(e, t, r, i) {
                    var n, o, a = e.x * t.x + e.y * t.y + e.z * t.z + e.w * t.w, s = !1;
                    if (a < 0 && (s = !0,
                    a = -a),
                    a > .999999)
                        o = 1 - r,
                        n = s ? -r : r;
                    else {
                        var y = Math.acos(a)
                          , l = 1 / Math.sin(y);
                        o = Math.sin((1 - r) * y) * l,
                        n = s ? -Math.sin(r * y) * l : Math.sin(r * y) * l
                    }
                    i.x = o * e.x + n * t.x,
                    i.y = o * e.y + n * t.y,
                    i.z = o * e.z + n * t.z,
                    i.w = o * e.w + n * t.w
                }
                ,
                e.Hermite = function(t, r, i, n, o) {
                    var a = o * o
                      , s = o * a
                      , y = 2 * s - 3 * a + 1
                      , l = -2 * s + 3 * a
                      , c = s - 2 * a + o
                      , h = s - a;
                    return new e(t.x * y + i.x * l + r.x * c + n.x * h,t.y * y + i.y * l + r.y * c + n.y * h,t.z * y + i.z * l + r.z * c + n.z * h,t.w * y + i.w * l + r.w * c + n.w * h)
                }
                ,
                e
            }();
            e.Quaternion = s;
            var y = function() {
                function e() {
                    this._isIdentity = !1,
                    this._isIdentityDirty = !0,
                    this.m = new Float32Array(16),
                    this._markAsUpdated()
                }
                return e.prototype._markAsUpdated = function() {
                    this.updateFlag = e._updateFlagSeed++,
                    this._isIdentityDirty = !0
                }
                ,
                e.prototype.isIdentity = function(e) {
                    return void 0 === e && (e = !1),
                    this._isIdentityDirty && (this._isIdentityDirty = !1,
                    1 !== this.m[0] || 1 !== this.m[5] || 1 !== this.m[15] ? this._isIdentity = !1 : 0 !== this.m[1] || 0 !== this.m[2] || 0 !== this.m[3] || 0 !== this.m[4] || 0 !== this.m[6] || 0 !== this.m[7] || 0 !== this.m[8] || 0 !== this.m[9] || 0 !== this.m[11] || 0 !== this.m[12] || 0 !== this.m[13] || 0 !== this.m[14] ? this._isIdentity = !1 : this._isIdentity = !0,
                    e || 1 === this.m[10] || (this._isIdentity = !1)),
                    this._isIdentity
                }
                ,
                e.prototype.determinant = function() {
                    var e = this.m[10] * this.m[15] - this.m[11] * this.m[14]
                      , t = this.m[9] * this.m[15] - this.m[11] * this.m[13]
                      , r = this.m[9] * this.m[14] - this.m[10] * this.m[13]
                      , i = this.m[8] * this.m[15] - this.m[11] * this.m[12]
                      , n = this.m[8] * this.m[14] - this.m[10] * this.m[12]
                      , o = this.m[8] * this.m[13] - this.m[9] * this.m[12];
                    return this.m[0] * (this.m[5] * e - this.m[6] * t + this.m[7] * r) - this.m[1] * (this.m[4] * e - this.m[6] * i + this.m[7] * n) + this.m[2] * (this.m[4] * t - this.m[5] * i + this.m[7] * o) - this.m[3] * (this.m[4] * r - this.m[5] * n + this.m[6] * o)
                }
                ,
                e.prototype.toArray = function() {
                    return this.m
                }
                ,
                e.prototype.asArray = function() {
                    return this.toArray()
                }
                ,
                e.prototype.invert = function() {
                    return this.invertToRef(this),
                    this
                }
                ,
                e.prototype.reset = function() {
                    for (var e = 0; e < 16; e++)
                        this.m[e] = 0;
                    return this._markAsUpdated(),
                    this
                }
                ,
                e.prototype.add = function(t) {
                    var r = new e;
                    return this.addToRef(t, r),
                    r
                }
                ,
                e.prototype.addToRef = function(e, t) {
                    for (var r = 0; r < 16; r++)
                        t.m[r] = this.m[r] + e.m[r];
                    return t._markAsUpdated(),
                    this
                }
                ,
                e.prototype.addToSelf = function(e) {
                    for (var t = 0; t < 16; t++)
                        this.m[t] += e.m[t];
                    return this._markAsUpdated(),
                    this
                }
                ,
                e.prototype.invertToRef = function(e) {
                    var t = this.m[0]
                      , r = this.m[1]
                      , i = this.m[2]
                      , n = this.m[3]
                      , o = this.m[4]
                      , a = this.m[5]
                      , s = this.m[6]
                      , y = this.m[7]
                      , l = this.m[8]
                      , c = this.m[9]
                      , h = this.m[10]
                      , u = this.m[11]
                      , d = this.m[12]
                      , x = this.m[13]
                      , p = this.m[14]
                      , f = this.m[15]
                      , m = h * f - u * p
                      , z = c * f - u * x
                      , _ = c * p - h * x
                      , g = l * f - u * d
                      , v = l * p - h * d
                      , b = l * x - c * d
                      , T = a * m - s * z + y * _
                      , E = -(o * m - s * g + y * v)
                      , P = o * z - a * g + y * b
                      , A = -(o * _ - a * v + s * b)
                      , S = 1 / (t * T + r * E + i * P + n * A)
                      , M = s * f - y * p
                      , C = a * f - y * x
                      , R = a * p - s * x
                      , O = o * f - y * d
                      , I = o * p - s * d
                      , w = o * x - a * d
                      , D = s * u - y * h
                      , L = a * u - y * c
                      , B = a * h - s * c
                      , F = o * u - y * l
                      , N = o * h - s * l
                      , V = o * c - a * l;
                    return e.m[0] = T * S,
                    e.m[4] = E * S,
                    e.m[8] = P * S,
                    e.m[12] = A * S,
                    e.m[1] = -(r * m - i * z + n * _) * S,
                    e.m[5] = (t * m - i * g + n * v) * S,
                    e.m[9] = -(t * z - r * g + n * b) * S,
                    e.m[13] = (t * _ - r * v + i * b) * S,
                    e.m[2] = (r * M - i * C + n * R) * S,
                    e.m[6] = -(t * M - i * O + n * I) * S,
                    e.m[10] = (t * C - r * O + n * w) * S,
                    e.m[14] = -(t * R - r * I + i * w) * S,
                    e.m[3] = -(r * D - i * L + n * B) * S,
                    e.m[7] = (t * D - i * F + n * N) * S,
                    e.m[11] = -(t * L - r * F + n * V) * S,
                    e.m[15] = (t * B - r * N + i * V) * S,
                    e._markAsUpdated(),
                    this
                }
                ,
                e.prototype.setTranslationFromFloats = function(e, t, r) {
                    return this.m[12] = e,
                    this.m[13] = t,
                    this.m[14] = r,
                    this._markAsUpdated(),
                    this
                }
                ,
                e.prototype.setTranslation = function(e) {
                    return this.m[12] = e.x,
                    this.m[13] = e.y,
                    this.m[14] = e.z,
                    this._markAsUpdated(),
                    this
                }
                ,
                e.prototype.getTranslation = function() {
                    return new n(this.m[12],this.m[13],this.m[14])
                }
                ,
                e.prototype.getTranslationToRef = function(e) {
                    return e.x = this.m[12],
                    e.y = this.m[13],
                    e.z = this.m[14],
                    this
                }
                ,
                e.prototype.removeRotationAndScaling = function() {
                    return this.setRowFromFloats(0, 1, 0, 0, 0),
                    this.setRowFromFloats(1, 0, 1, 0, 0),
                    this.setRowFromFloats(2, 0, 0, 1, 0),
                    this
                }
                ,
                e.prototype.multiply = function(t) {
                    var r = new e;
                    return this.multiplyToRef(t, r),
                    r
                }
                ,
                e.prototype.copyFrom = function(e) {
                    for (var t = 0; t < 16; t++)
                        this.m[t] = e.m[t];
                    return this._markAsUpdated(),
                    this
                }
                ,
                e.prototype.copyToArray = function(e, t) {
                    void 0 === t && (t = 0);
                    for (var r = 0; r < 16; r++)
                        e[t + r] = this.m[r];
                    return this
                }
                ,
                e.prototype.multiplyToRef = function(e, t) {
                    return this.multiplyToArray(e, t.m, 0),
                    t._markAsUpdated(),
                    this
                }
                ,
                e.prototype.multiplyToArray = function(e, t, r) {
                    var i = this.m[0]
                      , n = this.m[1]
                      , o = this.m[2]
                      , a = this.m[3]
                      , s = this.m[4]
                      , y = this.m[5]
                      , l = this.m[6]
                      , c = this.m[7]
                      , h = this.m[8]
                      , u = this.m[9]
                      , d = this.m[10]
                      , x = this.m[11]
                      , p = this.m[12]
                      , f = this.m[13]
                      , m = this.m[14]
                      , z = this.m[15]
                      , _ = e.m[0]
                      , g = e.m[1]
                      , v = e.m[2]
                      , b = e.m[3]
                      , T = e.m[4]
                      , E = e.m[5]
                      , P = e.m[6]
                      , A = e.m[7]
                      , S = e.m[8]
                      , M = e.m[9]
                      , C = e.m[10]
                      , R = e.m[11]
                      , O = e.m[12]
                      , I = e.m[13]
                      , w = e.m[14]
                      , D = e.m[15];
                    return t[r] = i * _ + n * T + o * S + a * O,
                    t[r + 1] = i * g + n * E + o * M + a * I,
                    t[r + 2] = i * v + n * P + o * C + a * w,
                    t[r + 3] = i * b + n * A + o * R + a * D,
                    t[r + 4] = s * _ + y * T + l * S + c * O,
                    t[r + 5] = s * g + y * E + l * M + c * I,
                    t[r + 6] = s * v + y * P + l * C + c * w,
                    t[r + 7] = s * b + y * A + l * R + c * D,
                    t[r + 8] = h * _ + u * T + d * S + x * O,
                    t[r + 9] = h * g + u * E + d * M + x * I,
                    t[r + 10] = h * v + u * P + d * C + x * w,
                    t[r + 11] = h * b + u * A + d * R + x * D,
                    t[r + 12] = p * _ + f * T + m * S + z * O,
                    t[r + 13] = p * g + f * E + m * M + z * I,
                    t[r + 14] = p * v + f * P + m * C + z * w,
                    t[r + 15] = p * b + f * A + m * R + z * D,
                    this
                }
                ,
                e.prototype.equals = function(e) {
                    return e && this.m[0] === e.m[0] && this.m[1] === e.m[1] && this.m[2] === e.m[2] && this.m[3] === e.m[3] && this.m[4] === e.m[4] && this.m[5] === e.m[5] && this.m[6] === e.m[6] && this.m[7] === e.m[7] && this.m[8] === e.m[8] && this.m[9] === e.m[9] && this.m[10] === e.m[10] && this.m[11] === e.m[11] && this.m[12] === e.m[12] && this.m[13] === e.m[13] && this.m[14] === e.m[14] && this.m[15] === e.m[15]
                }
                ,
                e.prototype.clone = function() {
                    return e.FromValues(this.m[0], this.m[1], this.m[2], this.m[3], this.m[4], this.m[5], this.m[6], this.m[7], this.m[8], this.m[9], this.m[10], this.m[11], this.m[12], this.m[13], this.m[14], this.m[15])
                }
                ,
                e.prototype.getClassName = function() {
                    return "Matrix"
                }
                ,
                e.prototype.getHashCode = function() {
                    for (var e = this.m[0] || 0, t = 1; t < 16; t++)
                        e = 397 * e ^ (this.m[t] || 0);
                    return e
                }
                ,
                e.prototype.decompose = function(t, r, i) {
                    return i && (i.x = this.m[12],
                    i.y = this.m[13],
                    i.z = this.m[14]),
                    (t = t || T.Vector3[0]).x = Math.sqrt(this.m[0] * this.m[0] + this.m[1] * this.m[1] + this.m[2] * this.m[2]),
                    t.y = Math.sqrt(this.m[4] * this.m[4] + this.m[5] * this.m[5] + this.m[6] * this.m[6]),
                    t.z = Math.sqrt(this.m[8] * this.m[8] + this.m[9] * this.m[9] + this.m[10] * this.m[10]),
                    this.determinant() <= 0 && (t.y *= -1),
                    0 === t.x || 0 === t.y || 0 === t.z ? (r && (r.x = 0,
                    r.y = 0,
                    r.z = 0,
                    r.w = 1),
                    !1) : (r && (e.FromValuesToRef(this.m[0] / t.x, this.m[1] / t.x, this.m[2] / t.x, 0, this.m[4] / t.y, this.m[5] / t.y, this.m[6] / t.y, 0, this.m[8] / t.z, this.m[9] / t.z, this.m[10] / t.z, 0, 0, 0, 0, 1, T.Matrix[0]),
                    s.FromRotationMatrixToRef(T.Matrix[0], r)),
                    !0)
                }
                ,
                e.prototype.getRow = function(e) {
                    if (e < 0 || e > 3)
                        return null;
                    var t = 4 * e;
                    return new o(this.m[t + 0],this.m[t + 1],this.m[t + 2],this.m[t + 3])
                }
                ,
                e.prototype.setRow = function(e, t) {
                    if (e < 0 || e > 3)
                        return this;
                    var r = 4 * e;
                    return this.m[r + 0] = t.x,
                    this.m[r + 1] = t.y,
                    this.m[r + 2] = t.z,
                    this.m[r + 3] = t.w,
                    this._markAsUpdated(),
                    this
                }
                ,
                e.prototype.transpose = function() {
                    return e.Transpose(this)
                }
                ,
                e.prototype.transposeToRef = function(t) {
                    return e.TransposeToRef(this, t),
                    this
                }
                ,
                e.prototype.setRowFromFloats = function(e, t, r, i, n) {
                    if (e < 0 || e > 3)
                        return this;
                    var o = 4 * e;
                    return this.m[o + 0] = t,
                    this.m[o + 1] = r,
                    this.m[o + 2] = i,
                    this.m[o + 3] = n,
                    this._markAsUpdated(),
                    this
                }
                ,
                e.prototype.scale = function(t) {
                    var r = new e;
                    return this.scaleToRef(t, r),
                    r
                }
                ,
                e.prototype.scaleToRef = function(e, t) {
                    for (var r = 0; r < 16; r++)
                        t.m[r] = this.m[r] * e;
                    return t._markAsUpdated(),
                    this
                }
                ,
                e.prototype.scaleAndAddToRef = function(e, t) {
                    for (var r = 0; r < 16; r++)
                        t.m[r] += this.m[r] * e;
                    return t._markAsUpdated(),
                    this
                }
                ,
                e.prototype.toNormalMatrix = function(t) {
                    this.invertToRef(t),
                    t.transpose();
                    var r = t.m;
                    e.FromValuesToRef(r[0], r[1], r[2], 0, r[4], r[5], r[6], 0, r[8], r[9], r[10], 0, 0, 0, 0, 1, t)
                }
                ,
                e.prototype.getRotationMatrix = function() {
                    var t = e.Identity();
                    return this.getRotationMatrixToRef(t),
                    t
                }
                ,
                e.prototype.getRotationMatrixToRef = function(t) {
                    var r = this.m
                      , i = Math.sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2])
                      , n = Math.sqrt(r[4] * r[4] + r[5] * r[5] + r[6] * r[6])
                      , o = Math.sqrt(r[8] * r[8] + r[9] * r[9] + r[10] * r[10]);
                    return this.determinant() <= 0 && (n *= -1),
                    0 === i || 0 === n || 0 === o ? e.IdentityToRef(t) : e.FromValuesToRef(r[0] / i, r[1] / i, r[2] / i, 0, r[4] / n, r[5] / n, r[6] / n, 0, r[8] / o, r[9] / o, r[10] / o, 0, 0, 0, 0, 1, t),
                    this
                }
                ,
                e.FromArray = function(t, r) {
                    var i = new e;
                    return r || (r = 0),
                    e.FromArrayToRef(t, r, i),
                    i
                }
                ,
                e.FromArrayToRef = function(e, t, r) {
                    for (var i = 0; i < 16; i++)
                        r.m[i] = e[i + t];
                    r._markAsUpdated()
                }
                ,
                e.FromFloat32ArrayToRefScaled = function(e, t, r, i) {
                    for (var n = 0; n < 16; n++)
                        i.m[n] = e[n + t] * r;
                    i._markAsUpdated()
                }
                ,
                e.FromValuesToRef = function(e, t, r, i, n, o, a, s, y, l, c, h, u, d, x, p, f) {
                    f.m[0] = e,
                    f.m[1] = t,
                    f.m[2] = r,
                    f.m[3] = i,
                    f.m[4] = n,
                    f.m[5] = o,
                    f.m[6] = a,
                    f.m[7] = s,
                    f.m[8] = y,
                    f.m[9] = l,
                    f.m[10] = c,
                    f.m[11] = h,
                    f.m[12] = u,
                    f.m[13] = d,
                    f.m[14] = x,
                    f.m[15] = p,
                    f._markAsUpdated()
                }
                ,
                Object.defineProperty(e, "IdentityReadOnly", {
                    get: function() {
                        return e._identityReadOnly
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.FromValues = function(t, r, i, n, o, a, s, y, l, c, h, u, d, x, p, f) {
                    var m = new e;
                    return m.m[0] = t,
                    m.m[1] = r,
                    m.m[2] = i,
                    m.m[3] = n,
                    m.m[4] = o,
                    m.m[5] = a,
                    m.m[6] = s,
                    m.m[7] = y,
                    m.m[8] = l,
                    m.m[9] = c,
                    m.m[10] = h,
                    m.m[11] = u,
                    m.m[12] = d,
                    m.m[13] = x,
                    m.m[14] = p,
                    m.m[15] = f,
                    m
                }
                ,
                e.Compose = function(t, r, i) {
                    var n = e.Identity();
                    return e.ComposeToRef(t, r, i, n),
                    n
                }
                ,
                e.ComposeToRef = function(t, r, i, n) {
                    e.FromValuesToRef(t.x, 0, 0, 0, 0, t.y, 0, 0, 0, 0, t.z, 0, 0, 0, 0, 1, T.Matrix[1]),
                    r.toRotationMatrix(T.Matrix[0]),
                    T.Matrix[1].multiplyToRef(T.Matrix[0], n),
                    n.setTranslation(i)
                }
                ,
                e.Identity = function() {
                    return e.FromValues(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)
                }
                ,
                e.IdentityToRef = function(t) {
                    e.FromValuesToRef(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, t)
                }
                ,
                e.Zero = function() {
                    return e.FromValues(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
                }
                ,
                e.RotationX = function(t) {
                    var r = new e;
                    return e.RotationXToRef(t, r),
                    r
                }
                ,
                e.Invert = function(t) {
                    var r = new e;
                    return t.invertToRef(r),
                    r
                }
                ,
                e.RotationXToRef = function(e, t) {
                    var r = Math.sin(e)
                      , i = Math.cos(e);
                    t.m[0] = 1,
                    t.m[15] = 1,
                    t.m[5] = i,
                    t.m[10] = i,
                    t.m[9] = -r,
                    t.m[6] = r,
                    t.m[1] = 0,
                    t.m[2] = 0,
                    t.m[3] = 0,
                    t.m[4] = 0,
                    t.m[7] = 0,
                    t.m[8] = 0,
                    t.m[11] = 0,
                    t.m[12] = 0,
                    t.m[13] = 0,
                    t.m[14] = 0,
                    t._markAsUpdated()
                }
                ,
                e.RotationY = function(t) {
                    var r = new e;
                    return e.RotationYToRef(t, r),
                    r
                }
                ,
                e.RotationYToRef = function(e, t) {
                    var r = Math.sin(e)
                      , i = Math.cos(e);
                    t.m[5] = 1,
                    t.m[15] = 1,
                    t.m[0] = i,
                    t.m[2] = -r,
                    t.m[8] = r,
                    t.m[10] = i,
                    t.m[1] = 0,
                    t.m[3] = 0,
                    t.m[4] = 0,
                    t.m[6] = 0,
                    t.m[7] = 0,
                    t.m[9] = 0,
                    t.m[11] = 0,
                    t.m[12] = 0,
                    t.m[13] = 0,
                    t.m[14] = 0,
                    t._markAsUpdated()
                }
                ,
                e.RotationZ = function(t) {
                    var r = new e;
                    return e.RotationZToRef(t, r),
                    r
                }
                ,
                e.RotationZToRef = function(e, t) {
                    var r = Math.sin(e)
                      , i = Math.cos(e);
                    t.m[10] = 1,
                    t.m[15] = 1,
                    t.m[0] = i,
                    t.m[1] = r,
                    t.m[4] = -r,
                    t.m[5] = i,
                    t.m[2] = 0,
                    t.m[3] = 0,
                    t.m[6] = 0,
                    t.m[7] = 0,
                    t.m[8] = 0,
                    t.m[9] = 0,
                    t.m[11] = 0,
                    t.m[12] = 0,
                    t.m[13] = 0,
                    t.m[14] = 0,
                    t._markAsUpdated()
                }
                ,
                e.RotationAxis = function(t, r) {
                    var i = e.Zero();
                    return e.RotationAxisToRef(t, r, i),
                    i
                }
                ,
                e.RotationAxisToRef = function(e, t, r) {
                    var i = Math.sin(-t)
                      , n = Math.cos(-t)
                      , o = 1 - n;
                    e.normalize(),
                    r.m[0] = e.x * e.x * o + n,
                    r.m[1] = e.x * e.y * o - e.z * i,
                    r.m[2] = e.x * e.z * o + e.y * i,
                    r.m[3] = 0,
                    r.m[4] = e.y * e.x * o + e.z * i,
                    r.m[5] = e.y * e.y * o + n,
                    r.m[6] = e.y * e.z * o - e.x * i,
                    r.m[7] = 0,
                    r.m[8] = e.z * e.x * o - e.y * i,
                    r.m[9] = e.z * e.y * o + e.x * i,
                    r.m[10] = e.z * e.z * o + n,
                    r.m[11] = 0,
                    r.m[15] = 1,
                    r._markAsUpdated()
                }
                ,
                e.RotationYawPitchRoll = function(t, r, i) {
                    var n = new e;
                    return e.RotationYawPitchRollToRef(t, r, i, n),
                    n
                }
                ,
                e.RotationYawPitchRollToRef = function(e, t, r, i) {
                    s.RotationYawPitchRollToRef(e, t, r, this._tempQuaternion),
                    this._tempQuaternion.toRotationMatrix(i)
                }
                ,
                e.Scaling = function(t, r, i) {
                    var n = e.Zero();
                    return e.ScalingToRef(t, r, i, n),
                    n
                }
                ,
                e.ScalingToRef = function(e, t, r, i) {
                    i.m[0] = e,
                    i.m[1] = 0,
                    i.m[2] = 0,
                    i.m[3] = 0,
                    i.m[4] = 0,
                    i.m[5] = t,
                    i.m[6] = 0,
                    i.m[7] = 0,
                    i.m[8] = 0,
                    i.m[9] = 0,
                    i.m[10] = r,
                    i.m[11] = 0,
                    i.m[12] = 0,
                    i.m[13] = 0,
                    i.m[14] = 0,
                    i.m[15] = 1,
                    i._markAsUpdated()
                }
                ,
                e.Translation = function(t, r, i) {
                    var n = e.Identity();
                    return e.TranslationToRef(t, r, i, n),
                    n
                }
                ,
                e.TranslationToRef = function(t, r, i, n) {
                    e.FromValuesToRef(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, t, r, i, 1, n)
                }
                ,
                e.Lerp = function(t, r, i) {
                    var n = e.Zero();
                    return e.LerpToRef(t, r, i, n),
                    n
                }
                ,
                e.LerpToRef = function(e, t, r, i) {
                    for (var n = 0; n < 16; n++)
                        i.m[n] = e.m[n] * (1 - r) + t.m[n] * r;
                    i._markAsUpdated()
                }
                ,
                e.DecomposeLerp = function(t, r, i) {
                    var n = e.Zero();
                    return e.DecomposeLerpToRef(t, r, i, n),
                    n
                }
                ,
                e.DecomposeLerpToRef = function(t, r, i, o) {
                    var a = T.Vector3[0]
                      , y = T.Quaternion[0]
                      , l = T.Vector3[1];
                    t.decompose(a, y, l);
                    var c = T.Vector3[2]
                      , h = T.Quaternion[1]
                      , u = T.Vector3[3];
                    r.decompose(c, h, u);
                    var d = T.Vector3[4];
                    n.LerpToRef(a, c, i, d);
                    var x = T.Quaternion[2];
                    s.SlerpToRef(y, h, i, x);
                    var p = T.Vector3[5];
                    n.LerpToRef(l, u, i, p),
                    e.ComposeToRef(d, x, p, o)
                }
                ,
                e.LookAtLH = function(t, r, i) {
                    var n = e.Zero();
                    return e.LookAtLHToRef(t, r, i, n),
                    n
                }
                ,
                e.LookAtLHToRef = function(t, r, i, o) {
                    r.subtractToRef(t, this._zAxis),
                    this._zAxis.normalize(),
                    n.CrossToRef(i, this._zAxis, this._xAxis),
                    0 === this._xAxis.lengthSquared() ? this._xAxis.x = 1 : this._xAxis.normalize(),
                    n.CrossToRef(this._zAxis, this._xAxis, this._yAxis),
                    this._yAxis.normalize();
                    var a = -n.Dot(this._xAxis, t)
                      , s = -n.Dot(this._yAxis, t)
                      , y = -n.Dot(this._zAxis, t);
                    return e.FromValuesToRef(this._xAxis.x, this._yAxis.x, this._zAxis.x, 0, this._xAxis.y, this._yAxis.y, this._zAxis.y, 0, this._xAxis.z, this._yAxis.z, this._zAxis.z, 0, a, s, y, 1, o)
                }
                ,
                e.LookAtRH = function(t, r, i) {
                    var n = e.Zero();
                    return e.LookAtRHToRef(t, r, i, n),
                    n
                }
                ,
                e.LookAtRHToRef = function(t, r, i, o) {
                    t.subtractToRef(r, this._zAxis),
                    this._zAxis.normalize(),
                    n.CrossToRef(i, this._zAxis, this._xAxis),
                    0 === this._xAxis.lengthSquared() ? this._xAxis.x = 1 : this._xAxis.normalize(),
                    n.CrossToRef(this._zAxis, this._xAxis, this._yAxis),
                    this._yAxis.normalize();
                    var a = -n.Dot(this._xAxis, t)
                      , s = -n.Dot(this._yAxis, t)
                      , y = -n.Dot(this._zAxis, t);
                    return e.FromValuesToRef(this._xAxis.x, this._yAxis.x, this._zAxis.x, 0, this._xAxis.y, this._yAxis.y, this._zAxis.y, 0, this._xAxis.z, this._yAxis.z, this._zAxis.z, 0, a, s, y, 1, o)
                }
                ,
                e.OrthoLH = function(t, r, i, n) {
                    var o = e.Zero();
                    return e.OrthoLHToRef(t, r, i, n, o),
                    o
                }
                ,
                e.OrthoLHToRef = function(t, r, i, n, o) {
                    var a = 2 / t
                      , s = 2 / r
                      , y = 2 / (n - i)
                      , l = -(n + i) / (n - i);
                    e.FromValuesToRef(a, 0, 0, 0, 0, s, 0, 0, 0, 0, y, 0, 0, 0, l, 1, o)
                }
                ,
                e.OrthoOffCenterLH = function(t, r, i, n, o, a) {
                    var s = e.Zero();
                    return e.OrthoOffCenterLHToRef(t, r, i, n, o, a, s),
                    s
                }
                ,
                e.OrthoOffCenterLHToRef = function(t, r, i, n, o, a, s) {
                    var y = 2 / (r - t)
                      , l = 2 / (n - i)
                      , c = 2 / (a - o)
                      , h = -(a + o) / (a - o)
                      , u = (t + r) / (t - r)
                      , d = (n + i) / (i - n);
                    e.FromValuesToRef(y, 0, 0, 0, 0, l, 0, 0, 0, 0, c, 0, u, d, h, 1, s)
                }
                ,
                e.OrthoOffCenterRH = function(t, r, i, n, o, a) {
                    var s = e.Zero();
                    return e.OrthoOffCenterRHToRef(t, r, i, n, o, a, s),
                    s
                }
                ,
                e.OrthoOffCenterRHToRef = function(t, r, i, n, o, a, s) {
                    e.OrthoOffCenterLHToRef(t, r, i, n, o, a, s),
                    s.m[10] *= -1
                }
                ,
                e.PerspectiveLH = function(t, r, i, n) {
                    var o = e.Zero()
                      , a = 2 * i / t
                      , s = 2 * i / r
                      , y = (n + i) / (n - i)
                      , l = -2 * n * i / (n - i);
                    return e.FromValuesToRef(a, 0, 0, 0, 0, s, 0, 0, 0, 0, y, 1, 0, 0, l, 0, o),
                    o
                }
                ,
                e.PerspectiveFovLH = function(t, r, i, n) {
                    var o = e.Zero();
                    return e.PerspectiveFovLHToRef(t, r, i, n, o),
                    o
                }
                ,
                e.PerspectiveFovLHToRef = function(t, r, i, n, o, a) {
                    void 0 === a && (a = !0);
                    var s = i
                      , y = n
                      , l = 1 / Math.tan(.5 * t)
                      , c = a ? l / r : l
                      , h = a ? l : l * r
                      , u = (y + s) / (y - s)
                      , d = -2 * y * s / (y - s);
                    e.FromValuesToRef(c, 0, 0, 0, 0, h, 0, 0, 0, 0, u, 1, 0, 0, d, 0, o)
                }
                ,
                e.PerspectiveFovRH = function(t, r, i, n) {
                    var o = e.Zero();
                    return e.PerspectiveFovRHToRef(t, r, i, n, o),
                    o
                }
                ,
                e.PerspectiveFovRHToRef = function(t, r, i, n, o, a) {
                    void 0 === a && (a = !0);
                    var s = i
                      , y = n
                      , l = 1 / Math.tan(.5 * t)
                      , c = a ? l / r : l
                      , h = a ? l : l * r
                      , u = -(y + s) / (y - s)
                      , d = -2 * y * s / (y - s);
                    e.FromValuesToRef(c, 0, 0, 0, 0, h, 0, 0, 0, 0, u, -1, 0, 0, d, 0, o)
                }
                ,
                e.PerspectiveFovWebVRToRef = function(e, t, r, i, n) {
                    void 0 === n && (n = !1);
                    var o = n ? -1 : 1
                      , a = Math.tan(e.upDegrees * Math.PI / 180)
                      , s = Math.tan(e.downDegrees * Math.PI / 180)
                      , y = Math.tan(e.leftDegrees * Math.PI / 180)
                      , l = Math.tan(e.rightDegrees * Math.PI / 180)
                      , c = 2 / (y + l)
                      , h = 2 / (a + s);
                    i.m[0] = c,
                    i.m[1] = i.m[2] = i.m[3] = i.m[4] = 0,
                    i.m[5] = h,
                    i.m[6] = i.m[7] = 0,
                    i.m[8] = (y - l) * c * .5,
                    i.m[9] = -(a - s) * h * .5,
                    i.m[10] = -r / (t - r),
                    i.m[11] = 1 * o,
                    i.m[12] = i.m[13] = i.m[15] = 0,
                    i.m[14] = -2 * r * t / (r - t),
                    i._markAsUpdated()
                }
                ,
                e.GetFinalMatrix = function(t, r, i, n, o, a) {
                    var s = t.width
                      , y = t.height
                      , l = t.x
                      , c = t.y
                      , h = e.FromValues(s / 2, 0, 0, 0, 0, -y / 2, 0, 0, 0, 0, a - o, 0, l + s / 2, y / 2 + c, o, 1);
                    return r.multiply(i).multiply(n).multiply(h)
                }
                ,
                e.GetAsMatrix2x2 = function(e) {
                    return new Float32Array([e.m[0], e.m[1], e.m[4], e.m[5]])
                }
                ,
                e.GetAsMatrix3x3 = function(e) {
                    return new Float32Array([e.m[0], e.m[1], e.m[2], e.m[4], e.m[5], e.m[6], e.m[8], e.m[9], e.m[10]])
                }
                ,
                e.Transpose = function(t) {
                    var r = new e;
                    return e.TransposeToRef(t, r),
                    r
                }
                ,
                e.TransposeToRef = function(e, t) {
                    t.m[0] = e.m[0],
                    t.m[1] = e.m[4],
                    t.m[2] = e.m[8],
                    t.m[3] = e.m[12],
                    t.m[4] = e.m[1],
                    t.m[5] = e.m[5],
                    t.m[6] = e.m[9],
                    t.m[7] = e.m[13],
                    t.m[8] = e.m[2],
                    t.m[9] = e.m[6],
                    t.m[10] = e.m[10],
                    t.m[11] = e.m[14],
                    t.m[12] = e.m[3],
                    t.m[13] = e.m[7],
                    t.m[14] = e.m[11],
                    t.m[15] = e.m[15]
                }
                ,
                e.Reflection = function(t) {
                    var r = new e;
                    return e.ReflectionToRef(t, r),
                    r
                }
                ,
                e.ReflectionToRef = function(e, t) {
                    e.normalize();
                    var r = e.normal.x
                      , i = e.normal.y
                      , n = e.normal.z
                      , o = -2 * r
                      , a = -2 * i
                      , s = -2 * n;
                    t.m[0] = o * r + 1,
                    t.m[1] = a * r,
                    t.m[2] = s * r,
                    t.m[3] = 0,
                    t.m[4] = o * i,
                    t.m[5] = a * i + 1,
                    t.m[6] = s * i,
                    t.m[7] = 0,
                    t.m[8] = o * n,
                    t.m[9] = a * n,
                    t.m[10] = s * n + 1,
                    t.m[11] = 0,
                    t.m[12] = o * e.d,
                    t.m[13] = a * e.d,
                    t.m[14] = s * e.d,
                    t.m[15] = 1,
                    t._markAsUpdated()
                }
                ,
                e.FromXYZAxesToRef = function(e, t, r, i) {
                    i.m[0] = e.x,
                    i.m[1] = e.y,
                    i.m[2] = e.z,
                    i.m[3] = 0,
                    i.m[4] = t.x,
                    i.m[5] = t.y,
                    i.m[6] = t.z,
                    i.m[7] = 0,
                    i.m[8] = r.x,
                    i.m[9] = r.y,
                    i.m[10] = r.z,
                    i.m[11] = 0,
                    i.m[12] = 0,
                    i.m[13] = 0,
                    i.m[14] = 0,
                    i.m[15] = 1,
                    i._markAsUpdated()
                }
                ,
                e.FromQuaternionToRef = function(e, t) {
                    var r = e.x * e.x
                      , i = e.y * e.y
                      , n = e.z * e.z
                      , o = e.x * e.y
                      , a = e.z * e.w
                      , s = e.z * e.x
                      , y = e.y * e.w
                      , l = e.y * e.z
                      , c = e.x * e.w;
                    t.m[0] = 1 - 2 * (i + n),
                    t.m[1] = 2 * (o + a),
                    t.m[2] = 2 * (s - y),
                    t.m[3] = 0,
                    t.m[4] = 2 * (o - a),
                    t.m[5] = 1 - 2 * (n + r),
                    t.m[6] = 2 * (l + c),
                    t.m[7] = 0,
                    t.m[8] = 2 * (s + y),
                    t.m[9] = 2 * (l - c),
                    t.m[10] = 1 - 2 * (i + r),
                    t.m[11] = 0,
                    t.m[12] = 0,
                    t.m[13] = 0,
                    t.m[14] = 0,
                    t.m[15] = 1,
                    t._markAsUpdated()
                }
                ,
                e._tempQuaternion = new s,
                e._xAxis = n.Zero(),
                e._yAxis = n.Zero(),
                e._zAxis = n.Zero(),
                e._updateFlagSeed = 0,
                e._identityReadOnly = e.Identity(),
                e
            }();
            e.Matrix = y;
            var l = function() {
                function e(e, t, r, i) {
                    this.normal = new n(e,t,r),
                    this.d = i
                }
                return e.prototype.asArray = function() {
                    return [this.normal.x, this.normal.y, this.normal.z, this.d]
                }
                ,
                e.prototype.clone = function() {
                    return new e(this.normal.x,this.normal.y,this.normal.z,this.d)
                }
                ,
                e.prototype.getClassName = function() {
                    return "Plane"
                }
                ,
                e.prototype.getHashCode = function() {
                    var e = this.normal.getHashCode();
                    return e = 397 * e ^ (this.d || 0)
                }
                ,
                e.prototype.normalize = function() {
                    var e = Math.sqrt(this.normal.x * this.normal.x + this.normal.y * this.normal.y + this.normal.z * this.normal.z)
                      , t = 0;
                    return 0 !== e && (t = 1 / e),
                    this.normal.x *= t,
                    this.normal.y *= t,
                    this.normal.z *= t,
                    this.d *= t,
                    this
                }
                ,
                e.prototype.transform = function(t) {
                    var r = y.Transpose(t)
                      , i = this.normal.x
                      , n = this.normal.y
                      , o = this.normal.z
                      , a = this.d;
                    return new e(i * r.m[0] + n * r.m[1] + o * r.m[2] + a * r.m[3],i * r.m[4] + n * r.m[5] + o * r.m[6] + a * r.m[7],i * r.m[8] + n * r.m[9] + o * r.m[10] + a * r.m[11],i * r.m[12] + n * r.m[13] + o * r.m[14] + a * r.m[15])
                }
                ,
                e.prototype.dotCoordinate = function(e) {
                    return this.normal.x * e.x + this.normal.y * e.y + this.normal.z * e.z + this.d
                }
                ,
                e.prototype.copyFromPoints = function(e, t, r) {
                    var i, n = t.x - e.x, o = t.y - e.y, a = t.z - e.z, s = r.x - e.x, y = r.y - e.y, l = r.z - e.z, c = o * l - a * y, h = a * s - n * l, u = n * y - o * s, d = Math.sqrt(c * c + h * h + u * u);
                    return i = 0 !== d ? 1 / d : 0,
                    this.normal.x = c * i,
                    this.normal.y = h * i,
                    this.normal.z = u * i,
                    this.d = -(this.normal.x * e.x + this.normal.y * e.y + this.normal.z * e.z),
                    this
                }
                ,
                e.prototype.isFrontFacingTo = function(e, t) {
                    return n.Dot(this.normal, e) <= t
                }
                ,
                e.prototype.signedDistanceTo = function(e) {
                    return n.Dot(e, this.normal) + this.d
                }
                ,
                e.FromArray = function(t) {
                    return new e(t[0],t[1],t[2],t[3])
                }
                ,
                e.FromPoints = function(t, r, i) {
                    var n = new e(0,0,0,0);
                    return n.copyFromPoints(t, r, i),
                    n
                }
                ,
                e.FromPositionAndNormal = function(t, r) {
                    var i = new e(0,0,0,0);
                    return r.normalize(),
                    i.normal = r,
                    i.d = -(r.x * t.x + r.y * t.y + r.z * t.z),
                    i
                }
                ,
                e.SignedDistanceToPlaneFromPositionAndNormal = function(e, t, r) {
                    var i = -(t.x * e.x + t.y * e.y + t.z * e.z);
                    return n.Dot(r, t) + i
                }
                ,
                e
            }();
            e.Plane = l;
            var c = function() {
                function e(e, t, r, i) {
                    this.x = e,
                    this.y = t,
                    this.width = r,
                    this.height = i
                }
                return e.prototype.toGlobal = function(t, r) {
                    if (t.getRenderWidth) {
                        var i = t;
                        return this.toGlobal(i.getRenderWidth(), i.getRenderHeight())
                    }
                    var n = t;
                    return new e(this.x * n,this.y * r,this.width * n,this.height * r)
                }
                ,
                e.prototype.clone = function() {
                    return new e(this.x,this.y,this.width,this.height)
                }
                ,
                e
            }();
            e.Viewport = c;
            var h = function() {
                function e() {}
                return e.GetPlanes = function(t) {
                    for (var r = [], i = 0; i < 6; i++)
                        r.push(new l(0,0,0,0));
                    return e.GetPlanesToRef(t, r),
                    r
                }
                ,
                e.GetNearPlaneToRef = function(e, t) {
                    t.normal.x = e.m[3] + e.m[2],
                    t.normal.y = e.m[7] + e.m[6],
                    t.normal.z = e.m[11] + e.m[10],
                    t.d = e.m[15] + e.m[14],
                    t.normalize()
                }
                ,
                e.GetFarPlaneToRef = function(e, t) {
                    t.normal.x = e.m[3] - e.m[2],
                    t.normal.y = e.m[7] - e.m[6],
                    t.normal.z = e.m[11] - e.m[10],
                    t.d = e.m[15] - e.m[14],
                    t.normalize()
                }
                ,
                e.GetLeftPlaneToRef = function(e, t) {
                    t.normal.x = e.m[3] + e.m[0],
                    t.normal.y = e.m[7] + e.m[4],
                    t.normal.z = e.m[11] + e.m[8],
                    t.d = e.m[15] + e.m[12],
                    t.normalize()
                }
                ,
                e.GetRightPlaneToRef = function(e, t) {
                    t.normal.x = e.m[3] - e.m[0],
                    t.normal.y = e.m[7] - e.m[4],
                    t.normal.z = e.m[11] - e.m[8],
                    t.d = e.m[15] - e.m[12],
                    t.normalize()
                }
                ,
                e.GetTopPlaneToRef = function(e, t) {
                    t.normal.x = e.m[3] - e.m[1],
                    t.normal.y = e.m[7] - e.m[5],
                    t.normal.z = e.m[11] - e.m[9],
                    t.d = e.m[15] - e.m[13],
                    t.normalize()
                }
                ,
                e.GetBottomPlaneToRef = function(e, t) {
                    t.normal.x = e.m[3] + e.m[1],
                    t.normal.y = e.m[7] + e.m[5],
                    t.normal.z = e.m[11] + e.m[9],
                    t.d = e.m[15] + e.m[13],
                    t.normalize()
                }
                ,
                e.GetPlanesToRef = function(t, r) {
                    e.GetNearPlaneToRef(t, r[0]),
                    e.GetFarPlaneToRef(t, r[1]),
                    e.GetLeftPlaneToRef(t, r[2]),
                    e.GetRightPlaneToRef(t, r[3]),
                    e.GetTopPlaneToRef(t, r[4]),
                    e.GetBottomPlaneToRef(t, r[5])
                }
                ,
                e
            }();
            e.Frustum = h,
            function(e) {
                e[e.LOCAL = 0] = "LOCAL",
                e[e.WORLD = 1] = "WORLD",
                e[e.BONE = 2] = "BONE"
            }(e.Space || (e.Space = {}));
            var u = function() {
                function e() {}
                return e.X = new n(1,0,0),
                e.Y = new n(0,1,0),
                e.Z = new n(0,0,1),
                e
            }();
            e.Axis = u;
            var d, x = function() {
                function e() {}
                return e.Interpolate = function(e, t, r, i, n) {
                    for (var o = 1 - 3 * i + 3 * t, a = 3 * i - 6 * t, s = 3 * t, y = e, l = 0; l < 5; l++) {
                        var c = y * y;
                        y -= (o * (c * y) + a * c + s * y - e) * (1 / (3 * o * c + 2 * a * y + s)),
                        y = Math.min(1, Math.max(0, y))
                    }
                    return 3 * Math.pow(1 - y, 2) * y * r + 3 * (1 - y) * Math.pow(y, 2) * n + Math.pow(y, 3)
                }
                ,
                e
            }();
            e.BezierCurve = x,
            function(e) {
                e[e.CW = 0] = "CW",
                e[e.CCW = 1] = "CCW"
            }(d = e.Orientation || (e.Orientation = {}));
            var p = function() {
                function e(e) {
                    this._radians = e,
                    this._radians < 0 && (this._radians += 2 * Math.PI)
                }
                return e.prototype.degrees = function() {
                    return 180 * this._radians / Math.PI
                }
                ,
                e.prototype.radians = function() {
                    return this._radians
                }
                ,
                e.BetweenTwoPoints = function(t, r) {
                    var i = r.subtract(t);
                    return new e(Math.atan2(i.y, i.x))
                }
                ,
                e.FromRadians = function(t) {
                    return new e(t)
                }
                ,
                e.FromDegrees = function(t) {
                    return new e(t * Math.PI / 180)
                }
                ,
                e
            }();
            e.Angle = p;
            var f = function(e, t, r) {
                this.startPoint = e,
                this.midPoint = t,
                this.endPoint = r;
                var n = Math.pow(t.x, 2) + Math.pow(t.y, 2)
                  , o = (Math.pow(e.x, 2) + Math.pow(e.y, 2) - n) / 2
                  , a = (n - Math.pow(r.x, 2) - Math.pow(r.y, 2)) / 2
                  , s = (e.x - t.x) * (t.y - r.y) - (t.x - r.x) * (e.y - t.y);
                this.centerPoint = new i((o * (t.y - r.y) - a * (e.y - t.y)) / s,((e.x - t.x) * a - (t.x - r.x) * o) / s),
                this.radius = this.centerPoint.subtract(this.startPoint).length(),
                this.startAngle = p.BetweenTwoPoints(this.centerPoint, this.startPoint);
                var y = this.startAngle.degrees()
                  , l = p.BetweenTwoPoints(this.centerPoint, this.midPoint).degrees()
                  , c = p.BetweenTwoPoints(this.centerPoint, this.endPoint).degrees();
                l - y > 180 && (l -= 360),
                l - y < -180 && (l += 360),
                c - l > 180 && (c -= 360),
                c - l < -180 && (c += 360),
                this.orientation = l - y < 0 ? d.CW : d.CCW,
                this.angle = p.FromDegrees(this.orientation === d.CW ? y - c : c - y)
            };
            e.Arc2 = f;
            var m = function() {
                function e(e, t) {
                    this._points = new Array,
                    this._length = 0,
                    this.closed = !1,
                    this._points.push(new i(e,t))
                }
                return e.prototype.addLineTo = function(e, t) {
                    if (this.closed)
                        return this;
                    var r = new i(e,t)
                      , n = this._points[this._points.length - 1];
                    return this._points.push(r),
                    this._length += r.subtract(n).length(),
                    this
                }
                ,
                e.prototype.addArcTo = function(e, t, r, n, o) {
                    if (void 0 === o && (o = 36),
                    this.closed)
                        return this;
                    var a = this._points[this._points.length - 1]
                      , s = new i(e,t)
                      , y = new i(r,n)
                      , l = new f(a,s,y)
                      , c = l.angle.radians() / o;
                    l.orientation === d.CW && (c *= -1);
                    for (var h = l.startAngle.radians() + c, u = 0; u < o; u++) {
                        var x = Math.cos(h) * l.radius + l.centerPoint.x
                          , p = Math.sin(h) * l.radius + l.centerPoint.y;
                        this.addLineTo(x, p),
                        h += c
                    }
                    return this
                }
                ,
                e.prototype.close = function() {
                    return this.closed = !0,
                    this
                }
                ,
                e.prototype.length = function() {
                    var e = this._length;
                    if (!this.closed) {
                        var t = this._points[this._points.length - 1];
                        e += this._points[0].subtract(t).length()
                    }
                    return e
                }
                ,
                e.prototype.getPoints = function() {
                    return this._points
                }
                ,
                e.prototype.getPointAtLengthPosition = function(e) {
                    if (e < 0 || e > 1)
                        return i.Zero();
                    for (var t = e * this.length(), r = 0, n = 0; n < this._points.length; n++) {
                        var o = (n + 1) % this._points.length
                          , a = this._points[n]
                          , s = this._points[o].subtract(a)
                          , y = s.length() + r;
                        if (t >= r && t <= y) {
                            var l = s.normalize()
                              , c = t - r;
                            return new i(a.x + l.x * c,a.y + l.y * c)
                        }
                        r = y
                    }
                    return i.Zero()
                }
                ,
                e.StartingAt = function(t, r) {
                    return new e(t,r)
                }
                ,
                e
            }();
            e.Path2 = m;
            var z = function() {
                function t(e, t, r) {
                    void 0 === t && (t = null),
                    this.path = e,
                    this._curve = new Array,
                    this._distances = new Array,
                    this._tangents = new Array,
                    this._normals = new Array,
                    this._binormals = new Array;
                    for (var i = 0; i < e.length; i++)
                        this._curve[i] = e[i].clone();
                    this._raw = r || !1,
                    this._compute(t)
                }
                return t.prototype.getCurve = function() {
                    return this._curve
                }
                ,
                t.prototype.getTangents = function() {
                    return this._tangents
                }
                ,
                t.prototype.getNormals = function() {
                    return this._normals
                }
                ,
                t.prototype.getBinormals = function() {
                    return this._binormals
                }
                ,
                t.prototype.getDistances = function() {
                    return this._distances
                }
                ,
                t.prototype.update = function(e, t) {
                    void 0 === t && (t = null);
                    for (var r = 0; r < e.length; r++)
                        this._curve[r].x = e[r].x,
                        this._curve[r].y = e[r].y,
                        this._curve[r].z = e[r].z;
                    return this._compute(t),
                    this
                }
                ,
                t.prototype._compute = function(e) {
                    var t = this._curve.length;
                    this._tangents[0] = this._getFirstNonNullVector(0),
                    this._raw || this._tangents[0].normalize(),
                    this._tangents[t - 1] = this._curve[t - 1].subtract(this._curve[t - 2]),
                    this._raw || this._tangents[t - 1].normalize();
                    var r, i, o, a, s = this._tangents[0], y = this._normalVector(this._curve[0], s, e);
                    this._normals[0] = y,
                    this._raw || this._normals[0].normalize(),
                    this._binormals[0] = n.Cross(s, this._normals[0]),
                    this._raw || this._binormals[0].normalize(),
                    this._distances[0] = 0;
                    for (var l = 1; l < t; l++)
                        r = this._getLastNonNullVector(l),
                        l < t - 1 && (i = this._getFirstNonNullVector(l),
                        this._tangents[l] = r.add(i),
                        this._tangents[l].normalize()),
                        this._distances[l] = this._distances[l - 1] + r.length(),
                        o = this._tangents[l],
                        a = this._binormals[l - 1],
                        this._normals[l] = n.Cross(a, o),
                        this._raw || this._normals[l].normalize(),
                        this._binormals[l] = n.Cross(o, this._normals[l]),
                        this._raw || this._binormals[l].normalize()
                }
                ,
                t.prototype._getFirstNonNullVector = function(e) {
                    for (var t = 1, r = this._curve[e + t].subtract(this._curve[e]); 0 === r.length() && e + t + 1 < this._curve.length; )
                        t++,
                        r = this._curve[e + t].subtract(this._curve[e]);
                    return r
                }
                ,
                t.prototype._getLastNonNullVector = function(e) {
                    for (var t = 1, r = this._curve[e].subtract(this._curve[e - t]); 0 === r.length() && e > t + 1; )
                        t++,
                        r = this._curve[e].subtract(this._curve[e - t]);
                    return r
                }
                ,
                t.prototype._normalVector = function(t, r, i) {
                    var o, a, s = r.length();
                    (0 === s && (s = 1),
                    null == i) ? (a = e.Scalar.WithinEpsilon(Math.abs(r.y) / s, 1, e.Epsilon) ? e.Scalar.WithinEpsilon(Math.abs(r.x) / s, 1, e.Epsilon) ? e.Scalar.WithinEpsilon(Math.abs(r.z) / s, 1, e.Epsilon) ? n.Zero() : new n(0,0,1) : new n(1,0,0) : new n(0,-1,0),
                    o = n.Cross(r, a)) : (o = n.Cross(r, i),
                    n.CrossToRef(o, r, o));
                    return o.normalize(),
                    o
                }
                ,
                t
            }();
            e.Path3D = z;
            var _ = function() {
                function e(e) {
                    this._length = 0,
                    this._points = e,
                    this._length = this._computeLength(e)
                }
                return e.CreateQuadraticBezier = function(t, r, i, o) {
                    o = o > 2 ? o : 3;
                    for (var a = new Array, s = function(e, t, r, i) {
                        return (1 - e) * (1 - e) * t + 2 * e * (1 - e) * r + e * e * i
                    }, y = 0; y <= o; y++)
                        a.push(new n(s(y / o, t.x, r.x, i.x),s(y / o, t.y, r.y, i.y),s(y / o, t.z, r.z, i.z)));
                    return new e(a)
                }
                ,
                e.CreateCubicBezier = function(t, r, i, o, a) {
                    a = a > 3 ? a : 4;
                    for (var s = new Array, y = function(e, t, r, i, n) {
                        return (1 - e) * (1 - e) * (1 - e) * t + 3 * e * (1 - e) * (1 - e) * r + 3 * e * e * (1 - e) * i + e * e * e * n
                    }, l = 0; l <= a; l++)
                        s.push(new n(y(l / a, t.x, r.x, i.x, o.x),y(l / a, t.y, r.y, i.y, o.y),y(l / a, t.z, r.z, i.z, o.z)));
                    return new e(s)
                }
                ,
                e.CreateHermiteSpline = function(t, r, i, o, a) {
                    for (var s = new Array, y = 1 / a, l = 0; l <= a; l++)
                        s.push(n.Hermite(t, r, i, o, l * y));
                    return new e(s)
                }
                ,
                e.CreateCatmullRomSpline = function(t, r, i) {
                    var o = new Array
                      , a = 1 / r
                      , s = 0;
                    if (i) {
                        for (var y = t.length, l = 0; l < y; l++) {
                            s = 0;
                            for (var c = 0; c < r; c++)
                                o.push(n.CatmullRom(t[l % y], t[(l + 1) % y], t[(l + 2) % y], t[(l + 3) % y], s)),
                                s += a
                        }
                        o.push(o[0])
                    } else {
                        var h = new Array;
                        h.push(t[0].clone()),
                        Array.prototype.push.apply(h, t),
                        h.push(t[t.length - 1].clone());
                        for (l = 0; l < h.length - 3; l++) {
                            s = 0;
                            for (c = 0; c < r; c++)
                                o.push(n.CatmullRom(h[l], h[l + 1], h[l + 2], h[l + 3], s)),
                                s += a
                        }
                        l--,
                        o.push(n.CatmullRom(h[l], h[l + 1], h[l + 2], h[l + 3], s))
                    }
                    return new e(o)
                }
                ,
                e.prototype.getPoints = function() {
                    return this._points
                }
                ,
                e.prototype.length = function() {
                    return this._length
                }
                ,
                e.prototype.continue = function(t) {
                    for (var r = this._points[this._points.length - 1], i = this._points.slice(), n = t.getPoints(), o = 1; o < n.length; o++)
                        i.push(n[o].subtract(n[0]).add(r));
                    return new e(i)
                }
                ,
                e.prototype._computeLength = function(e) {
                    for (var t = 0, r = 1; r < e.length; r++)
                        t += e[r].subtract(e[r - 1]).length();
                    return t
                }
                ,
                e
            }();
            e.Curve3 = _;
            var g = function() {
                function e(e, t) {
                    void 0 === e && (e = n.Zero()),
                    void 0 === t && (t = n.Up()),
                    this.position = e,
                    this.normal = t
                }
                return e.prototype.clone = function() {
                    return new e(this.position.clone(),this.normal.clone())
                }
                ,
                e
            }();
            e.PositionNormalVertex = g;
            var v = function() {
                function e(e, t, r) {
                    void 0 === e && (e = n.Zero()),
                    void 0 === t && (t = n.Up()),
                    void 0 === r && (r = i.Zero()),
                    this.position = e,
                    this.normal = t,
                    this.uv = r
                }
                return e.prototype.clone = function() {
                    return new e(this.position.clone(),this.normal.clone(),this.uv.clone())
                }
                ,
                e
            }();
            e.PositionNormalTextureVertex = v;
            var b = function() {
                function e() {}
                return e.Color3 = [t.Black(), t.Black(), t.Black()],
                e.Color4 = [new r(0,0,0,0), new r(0,0,0,0)],
                e.Vector2 = [i.Zero(), i.Zero(), i.Zero()],
                e.Vector3 = [n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero()],
                e.Vector4 = [o.Zero(), o.Zero(), o.Zero()],
                e.Quaternion = [s.Zero(), s.Zero()],
                e.Matrix = [y.Zero(), y.Zero(), y.Zero(), y.Zero(), y.Zero(), y.Zero(), y.Zero(), y.Zero()],
                e
            }();
            e.Tmp = b;
            var T = function() {
                function e() {}
                return e.Vector3 = [n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero(), n.Zero()],
                e.Matrix = [y.Zero(), y.Zero()],
                e.Quaternion = [s.Zero(), s.Zero(), s.Zero()],
                e
            }()
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {}
                return e.WithinEpsilon = function(e, t, r) {
                    void 0 === r && (r = 1401298e-51);
                    var i = e - t;
                    return -r <= i && i <= r
                }
                ,
                e.ToHex = function(e) {
                    var t = e.toString(16);
                    return e <= 15 ? ("0" + t).toUpperCase() : t.toUpperCase()
                }
                ,
                e.Sign = function(e) {
                    return 0 === (e = +e) || isNaN(e) ? e : e > 0 ? 1 : -1
                }
                ,
                e.Clamp = function(e, t, r) {
                    return void 0 === t && (t = 0),
                    void 0 === r && (r = 1),
                    Math.min(r, Math.max(t, e))
                }
                ,
                e.Log2 = function(e) {
                    return Math.log(e) * Math.LOG2E
                }
                ,
                e.Repeat = function(e, t) {
                    return e - Math.floor(e / t) * t
                }
                ,
                e.Normalize = function(e, t, r) {
                    return (e - t) / (r - t)
                }
                ,
                e.Denormalize = function(e, t, r) {
                    return e * (r - t) + t
                }
                ,
                e.DeltaAngle = function(t, r) {
                    var i = e.Repeat(r - t, 360);
                    return i > 180 && (i -= 360),
                    i
                }
                ,
                e.PingPong = function(t, r) {
                    var i = e.Repeat(t, 2 * r);
                    return r - Math.abs(i - r)
                }
                ,
                e.SmoothStep = function(t, r, i) {
                    var n = e.Clamp(i);
                    return r * (n = -2 * n * n * n + 3 * n * n) + t * (1 - n)
                }
                ,
                e.MoveTowards = function(t, r, i) {
                    return Math.abs(r - t) <= i ? r : t + e.Sign(r - t) * i
                }
                ,
                e.MoveTowardsAngle = function(t, r, i) {
                    var n = e.DeltaAngle(t, r)
                      , o = 0;
                    return -i < n && n < i ? o = r : (r = t + n,
                    o = e.MoveTowards(t, r, i)),
                    o
                }
                ,
                e.Lerp = function(e, t, r) {
                    return e + (t - e) * r
                }
                ,
                e.LerpAngle = function(t, r, i) {
                    var n = e.Repeat(r - t, 360);
                    return n > 180 && (n -= 360),
                    t + n * e.Clamp(i)
                }
                ,
                e.InverseLerp = function(t, r, i) {
                    return t != r ? e.Clamp((i - t) / (r - t)) : 0
                }
                ,
                e.Hermite = function(e, t, r, i, n) {
                    var o = n * n
                      , a = n * o;
                    return e * (2 * a - 3 * o + 1) + r * (-2 * a + 3 * o) + t * (a - 2 * o + n) + i * (a - o)
                }
                ,
                e.RandomRange = function(e, t) {
                    return e === t ? e : Math.random() * (t - e) + e
                }
                ,
                e.RangeToPercent = function(e, t, r) {
                    return (e - t) / (r - t)
                }
                ,
                e.PercentToRange = function(e, t, r) {
                    return (r - t) * e + t
                }
                ,
                e.NormalizeRadians = function(t) {
                    return t -= e.TwoPi * Math.floor((t + Math.PI) / e.TwoPi)
                }
                ,
                e.TwoPi = 2 * Math.PI,
                e
            }();
            e.Scalar = t
        }(s || (s = {})),
        function(e) {
            var t = {}
              , r = {}
              , i = function(t, r, i) {
                var o = t();
                e.Tags && e.Tags.AddTagsTo(o, r.tags);
                var a = n(o);
                for (var s in a) {
                    var y = a[s]
                      , l = r[s]
                      , c = y.type;
                    if (null != l)
                        switch (c) {
                        case 0:
                        case 6:
                        case 11:
                            o[s] = l;
                            break;
                        case 1:
                            o[s] = i || l.isRenderTarget ? l : l.clone();
                            break;
                        case 2:
                        case 3:
                        case 4:
                        case 5:
                        case 7:
                        case 10:
                            o[s] = i ? l : l.clone()
                        }
                }
                return o
            };
            function n(e) {
                var i = e.getClassName();
                if (r[i])
                    return r[i];
                r[i] = {};
                for (var n = r[i], o = e, a = i; a; ) {
                    var s = t[a];
                    for (var y in s)
                        n[y] = s[y];
                    var l = void 0
                      , c = !1;
                    do {
                        if (!(l = Object.getPrototypeOf(o)).getClassName) {
                            c = !0;
                            break
                        }
                        if (l.getClassName() !== a)
                            break;
                        o = l
                    } while (l);if (c)
                        break;
                    a = l.getClassName(),
                    o = l
                }
                return n
            }
            function o(e, r) {
                return function(i, n) {
                    var o = function(e) {
                        var r = e.getClassName();
                        return t[r] || (t[r] = {}),
                        t[r]
                    }(i);
                    o[n] || (o[n] = {
                        type: e,
                        sourceName: r
                    })
                }
            }
            e.expandToProperty = function(e, t) {
                return void 0 === t && (t = null),
                function(e, t) {
                    return void 0 === t && (t = null),
                    function(r, i) {
                        var n = t || "_" + i;
                        Object.defineProperty(r, i, {
                            get: function() {
                                return this[n]
                            },
                            set: function(t) {
                                this[n] !== t && (this[n] = t,
                                r[e].apply(this))
                            },
                            enumerable: !0,
                            configurable: !0
                        })
                    }
                }(e, t)
            }
            ,
            e.serialize = function(e) {
                return o(0, e)
            }
            ,
            e.serializeAsTexture = function(e) {
                return o(1, e)
            }
            ,
            e.serializeAsColor3 = function(e) {
                return o(2, e)
            }
            ,
            e.serializeAsFresnelParameters = function(e) {
                return o(3, e)
            }
            ,
            e.serializeAsVector2 = function(e) {
                return o(4, e)
            }
            ,
            e.serializeAsVector3 = function(e) {
                return o(5, e)
            }
            ,
            e.serializeAsMeshReference = function(e) {
                return o(6, e)
            }
            ,
            e.serializeAsColorCurves = function(e) {
                return o(7, e)
            }
            ,
            e.serializeAsColor4 = function(e) {
                return o(8, e)
            }
            ,
            e.serializeAsImageProcessingConfiguration = function(e) {
                return o(9, e)
            }
            ,
            e.serializeAsQuaternion = function(e) {
                return o(10, e)
            }
            ,
            e.serializeAsCameraReference = function(e) {
                return o(11, e)
            }
            ;
            var a = function() {
                function t() {}
                return t.Serialize = function(t, r) {
                    r || (r = {}),
                    e.Tags && (r.tags = e.Tags.GetTags(t));
                    var i = n(t);
                    for (var o in i) {
                        var a = i[o]
                          , s = a.sourceName || o
                          , y = a.type
                          , l = t[o];
                        if (null != l)
                            switch (y) {
                            case 0:
                                r[s] = l;
                                break;
                            case 1:
                                r[s] = l.serialize();
                                break;
                            case 2:
                                r[s] = l.asArray();
                                break;
                            case 3:
                                r[s] = l.serialize();
                                break;
                            case 4:
                            case 5:
                                r[s] = l.asArray();
                                break;
                            case 6:
                                r[s] = l.id;
                                break;
                            case 7:
                                r[s] = l.serialize();
                                break;
                            case 8:
                                r[s] = l.asArray();
                                break;
                            case 9:
                                r[s] = l.serialize();
                                break;
                            case 10:
                                r[s] = l.asArray();
                                break;
                            case 11:
                                r[s] = l.id
                            }
                    }
                    return r
                }
                ,
                t.Parse = function(t, r, i, o) {
                    void 0 === o && (o = null);
                    var a = t();
                    o || (o = ""),
                    e.Tags && e.Tags.AddTagsTo(a, r.tags);
                    var s = n(a);
                    for (var y in s) {
                        var l = s[y]
                          , c = r[l.sourceName || y]
                          , h = l.type;
                        if (null != c) {
                            var u = a;
                            switch (h) {
                            case 0:
                                u[y] = c;
                                break;
                            case 1:
                                i && (u[y] = e.Texture.Parse(c, i, o));
                                break;
                            case 2:
                                u[y] = e.Color3.FromArray(c);
                                break;
                            case 3:
                                u[y] = e.FresnelParameters.Parse(c);
                                break;
                            case 4:
                                u[y] = e.Vector2.FromArray(c);
                                break;
                            case 5:
                                u[y] = e.Vector3.FromArray(c);
                                break;
                            case 6:
                                i && (u[y] = i.getLastMeshByID(c));
                                break;
                            case 7:
                                u[y] = e.ColorCurves.Parse(c);
                                break;
                            case 8:
                                u[y] = e.Color4.FromArray(c);
                                break;
                            case 9:
                                u[y] = e.ImageProcessingConfiguration.Parse(c);
                                break;
                            case 10:
                                u[y] = e.Quaternion.FromArray(c);
                                break;
                            case 11:
                                i && (u[y] = i.getCameraByID(c))
                            }
                        }
                    }
                    return a
                }
                ,
                t.Clone = function(e, t) {
                    return i(e, t, !1)
                }
                ,
                t.Instanciate = function(e, t) {
                    return i(e, t, !0)
                }
                ,
                t
            }();
            e.SerializationHelper = a
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {
                    var e = this;
                    this.promise = new Promise((function(t, r) {
                        e._resolve = t,
                        e._reject = r
                    }
                    ))
                }
                return Object.defineProperty(e.prototype, "resolve", {
                    get: function() {
                        return this._resolve
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "reject", {
                    get: function() {
                        return this._reject
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e
            }();
            e.Deferred = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e(e, t, r, i) {
                    void 0 === t && (t = !1),
                    this.initalize(e, t, r, i)
                }
                return e.prototype.initalize = function(e, t, r, i) {
                    return void 0 === t && (t = !1),
                    this.mask = e,
                    this.skipNextObservers = t,
                    this.target = r,
                    this.currentTarget = i,
                    this
                }
                ,
                e
            }();
            e.EventState = t;
            var r = function(e, t, r) {
                void 0 === r && (r = null),
                this.callback = e,
                this.mask = t,
                this.scope = r,
                this._willBeUnregistered = !1,
                this.unregisterOnNextCall = !1
            };
            e.Observer = r;
            var i = function() {
                function e() {}
                return e.prototype.dispose = function() {
                    if (this._observers && this._observables)
                        for (var e = 0; e < this._observers.length; e++)
                            this._observables[e].remove(this._observers[e]);
                    this._observers = null,
                    this._observables = null
                }
                ,
                e.Watch = function(t, r, i, n) {
                    void 0 === i && (i = -1),
                    void 0 === n && (n = null);
                    var o = new e;
                    o._observers = new Array,
                    o._observables = t;
                    for (var a = 0, s = t; a < s.length; a++) {
                        var y = s[a].add(r, i, !1, n);
                        y && o._observers.push(y)
                    }
                    return o
                }
                ,
                e
            }();
            e.MultiObserver = i;
            var n = function() {
                function i(e) {
                    this._observers = new Array,
                    this._eventState = new t(0),
                    e && (this._onObserverAdded = e)
                }
                return i.prototype.add = function(e, t, i, n, o) {
                    if (void 0 === t && (t = -1),
                    void 0 === i && (i = !1),
                    void 0 === n && (n = null),
                    void 0 === o && (o = !1),
                    !e)
                        return null;
                    var a = new r(e,t,n);
                    return a.unregisterOnNextCall = o,
                    i ? this._observers.unshift(a) : this._observers.push(a),
                    this._onObserverAdded && this._onObserverAdded(a),
                    a
                }
                ,
                i.prototype.addOnce = function(e) {
                    return this.add(e, void 0, void 0, void 0, !0)
                }
                ,
                i.prototype.remove = function(e) {
                    return !!e && (-1 !== this._observers.indexOf(e) && (this._deferUnregister(e),
                    !0))
                }
                ,
                i.prototype.removeCallback = function(e, t) {
                    for (var r = 0; r < this._observers.length; r++)
                        if (this._observers[r].callback === e && (!t || t === this._observers[r].scope))
                            return this._deferUnregister(this._observers[r]),
                            !0;
                    return !1
                }
                ,
                i.prototype._deferUnregister = function(t) {
                    var r = this;
                    t.unregisterOnNextCall = !1,
                    t._willBeUnregistered = !0,
                    e.Tools.SetImmediate((function() {
                        r._remove(t)
                    }
                    ))
                }
                ,
                i.prototype._remove = function(e) {
                    if (!e)
                        return !1;
                    var t = this._observers.indexOf(e);
                    return -1 !== t && (this._observers.splice(t, 1),
                    !0)
                }
                ,
                i.prototype.notifyObservers = function(e, t, r, i) {
                    if (void 0 === t && (t = -1),
                    !this._observers.length)
                        return !0;
                    var n = this._eventState;
                    n.mask = t,
                    n.target = r,
                    n.currentTarget = i,
                    n.skipNextObservers = !1,
                    n.lastReturnValue = e;
                    for (var o = 0, a = this._observers; o < a.length; o++) {
                        var s = a[o];
                        if (!s._willBeUnregistered && (s.mask & t && (s.scope ? n.lastReturnValue = s.callback.apply(s.scope, [e, n]) : n.lastReturnValue = s.callback(e, n),
                        s.unregisterOnNextCall && this._deferUnregister(s)),
                        n.skipNextObservers))
                            return !1
                    }
                    return !0
                }
                ,
                i.prototype.notifyObserversWithPromise = function(e, t, r, i) {
                    var n = this;
                    void 0 === t && (t = -1);
                    var o = Promise.resolve(e);
                    if (!this._observers.length)
                        return o;
                    var a = this._eventState;
                    return a.mask = t,
                    a.target = r,
                    a.currentTarget = i,
                    a.skipNextObservers = !1,
                    this._observers.forEach((function(r) {
                        a.skipNextObservers || r._willBeUnregistered || r.mask & t && (o = r.scope ? o.then((function(t) {
                            return a.lastReturnValue = t,
                            r.callback.apply(r.scope, [e, a])
                        }
                        )) : o.then((function(t) {
                            return a.lastReturnValue = t,
                            r.callback(e, a)
                        }
                        )),
                        r.unregisterOnNextCall && n._deferUnregister(r))
                    }
                    )),
                    o.then((function() {
                        return e
                    }
                    ))
                }
                ,
                i.prototype.notifyObserver = function(e, t, r) {
                    void 0 === r && (r = -1);
                    var i = this._eventState;
                    i.mask = r,
                    i.skipNextObservers = !1,
                    e.callback(t, i)
                }
                ,
                i.prototype.hasObservers = function() {
                    return this._observers.length > 0
                }
                ,
                i.prototype.clear = function() {
                    this._observers = new Array,
                    this._onObserverAdded = null
                }
                ,
                i.prototype.clone = function() {
                    var e = new i;
                    return e._observers = this._observers.slice(0),
                    e
                }
                ,
                i.prototype.hasSpecificMask = function(e) {
                    void 0 === e && (e = -1);
                    for (var t = 0, r = this._observers; t < r.length; t++) {
                        var i = r[t];
                        if (i.mask & e || i.mask === e)
                            return !0
                    }
                    return !1
                }
                ,
                i
            }();
            e.Observable = n
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e(t) {
                    this.length = 0,
                    this.data = new Array(t),
                    this._id = e._GlobalId++
                }
                return e.prototype.push = function(e) {
                    this.data[this.length++] = e,
                    this.length > this.data.length && (this.data.length *= 2)
                }
                ,
                e.prototype.forEach = function(e) {
                    for (var t = 0; t < this.length; t++)
                        e(this.data[t])
                }
                ,
                e.prototype.sort = function(e) {
                    this.data.sort(e)
                }
                ,
                e.prototype.reset = function() {
                    this.length = 0
                }
                ,
                e.prototype.dispose = function() {
                    this.reset(),
                    this.data && (this.data.length = 0,
                    this.data = [])
                }
                ,
                e.prototype.concat = function(e) {
                    if (0 !== e.length) {
                        this.length + e.length > this.data.length && (this.data.length = 2 * (this.length + e.length));
                        for (var t = 0; t < e.length; t++)
                            this.data[this.length++] = (e.data || e)[t]
                    }
                }
                ,
                e.prototype.indexOf = function(e) {
                    var t = this.data.indexOf(e);
                    return t >= this.length ? -1 : t
                }
                ,
                e.prototype.contains = function(e) {
                    return -1 !== this.indexOf(e)
                }
                ,
                e._GlobalId = 0,
                e
            }();
            e.SmartArray = t;
            var r = function(e) {
                function t() {
                    var t = null !== e && e.apply(this, arguments) || this;
                    return t._duplicateId = 0,
                    t
                }
                return o(t, e),
                t.prototype.push = function(t) {
                    e.prototype.push.call(this, t),
                    t.__smartArrayFlags || (t.__smartArrayFlags = {}),
                    t.__smartArrayFlags[this._id] = this._duplicateId
                }
                ,
                t.prototype.pushNoDuplicate = function(e) {
                    return (!e.__smartArrayFlags || e.__smartArrayFlags[this._id] !== this._duplicateId) && (this.push(e),
                    !0)
                }
                ,
                t.prototype.reset = function() {
                    e.prototype.reset.call(this),
                    this._duplicateId++
                }
                ,
                t.prototype.concatWithNoDuplicate = function(e) {
                    if (0 !== e.length) {
                        this.length + e.length > this.data.length && (this.data.length = 2 * (this.length + e.length));
                        for (var t = 0; t < e.length; t++) {
                            var r = (e.data || e)[t];
                            this.pushNoDuplicate(r)
                        }
                    }
                }
                ,
                t
            }(t);
            e.SmartArrayNoDuplicate = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.prototype.getColorToRef = function(t) {
                    this.color2 ? e.Color4.LerpToRef(this.color1, this.color2, Math.random(), t) : t.copyFrom(this.color1)
                }
                ,
                t
            }();
            e.ColorGradient = t;
            var r = function() {};
            e.Color3Gradient = r;
            var i = function() {
                function t() {}
                return t.prototype.getFactor = function() {
                    return void 0 === this.factor2 ? this.factor1 : e.Scalar.Lerp(this.factor1, this.factor2, Math.random())
                }
                ,
                t
            }();
            e.FactorGradient = i;
            var n = function(e) {
                function t(r, i) {
                    var n = e.call(this, r) || this;
                    return n.request = i,
                    n.name = "LoadFileError",
                    t._setPrototypeOf(n, t.prototype),
                    n
                }
                return o(t, e),
                t._setPrototypeOf = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t,
                    e
                }
                ,
                t
            }(Error);
            e.LoadFileError = n;
            var a, s = function() {
                function e() {}
                return e.ExponentialBackoff = function(e, t) {
                    return void 0 === e && (e = 3),
                    void 0 === t && (t = 500),
                    function(r, i, n) {
                        return 0 !== i.status || n >= e || -1 !== r.indexOf("file:") ? -1 : Math.pow(2, n) * t
                    }
                }
                ,
                e
            }();
            e.RetryStrategy = s;
            var y = function(t, r) {
                return t ? t instanceof e.Mesh ? null : t instanceof e.SubMesh ? t.clone(r) : t.clone ? t.clone() : null : null
            }
              , l = function() {
                function t() {}
                return t.FetchToRef = function(e, t, r, i, n, o) {
                    var a = 4 * ((Math.abs(e) * r % r | 0) + (Math.abs(t) * i % i | 0) * r);
                    o.r = n[a] / 255,
                    o.g = n[a + 1] / 255,
                    o.b = n[a + 2] / 255,
                    o.a = n[a + 3] / 255
                }
                ,
                t.Mix = function(e, t, r) {
                    return e * (1 - r) + t * r
                }
                ,
                t.Instantiate = function(e) {
                    if (t.RegisteredExternalClasses && t.RegisteredExternalClasses[e])
                        return t.RegisteredExternalClasses[e];
                    for (var r = e.split("."), i = window || this, n = 0, o = r.length; n < o; n++)
                        i = i[r[n]];
                    return "function" != typeof i ? null : i
                }
                ,
                t.Slice = function(e, t, r) {
                    return e.slice ? e.slice(t, r) : Array.prototype.slice.call(e, t, r)
                }
                ,
                t.SetImmediate = function(e) {
                    t.IsWindowObjectExist() && window.setImmediate ? window.setImmediate(e) : setTimeout(e, 1)
                }
                ,
                t.IsExponentOfTwo = function(e) {
                    var t = 1;
                    do {
                        t *= 2
                    } while (t < e);return t === e
                }
                ,
                t.FloatRound = function(e) {
                    return Math.fround ? Math.fround(e) : t._tmpFloatArray[0] = e
                }
                ,
                t.CeilingPOT = function(e) {
                    return e--,
                    e |= e >> 1,
                    e |= e >> 2,
                    e |= e >> 4,
                    e |= e >> 8,
                    e |= e >> 16,
                    ++e
                }
                ,
                t.FloorPOT = function(e) {
                    return e |= e >> 1,
                    e |= e >> 2,
                    e |= e >> 4,
                    e |= e >> 8,
                    (e |= e >> 16) - (e >> 1)
                }
                ,
                t.NearestPOT = function(e) {
                    var r = t.CeilingPOT(e)
                      , i = t.FloorPOT(e);
                    return r - e > e - i ? i : r
                }
                ,
                t.GetExponentOfTwo = function(r, i, n) {
                    var o;
                    switch (void 0 === n && (n = e.Engine.SCALEMODE_NEAREST),
                    n) {
                    case e.Engine.SCALEMODE_FLOOR:
                        o = t.FloorPOT(r);
                        break;
                    case e.Engine.SCALEMODE_NEAREST:
                        o = t.NearestPOT(r);
                        break;
                    case e.Engine.SCALEMODE_CEILING:
                    default:
                        o = t.CeilingPOT(r)
                    }
                    return Math.min(o, i)
                }
                ,
                t.GetFilename = function(e) {
                    var t = e.lastIndexOf("/");
                    return t < 0 ? e : e.substring(t + 1)
                }
                ,
                t.GetFolderPath = function(e, t) {
                    void 0 === t && (t = !1);
                    var r = e.lastIndexOf("/");
                    return r < 0 ? t ? e : "" : e.substring(0, r + 1)
                }
                ,
                t.GetDOMTextContent = function(e) {
                    for (var t = "", r = e.firstChild; r; )
                        3 === r.nodeType && (t += r.textContent),
                        r = r.nextSibling;
                    return t
                }
                ,
                t.ToDegrees = function(e) {
                    return 180 * e / Math.PI
                }
                ,
                t.ToRadians = function(e) {
                    return e * Math.PI / 180
                }
                ,
                t.EncodeArrayBufferTobase64 = function(e) {
                    for (var t, r, i, n, o, a, s, y = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", l = "", c = 0, h = new Uint8Array(e); c < h.length; )
                        n = (t = h[c++]) >> 2,
                        o = (3 & t) << 4 | (r = c < h.length ? h[c++] : Number.NaN) >> 4,
                        a = (15 & r) << 2 | (i = c < h.length ? h[c++] : Number.NaN) >> 6,
                        s = 63 & i,
                        isNaN(r) ? a = s = 64 : isNaN(i) && (s = 64),
                        l += y.charAt(n) + y.charAt(o) + y.charAt(a) + y.charAt(s);
                    return "data:image/png;base64," + l
                }
                ,
                t.ExtractMinAndMaxIndexed = function(t, r, i, n, o) {
                    void 0 === o && (o = null);
                    for (var a = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE), s = new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE), y = i; y < i + n; y++) {
                        var l = 3 * r[y]
                          , c = t[l]
                          , h = t[l + 1]
                          , u = t[l + 2];
                        a.minimizeInPlaceFromFloats(c, h, u),
                        s.maximizeInPlaceFromFloats(c, h, u)
                    }
                    return o && (a.x -= a.x * o.x + o.y,
                    a.y -= a.y * o.x + o.y,
                    a.z -= a.z * o.x + o.y,
                    s.x += s.x * o.x + o.y,
                    s.y += s.y * o.x + o.y,
                    s.z += s.z * o.x + o.y),
                    {
                        minimum: a,
                        maximum: s
                    }
                }
                ,
                t.ExtractMinAndMax = function(t, r, i, n, o) {
                    void 0 === n && (n = null);
                    var a = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)
                      , s = new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);
                    o || (o = 3);
                    for (var y = r, l = r * o; y < r + i; y++,
                    l += o) {
                        var c = t[l]
                          , h = t[l + 1]
                          , u = t[l + 2];
                        a.minimizeInPlaceFromFloats(c, h, u),
                        s.maximizeInPlaceFromFloats(c, h, u)
                    }
                    return n && (a.x -= a.x * n.x + n.y,
                    a.y -= a.y * n.x + n.y,
                    a.z -= a.z * n.x + n.y,
                    s.x += s.x * n.x + n.y,
                    s.y += s.y * n.x + n.y,
                    s.z += s.z * n.x + n.y),
                    {
                        minimum: a,
                        maximum: s
                    }
                }
                ,
                t.MakeArray = function(e, t) {
                    return !0 === t || void 0 !== e && null != e ? Array.isArray(e) ? e : [e] : null
                }
                ,
                t.GetPointerPrefix = function() {
                    var e = "pointer";
                    return !t.IsWindowObjectExist() || window.PointerEvent || navigator.pointerEnabled || (e = "mouse"),
                    e
                }
                ,
                t.QueueNewFrame = function(e, r) {
                    return t.IsWindowObjectExist() ? (r || (r = window),
                    r.requestAnimationFrame ? r.requestAnimationFrame(e) : r.msRequestAnimationFrame ? r.msRequestAnimationFrame(e) : r.webkitRequestAnimationFrame ? r.webkitRequestAnimationFrame(e) : r.mozRequestAnimationFrame ? r.mozRequestAnimationFrame(e) : r.oRequestAnimationFrame ? r.oRequestAnimationFrame(e) : window.setTimeout(e, 16)) : setTimeout(e, 16)
                }
                ,
                t.RequestFullscreen = function(e) {
                    var t = e.requestFullscreen || e.msRequestFullscreen || e.webkitRequestFullscreen || e.mozRequestFullScreen;
                    t && t.call(e)
                }
                ,
                t.ExitFullscreen = function() {
                    document.exitFullscreen ? document.exitFullscreen() : document.mozCancelFullScreen ? document.mozCancelFullScreen() : document.webkitCancelFullScreen ? document.webkitCancelFullScreen() : document.msCancelFullScreen && document.msCancelFullScreen()
                }
                ,
                t.SetCorsBehavior = function(e, r) {
                    if ((!e || 0 !== e.indexOf("data:")) && t.CorsBehavior)
                        if ("string" == typeof t.CorsBehavior || t.CorsBehavior instanceof String)
                            r.crossOrigin = t.CorsBehavior;
                        else {
                            var i = t.CorsBehavior(e);
                            i && (r.crossOrigin = i)
                        }
                }
                ,
                t.CleanUrl = function(e) {
                    return e = e.replace(/#/gm, "%23")
                }
                ,
                t.LoadImage = function(r, i, n, o) {
                    var a, s = !1;
                    r instanceof ArrayBuffer ? (a = URL.createObjectURL(new Blob([r])),
                    s = !0) : r instanceof Blob ? (a = URL.createObjectURL(r),
                    s = !0) : (a = t.CleanUrl(r),
                    a = t.PreprocessUrl(r));
                    var y = new Image;
                    t.SetCorsBehavior(a, y);
                    var l = function() {
                        s && y.src && URL.revokeObjectURL(y.src),
                        y.removeEventListener("load", l),
                        y.removeEventListener("error", c),
                        i(y)
                    }
                      , c = function(e) {
                        s && y.src && URL.revokeObjectURL(y.src),
                        y.removeEventListener("load", l),
                        y.removeEventListener("error", c),
                        t.Error("Error while trying to load image: " + r),
                        n && n("Error while trying to load image: " + r, e)
                    };
                    y.addEventListener("load", l),
                    y.addEventListener("error", c);
                    var h = function() {
                        y.src = a
                    };
                    if ("data:" !== a.substr(0, 5) && o && o.enableTexturesOffline && e.Database.IsUASupportingBlobStorage)
                        o.openAsync((function() {
                            o && o.loadImageFromDB(a, y)
                        }
                        ), h);
                    else {
                        if (-1 !== a.indexOf("file:")) {
                            var u = decodeURIComponent(a.substring(5).toLowerCase());
                            if (e.FilesInput.FilesToLoad[u]) {
                                try {
                                    var d;
                                    try {
                                        d = URL.createObjectURL(e.FilesInput.FilesToLoad[u])
                                    } catch (t) {
                                        d = URL.createObjectURL(e.FilesInput.FilesToLoad[u])
                                    }
                                    y.src = d,
                                    s = !0
                                } catch (e) {
                                    y.src = ""
                                }
                                return y
                            }
                        }
                        h()
                    }
                    return y
                }
                ,
                t.LoadFile = function(r, i, o, a, s, y) {
                    if (r = t.CleanUrl(r),
                    -1 !== (r = t.PreprocessUrl(r)).indexOf("file:")) {
                        var l = decodeURIComponent(r.substring(5).toLowerCase());
                        if (e.FilesInput.FilesToLoad[l])
                            return t.ReadFile(e.FilesInput.FilesToLoad[l], i, o, s)
                    }
                    var c = t.BaseUrl + r
                      , h = !1
                      , u = {
                        onCompleteObservable: new e.Observable,
                        abort: function() {
                            return h = !0
                        }
                    }
                      , d = function() {
                        var e = new XMLHttpRequest
                          , r = null;
                        u.abort = function() {
                            h = !0,
                            e.readyState !== (XMLHttpRequest.DONE || 4) && e.abort(),
                            null !== r && (clearTimeout(r),
                            r = null)
                        }
                        ;
                        var a = function(l) {
                            e.open("GET", c, !0),
                            s && (e.responseType = "arraybuffer"),
                            o && e.addEventListener("progress", o);
                            var d = function() {
                                e.removeEventListener("loadend", d),
                                u.onCompleteObservable.notifyObservers(u),
                                u.onCompleteObservable.clear()
                            };
                            e.addEventListener("loadend", d);
                            var x = function() {
                                if (!h && e.readyState === (XMLHttpRequest.DONE || 4)) {
                                    if (e.removeEventListener("readystatechange", x),
                                    e.status >= 200 && e.status < 300 || 0 === e.status && (!t.IsWindowObjectExist() || t.IsFileURL()))
                                        return void i(s ? e.response : e.responseText, e.responseURL);
                                    var o = t.DefaultRetryStrategy;
                                    if (o) {
                                        var u = o(c, e, l);
                                        if (-1 !== u)
                                            return e.removeEventListener("loadend", d),
                                            e = new XMLHttpRequest,
                                            void (r = setTimeout((function() {
                                                return a(l + 1)
                                            }
                                            ), u))
                                    }
                                    var p = new n("Error status: " + e.status + " " + e.statusText + " - Unable to load " + c,e);
                                    if (!y)
                                        throw p;
                                    y(e, p)
                                }
                            };
                            e.addEventListener("readystatechange", x),
                            e.send()
                        };
                        a(0)
                    };
                    if (a && a.enableSceneOffline) {
                        var x = function(e) {
                            e && e.status > 400 ? y && y(e) : h || d()
                        };
                        a.openAsync((function() {
                            h || a && a.loadFileFromDB(r, (function(e) {
                                h || i(e),
                                u.onCompleteObservable.notifyObservers(u)
                            }
                            ), o ? function(e) {
                                h || o(e)
                            }
                            : void 0, x, s)
                        }
                        ), x)
                    } else
                        d();
                    return u
                }
                ,
                t.LoadScript = function(e, r, i) {
                    if (t.IsWindowObjectExist()) {
                        var n = document.getElementsByTagName("head")[0]
                          , o = document.createElement("script");
                        o.type = "text/javascript",
                        o.src = e,
                        o.onload = function() {
                            r && r()
                        }
                        ,
                        o.onerror = function(t) {
                            i && i("Unable to load script '" + e + "'", t)
                        }
                        ,
                        n.appendChild(o)
                    }
                }
                ,
                t.ReadFileAsDataURL = function(t, r, i) {
                    var n = new FileReader
                      , o = {
                        onCompleteObservable: new e.Observable,
                        abort: function() {
                            return n.abort()
                        }
                    };
                    return n.onloadend = function(e) {
                        o.onCompleteObservable.notifyObservers(o)
                    }
                    ,
                    n.onload = function(e) {
                        r(e.target.result)
                    }
                    ,
                    n.onprogress = i,
                    n.readAsDataURL(t),
                    o
                }
                ,
                t.ReadFile = function(r, i, n, o) {
                    var a = new FileReader
                      , s = {
                        onCompleteObservable: new e.Observable,
                        abort: function() {
                            return a.abort()
                        }
                    };
                    return a.onloadend = function(e) {
                        return s.onCompleteObservable.notifyObservers(s)
                    }
                    ,
                    a.onerror = function(e) {
                        t.Log("Error while reading file: " + r.name),
                        i(JSON.stringify({
                            autoClear: !0,
                            clearColor: [1, 0, 0],
                            ambientColor: [0, 0, 0],
                            gravity: [0, -9.807, 0],
                            meshes: [],
                            cameras: [],
                            lights: []
                        }))
                    }
                    ,
                    a.onload = function(e) {
                        i(e.target.result)
                    }
                    ,
                    n && (a.onprogress = n),
                    o ? a.readAsArrayBuffer(r) : a.readAsText(r),
                    s
                }
                ,
                t.FileAsURL = function(e) {
                    var t = new Blob([e]);
                    return (window.URL || window.webkitURL).createObjectURL(t)
                }
                ,
                t.Format = function(e, t) {
                    return void 0 === t && (t = 2),
                    e.toFixed(t)
                }
                ,
                t.CheckExtends = function(e, t, r) {
                    e.x < t.x && (t.x = e.x),
                    e.y < t.y && (t.y = e.y),
                    e.z < t.z && (t.z = e.z),
                    e.x > r.x && (r.x = e.x),
                    e.y > r.y && (r.y = e.y),
                    e.z > r.z && (r.z = e.z)
                }
                ,
                t.DeepCopy = function(e, t, r, i) {
                    for (var n in e)
                        if (("_" !== n[0] || i && -1 !== i.indexOf(n)) && (!r || -1 === r.indexOf(n))) {
                            var o = e[n]
                              , a = typeof o;
                            if ("function" !== a)
                                try {
                                    if ("object" === a)
                                        if (o instanceof Array) {
                                            if (t[n] = [],
                                            o.length > 0)
                                                if ("object" == typeof o[0])
                                                    for (var s = 0; s < o.length; s++) {
                                                        var l = y(o[s], t);
                                                        -1 === t[n].indexOf(l) && t[n].push(l)
                                                    }
                                                else
                                                    t[n] = o.slice(0)
                                        } else
                                            t[n] = y(o, t);
                                    else
                                        t[n] = o
                                } catch (e) {}
                        }
                }
                ,
                t.IsEmpty = function(e) {
                    for (var t in e)
                        if (e.hasOwnProperty(t))
                            return !1;
                    return !0
                }
                ,
                t.RegisterTopRootEvents = function(e) {
                    for (var t = 0; t < e.length; t++) {
                        var r = e[t];
                        window.addEventListener(r.name, r.handler, !1);
                        try {
                            window.parent && window.parent.addEventListener(r.name, r.handler, !1)
                        } catch (e) {}
                    }
                }
                ,
                t.UnregisterTopRootEvents = function(e) {
                    for (var t = 0; t < e.length; t++) {
                        var r = e[t];
                        window.removeEventListener(r.name, r.handler);
                        try {
                            window.parent && window.parent.removeEventListener(r.name, r.handler)
                        } catch (e) {}
                    }
                }
                ,
                t.DumpFramebuffer = function(e, r, i, n, o, s) {
                    void 0 === o && (o = "image/png");
                    for (var y = 4 * e, l = r / 2, c = i.readPixels(0, 0, e, r), h = 0; h < l; h++)
                        for (var u = 0; u < y; u++) {
                            var d = u + h * y
                              , x = u + (r - h - 1) * y
                              , p = c[d];
                            c[d] = c[x],
                            c[x] = p
                        }
                    a || (a = document.createElement("canvas")),
                    a.width = e,
                    a.height = r;
                    var f = a.getContext("2d");
                    if (f) {
                        var m = f.createImageData(e, r);
                        m.data.set(c),
                        f.putImageData(m, 0, 0),
                        t.EncodeScreenshotCanvasData(n, o, s)
                    }
                }
                ,
                t.ToBlob = function(e, t, r) {
                    void 0 === r && (r = "image/png"),
                    e.toBlob || (e.toBlob = function(e, t, r) {
                        var i = this;
                        setTimeout((function() {
                            for (var n = atob(i.toDataURL(t, r).split(",")[1]), o = n.length, a = new Uint8Array(o), s = 0; s < o; s++)
                                a[s] = n.charCodeAt(s);
                            e(new Blob([a]))
                        }
                        ))
                    }
                    ),
                    e.toBlob((function(e) {
                        t(e)
                    }
                    ), r)
                }
                ,
                t.EncodeScreenshotCanvasData = function(e, r, i) {
                    (void 0 === r && (r = "image/png"),
                    e) ? e(a.toDataURL(r)) : this.ToBlob(a, (function(e) {
                        if ("download"in document.createElement("a")) {
                            if (!i) {
                                var r = new Date
                                  , n = (r.getFullYear() + "-" + (r.getMonth() + 1)).slice(2) + "-" + r.getDate() + "_" + r.getHours() + "-" + ("0" + r.getMinutes()).slice(-2);
                                i = "screenshot_" + n + ".png"
                            }
                            t.Download(e, i)
                        } else {
                            var o = URL.createObjectURL(e)
                              , a = window.open("");
                            if (!a)
                                return;
                            var s = a.document.createElement("img");
                            s.onload = function() {
                                URL.revokeObjectURL(o)
                            }
                            ,
                            s.src = o,
                            a.document.body.appendChild(s)
                        }
                    }
                    ), r)
                }
                ,
                t.Download = function(e, t) {
                    if (navigator && navigator.msSaveBlob)
                        navigator.msSaveBlob(e, t);
                    else {
                        var r = window.URL.createObjectURL(e)
                          , i = document.createElement("a");
                        document.body.appendChild(i),
                        i.style.display = "none",
                        i.href = r,
                        i.download = t,
                        i.addEventListener("click", (function() {
                            i.parentElement && i.parentElement.removeChild(i)
                        }
                        )),
                        i.click(),
                        window.URL.revokeObjectURL(r)
                    }
                }
                ,
                t.CreateScreenshot = function(e, r, i, n, o) {
                    var s, y;
                    if (void 0 === o && (o = "image/png"),
                    i.precision)
                        s = Math.round(e.getRenderWidth() * i.precision),
                        y = Math.round(s / e.getAspectRatio(r));
                    else if (i.width && i.height)
                        s = i.width,
                        y = i.height;
                    else if (i.width && !i.height)
                        s = i.width,
                        y = Math.round(s / e.getAspectRatio(r));
                    else if (i.height && !i.width)
                        y = i.height,
                        s = Math.round(y * e.getAspectRatio(r));
                    else {
                        if (isNaN(i))
                            return void t.Error("Invalid 'size' parameter !");
                        y = i,
                        s = i
                    }
                    a || (a = document.createElement("canvas")),
                    a.width = s,
                    a.height = y;
                    var l = a.getContext("2d")
                      , c = e.getRenderWidth() / e.getRenderHeight()
                      , h = s
                      , u = h / c;
                    u > y && (h = (u = y) * c);
                    var d = Math.max(0, s - h) / 2
                      , x = Math.max(0, y - u) / 2
                      , p = e.getRenderingCanvas();
                    l && p && l.drawImage(p, d, x, h, u),
                    t.EncodeScreenshotCanvasData(n, o)
                }
                ,
                t.CreateScreenshotUsingRenderTarget = function(r, i, n, o, a, s, y, l) {
                    var c, h;
                    if (void 0 === a && (a = "image/png"),
                    void 0 === s && (s = 1),
                    void 0 === y && (y = !1),
                    n.precision)
                        c = Math.round(r.getRenderWidth() * n.precision),
                        h = Math.round(c / r.getAspectRatio(i)),
                        n = {
                            width: c,
                            height: h
                        };
                    else if (n.width && n.height)
                        c = n.width,
                        h = n.height;
                    else if (n.width && !n.height)
                        c = n.width,
                        h = Math.round(c / r.getAspectRatio(i)),
                        n = {
                            width: c,
                            height: h
                        };
                    else if (n.height && !n.width)
                        h = n.height,
                        n = {
                            width: c = Math.round(h * r.getAspectRatio(i)),
                            height: h
                        };
                    else {
                        if (isNaN(n))
                            return void t.Error("Invalid 'size' parameter !");
                        h = n,
                        c = n
                    }
                    var u = i.getScene()
                      , d = null;
                    u.activeCamera !== i && (d = u.activeCamera,
                    u.activeCamera = i);
                    var x = new e.RenderTargetTexture("screenShot",n,u,!1,!1,e.Engine.TEXTURETYPE_UNSIGNED_INT,!1,e.Texture.NEAREST_SAMPLINGMODE);
                    x.renderList = null,
                    x.samples = s,
                    y && x.addPostProcess(new e.FxaaPostProcess("antialiasing",1,u.activeCamera)),
                    x.onAfterRenderObservable.add((function() {
                        t.DumpFramebuffer(c, h, r, o, a, l)
                    }
                    )),
                    u.incrementRenderId(),
                    u.resetCachedMaterial(),
                    x.render(!0),
                    x.dispose(),
                    d && (u.activeCamera = d),
                    i.getProjectionMatrix(!0)
                }
                ,
                t.ValidateXHRData = function(t, r) {
                    void 0 === r && (r = 7);
                    try {
                        if (1 & r) {
                            if (t.responseText && t.responseText.length > 0)
                                return !0;
                            if (1 === r)
                                return !1
                        }
                        if (2 & r) {
                            var i = e.TGATools.GetTGAHeader(t.response);
                            if (i.width && i.height && i.width > 0 && i.height > 0)
                                return !0;
                            if (2 === r)
                                return !1
                        }
                        if (4 & r) {
                            var n = new Uint8Array(t.response,0,3);
                            return 68 === n[0] && 68 === n[1] && 83 === n[2]
                        }
                    } catch (e) {}
                    return !1
                }
                ,
                t.RandomId = function() {
                    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (function(e) {
                        var t = 16 * Math.random() | 0;
                        return ("x" === e ? t : 3 & t | 8).toString(16)
                    }
                    ))
                }
                ,
                t.IsBase64 = function(e) {
                    return !(e.length < 5) && "data:" === e.substr(0, 5)
                }
                ,
                t.DecodeBase64 = function(e) {
                    for (var t = atob(e.split(",")[1]), r = t.length, i = new Uint8Array(new ArrayBuffer(r)), n = 0; n < r; n++)
                        i[n] = t.charCodeAt(n);
                    return i.buffer
                }
                ,
                t._AddLogEntry = function(e) {
                    t._LogCache = e + t._LogCache,
                    t.OnNewCacheEntry && t.OnNewCacheEntry(e)
                }
                ,
                t._FormatMessage = function(e) {
                    var t = function(e) {
                        return e < 10 ? "0" + e : "" + e
                    }
                      , r = new Date;
                    return "[" + t(r.getHours()) + ":" + t(r.getMinutes()) + ":" + t(r.getSeconds()) + "]: " + e
                }
                ,
                t._LogDisabled = function(e) {}
                ,
                t._LogEnabled = function(e) {
                    var r = t._FormatMessage(e);
                    console.log("BJS - " + r);
                    var i = "<div style='color:white'>" + r + "</div><br>";
                    t._AddLogEntry(i)
                }
                ,
                t._WarnDisabled = function(e) {}
                ,
                t._WarnEnabled = function(e) {
                    var r = t._FormatMessage(e);
                    console.warn("BJS - " + r);
                    var i = "<div style='color:orange'>" + r + "</div><br>";
                    t._AddLogEntry(i)
                }
                ,
                t._ErrorDisabled = function(e) {}
                ,
                t._ErrorEnabled = function(e) {
                    t.errorsCount++;
                    var r = t._FormatMessage(e);
                    console.error("BJS - " + r);
                    var i = "<div style='color:red'>" + r + "</div><br>";
                    t._AddLogEntry(i)
                }
                ,
                Object.defineProperty(t, "LogCache", {
                    get: function() {
                        return t._LogCache
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.ClearLogCache = function() {
                    t._LogCache = "",
                    t.errorsCount = 0
                }
                ,
                Object.defineProperty(t, "LogLevels", {
                    set: function(e) {
                        (e & t.MessageLogLevel) === t.MessageLogLevel ? t.Log = t._LogEnabled : t.Log = t._LogDisabled,
                        (e & t.WarningLogLevel) === t.WarningLogLevel ? t.Warn = t._WarnEnabled : t.Warn = t._WarnDisabled,
                        (e & t.ErrorLogLevel) === t.ErrorLogLevel ? t.Error = t._ErrorEnabled : t.Error = t._ErrorDisabled
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.IsFileURL = function() {
                    return "file:" === location.protocol
                }
                ,
                t.IsWindowObjectExist = function() {
                    return "undefined" != typeof window
                }
                ,
                Object.defineProperty(t, "PerformanceLogLevel", {
                    set: function(e) {
                        return (e & t.PerformanceUserMarkLogLevel) === t.PerformanceUserMarkLogLevel ? (t.StartPerformanceCounter = t._StartUserMark,
                        void (t.EndPerformanceCounter = t._EndUserMark)) : (e & t.PerformanceConsoleLogLevel) === t.PerformanceConsoleLogLevel ? (t.StartPerformanceCounter = t._StartPerformanceConsole,
                        void (t.EndPerformanceCounter = t._EndPerformanceConsole)) : (t.StartPerformanceCounter = t._StartPerformanceCounterDisabled,
                        void (t.EndPerformanceCounter = t._EndPerformanceCounterDisabled))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t._StartPerformanceCounterDisabled = function(e, t) {}
                ,
                t._EndPerformanceCounterDisabled = function(e, t) {}
                ,
                t._StartUserMark = function(e, r) {
                    if (void 0 === r && (r = !0),
                    !t._performance) {
                        if (!t.IsWindowObjectExist())
                            return;
                        t._performance = window.performance
                    }
                    r && t._performance.mark && t._performance.mark(e + "-Begin")
                }
                ,
                t._EndUserMark = function(e, r) {
                    void 0 === r && (r = !0),
                    r && t._performance.mark && (t._performance.mark(e + "-End"),
                    t._performance.measure(e, e + "-Begin", e + "-End"))
                }
                ,
                t._StartPerformanceConsole = function(e, r) {
                    void 0 === r && (r = !0),
                    r && (t._StartUserMark(e, r),
                    console.time && console.time(e))
                }
                ,
                t._EndPerformanceConsole = function(e, r) {
                    void 0 === r && (r = !0),
                    r && (t._EndUserMark(e, r),
                    console.time && console.timeEnd(e))
                }
                ,
                Object.defineProperty(t, "Now", {
                    get: function() {
                        return t.IsWindowObjectExist() && window.performance && window.performance.now ? window.performance.now() : Date.now()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.GetClassName = function(e, t) {
                    void 0 === t && (t = !1);
                    var r = null;
                    if (!t && e.getClassName)
                        r = e.getClassName();
                    else {
                        if (e instanceof Object)
                            r = (t ? e : Object.getPrototypeOf(e)).constructor.__bjsclassName__;
                        r || (r = typeof e)
                    }
                    return r
                }
                ,
                t.First = function(e, t) {
                    for (var r = 0, i = e; r < i.length; r++) {
                        var n = i[r];
                        if (t(n))
                            return n
                    }
                    return null
                }
                ,
                t.getFullClassName = function(e, t) {
                    void 0 === t && (t = !1);
                    var r = null
                      , i = null;
                    if (!t && e.getClassName)
                        r = e.getClassName();
                    else {
                        if (e instanceof Object) {
                            var n = t ? e : Object.getPrototypeOf(e);
                            r = n.constructor.__bjsclassName__,
                            i = n.constructor.__bjsmoduleName__
                        }
                        r || (r = typeof e)
                    }
                    return r ? (null != i ? i + "." : "") + r : null
                }
                ,
                t.DelayAsync = function(e) {
                    return new Promise((function(t) {
                        setTimeout((function() {
                            t()
                        }
                        ), e)
                    }
                    ))
                }
                ,
                t.GetCurrentGradient = function(e, t, r) {
                    for (var i = 0; i < t.length - 1; i++) {
                        var n = t[i]
                          , o = t[i + 1];
                        if (e >= n.gradient && e <= o.gradient)
                            return void r(n, o, (e - n.gradient) / (o.gradient - n.gradient))
                    }
                    var a = t.length - 1;
                    r(t[a], t[a], 1)
                }
                ,
                t.BaseUrl = "",
                t.DefaultRetryStrategy = s.ExponentialBackoff(),
                t.CorsBehavior = "anonymous",
                t.UseFallbackTexture = !0,
                t.RegisteredExternalClasses = {},
                t.fallbackTexture = "data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",
                t._tmpFloatArray = new Float32Array(1),
                t.PreprocessUrl = function(e) {
                    return e
                }
                ,
                t.NoneLogLevel = 0,
                t.MessageLogLevel = 1,
                t.WarningLogLevel = 2,
                t.ErrorLogLevel = 4,
                t.AllLogLevel = 7,
                t._LogCache = "",
                t.errorsCount = 0,
                t.Log = t._LogEnabled,
                t.Warn = t._WarnEnabled,
                t.Error = t._ErrorEnabled,
                t.PerformanceNoneLogLevel = 0,
                t.PerformanceUserMarkLogLevel = 1,
                t.PerformanceConsoleLogLevel = 2,
                t.StartPerformanceCounter = t._StartPerformanceCounterDisabled,
                t.EndPerformanceCounter = t._EndPerformanceCounterDisabled,
                t
            }();
            e.Tools = l;
            var c = function() {
                function e() {
                    this._startMonitoringTime = 0,
                    this._min = 0,
                    this._max = 0,
                    this._average = 0,
                    this._lastSecAverage = 0,
                    this._current = 0,
                    this._totalValueCount = 0,
                    this._totalAccumulated = 0,
                    this._lastSecAccumulated = 0,
                    this._lastSecTime = 0,
                    this._lastSecValueCount = 0
                }
                return Object.defineProperty(e.prototype, "min", {
                    get: function() {
                        return this._min
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "max", {
                    get: function() {
                        return this._max
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "average", {
                    get: function() {
                        return this._average
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "lastSecAverage", {
                    get: function() {
                        return this._lastSecAverage
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "current", {
                    get: function() {
                        return this._current
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "total", {
                    get: function() {
                        return this._totalAccumulated
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "count", {
                    get: function() {
                        return this._totalValueCount
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype.fetchNewFrame = function() {
                    this._totalValueCount++,
                    this._current = 0,
                    this._lastSecValueCount++
                }
                ,
                e.prototype.addCount = function(t, r) {
                    e.Enabled && (this._current += t,
                    r && this._fetchResult())
                }
                ,
                e.prototype.beginMonitoring = function() {
                    e.Enabled && (this._startMonitoringTime = l.Now)
                }
                ,
                e.prototype.endMonitoring = function(t) {
                    if (void 0 === t && (t = !0),
                    e.Enabled) {
                        t && this.fetchNewFrame();
                        var r = l.Now;
                        this._current = r - this._startMonitoringTime,
                        t && this._fetchResult()
                    }
                }
                ,
                e.prototype._fetchResult = function() {
                    this._totalAccumulated += this._current,
                    this._lastSecAccumulated += this._current,
                    this._min = Math.min(this._min, this._current),
                    this._max = Math.max(this._max, this._current),
                    this._average = this._totalAccumulated / this._totalValueCount;
                    var e = l.Now;
                    e - this._lastSecTime > 1e3 && (this._lastSecAverage = this._lastSecAccumulated / this._lastSecValueCount,
                    this._lastSecTime = e,
                    this._lastSecAccumulated = 0,
                    this._lastSecValueCount = 0)
                }
                ,
                e.Enabled = !0,
                e
            }();
            e.PerfCounter = c,
            e.className = function(e, t) {
                return function(r) {
                    r.__bjsclassName__ = e,
                    r.__bjsmoduleName__ = null != t ? t : null
                }
            }
            ;
            var h = function() {
                function e(e, t, r, i) {
                    void 0 === i && (i = 0),
                    this.iterations = e,
                    this.index = i - 1,
                    this._done = !1,
                    this._fn = t,
                    this._successCallback = r
                }
                return e.prototype.executeNext = function() {
                    this._done || (this.index + 1 < this.iterations ? (++this.index,
                    this._fn(this)) : this.breakLoop())
                }
                ,
                e.prototype.breakLoop = function() {
                    this._done = !0,
                    this._successCallback()
                }
                ,
                e.Run = function(t, r, i, n) {
                    void 0 === n && (n = 0);
                    var o = new e(t,r,i,n);
                    return o.executeNext(),
                    o
                }
                ,
                e.SyncAsyncForLoop = function(t, r, i, n, o, a) {
                    return void 0 === a && (a = 0),
                    e.Run(Math.ceil(t / r), (function(e) {
                        o && o() ? e.breakLoop() : setTimeout((function() {
                            for (var n = 0; n < r; ++n) {
                                var a = e.index * r + n;
                                if (a >= t)
                                    break;
                                if (i(a),
                                o && o()) {
                                    e.breakLoop();
                                    break
                                }
                            }
                            e.executeNext()
                        }
                        ), a)
                    }
                    ), n)
                }
                ,
                e
            }();
            e.AsyncLoop = h
        }(s || (s = {})),
        function(e) {
            var t;
            !function(e) {
                e[e.Pending = 0] = "Pending",
                e[e.Fulfilled = 1] = "Fulfilled",
                e[e.Rejected = 2] = "Rejected"
            }(t || (t = {}));
            var r = function() {
                this.count = 0,
                this.target = 0,
                this.results = []
            }
              , i = function() {
                function i(e) {
                    var r = this;
                    if (this._state = t.Pending,
                    this._children = new Array,
                    this._rejectWasConsumed = !1,
                    e)
                        try {
                            e((function(e) {
                                r._resolve(e)
                            }
                            ), (function(e) {
                                r._reject(e)
                            }
                            ))
                        } catch (e) {
                            this._reject(e)
                        }
                }
                return Object.defineProperty(i.prototype, "_result", {
                    get: function() {
                        return this._resultValue
                    },
                    set: function(e) {
                        this._resultValue = e,
                        this._parent && void 0 === this._parent._result && (this._parent._result = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.catch = function(e) {
                    return this.then(void 0, e)
                }
                ,
                i.prototype.then = function(r, n) {
                    var o = this
                      , a = new i;
                    return a._onFulfilled = r,
                    a._onRejected = n,
                    this._children.push(a),
                    a._parent = this,
                    this._state !== t.Pending && e.Tools.SetImmediate((function() {
                        if (o._state === t.Fulfilled || o._rejectWasConsumed) {
                            var e = a._resolve(o._result);
                            if (null != e)
                                if (void 0 !== e._state) {
                                    var r = e;
                                    a._children.push(r),
                                    r._parent = a,
                                    a = r
                                } else
                                    a._result = e
                        } else
                            a._reject(o._reason)
                    }
                    )),
                    a
                }
                ,
                i.prototype._moveChildren = function(e) {
                    var r, i = this;
                    if ((r = this._children).push.apply(r, e.splice(0, e.length)),
                    this._children.forEach((function(e) {
                        e._parent = i
                    }
                    )),
                    this._state === t.Fulfilled)
                        for (var n = 0, o = this._children; n < o.length; n++) {
                            o[n]._resolve(this._result)
                        }
                    else if (this._state === t.Rejected)
                        for (var a = 0, s = this._children; a < s.length; a++) {
                            s[a]._reject(this._reason)
                        }
                }
                ,
                i.prototype._resolve = function(e) {
                    try {
                        this._state = t.Fulfilled;
                        var r = null;
                        if (this._onFulfilled && (r = this._onFulfilled(e)),
                        null != r)
                            if (void 0 !== r._state) {
                                var i = r;
                                i._parent = this,
                                i._moveChildren(this._children),
                                e = i._result
                            } else
                                e = r;
                        this._result = e;
                        for (var n = 0, o = this._children; n < o.length; n++) {
                            o[n]._resolve(e)
                        }
                        this._children.length = 0,
                        delete this._onFulfilled,
                        delete this._onRejected
                    } catch (e) {
                        this._reject(e, !0)
                    }
                }
                ,
                i.prototype._reject = function(e, r) {
                    if (void 0 === r && (r = !1),
                    this._state = t.Rejected,
                    this._reason = e,
                    this._onRejected && !r)
                        try {
                            this._onRejected(e),
                            this._rejectWasConsumed = !0
                        } catch (t) {
                            e = t
                        }
                    for (var i = 0, n = this._children; i < n.length; i++) {
                        var o = n[i];
                        this._rejectWasConsumed ? o._resolve(null) : o._reject(e)
                    }
                    this._children.length = 0,
                    delete this._onFulfilled,
                    delete this._onRejected
                }
                ,
                i.resolve = function(e) {
                    var t = new i;
                    return t._resolve(e),
                    t
                }
                ,
                i._RegisterForFulfillment = function(e, r, i) {
                    e.then((function(e) {
                        return r.results[i] = e,
                        r.count++,
                        r.count === r.target && r.rootPromise._resolve(r.results),
                        null
                    }
                    ), (function(e) {
                        r.rootPromise._state !== t.Rejected && r.rootPromise._reject(e)
                    }
                    ))
                }
                ,
                i.all = function(e) {
                    var t = new i
                      , n = new r;
                    if (n.target = e.length,
                    n.rootPromise = t,
                    e.length)
                        for (var o = 0; o < e.length; o++)
                            i._RegisterForFulfillment(e[o], n, o);
                    else
                        t._resolve([]);
                    return t
                }
                ,
                i.race = function(e) {
                    var t = new i;
                    if (e.length)
                        for (var r = 0, n = e; r < n.length; r++) {
                            n[r].then((function(e) {
                                return t && (t._resolve(e),
                                t = null),
                                null
                            }
                            ), (function(e) {
                                t && (t._reject(e),
                                t = null)
                            }
                            ))
                        }
                    return t
                }
                ,
                i
            }()
              , n = function() {
                function e() {}
                return e.Apply = function(e) {
                    (void 0 === e && (e = !1),
                    e || "undefined" == typeof Promise) && (window.Promise = i)
                }
                ,
                e
            }();
            e.PromisePolyfill = n
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e(e) {
                    this._pendingActions = new Array,
                    this._workerInfos = e.map((function(e) {
                        return {
                            worker: e,
                            active: !1
                        }
                    }
                    ))
                }
                return e.prototype.dispose = function() {
                    for (var e = 0, t = this._workerInfos; e < t.length; e++) {
                        t[e].worker.terminate()
                    }
                    delete this._workerInfos,
                    delete this._pendingActions
                }
                ,
                e.prototype.push = function(e) {
                    for (var t = 0, r = this._workerInfos; t < r.length; t++) {
                        var i = r[t];
                        if (!i.active)
                            return void this._execute(i, e)
                    }
                    this._pendingActions.push(e)
                }
                ,
                e.prototype._execute = function(e, t) {
                    var r = this;
                    e.active = !0,
                    t(e.worker, (function() {
                        e.active = !1;
                        var t = r._pendingActions.shift();
                        t && r._execute(e, t)
                    }
                    ))
                }
                ,
                e
            }();
            e.WorkerPool = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {
                    this._isAlphaBlendDirty = !1,
                    this._isBlendFunctionParametersDirty = !1,
                    this._isBlendEquationParametersDirty = !1,
                    this._isBlendConstantsDirty = !1,
                    this._alphaBlend = !1,
                    this._blendFunctionParameters = new Array(4),
                    this._blendEquationParameters = new Array(2),
                    this._blendConstants = new Array(4),
                    this.reset()
                }
                return Object.defineProperty(e.prototype, "isDirty", {
                    get: function() {
                        return this._isAlphaBlendDirty || this._isBlendFunctionParametersDirty
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "alphaBlend", {
                    get: function() {
                        return this._alphaBlend
                    },
                    set: function(e) {
                        this._alphaBlend !== e && (this._alphaBlend = e,
                        this._isAlphaBlendDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype.setAlphaBlendConstants = function(e, t, r, i) {
                    this._blendConstants[0] === e && this._blendConstants[1] === t && this._blendConstants[2] === r && this._blendConstants[3] === i || (this._blendConstants[0] = e,
                    this._blendConstants[1] = t,
                    this._blendConstants[2] = r,
                    this._blendConstants[3] = i,
                    this._isBlendConstantsDirty = !0)
                }
                ,
                e.prototype.setAlphaBlendFunctionParameters = function(e, t, r, i) {
                    this._blendFunctionParameters[0] === e && this._blendFunctionParameters[1] === t && this._blendFunctionParameters[2] === r && this._blendFunctionParameters[3] === i || (this._blendFunctionParameters[0] = e,
                    this._blendFunctionParameters[1] = t,
                    this._blendFunctionParameters[2] = r,
                    this._blendFunctionParameters[3] = i,
                    this._isBlendFunctionParametersDirty = !0)
                }
                ,
                e.prototype.setAlphaEquationParameters = function(e, t) {
                    this._blendEquationParameters[0] === e && this._blendEquationParameters[1] === t || (this._blendEquationParameters[0] = e,
                    this._blendEquationParameters[1] = t,
                    this._isBlendEquationParametersDirty = !0)
                }
                ,
                e.prototype.reset = function() {
                    this._alphaBlend = !1,
                    this._blendFunctionParameters[0] = null,
                    this._blendFunctionParameters[1] = null,
                    this._blendFunctionParameters[2] = null,
                    this._blendFunctionParameters[3] = null,
                    this._blendEquationParameters[0] = null,
                    this._blendEquationParameters[1] = null,
                    this._blendConstants[0] = null,
                    this._blendConstants[1] = null,
                    this._blendConstants[2] = null,
                    this._blendConstants[3] = null,
                    this._isAlphaBlendDirty = !0,
                    this._isBlendFunctionParametersDirty = !1,
                    this._isBlendEquationParametersDirty = !1,
                    this._isBlendConstantsDirty = !1
                }
                ,
                e.prototype.apply = function(e) {
                    this.isDirty && (this._isAlphaBlendDirty && (this._alphaBlend ? e.enable(e.BLEND) : e.disable(e.BLEND),
                    this._isAlphaBlendDirty = !1),
                    this._isBlendFunctionParametersDirty && (e.blendFuncSeparate(this._blendFunctionParameters[0], this._blendFunctionParameters[1], this._blendFunctionParameters[2], this._blendFunctionParameters[3]),
                    this._isBlendFunctionParametersDirty = !1),
                    this._isBlendEquationParametersDirty && (e.blendEquationSeparate(this._blendEquationParameters[0], this._blendEquationParameters[1]),
                    this._isBlendEquationParametersDirty = !1),
                    this._isBlendConstantsDirty && (e.blendColor(this._blendConstants[0], this._blendConstants[1], this._blendConstants[2], this._blendConstants[3]),
                    this._isBlendConstantsDirty = !1))
                }
                ,
                e
            }();
            e._AlphaState = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {
                    this._isDepthTestDirty = !1,
                    this._isDepthMaskDirty = !1,
                    this._isDepthFuncDirty = !1,
                    this._isCullFaceDirty = !1,
                    this._isCullDirty = !1,
                    this._isZOffsetDirty = !1,
                    this._isFrontFaceDirty = !1,
                    this.reset()
                }
                return Object.defineProperty(e.prototype, "isDirty", {
                    get: function() {
                        return this._isDepthFuncDirty || this._isDepthTestDirty || this._isDepthMaskDirty || this._isCullFaceDirty || this._isCullDirty || this._isZOffsetDirty || this._isFrontFaceDirty
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "zOffset", {
                    get: function() {
                        return this._zOffset
                    },
                    set: function(e) {
                        this._zOffset !== e && (this._zOffset = e,
                        this._isZOffsetDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "cullFace", {
                    get: function() {
                        return this._cullFace
                    },
                    set: function(e) {
                        this._cullFace !== e && (this._cullFace = e,
                        this._isCullFaceDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "cull", {
                    get: function() {
                        return this._cull
                    },
                    set: function(e) {
                        this._cull !== e && (this._cull = e,
                        this._isCullDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "depthFunc", {
                    get: function() {
                        return this._depthFunc
                    },
                    set: function(e) {
                        this._depthFunc !== e && (this._depthFunc = e,
                        this._isDepthFuncDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "depthMask", {
                    get: function() {
                        return this._depthMask
                    },
                    set: function(e) {
                        this._depthMask !== e && (this._depthMask = e,
                        this._isDepthMaskDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "depthTest", {
                    get: function() {
                        return this._depthTest
                    },
                    set: function(e) {
                        this._depthTest !== e && (this._depthTest = e,
                        this._isDepthTestDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "frontFace", {
                    get: function() {
                        return this._frontFace
                    },
                    set: function(e) {
                        this._frontFace !== e && (this._frontFace = e,
                        this._isFrontFaceDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype.reset = function() {
                    this._depthMask = !0,
                    this._depthTest = !0,
                    this._depthFunc = null,
                    this._cullFace = null,
                    this._cull = null,
                    this._zOffset = 0,
                    this._frontFace = null,
                    this._isDepthTestDirty = !0,
                    this._isDepthMaskDirty = !0,
                    this._isDepthFuncDirty = !1,
                    this._isCullFaceDirty = !1,
                    this._isCullDirty = !1,
                    this._isZOffsetDirty = !1,
                    this._isFrontFaceDirty = !1
                }
                ,
                e.prototype.apply = function(e) {
                    this.isDirty && (this._isCullDirty && (this.cull ? e.enable(e.CULL_FACE) : e.disable(e.CULL_FACE),
                    this._isCullDirty = !1),
                    this._isCullFaceDirty && (e.cullFace(this.cullFace),
                    this._isCullFaceDirty = !1),
                    this._isDepthMaskDirty && (e.depthMask(this.depthMask),
                    this._isDepthMaskDirty = !1),
                    this._isDepthTestDirty && (this.depthTest ? e.enable(e.DEPTH_TEST) : e.disable(e.DEPTH_TEST),
                    this._isDepthTestDirty = !1),
                    this._isDepthFuncDirty && (e.depthFunc(this.depthFunc),
                    this._isDepthFuncDirty = !1),
                    this._isZOffsetDirty && (this.zOffset ? (e.enable(e.POLYGON_OFFSET_FILL),
                    e.polygonOffset(this.zOffset, 0)) : e.disable(e.POLYGON_OFFSET_FILL),
                    this._isZOffsetDirty = !1),
                    this._isFrontFaceDirty && (e.frontFace(this.frontFace),
                    this._isFrontFaceDirty = !1))
                }
                ,
                e
            }();
            e._DepthCullingState = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this._isStencilTestDirty = !1,
                    this._isStencilMaskDirty = !1,
                    this._isStencilFuncDirty = !1,
                    this._isStencilOpDirty = !1,
                    this.reset()
                }
                return Object.defineProperty(t.prototype, "isDirty", {
                    get: function() {
                        return this._isStencilTestDirty || this._isStencilMaskDirty || this._isStencilFuncDirty || this._isStencilOpDirty
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "stencilFunc", {
                    get: function() {
                        return this._stencilFunc
                    },
                    set: function(e) {
                        this._stencilFunc !== e && (this._stencilFunc = e,
                        this._isStencilFuncDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "stencilFuncRef", {
                    get: function() {
                        return this._stencilFuncRef
                    },
                    set: function(e) {
                        this._stencilFuncRef !== e && (this._stencilFuncRef = e,
                        this._isStencilFuncDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "stencilFuncMask", {
                    get: function() {
                        return this._stencilFuncMask
                    },
                    set: function(e) {
                        this._stencilFuncMask !== e && (this._stencilFuncMask = e,
                        this._isStencilFuncDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "stencilOpStencilFail", {
                    get: function() {
                        return this._stencilOpStencilFail
                    },
                    set: function(e) {
                        this._stencilOpStencilFail !== e && (this._stencilOpStencilFail = e,
                        this._isStencilOpDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "stencilOpDepthFail", {
                    get: function() {
                        return this._stencilOpDepthFail
                    },
                    set: function(e) {
                        this._stencilOpDepthFail !== e && (this._stencilOpDepthFail = e,
                        this._isStencilOpDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "stencilOpStencilDepthPass", {
                    get: function() {
                        return this._stencilOpStencilDepthPass
                    },
                    set: function(e) {
                        this._stencilOpStencilDepthPass !== e && (this._stencilOpStencilDepthPass = e,
                        this._isStencilOpDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "stencilMask", {
                    get: function() {
                        return this._stencilMask
                    },
                    set: function(e) {
                        this._stencilMask !== e && (this._stencilMask = e,
                        this._isStencilMaskDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "stencilTest", {
                    get: function() {
                        return this._stencilTest
                    },
                    set: function(e) {
                        this._stencilTest !== e && (this._stencilTest = e,
                        this._isStencilTestDirty = !0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.reset = function() {
                    this._stencilTest = !1,
                    this._stencilMask = 255,
                    this._stencilFunc = e.Engine.ALWAYS,
                    this._stencilFuncRef = 1,
                    this._stencilFuncMask = 255,
                    this._stencilOpStencilFail = e.Engine.KEEP,
                    this._stencilOpDepthFail = e.Engine.KEEP,
                    this._stencilOpStencilDepthPass = e.Engine.REPLACE,
                    this._isStencilTestDirty = !0,
                    this._isStencilMaskDirty = !0,
                    this._isStencilFuncDirty = !0,
                    this._isStencilOpDirty = !0
                }
                ,
                t.prototype.apply = function(e) {
                    this.isDirty && (this._isStencilTestDirty && (this.stencilTest ? e.enable(e.STENCIL_TEST) : e.disable(e.STENCIL_TEST),
                    this._isStencilTestDirty = !1),
                    this._isStencilMaskDirty && (e.stencilMask(this.stencilMask),
                    this._isStencilMaskDirty = !1),
                    this._isStencilFuncDirty && (e.stencilFunc(this.stencilFunc, this.stencilFuncRef, this.stencilFuncMask),
                    this._isStencilFuncDirty = !1),
                    this._isStencilOpDirty && (e.stencilOp(this.stencilOpStencilFail, this.stencilOpDepthFail, this.stencilOpStencilDepthPass),
                    this._isStencilOpDirty = !1))
                }
                ,
                t
            }();
            e._StencilState = t
        }(s || (s = {}));
        var a = this && this.__assign || function() {
            return (a = Object.assign || function(e) {
                for (var t, r = 1, i = arguments.length; r < i; r++)
                    for (var n in t = arguments[r])
                        Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]);
                return e
            }
            ).apply(this, arguments)
        }
        ;
        !function(e) {
            var t = function() {}
              , r = function() {};
            e.InstancingAttributeInfo = r;
            var i = function() {};
            e.RenderTargetCreationOptions = i;
            var n = function() {};
            e.DepthTextureCreationOptions = n;
            var o = function() {};
            e.EngineCapabilities = o;
            var s = function() {
                function r(i, n, o, a) {
                    void 0 === a && (a = !1);
                    var s = this;
                    this.forcePOTTextures = !1,
                    this.isFullscreen = !1,
                    this.isPointerLock = !1,
                    this.cullBackFaces = !0,
                    this.renderEvenInBackground = !0,
                    this.preventCacheWipeBetweenFrames = !1,
                    this.enableOfflineSupport = !1,
                    this.disableManifestCheck = !1,
                    this.scenes = new Array,
                    this.postProcesses = new Array,
                    this.validateShaderPrograms = !1,
                    this.onResizeObservable = new e.Observable,
                    this.onCanvasBlurObservable = new e.Observable,
                    this.onCanvasFocusObservable = new e.Observable,
                    this.onCanvasPointerOutObservable = new e.Observable,
                    this.onBeforeTextureInitObservable = new e.Observable,
                    this._vrDisplay = void 0,
                    this._vrSupported = !1,
                    this._vrExclusivePointerMode = !1,
                    this.disableUniformBuffers = !1,
                    this._uniformBuffers = new Array,
                    this.onBeginFrameObservable = new e.Observable,
                    this.onEndFrameObservable = new e.Observable,
                    this.onBeforeShaderCompilationObservable = new e.Observable,
                    this.onAfterShaderCompilationObservable = new e.Observable,
                    this._windowIsBackground = !1,
                    this._webGLVersion = 1,
                    this._badOS = !1,
                    this._badDesktopOS = !1,
                    this.disableTextureBindingOptimization = !1,
                    this.onVRDisplayChangedObservable = new e.Observable,
                    this.onVRRequestPresentComplete = new e.Observable,
                    this.onVRRequestPresentStart = new e.Observable,
                    this._colorWrite = !0,
                    this._drawCalls = new e.PerfCounter,
                    this._textureCollisions = new e.PerfCounter,
                    this._renderingQueueLaunched = !1,
                    this._activeRenderLoops = new Array,
                    this._deterministicLockstep = !1,
                    this._lockstepMaxSteps = 4,
                    this.onContextLostObservable = new e.Observable,
                    this.onContextRestoredObservable = new e.Observable,
                    this._contextWasLost = !1,
                    this._doNotHandleContextLost = !1,
                    this._performanceMonitor = new e.PerformanceMonitor,
                    this._fps = 60,
                    this._deltaTime = 0,
                    this.disablePerformanceMonitorInBackground = !1,
                    this._depthCullingState = new e._DepthCullingState,
                    this._stencilState = new e._StencilState,
                    this._alphaState = new e._AlphaState,
                    this._alphaMode = r.ALPHA_DISABLE,
                    this._internalTexturesCache = new Array,
                    this._activeChannel = 0,
                    this._currentTextureChannel = -1,
                    this._boundTexturesCache = {},
                    this._compiledEffects = {},
                    this._vertexAttribArraysEnabled = [],
                    this._uintIndicesCurrentlySet = !1,
                    this._currentBoundBuffer = new Array,
                    this._currentFramebuffer = null,
                    this._currentBufferPointers = new Array,
                    this._currentInstanceLocations = new Array,
                    this._currentInstanceBuffers = new Array,
                    this._firstBoundInternalTextureTracker = new e.DummyInternalTextureTracker,
                    this._lastBoundInternalTextureTracker = new e.DummyInternalTextureTracker,
                    this._vaoRecordInProgress = !1,
                    this._mustWipeVertexAttributes = !1,
                    this._nextFreeTextureSlots = new Array,
                    this._maxSimultaneousTextures = 0,
                    this._activeRequests = new Array,
                    this._texturesSupported = new Array,
                    this.premultipliedAlpha = !0,
                    this._viewportCached = new e.Vector4(0,0,0,0),
                    this._onVRFullScreenTriggered = function() {
                        if (s._vrDisplay && s._vrDisplay.isPresenting) {
                            s._oldSize = new e.Size(s.getRenderWidth(),s.getRenderHeight()),
                            s._oldHardwareScaleFactor = s.getHardwareScalingLevel();
                            var t = s._vrDisplay.getEyeParameters("left");
                            s.setHardwareScalingLevel(1),
                            s.setSize(2 * t.renderWidth, t.renderHeight)
                        } else
                            s.setHardwareScalingLevel(s._oldHardwareScaleFactor),
                            s.setSize(s._oldSize.width, s._oldSize.height)
                    }
                    ,
                    this._unpackFlipYCached = null,
                    this.enableUnpackFlipYCached = !0,
                    this._boundUniforms = {},
                    e.PromisePolyfill.Apply();
                    var y = null;
                    if (r.Instances.push(this),
                    i) {
                        if (o = o || {},
                        i.getContext) {
                            if (y = i,
                            this._renderingCanvas = y,
                            null != n && (o.antialias = n),
                            void 0 === o.deterministicLockstep && (o.deterministicLockstep = !1),
                            void 0 === o.lockstepMaxSteps && (o.lockstepMaxSteps = 4),
                            void 0 === o.preserveDrawingBuffer && (o.preserveDrawingBuffer = !1),
                            void 0 === o.audioEngine && (o.audioEngine = !0),
                            void 0 === o.stencil && (o.stencil = !0),
                            !1 === o.premultipliedAlpha && (this.premultipliedAlpha = !1),
                            this._deterministicLockstep = o.deterministicLockstep,
                            this._lockstepMaxSteps = o.lockstepMaxSteps,
                            this._doNotHandleContextLost = !!o.doNotHandleContextLost,
                            navigator && navigator.userAgent)
                                for (var l = navigator.userAgent, c = 0, h = r.ExceptionList; c < h.length; c++) {
                                    var u = h[c]
                                      , d = u.key
                                      , x = u.targets;
                                    if (l.indexOf(d) > -1) {
                                        if (u.capture && u.captureConstraint) {
                                            var p = u.capture
                                              , f = u.captureConstraint
                                              , m = new RegExp(p).exec(l);
                                            if (m && m.length > 0)
                                                if (parseInt(m[m.length - 1]) >= f)
                                                    continue
                                        }
                                        for (var z = 0, _ = x; z < _.length; z++) {
                                            switch (_[z]) {
                                            case "uniformBuffer":
                                                this.disableUniformBuffers = !0;
                                                break;
                                            case "textureBindingOptimization":
                                                this.disableTextureBindingOptimization = !0
                                            }
                                        }
                                    }
                                }
                            if (!o.disableWebGL2Support)
                                try {
                                    this._gl = y.getContext("webgl2", o) || y.getContext("experimental-webgl2", o),
                                    this._gl && (this._webGLVersion = 2,
                                    this._gl.deleteQuery || (this._webGLVersion = 1))
                                } catch (e) {}
                            if (!this._gl) {
                                if (!y)
                                    throw new Error("The provided canvas is null or undefined.");
                                try {
                                    this._gl = y.getContext("webgl", o) || y.getContext("experimental-webgl", o)
                                } catch (e) {
                                    throw new Error("WebGL not supported")
                                }
                            }
                            if (!this._gl)
                                throw new Error("WebGL not supported");
                            this._onCanvasFocus = function() {
                                s.onCanvasFocusObservable.notifyObservers(s)
                            }
                            ,
                            this._onCanvasBlur = function() {
                                s.onCanvasBlurObservable.notifyObservers(s)
                            }
                            ,
                            y.addEventListener("focus", this._onCanvasFocus),
                            y.addEventListener("blur", this._onCanvasBlur),
                            this._onBlur = function() {
                                s.disablePerformanceMonitorInBackground && s._performanceMonitor.disable(),
                                s._windowIsBackground = !0
                            }
                            ,
                            this._onFocus = function() {
                                s.disablePerformanceMonitorInBackground && s._performanceMonitor.enable(),
                                s._windowIsBackground = !1
                            }
                            ,
                            this._onCanvasPointerOut = function(e) {
                                s.onCanvasPointerOutObservable.notifyObservers(e)
                            }
                            ,
                            window.addEventListener("blur", this._onBlur),
                            window.addEventListener("focus", this._onFocus),
                            y.addEventListener("pointerout", this._onCanvasPointerOut),
                            this._doNotHandleContextLost || (this._onContextLost = function(t) {
                                t.preventDefault(),
                                s._contextWasLost = !0,
                                e.Tools.Warn("WebGL context lost."),
                                s.onContextLostObservable.notifyObservers(s)
                            }
                            ,
                            this._onContextRestored = function(t) {
                                setTimeout((function() {
                                    s._initGLContext(),
                                    s._rebuildEffects(),
                                    s._rebuildInternalTextures(),
                                    s._rebuildBuffers(),
                                    s.wipeCaches(!0),
                                    e.Tools.Warn("WebGL context successfully restored."),
                                    s.onContextRestoredObservable.notifyObservers(s),
                                    s._contextWasLost = !1
                                }
                                ), 0)
                            }
                            ,
                            y.addEventListener("webglcontextlost", this._onContextLost, !1),
                            y.addEventListener("webglcontextrestored", this._onContextRestored, !1))
                        } else {
                            this._gl = i,
                            this._renderingCanvas = this._gl.canvas,
                            this._gl.renderbufferStorageMultisample && (this._webGLVersion = 2);
                            var g = this._gl.getContextAttributes();
                            g && (o.stencil = g.stencil)
                        }
                        var v = o.limitDeviceRatio || window.devicePixelRatio || 1;
                        this._hardwareScalingLevel = a ? 1 / Math.min(v, window.devicePixelRatio || 1) : 1,
                        this.resize(),
                        this._isStencilEnable = !!o.stencil,
                        this._initGLContext(),
                        y && (this._onFullscreenChange = function() {
                            void 0 !== document.fullscreen ? s.isFullscreen = document.fullscreen : void 0 !== document.mozFullScreen ? s.isFullscreen = document.mozFullScreen : void 0 !== document.webkitIsFullScreen ? s.isFullscreen = document.webkitIsFullScreen : void 0 !== document.msIsFullScreen && (s.isFullscreen = document.msIsFullScreen),
                            s.isFullscreen && s._pointerLockRequested && y && (y.requestPointerLock = y.requestPointerLock || y.msRequestPointerLock || y.mozRequestPointerLock || y.webkitRequestPointerLock,
                            y.requestPointerLock && y.requestPointerLock())
                        }
                        ,
                        document.addEventListener("fullscreenchange", this._onFullscreenChange, !1),
                        document.addEventListener("mozfullscreenchange", this._onFullscreenChange, !1),
                        document.addEventListener("webkitfullscreenchange", this._onFullscreenChange, !1),
                        document.addEventListener("msfullscreenchange", this._onFullscreenChange, !1),
                        this._onPointerLockChange = function() {
                            s.isPointerLock = document.mozPointerLockElement === y || document.webkitPointerLockElement === y || document.msPointerLockElement === y || document.pointerLockElement === y
                        }
                        ,
                        document.addEventListener("pointerlockchange", this._onPointerLockChange, !1),
                        document.addEventListener("mspointerlockchange", this._onPointerLockChange, !1),
                        document.addEventListener("mozpointerlockchange", this._onPointerLockChange, !1),
                        document.addEventListener("webkitpointerlockchange", this._onPointerLockChange, !1),
                        this._onVRDisplayPointerRestricted = function() {
                            y && y.requestPointerLock()
                        }
                        ,
                        this._onVRDisplayPointerUnrestricted = function() {
                            document.exitPointerLock()
                        }
                        ,
                        window.addEventListener("vrdisplaypointerrestricted", this._onVRDisplayPointerRestricted, !1),
                        window.addEventListener("vrdisplaypointerunrestricted", this._onVRDisplayPointerUnrestricted, !1)),
                        !r.audioEngine && o.audioEngine && r.AudioEngineFactory && (r.audioEngine = r.AudioEngineFactory(this.getRenderingCanvas()));
                        for (var b = 0; b < this._caps.maxVertexAttribs; b++)
                            this._currentBufferPointers[b] = new t;
                        this._linkTrackers(this._firstBoundInternalTextureTracker, this._lastBoundInternalTextureTracker),
                        o.autoEnableWebVR && this.initWebVR(),
                        this._badOS = /iPad/i.test(navigator.userAgent) || /iPhone/i.test(navigator.userAgent),
                        this._badDesktopOS = /^((?!chrome|android).)*safari/i.test(navigator.userAgent),
                        console.log("Babylon.js engine (v" + r.Version + ") launched"),
                        this.enableOfflineSupport = void 0 !== e.Database
                    }
                }
                return Object.defineProperty(r, "LastCreatedEngine", {
                    get: function() {
                        return 0 === r.Instances.length ? null : r.Instances[r.Instances.length - 1]
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "LastCreatedScene", {
                    get: function() {
                        var e = r.LastCreatedEngine;
                        return e ? 0 === e.scenes.length ? null : e.scenes[e.scenes.length - 1] : null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.MarkAllMaterialsAsDirty = function(e, t) {
                    for (var i = 0; i < r.Instances.length; i++)
                        for (var n = r.Instances[i], o = 0; o < n.scenes.length; o++)
                            n.scenes[o].markAllMaterialsAsDirty(e, t)
                }
                ,
                Object.defineProperty(r, "Version", {
                    get: function() {
                        return "3.3.0"
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "isInVRExclusivePointerMode", {
                    get: function() {
                        return this._vrExclusivePointerMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "supportsUniformBuffers", {
                    get: function() {
                        return this.webGLVersion > 1 && !this.disableUniformBuffers
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "needPOTTextures", {
                    get: function() {
                        return this._webGLVersion < 2 || this.forcePOTTextures
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "doNotHandleContextLost", {
                    get: function() {
                        return this._doNotHandleContextLost
                    },
                    set: function(e) {
                        this._doNotHandleContextLost = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "performanceMonitor", {
                    get: function() {
                        return this._performanceMonitor
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "texturesSupported", {
                    get: function() {
                        return this._texturesSupported
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "textureFormatInUse", {
                    get: function() {
                        return this._textureFormatInUse
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "currentViewport", {
                    get: function() {
                        return this._cachedViewport
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "emptyTexture", {
                    get: function() {
                        return this._emptyTexture || (this._emptyTexture = this.createRawTexture(new Uint8Array(4), 1, 1, r.TEXTUREFORMAT_RGBA, !1, !1, r.TEXTURE_NEAREST_SAMPLINGMODE)),
                        this._emptyTexture
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "emptyTexture3D", {
                    get: function() {
                        return this._emptyTexture3D || (this._emptyTexture3D = this.createRawTexture3D(new Uint8Array(4), 1, 1, 1, r.TEXTUREFORMAT_RGBA, !1, !1, r.TEXTURE_NEAREST_SAMPLINGMODE)),
                        this._emptyTexture3D
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "emptyCubeTexture", {
                    get: function() {
                        if (!this._emptyCubeTexture) {
                            var e = new Uint8Array(4)
                              , t = [e, e, e, e, e, e];
                            this._emptyCubeTexture = this.createRawCubeTexture(t, 1, r.TEXTUREFORMAT_RGBA, r.TEXTURETYPE_UNSIGNED_INT, !1, !1, r.TEXTURE_NEAREST_SAMPLINGMODE)
                        }
                        return this._emptyCubeTexture
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._rebuildInternalTextures = function() {
                    for (var e = 0, t = this._internalTexturesCache.slice(); e < t.length; e++) {
                        t[e]._rebuild()
                    }
                }
                ,
                r.prototype._rebuildEffects = function() {
                    for (var t in this._compiledEffects) {
                        this._compiledEffects[t]._prepareEffect()
                    }
                    e.Effect.ResetCache()
                }
                ,
                r.prototype._rebuildBuffers = function() {
                    for (var e = 0, t = this.scenes; e < t.length; e++) {
                        var r = t[e];
                        r.resetCachedMaterial(),
                        r._rebuildGeometries(),
                        r._rebuildTextures()
                    }
                    for (var i = 0, n = this._uniformBuffers; i < n.length; i++) {
                        n[i]._rebuild()
                    }
                }
                ,
                r.prototype._initGLContext = function() {
                    this._caps = new o,
                    this._caps.maxTexturesImageUnits = this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),
                    this._caps.maxCombinedTexturesImageUnits = this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),
                    this._caps.maxVertexTextureImageUnits = this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
                    this._caps.maxTextureSize = this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),
                    this._caps.maxCubemapTextureSize = this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),
                    this._caps.maxRenderTextureSize = this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),
                    this._caps.maxVertexAttribs = this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),
                    this._caps.maxVaryingVectors = this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),
                    this._caps.maxFragmentUniformVectors = this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),
                    this._caps.maxVertexUniformVectors = this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),
                    this._glVersion = this._gl.getParameter(this._gl.VERSION);
                    var e = this._gl.getExtension("WEBGL_debug_renderer_info");
                    if (null != e && (this._glRenderer = this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),
                    this._glVendor = this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),
                    this._glVendor || (this._glVendor = "Unknown vendor"),
                    this._glRenderer || (this._glRenderer = "Unknown renderer"),
                    this._gl.HALF_FLOAT_OES = 36193,
                    34842 !== this._gl.RGBA16F && (this._gl.RGBA16F = 34842),
                    34836 !== this._gl.RGBA32F && (this._gl.RGBA32F = 34836),
                    35056 !== this._gl.DEPTH24_STENCIL8 && (this._gl.DEPTH24_STENCIL8 = 35056),
                    this._caps.standardDerivatives = this._webGLVersion > 1 || null !== this._gl.getExtension("OES_standard_derivatives"),
                    this._caps.astc = this._gl.getExtension("WEBGL_compressed_texture_astc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),
                    this._caps.s3tc = this._gl.getExtension("WEBGL_compressed_texture_s3tc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),
                    this._caps.pvrtc = this._gl.getExtension("WEBGL_compressed_texture_pvrtc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),
                    this._caps.etc1 = this._gl.getExtension("WEBGL_compressed_texture_etc1") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),
                    this._caps.etc2 = this._gl.getExtension("WEBGL_compressed_texture_etc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc") || this._gl.getExtension("WEBGL_compressed_texture_es3_0"),
                    this._caps.textureAnisotropicFilterExtension = this._gl.getExtension("EXT_texture_filter_anisotropic") || this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic") || this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),
                    this._caps.maxAnisotropy = this._caps.textureAnisotropicFilterExtension ? this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0,
                    this._caps.uintIndices = this._webGLVersion > 1 || null !== this._gl.getExtension("OES_element_index_uint"),
                    this._caps.fragmentDepthSupported = this._webGLVersion > 1 || null !== this._gl.getExtension("EXT_frag_depth"),
                    this._caps.highPrecisionShaderSupported = !0,
                    this._caps.timerQuery = this._gl.getExtension("EXT_disjoint_timer_query_webgl2") || this._gl.getExtension("EXT_disjoint_timer_query"),
                    this._caps.timerQuery && (1 === this._webGLVersion && (this._gl.getQuery = this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),
                    this._caps.canUseTimestampForTimerQuery = this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT, this._caps.timerQuery.QUERY_COUNTER_BITS_EXT) > 0),
                    this._caps.colorBufferFloat = this._webGLVersion > 1 && this._gl.getExtension("EXT_color_buffer_float"),
                    this._caps.textureFloat = !!(this._webGLVersion > 1 || this._gl.getExtension("OES_texture_float")),
                    this._caps.textureFloatLinearFiltering = !(!this._caps.textureFloat || !this._gl.getExtension("OES_texture_float_linear")),
                    this._caps.textureFloatRender = !(!this._caps.textureFloat || !this._canRenderToFloatFramebuffer()),
                    this._caps.textureHalfFloat = !!(this._webGLVersion > 1 || this._gl.getExtension("OES_texture_half_float")),
                    this._caps.textureHalfFloatLinearFiltering = !!(this._webGLVersion > 1 || this._caps.textureHalfFloat && this._gl.getExtension("OES_texture_half_float_linear")),
                    this._webGLVersion > 1 && (this._gl.HALF_FLOAT_OES = 5131),
                    this._caps.textureHalfFloatRender = this._caps.textureHalfFloat && this._canRenderToHalfFloatFramebuffer(),
                    this._caps.textureLOD = !!(this._webGLVersion > 1 || this._gl.getExtension("EXT_shader_texture_lod")),
                    this._webGLVersion > 1)
                        this._caps.drawBuffersExtension = !0;
                    else {
                        var t = this._gl.getExtension("WEBGL_draw_buffers");
                        if (null !== t) {
                            this._caps.drawBuffersExtension = !0,
                            this._gl.drawBuffers = t.drawBuffersWEBGL.bind(t),
                            this._gl.DRAW_FRAMEBUFFER = this._gl.FRAMEBUFFER;
                            for (var r = 0; r < 16; r++)
                                this._gl["COLOR_ATTACHMENT" + r + "_WEBGL"] = t["COLOR_ATTACHMENT" + r + "_WEBGL"]
                        } else
                            this._caps.drawBuffersExtension = !1
                    }
                    if (this._webGLVersion > 1)
                        this._caps.depthTextureExtension = !0;
                    else {
                        var i = this._gl.getExtension("WEBGL_depth_texture");
                        null != i && (this._caps.depthTextureExtension = !0,
                        this._gl.UNSIGNED_INT_24_8 = i.UNSIGNED_INT_24_8_WEBGL)
                    }
                    if (this._webGLVersion > 1)
                        this._caps.vertexArrayObject = !0;
                    else {
                        var n = this._gl.getExtension("OES_vertex_array_object");
                        null != n ? (this._caps.vertexArrayObject = !0,
                        this._gl.createVertexArray = n.createVertexArrayOES.bind(n),
                        this._gl.bindVertexArray = n.bindVertexArrayOES.bind(n),
                        this._gl.deleteVertexArray = n.deleteVertexArrayOES.bind(n)) : this._caps.vertexArrayObject = !1
                    }
                    if (this._webGLVersion > 1)
                        this._caps.instancedArrays = !0;
                    else {
                        var a = this._gl.getExtension("ANGLE_instanced_arrays");
                        null != a ? (this._caps.instancedArrays = !0,
                        this._gl.drawArraysInstanced = a.drawArraysInstancedANGLE.bind(a),
                        this._gl.drawElementsInstanced = a.drawElementsInstancedANGLE.bind(a),
                        this._gl.vertexAttribDivisor = a.vertexAttribDivisorANGLE.bind(a)) : this._caps.instancedArrays = !1
                    }
                    if (this._caps.astc && this.texturesSupported.push("-astc.ktx"),
                    this._caps.s3tc && this.texturesSupported.push("-dxt.ktx"),
                    this._caps.pvrtc && this.texturesSupported.push("-pvrtc.ktx"),
                    this._caps.etc2 && this.texturesSupported.push("-etc2.ktx"),
                    this._caps.etc1 && this.texturesSupported.push("-etc1.ktx"),
                    this._gl.getShaderPrecisionFormat) {
                        var s = this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER, this._gl.HIGH_FLOAT);
                        s && (this._caps.highPrecisionShaderSupported = 0 !== s.precision)
                    }
                    this.setDepthBuffer(!0),
                    this.setDepthFunctionToLessOrEqual(),
                    this.setDepthWrite(!0),
                    this._maxSimultaneousTextures = this._caps.maxCombinedTexturesImageUnits;
                    for (var y = 0; y < this._maxSimultaneousTextures; y++)
                        this._nextFreeTextureSlots.push(y)
                }
                ,
                Object.defineProperty(r.prototype, "webGLVersion", {
                    get: function() {
                        return this._webGLVersion
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "isStencilEnable", {
                    get: function() {
                        return this._isStencilEnable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._prepareWorkingCanvas = function() {
                    if (!this._workingCanvas) {
                        this._workingCanvas = document.createElement("canvas");
                        var e = this._workingCanvas.getContext("2d");
                        e && (this._workingContext = e)
                    }
                }
                ,
                r.prototype.resetTextureCache = function() {
                    for (var e in this._boundTexturesCache)
                        if (this._boundTexturesCache.hasOwnProperty(e)) {
                            var t = this._boundTexturesCache[e];
                            t && this._removeDesignatedSlot(t),
                            this._boundTexturesCache[e] = null
                        }
                    if (!this.disableTextureBindingOptimization) {
                        this._nextFreeTextureSlots = [];
                        for (var r = 0; r < this._maxSimultaneousTextures; r++)
                            this._nextFreeTextureSlots.push(r)
                    }
                    this._currentTextureChannel = -1
                }
                ,
                r.prototype.isDeterministicLockStep = function() {
                    return this._deterministicLockstep
                }
                ,
                r.prototype.getLockstepMaxSteps = function() {
                    return this._lockstepMaxSteps
                }
                ,
                r.prototype.getGlInfo = function() {
                    return {
                        vendor: this._glVendor,
                        renderer: this._glRenderer,
                        version: this._glVersion
                    }
                }
                ,
                r.prototype.getAspectRatio = function(e, t) {
                    void 0 === t && (t = !1);
                    var r = e.viewport;
                    return this.getRenderWidth(t) * r.width / (this.getRenderHeight(t) * r.height)
                }
                ,
                r.prototype.getScreenAspectRatio = function() {
                    return this.getRenderWidth(!0) / this.getRenderHeight(!0)
                }
                ,
                r.prototype.getRenderWidth = function(e) {
                    return void 0 === e && (e = !1),
                    !e && this._currentRenderTarget ? this._currentRenderTarget.width : this._gl.drawingBufferWidth
                }
                ,
                r.prototype.getRenderHeight = function(e) {
                    return void 0 === e && (e = !1),
                    !e && this._currentRenderTarget ? this._currentRenderTarget.height : this._gl.drawingBufferHeight
                }
                ,
                r.prototype.getRenderingCanvas = function() {
                    return this._renderingCanvas
                }
                ,
                r.prototype.getRenderingCanvasClientRect = function() {
                    return this._renderingCanvas ? this._renderingCanvas.getBoundingClientRect() : null
                }
                ,
                r.prototype.setHardwareScalingLevel = function(e) {
                    this._hardwareScalingLevel = e,
                    this.resize()
                }
                ,
                r.prototype.getHardwareScalingLevel = function() {
                    return this._hardwareScalingLevel
                }
                ,
                r.prototype.getLoadedTexturesCache = function() {
                    return this._internalTexturesCache
                }
                ,
                r.prototype.getCaps = function() {
                    return this._caps
                }
                ,
                Object.defineProperty(r.prototype, "drawCalls", {
                    get: function() {
                        return e.Tools.Warn("drawCalls is deprecated. Please use SceneInstrumentation class"),
                        0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "drawCallsPerfCounter", {
                    get: function() {
                        return e.Tools.Warn("drawCallsPerfCounter is deprecated. Please use SceneInstrumentation class"),
                        null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getDepthFunction = function() {
                    return this._depthCullingState.depthFunc
                }
                ,
                r.prototype.setDepthFunction = function(e) {
                    this._depthCullingState.depthFunc = e
                }
                ,
                r.prototype.setDepthFunctionToGreater = function() {
                    this._depthCullingState.depthFunc = this._gl.GREATER
                }
                ,
                r.prototype.setDepthFunctionToGreaterOrEqual = function() {
                    this._depthCullingState.depthFunc = this._gl.GEQUAL
                }
                ,
                r.prototype.setDepthFunctionToLess = function() {
                    this._depthCullingState.depthFunc = this._gl.LESS
                }
                ,
                r.prototype.setDepthFunctionToLessOrEqual = function() {
                    this._depthCullingState.depthFunc = this._gl.LEQUAL
                }
                ,
                r.prototype.getStencilBuffer = function() {
                    return this._stencilState.stencilTest
                }
                ,
                r.prototype.setStencilBuffer = function(e) {
                    this._stencilState.stencilTest = e
                }
                ,
                r.prototype.getStencilMask = function() {
                    return this._stencilState.stencilMask
                }
                ,
                r.prototype.setStencilMask = function(e) {
                    this._stencilState.stencilMask = e
                }
                ,
                r.prototype.getStencilFunction = function() {
                    return this._stencilState.stencilFunc
                }
                ,
                r.prototype.getStencilFunctionReference = function() {
                    return this._stencilState.stencilFuncRef
                }
                ,
                r.prototype.getStencilFunctionMask = function() {
                    return this._stencilState.stencilFuncMask
                }
                ,
                r.prototype.setStencilFunction = function(e) {
                    this._stencilState.stencilFunc = e
                }
                ,
                r.prototype.setStencilFunctionReference = function(e) {
                    this._stencilState.stencilFuncRef = e
                }
                ,
                r.prototype.setStencilFunctionMask = function(e) {
                    this._stencilState.stencilFuncMask = e
                }
                ,
                r.prototype.getStencilOperationFail = function() {
                    return this._stencilState.stencilOpStencilFail
                }
                ,
                r.prototype.getStencilOperationDepthFail = function() {
                    return this._stencilState.stencilOpDepthFail
                }
                ,
                r.prototype.getStencilOperationPass = function() {
                    return this._stencilState.stencilOpStencilDepthPass
                }
                ,
                r.prototype.setStencilOperationFail = function(e) {
                    this._stencilState.stencilOpStencilFail = e
                }
                ,
                r.prototype.setStencilOperationDepthFail = function(e) {
                    this._stencilState.stencilOpDepthFail = e
                }
                ,
                r.prototype.setStencilOperationPass = function(e) {
                    this._stencilState.stencilOpStencilDepthPass = e
                }
                ,
                r.prototype.setDitheringState = function(e) {
                    e ? this._gl.enable(this._gl.DITHER) : this._gl.disable(this._gl.DITHER)
                }
                ,
                r.prototype.setRasterizerState = function(e) {
                    e ? this._gl.disable(this._gl.RASTERIZER_DISCARD) : this._gl.enable(this._gl.RASTERIZER_DISCARD)
                }
                ,
                r.prototype.stopRenderLoop = function(e) {
                    if (e) {
                        var t = this._activeRenderLoops.indexOf(e);
                        t >= 0 && this._activeRenderLoops.splice(t, 1)
                    } else
                        this._activeRenderLoops = []
                }
                ,
                r.prototype._renderLoop = function() {
                    if (!this._contextWasLost) {
                        var t = !0;
                        if (!this.renderEvenInBackground && this._windowIsBackground && (t = !1),
                        t) {
                            this.beginFrame();
                            for (var r = 0; r < this._activeRenderLoops.length; r++) {
                                (0,
                                this._activeRenderLoops[r])()
                            }
                            this.endFrame()
                        }
                    }
                    if (this._activeRenderLoops.length > 0) {
                        var i = null;
                        this._vrDisplay && this._vrDisplay.isPresenting && (i = this._vrDisplay),
                        this._frameHandler = e.Tools.QueueNewFrame(this._bindedRenderFunction, i)
                    } else
                        this._renderingQueueLaunched = !1
                }
                ,
                r.prototype.runRenderLoop = function(t) {
                    -1 === this._activeRenderLoops.indexOf(t) && (this._activeRenderLoops.push(t),
                    this._renderingQueueLaunched || (this._renderingQueueLaunched = !0,
                    this._bindedRenderFunction = this._renderLoop.bind(this),
                    this._frameHandler = e.Tools.QueueNewFrame(this._bindedRenderFunction)))
                }
                ,
                r.prototype.switchFullscreen = function(t) {
                    this.isFullscreen ? e.Tools.ExitFullscreen() : (this._pointerLockRequested = t,
                    this._renderingCanvas && e.Tools.RequestFullscreen(this._renderingCanvas))
                }
                ,
                r.prototype.clear = function(e, t, r, i) {
                    void 0 === i && (i = !1),
                    this.applyStates();
                    var n = 0;
                    t && e && (this._gl.clearColor(e.r, e.g, e.b, void 0 !== e.a ? e.a : 1),
                    n |= this._gl.COLOR_BUFFER_BIT),
                    r && (this._gl.clearDepth(1),
                    n |= this._gl.DEPTH_BUFFER_BIT),
                    i && (this._gl.clearStencil(0),
                    n |= this._gl.STENCIL_BUFFER_BIT),
                    this._gl.clear(n)
                }
                ,
                r.prototype.scissorClear = function(e, t, r, i, n) {
                    var o = this._gl
                      , a = o.getParameter(o.SCISSOR_TEST)
                      , s = o.getParameter(o.SCISSOR_BOX);
                    o.enable(o.SCISSOR_TEST),
                    o.scissor(e, t, r, i),
                    this.clear(n, !0, !0, !0),
                    o.scissor(s[0], s[1], s[2], s[3]),
                    !0 === a ? o.enable(o.SCISSOR_TEST) : o.disable(o.SCISSOR_TEST)
                }
                ,
                r.prototype._viewport = function(e, t, r, i) {
                    e === this._viewportCached.x && t === this._viewportCached.y && r === this._viewportCached.z && i === this._viewportCached.w || (this._viewportCached.x = e,
                    this._viewportCached.y = t,
                    this._viewportCached.z = r,
                    this._viewportCached.w = i,
                    this._gl.viewport(e, t, r, i))
                }
                ,
                r.prototype.setViewport = function(e, t, r) {
                    var i = t || this.getRenderWidth()
                      , n = r || this.getRenderHeight()
                      , o = e.x || 0
                      , a = e.y || 0;
                    this._cachedViewport = e,
                    this._viewport(o * i, a * n, i * e.width, n * e.height)
                }
                ,
                r.prototype.setDirectViewport = function(e, t, r, i) {
                    var n = this._cachedViewport;
                    return this._cachedViewport = null,
                    this._viewport(e, t, r, i),
                    n
                }
                ,
                r.prototype.beginFrame = function() {
                    this.onBeginFrameObservable.notifyObservers(this),
                    this._measureFps()
                }
                ,
                r.prototype.endFrame = function() {
                    this._badOS && this.flushFramebuffer(),
                    this._vrDisplay && this._vrDisplay.isPresenting && this._vrDisplay.submitFrame(),
                    this.onEndFrameObservable.notifyObservers(this)
                }
                ,
                r.prototype.resize = function() {
                    if (!this._vrDisplay || !this._vrDisplay.isPresenting) {
                        var e = this._renderingCanvas ? this._renderingCanvas.clientWidth : window.innerWidth
                          , t = this._renderingCanvas ? this._renderingCanvas.clientHeight : window.innerHeight;
                        this.setSize(e / this._hardwareScalingLevel, t / this._hardwareScalingLevel)
                    }
                }
                ,
                r.prototype.setSize = function(e, t) {
                    if (this._renderingCanvas && (this._renderingCanvas.width !== e || this._renderingCanvas.height !== t)) {
                        this._renderingCanvas.width = e,
                        this._renderingCanvas.height = t;
                        for (var r = 0; r < this.scenes.length; r++)
                            for (var i = this.scenes[r], n = 0; n < i.cameras.length; n++) {
                                i.cameras[n]._currentRenderId = 0
                            }
                        this.onResizeObservable.hasObservers && this.onResizeObservable.notifyObservers(this)
                    }
                }
                ,
                r.prototype.isVRDevicePresent = function() {
                    return !!this._vrDisplay
                }
                ,
                r.prototype.getVRDevice = function() {
                    return this._vrDisplay
                }
                ,
                r.prototype.initWebVR = function() {
                    return this.initWebVRAsync(),
                    this.onVRDisplayChangedObservable
                }
                ,
                r.prototype.initWebVRAsync = function() {
                    var t = this
                      , r = function() {
                        var e = {
                            vrDisplay: t._vrDisplay,
                            vrSupported: t._vrSupported
                        };
                        t.onVRDisplayChangedObservable.notifyObservers(e),
                        t._webVRInitPromise = new Promise((function(t) {
                            t(e)
                        }
                        ))
                    };
                    return this._onVrDisplayConnect || (this._onVrDisplayConnect = function(e) {
                        t._vrDisplay = e.display,
                        r()
                    }
                    ,
                    this._onVrDisplayDisconnect = function() {
                        t._vrDisplay.cancelAnimationFrame(t._frameHandler),
                        t._vrDisplay = void 0,
                        t._frameHandler = e.Tools.QueueNewFrame(t._bindedRenderFunction),
                        r()
                    }
                    ,
                    this._onVrDisplayPresentChange = function() {
                        t._vrExclusivePointerMode = t._vrDisplay && t._vrDisplay.isPresenting
                    }
                    ,
                    window.addEventListener("vrdisplayconnect", this._onVrDisplayConnect),
                    window.addEventListener("vrdisplaydisconnect", this._onVrDisplayDisconnect),
                    window.addEventListener("vrdisplaypresentchange", this._onVrDisplayPresentChange)),
                    this._webVRInitPromise = this._webVRInitPromise || this._getVRDisplaysAsync(),
                    this._webVRInitPromise.then(r),
                    this._webVRInitPromise
                }
                ,
                r.prototype.enableVR = function() {
                    var e = this;
                    if (this._vrDisplay && !this._vrDisplay.isPresenting) {
                        this.onVRRequestPresentStart.notifyObservers(this),
                        this._vrDisplay.requestPresent([{
                            source: this.getRenderingCanvas()
                        }]).then((function() {
                            e.onVRRequestPresentComplete.notifyObservers(!0),
                            e._onVRFullScreenTriggered()
                        }
                        )).catch((function() {
                            e.onVRRequestPresentComplete.notifyObservers(!1)
                        }
                        ))
                    }
                }
                ,
                r.prototype.disableVR = function() {
                    this._vrDisplay && this._vrDisplay.isPresenting && this._vrDisplay.exitPresent().then(this._onVRFullScreenTriggered).catch(this._onVRFullScreenTriggered)
                }
                ,
                r.prototype._getVRDisplaysAsync = function() {
                    var e = this;
                    return new Promise((function(t, r) {
                        navigator.getVRDisplays ? navigator.getVRDisplays().then((function(r) {
                            e._vrSupported = !0,
                            e._vrDisplay = r[0],
                            t({
                                vrDisplay: e._vrDisplay,
                                vrSupported: e._vrSupported
                            })
                        }
                        )) : (e._vrDisplay = void 0,
                        e._vrSupported = !1,
                        t({
                            vrDisplay: e._vrDisplay,
                            vrSupported: e._vrSupported
                        }))
                    }
                    ))
                }
                ,
                r.prototype.bindFramebuffer = function(e, t, r, i, n, o, a) {
                    void 0 === a && (a = 0),
                    this._currentRenderTarget && this.unBindFramebuffer(this._currentRenderTarget),
                    this._currentRenderTarget = e,
                    this.bindUnboundFramebuffer(e._MSAAFramebuffer ? e._MSAAFramebuffer : e._framebuffer);
                    var s = this._gl;
                    e.isCube && (void 0 === t && (t = 0),
                    s.framebufferTexture2D(s.FRAMEBUFFER, s.COLOR_ATTACHMENT0, s.TEXTURE_CUBE_MAP_POSITIVE_X + t, e._webGLTexture, a),
                    o && (o._generateStencilBuffer ? s.framebufferTexture2D(s.FRAMEBUFFER, s.DEPTH_STENCIL_ATTACHMENT, s.TEXTURE_CUBE_MAP_POSITIVE_X + t, o._webGLTexture, a) : s.framebufferTexture2D(s.FRAMEBUFFER, s.DEPTH_ATTACHMENT, s.TEXTURE_CUBE_MAP_POSITIVE_X + t, o._webGLTexture, a))),
                    this._cachedViewport && !n ? this.setViewport(this._cachedViewport, r, i) : (r || (r = e.width,
                    a && (r /= Math.pow(2, a))),
                    i || (i = e.height,
                    a && (i /= Math.pow(2, a))),
                    this._viewport(0, 0, r, i)),
                    this.wipeCaches()
                }
                ,
                r.prototype.bindUnboundFramebuffer = function(e) {
                    this._currentFramebuffer !== e && (this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, e),
                    this._currentFramebuffer = e)
                }
                ,
                r.prototype.unBindFramebuffer = function(e, t, r) {
                    void 0 === t && (t = !1),
                    this._currentRenderTarget = null;
                    var i = this._gl;
                    e._MSAAFramebuffer && (i.bindFramebuffer(i.READ_FRAMEBUFFER, e._MSAAFramebuffer),
                    i.bindFramebuffer(i.DRAW_FRAMEBUFFER, e._framebuffer),
                    i.blitFramebuffer(0, 0, e.width, e.height, 0, 0, e.width, e.height, i.COLOR_BUFFER_BIT, i.NEAREST)),
                    !e.generateMipMaps || t || e.isCube || (this._bindTextureDirectly(i.TEXTURE_2D, e, !0),
                    i.generateMipmap(i.TEXTURE_2D),
                    this._bindTextureDirectly(i.TEXTURE_2D, null)),
                    r && (e._MSAAFramebuffer && this.bindUnboundFramebuffer(e._framebuffer),
                    r()),
                    this.bindUnboundFramebuffer(null)
                }
                ,
                r.prototype.unBindMultiColorAttachmentFramebuffer = function(e, t, r) {
                    void 0 === t && (t = !1),
                    this._currentRenderTarget = null;
                    var i = this._gl;
                    if (e[0]._MSAAFramebuffer) {
                        i.bindFramebuffer(i.READ_FRAMEBUFFER, e[0]._MSAAFramebuffer),
                        i.bindFramebuffer(i.DRAW_FRAMEBUFFER, e[0]._framebuffer);
                        var n = e[0]._attachments;
                        n || (n = new Array(e.length),
                        e[0]._attachments = n);
                        for (var o = 0; o < e.length; o++) {
                            for (var a = e[o], s = 0; s < n.length; s++)
                                n[s] = i.NONE;
                            n[o] = i[this.webGLVersion > 1 ? "COLOR_ATTACHMENT" + o : "COLOR_ATTACHMENT" + o + "_WEBGL"],
                            i.readBuffer(n[o]),
                            i.drawBuffers(n),
                            i.blitFramebuffer(0, 0, a.width, a.height, 0, 0, a.width, a.height, i.COLOR_BUFFER_BIT, i.NEAREST)
                        }
                        for (o = 0; o < n.length; o++)
                            n[o] = i[this.webGLVersion > 1 ? "COLOR_ATTACHMENT" + o : "COLOR_ATTACHMENT" + o + "_WEBGL"];
                        i.drawBuffers(n)
                    }
                    for (o = 0; o < e.length; o++) {
                        !(a = e[o]).generateMipMaps || t || a.isCube || (this._bindTextureDirectly(i.TEXTURE_2D, a),
                        i.generateMipmap(i.TEXTURE_2D),
                        this._bindTextureDirectly(i.TEXTURE_2D, null))
                    }
                    r && (e[0]._MSAAFramebuffer && this.bindUnboundFramebuffer(e[0]._framebuffer),
                    r()),
                    this.bindUnboundFramebuffer(null)
                }
                ,
                r.prototype.generateMipMapsForCubemap = function(e) {
                    if (e.generateMipMaps) {
                        var t = this._gl;
                        this._bindTextureDirectly(t.TEXTURE_CUBE_MAP, e, !0),
                        t.generateMipmap(t.TEXTURE_CUBE_MAP),
                        this._bindTextureDirectly(t.TEXTURE_CUBE_MAP, null)
                    }
                }
                ,
                r.prototype.flushFramebuffer = function() {
                    this._gl.flush()
                }
                ,
                r.prototype.restoreDefaultFramebuffer = function() {
                    this._currentRenderTarget ? this.unBindFramebuffer(this._currentRenderTarget) : this.bindUnboundFramebuffer(null),
                    this._cachedViewport && this.setViewport(this._cachedViewport),
                    this.wipeCaches()
                }
                ,
                r.prototype.createUniformBuffer = function(e) {
                    var t = this._gl.createBuffer();
                    if (!t)
                        throw new Error("Unable to create uniform buffer");
                    return this.bindUniformBuffer(t),
                    e instanceof Float32Array ? this._gl.bufferData(this._gl.UNIFORM_BUFFER, e, this._gl.STATIC_DRAW) : this._gl.bufferData(this._gl.UNIFORM_BUFFER, new Float32Array(e), this._gl.STATIC_DRAW),
                    this.bindUniformBuffer(null),
                    t.references = 1,
                    t
                }
                ,
                r.prototype.createDynamicUniformBuffer = function(e) {
                    var t = this._gl.createBuffer();
                    if (!t)
                        throw new Error("Unable to create dynamic uniform buffer");
                    return this.bindUniformBuffer(t),
                    e instanceof Float32Array ? this._gl.bufferData(this._gl.UNIFORM_BUFFER, e, this._gl.DYNAMIC_DRAW) : this._gl.bufferData(this._gl.UNIFORM_BUFFER, new Float32Array(e), this._gl.DYNAMIC_DRAW),
                    this.bindUniformBuffer(null),
                    t.references = 1,
                    t
                }
                ,
                r.prototype.updateUniformBuffer = function(e, t, r, i) {
                    this.bindUniformBuffer(e),
                    void 0 === r && (r = 0),
                    void 0 === i ? t instanceof Float32Array ? this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, r, t) : this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, r, new Float32Array(t)) : t instanceof Float32Array ? this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, 0, t.subarray(r, r + i)) : this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, 0, new Float32Array(t).subarray(r, r + i)),
                    this.bindUniformBuffer(null)
                }
                ,
                r.prototype._resetVertexBufferBinding = function() {
                    this.bindArrayBuffer(null),
                    this._cachedVertexBuffers = null
                }
                ,
                r.prototype.createVertexBuffer = function(e) {
                    var t = this._gl.createBuffer();
                    if (!t)
                        throw new Error("Unable to create vertex buffer");
                    return this.bindArrayBuffer(t),
                    e instanceof Array ? this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(e), this._gl.STATIC_DRAW) : this._gl.bufferData(this._gl.ARRAY_BUFFER, e, this._gl.STATIC_DRAW),
                    this._resetVertexBufferBinding(),
                    t.references = 1,
                    t
                }
                ,
                r.prototype.createDynamicVertexBuffer = function(e) {
                    var t = this._gl.createBuffer();
                    if (!t)
                        throw new Error("Unable to create dynamic vertex buffer");
                    return this.bindArrayBuffer(t),
                    e instanceof Array ? this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(e), this._gl.DYNAMIC_DRAW) : this._gl.bufferData(this._gl.ARRAY_BUFFER, e, this._gl.DYNAMIC_DRAW),
                    this._resetVertexBufferBinding(),
                    t.references = 1,
                    t
                }
                ,
                r.prototype.updateDynamicIndexBuffer = function(e, t, r) {
                    var i;
                    void 0 === r && (r = 0),
                    this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER] = null,
                    this.bindIndexBuffer(e),
                    i = t instanceof Uint16Array || t instanceof Uint32Array ? t : e.is32Bits ? new Uint32Array(t) : new Uint16Array(t),
                    this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, i, this._gl.DYNAMIC_DRAW),
                    this._resetIndexBufferBinding()
                }
                ,
                r.prototype.updateDynamicVertexBuffer = function(e, t, r, i) {
                    this.bindArrayBuffer(e),
                    void 0 === r && (r = 0),
                    void 0 === i ? t instanceof Array ? this._gl.bufferSubData(this._gl.ARRAY_BUFFER, r, new Float32Array(t)) : this._gl.bufferSubData(this._gl.ARRAY_BUFFER, r, t) : t instanceof Array ? this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, new Float32Array(t).subarray(r, r + i)) : (t = t instanceof ArrayBuffer ? new Uint8Array(t,r,i) : new Uint8Array(t.buffer,t.byteOffset + r,i),
                    this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, t)),
                    this._resetVertexBufferBinding()
                }
                ,
                r.prototype._resetIndexBufferBinding = function() {
                    this.bindIndexBuffer(null),
                    this._cachedIndexBuffer = null
                }
                ,
                r.prototype.createIndexBuffer = function(e, t) {
                    var r, i = this._gl.createBuffer();
                    if (!i)
                        throw new Error("Unable to create index buffer");
                    this.bindIndexBuffer(i);
                    var n = !1;
                    if (e instanceof Uint16Array)
                        r = e;
                    else if (this._caps.uintIndices)
                        if (e instanceof Uint32Array)
                            r = e,
                            n = !0;
                        else {
                            for (var o = 0; o < e.length; o++)
                                if (e[o] > 65535) {
                                    n = !0;
                                    break
                                }
                            r = n ? new Uint32Array(e) : new Uint16Array(e)
                        }
                    else
                        r = new Uint16Array(e);
                    return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, r, t ? this._gl.DYNAMIC_DRAW : this._gl.STATIC_DRAW),
                    this._resetIndexBufferBinding(),
                    i.references = 1,
                    i.is32Bits = n,
                    i
                }
                ,
                r.prototype.bindArrayBuffer = function(e) {
                    this._vaoRecordInProgress || this._unbindVertexArrayObject(),
                    this.bindBuffer(e, this._gl.ARRAY_BUFFER)
                }
                ,
                r.prototype.bindUniformBuffer = function(e) {
                    this._gl.bindBuffer(this._gl.UNIFORM_BUFFER, e)
                }
                ,
                r.prototype.bindUniformBufferBase = function(e, t) {
                    this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER, t, e)
                }
                ,
                r.prototype.bindUniformBlock = function(e, t, r) {
                    var i = this._gl.getUniformBlockIndex(e, t);
                    this._gl.uniformBlockBinding(e, i, r)
                }
                ,
                r.prototype.bindIndexBuffer = function(e) {
                    this._vaoRecordInProgress || this._unbindVertexArrayObject(),
                    this.bindBuffer(e, this._gl.ELEMENT_ARRAY_BUFFER)
                }
                ,
                r.prototype.bindBuffer = function(e, t) {
                    (this._vaoRecordInProgress || this._currentBoundBuffer[t] !== e) && (this._gl.bindBuffer(t, e),
                    this._currentBoundBuffer[t] = e)
                }
                ,
                r.prototype.updateArrayBuffer = function(e) {
                    this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, e)
                }
                ,
                r.prototype._vertexAttribPointer = function(e, t, r, i, n, o, a) {
                    var s = this._currentBufferPointers[t]
                      , y = !1;
                    s.active ? (s.buffer !== e && (s.buffer = e,
                    y = !0),
                    s.size !== r && (s.size = r,
                    y = !0),
                    s.type !== i && (s.type = i,
                    y = !0),
                    s.normalized !== n && (s.normalized = n,
                    y = !0),
                    s.stride !== o && (s.stride = o,
                    y = !0),
                    s.offset !== a && (s.offset = a,
                    y = !0)) : (y = !0,
                    s.active = !0,
                    s.index = t,
                    s.size = r,
                    s.type = i,
                    s.normalized = n,
                    s.stride = o,
                    s.offset = a,
                    s.buffer = e),
                    (y || this._vaoRecordInProgress) && (this.bindArrayBuffer(e),
                    this._gl.vertexAttribPointer(t, r, i, n, o, a))
                }
                ,
                r.prototype._bindIndexBufferWithCache = function(e) {
                    null != e && this._cachedIndexBuffer !== e && (this._cachedIndexBuffer = e,
                    this.bindIndexBuffer(e),
                    this._uintIndicesCurrentlySet = e.is32Bits)
                }
                ,
                r.prototype._bindVertexBuffersAttributes = function(e, t) {
                    var r = t.getAttributesNames();
                    this._vaoRecordInProgress || this._unbindVertexArrayObject(),
                    this.unbindAllAttributes();
                    for (var i = 0; i < r.length; i++) {
                        var n = t.getAttributeLocation(i);
                        if (n >= 0) {
                            var o = e[r[i]];
                            if (!o)
                                continue;
                            this._gl.enableVertexAttribArray(n),
                            this._vaoRecordInProgress || (this._vertexAttribArraysEnabled[n] = !0);
                            var a = o.getBuffer();
                            a && (this._vertexAttribPointer(a, n, o.getSize(), o.type, o.normalized, o.byteStride, o.byteOffset),
                            o.getIsInstanced() && (this._gl.vertexAttribDivisor(n, o.getInstanceDivisor()),
                            this._vaoRecordInProgress || (this._currentInstanceLocations.push(n),
                            this._currentInstanceBuffers.push(a))))
                        }
                    }
                }
                ,
                r.prototype.recordVertexArrayObject = function(e, t, r) {
                    var i = this._gl.createVertexArray();
                    return this._vaoRecordInProgress = !0,
                    this._gl.bindVertexArray(i),
                    this._mustWipeVertexAttributes = !0,
                    this._bindVertexBuffersAttributes(e, r),
                    this.bindIndexBuffer(t),
                    this._vaoRecordInProgress = !1,
                    this._gl.bindVertexArray(null),
                    i
                }
                ,
                r.prototype.bindVertexArrayObject = function(e, t) {
                    this._cachedVertexArrayObject !== e && (this._cachedVertexArrayObject = e,
                    this._gl.bindVertexArray(e),
                    this._cachedVertexBuffers = null,
                    this._cachedIndexBuffer = null,
                    this._uintIndicesCurrentlySet = null != t && t.is32Bits,
                    this._mustWipeVertexAttributes = !0)
                }
                ,
                r.prototype.bindBuffersDirectly = function(e, t, r, i, n) {
                    if (this._cachedVertexBuffers !== e || this._cachedEffectForVertexBuffers !== n) {
                        this._cachedVertexBuffers = e,
                        this._cachedEffectForVertexBuffers = n;
                        var o = n.getAttributesCount();
                        this._unbindVertexArrayObject(),
                        this.unbindAllAttributes();
                        for (var a = 0, s = 0; s < o; s++)
                            if (s < r.length) {
                                var y = n.getAttributeLocation(s);
                                y >= 0 && (this._gl.enableVertexAttribArray(y),
                                this._vertexAttribArraysEnabled[y] = !0,
                                this._vertexAttribPointer(e, y, r[s], this._gl.FLOAT, !1, i, a)),
                                a += 4 * r[s]
                            }
                    }
                    this._bindIndexBufferWithCache(t)
                }
                ,
                r.prototype._unbindVertexArrayObject = function() {
                    this._cachedVertexArrayObject && (this._cachedVertexArrayObject = null,
                    this._gl.bindVertexArray(null))
                }
                ,
                r.prototype.bindBuffers = function(e, t, r) {
                    this._cachedVertexBuffers === e && this._cachedEffectForVertexBuffers === r || (this._cachedVertexBuffers = e,
                    this._cachedEffectForVertexBuffers = r,
                    this._bindVertexBuffersAttributes(e, r)),
                    this._bindIndexBufferWithCache(t)
                }
                ,
                r.prototype.unbindInstanceAttributes = function() {
                    for (var e, t = 0, r = this._currentInstanceLocations.length; t < r; t++) {
                        var i = this._currentInstanceBuffers[t];
                        e != i && i.references && (e = i,
                        this.bindArrayBuffer(i));
                        var n = this._currentInstanceLocations[t];
                        this._gl.vertexAttribDivisor(n, 0)
                    }
                    this._currentInstanceBuffers.length = 0,
                    this._currentInstanceLocations.length = 0
                }
                ,
                r.prototype.releaseVertexArrayObject = function(e) {
                    this._gl.deleteVertexArray(e)
                }
                ,
                r.prototype._releaseBuffer = function(e) {
                    return e.references--,
                    0 === e.references && (this._gl.deleteBuffer(e),
                    !0)
                }
                ,
                r.prototype.createInstancesBuffer = function(e) {
                    var t = this._gl.createBuffer();
                    if (!t)
                        throw new Error("Unable to create instance buffer");
                    return t.capacity = e,
                    this.bindArrayBuffer(t),
                    this._gl.bufferData(this._gl.ARRAY_BUFFER, e, this._gl.DYNAMIC_DRAW),
                    t
                }
                ,
                r.prototype.deleteInstancesBuffer = function(e) {
                    this._gl.deleteBuffer(e)
                }
                ,
                r.prototype.updateAndBindInstancesBuffer = function(e, t, r) {
                    if (this.bindArrayBuffer(e),
                    t && this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, t),
                    void 0 !== r[0].index) {
                        for (var i = 0, n = 0; n < r.length; n++) {
                            i += 4 * (o = r[n]).attributeSize
                        }
                        for (n = 0; n < r.length; n++) {
                            var o = r[n];
                            this._vertexAttribArraysEnabled[o.index] || (this._gl.enableVertexAttribArray(o.index),
                            this._vertexAttribArraysEnabled[o.index] = !0),
                            this._vertexAttribPointer(e, o.index, o.attributeSize, o.attribyteType || this._gl.FLOAT, o.normalized || !1, i, o.offset),
                            this._gl.vertexAttribDivisor(o.index, 1),
                            this._currentInstanceLocations.push(o.index),
                            this._currentInstanceBuffers.push(e)
                        }
                    } else
                        for (var a = 0; a < 4; a++) {
                            var s = r[a];
                            this._vertexAttribArraysEnabled[s] || (this._gl.enableVertexAttribArray(s),
                            this._vertexAttribArraysEnabled[s] = !0),
                            this._vertexAttribPointer(e, s, 4, this._gl.FLOAT, !1, 64, 16 * a),
                            this._gl.vertexAttribDivisor(s, 1),
                            this._currentInstanceLocations.push(s),
                            this._currentInstanceBuffers.push(e)
                        }
                }
                ,
                r.prototype.applyStates = function() {
                    this._depthCullingState.apply(this._gl),
                    this._stencilState.apply(this._gl),
                    this._alphaState.apply(this._gl)
                }
                ,
                r.prototype.draw = function(t, r, i, n) {
                    this.drawElementsType(t ? e.Material.TriangleFillMode : e.Material.WireFrameFillMode, r, i, n)
                }
                ,
                r.prototype.drawPointClouds = function(t, r, i) {
                    this.drawArraysType(e.Material.PointFillMode, t, r, i)
                }
                ,
                r.prototype.drawUnIndexed = function(t, r, i, n) {
                    this.drawArraysType(t ? e.Material.TriangleFillMode : e.Material.WireFrameFillMode, r, i, n)
                }
                ,
                r.prototype.drawElementsType = function(e, t, r, i) {
                    this.applyStates(),
                    this._drawCalls.addCount(1, !1);
                    var n = this._drawMode(e)
                      , o = this._uintIndicesCurrentlySet ? this._gl.UNSIGNED_INT : this._gl.UNSIGNED_SHORT
                      , a = this._uintIndicesCurrentlySet ? 4 : 2;
                    i ? this._gl.drawElementsInstanced(n, r, o, t * a, i) : this._gl.drawElements(n, r, o, t * a)
                }
                ,
                r.prototype.drawArraysType = function(e, t, r, i) {
                    this.applyStates(),
                    this._drawCalls.addCount(1, !1);
                    var n = this._drawMode(e);
                    i ? this._gl.drawArraysInstanced(n, t, r, i) : this._gl.drawArrays(n, t, r)
                }
                ,
                r.prototype._drawMode = function(t) {
                    switch (t) {
                    case e.Material.TriangleFillMode:
                        return this._gl.TRIANGLES;
                    case e.Material.PointFillMode:
                        return this._gl.POINTS;
                    case e.Material.WireFrameFillMode:
                        return this._gl.LINES;
                    case e.Material.PointListDrawMode:
                        return this._gl.POINTS;
                    case e.Material.LineListDrawMode:
                        return this._gl.LINES;
                    case e.Material.LineLoopDrawMode:
                        return this._gl.LINE_LOOP;
                    case e.Material.LineStripDrawMode:
                        return this._gl.LINE_STRIP;
                    case e.Material.TriangleStripDrawMode:
                        return this._gl.TRIANGLE_STRIP;
                    case e.Material.TriangleFanDrawMode:
                        return this._gl.TRIANGLE_FAN;
                    default:
                        return this._gl.TRIANGLES
                    }
                }
                ,
                r.prototype._releaseEffect = function(e) {
                    this._compiledEffects[e._key] && (delete this._compiledEffects[e._key],
                    this._deleteProgram(e.getProgram()))
                }
                ,
                r.prototype._deleteProgram = function(e) {
                    e && (e.__SPECTOR_rebuildProgram = null,
                    e.transformFeedback && (this.deleteTransformFeedback(e.transformFeedback),
                    e.transformFeedback = null),
                    this._gl.deleteProgram(e))
                }
                ,
                r.prototype.createEffect = function(t, r, i, n, o, a, s, y, l) {
                    var c = (t.vertexElement || t.vertex || t) + "+" + (t.fragmentElement || t.fragment || t) + "@" + (o || r.defines);
                    if (this._compiledEffects[c]) {
                        var h = this._compiledEffects[c];
                        return s && h.isReady() && s(h),
                        h
                    }
                    var u = new e.Effect(t,r,i,n,this,o,a,s,y,l);
                    return u._key = c,
                    this._compiledEffects[c] = u,
                    u
                }
                ,
                r.prototype._compileShader = function(e, t, r, i) {
                    return this._compileRawShader(i + (r ? r + "\n" : "") + e, t)
                }
                ,
                r.prototype._compileRawShader = function(e, t) {
                    var r = this._gl
                      , i = r.createShader("vertex" === t ? r.VERTEX_SHADER : r.FRAGMENT_SHADER);
                    if (!i)
                        throw new Error("Something went wrong while compile the shader.");
                    if (r.shaderSource(i, e),
                    r.compileShader(i),
                    !r.getShaderParameter(i, r.COMPILE_STATUS)) {
                        var n = r.getShaderInfoLog(i);
                        if (n)
                            throw new Error(n)
                    }
                    return i
                }
                ,
                r.prototype.createRawShaderProgram = function(e, t, r, i) {
                    void 0 === i && (i = null),
                    r = r || this._gl;
                    var n = this._compileRawShader(e, "vertex")
                      , o = this._compileRawShader(t, "fragment");
                    return this._createShaderProgram(n, o, r, i)
                }
                ,
                r.prototype.createShaderProgram = function(e, t, r, i, n) {
                    void 0 === n && (n = null),
                    i = i || this._gl,
                    this.onBeforeShaderCompilationObservable.notifyObservers(this);
                    var o = this._webGLVersion > 1 ? "#version 300 es\n#define WEBGL2 \n" : ""
                      , a = this._compileShader(e, "vertex", r, o)
                      , s = this._compileShader(t, "fragment", r, o)
                      , y = this._createShaderProgram(a, s, i, n);
                    return this.onAfterShaderCompilationObservable.notifyObservers(this),
                    y
                }
                ,
                r.prototype._createShaderProgram = function(e, t, r, i) {
                    void 0 === i && (i = null);
                    var n, o = r.createProgram();
                    if (!o)
                        throw new Error("Unable to create program");
                    if (r.attachShader(o, e),
                    r.attachShader(o, t),
                    this.webGLVersion > 1 && i) {
                        var a = this.createTransformFeedback();
                        this.bindTransformFeedback(a),
                        this.setTranformFeedbackVaryings(o, i),
                        o.transformFeedback = a
                    }
                    if ((r.linkProgram(o),
                    this.webGLVersion > 1 && i && this.bindTransformFeedback(null),
                    !r.getProgramParameter(o, r.LINK_STATUS)) && (n = r.getProgramInfoLog(o)))
                        throw new Error(n);
                    if (this.validateShaderPrograms && (r.validateProgram(o),
                    !r.getProgramParameter(o, r.VALIDATE_STATUS) && (n = r.getProgramInfoLog(o))))
                        throw new Error(n);
                    return r.deleteShader(e),
                    r.deleteShader(t),
                    o
                }
                ,
                r.prototype.getUniforms = function(e, t) {
                    for (var r = new Array, i = 0; i < t.length; i++)
                        r.push(this._gl.getUniformLocation(e, t[i]));
                    return r
                }
                ,
                r.prototype.getAttributes = function(e, t) {
                    for (var r = [], i = 0; i < t.length; i++)
                        try {
                            r.push(this._gl.getAttribLocation(e, t[i]))
                        } catch (e) {
                            r.push(-1)
                        }
                    return r
                }
                ,
                r.prototype.enableEffect = function(e) {
                    e && e !== this._currentEffect && (this.bindSamplers(e),
                    this._currentEffect = e,
                    e.onBind && e.onBind(e),
                    e._onBindObservable && e._onBindObservable.notifyObservers(e))
                }
                ,
                r.prototype.setIntArray = function(e, t) {
                    e && this._gl.uniform1iv(e, t)
                }
                ,
                r.prototype.setIntArray2 = function(e, t) {
                    e && t.length % 2 == 0 && this._gl.uniform2iv(e, t)
                }
                ,
                r.prototype.setIntArray3 = function(e, t) {
                    e && t.length % 3 == 0 && this._gl.uniform3iv(e, t)
                }
                ,
                r.prototype.setIntArray4 = function(e, t) {
                    e && t.length % 4 == 0 && this._gl.uniform4iv(e, t)
                }
                ,
                r.prototype.setFloatArray = function(e, t) {
                    e && this._gl.uniform1fv(e, t)
                }
                ,
                r.prototype.setFloatArray2 = function(e, t) {
                    e && t.length % 2 == 0 && this._gl.uniform2fv(e, t)
                }
                ,
                r.prototype.setFloatArray3 = function(e, t) {
                    e && t.length % 3 == 0 && this._gl.uniform3fv(e, t)
                }
                ,
                r.prototype.setFloatArray4 = function(e, t) {
                    e && t.length % 4 == 0 && this._gl.uniform4fv(e, t)
                }
                ,
                r.prototype.setArray = function(e, t) {
                    e && this._gl.uniform1fv(e, t)
                }
                ,
                r.prototype.setArray2 = function(e, t) {
                    e && t.length % 2 == 0 && this._gl.uniform2fv(e, t)
                }
                ,
                r.prototype.setArray3 = function(e, t) {
                    e && t.length % 3 == 0 && this._gl.uniform3fv(e, t)
                }
                ,
                r.prototype.setArray4 = function(e, t) {
                    e && t.length % 4 == 0 && this._gl.uniform4fv(e, t)
                }
                ,
                r.prototype.setMatrices = function(e, t) {
                    e && this._gl.uniformMatrix4fv(e, !1, t)
                }
                ,
                r.prototype.setMatrix = function(e, t) {
                    e && this._gl.uniformMatrix4fv(e, !1, t.toArray())
                }
                ,
                r.prototype.setMatrix3x3 = function(e, t) {
                    e && this._gl.uniformMatrix3fv(e, !1, t)
                }
                ,
                r.prototype.setMatrix2x2 = function(e, t) {
                    e && this._gl.uniformMatrix2fv(e, !1, t)
                }
                ,
                r.prototype.setInt = function(e, t) {
                    e && this._gl.uniform1i(e, t)
                }
                ,
                r.prototype.setFloat = function(e, t) {
                    e && this._gl.uniform1f(e, t)
                }
                ,
                r.prototype.setFloat2 = function(e, t, r) {
                    e && this._gl.uniform2f(e, t, r)
                }
                ,
                r.prototype.setFloat3 = function(e, t, r, i) {
                    e && this._gl.uniform3f(e, t, r, i)
                }
                ,
                r.prototype.setBool = function(e, t) {
                    e && this._gl.uniform1i(e, t)
                }
                ,
                r.prototype.setFloat4 = function(e, t, r, i, n) {
                    e && this._gl.uniform4f(e, t, r, i, n)
                }
                ,
                r.prototype.setColor3 = function(e, t) {
                    e && this._gl.uniform3f(e, t.r, t.g, t.b)
                }
                ,
                r.prototype.setColor4 = function(e, t, r) {
                    e && this._gl.uniform4f(e, t.r, t.g, t.b, r)
                }
                ,
                r.prototype.setDirectColor4 = function(e, t) {
                    e && this._gl.uniform4f(e, t.r, t.g, t.b, t.a)
                }
                ,
                r.prototype.setState = function(e, t, r, i) {
                    void 0 === t && (t = 0),
                    void 0 === i && (i = !1),
                    (this._depthCullingState.cull !== e || r) && (this._depthCullingState.cull = e);
                    var n = this.cullBackFaces ? this._gl.BACK : this._gl.FRONT;
                    (this._depthCullingState.cullFace !== n || r) && (this._depthCullingState.cullFace = n),
                    this.setZOffset(t);
                    var o = i ? this._gl.CW : this._gl.CCW;
                    (this._depthCullingState.frontFace !== o || r) && (this._depthCullingState.frontFace = o)
                }
                ,
                r.prototype.setZOffset = function(e) {
                    this._depthCullingState.zOffset = e
                }
                ,
                r.prototype.getZOffset = function() {
                    return this._depthCullingState.zOffset
                }
                ,
                r.prototype.setDepthBuffer = function(e) {
                    this._depthCullingState.depthTest = e
                }
                ,
                r.prototype.getDepthWrite = function() {
                    return this._depthCullingState.depthMask
                }
                ,
                r.prototype.setDepthWrite = function(e) {
                    this._depthCullingState.depthMask = e
                }
                ,
                r.prototype.setColorWrite = function(e) {
                    this._gl.colorMask(e, e, e, e),
                    this._colorWrite = e
                }
                ,
                r.prototype.getColorWrite = function() {
                    return this._colorWrite
                }
                ,
                r.prototype.setAlphaConstants = function(e, t, r, i) {
                    this._alphaState.setAlphaBlendConstants(e, t, r, i)
                }
                ,
                r.prototype.setAlphaMode = function(e, t) {
                    if (void 0 === t && (t = !1),
                    this._alphaMode !== e) {
                        switch (e) {
                        case r.ALPHA_DISABLE:
                            this._alphaState.alphaBlend = !1;
                            break;
                        case r.ALPHA_PREMULTIPLIED:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE),
                            this._alphaState.alphaBlend = !0;
                            break;
                        case r.ALPHA_PREMULTIPLIED_PORTERDUFF:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA),
                            this._alphaState.alphaBlend = !0;
                            break;
                        case r.ALPHA_COMBINE:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE),
                            this._alphaState.alphaBlend = !0;
                            break;
                        case r.ALPHA_ONEONE:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE, this._gl.ZERO, this._gl.ONE),
                            this._alphaState.alphaBlend = !0;
                            break;
                        case r.ALPHA_ADD:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE, this._gl.ZERO, this._gl.ONE),
                            this._alphaState.alphaBlend = !0;
                            break;
                        case r.ALPHA_SUBTRACT:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE),
                            this._alphaState.alphaBlend = !0;
                            break;
                        case r.ALPHA_MULTIPLY:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR, this._gl.ZERO, this._gl.ONE, this._gl.ONE),
                            this._alphaState.alphaBlend = !0;
                            break;
                        case r.ALPHA_MAXIMIZED:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE),
                            this._alphaState.alphaBlend = !0;
                            break;
                        case r.ALPHA_INTERPOLATE:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR, this._gl.ONE_MINUS_CONSTANT_COLOR, this._gl.CONSTANT_ALPHA, this._gl.ONE_MINUS_CONSTANT_ALPHA),
                            this._alphaState.alphaBlend = !0;
                            break;
                        case r.ALPHA_SCREENMODE:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA),
                            this._alphaState.alphaBlend = !0
                        }
                        t || this.setDepthWrite(e === r.ALPHA_DISABLE),
                        this._alphaMode = e
                    }
                }
                ,
                r.prototype.getAlphaMode = function() {
                    return this._alphaMode
                }
                ,
                r.prototype.clearInternalTexturesCache = function() {
                    this._internalTexturesCache = []
                }
                ,
                r.prototype.wipeCaches = function(e) {
                    this.preventCacheWipeBetweenFrames && !e || (this._currentEffect = null,
                    this._viewportCached.x = 0,
                    this._viewportCached.y = 0,
                    this._viewportCached.z = 0,
                    this._viewportCached.w = 0,
                    e && (this.resetTextureCache(),
                    this._currentProgram = null,
                    this._stencilState.reset(),
                    this._depthCullingState.reset(),
                    this.setDepthFunctionToLessOrEqual(),
                    this._alphaState.reset(),
                    this._unpackFlipYCached = null),
                    this._resetVertexBufferBinding(),
                    this._cachedIndexBuffer = null,
                    this._cachedEffectForVertexBuffers = null,
                    this._unbindVertexArrayObject(),
                    this.bindIndexBuffer(null))
                }
                ,
                r.prototype.setTextureFormatToUse = function(e) {
                    for (var t = 0, r = this.texturesSupported.length; t < r; t++)
                        for (var i = 0, n = e.length; i < n; i++)
                            if (this._texturesSupported[t] === e[i].toLowerCase())
                                return this._textureFormatInUse = this._texturesSupported[t];
                    return this._textureFormatInUse = null,
                    null
                }
                ,
                r.prototype._getSamplingParameters = function(e, t) {
                    var i = this._gl
                      , n = i.NEAREST
                      , o = i.NEAREST;
                    switch (e) {
                    case r.TEXTURE_BILINEAR_SAMPLINGMODE:
                        n = i.LINEAR,
                        o = t ? i.LINEAR_MIPMAP_NEAREST : i.LINEAR;
                        break;
                    case r.TEXTURE_TRILINEAR_SAMPLINGMODE:
                        n = i.LINEAR,
                        o = t ? i.LINEAR_MIPMAP_LINEAR : i.LINEAR;
                        break;
                    case r.TEXTURE_NEAREST_SAMPLINGMODE:
                        n = i.NEAREST,
                        o = t ? i.NEAREST_MIPMAP_LINEAR : i.NEAREST;
                        break;
                    case r.TEXTURE_NEAREST_NEAREST_MIPNEAREST:
                        n = i.NEAREST,
                        o = t ? i.NEAREST_MIPMAP_NEAREST : i.NEAREST;
                        break;
                    case r.TEXTURE_NEAREST_LINEAR_MIPNEAREST:
                        n = i.NEAREST,
                        o = t ? i.LINEAR_MIPMAP_NEAREST : i.LINEAR;
                        break;
                    case r.TEXTURE_NEAREST_LINEAR_MIPLINEAR:
                        n = i.NEAREST,
                        o = t ? i.LINEAR_MIPMAP_LINEAR : i.LINEAR;
                        break;
                    case r.TEXTURE_NEAREST_LINEAR:
                        n = i.NEAREST,
                        o = i.LINEAR;
                        break;
                    case r.TEXTURE_NEAREST_NEAREST:
                        n = i.NEAREST,
                        o = i.NEAREST;
                        break;
                    case r.TEXTURE_LINEAR_NEAREST_MIPNEAREST:
                        n = i.LINEAR,
                        o = t ? i.NEAREST_MIPMAP_NEAREST : i.NEAREST;
                        break;
                    case r.TEXTURE_LINEAR_NEAREST_MIPLINEAR:
                        n = i.LINEAR,
                        o = t ? i.NEAREST_MIPMAP_LINEAR : i.NEAREST;
                        break;
                    case r.TEXTURE_LINEAR_LINEAR:
                        n = i.LINEAR,
                        o = i.LINEAR;
                        break;
                    case r.TEXTURE_LINEAR_NEAREST:
                        n = i.LINEAR,
                        o = i.NEAREST
                    }
                    return {
                        min: o,
                        mag: n
                    }
                }
                ,
                r.prototype._partialLoadImg = function(t, r, i, n, o, a) {
                    var s;
                    void 0 === a && (a = null);
                    s = e.Tools.LoadImage(t, (function() {
                        i[r] = s,
                        i._internalCount++,
                        n && n._removePendingData(s),
                        6 === i._internalCount && o(i)
                    }
                    ), (function(e, t) {
                        n && n._removePendingData(s),
                        a && a(e, t)
                    }
                    ), n ? n.database : null),
                    n && n._addPendingData(s)
                }
                ,
                r.prototype._cascadeLoadImgs = function(e, t, r, i, n) {
                    void 0 === n && (n = null);
                    var o = [];
                    o._internalCount = 0;
                    for (var a = 0; a < 6; a++)
                        this._partialLoadImg(i[a], a, o, t, r, n)
                }
                ,
                r.prototype._createTexture = function() {
                    var e = this._gl.createTexture();
                    if (!e)
                        throw new Error("Unable to create texture");
                    return e
                }
                ,
                r.prototype.createTexture = function(t, i, n, o, a, s, y, l, c, h, u) {
                    var d = this;
                    void 0 === a && (a = r.TEXTURE_TRILINEAR_SAMPLINGMODE),
                    void 0 === s && (s = null),
                    void 0 === y && (y = null),
                    void 0 === l && (l = null),
                    void 0 === c && (c = null),
                    void 0 === h && (h = null),
                    void 0 === u && (u = null);
                    for (var x = String(t), p = "data:" === x.substr(0, 5), f = "blob:" === x.substr(0, 5), m = p && -1 !== x.indexOf(";base64,"), z = c || new e.InternalTexture(this,e.InternalTexture.DATASOURCE_URL), _ = x.lastIndexOf("."), g = u || (_ > -1 ? x.substring(_).toLowerCase() : ""), v = null, b = 0, T = r._TextureLoaders; b < T.length; b++) {
                        var E = T[b];
                        if (E.canLoad(g, this._textureFormatInUse, c, m, !!l)) {
                            v = E;
                            break
                        }
                    }
                    v && (x = v.transformUrl(x, this._textureFormatInUse)),
                    o && o._addPendingData(z),
                    z.url = x,
                    z.generateMipMaps = !i,
                    z.samplingMode = a,
                    z.invertY = n,
                    this._doNotHandleContextLost || (z._buffer = l);
                    var P = null;
                    s && !c && (P = z.onLoadedObservable.add(s)),
                    c || this._internalTexturesCache.push(z);
                    var A = function(r, s) {
                        o && o._removePendingData(z);
                        var c = !1;
                        v && (v.getFallbackTextureUrl(x, d._textureFormatInUse) && (c = !0,
                        d.createTexture(t, i, n, o, a, null, y, l, z)));
                        c || (P && z.onLoadedObservable.remove(P),
                        e.Tools.UseFallbackTexture && d.createTexture(e.Tools.fallbackTexture, i, n, o, a, null, y, l, z)),
                        y && y(r || "Unknown error", s)
                    };
                    if (v) {
                        var S = function(e) {
                            v.loadData(e, z, (function(e, t, r, i, s) {
                                d._prepareWebGLTexture(z, o, e, t, n, !r, i, (function() {
                                    return s(),
                                    !1
                                }
                                ), a)
                            }
                            ))
                        };
                        l ? S(l) : this._loadFile(x, S, void 0, o ? o.database : void 0, !0, (function(e, t) {
                            A("Unable to load " + (e && e.responseURL,
                            t))
                        }
                        ))
                    } else {
                        var M = function(t) {
                            f && !d._doNotHandleContextLost && (z._buffer = t),
                            d._prepareWebGLTexture(z, o, t.width, t.height, n, i, !1, (function(r, i, n) {
                                var a = d._gl
                                  , s = t.width === r && t.height === i
                                  , y = h ? d._getInternalFormat(h) : ".jpg" === g ? a.RGB : a.RGBA;
                                if (s)
                                    return a.texImage2D(a.TEXTURE_2D, 0, y, y, a.UNSIGNED_BYTE, t),
                                    !1;
                                var l = d._caps.maxTextureSize;
                                if (t.width > l || t.height > l)
                                    return d._prepareWorkingCanvas(),
                                    !(!d._workingCanvas || !d._workingContext) && (d._workingCanvas.width = r,
                                    d._workingCanvas.height = i,
                                    d._workingContext.drawImage(t, 0, 0, t.width, t.height, 0, 0, r, i),
                                    a.texImage2D(a.TEXTURE_2D, 0, y, y, a.UNSIGNED_BYTE, d._workingCanvas),
                                    z.width = r,
                                    z.height = i,
                                    !1);
                                var c = new e.InternalTexture(d,e.InternalTexture.DATASOURCE_TEMP);
                                return d._bindTextureDirectly(a.TEXTURE_2D, c, !0),
                                a.texImage2D(a.TEXTURE_2D, 0, y, y, a.UNSIGNED_BYTE, t),
                                a.texParameteri(a.TEXTURE_2D, a.TEXTURE_MAG_FILTER, a.LINEAR),
                                a.texParameteri(a.TEXTURE_2D, a.TEXTURE_MIN_FILTER, a.LINEAR),
                                a.texParameteri(a.TEXTURE_2D, a.TEXTURE_WRAP_S, a.CLAMP_TO_EDGE),
                                a.texParameteri(a.TEXTURE_2D, a.TEXTURE_WRAP_T, a.CLAMP_TO_EDGE),
                                d._rescaleTexture(c, z, o, y, (function() {
                                    d._releaseTexture(c),
                                    d._bindTextureDirectly(a.TEXTURE_2D, z, !0),
                                    n()
                                }
                                )),
                                !0
                            }
                            ), a)
                        };
                        !p || m ? l instanceof HTMLImageElement ? M(l) : e.Tools.LoadImage(x, M, A, o ? o.database : null) : "string" == typeof l || l instanceof ArrayBuffer || l instanceof Blob ? e.Tools.LoadImage(l, M, A, o ? o.database : null) : M(l)
                    }
                    return z
                }
                ,
                r.prototype._rescaleTexture = function(t, i, n, o, a) {
                    var s = this
                      , y = this.createRenderTargetTexture({
                        width: i.width,
                        height: i.height
                    }, {
                        generateMipMaps: !1,
                        type: r.TEXTURETYPE_UNSIGNED_INT,
                        samplingMode: r.TEXTURE_BILINEAR_SAMPLINGMODE,
                        generateDepthBuffer: !1,
                        generateStencilBuffer: !1
                    });
                    this._rescalePostProcess || (this._rescalePostProcess = new e.PassPostProcess("rescale",1,null,r.TEXTURE_BILINEAR_SAMPLINGMODE,this,!1,r.TEXTURETYPE_UNSIGNED_INT)),
                    this._rescalePostProcess.getEffect().executeWhenCompiled((function() {
                        s._rescalePostProcess.onApply = function(e) {
                            e._bindTexture("textureSampler", t)
                        }
                        ;
                        var e = n;
                        e || (e = s.scenes[s.scenes.length - 1]),
                        e.postProcessManager.directRender([s._rescalePostProcess], y, !0),
                        s._bindTextureDirectly(s._gl.TEXTURE_2D, i, !0),
                        s._gl.copyTexImage2D(s._gl.TEXTURE_2D, 0, o, 0, 0, i.width, i.height, 0),
                        s.unBindFramebuffer(y),
                        s._releaseTexture(y),
                        a && a()
                    }
                    ))
                }
                ,
                r.prototype.updateRawTexture = function(e, t, i, n, o, a) {
                    if (void 0 === o && (o = null),
                    void 0 === a && (a = r.TEXTURETYPE_UNSIGNED_INT),
                    e) {
                        var s = this._getRGBABufferInternalSizedFormat(a, i)
                          , y = this._getInternalFormat(i)
                          , l = this._getWebGLTextureType(a);
                        this._bindTextureDirectly(this._gl.TEXTURE_2D, e, !0),
                        this._unpackFlipY(void 0 === n || !!n),
                        this._doNotHandleContextLost || (e._bufferView = t,
                        e.format = i,
                        e.type = a,
                        e.invertY = n,
                        e._compression = o),
                        e.width % 4 != 0 && this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT, 1),
                        o && t ? this._gl.compressedTexImage2D(this._gl.TEXTURE_2D, 0, this.getCaps().s3tc[o], e.width, e.height, 0, t) : this._gl.texImage2D(this._gl.TEXTURE_2D, 0, s, e.width, e.height, 0, y, l, t),
                        e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D),
                        this._bindTextureDirectly(this._gl.TEXTURE_2D, null),
                        e.isReady = !0
                    }
                }
                ,
                r.prototype.createRawTexture = function(t, i, n, o, a, s, y, l, c) {
                    void 0 === l && (l = null),
                    void 0 === c && (c = r.TEXTURETYPE_UNSIGNED_INT);
                    var h = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RAW);
                    h.baseWidth = i,
                    h.baseHeight = n,
                    h.width = i,
                    h.height = n,
                    h.format = o,
                    h.generateMipMaps = a,
                    h.samplingMode = y,
                    h.invertY = s,
                    h._compression = l,
                    h.type = c,
                    this._doNotHandleContextLost || (h._bufferView = t),
                    this.updateRawTexture(h, t, o, s, l, c),
                    this._bindTextureDirectly(this._gl.TEXTURE_2D, h, !0);
                    var u = this._getSamplingParameters(y, a);
                    return this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, u.mag),
                    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, u.min),
                    a && this._gl.generateMipmap(this._gl.TEXTURE_2D),
                    this._bindTextureDirectly(this._gl.TEXTURE_2D, null),
                    this._internalTexturesCache.push(h),
                    h
                }
                ,
                r.prototype._unpackFlipY = function(e) {
                    this._unpackFlipYCached !== e && (this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, e ? 1 : 0),
                    this.enableUnpackFlipYCached && (this._unpackFlipYCached = e))
                }
                ,
                r.prototype._getUnpackAlignement = function() {
                    return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)
                }
                ,
                r.prototype.createDynamicTexture = function(t, r, i, n) {
                    var o = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_DYNAMIC);
                    return o.baseWidth = t,
                    o.baseHeight = r,
                    i && (t = this.needPOTTextures ? e.Tools.GetExponentOfTwo(t, this._caps.maxTextureSize) : t,
                    r = this.needPOTTextures ? e.Tools.GetExponentOfTwo(r, this._caps.maxTextureSize) : r),
                    o.width = t,
                    o.height = r,
                    o.isReady = !1,
                    o.generateMipMaps = i,
                    o.samplingMode = n,
                    this.updateTextureSamplingMode(n, o),
                    this._internalTexturesCache.push(o),
                    o
                }
                ,
                r.prototype.updateTextureSamplingMode = function(e, t) {
                    var r = this._getSamplingParameters(e, t.generateMipMaps);
                    t.isCube ? (this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_MAG_FILTER, r.mag, t),
                    this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_MIN_FILTER, r.min),
                    this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null)) : t.is3D ? (this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_MAG_FILTER, r.mag, t),
                    this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_MIN_FILTER, r.min),
                    this._bindTextureDirectly(this._gl.TEXTURE_3D, null)) : (this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, r.mag, t),
                    this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, r.min),
                    this._bindTextureDirectly(this._gl.TEXTURE_2D, null)),
                    t.samplingMode = e
                }
                ,
                r.prototype.updateDynamicTexture = function(e, t, r, i, n) {
                    if (void 0 === i && (i = !1),
                    e) {
                        this._bindTextureDirectly(this._gl.TEXTURE_2D, e, !0),
                        this._unpackFlipY(r),
                        i && this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1);
                        var o = n ? this._getInternalFormat(n) : this._gl.RGBA;
                        this._gl.texImage2D(this._gl.TEXTURE_2D, 0, o, o, this._gl.UNSIGNED_BYTE, t),
                        e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D),
                        this._bindTextureDirectly(this._gl.TEXTURE_2D, null),
                        i && this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0),
                        e.isReady = !0
                    }
                }
                ,
                r.prototype.updateVideoTexture = function(e, t, r) {
                    if (e && !e._isDisabled) {
                        var i = this._bindTextureDirectly(this._gl.TEXTURE_2D, e, !0);
                        this._unpackFlipY(!r);
                        try {
                            if (void 0 === this._videoTextureSupported && (this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, t),
                            0 !== this._gl.getError() ? this._videoTextureSupported = !1 : this._videoTextureSupported = !0),
                            this._videoTextureSupported)
                                this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, t);
                            else {
                                if (!e._workingCanvas) {
                                    e._workingCanvas = document.createElement("canvas");
                                    var n = e._workingCanvas.getContext("2d");
                                    if (!n)
                                        throw new Error("Unable to get 2d context");
                                    e._workingContext = n,
                                    e._workingCanvas.width = e.width,
                                    e._workingCanvas.height = e.height
                                }
                                e._workingContext.drawImage(t, 0, 0, t.videoWidth, t.videoHeight, 0, 0, e.width, e.height),
                                this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, e._workingCanvas)
                            }
                            e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D),
                            i || this._bindTextureDirectly(this._gl.TEXTURE_2D, null),
                            e.isReady = !0
                        } catch (t) {
                            e._isDisabled = !0
                        }
                    }
                }
                ,
                r.prototype.updateTextureComparisonFunction = function(t, i) {
                    if (1 !== this.webGLVersion) {
                        var n = this._gl;
                        t.isCube ? (this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, t, !0),
                        0 === i ? (n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_COMPARE_FUNC, r.LEQUAL),
                        n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_COMPARE_MODE, n.NONE)) : (n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_COMPARE_FUNC, i),
                        n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_COMPARE_MODE, n.COMPARE_REF_TO_TEXTURE)),
                        this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null)) : (this._bindTextureDirectly(this._gl.TEXTURE_2D, t, !0),
                        0 === i ? (n.texParameteri(n.TEXTURE_2D, n.TEXTURE_COMPARE_FUNC, r.LEQUAL),
                        n.texParameteri(n.TEXTURE_2D, n.TEXTURE_COMPARE_MODE, n.NONE)) : (n.texParameteri(n.TEXTURE_2D, n.TEXTURE_COMPARE_FUNC, i),
                        n.texParameteri(n.TEXTURE_2D, n.TEXTURE_COMPARE_MODE, n.COMPARE_REF_TO_TEXTURE)),
                        this._bindTextureDirectly(this._gl.TEXTURE_2D, null)),
                        t._comparisonFunction = i
                    } else
                        e.Tools.Error("WebGL 1 does not support texture comparison.")
                }
                ,
                r.prototype._setupDepthStencilTexture = function(e, t, i, n, o) {
                    var a = t.width || t
                      , s = t.height || t;
                    e.baseWidth = a,
                    e.baseHeight = s,
                    e.width = a,
                    e.height = s,
                    e.isReady = !0,
                    e.samples = 1,
                    e.generateMipMaps = !1,
                    e._generateDepthBuffer = !0,
                    e._generateStencilBuffer = i,
                    e.samplingMode = n ? r.TEXTURE_BILINEAR_SAMPLINGMODE : r.TEXTURE_NEAREST_SAMPLINGMODE,
                    e.type = r.TEXTURETYPE_UNSIGNED_INT,
                    e._comparisonFunction = o;
                    var y = this._gl
                      , l = e.isCube ? y.TEXTURE_CUBE_MAP : y.TEXTURE_2D
                      , c = this._getSamplingParameters(e.samplingMode, !1);
                    y.texParameteri(l, y.TEXTURE_MAG_FILTER, c.mag),
                    y.texParameteri(l, y.TEXTURE_MIN_FILTER, c.min),
                    y.texParameteri(l, y.TEXTURE_WRAP_S, y.CLAMP_TO_EDGE),
                    y.texParameteri(l, y.TEXTURE_WRAP_T, y.CLAMP_TO_EDGE),
                    0 === o ? (y.texParameteri(l, y.TEXTURE_COMPARE_FUNC, r.LEQUAL),
                    y.texParameteri(l, y.TEXTURE_COMPARE_MODE, y.NONE)) : (y.texParameteri(l, y.TEXTURE_COMPARE_FUNC, o),
                    y.texParameteri(l, y.TEXTURE_COMPARE_MODE, y.COMPARE_REF_TO_TEXTURE))
                }
                ,
                r.prototype.createDepthStencilTexture = function(e, t) {
                    if (t.isCube) {
                        var r = e.width || e;
                        return this._createDepthStencilCubeTexture(r, t)
                    }
                    return this._createDepthStencilTexture(e, t)
                }
                ,
                r.prototype._createDepthStencilTexture = function(t, r) {
                    var i = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_DEPTHTEXTURE);
                    if (!this._caps.depthTextureExtension)
                        return e.Tools.Error("Depth texture is not supported by your browser or hardware."),
                        i;
                    var n = a({
                        bilinearFiltering: !1,
                        comparisonFunction: 0,
                        generateStencil: !1
                    }, r)
                      , o = this._gl;
                    return this._bindTextureDirectly(o.TEXTURE_2D, i, !0),
                    this._setupDepthStencilTexture(i, t, n.generateStencil, n.bilinearFiltering, n.comparisonFunction),
                    this.webGLVersion > 1 ? n.generateStencil ? o.texImage2D(o.TEXTURE_2D, 0, o.DEPTH24_STENCIL8, i.width, i.height, 0, o.DEPTH_STENCIL, o.UNSIGNED_INT_24_8, null) : o.texImage2D(o.TEXTURE_2D, 0, o.DEPTH_COMPONENT24, i.width, i.height, 0, o.DEPTH_COMPONENT, o.UNSIGNED_INT, null) : n.generateStencil ? o.texImage2D(o.TEXTURE_2D, 0, o.DEPTH_STENCIL, i.width, i.height, 0, o.DEPTH_STENCIL, o.UNSIGNED_INT_24_8, null) : o.texImage2D(o.TEXTURE_2D, 0, o.DEPTH_COMPONENT, i.width, i.height, 0, o.DEPTH_COMPONENT, o.UNSIGNED_INT, null),
                    this._bindTextureDirectly(o.TEXTURE_2D, null),
                    i
                }
                ,
                r.prototype._createDepthStencilCubeTexture = function(t, r) {
                    var i = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_UNKNOWN);
                    if (i.isCube = !0,
                    1 === this.webGLVersion)
                        return e.Tools.Error("Depth cube texture is not supported by WebGL 1."),
                        i;
                    var n = a({
                        bilinearFiltering: !1,
                        comparisonFunction: 0,
                        generateStencil: !1
                    }, r)
                      , o = this._gl;
                    this._bindTextureDirectly(o.TEXTURE_CUBE_MAP, i, !0),
                    this._setupDepthStencilTexture(i, t, n.generateStencil, n.bilinearFiltering, n.comparisonFunction);
                    for (var s = 0; s < 6; s++)
                        n.generateStencil ? o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X + s, 0, o.DEPTH24_STENCIL8, t, t, 0, o.DEPTH_STENCIL, o.UNSIGNED_INT_24_8, null) : o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X + s, 0, o.DEPTH_COMPONENT24, t, t, 0, o.DEPTH_COMPONENT, o.UNSIGNED_INT, null);
                    return this._bindTextureDirectly(o.TEXTURE_CUBE_MAP, null),
                    i
                }
                ,
                r.prototype.setFrameBufferDepthStencilTexture = function(e) {
                    var t = e.getInternalTexture();
                    if (t && t._framebuffer && e.depthStencilTexture) {
                        var r = this._gl
                          , i = e.depthStencilTexture;
                        this.bindUnboundFramebuffer(t._framebuffer),
                        i.isCube ? i._generateStencilBuffer ? r.framebufferTexture2D(r.FRAMEBUFFER, r.DEPTH_STENCIL_ATTACHMENT, r.TEXTURE_CUBE_MAP_POSITIVE_X, i._webGLTexture, 0) : r.framebufferTexture2D(r.FRAMEBUFFER, r.DEPTH_ATTACHMENT, r.TEXTURE_CUBE_MAP_POSITIVE_X, i._webGLTexture, 0) : i._generateStencilBuffer ? r.framebufferTexture2D(r.FRAMEBUFFER, r.DEPTH_STENCIL_ATTACHMENT, r.TEXTURE_2D, i._webGLTexture, 0) : r.framebufferTexture2D(r.FRAMEBUFFER, r.DEPTH_ATTACHMENT, r.TEXTURE_2D, i._webGLTexture, 0),
                        this.bindUnboundFramebuffer(null)
                    }
                }
                ,
                r.prototype.createRenderTargetTexture = function(t, n) {
                    var o = new i;
                    void 0 !== n && "object" == typeof n ? (o.generateMipMaps = n.generateMipMaps,
                    o.generateDepthBuffer = void 0 === n.generateDepthBuffer || n.generateDepthBuffer,
                    o.generateStencilBuffer = o.generateDepthBuffer && n.generateStencilBuffer,
                    o.type = void 0 === n.type ? r.TEXTURETYPE_UNSIGNED_INT : n.type,
                    o.samplingMode = void 0 === n.samplingMode ? r.TEXTURE_TRILINEAR_SAMPLINGMODE : n.samplingMode,
                    o.format = void 0 === n.format ? r.TEXTUREFORMAT_RGBA : n.format) : (o.generateMipMaps = n,
                    o.generateDepthBuffer = !0,
                    o.generateStencilBuffer = !1,
                    o.type = r.TEXTURETYPE_UNSIGNED_INT,
                    o.samplingMode = r.TEXTURE_TRILINEAR_SAMPLINGMODE,
                    o.format = r.TEXTUREFORMAT_RGBA),
                    (o.type !== r.TEXTURETYPE_FLOAT || this._caps.textureFloatLinearFiltering) && (o.type !== r.TEXTURETYPE_HALF_FLOAT || this._caps.textureHalfFloatLinearFiltering) || (o.samplingMode = r.TEXTURE_NEAREST_SAMPLINGMODE);
                    var a = this._gl
                      , s = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RENDERTARGET);
                    this._bindTextureDirectly(a.TEXTURE_2D, s, !0);
                    var y = t.width || t
                      , l = t.height || t
                      , c = this._getSamplingParameters(o.samplingMode, !!o.generateMipMaps);
                    o.type !== r.TEXTURETYPE_FLOAT || this._caps.textureFloat || (o.type = r.TEXTURETYPE_UNSIGNED_INT,
                    e.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),
                    a.texParameteri(a.TEXTURE_2D, a.TEXTURE_MAG_FILTER, c.mag),
                    a.texParameteri(a.TEXTURE_2D, a.TEXTURE_MIN_FILTER, c.min),
                    a.texParameteri(a.TEXTURE_2D, a.TEXTURE_WRAP_S, a.CLAMP_TO_EDGE),
                    a.texParameteri(a.TEXTURE_2D, a.TEXTURE_WRAP_T, a.CLAMP_TO_EDGE),
                    a.texImage2D(a.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(o.type, o.format), y, l, 0, this._getInternalFormat(o.format), this._getWebGLTextureType(o.type), null);
                    var h = this._currentFramebuffer
                      , u = a.createFramebuffer();
                    return this.bindUnboundFramebuffer(u),
                    a.framebufferTexture2D(a.FRAMEBUFFER, a.COLOR_ATTACHMENT0, a.TEXTURE_2D, s._webGLTexture, 0),
                    s._depthStencilBuffer = this._setupFramebufferDepthAttachments(!!o.generateStencilBuffer, o.generateDepthBuffer, y, l),
                    o.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D),
                    this._bindTextureDirectly(a.TEXTURE_2D, null),
                    a.bindRenderbuffer(a.RENDERBUFFER, null),
                    this.bindUnboundFramebuffer(h),
                    s._framebuffer = u,
                    s.baseWidth = y,
                    s.baseHeight = l,
                    s.width = y,
                    s.height = l,
                    s.isReady = !0,
                    s.samples = 1,
                    s.generateMipMaps = !!o.generateMipMaps,
                    s.samplingMode = o.samplingMode,
                    s.type = o.type,
                    s.format = o.format,
                    s._generateDepthBuffer = o.generateDepthBuffer,
                    s._generateStencilBuffer = !!o.generateStencilBuffer,
                    this._internalTexturesCache.push(s),
                    s
                }
                ,
                r.prototype.createMultipleRenderTarget = function(t, i) {
                    var n = !1
                      , o = !0
                      , a = !1
                      , s = !1
                      , y = 1
                      , l = r.TEXTURETYPE_UNSIGNED_INT
                      , c = r.TEXTURE_TRILINEAR_SAMPLINGMODE
                      , h = new Array
                      , u = new Array;
                    void 0 !== i && (n = void 0 !== i.generateMipMaps && i.generateMipMaps,
                    o = void 0 === i.generateDepthBuffer || i.generateDepthBuffer,
                    a = void 0 !== i.generateStencilBuffer && i.generateStencilBuffer,
                    s = void 0 !== i.generateDepthTexture && i.generateDepthTexture,
                    y = i.textureCount || 1,
                    i.types && (h = i.types),
                    i.samplingModes && (u = i.samplingModes));
                    var d = this._gl
                      , x = d.createFramebuffer();
                    this.bindUnboundFramebuffer(x);
                    for (var p = t.width || t, f = t.height || t, m = [], z = [], _ = this._setupFramebufferDepthAttachments(a, o, p, f), g = 0; g < y; g++) {
                        var v = u[g] || c
                          , b = h[g] || l;
                        (b !== r.TEXTURETYPE_FLOAT || this._caps.textureFloatLinearFiltering) && (b !== r.TEXTURETYPE_HALF_FLOAT || this._caps.textureHalfFloatLinearFiltering) || (v = r.TEXTURE_NEAREST_SAMPLINGMODE);
                        var T = this._getSamplingParameters(v, n);
                        b !== r.TEXTURETYPE_FLOAT || this._caps.textureFloat || (b = r.TEXTURETYPE_UNSIGNED_INT,
                        e.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));
                        var E = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_MULTIRENDERTARGET)
                          , P = d[this.webGLVersion > 1 ? "COLOR_ATTACHMENT" + g : "COLOR_ATTACHMENT" + g + "_WEBGL"];
                        m.push(E),
                        z.push(P),
                        d.activeTexture(d["TEXTURE" + g]),
                        d.bindTexture(d.TEXTURE_2D, E._webGLTexture),
                        d.texParameteri(d.TEXTURE_2D, d.TEXTURE_MAG_FILTER, T.mag),
                        d.texParameteri(d.TEXTURE_2D, d.TEXTURE_MIN_FILTER, T.min),
                        d.texParameteri(d.TEXTURE_2D, d.TEXTURE_WRAP_S, d.CLAMP_TO_EDGE),
                        d.texParameteri(d.TEXTURE_2D, d.TEXTURE_WRAP_T, d.CLAMP_TO_EDGE),
                        d.texImage2D(d.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(b), p, f, 0, d.RGBA, this._getWebGLTextureType(b), null),
                        d.framebufferTexture2D(d.DRAW_FRAMEBUFFER, P, d.TEXTURE_2D, E._webGLTexture, 0),
                        n && this._gl.generateMipmap(this._gl.TEXTURE_2D),
                        this._bindTextureDirectly(d.TEXTURE_2D, null),
                        E._framebuffer = x,
                        E._depthStencilBuffer = _,
                        E.baseWidth = p,
                        E.baseHeight = f,
                        E.width = p,
                        E.height = f,
                        E.isReady = !0,
                        E.samples = 1,
                        E.generateMipMaps = n,
                        E.samplingMode = v,
                        E.type = b,
                        E._generateDepthBuffer = o,
                        E._generateStencilBuffer = a,
                        E._attachments = z,
                        this._internalTexturesCache.push(E)
                    }
                    if (s && this._caps.depthTextureExtension) {
                        var A = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_MULTIRENDERTARGET);
                        d.activeTexture(d.TEXTURE0),
                        d.bindTexture(d.TEXTURE_2D, A._webGLTexture),
                        d.texParameteri(d.TEXTURE_2D, d.TEXTURE_MAG_FILTER, d.NEAREST),
                        d.texParameteri(d.TEXTURE_2D, d.TEXTURE_MIN_FILTER, d.NEAREST),
                        d.texParameteri(d.TEXTURE_2D, d.TEXTURE_WRAP_S, d.CLAMP_TO_EDGE),
                        d.texParameteri(d.TEXTURE_2D, d.TEXTURE_WRAP_T, d.CLAMP_TO_EDGE),
                        d.texImage2D(d.TEXTURE_2D, 0, this.webGLVersion < 2 ? d.DEPTH_COMPONENT : d.DEPTH_COMPONENT16, p, f, 0, d.DEPTH_COMPONENT, d.UNSIGNED_SHORT, null),
                        d.framebufferTexture2D(d.FRAMEBUFFER, d.DEPTH_ATTACHMENT, d.TEXTURE_2D, A._webGLTexture, 0),
                        A._framebuffer = x,
                        A.baseWidth = p,
                        A.baseHeight = f,
                        A.width = p,
                        A.height = f,
                        A.isReady = !0,
                        A.samples = 1,
                        A.generateMipMaps = n,
                        A.samplingMode = d.NEAREST,
                        A._generateDepthBuffer = o,
                        A._generateStencilBuffer = a,
                        m.push(A),
                        this._internalTexturesCache.push(A)
                    }
                    return d.drawBuffers(z),
                    d.bindRenderbuffer(d.RENDERBUFFER, null),
                    this.bindUnboundFramebuffer(null),
                    this.resetTextureCache(),
                    m
                }
                ,
                r.prototype._setupFramebufferDepthAttachments = function(e, t, r, i, n) {
                    void 0 === n && (n = 1);
                    var o = null
                      , a = this._gl;
                    return e ? (o = a.createRenderbuffer(),
                    a.bindRenderbuffer(a.RENDERBUFFER, o),
                    n > 1 ? a.renderbufferStorageMultisample(a.RENDERBUFFER, n, a.DEPTH24_STENCIL8, r, i) : a.renderbufferStorage(a.RENDERBUFFER, a.DEPTH_STENCIL, r, i),
                    a.framebufferRenderbuffer(a.FRAMEBUFFER, a.DEPTH_STENCIL_ATTACHMENT, a.RENDERBUFFER, o)) : t && (o = a.createRenderbuffer(),
                    a.bindRenderbuffer(a.RENDERBUFFER, o),
                    n > 1 ? a.renderbufferStorageMultisample(a.RENDERBUFFER, n, a.DEPTH_COMPONENT16, r, i) : a.renderbufferStorage(a.RENDERBUFFER, a.DEPTH_COMPONENT16, r, i),
                    a.framebufferRenderbuffer(a.FRAMEBUFFER, a.DEPTH_ATTACHMENT, a.RENDERBUFFER, o)),
                    o
                }
                ,
                r.prototype.updateRenderTargetTextureSampleCount = function(e, t) {
                    if (this.webGLVersion < 2 || !e)
                        return 1;
                    if (e.samples === t)
                        return t;
                    var r = this._gl;
                    if (t = Math.min(t, r.getParameter(r.MAX_SAMPLES)),
                    e._depthStencilBuffer && (r.deleteRenderbuffer(e._depthStencilBuffer),
                    e._depthStencilBuffer = null),
                    e._MSAAFramebuffer && (r.deleteFramebuffer(e._MSAAFramebuffer),
                    e._MSAAFramebuffer = null),
                    e._MSAARenderBuffer && (r.deleteRenderbuffer(e._MSAARenderBuffer),
                    e._MSAARenderBuffer = null),
                    t > 1) {
                        var i = r.createFramebuffer();
                        if (!i)
                            throw new Error("Unable to create multi sampled framebuffer");
                        e._MSAAFramebuffer = i,
                        this.bindUnboundFramebuffer(e._MSAAFramebuffer);
                        var n = r.createRenderbuffer();
                        if (!n)
                            throw new Error("Unable to create multi sampled framebuffer");
                        r.bindRenderbuffer(r.RENDERBUFFER, n),
                        r.renderbufferStorageMultisample(r.RENDERBUFFER, t, this._getRGBAMultiSampleBufferFormat(e.type), e.width, e.height),
                        r.framebufferRenderbuffer(r.FRAMEBUFFER, r.COLOR_ATTACHMENT0, r.RENDERBUFFER, n),
                        e._MSAARenderBuffer = n
                    } else
                        this.bindUnboundFramebuffer(e._framebuffer);
                    return e.samples = t,
                    e._depthStencilBuffer = this._setupFramebufferDepthAttachments(e._generateStencilBuffer, e._generateDepthBuffer, e.width, e.height, t),
                    r.bindRenderbuffer(r.RENDERBUFFER, null),
                    this.bindUnboundFramebuffer(null),
                    t
                }
                ,
                r.prototype.updateMultipleRenderTargetTextureSampleCount = function(e, t) {
                    if (this.webGLVersion < 2 || !e || 0 == e.length)
                        return 1;
                    if (e[0].samples === t)
                        return t;
                    var r = this._gl;
                    t = Math.min(t, r.getParameter(r.MAX_SAMPLES)),
                    e[0]._depthStencilBuffer && (r.deleteRenderbuffer(e[0]._depthStencilBuffer),
                    e[0]._depthStencilBuffer = null),
                    e[0]._MSAAFramebuffer && (r.deleteFramebuffer(e[0]._MSAAFramebuffer),
                    e[0]._MSAAFramebuffer = null);
                    for (var i = 0; i < e.length; i++)
                        e[i]._MSAARenderBuffer && (r.deleteRenderbuffer(e[i]._MSAARenderBuffer),
                        e[i]._MSAARenderBuffer = null);
                    if (t > 1) {
                        var n = r.createFramebuffer();
                        if (!n)
                            throw new Error("Unable to create multi sampled framebuffer");
                        this.bindUnboundFramebuffer(n);
                        var o = this._setupFramebufferDepthAttachments(e[0]._generateStencilBuffer, e[0]._generateDepthBuffer, e[0].width, e[0].height, t)
                          , a = [];
                        for (i = 0; i < e.length; i++) {
                            var s = e[i]
                              , y = r[this.webGLVersion > 1 ? "COLOR_ATTACHMENT" + i : "COLOR_ATTACHMENT" + i + "_WEBGL"]
                              , l = r.createRenderbuffer();
                            if (!l)
                                throw new Error("Unable to create multi sampled framebuffer");
                            r.bindRenderbuffer(r.RENDERBUFFER, l),
                            r.renderbufferStorageMultisample(r.RENDERBUFFER, t, this._getRGBAMultiSampleBufferFormat(s.type), s.width, s.height),
                            r.framebufferRenderbuffer(r.FRAMEBUFFER, y, r.RENDERBUFFER, l),
                            s._MSAAFramebuffer = n,
                            s._MSAARenderBuffer = l,
                            s.samples = t,
                            s._depthStencilBuffer = o,
                            r.bindRenderbuffer(r.RENDERBUFFER, null),
                            a.push(y)
                        }
                        r.drawBuffers(a)
                    } else
                        this.bindUnboundFramebuffer(e[0]._framebuffer);
                    return this.bindUnboundFramebuffer(null),
                    t
                }
                ,
                r.prototype._uploadCompressedDataToTextureDirectly = function(e, t, r, i, n, o, a) {
                    void 0 === o && (o = 0),
                    void 0 === a && (a = 0);
                    var s = this._gl
                      , y = s.TEXTURE_2D;
                    e.isCube && (y = s.TEXTURE_CUBE_MAP_POSITIVE_X + o),
                    this._gl.compressedTexImage2D(y, a, t, r, i, 0, n)
                }
                ,
                r.prototype._uploadDataToTextureDirectly = function(t, r, i, n) {
                    void 0 === i && (i = 0),
                    void 0 === n && (n = 0);
                    var o = this._gl
                      , a = this._getWebGLTextureType(t.type)
                      , s = this._getInternalFormat(t.format)
                      , y = this._getRGBABufferInternalSizedFormat(t.type, s);
                    this._unpackFlipY(t.invertY);
                    var l = o.TEXTURE_2D;
                    t.isCube && (l = o.TEXTURE_CUBE_MAP_POSITIVE_X + i);
                    var c = Math.round(e.Scalar.Log2(t.width))
                      , h = Math.round(e.Scalar.Log2(t.height))
                      , u = Math.pow(2, Math.max(c - n, 0))
                      , d = Math.pow(2, Math.max(h - n, 0));
                    o.texImage2D(l, n, y, u, d, 0, s, a, r)
                }
                ,
                r.prototype._uploadArrayBufferViewToTexture = function(e, t, r, i) {
                    void 0 === r && (r = 0),
                    void 0 === i && (i = 0);
                    var n = this._gl
                      , o = e.isCube ? n.TEXTURE_CUBE_MAP : n.TEXTURE_2D;
                    this._bindTextureDirectly(o, e, !0),
                    this._uploadDataToTextureDirectly(e, t, r, i),
                    this._bindTextureDirectly(o, null, !0)
                }
                ,
                r.prototype._uploadImageToTexture = function(e, t, r, i) {
                    void 0 === r && (r = 0),
                    void 0 === i && (i = 0);
                    var n = this._gl
                      , o = this._getWebGLTextureType(e.type)
                      , a = this._getInternalFormat(e.format)
                      , s = this._getRGBABufferInternalSizedFormat(e.type, a)
                      , y = e.isCube ? n.TEXTURE_CUBE_MAP : n.TEXTURE_2D;
                    this._bindTextureDirectly(y, e, !0),
                    this._unpackFlipY(e.invertY);
                    var l = n.TEXTURE_2D;
                    e.isCube && (l = n.TEXTURE_CUBE_MAP_POSITIVE_X + r),
                    n.texImage2D(l, i, s, a, o, t),
                    this._bindTextureDirectly(y, null, !0)
                }
                ,
                r.prototype.createRenderTargetCubeTexture = function(t, i) {
                    var n = a({
                        generateMipMaps: !0,
                        generateDepthBuffer: !0,
                        generateStencilBuffer: !1,
                        type: r.TEXTURETYPE_UNSIGNED_INT,
                        samplingMode: r.TEXTURE_TRILINEAR_SAMPLINGMODE,
                        format: r.TEXTUREFORMAT_RGBA
                    }, i);
                    n.generateStencilBuffer = n.generateDepthBuffer && n.generateStencilBuffer,
                    (n.type !== r.TEXTURETYPE_FLOAT || this._caps.textureFloatLinearFiltering) && (n.type !== r.TEXTURETYPE_HALF_FLOAT || this._caps.textureHalfFloatLinearFiltering) || (n.samplingMode = r.TEXTURE_NEAREST_SAMPLINGMODE);
                    var o = this._gl
                      , s = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RENDERTARGET);
                    this._bindTextureDirectly(o.TEXTURE_CUBE_MAP, s, !0);
                    var y = this._getSamplingParameters(n.samplingMode, n.generateMipMaps);
                    n.type !== r.TEXTURETYPE_FLOAT || this._caps.textureFloat || (n.type = r.TEXTURETYPE_UNSIGNED_INT,
                    e.Tools.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),
                    o.texParameteri(o.TEXTURE_CUBE_MAP, o.TEXTURE_MAG_FILTER, y.mag),
                    o.texParameteri(o.TEXTURE_CUBE_MAP, o.TEXTURE_MIN_FILTER, y.min),
                    o.texParameteri(o.TEXTURE_CUBE_MAP, o.TEXTURE_WRAP_S, o.CLAMP_TO_EDGE),
                    o.texParameteri(o.TEXTURE_CUBE_MAP, o.TEXTURE_WRAP_T, o.CLAMP_TO_EDGE);
                    for (var l = 0; l < 6; l++)
                        o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X + l, 0, this._getRGBABufferInternalSizedFormat(n.type, n.format), t, t, 0, this._getInternalFormat(n.format), this._getWebGLTextureType(n.type), null);
                    var c = o.createFramebuffer();
                    return this.bindUnboundFramebuffer(c),
                    s._depthStencilBuffer = this._setupFramebufferDepthAttachments(n.generateStencilBuffer, n.generateDepthBuffer, t, t),
                    n.generateMipMaps && o.generateMipmap(o.TEXTURE_CUBE_MAP),
                    this._bindTextureDirectly(o.TEXTURE_CUBE_MAP, null),
                    o.bindRenderbuffer(o.RENDERBUFFER, null),
                    this.bindUnboundFramebuffer(null),
                    s._framebuffer = c,
                    s.width = t,
                    s.height = t,
                    s.isReady = !0,
                    s.isCube = !0,
                    s.samples = 1,
                    s.generateMipMaps = n.generateMipMaps,
                    s.samplingMode = n.samplingMode,
                    s.type = n.type,
                    s.format = n.format,
                    s._generateDepthBuffer = n.generateDepthBuffer,
                    s._generateStencilBuffer = n.generateStencilBuffer,
                    this._internalTexturesCache.push(s),
                    s
                }
                ,
                r.prototype.createPrefilteredCubeTexture = function(t, r, i, n, o, a, s, y, l) {
                    var c = this;
                    void 0 === o && (o = null),
                    void 0 === a && (a = null),
                    void 0 === y && (y = null),
                    void 0 === l && (l = !0);
                    return this.createCubeTexture(t, r, null, !1, (function(t) {
                        if (t) {
                            var a = t.texture;
                            if (l ? t.info.sphericalPolynomial && (a._sphericalPolynomial = t.info.sphericalPolynomial) : a._sphericalPolynomial = new e.SphericalPolynomial,
                            a._dataSource = e.InternalTexture.DATASOURCE_CUBEPREFILTERED,
                            c._caps.textureLOD)
                                o && o(a);
                            else {
                                var s = c._gl
                                  , y = t.width;
                                if (y) {
                                    for (var h = [], u = 0; u < 3; u++) {
                                        var d = 1 - u / 2
                                          , x = n
                                          , p = e.Scalar.Log2(y) * i + n
                                          , f = x + (p - x) * d
                                          , m = Math.round(Math.min(Math.max(f, 0), p))
                                          , z = new e.InternalTexture(c,e.InternalTexture.DATASOURCE_TEMP);
                                        if (z.type = a.type,
                                        z.format = a.format,
                                        z.width = Math.pow(2, Math.max(e.Scalar.Log2(y) - m, 0)),
                                        z.height = z.width,
                                        z.isCube = !0,
                                        c._bindTextureDirectly(s.TEXTURE_CUBE_MAP, z, !0),
                                        s.texParameteri(s.TEXTURE_CUBE_MAP, s.TEXTURE_MAG_FILTER, s.LINEAR),
                                        s.texParameteri(s.TEXTURE_CUBE_MAP, s.TEXTURE_MIN_FILTER, s.LINEAR),
                                        s.texParameteri(s.TEXTURE_CUBE_MAP, s.TEXTURE_WRAP_S, s.CLAMP_TO_EDGE),
                                        s.texParameteri(s.TEXTURE_CUBE_MAP, s.TEXTURE_WRAP_T, s.CLAMP_TO_EDGE),
                                        t.isDDS) {
                                            var _ = t.info
                                              , g = t.data;
                                            c._unpackFlipY(_.isCompressed),
                                            e.DDSTools.UploadDDSLevels(c, z, g, _, !0, 6, m)
                                        } else
                                            e.Tools.Warn("DDS is the only prefiltered cube map supported so far.");
                                        c._bindTextureDirectly(s.TEXTURE_CUBE_MAP, null);
                                        var v = new e.BaseTexture(r);
                                        v.isCube = !0,
                                        v._texture = z,
                                        z.isReady = !0,
                                        h.push(v)
                                    }
                                    a._lodTextureHigh = h[2],
                                    a._lodTextureMid = h[1],
                                    a._lodTextureLow = h[0],
                                    o && o(a)
                                }
                            }
                        } else
                            o && o(null)
                    }
                    ), a, s, y, l, i, n)
                }
                ,
                r.prototype.createCubeTexture = function(t, i, n, o, a, s, y, l, c, h, u, d) {
                    var x = this;
                    void 0 === a && (a = null),
                    void 0 === s && (s = null),
                    void 0 === l && (l = null),
                    void 0 === c && (c = !1),
                    void 0 === h && (h = 0),
                    void 0 === u && (u = 0),
                    void 0 === d && (d = null);
                    var p = this._gl
                      , f = d || new e.InternalTexture(this,e.InternalTexture.DATASOURCE_CUBE);
                    f.isCube = !0,
                    f.url = t,
                    f.generateMipMaps = !o,
                    f._lodGenerationScale = h,
                    f._lodGenerationOffset = u,
                    this._doNotHandleContextLost || (f._extension = l,
                    f._files = n);
                    for (var m = t.lastIndexOf("."), z = l || (m > -1 ? t.substring(m).toLowerCase() : ""), _ = null, g = 0, v = r._TextureLoaders; g < v.length; g++) {
                        var b = v[g];
                        if (b.canLoad(z, this._textureFormatInUse, d, !1, !1)) {
                            _ = b;
                            break
                        }
                    }
                    if (_) {
                        t = _.transformUrl(t, this._textureFormatInUse);
                        var T = function(e) {
                            x._bindTextureDirectly(p.TEXTURE_CUBE_MAP, f, !0),
                            _.loadCubeData(e, f, c, a, s)
                        };
                        n && 6 === n.length ? _.supportCascades ? this._cascadeLoadFiles(i, T, n, s) : s && s("Textures type does not support cascades.") : this._loadFile(t, T, void 0, void 0, !0, (function(e, r) {
                            if (_) {
                                var l = _.getFallbackTextureUrl(t, x._textureFormatInUse);
                                l && x.createCubeTexture(l, i, n, o, a, s, y, z, c, h, u, f)
                            }
                            s && e && s(e.status + " " + e.statusText, r)
                        }
                        ))
                    } else {
                        if (!n)
                            throw new Error("Cannot load cubemap because files were not defined");
                        this._cascadeLoadImgs(t, i, (function(t) {
                            var r = x.needPOTTextures ? e.Tools.GetExponentOfTwo(t[0].width, x._caps.maxCubemapTextureSize) : t[0].width
                              , i = r;
                            if (x._prepareWorkingCanvas(),
                            x._workingCanvas && x._workingContext) {
                                x._workingCanvas.width = r,
                                x._workingCanvas.height = i;
                                var n = [p.TEXTURE_CUBE_MAP_POSITIVE_X, p.TEXTURE_CUBE_MAP_POSITIVE_Y, p.TEXTURE_CUBE_MAP_POSITIVE_Z, p.TEXTURE_CUBE_MAP_NEGATIVE_X, p.TEXTURE_CUBE_MAP_NEGATIVE_Y, p.TEXTURE_CUBE_MAP_NEGATIVE_Z];
                                x._bindTextureDirectly(p.TEXTURE_CUBE_MAP, f, !0),
                                x._unpackFlipY(!1);
                                for (var s = y ? x._getInternalFormat(y) : x._gl.RGBA, l = 0; l < n.length; l++)
                                    x._workingContext.drawImage(t[l], 0, 0, t[l].width, t[l].height, 0, 0, r, i),
                                    p.texImage2D(n[l], 0, s, s, p.UNSIGNED_BYTE, x._workingCanvas);
                                o || p.generateMipmap(p.TEXTURE_CUBE_MAP),
                                x._setCubeMapTextureParams(!o),
                                f.width = r,
                                f.height = i,
                                f.isReady = !0,
                                y && (f.format = y),
                                f.onLoadedObservable.notifyObservers(f),
                                f.onLoadedObservable.clear(),
                                a && a()
                            }
                        }
                        ), n, s)
                    }
                    return this._internalTexturesCache.push(f),
                    f
                }
                ,
                r.prototype._setCubeMapTextureParams = function(e) {
                    var t = this._gl;
                    t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_MAG_FILTER, t.LINEAR),
                    t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_MIN_FILTER, e ? t.LINEAR_MIPMAP_LINEAR : t.LINEAR),
                    t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_WRAP_S, t.CLAMP_TO_EDGE),
                    t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_WRAP_T, t.CLAMP_TO_EDGE),
                    this._bindTextureDirectly(t.TEXTURE_CUBE_MAP, null)
                }
                ,
                r.prototype.updateRawCubeTexture = function(t, r, i, n, o, a, s) {
                    void 0 === a && (a = null),
                    void 0 === s && (s = 0),
                    t._bufferViewArray = r,
                    t.format = i,
                    t.type = n,
                    t.invertY = o,
                    t._compression = a;
                    var y = this._gl
                      , l = this._getWebGLTextureType(n)
                      , c = this._getInternalFormat(i)
                      , h = this._getRGBABufferInternalSizedFormat(n)
                      , u = !1;
                    c === y.RGB && (c = y.RGBA,
                    u = !0),
                    this._bindTextureDirectly(y.TEXTURE_CUBE_MAP, t, !0),
                    this._unpackFlipY(void 0 === o || !!o),
                    t.width % 4 != 0 && y.pixelStorei(y.UNPACK_ALIGNMENT, 1);
                    for (var d = 0; d < 6; d++) {
                        var x = r[d];
                        a ? y.compressedTexImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X + d, s, this.getCaps().s3tc[a], t.width, t.height, 0, x) : (u && (x = this._convertRGBtoRGBATextureData(x, t.width, t.height, n)),
                        y.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X + d, s, h, t.width, t.height, 0, c, l, x))
                    }
                    (!this.needPOTTextures || e.Tools.IsExponentOfTwo(t.width) && e.Tools.IsExponentOfTwo(t.height)) && t.generateMipMaps && 0 === s && this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),
                    this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null),
                    t.isReady = !0
                }
                ,
                r.prototype.createRawCubeTexture = function(t, i, n, o, a, s, y, l) {
                    void 0 === l && (l = null);
                    var c = this._gl
                      , h = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_CUBERAW);
                    h.isCube = !0,
                    h.format = n,
                    h.type = o,
                    this._doNotHandleContextLost || (h._bufferViewArray = t);
                    var u = this._getWebGLTextureType(o)
                      , d = this._getInternalFormat(n);
                    d === c.RGB && (d = c.RGBA),
                    u !== c.FLOAT || this._caps.textureFloatLinearFiltering ? u !== this._gl.HALF_FLOAT_OES || this._caps.textureHalfFloatLinearFiltering ? u !== c.FLOAT || this._caps.textureFloatRender ? u !== c.HALF_FLOAT || this._caps.colorBufferFloat || (a = !1,
                    e.Tools.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")) : (a = !1,
                    e.Tools.Warn("Render to float textures is not supported. Mipmap generation forced to false.")) : (a = !1,
                    y = r.TEXTURE_NEAREST_SAMPLINGMODE,
                    e.Tools.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")) : (a = !1,
                    y = r.TEXTURE_NEAREST_SAMPLINGMODE,
                    e.Tools.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));
                    var x = i
                      , p = x;
                    h.width = x,
                    h.height = p,
                    !this.needPOTTextures || e.Tools.IsExponentOfTwo(h.width) && e.Tools.IsExponentOfTwo(h.height) || (a = !1),
                    t && this.updateRawCubeTexture(h, t, n, o, s, l),
                    this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, h, !0),
                    t && a && this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);
                    var f = this._getSamplingParameters(y, a);
                    return c.texParameteri(c.TEXTURE_CUBE_MAP, c.TEXTURE_MAG_FILTER, f.mag),
                    c.texParameteri(c.TEXTURE_CUBE_MAP, c.TEXTURE_MIN_FILTER, f.min),
                    c.texParameteri(c.TEXTURE_CUBE_MAP, c.TEXTURE_WRAP_S, c.CLAMP_TO_EDGE),
                    c.texParameteri(c.TEXTURE_CUBE_MAP, c.TEXTURE_WRAP_T, c.CLAMP_TO_EDGE),
                    this._bindTextureDirectly(c.TEXTURE_CUBE_MAP, null),
                    h.generateMipMaps = a,
                    h
                }
                ,
                r.prototype.createRawCubeTextureFromUrl = function(e, t, i, n, o, a, s, y, l, c, h, u) {
                    var d = this;
                    void 0 === l && (l = null),
                    void 0 === c && (c = null),
                    void 0 === h && (h = r.TEXTURE_TRILINEAR_SAMPLINGMODE),
                    void 0 === u && (u = !1);
                    var x = this._gl
                      , p = this.createRawCubeTexture(null, i, n, o, !a, u, h);
                    t._addPendingData(p),
                    p.url = e,
                    this._internalTexturesCache.push(p);
                    return this._loadFile(e, (function(e) {
                        !function(e) {
                            var r = p.width
                              , i = s(e);
                            if (i) {
                                if (y) {
                                    var a = d._getWebGLTextureType(o)
                                      , c = d._getInternalFormat(n)
                                      , h = d._getRGBABufferInternalSizedFormat(o)
                                      , f = !1;
                                    c === x.RGB && (c = x.RGBA,
                                    f = !0),
                                    d._bindTextureDirectly(x.TEXTURE_CUBE_MAP, p, !0),
                                    d._unpackFlipY(!1);
                                    for (var m = y(i), z = 0; z < m.length; z++)
                                        for (var _ = r >> z, g = 0; g < 6; g++) {
                                            var v = m[z][g];
                                            f && (v = d._convertRGBtoRGBATextureData(v, _, _, o)),
                                            x.texImage2D(g, z, h, _, _, 0, c, a, v)
                                        }
                                    d._bindTextureDirectly(x.TEXTURE_CUBE_MAP, null)
                                } else
                                    d.updateRawCubeTexture(p, i, n, o, u);
                                p.isReady = !0,
                                t._removePendingData(p),
                                l && l()
                            }
                        }(e)
                    }
                    ), void 0, t.database, !0, (function(e, r) {
                        t._removePendingData(p),
                        c && e && c(e.status + " " + e.statusText, r)
                    }
                    )),
                    p
                }
                ,
                r.prototype.updateRawTexture3D = function(e, t, i, n, o, a) {
                    void 0 === o && (o = null),
                    void 0 === a && (a = r.TEXTURETYPE_UNSIGNED_INT);
                    var s = this._getWebGLTextureType(a)
                      , y = this._getInternalFormat(i)
                      , l = this._getRGBABufferInternalSizedFormat(a, i);
                    this._bindTextureDirectly(this._gl.TEXTURE_3D, e, !0),
                    this._unpackFlipY(void 0 === n || !!n),
                    this._doNotHandleContextLost || (e._bufferView = t,
                    e.format = i,
                    e.invertY = n,
                    e._compression = o),
                    e.width % 4 != 0 && this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT, 1),
                    o && t ? this._gl.compressedTexImage3D(this._gl.TEXTURE_3D, 0, this.getCaps().s3tc[o], e.width, e.height, e.depth, 0, t) : this._gl.texImage3D(this._gl.TEXTURE_3D, 0, l, e.width, e.height, e.depth, 0, y, s, t),
                    e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_3D),
                    this._bindTextureDirectly(this._gl.TEXTURE_3D, null),
                    e.isReady = !0
                }
                ,
                r.prototype.createRawTexture3D = function(t, i, n, o, a, s, y, l, c, h) {
                    void 0 === c && (c = null),
                    void 0 === h && (h = r.TEXTURETYPE_UNSIGNED_INT);
                    var u = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RAW3D);
                    u.baseWidth = i,
                    u.baseHeight = n,
                    u.baseDepth = o,
                    u.width = i,
                    u.height = n,
                    u.depth = o,
                    u.format = a,
                    u.type = h,
                    u.generateMipMaps = s,
                    u.samplingMode = l,
                    u.is3D = !0,
                    this._doNotHandleContextLost || (u._bufferView = t),
                    this.updateRawTexture3D(u, t, a, y, c, h),
                    this._bindTextureDirectly(this._gl.TEXTURE_3D, u, !0);
                    var d = this._getSamplingParameters(l, s);
                    return this._gl.texParameteri(this._gl.TEXTURE_3D, this._gl.TEXTURE_MAG_FILTER, d.mag),
                    this._gl.texParameteri(this._gl.TEXTURE_3D, this._gl.TEXTURE_MIN_FILTER, d.min),
                    s && this._gl.generateMipmap(this._gl.TEXTURE_3D),
                    this._bindTextureDirectly(this._gl.TEXTURE_3D, null),
                    this._internalTexturesCache.push(u),
                    u
                }
                ,
                r.prototype._prepareWebGLTextureContinuation = function(e, t, r, i, n) {
                    var o = this._gl;
                    if (o) {
                        var a = this._getSamplingParameters(n, !r);
                        o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, a.mag),
                        o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, a.min),
                        r || i || o.generateMipmap(o.TEXTURE_2D),
                        this._bindTextureDirectly(o.TEXTURE_2D, null),
                        t && t._removePendingData(e),
                        e.onLoadedObservable.notifyObservers(e),
                        e.onLoadedObservable.clear()
                    }
                }
                ,
                r.prototype._prepareWebGLTexture = function(t, i, n, o, a, s, y, l, c) {
                    var h = this;
                    void 0 === c && (c = r.TEXTURE_TRILINEAR_SAMPLINGMODE);
                    var u = this.getCaps().maxTextureSize
                      , d = Math.min(u, this.needPOTTextures ? e.Tools.GetExponentOfTwo(n, u) : n)
                      , x = Math.min(u, this.needPOTTextures ? e.Tools.GetExponentOfTwo(o, u) : o)
                      , p = this._gl;
                    p && (t._webGLTexture ? (this._bindTextureDirectly(p.TEXTURE_2D, t, !0),
                    this._unpackFlipY(void 0 === a || !!a),
                    t.baseWidth = n,
                    t.baseHeight = o,
                    t.width = d,
                    t.height = x,
                    t.isReady = !0,
                    l(d, x, (function() {
                        h._prepareWebGLTextureContinuation(t, i, s, y, c)
                    }
                    )) || this._prepareWebGLTextureContinuation(t, i, s, y, c)) : i && i._removePendingData(t))
                }
                ,
                r.prototype._convertRGBtoRGBATextureData = function(e, t, i, n) {
                    var o;
                    o = n === r.TEXTURETYPE_FLOAT ? new Float32Array(t * i * 4) : new Uint32Array(t * i * 4);
                    for (var a = 0; a < t; a++)
                        for (var s = 0; s < i; s++) {
                            var y = 3 * (s * t + a)
                              , l = 4 * (s * t + a);
                            o[l + 0] = e[y + 0],
                            o[l + 1] = e[y + 1],
                            o[l + 2] = e[y + 2],
                            o[l + 3] = 1
                        }
                    return o
                }
                ,
                r.prototype._releaseFramebufferObjects = function(e) {
                    var t = this._gl;
                    e._framebuffer && (t.deleteFramebuffer(e._framebuffer),
                    e._framebuffer = null),
                    e._depthStencilBuffer && (t.deleteRenderbuffer(e._depthStencilBuffer),
                    e._depthStencilBuffer = null),
                    e._MSAAFramebuffer && (t.deleteFramebuffer(e._MSAAFramebuffer),
                    e._MSAAFramebuffer = null),
                    e._MSAARenderBuffer && (t.deleteRenderbuffer(e._MSAARenderBuffer),
                    e._MSAARenderBuffer = null)
                }
                ,
                r.prototype._releaseTexture = function(e) {
                    var t = this._gl;
                    this._releaseFramebufferObjects(e),
                    t.deleteTexture(e._webGLTexture),
                    this.unbindAllTextures();
                    var r = this._internalTexturesCache.indexOf(e);
                    -1 !== r && this._internalTexturesCache.splice(r, 1),
                    e._lodTextureHigh && e._lodTextureHigh.dispose(),
                    e._lodTextureMid && e._lodTextureMid.dispose(),
                    e._lodTextureLow && e._lodTextureLow.dispose(),
                    this.scenes.forEach((function(t) {
                        t.postProcesses.forEach((function(t) {
                            t._outputTexture == e && (t._outputTexture = null)
                        }
                        )),
                        t.cameras.forEach((function(t) {
                            t._postProcesses.forEach((function(t) {
                                t && t._outputTexture == e && (t._outputTexture = null)
                            }
                            ))
                        }
                        ))
                    }
                    ))
                }
                ,
                r.prototype.setProgram = function(e) {
                    this._currentProgram !== e && (this._gl.useProgram(e),
                    this._currentProgram = e)
                }
                ,
                r.prototype.bindSamplers = function(e) {
                    this.setProgram(e.getProgram());
                    for (var t = e.getSamplers(), r = 0; r < t.length; r++) {
                        var i = e.getUniform(t[r]);
                        i && (this._boundUniforms[r] = i)
                    }
                    this._currentEffect = null
                }
                ,
                r.prototype._moveBoundTextureOnTop = function(e) {
                    this.disableTextureBindingOptimization || this._lastBoundInternalTextureTracker.previous === e || (this._linkTrackers(e.previous, e.next),
                    this._linkTrackers(this._lastBoundInternalTextureTracker.previous, e),
                    this._linkTrackers(e, this._lastBoundInternalTextureTracker))
                }
                ,
                r.prototype._getCorrectTextureChannel = function(e, t) {
                    if (!t)
                        return -1;
                    if (t._initialSlot = e,
                    this.disableTextureBindingOptimization)
                        e !== t._designatedSlot && this._textureCollisions.addCount(1, !1);
                    else if (e !== t._designatedSlot)
                        return t._designatedSlot > -1 ? t._designatedSlot : this._nextFreeTextureSlots.length ? this._nextFreeTextureSlots[0] : (this._textureCollisions.addCount(1, !1),
                        this._removeDesignatedSlot(this._firstBoundInternalTextureTracker.next));
                    return e
                }
                ,
                r.prototype._linkTrackers = function(e, t) {
                    e.next = t,
                    t.previous = e
                }
                ,
                r.prototype._removeDesignatedSlot = function(e) {
                    var t = e._designatedSlot;
                    return -1 === t ? -1 : (e._designatedSlot = -1,
                    this.disableTextureBindingOptimization ? -1 : (this._linkTrackers(e.previous, e.next),
                    this._boundTexturesCache[t] = null,
                    this._nextFreeTextureSlots.push(t),
                    t))
                }
                ,
                r.prototype._activateCurrentTexture = function() {
                    this._currentTextureChannel !== this._activeChannel && (this._gl.activeTexture(this._gl.TEXTURE0 + this._activeChannel),
                    this._currentTextureChannel = this._activeChannel)
                }
                ,
                r.prototype._bindTextureDirectly = function(e, t, r, i) {
                    void 0 === r && (r = !1),
                    void 0 === i && (i = !1);
                    var n = !1;
                    r && t && t._designatedSlot > -1 && (this._activeChannel = t._designatedSlot);
                    var o = this._boundTexturesCache[this._activeChannel]
                      , a = t && t._initialSlot > -1;
                    if (o !== t || i) {
                        if (o && this._removeDesignatedSlot(o),
                        this._activateCurrentTexture(),
                        this._gl.bindTexture(e, t ? t._webGLTexture : null),
                        this._boundTexturesCache[this._activeChannel] = t,
                        t) {
                            if (!this.disableTextureBindingOptimization) {
                                var s = this._nextFreeTextureSlots.indexOf(this._activeChannel);
                                s > -1 && this._nextFreeTextureSlots.splice(s, 1),
                                this._linkTrackers(this._lastBoundInternalTextureTracker.previous, t),
                                this._linkTrackers(t, this._lastBoundInternalTextureTracker)
                            }
                            t._designatedSlot = this._activeChannel
                        }
                    } else
                        r && (n = !0,
                        this._activateCurrentTexture());
                    return a && !r && this._bindSamplerUniformToChannel(t._initialSlot, this._activeChannel),
                    n
                }
                ,
                r.prototype._bindTexture = function(e, t) {
                    e < 0 || (t && (e = this._getCorrectTextureChannel(e, t)),
                    this._activeChannel = e,
                    this._bindTextureDirectly(this._gl.TEXTURE_2D, t))
                }
                ,
                r.prototype.setTextureFromPostProcess = function(e, t) {
                    this._bindTexture(e, t ? t._textures.data[t._currentRenderTextureInd] : null)
                }
                ,
                r.prototype.setTextureFromPostProcessOutput = function(e, t) {
                    this._bindTexture(e, t ? t._outputTexture : null)
                }
                ,
                r.prototype.unbindAllTextures = function() {
                    for (var e = 0; e < this._maxSimultaneousTextures; e++)
                        this._activeChannel = e,
                        this._bindTextureDirectly(this._gl.TEXTURE_2D, null),
                        this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null),
                        this.webGLVersion > 1 && this._bindTextureDirectly(this._gl.TEXTURE_3D, null)
                }
                ,
                r.prototype.setTexture = function(e, t, r) {
                    e < 0 || (t && (this._boundUniforms[e] = t),
                    this._setTexture(e, r))
                }
                ,
                r.prototype.setDepthStencilTexture = function(e, t, r) {
                    e < 0 || (t && (this._boundUniforms[e] = t),
                    r && r.depthStencilTexture ? this._setTexture(e, r, !1, !0) : this._setTexture(e, null))
                }
                ,
                r.prototype._bindSamplerUniformToChannel = function(e, t) {
                    var r = this._boundUniforms[e];
                    r._currentState !== t && (this._gl.uniform1i(r, t),
                    r._currentState = t)
                }
                ,
                r.prototype._getTextureWrapMode = function(e) {
                    switch (e) {
                    case r.TEXTURE_WRAP_ADDRESSMODE:
                        return this._gl.REPEAT;
                    case r.TEXTURE_CLAMP_ADDRESSMODE:
                        return this._gl.CLAMP_TO_EDGE;
                    case r.TEXTURE_MIRROR_ADDRESSMODE:
                        return this._gl.MIRRORED_REPEAT
                    }
                    return this._gl.REPEAT
                }
                ,
                r.prototype._setTexture = function(e, t, i, n) {
                    if (void 0 === i && (i = !1),
                    void 0 === n && (n = !1),
                    !t)
                        return null != this._boundTexturesCache[e] && (this._activeChannel = e,
                        this._bindTextureDirectly(this._gl.TEXTURE_2D, null),
                        this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null),
                        this.webGLVersion > 1 && this._bindTextureDirectly(this._gl.TEXTURE_3D, null)),
                        !1;
                    if (t.video)
                        this._activeChannel = e,
                        t.update();
                    else if (t.delayLoadState === r.DELAYLOADSTATE_NOTLOADED)
                        return t.delayLoad(),
                        !1;
                    var o;
                    o = n ? t.depthStencilTexture : t.isReady() ? t.getInternalTexture() : t.isCube ? this.emptyCubeTexture : t.is3D ? this.emptyTexture3D : this.emptyTexture,
                    i || (e = this._getCorrectTextureChannel(e, o));
                    var a = !0;
                    if (this._boundTexturesCache[e] === o && (this._moveBoundTextureOnTop(o),
                    i || this._bindSamplerUniformToChannel(o._initialSlot, e),
                    a = !1),
                    this._activeChannel = e,
                    o && o.is3D)
                        a && this._bindTextureDirectly(this._gl.TEXTURE_3D, o, i),
                        o && o._cachedWrapU !== t.wrapU && (o._cachedWrapU = t.wrapU,
                        this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(t.wrapU), o)),
                        o && o._cachedWrapV !== t.wrapV && (o._cachedWrapV = t.wrapV,
                        this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(t.wrapV), o)),
                        o && o._cachedWrapR !== t.wrapR && (o._cachedWrapR = t.wrapR,
                        this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_R, this._getTextureWrapMode(t.wrapR), o)),
                        this._setAnisotropicLevel(this._gl.TEXTURE_3D, t);
                    else if (o && o.isCube) {
                        if (a && this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, o, i),
                        o._cachedCoordinatesMode !== t.coordinatesMode) {
                            o._cachedCoordinatesMode = t.coordinatesMode;
                            var s = t.coordinatesMode !== r.TEXTURE_CUBIC_MODE && t.coordinatesMode !== r.TEXTURE_SKYBOX_MODE ? this._gl.REPEAT : this._gl.CLAMP_TO_EDGE;
                            this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_WRAP_S, s, o),
                            this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_WRAP_T, s)
                        }
                        this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP, t)
                    } else
                        a && this._bindTextureDirectly(this._gl.TEXTURE_2D, o, i),
                        o && o._cachedWrapU !== t.wrapU && (o._cachedWrapU = t.wrapU,
                        this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(t.wrapU), o)),
                        o && o._cachedWrapV !== t.wrapV && (o._cachedWrapV = t.wrapV,
                        this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(t.wrapV), o)),
                        this._setAnisotropicLevel(this._gl.TEXTURE_2D, t);
                    return !0
                }
                ,
                r.prototype.setTextureArray = function(e, t, r) {
                    if (!(e < 0) && t) {
                        this._textureUnits && this._textureUnits.length === r.length || (this._textureUnits = new Int32Array(r.length));
                        for (var i = 0; i < r.length; i++)
                            this._textureUnits[i] = this._getCorrectTextureChannel(e + i, r[i].getInternalTexture());
                        this._gl.uniform1iv(t, this._textureUnits);
                        for (var n = 0; n < r.length; n++)
                            this._setTexture(this._textureUnits[n], r[n], !0)
                    }
                }
                ,
                r.prototype._setAnisotropicLevel = function(e, t) {
                    var i = t.getInternalTexture();
                    if (i) {
                        var n = this._caps.textureAnisotropicFilterExtension
                          , o = t.anisotropicFilteringLevel;
                        i.samplingMode !== r.TEXTURE_LINEAR_LINEAR_MIPNEAREST && i.samplingMode !== r.TEXTURE_LINEAR_LINEAR_MIPLINEAR && i.samplingMode !== r.TEXTURE_LINEAR_LINEAR && (o = 1),
                        n && i._cachedAnisotropicFilteringLevel !== o && (this._setTextureParameterFloat(e, n.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(o, this._caps.maxAnisotropy), i),
                        i._cachedAnisotropicFilteringLevel = o)
                    }
                }
                ,
                r.prototype._setTextureParameterFloat = function(e, t, r, i) {
                    this._bindTextureDirectly(e, i, !0, !0),
                    this._gl.texParameterf(e, t, r)
                }
                ,
                r.prototype._setTextureParameterInteger = function(e, t, r, i) {
                    i && this._bindTextureDirectly(e, i, !0, !0),
                    this._gl.texParameteri(e, t, r)
                }
                ,
                r.prototype.readPixels = function(e, t, r, i) {
                    var n = new Uint8Array(i * r * 4);
                    return this._gl.readPixels(e, t, r, i, this._gl.RGBA, this._gl.UNSIGNED_BYTE, n),
                    n
                }
                ,
                r.prototype.addExternalData = function(t, r) {
                    return this._externalData || (this._externalData = new e.StringDictionary),
                    this._externalData.add(t, r)
                }
                ,
                r.prototype.getExternalData = function(t) {
                    return this._externalData || (this._externalData = new e.StringDictionary),
                    this._externalData.get(t)
                }
                ,
                r.prototype.getOrAddExternalDataWithFactory = function(t, r) {
                    return this._externalData || (this._externalData = new e.StringDictionary),
                    this._externalData.getOrAddWithFactory(t, r)
                }
                ,
                r.prototype.removeExternalData = function(t) {
                    return this._externalData || (this._externalData = new e.StringDictionary),
                    this._externalData.remove(t)
                }
                ,
                r.prototype.unbindAllAttributes = function() {
                    if (this._mustWipeVertexAttributes) {
                        this._mustWipeVertexAttributes = !1;
                        for (var e = 0; e < this._caps.maxVertexAttribs; e++)
                            this._gl.disableVertexAttribArray(e),
                            this._vertexAttribArraysEnabled[e] = !1,
                            this._currentBufferPointers[e].active = !1
                    } else {
                        e = 0;
                        for (var t = this._vertexAttribArraysEnabled.length; e < t; e++)
                            e >= this._caps.maxVertexAttribs || !this._vertexAttribArraysEnabled[e] || (this._gl.disableVertexAttribArray(e),
                            this._vertexAttribArraysEnabled[e] = !1,
                            this._currentBufferPointers[e].active = !1)
                    }
                }
                ,
                r.prototype.releaseEffects = function() {
                    for (var e in this._compiledEffects)
                        this._deleteProgram(this._compiledEffects[e]._program);
                    this._compiledEffects = {}
                }
                ,
                r.prototype.dispose = function() {
                    for (this.hideLoadingUI(),
                    this.stopRenderLoop(); this.postProcesses.length; )
                        this.postProcesses[0].dispose();
                    for (this._emptyTexture && (this._releaseTexture(this._emptyTexture),
                    this._emptyTexture = null),
                    this._emptyCubeTexture && (this._releaseTexture(this._emptyCubeTexture),
                    this._emptyCubeTexture = null),
                    this._rescalePostProcess && this._rescalePostProcess.dispose(); this.scenes.length; )
                        this.scenes[0].dispose();
                    1 === r.Instances.length && r.audioEngine && r.audioEngine.dispose(),
                    this.releaseEffects(),
                    this.unbindAllAttributes(),
                    this._boundUniforms = [],
                    this._dummyFramebuffer && this._gl.deleteFramebuffer(this._dummyFramebuffer),
                    this.disableVR(),
                    e.Tools.IsWindowObjectExist() && (window.removeEventListener("blur", this._onBlur),
                    window.removeEventListener("focus", this._onFocus),
                    window.removeEventListener("vrdisplaypointerrestricted", this._onVRDisplayPointerRestricted),
                    window.removeEventListener("vrdisplaypointerunrestricted", this._onVRDisplayPointerUnrestricted),
                    this._renderingCanvas && (this._renderingCanvas.removeEventListener("focus", this._onCanvasFocus),
                    this._renderingCanvas.removeEventListener("blur", this._onCanvasBlur),
                    this._renderingCanvas.removeEventListener("pointerout", this._onCanvasPointerOut),
                    this._doNotHandleContextLost || (this._renderingCanvas.removeEventListener("webglcontextlost", this._onContextLost),
                    this._renderingCanvas.removeEventListener("webglcontextrestored", this._onContextRestored))),
                    document.removeEventListener("fullscreenchange", this._onFullscreenChange),
                    document.removeEventListener("mozfullscreenchange", this._onFullscreenChange),
                    document.removeEventListener("webkitfullscreenchange", this._onFullscreenChange),
                    document.removeEventListener("msfullscreenchange", this._onFullscreenChange),
                    document.removeEventListener("pointerlockchange", this._onPointerLockChange),
                    document.removeEventListener("mspointerlockchange", this._onPointerLockChange),
                    document.removeEventListener("mozpointerlockchange", this._onPointerLockChange),
                    document.removeEventListener("webkitpointerlockchange", this._onPointerLockChange),
                    this._onVrDisplayConnect && (window.removeEventListener("vrdisplayconnect", this._onVrDisplayConnect),
                    this._onVrDisplayDisconnect && window.removeEventListener("vrdisplaydisconnect", this._onVrDisplayDisconnect),
                    this._onVrDisplayPresentChange && window.removeEventListener("vrdisplaypresentchange", this._onVrDisplayPresentChange),
                    this._onVrDisplayConnect = null,
                    this._onVrDisplayDisconnect = null));
                    var t = r.Instances.indexOf(this);
                    t >= 0 && r.Instances.splice(t, 1),
                    this._workingCanvas = null,
                    this._workingContext = null,
                    this._currentBufferPointers = [],
                    this._renderingCanvas = null,
                    this._currentProgram = null,
                    this._bindedRenderFunction = null,
                    this.onResizeObservable.clear(),
                    this.onCanvasBlurObservable.clear(),
                    this.onCanvasFocusObservable.clear(),
                    this.onCanvasPointerOutObservable.clear(),
                    this.onBeginFrameObservable.clear(),
                    this.onEndFrameObservable.clear(),
                    e.Effect.ResetCache();
                    for (var i = 0, n = this._activeRequests; i < n.length; i++) {
                        n[i].abort()
                    }
                }
                ,
                r.prototype.displayLoadingUI = function() {
                    if (e.Tools.IsWindowObjectExist()) {
                        var t = this.loadingScreen;
                        t && t.displayLoadingUI()
                    }
                }
                ,
                r.prototype.hideLoadingUI = function() {
                    if (e.Tools.IsWindowObjectExist()) {
                        var t = this.loadingScreen;
                        t && t.hideLoadingUI()
                    }
                }
                ,
                Object.defineProperty(r.prototype, "loadingScreen", {
                    get: function() {
                        return !this._loadingScreen && e.DefaultLoadingScreen && this._renderingCanvas && (this._loadingScreen = new e.DefaultLoadingScreen(this._renderingCanvas)),
                        this._loadingScreen
                    },
                    set: function(e) {
                        this._loadingScreen = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "loadingUIText", {
                    set: function(e) {
                        this.loadingScreen.loadingUIText = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "loadingUIBackgroundColor", {
                    set: function(e) {
                        this.loadingScreen.loadingUIBackgroundColor = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.attachContextLostEvent = function(e) {
                    this._renderingCanvas && this._renderingCanvas.addEventListener("webglcontextlost", e, !1)
                }
                ,
                r.prototype.attachContextRestoredEvent = function(e) {
                    this._renderingCanvas && this._renderingCanvas.addEventListener("webglcontextrestored", e, !1)
                }
                ,
                r.prototype.getVertexShaderSource = function(e) {
                    var t = this._gl.getAttachedShaders(e);
                    return t ? this._gl.getShaderSource(t[0]) : null
                }
                ,
                r.prototype.getFragmentShaderSource = function(e) {
                    var t = this._gl.getAttachedShaders(e);
                    return t ? this._gl.getShaderSource(t[1]) : null
                }
                ,
                r.prototype.getError = function() {
                    return this._gl.getError()
                }
                ,
                r.prototype.getFps = function() {
                    return this._fps
                }
                ,
                r.prototype.getDeltaTime = function() {
                    return this._deltaTime
                }
                ,
                r.prototype._measureFps = function() {
                    this._performanceMonitor.sampleFrame(),
                    this._fps = this._performanceMonitor.averageFPS,
                    this._deltaTime = this._performanceMonitor.instantaneousFrameTime || 0
                }
                ,
                r.prototype._readTexturePixels = function(e, t, r, i, n, o) {
                    void 0 === i && (i = -1),
                    void 0 === n && (n = 0),
                    void 0 === o && (o = null);
                    var a = this._gl;
                    if (!this._dummyFramebuffer) {
                        var s = a.createFramebuffer();
                        if (!s)
                            throw new Error("Unable to create dummy framebuffer");
                        this._dummyFramebuffer = s
                    }
                    a.bindFramebuffer(a.FRAMEBUFFER, this._dummyFramebuffer),
                    i > -1 ? a.framebufferTexture2D(a.FRAMEBUFFER, a.COLOR_ATTACHMENT0, a.TEXTURE_CUBE_MAP_POSITIVE_X + i, e._webGLTexture, n) : a.framebufferTexture2D(a.FRAMEBUFFER, a.COLOR_ATTACHMENT0, a.TEXTURE_2D, e._webGLTexture, n);
                    var y = void 0 !== e.type ? this._getWebGLTextureType(e.type) : a.UNSIGNED_BYTE;
                    switch (y) {
                    case a.UNSIGNED_BYTE:
                        o || (o = new Uint8Array(4 * t * r)),
                        y = a.UNSIGNED_BYTE;
                        break;
                    default:
                        o || (o = new Float32Array(4 * t * r)),
                        y = a.FLOAT
                    }
                    return a.readPixels(0, 0, t, r, a.RGBA, y, o),
                    a.bindFramebuffer(a.FRAMEBUFFER, this._currentFramebuffer),
                    o
                }
                ,
                r.prototype._canRenderToFloatFramebuffer = function() {
                    return this._webGLVersion > 1 ? this._caps.colorBufferFloat : this._canRenderToFramebuffer(r.TEXTURETYPE_FLOAT)
                }
                ,
                r.prototype._canRenderToHalfFloatFramebuffer = function() {
                    return this._webGLVersion > 1 ? this._caps.colorBufferFloat : this._canRenderToFramebuffer(r.TEXTURETYPE_HALF_FLOAT)
                }
                ,
                r.prototype._canRenderToFramebuffer = function(e) {
                    for (var t = this._gl; t.getError() !== t.NO_ERROR; )
                        ;
                    var r = !0
                      , i = t.createTexture();
                    t.bindTexture(t.TEXTURE_2D, i),
                    t.texImage2D(t.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(e), 1, 1, 0, t.RGBA, this._getWebGLTextureType(e), null),
                    t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, t.NEAREST),
                    t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MAG_FILTER, t.NEAREST);
                    var n = t.createFramebuffer();
                    t.bindFramebuffer(t.FRAMEBUFFER, n),
                    t.framebufferTexture2D(t.FRAMEBUFFER, t.COLOR_ATTACHMENT0, t.TEXTURE_2D, i, 0);
                    var o = t.checkFramebufferStatus(t.FRAMEBUFFER);
                    if ((r = (r = r && o === t.FRAMEBUFFER_COMPLETE) && t.getError() === t.NO_ERROR) && (t.clear(t.COLOR_BUFFER_BIT),
                    r = r && t.getError() === t.NO_ERROR),
                    r) {
                        t.bindFramebuffer(t.FRAMEBUFFER, null);
                        var a = t.RGBA
                          , s = t.UNSIGNED_BYTE
                          , y = new Uint8Array(4);
                        t.readPixels(0, 0, 1, 1, a, s, y),
                        r = r && t.getError() === t.NO_ERROR
                    }
                    for (t.deleteTexture(i),
                    t.deleteFramebuffer(n),
                    t.bindFramebuffer(t.FRAMEBUFFER, null); !r && t.getError() !== t.NO_ERROR; )
                        ;
                    return r
                }
                ,
                r.prototype._getWebGLTextureType = function(e) {
                    if (1 === this._webGLVersion) {
                        switch (e) {
                        case r.TEXTURETYPE_FLOAT:
                            return this._gl.FLOAT;
                        case r.TEXTURETYPE_HALF_FLOAT:
                            return this._gl.HALF_FLOAT_OES;
                        case r.TEXTURETYPE_UNSIGNED_BYTE:
                            return this._gl.UNSIGNED_BYTE
                        }
                        return this._gl.UNSIGNED_BYTE
                    }
                    switch (e) {
                    case r.TEXTURETYPE_BYTE:
                        return this._gl.BYTE;
                    case r.TEXTURETYPE_UNSIGNED_BYTE:
                        return this._gl.UNSIGNED_BYTE;
                    case r.TEXTURETYPE_SHORT:
                        return this._gl.SHORT;
                    case r.TEXTURETYPE_UNSIGNED_SHORT:
                        return this._gl.UNSIGNED_SHORT;
                    case r.TEXTURETYPE_INT:
                        return this._gl.INT;
                    case r.TEXTURETYPE_UNSIGNED_INTEGER:
                        return this._gl.UNSIGNED_INT;
                    case r.TEXTURETYPE_FLOAT:
                        return this._gl.FLOAT;
                    case r.TEXTURETYPE_HALF_FLOAT:
                        return this._gl.HALF_FLOAT;
                    case r.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:
                        return this._gl.UNSIGNED_SHORT_4_4_4_4;
                    case r.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:
                        return this._gl.UNSIGNED_SHORT_5_5_5_1;
                    case r.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:
                        return this._gl.UNSIGNED_SHORT_5_6_5;
                    case r.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:
                        return this._gl.UNSIGNED_INT_2_10_10_10_REV;
                    case r.TEXTURETYPE_UNSIGNED_INT_24_8:
                        return this._gl.UNSIGNED_INT_24_8;
                    case r.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:
                        return this._gl.UNSIGNED_INT_10F_11F_11F_REV;
                    case r.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:
                        return this._gl.UNSIGNED_INT_5_9_9_9_REV;
                    case r.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:
                        return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV
                    }
                    return this._gl.UNSIGNED_BYTE
                }
                ,
                r.prototype._getInternalFormat = function(e) {
                    var t = this._gl.RGBA;
                    switch (e) {
                    case r.TEXTUREFORMAT_ALPHA:
                        t = this._gl.ALPHA;
                        break;
                    case r.TEXTUREFORMAT_LUMINANCE:
                        t = this._gl.LUMINANCE;
                        break;
                    case r.TEXTUREFORMAT_LUMINANCE_ALPHA:
                        t = this._gl.LUMINANCE_ALPHA;
                        break;
                    case r.TEXTUREFORMAT_RED:
                        t = this._gl.RED;
                        break;
                    case r.TEXTUREFORMAT_RG:
                        t = this._gl.RG;
                        break;
                    case r.TEXTUREFORMAT_RGB:
                        t = this._gl.RGB;
                        break;
                    case r.TEXTUREFORMAT_RGBA:
                        t = this._gl.RGBA
                    }
                    if (this._webGLVersion > 1)
                        switch (e) {
                        case r.TEXTUREFORMAT_RED_INTEGER:
                            t = this._gl.RED_INTEGER;
                            break;
                        case r.TEXTUREFORMAT_RG_INTEGER:
                            t = this._gl.RG_INTEGER;
                            break;
                        case r.TEXTUREFORMAT_RGB_INTEGER:
                            t = this._gl.RGB_INTEGER;
                            break;
                        case r.TEXTUREFORMAT_RGBA_INTEGER:
                            t = this._gl.RGBA_INTEGER
                        }
                    return t
                }
                ,
                r.prototype._getRGBABufferInternalSizedFormat = function(e, t) {
                    if (1 === this._webGLVersion) {
                        if (void 0 !== t)
                            switch (t) {
                            case r.TEXTUREFORMAT_ALPHA:
                                return this._gl.ALPHA;
                            case r.TEXTUREFORMAT_LUMINANCE:
                                return this._gl.LUMINANCE;
                            case r.TEXTUREFORMAT_LUMINANCE_ALPHA:
                                return this._gl.LUMINANCE_ALPHA
                            }
                        return this._gl.RGBA
                    }
                    switch (e) {
                    case r.TEXTURETYPE_BYTE:
                        switch (t) {
                        case r.TEXTUREFORMAT_RED:
                            return this._gl.R8_SNORM;
                        case r.TEXTUREFORMAT_RG:
                            return this._gl.RG8_SNORM;
                        case r.TEXTUREFORMAT_RGB:
                            return this._gl.RGB8_SNORM;
                        case r.TEXTUREFORMAT_RED_INTEGER:
                            return this._gl.R8I;
                        case r.TEXTUREFORMAT_RG_INTEGER:
                            return this._gl.RG8I;
                        case r.TEXTUREFORMAT_RGB_INTEGER:
                            return this._gl.RGB8I;
                        case r.TEXTUREFORMAT_RGBA_INTEGER:
                            return this._gl.RGBA8I;
                        default:
                            return this._gl.RGBA8_SNORM
                        }
                    case r.TEXTURETYPE_UNSIGNED_BYTE:
                        switch (t) {
                        case r.TEXTUREFORMAT_RED:
                            return this._gl.R8;
                        case r.TEXTUREFORMAT_RG:
                            return this._gl.RG8;
                        case r.TEXTUREFORMAT_RGB:
                            return this._gl.RGB8;
                        case r.TEXTUREFORMAT_RGBA:
                            return this._gl.RGBA8;
                        case r.TEXTUREFORMAT_RED_INTEGER:
                            return this._gl.R8UI;
                        case r.TEXTUREFORMAT_RG_INTEGER:
                            return this._gl.RG8UI;
                        case r.TEXTUREFORMAT_RGB_INTEGER:
                            return this._gl.RGB8UI;
                        case r.TEXTUREFORMAT_RGBA_INTEGER:
                            return this._gl.RGBA8UI;
                        default:
                            return this._gl.RGBA8
                        }
                    case r.TEXTURETYPE_SHORT:
                        switch (t) {
                        case r.TEXTUREFORMAT_RED_INTEGER:
                            return this._gl.R16I;
                        case r.TEXTUREFORMAT_RG_INTEGER:
                            return this._gl.RG16I;
                        case r.TEXTUREFORMAT_RGB_INTEGER:
                            return this._gl.RGB16I;
                        case r.TEXTUREFORMAT_RGBA_INTEGER:
                        default:
                            return this._gl.RGBA16I
                        }
                    case r.TEXTURETYPE_UNSIGNED_SHORT:
                        switch (t) {
                        case r.TEXTUREFORMAT_RED_INTEGER:
                            return this._gl.R16UI;
                        case r.TEXTUREFORMAT_RG_INTEGER:
                            return this._gl.RG16UI;
                        case r.TEXTUREFORMAT_RGB_INTEGER:
                            return this._gl.RGB16UI;
                        case r.TEXTUREFORMAT_RGBA_INTEGER:
                        default:
                            return this._gl.RGBA16UI
                        }
                    case r.TEXTURETYPE_INT:
                        switch (t) {
                        case r.TEXTUREFORMAT_RED_INTEGER:
                            return this._gl.R32I;
                        case r.TEXTUREFORMAT_RG_INTEGER:
                            return this._gl.RG32I;
                        case r.TEXTUREFORMAT_RGB_INTEGER:
                            return this._gl.RGB32I;
                        case r.TEXTUREFORMAT_RGBA_INTEGER:
                        default:
                            return this._gl.RGBA32I
                        }
                    case r.TEXTURETYPE_UNSIGNED_INTEGER:
                        switch (t) {
                        case r.TEXTUREFORMAT_RED_INTEGER:
                            return this._gl.R32UI;
                        case r.TEXTUREFORMAT_RG_INTEGER:
                            return this._gl.RG32UI;
                        case r.TEXTUREFORMAT_RGB_INTEGER:
                            return this._gl.RGB32UI;
                        case r.TEXTUREFORMAT_RGBA_INTEGER:
                        default:
                            return this._gl.RGBA32UI
                        }
                    case r.TEXTURETYPE_FLOAT:
                        switch (t) {
                        case r.TEXTUREFORMAT_RED:
                            return this._gl.R32F;
                        case r.TEXTUREFORMAT_RG:
                            return this._gl.RG32F;
                        case r.TEXTUREFORMAT_RGB:
                            return this._gl.RGB32F;
                        case r.TEXTUREFORMAT_RGBA:
                        default:
                            return this._gl.RGBA32F
                        }
                    case r.TEXTURETYPE_HALF_FLOAT:
                        switch (t) {
                        case r.TEXTUREFORMAT_RED:
                            return this._gl.R16F;
                        case r.TEXTUREFORMAT_RG:
                            return this._gl.RG16F;
                        case r.TEXTUREFORMAT_RGB:
                            return this._gl.RGB16F;
                        case r.TEXTUREFORMAT_RGBA:
                        default:
                            return this._gl.RGBA16F
                        }
                    case r.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:
                        return this._gl.RGB565;
                    case r.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:
                        return this._gl.R11F_G11F_B10F;
                    case r.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:
                        return this._gl.RGB9_E5;
                    case r.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:
                        return this._gl.RGBA4;
                    case r.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:
                        return this._gl.RGB5_A1;
                    case r.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:
                        switch (t) {
                        case r.TEXTUREFORMAT_RGBA:
                            return this._gl.RGB10_A2;
                        case r.TEXTUREFORMAT_RGBA_INTEGER:
                            return this._gl.RGB10_A2UI;
                        default:
                            return this._gl.RGB10_A2
                        }
                    }
                    return this._gl.RGBA8
                }
                ,
                r.prototype._getRGBAMultiSampleBufferFormat = function(e) {
                    return e === r.TEXTURETYPE_FLOAT ? this._gl.RGBA32F : e === r.TEXTURETYPE_HALF_FLOAT ? this._gl.RGBA16F : this._gl.RGBA8
                }
                ,
                r.prototype._loadFile = function(t, r, i, n, o, a) {
                    var s = this
                      , y = e.Tools.LoadFile(t, r, i, n, o, a);
                    return this._activeRequests.push(y),
                    y.onCompleteObservable.add((function(e) {
                        s._activeRequests.splice(s._activeRequests.indexOf(e), 1)
                    }
                    )),
                    y
                }
                ,
                r.prototype._loadFileAsync = function(e, t, r) {
                    var i = this;
                    return new Promise((function(n, o) {
                        i._loadFile(e, (function(e) {
                            n(e)
                        }
                        ), void 0, t, r, (function(e, t) {
                            o(t)
                        }
                        ))
                    }
                    ))
                }
                ,
                r.prototype._partialLoadFile = function(e, t, r, i, n, o) {
                    void 0 === o && (o = null);
                    this._loadFile(e, (function(e) {
                        r[t] = e,
                        r._internalCount++,
                        6 === r._internalCount && n(r)
                    }
                    ), void 0, void 0, !0, (function(e, t) {
                        o && e && o(e.status + " " + e.statusText, t)
                    }
                    ))
                }
                ,
                r.prototype._cascadeLoadFiles = function(e, t, r, i) {
                    void 0 === i && (i = null);
                    var n = [];
                    n._internalCount = 0;
                    for (var o = 0; o < 6; o++)
                        this._partialLoadFile(r[o], o, n, e, t, i)
                }
                ,
                r.isSupported = function() {
                    try {
                        var e = document.createElement("canvas");
                        return null != (e.getContext("webgl") || e.getContext("experimental-webgl")) && !!window.WebGLRenderingContext
                    } catch (e) {
                        return !1
                    }
                }
                ,
                r.ExceptionList = [{
                    key: "Chrome/63.0",
                    capture: "63\\.0\\.3239\\.(\\d+)",
                    captureConstraint: 108,
                    targets: ["uniformBuffer"]
                }, {
                    key: "Firefox/58",
                    capture: null,
                    captureConstraint: null,
                    targets: ["uniformBuffer"]
                }, {
                    key: "Firefox/59",
                    capture: null,
                    captureConstraint: null,
                    targets: ["uniformBuffer"]
                }, {
                    key: "Macintosh",
                    capture: null,
                    captureConstraint: null,
                    targets: ["textureBindingOptimization"]
                }, {
                    key: "iPhone",
                    capture: null,
                    captureConstraint: null,
                    targets: ["textureBindingOptimization"]
                }, {
                    key: "iPad",
                    capture: null,
                    captureConstraint: null,
                    targets: ["textureBindingOptimization"]
                }],
                r.Instances = new Array,
                r._TextureLoaders = [],
                r.ALPHA_DISABLE = 0,
                r.ALPHA_ADD = 1,
                r.ALPHA_COMBINE = 2,
                r.ALPHA_SUBTRACT = 3,
                r.ALPHA_MULTIPLY = 4,
                r.ALPHA_MAXIMIZED = 5,
                r.ALPHA_ONEONE = 6,
                r.ALPHA_PREMULTIPLIED = 7,
                r.ALPHA_PREMULTIPLIED_PORTERDUFF = 8,
                r.ALPHA_INTERPOLATE = 9,
                r.ALPHA_SCREENMODE = 10,
                r.DELAYLOADSTATE_NONE = 0,
                r.DELAYLOADSTATE_LOADED = 1,
                r.DELAYLOADSTATE_LOADING = 2,
                r.DELAYLOADSTATE_NOTLOADED = 4,
                r.NEVER = 512,
                r.ALWAYS = 519,
                r.LESS = 513,
                r.EQUAL = 514,
                r.LEQUAL = 515,
                r.GREATER = 516,
                r.GEQUAL = 518,
                r.NOTEQUAL = 517,
                r.KEEP = 7680,
                r.REPLACE = 7681,
                r.INCR = 7682,
                r.DECR = 7683,
                r.INVERT = 5386,
                r.INCR_WRAP = 34055,
                r.DECR_WRAP = 34056,
                r.TEXTURE_CLAMP_ADDRESSMODE = 0,
                r.TEXTURE_WRAP_ADDRESSMODE = 1,
                r.TEXTURE_MIRROR_ADDRESSMODE = 2,
                r.TEXTUREFORMAT_ALPHA = 0,
                r.TEXTUREFORMAT_LUMINANCE = 1,
                r.TEXTUREFORMAT_LUMINANCE_ALPHA = 2,
                r.TEXTUREFORMAT_RGB = 4,
                r.TEXTUREFORMAT_RGBA = 5,
                r.TEXTUREFORMAT_RED = 6,
                r.TEXTUREFORMAT_R = 6,
                r.TEXTUREFORMAT_RG = 7,
                r.TEXTUREFORMAT_RED_INTEGER = 8,
                r.TEXTUREFORMAT_R_INTEGER = 8,
                r.TEXTUREFORMAT_RG_INTEGER = 9,
                r.TEXTUREFORMAT_RGB_INTEGER = 10,
                r.TEXTUREFORMAT_RGBA_INTEGER = 11,
                r.TEXTURETYPE_UNSIGNED_BYTE = 0,
                r.TEXTURETYPE_UNSIGNED_INT = 0,
                r.TEXTURETYPE_FLOAT = 1,
                r.TEXTURETYPE_HALF_FLOAT = 2,
                r.TEXTURETYPE_BYTE = 3,
                r.TEXTURETYPE_SHORT = 4,
                r.TEXTURETYPE_UNSIGNED_SHORT = 5,
                r.TEXTURETYPE_INT = 6,
                r.TEXTURETYPE_UNSIGNED_INTEGER = 7,
                r.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 = 8,
                r.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 = 9,
                r.TEXTURETYPE_UNSIGNED_SHORT_5_6_5 = 10,
                r.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV = 11,
                r.TEXTURETYPE_UNSIGNED_INT_24_8 = 12,
                r.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV = 13,
                r.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV = 14,
                r.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV = 15,
                r.TEXTURE_NEAREST_SAMPLINGMODE = 1,
                r.TEXTURE_BILINEAR_SAMPLINGMODE = 2,
                r.TEXTURE_TRILINEAR_SAMPLINGMODE = 3,
                r.TEXTURE_NEAREST_NEAREST_MIPLINEAR = 1,
                r.TEXTURE_LINEAR_LINEAR_MIPNEAREST = 2,
                r.TEXTURE_LINEAR_LINEAR_MIPLINEAR = 3,
                r.TEXTURE_NEAREST_NEAREST_MIPNEAREST = 4,
                r.TEXTURE_NEAREST_LINEAR_MIPNEAREST = 5,
                r.TEXTURE_NEAREST_LINEAR_MIPLINEAR = 6,
                r.TEXTURE_NEAREST_LINEAR = 7,
                r.TEXTURE_NEAREST_NEAREST = 8,
                r.TEXTURE_LINEAR_NEAREST_MIPNEAREST = 9,
                r.TEXTURE_LINEAR_NEAREST_MIPLINEAR = 10,
                r.TEXTURE_LINEAR_LINEAR = 11,
                r.TEXTURE_LINEAR_NEAREST = 12,
                r.TEXTURE_EXPLICIT_MODE = 0,
                r.TEXTURE_SPHERICAL_MODE = 1,
                r.TEXTURE_PLANAR_MODE = 2,
                r.TEXTURE_CUBIC_MODE = 3,
                r.TEXTURE_PROJECTION_MODE = 4,
                r.TEXTURE_SKYBOX_MODE = 5,
                r.TEXTURE_INVCUBIC_MODE = 6,
                r.TEXTURE_EQUIRECTANGULAR_MODE = 7,
                r.TEXTURE_FIXED_EQUIRECTANGULAR_MODE = 8,
                r.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE = 9,
                r.SCALEMODE_FLOOR = 1,
                r.SCALEMODE_NEAREST = 2,
                r.SCALEMODE_CEILING = 3,
                r.CollisionsEpsilon = .001,
                r.CodeRepository = "src/",
                r.ShadersRepository = "src/Shaders/",
                r
            }();
            e.Engine = s
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r) {
                    void 0 === r && (r = null),
                    this.state = "",
                    this.metadata = null,
                    this.doNotSerialize = !1,
                    this._isDisposed = !1,
                    this.animations = new Array,
                    this._ranges = {},
                    this._isEnabled = !0,
                    this._isParentEnabled = !0,
                    this._isReady = !0,
                    this._currentRenderId = -1,
                    this._parentRenderId = -1,
                    this._childRenderId = -1,
                    this._worldMatrix = e.Matrix.Identity(),
                    this._worldMatrixDeterminant = 0,
                    this._sceneRootNodesIndex = -1,
                    this._animationPropertiesOverride = null,
                    this.onDisposeObservable = new e.Observable,
                    this._behaviors = new Array,
                    this.name = t,
                    this.id = t,
                    this._scene = r || e.Engine.LastCreatedScene,
                    this.uniqueId = this._scene.getUniqueId(),
                    this._initCache(),
                    this.addToSceneRootNodes()
                }
                return t.AddNodeConstructor = function(e, t) {
                    this._NodeConstructors[e] = t
                }
                ,
                t.Construct = function(e, t, r, i) {
                    var n = this._NodeConstructors[e];
                    return n ? n(t, r, i) : null
                }
                ,
                t.prototype.isDisposed = function() {
                    return this._isDisposed
                }
                ,
                Object.defineProperty(t.prototype, "parent", {
                    get: function() {
                        return this._parentNode
                    },
                    set: function(e) {
                        if (this._parentNode !== e) {
                            var t = this._parentNode;
                            if (this._parentNode && void 0 !== this._parentNode._children && null !== this._parentNode._children) {
                                var r = this._parentNode._children.indexOf(this);
                                -1 !== r && this._parentNode._children.splice(r, 1),
                                e || this.addToSceneRootNodes()
                            }
                            this._parentNode = e,
                            this._parentNode && (void 0 !== this._parentNode._children && null !== this._parentNode._children || (this._parentNode._children = new Array),
                            this._parentNode._children.push(this),
                            t || this.removeFromSceneRootNodes()),
                            this._syncParentEnabledState()
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.addToSceneRootNodes = function() {
                    -1 === this._sceneRootNodesIndex && (this._sceneRootNodesIndex = this._scene.rootNodes.length,
                    this._scene.rootNodes.push(this))
                }
                ,
                t.prototype.removeFromSceneRootNodes = function() {
                    if (-1 !== this._sceneRootNodesIndex) {
                        var e = this._scene.rootNodes
                          , t = e.length - 1;
                        e[this._sceneRootNodesIndex] = e[t],
                        e[this._sceneRootNodesIndex]._sceneRootNodesIndex = this._sceneRootNodesIndex,
                        this._scene.rootNodes.pop(),
                        this._sceneRootNodesIndex = -1
                    }
                }
                ,
                Object.defineProperty(t.prototype, "animationPropertiesOverride", {
                    get: function() {
                        return this._animationPropertiesOverride ? this._animationPropertiesOverride : this._scene.animationPropertiesOverride
                    },
                    set: function(e) {
                        this._animationPropertiesOverride = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getClassName = function() {
                    return "Node"
                }
                ,
                Object.defineProperty(t.prototype, "onDispose", {
                    set: function(e) {
                        this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver),
                        this._onDisposeObserver = this.onDisposeObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getScene = function() {
                    return this._scene
                }
                ,
                t.prototype.getEngine = function() {
                    return this._scene.getEngine()
                }
                ,
                t.prototype.addBehavior = function(e, t) {
                    var r = this;
                    return void 0 === t && (t = !1),
                    -1 !== this._behaviors.indexOf(e) ? this : (e.init(),
                    this._scene.isLoading && !t ? this._scene.onDataLoadedObservable.addOnce((function() {
                        e.attach(r)
                    }
                    )) : e.attach(this),
                    this._behaviors.push(e),
                    this)
                }
                ,
                t.prototype.removeBehavior = function(e) {
                    var t = this._behaviors.indexOf(e);
                    return -1 === t ? this : (this._behaviors[t].detach(),
                    this._behaviors.splice(t, 1),
                    this)
                }
                ,
                Object.defineProperty(t.prototype, "behaviors", {
                    get: function() {
                        return this._behaviors
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getBehaviorByName = function(e) {
                    for (var t = 0, r = this._behaviors; t < r.length; t++) {
                        var i = r[t];
                        if (i.name === e)
                            return i
                    }
                    return null
                }
                ,
                t.prototype.getWorldMatrix = function() {
                    return this._currentRenderId !== this._scene.getRenderId() && this.computeWorldMatrix(),
                    this._worldMatrix
                }
                ,
                t.prototype._getWorldMatrixDeterminant = function() {
                    return this._worldMatrixDeterminant
                }
                ,
                Object.defineProperty(t.prototype, "worldMatrixFromCache", {
                    get: function() {
                        return this._worldMatrix
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._initCache = function() {
                    this._cache = {},
                    this._cache.parent = void 0
                }
                ,
                t.prototype.updateCache = function(e) {
                    !e && this.isSynchronized() || (this._cache.parent = this.parent,
                    this._updateCache())
                }
                ,
                t.prototype._updateCache = function(e) {}
                ,
                t.prototype._isSynchronized = function() {
                    return !0
                }
                ,
                t.prototype._markSyncedWithParent = function() {
                    this._parentNode && (this._parentRenderId = this._parentNode._childRenderId)
                }
                ,
                t.prototype.isSynchronizedWithParent = function() {
                    return !this._parentNode || this._parentRenderId === this._parentNode._childRenderId && this._parentNode.isSynchronized()
                }
                ,
                t.prototype.isSynchronized = function() {
                    return this._cache.parent != this._parentNode ? (this._cache.parent = this._parentNode,
                    !1) : !(this._parentNode && !this.isSynchronizedWithParent()) && this._isSynchronized()
                }
                ,
                t.prototype.isReady = function(e) {
                    return void 0 === e && (e = !1),
                    this._isReady
                }
                ,
                t.prototype.isEnabled = function(e) {
                    return void 0 === e && (e = !0),
                    !1 === e ? this._isEnabled : !!this._isEnabled && this._isParentEnabled
                }
                ,
                t.prototype._syncParentEnabledState = function() {
                    this._isParentEnabled = !this._parentNode || this._parentNode.isEnabled(),
                    this._children && this._children.forEach((function(e) {
                        e._syncParentEnabledState()
                    }
                    ))
                }
                ,
                t.prototype.setEnabled = function(e) {
                    this._isEnabled = e,
                    this._syncParentEnabledState()
                }
                ,
                t.prototype.isDescendantOf = function(e) {
                    return !!this.parent && (this.parent === e || this.parent.isDescendantOf(e))
                }
                ,
                t.prototype._getDescendants = function(e, t, r) {
                    if (void 0 === t && (t = !1),
                    this._children)
                        for (var i = 0; i < this._children.length; i++) {
                            var n = this._children[i];
                            r && !r(n) || e.push(n),
                            t || n._getDescendants(e, !1, r)
                        }
                }
                ,
                t.prototype.getDescendants = function(e, t) {
                    var r = new Array;
                    return this._getDescendants(r, e, t),
                    r
                }
                ,
                t.prototype.getChildMeshes = function(t, r) {
                    var i = [];
                    return this._getDescendants(i, t, (function(t) {
                        return (!r || r(t)) && t instanceof e.AbstractMesh
                    }
                    )),
                    i
                }
                ,
                t.prototype.getChildTransformNodes = function(t, r) {
                    var i = [];
                    return this._getDescendants(i, t, (function(t) {
                        return (!r || r(t)) && t instanceof e.TransformNode
                    }
                    )),
                    i
                }
                ,
                t.prototype.getChildren = function(e) {
                    return this.getDescendants(!0, e)
                }
                ,
                t.prototype._setReady = function(e) {
                    e !== this._isReady && (e ? (this.onReady && this.onReady(this),
                    this._isReady = !0) : this._isReady = !1)
                }
                ,
                t.prototype.getAnimationByName = function(e) {
                    for (var t = 0; t < this.animations.length; t++) {
                        var r = this.animations[t];
                        if (r.name === e)
                            return r
                    }
                    return null
                }
                ,
                t.prototype.createAnimationRange = function(t, r, i) {
                    if (!this._ranges[t]) {
                        this._ranges[t] = new e.AnimationRange(t,r,i);
                        for (var n = 0, o = this.animations.length; n < o; n++)
                            this.animations[n] && this.animations[n].createRange(t, r, i)
                    }
                }
                ,
                t.prototype.deleteAnimationRange = function(e, t) {
                    void 0 === t && (t = !0);
                    for (var r = 0, i = this.animations.length; r < i; r++)
                        this.animations[r] && this.animations[r].deleteRange(e, t);
                    this._ranges[e] = null
                }
                ,
                t.prototype.getAnimationRange = function(e) {
                    return this._ranges[e]
                }
                ,
                t.prototype.beginAnimation = function(e, t, r, i) {
                    var n = this.getAnimationRange(e);
                    return n ? this._scene.beginAnimation(this, n.from, n.to, t, r, i) : null
                }
                ,
                t.prototype.serializeAnimationRanges = function() {
                    var e = [];
                    for (var t in this._ranges) {
                        var r = this._ranges[t];
                        if (r) {
                            var i = {};
                            i.name = t,
                            i.from = r.from,
                            i.to = r.to,
                            e.push(i)
                        }
                    }
                    return e
                }
                ,
                t.prototype.computeWorldMatrix = function(t) {
                    return this._worldMatrix || (this._worldMatrix = e.Matrix.Identity()),
                    this._worldMatrix
                }
                ,
                t.prototype.dispose = function(e, t) {
                    if (void 0 === t && (t = !1),
                    e)
                        for (var r = 0, i = this.getChildTransformNodes(!0); r < i.length; r++) {
                            var n = i[r];
                            n.parent = null,
                            n.computeWorldMatrix(!0)
                        }
                    else
                        for (var o = 0, a = this.getDescendants(!0); o < a.length; o++) {
                            a[o].dispose(e, t)
                        }
                    this.parent ? this.parent = null : this.removeFromSceneRootNodes(),
                    this.onDisposeObservable.notifyObservers(this),
                    this.onDisposeObservable.clear();
                    for (var s = 0, y = this._behaviors; s < y.length; s++) {
                        y[s].detach()
                    }
                    this._behaviors = [],
                    this._isDisposed = !0
                }
                ,
                t.ParseAnimationRanges = function(e, t, r) {
                    if (t.ranges)
                        for (var i = 0; i < t.ranges.length; i++) {
                            var n = t.ranges[i];
                            e.createAnimationRange(n.name, n.from, n.to)
                        }
                }
                ,
                t._NodeConstructors = {},
                n([e.serialize()], t.prototype, "name", void 0),
                n([e.serialize()], t.prototype, "id", void 0),
                n([e.serialize()], t.prototype, "uniqueId", void 0),
                n([e.serialize()], t.prototype, "state", void 0),
                n([e.serialize()], t.prototype, "metadata", void 0),
                t
            }();
            e.Node = t
        }(s || (s = {})),
        function(e) {
            var t = e.Matrix.Identity()
              , r = function() {
                function r(t, r) {
                    this.center = e.Vector3.Zero(),
                    this.centerWorld = e.Vector3.Zero(),
                    this.minimum = e.Vector3.Zero(),
                    this.maximum = e.Vector3.Zero(),
                    this.reConstruct(t, r)
                }
                return r.prototype.reConstruct = function(r, i) {
                    this.minimum.copyFrom(r),
                    this.maximum.copyFrom(i);
                    var n = e.Vector3.Distance(r, i);
                    e.Vector3.LerpToRef(r, i, .5, this.center),
                    this.radius = .5 * n,
                    this.centerWorld.set(0, 0, 0),
                    this._update(t)
                }
                ,
                r.prototype.scale = function(t) {
                    var r = this.radius * t
                      , i = e.Tmp.Vector3[0].set(r, r, r)
                      , n = e.Tmp.Vector3[1].copyFrom(this.center).subtractInPlace(i)
                      , o = e.Tmp.Vector3[2].copyFrom(this.center).addInPlace(i);
                    return this.reConstruct(n, o),
                    this
                }
                ,
                r.prototype._update = function(t) {
                    e.Vector3.TransformCoordinatesToRef(this.center, t, this.centerWorld);
                    var r = e.Tmp.Vector3[0];
                    e.Vector3.TransformNormalFromFloatsToRef(1, 1, 1, t, r),
                    this.radiusWorld = Math.max(Math.abs(r.x), Math.abs(r.y), Math.abs(r.z)) * this.radius
                }
                ,
                r.prototype.isInFrustum = function(e) {
                    for (var t = 0; t < 6; t++)
                        if (e[t].dotCoordinate(this.centerWorld) <= -this.radiusWorld)
                            return !1;
                    return !0
                }
                ,
                r.prototype.intersectsPoint = function(e) {
                    var t = this.centerWorld.x - e.x
                      , r = this.centerWorld.y - e.y
                      , i = this.centerWorld.z - e.z
                      , n = Math.sqrt(t * t + r * r + i * i);
                    return !(this.radiusWorld < n)
                }
                ,
                r.Intersects = function(e, t) {
                    var r = e.centerWorld.x - t.centerWorld.x
                      , i = e.centerWorld.y - t.centerWorld.y
                      , n = e.centerWorld.z - t.centerWorld.z
                      , o = Math.sqrt(r * r + i * i + n * n);
                    return !(e.radiusWorld + t.radiusWorld < o)
                }
                ,
                r
            }();
            e.BoundingSphere = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r) {
                    this.vectors = [e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero()],
                    this.center = e.Vector3.Zero(),
                    this.centerWorld = e.Vector3.Zero(),
                    this.extendSize = e.Vector3.Zero(),
                    this.extendSizeWorld = e.Vector3.Zero(),
                    this.directions = [e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero()],
                    this.vectorsWorld = [e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero()],
                    this.minimumWorld = e.Vector3.Zero(),
                    this.maximumWorld = e.Vector3.Zero(),
                    this.minimum = e.Vector3.Zero(),
                    this.maximum = e.Vector3.Zero(),
                    this.reConstruct(t, r)
                }
                return t.prototype.reConstruct = function(t, r) {
                    this.minimum.copyFrom(t),
                    this.maximum.copyFrom(r),
                    this.vectors[0].copyFrom(this.minimum),
                    this.vectors[1].copyFrom(this.maximum),
                    this.vectors[2].copyFrom(this.minimum),
                    this.vectors[3].copyFrom(this.minimum),
                    this.vectors[4].copyFrom(this.minimum),
                    this.vectors[5].copyFrom(this.maximum),
                    this.vectors[6].copyFrom(this.maximum),
                    this.vectors[7].copyFrom(this.maximum),
                    this.vectors[2].x = this.maximum.x,
                    this.vectors[3].y = this.maximum.y,
                    this.vectors[4].z = this.maximum.z,
                    this.vectors[5].z = this.minimum.z,
                    this.vectors[6].x = this.minimum.x,
                    this.vectors[7].y = this.minimum.y,
                    this.center.copyFrom(this.maximum).addInPlace(this.minimum).scaleInPlace(.5),
                    this.extendSize.copyFrom(this.maximum).subtractInPlace(this.minimum).scaleInPlace(.5);
                    for (var i = 0; i < 3; i++)
                        this.directions[i].copyFromFloats(0, 0, 0);
                    for (i = 0; i < 8; i++)
                        this.vectorsWorld[i].copyFromFloats(0, 0, 0);
                    this.minimumWorld.copyFromFloats(0, 0, 0),
                    this.maximumWorld.copyFromFloats(0, 0, 0),
                    this.centerWorld.copyFromFloats(0, 0, 0),
                    this.extendSizeWorld.copyFromFloats(0, 0, 0),
                    this._update(this._worldMatrix || e.Matrix.Identity())
                }
                ,
                t.prototype.scale = function(t) {
                    var r = e.Tmp.Vector3[0].copyFrom(this.maximum).subtractInPlace(this.minimum)
                      , i = r.length() * t;
                    r.normalize();
                    var n = r.scaleInPlace(.5 * i)
                      , o = e.Tmp.Vector3[1].copyFrom(this.center).subtractInPlace(n)
                      , a = e.Tmp.Vector3[2].copyFrom(this.center).addInPlace(n);
                    return this.reConstruct(o, a),
                    this
                }
                ,
                t.prototype.getWorldMatrix = function() {
                    return this._worldMatrix
                }
                ,
                t.prototype.setWorldMatrix = function(e) {
                    return this._worldMatrix.copyFrom(e),
                    this
                }
                ,
                t.prototype._update = function(t) {
                    e.Vector3.FromFloatsToRef(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE, this.minimumWorld),
                    e.Vector3.FromFloatsToRef(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE, this.maximumWorld);
                    for (var r = 0; r < 8; r++) {
                        var i = this.vectorsWorld[r];
                        e.Vector3.TransformCoordinatesToRef(this.vectors[r], t, i),
                        this.minimumWorld.minimizeInPlace(i),
                        this.maximumWorld.maximizeInPlace(i)
                    }
                    this.maximumWorld.subtractToRef(this.minimumWorld, this.extendSizeWorld),
                    this.extendSizeWorld.scaleInPlace(.5),
                    this.maximumWorld.addToRef(this.minimumWorld, this.centerWorld),
                    this.centerWorld.scaleInPlace(.5),
                    e.Vector3.FromFloatArrayToRef(t.m, 0, this.directions[0]),
                    e.Vector3.FromFloatArrayToRef(t.m, 4, this.directions[1]),
                    e.Vector3.FromFloatArrayToRef(t.m, 8, this.directions[2]),
                    this._worldMatrix = t
                }
                ,
                t.prototype.isInFrustum = function(e) {
                    return t.IsInFrustum(this.vectorsWorld, e)
                }
                ,
                t.prototype.isCompletelyInFrustum = function(e) {
                    return t.IsCompletelyInFrustum(this.vectorsWorld, e)
                }
                ,
                t.prototype.intersectsPoint = function(t, r) {
                    var i = r ? this.minimum : this.minimumWorld
                      , n = r ? this.maximum : this.maximumWorld
                      , o = -e.Epsilon;
                    return !(n.x - t.x < o || o > t.x - i.x) && (!(n.y - t.y < o || o > t.y - i.y) && !(n.z - t.z < o || o > t.z - i.z))
                }
                ,
                t.prototype.intersectsSphere = function(e) {
                    return t.IntersectsSphere(this.minimumWorld, this.maximumWorld, e.centerWorld, e.radiusWorld)
                }
                ,
                t.prototype.intersectsMinMax = function(e, t) {
                    return !(this.maximumWorld.x < e.x || this.minimumWorld.x > t.x) && (!(this.maximumWorld.y < e.y || this.minimumWorld.y > t.y) && !(this.maximumWorld.z < e.z || this.minimumWorld.z > t.z))
                }
                ,
                t.Intersects = function(e, t) {
                    return !(e.maximumWorld.x < t.minimumWorld.x || e.minimumWorld.x > t.maximumWorld.x) && (!(e.maximumWorld.y < t.minimumWorld.y || e.minimumWorld.y > t.maximumWorld.y) && !(e.maximumWorld.z < t.minimumWorld.z || e.minimumWorld.z > t.maximumWorld.z))
                }
                ,
                t.IntersectsSphere = function(t, r, i, n) {
                    var o = e.Vector3.Clamp(i, t, r);
                    return e.Vector3.DistanceSquared(i, o) <= n * n
                }
                ,
                t.IsCompletelyInFrustum = function(e, t) {
                    for (var r = 0; r < 6; r++)
                        for (var i = 0; i < 8; i++)
                            if (t[r].dotCoordinate(e[i]) < 0)
                                return !1;
                    return !0
                }
                ,
                t.IsInFrustum = function(e, t) {
                    for (var r = 0; r < 6; r++) {
                        for (var i = 8, n = 0; n < 8 && t[r].dotCoordinate(e[n]) < 0; n++)
                            --i;
                        if (0 === i)
                            return !1
                    }
                    return !0
                }
                ,
                t
            }();
            e.BoundingBox = t
        }(s || (s = {})),
        function(e) {
            var t = function(t, r) {
                var i = e.Vector3.Dot(r.centerWorld, t)
                  , n = Math.abs(e.Vector3.Dot(r.directions[0], t)) * r.extendSize.x + Math.abs(e.Vector3.Dot(r.directions[1], t)) * r.extendSize.y + Math.abs(e.Vector3.Dot(r.directions[2], t)) * r.extendSize.z;
                return {
                    min: i - n,
                    max: i + n
                }
            }
              , r = function(e, r, i) {
                var n, o, a, s, y = t(e, r), l = t(e, i);
                return n = y.min,
                o = y.max,
                a = l.min,
                s = l.max,
                !(n > s || a > o)
            }
              , i = function() {
                function t(t, r) {
                    this._isLocked = !1,
                    this.boundingBox = new e.BoundingBox(t,r),
                    this.boundingSphere = new e.BoundingSphere(t,r)
                }
                return Object.defineProperty(t.prototype, "minimum", {
                    get: function() {
                        return this.boundingBox.minimum
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "maximum", {
                    get: function() {
                        return this.boundingBox.maximum
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "isLocked", {
                    get: function() {
                        return this._isLocked
                    },
                    set: function(e) {
                        this._isLocked = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.update = function(e) {
                    this._isLocked || (this.boundingBox._update(e),
                    this.boundingSphere._update(e))
                }
                ,
                t.prototype.centerOn = function(t, r) {
                    var i = e.Tmp.Vector3[0].copyFrom(t).subtractInPlace(r)
                      , n = e.Tmp.Vector3[1].copyFrom(t).addInPlace(r);
                    return this.boundingBox.reConstruct(i, n),
                    this.boundingSphere.reConstruct(i, n),
                    this
                }
                ,
                t.prototype.scale = function(e) {
                    return this.boundingBox.scale(e),
                    this.boundingSphere.scale(e),
                    this
                }
                ,
                t.prototype.isInFrustum = function(t, r) {
                    return void 0 === r && (r = e.AbstractMesh.CULLINGSTRATEGY_STANDARD),
                    !!this.boundingSphere.isInFrustum(t) && (r === e.AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY || this.boundingBox.isInFrustum(t))
                }
                ,
                Object.defineProperty(t.prototype, "diagonalLength", {
                    get: function() {
                        var e = this.boundingBox;
                        return e.maximumWorld.subtract(e.minimumWorld).length()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.isCompletelyInFrustum = function(e) {
                    return this.boundingBox.isCompletelyInFrustum(e)
                }
                ,
                t.prototype._checkCollision = function(e) {
                    return e._canDoCollision(this.boundingSphere.centerWorld, this.boundingSphere.radiusWorld, this.boundingBox.minimumWorld, this.boundingBox.maximumWorld)
                }
                ,
                t.prototype.intersectsPoint = function(e, t) {
                    return !!this.boundingSphere.centerWorld && (!!this.boundingSphere.intersectsPoint(e) && !!this.boundingBox.intersectsPoint(e, t))
                }
                ,
                t.prototype.intersects = function(t, i) {
                    if (!this.boundingSphere.centerWorld || !t.boundingSphere.centerWorld)
                        return !1;
                    if (!e.BoundingSphere.Intersects(this.boundingSphere, t.boundingSphere))
                        return !1;
                    if (!e.BoundingBox.Intersects(this.boundingBox, t.boundingBox))
                        return !1;
                    if (!i)
                        return !0;
                    var n = this.boundingBox
                      , o = t.boundingBox;
                    return !!r(n.directions[0], n, o) && (!!r(n.directions[1], n, o) && (!!r(n.directions[2], n, o) && (!!r(o.directions[0], n, o) && (!!r(o.directions[1], n, o) && (!!r(o.directions[2], n, o) && (!!r(e.Vector3.Cross(n.directions[0], o.directions[0]), n, o) && (!!r(e.Vector3.Cross(n.directions[0], o.directions[1]), n, o) && (!!r(e.Vector3.Cross(n.directions[0], o.directions[2]), n, o) && (!!r(e.Vector3.Cross(n.directions[1], o.directions[0]), n, o) && (!!r(e.Vector3.Cross(n.directions[1], o.directions[1]), n, o) && (!!r(e.Vector3.Cross(n.directions[1], o.directions[2]), n, o) && (!!r(e.Vector3.Cross(n.directions[2], o.directions[0]), n, o) && (!!r(e.Vector3.Cross(n.directions[2], o.directions[1]), n, o) && !!r(e.Vector3.Cross(n.directions[2], o.directions[2]), n, o))))))))))))))
                }
                ,
                t
            }();
            e.BoundingInfo = i
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(i, n, o) {
                    void 0 === n && (n = null),
                    void 0 === o && (o = !0);
                    var a = t.call(this, i, n) || this;
                    return a._forward = new e.Vector3(0,0,1),
                    a._forwardInverted = new e.Vector3(0,0,-1),
                    a._up = new e.Vector3(0,1,0),
                    a._right = new e.Vector3(1,0,0),
                    a._rightInverted = new e.Vector3(-1,0,0),
                    a._position = e.Vector3.Zero(),
                    a._rotation = e.Vector3.Zero(),
                    a._scaling = e.Vector3.One(),
                    a._isDirty = !1,
                    a.billboardMode = r.BILLBOARDMODE_NONE,
                    a.scalingDeterminant = 1,
                    a.infiniteDistance = !1,
                    a.ignoreNonUniformScaling = !1,
                    a._localWorld = e.Matrix.Zero(),
                    a._absolutePosition = e.Vector3.Zero(),
                    a._pivotMatrix = e.Matrix.Identity(),
                    a._postMultiplyPivotMatrix = !1,
                    a._isWorldMatrixFrozen = !1,
                    a.onAfterWorldMatrixUpdateObservable = new e.Observable,
                    a._nonUniformScaling = !1,
                    o && a.getScene().addTransformNode(a),
                    a
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "TransformNode"
                }
                ,
                Object.defineProperty(r.prototype, "position", {
                    get: function() {
                        return this._position
                    },
                    set: function(e) {
                        this._position = e,
                        this._isDirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "rotation", {
                    get: function() {
                        return this._rotation
                    },
                    set: function(e) {
                        this._rotation = e,
                        this._isDirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "scaling", {
                    get: function() {
                        return this._scaling
                    },
                    set: function(e) {
                        this._scaling = e,
                        this._isDirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "rotationQuaternion", {
                    get: function() {
                        return this._rotationQuaternion
                    },
                    set: function(e) {
                        this._rotationQuaternion = e,
                        e && this.rotation.length() && this.rotation.copyFromFloats(0, 0, 0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "forward", {
                    get: function() {
                        return e.Vector3.Normalize(e.Vector3.TransformNormal(this.getScene().useRightHandedSystem ? this._forwardInverted : this._forward, this.getWorldMatrix()))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "up", {
                    get: function() {
                        return e.Vector3.Normalize(e.Vector3.TransformNormal(this._up, this.getWorldMatrix()))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "right", {
                    get: function() {
                        return e.Vector3.Normalize(e.Vector3.TransformNormal(this.getScene().useRightHandedSystem ? this._rightInverted : this._right, this.getWorldMatrix()))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.updatePoseMatrix = function(e) {
                    return this._poseMatrix.copyFrom(e),
                    this
                }
                ,
                r.prototype.getPoseMatrix = function() {
                    return this._poseMatrix
                }
                ,
                r.prototype._isSynchronized = function() {
                    return !this._isDirty && (this.billboardMode === this._cache.billboardMode && this.billboardMode === r.BILLBOARDMODE_NONE && (!this._cache.pivotMatrixUpdated && (!this.infiniteDistance && (!!this._cache.position.equals(this._position) && (!(this._rotationQuaternion && !this._cache.rotationQuaternion.equals(this._rotationQuaternion)) && (!!this._cache.rotation.equals(this._rotation) && !!this._cache.scaling.equals(this._scaling)))))))
                }
                ,
                r.prototype._initCache = function() {
                    t.prototype._initCache.call(this),
                    this._cache.localMatrixUpdated = !1,
                    this._cache.position = e.Vector3.Zero(),
                    this._cache.scaling = e.Vector3.Zero(),
                    this._cache.rotation = e.Vector3.Zero(),
                    this._cache.rotationQuaternion = new e.Quaternion(0,0,0,0),
                    this._cache.billboardMode = -1
                }
                ,
                r.prototype.markAsDirty = function(e) {
                    return "rotation" === e && (this.rotationQuaternion = null),
                    this._currentRenderId = Number.MAX_VALUE,
                    this._isDirty = !0,
                    this
                }
                ,
                Object.defineProperty(r.prototype, "absolutePosition", {
                    get: function() {
                        return this._absolutePosition
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.setPreTransformMatrix = function(e) {
                    return this.setPivotMatrix(e, !1)
                }
                ,
                r.prototype.setPivotMatrix = function(t, r) {
                    return void 0 === r && (r = !0),
                    this._pivotMatrix = t.clone(),
                    this._cache.pivotMatrixUpdated = !0,
                    this._postMultiplyPivotMatrix = r,
                    this._postMultiplyPivotMatrix && (this._pivotMatrixInverse ? this._pivotMatrix.invertToRef(this._pivotMatrixInverse) : this._pivotMatrixInverse = e.Matrix.Invert(this._pivotMatrix)),
                    this
                }
                ,
                r.prototype.getPivotMatrix = function() {
                    return this._pivotMatrix
                }
                ,
                r.prototype.freezeWorldMatrix = function() {
                    return this._isWorldMatrixFrozen = !1,
                    this.computeWorldMatrix(!0),
                    this._isWorldMatrixFrozen = !0,
                    this
                }
                ,
                r.prototype.unfreezeWorldMatrix = function() {
                    return this._isWorldMatrixFrozen = !1,
                    this.computeWorldMatrix(!0),
                    this
                }
                ,
                Object.defineProperty(r.prototype, "isWorldMatrixFrozen", {
                    get: function() {
                        return this._isWorldMatrixFrozen
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getAbsolutePosition = function() {
                    return this.computeWorldMatrix(),
                    this._absolutePosition
                }
                ,
                r.prototype.setAbsolutePosition = function(t) {
                    if (!t)
                        return this;
                    var r, i, n;
                    if (void 0 === t.x) {
                        if (arguments.length < 3)
                            return this;
                        r = arguments[0],
                        i = arguments[1],
                        n = arguments[2]
                    } else
                        r = t.x,
                        i = t.y,
                        n = t.z;
                    if (this.parent) {
                        var o = this.parent.getWorldMatrix().clone();
                        o.invert();
                        var a = new e.Vector3(r,i,n);
                        this.position = e.Vector3.TransformCoordinates(a, o)
                    } else
                        this.position.x = r,
                        this.position.y = i,
                        this.position.z = n;
                    return this
                }
                ,
                r.prototype.setPositionWithLocalVector = function(t) {
                    return this.computeWorldMatrix(),
                    this.position = e.Vector3.TransformNormal(t, this._localWorld),
                    this
                }
                ,
                r.prototype.getPositionExpressedInLocalSpace = function() {
                    this.computeWorldMatrix();
                    var t = this._localWorld.clone();
                    return t.invert(),
                    e.Vector3.TransformNormal(this.position, t)
                }
                ,
                r.prototype.locallyTranslate = function(t) {
                    return this.computeWorldMatrix(!0),
                    this.position = e.Vector3.TransformCoordinates(t, this._localWorld),
                    this
                }
                ,
                r.prototype.lookAt = function(t, i, n, o, a) {
                    void 0 === i && (i = 0),
                    void 0 === n && (n = 0),
                    void 0 === o && (o = 0),
                    void 0 === a && (a = e.Space.LOCAL);
                    var s = r._lookAtVectorCache
                      , y = a === e.Space.LOCAL ? this.position : this.getAbsolutePosition();
                    t.subtractToRef(y, s);
                    var l = -Math.atan2(s.z, s.x) - Math.PI / 2
                      , c = Math.sqrt(s.x * s.x + s.z * s.z)
                      , h = Math.atan2(s.y, c);
                    return this.rotationQuaternion ? e.Quaternion.RotationYawPitchRollToRef(l + i, h + n, o, this.rotationQuaternion) : (this.rotation.x = h + n,
                    this.rotation.y = l + i,
                    this.rotation.z = o),
                    this
                }
                ,
                r.prototype.getDirection = function(t) {
                    var r = e.Vector3.Zero();
                    return this.getDirectionToRef(t, r),
                    r
                }
                ,
                r.prototype.getDirectionToRef = function(t, r) {
                    return e.Vector3.TransformNormalToRef(t, this.getWorldMatrix(), r),
                    this
                }
                ,
                r.prototype.setPivotPoint = function(t, r) {
                    void 0 === r && (r = e.Space.LOCAL),
                    0 == this.getScene().getRenderId() && this.computeWorldMatrix(!0);
                    var i = this.getWorldMatrix();
                    if (r == e.Space.WORLD) {
                        var n = e.Tmp.Matrix[0];
                        i.invertToRef(n),
                        t = e.Vector3.TransformCoordinates(t, n)
                    }
                    return this.setPivotMatrix(e.Matrix.Translation(-t.x, -t.y, -t.z), !0)
                }
                ,
                r.prototype.getPivotPoint = function() {
                    var t = e.Vector3.Zero();
                    return this.getPivotPointToRef(t),
                    t
                }
                ,
                r.prototype.getPivotPointToRef = function(e) {
                    return e.x = -this._pivotMatrix.m[12],
                    e.y = -this._pivotMatrix.m[13],
                    e.z = -this._pivotMatrix.m[14],
                    this
                }
                ,
                r.prototype.getAbsolutePivotPoint = function() {
                    var t = e.Vector3.Zero();
                    return this.getAbsolutePivotPointToRef(t),
                    t
                }
                ,
                r.prototype.getAbsolutePivotPointToRef = function(t) {
                    return t.x = this._pivotMatrix.m[12],
                    t.y = this._pivotMatrix.m[13],
                    t.z = this._pivotMatrix.m[14],
                    this.getPivotPointToRef(t),
                    e.Vector3.TransformCoordinatesToRef(t, this.getWorldMatrix(), t),
                    this
                }
                ,
                r.prototype.setParent = function(t) {
                    if (!t && !this.parent)
                        return this;
                    if (t) {
                        n = e.Tmp.Quaternion[0],
                        o = e.Tmp.Vector3[0],
                        a = e.Tmp.Vector3[1];
                        var r = e.Tmp.Matrix[0]
                          , i = e.Tmp.Matrix[1];
                        this.computeWorldMatrix(!0),
                        t.computeWorldMatrix(!0),
                        t.getWorldMatrix().invertToRef(i),
                        this.getWorldMatrix().multiplyToRef(i, r),
                        r.decompose(a, n, o),
                        this.rotationQuaternion ? this.rotationQuaternion.copyFrom(n) : n.toEulerAnglesToRef(this.rotation),
                        this.position.x = o.x,
                        this.position.y = o.y,
                        this.position.z = o.z,
                        this.scaling.x = a.x,
                        this.scaling.y = a.y,
                        this.scaling.z = a.z
                    } else {
                        var n = e.Tmp.Quaternion[0]
                          , o = e.Tmp.Vector3[0]
                          , a = e.Tmp.Vector3[1];
                        this.parent && this.parent.computeWorldMatrix && this.parent.computeWorldMatrix(!0),
                        this.computeWorldMatrix(!0),
                        this.getWorldMatrix().decompose(a, n, o),
                        this.rotationQuaternion ? this.rotationQuaternion.copyFrom(n) : n.toEulerAnglesToRef(this.rotation),
                        this.scaling.x = a.x,
                        this.scaling.y = a.y,
                        this.scaling.z = a.z,
                        this.position.x = o.x,
                        this.position.y = o.y,
                        this.position.z = o.z
                    }
                    return this.parent = t,
                    this
                }
                ,
                Object.defineProperty(r.prototype, "nonUniformScaling", {
                    get: function() {
                        return this._nonUniformScaling
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._updateNonUniformScalingState = function(e) {
                    return this._nonUniformScaling !== e && (this._nonUniformScaling = e,
                    !0)
                }
                ,
                r.prototype.attachToBone = function(e, t) {
                    return this._transformToBoneReferal = t,
                    this.parent = e,
                    e.getWorldMatrix().determinant() < 0 && (this.scalingDeterminant *= -1),
                    this
                }
                ,
                r.prototype.detachFromBone = function() {
                    return this.parent ? (this.parent.getWorldMatrix().determinant() < 0 && (this.scalingDeterminant *= -1),
                    this._transformToBoneReferal = null,
                    this.parent = null,
                    this) : this
                }
                ,
                r.prototype.rotate = function(t, i, n) {
                    var o;
                    if (t.normalize(),
                    this.rotationQuaternion || (this.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z),
                    this.rotation = e.Vector3.Zero()),
                    n && n !== e.Space.LOCAL) {
                        if (this.parent) {
                            var a = this.parent.getWorldMatrix().clone();
                            a.invert(),
                            t = e.Vector3.TransformNormal(t, a)
                        }
                        (o = e.Quaternion.RotationAxisToRef(t, i, r._rotationAxisCache)).multiplyToRef(this.rotationQuaternion, this.rotationQuaternion)
                    } else
                        o = e.Quaternion.RotationAxisToRef(t, i, r._rotationAxisCache),
                        this.rotationQuaternion.multiplyToRef(o, this.rotationQuaternion);
                    return this
                }
                ,
                r.prototype.rotateAround = function(t, r, i) {
                    return r.normalize(),
                    this.rotationQuaternion || (this.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z),
                    this.rotation.copyFromFloats(0, 0, 0)),
                    t.subtractToRef(this.position, e.Tmp.Vector3[0]),
                    e.Matrix.TranslationToRef(e.Tmp.Vector3[0].x, e.Tmp.Vector3[0].y, e.Tmp.Vector3[0].z, e.Tmp.Matrix[0]),
                    e.Tmp.Matrix[0].invertToRef(e.Tmp.Matrix[2]),
                    e.Matrix.RotationAxisToRef(r, i, e.Tmp.Matrix[1]),
                    e.Tmp.Matrix[2].multiplyToRef(e.Tmp.Matrix[1], e.Tmp.Matrix[2]),
                    e.Tmp.Matrix[2].multiplyToRef(e.Tmp.Matrix[0], e.Tmp.Matrix[2]),
                    e.Tmp.Matrix[2].decompose(e.Tmp.Vector3[0], e.Tmp.Quaternion[0], e.Tmp.Vector3[1]),
                    this.position.addInPlace(e.Tmp.Vector3[1]),
                    e.Tmp.Quaternion[0].multiplyToRef(this.rotationQuaternion, this.rotationQuaternion),
                    this
                }
                ,
                r.prototype.translate = function(t, r, i) {
                    var n = t.scale(r);
                    if (i && i !== e.Space.LOCAL)
                        this.setAbsolutePosition(this.getAbsolutePosition().add(n));
                    else {
                        var o = this.getPositionExpressedInLocalSpace().add(n);
                        this.setPositionWithLocalVector(o)
                    }
                    return this
                }
                ,
                r.prototype.addRotation = function(t, r, i) {
                    var n;
                    this.rotationQuaternion ? n = this.rotationQuaternion : (n = e.Tmp.Quaternion[1],
                    e.Quaternion.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, n));
                    var o = e.Tmp.Quaternion[0];
                    return e.Quaternion.RotationYawPitchRollToRef(r, t, i, o),
                    n.multiplyInPlace(o),
                    this.rotationQuaternion || n.toEulerAnglesToRef(this.rotation),
                    this
                }
                ,
                r.prototype.computeWorldMatrix = function(t) {
                    if (this._isWorldMatrixFrozen)
                        return this._worldMatrix;
                    if (!t && this.isSynchronized())
                        return this._currentRenderId = this.getScene().getRenderId(),
                        this._worldMatrix;
                    (this._updateCache(),
                    this._cache.position.copyFrom(this.position),
                    this._cache.scaling.copyFrom(this.scaling),
                    this._cache.pivotMatrixUpdated = !1,
                    this._cache.billboardMode = this.billboardMode,
                    this._currentRenderId = this.getScene().getRenderId(),
                    this._childRenderId = this.getScene().getRenderId(),
                    this._isDirty = !1,
                    e.Matrix.ScalingToRef(this.scaling.x * this.scalingDeterminant, this.scaling.y * this.scalingDeterminant, this.scaling.z * this.scalingDeterminant, e.Tmp.Matrix[1]),
                    this.rotationQuaternion) && (this.rotation.length() && (this.rotationQuaternion.multiplyInPlace(e.Quaternion.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z)),
                    this.rotation.copyFromFloats(0, 0, 0)));
                    this.rotationQuaternion ? (this.rotationQuaternion.toRotationMatrix(e.Tmp.Matrix[0]),
                    this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)) : (e.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, e.Tmp.Matrix[0]),
                    this._cache.rotation.copyFrom(this.rotation));
                    var i = this.getScene().activeCamera;
                    if (this.infiniteDistance && !this.parent && i) {
                        var n = i.getWorldMatrix();
                        e.Tmp.Vector3[0].set(n.m[12], n.m[13], n.m[14]),
                        e.Matrix.TranslationToRef(this.position.x + e.Tmp.Vector3[0].x, this.position.y + e.Tmp.Vector3[0].y, this.position.z + e.Tmp.Vector3[0].z, e.Tmp.Matrix[2])
                    } else
                        e.Matrix.TranslationToRef(this.position.x, this.position.y, this.position.z, e.Tmp.Matrix[2]);
                    if (this._pivotMatrix.multiplyToRef(e.Tmp.Matrix[1], e.Tmp.Matrix[4]),
                    e.Tmp.Matrix[4].multiplyToRef(e.Tmp.Matrix[0], e.Tmp.Matrix[5]),
                    this.billboardMode !== r.BILLBOARDMODE_NONE && i) {
                        if ((this.billboardMode & r.BILLBOARDMODE_ALL) !== r.BILLBOARDMODE_ALL) {
                            var o = e.Tmp.Vector3[3];
                            this.parent && this.parent.getWorldMatrix ? this._transformToBoneReferal ? (this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(), e.Tmp.Matrix[6]),
                            e.Vector3.TransformCoordinatesToRef(this.position, e.Tmp.Matrix[6], o)) : e.Vector3.TransformCoordinatesToRef(this.position, this.parent.getWorldMatrix(), o) : o.copyFrom(this.position),
                            o.subtractInPlace(i.globalPosition);
                            var a = e.Tmp.Vector3[4].copyFromFloats(0, 0, 0);
                            (this.billboardMode & r.BILLBOARDMODE_X) === r.BILLBOARDMODE_X && (a.x = Math.atan2(-o.y, o.z)),
                            (this.billboardMode & r.BILLBOARDMODE_Y) === r.BILLBOARDMODE_Y && (a.y = Math.atan2(o.x, o.z)),
                            (this.billboardMode & r.BILLBOARDMODE_Z) === r.BILLBOARDMODE_Z && (a.z = Math.atan2(o.y, o.x)),
                            e.Matrix.RotationYawPitchRollToRef(a.y, a.x, a.z, e.Tmp.Matrix[0])
                        } else
                            e.Tmp.Matrix[1].copyFrom(i.getViewMatrix()),
                            e.Tmp.Matrix[1].setTranslationFromFloats(0, 0, 0),
                            e.Tmp.Matrix[1].invertToRef(e.Tmp.Matrix[0]);
                        e.Tmp.Matrix[1].copyFrom(e.Tmp.Matrix[5]),
                        e.Tmp.Matrix[1].multiplyToRef(e.Tmp.Matrix[0], e.Tmp.Matrix[5])
                    }
                    return this._postMultiplyPivotMatrix && e.Tmp.Matrix[5].multiplyToRef(this._pivotMatrixInverse, e.Tmp.Matrix[5]),
                    e.Tmp.Matrix[5].multiplyToRef(e.Tmp.Matrix[2], this._localWorld),
                    this.parent && this.parent.getWorldMatrix ? (this.billboardMode !== r.BILLBOARDMODE_NONE ? (this._transformToBoneReferal ? (this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(), e.Tmp.Matrix[6]),
                    e.Tmp.Matrix[5].copyFrom(e.Tmp.Matrix[6])) : e.Tmp.Matrix[5].copyFrom(this.parent.getWorldMatrix()),
                    this._localWorld.getTranslationToRef(e.Tmp.Vector3[5]),
                    e.Vector3.TransformCoordinatesToRef(e.Tmp.Vector3[5], e.Tmp.Matrix[5], e.Tmp.Vector3[5]),
                    this._worldMatrix.copyFrom(this._localWorld),
                    this._worldMatrix.setTranslation(e.Tmp.Vector3[5])) : this._transformToBoneReferal ? (this._localWorld.multiplyToRef(this.parent.getWorldMatrix(), e.Tmp.Matrix[6]),
                    e.Tmp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(), this._worldMatrix)) : this._localWorld.multiplyToRef(this.parent.getWorldMatrix(), this._worldMatrix),
                    this._markSyncedWithParent()) : this._worldMatrix.copyFrom(this._localWorld),
                    this.ignoreNonUniformScaling ? this._updateNonUniformScalingState(!1) : this.scaling.isNonUniform ? this._updateNonUniformScalingState(!0) : this.parent && this.parent._nonUniformScaling ? this._updateNonUniformScalingState(this.parent._nonUniformScaling) : this._updateNonUniformScalingState(!1),
                    this._afterComputeWorldMatrix(),
                    this._absolutePosition.copyFromFloats(this._worldMatrix.m[12], this._worldMatrix.m[13], this._worldMatrix.m[14]),
                    this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),
                    this._poseMatrix || (this._poseMatrix = e.Matrix.Invert(this._worldMatrix)),
                    this._worldMatrixDeterminant = this._worldMatrix.determinant(),
                    this._worldMatrix
                }
                ,
                r.prototype._afterComputeWorldMatrix = function() {}
                ,
                r.prototype.registerAfterWorldMatrixUpdate = function(e) {
                    return this.onAfterWorldMatrixUpdateObservable.add(e),
                    this
                }
                ,
                r.prototype.unregisterAfterWorldMatrixUpdate = function(e) {
                    return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),
                    this
                }
                ,
                r.prototype.clone = function(t, i, n) {
                    var o = this
                      , a = e.SerializationHelper.Clone((function() {
                        return new r(t,o.getScene())
                    }
                    ), this);
                    if (a.name = t,
                    a.id = t,
                    i && (a.parent = i),
                    !n)
                        for (var s = this.getDescendants(!0), y = 0; y < s.length; y++) {
                            var l = s[y];
                            l.clone && l.clone(t + "." + l.name, a)
                        }
                    return a
                }
                ,
                r.prototype.serialize = function(t) {
                    var r = e.SerializationHelper.Serialize(this, t);
                    return r.type = this.getClassName(),
                    this.parent && (r.parentId = this.parent.id),
                    e.Tags && e.Tags.HasTags(this) && (r.tags = e.Tags.GetTags(this)),
                    r.localMatrix = this.getPivotMatrix().asArray(),
                    r.isEnabled = this.isEnabled(),
                    this.parent && (r.parentId = this.parent.id),
                    r
                }
                ,
                r.Parse = function(t, i, n) {
                    var o = e.SerializationHelper.Parse((function() {
                        return new r(t.name,i)
                    }
                    ), t, i, n);
                    return e.Tags && e.Tags.AddTagsTo(o, t.tags),
                    t.localMatrix ? o.setPreTransformMatrix(e.Matrix.FromArray(t.localMatrix)) : t.pivotMatrix && o.setPivotMatrix(e.Matrix.FromArray(t.pivotMatrix)),
                    o.setEnabled(t.isEnabled),
                    t.parentId && (o._waitingParentId = t.parentId),
                    o
                }
                ,
                r.prototype.dispose = function(e, r) {
                    void 0 === r && (r = !1),
                    this.getScene().stopAnimation(this),
                    this.getScene().removeTransformNode(this),
                    this.onAfterWorldMatrixUpdateObservable.clear(),
                    t.prototype.dispose.call(this, e, r)
                }
                ,
                r.BILLBOARDMODE_NONE = 0,
                r.BILLBOARDMODE_X = 1,
                r.BILLBOARDMODE_Y = 2,
                r.BILLBOARDMODE_Z = 4,
                r.BILLBOARDMODE_ALL = 7,
                r._lookAtVectorCache = new e.Vector3(0,0,0),
                r._rotationAxisCache = new e.Quaternion,
                n([e.serializeAsVector3("position")], r.prototype, "_position", void 0),
                n([e.serializeAsVector3("rotation")], r.prototype, "_rotation", void 0),
                n([e.serializeAsQuaternion("rotationQuaternion")], r.prototype, "_rotationQuaternion", void 0),
                n([e.serializeAsVector3("scaling")], r.prototype, "_scaling", void 0),
                n([e.serialize()], r.prototype, "billboardMode", void 0),
                n([e.serialize()], r.prototype, "scalingDeterminant", void 0),
                n([e.serialize()], r.prototype, "infiniteDistance", void 0),
                n([e.serialize()], r.prototype, "ignoreNonUniformScaling", void 0),
                r
            }(e.Node);
            e.TransformNode = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                this.facetNb = 0,
                this.partitioningSubdivisions = 10,
                this.partitioningBBoxRatio = 1.01,
                this.facetDataEnabled = !1,
                this.facetParameters = {},
                this.bbSize = e.Vector3.Zero(),
                this.subDiv = {
                    max: 1,
                    X: 1,
                    Y: 1,
                    Z: 1
                },
                this.facetDepthSort = !1,
                this.facetDepthSortEnabled = !1
            }
              , r = function(r) {
                function i(n, o) {
                    void 0 === o && (o = null);
                    var a = r.call(this, n, o, !1) || this;
                    return a._facetData = new t,
                    a.cullingStrategy = i.CULLINGSTRATEGY_STANDARD,
                    a.onCollideObservable = new e.Observable,
                    a.onCollisionPositionChangeObservable = new e.Observable,
                    a.onMaterialChangedObservable = new e.Observable,
                    a.definedFacingForward = !0,
                    a._visibility = 1,
                    a.alphaIndex = Number.MAX_VALUE,
                    a.isVisible = !0,
                    a.isPickable = !0,
                    a.showSubMeshesBoundingBox = !1,
                    a.isBlocker = !1,
                    a.enablePointerMoveEvents = !1,
                    a.renderingGroupId = 0,
                    a._receiveShadows = !1,
                    a.outlineColor = e.Color3.Red(),
                    a.outlineWidth = .02,
                    a.overlayColor = e.Color3.Red(),
                    a.overlayAlpha = .5,
                    a._hasVertexAlpha = !1,
                    a._useVertexColors = !0,
                    a._computeBonesUsingShaders = !0,
                    a._numBoneInfluencers = 4,
                    a._applyFog = !0,
                    a.useOctreeForRenderingSelection = !0,
                    a.useOctreeForPicking = !0,
                    a.useOctreeForCollisions = !0,
                    a._layerMask = 268435455,
                    a.alwaysSelectAsActiveMesh = !1,
                    a.actionManager = null,
                    a._checkCollisions = !1,
                    a._collisionMask = -1,
                    a._collisionGroup = -1,
                    a.ellipsoid = new e.Vector3(.5,1,.5),
                    a.ellipsoidOffset = new e.Vector3(0,0,0),
                    a._oldPositionForCollisions = new e.Vector3(0,0,0),
                    a._diffPositionForCollisions = new e.Vector3(0,0,0),
                    a.edgesWidth = 1,
                    a.edgesColor = new e.Color4(1,0,0,1),
                    a._renderId = 0,
                    a._intersectionsInProgress = new Array,
                    a._unIndexed = !1,
                    a._lightSources = new Array,
                    a.onRebuildObservable = new e.Observable,
                    a._onCollisionPositionChange = function(t, r, i) {
                        void 0 === i && (i = null),
                        a.getScene().workerCollisions && r.multiplyInPlace(a._collider._radius),
                        r.subtractToRef(a._oldPositionForCollisions, a._diffPositionForCollisions),
                        a._diffPositionForCollisions.length() > e.Engine.CollisionsEpsilon && a.position.addInPlace(a._diffPositionForCollisions),
                        i && a.onCollideObservable.notifyObservers(i),
                        a.onCollisionPositionChangeObservable.notifyObservers(a.position)
                    }
                    ,
                    a.getScene().addMesh(a),
                    a._resyncLightSources(),
                    a
                }
                return o(i, r),
                Object.defineProperty(i, "BILLBOARDMODE_NONE", {
                    get: function() {
                        return e.TransformNode.BILLBOARDMODE_NONE
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "BILLBOARDMODE_X", {
                    get: function() {
                        return e.TransformNode.BILLBOARDMODE_X
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "BILLBOARDMODE_Y", {
                    get: function() {
                        return e.TransformNode.BILLBOARDMODE_Y
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "BILLBOARDMODE_Z", {
                    get: function() {
                        return e.TransformNode.BILLBOARDMODE_Z
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "BILLBOARDMODE_ALL", {
                    get: function() {
                        return e.TransformNode.BILLBOARDMODE_ALL
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "facetNb", {
                    get: function() {
                        return this._facetData.facetNb
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "partitioningSubdivisions", {
                    get: function() {
                        return this._facetData.partitioningSubdivisions
                    },
                    set: function(e) {
                        this._facetData.partitioningSubdivisions = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "partitioningBBoxRatio", {
                    get: function() {
                        return this._facetData.partitioningBBoxRatio
                    },
                    set: function(e) {
                        this._facetData.partitioningBBoxRatio = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "mustDepthSortFacets", {
                    get: function() {
                        return this._facetData.facetDepthSort
                    },
                    set: function(e) {
                        this._facetData.facetDepthSort = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "facetDepthSortFrom", {
                    get: function() {
                        return this._facetData.facetDepthSortFrom
                    },
                    set: function(e) {
                        this._facetData.facetDepthSortFrom = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "isFacetDataEnabled", {
                    get: function() {
                        return this._facetData.facetDataEnabled
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype._updateNonUniformScalingState = function(e) {
                    return !!r.prototype._updateNonUniformScalingState.call(this, e) && (this._markSubMeshesAsMiscDirty(),
                    !0)
                }
                ,
                Object.defineProperty(i.prototype, "onCollide", {
                    set: function(e) {
                        this._onCollideObserver && this.onCollideObservable.remove(this._onCollideObserver),
                        this._onCollideObserver = this.onCollideObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "onCollisionPositionChange", {
                    set: function(e) {
                        this._onCollisionPositionChangeObserver && this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver),
                        this._onCollisionPositionChangeObserver = this.onCollisionPositionChangeObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "visibility", {
                    get: function() {
                        return this._visibility
                    },
                    set: function(e) {
                        this._visibility !== e && (this._visibility = e,
                        this._markSubMeshesAsMiscDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "material", {
                    get: function() {
                        return this._material
                    },
                    set: function(e) {
                        this._material !== e && (this._material = e,
                        this.onMaterialChangedObservable.hasObservers && this.onMaterialChangedObservable.notifyObservers(this),
                        this.subMeshes && this._unBindEffect())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "receiveShadows", {
                    get: function() {
                        return this._receiveShadows
                    },
                    set: function(e) {
                        this._receiveShadows !== e && (this._receiveShadows = e,
                        this._markSubMeshesAsLightDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "hasVertexAlpha", {
                    get: function() {
                        return this._hasVertexAlpha
                    },
                    set: function(e) {
                        this._hasVertexAlpha !== e && (this._hasVertexAlpha = e,
                        this._markSubMeshesAsAttributesDirty(),
                        this._markSubMeshesAsMiscDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "useVertexColors", {
                    get: function() {
                        return this._useVertexColors
                    },
                    set: function(e) {
                        this._useVertexColors !== e && (this._useVertexColors = e,
                        this._markSubMeshesAsAttributesDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "computeBonesUsingShaders", {
                    get: function() {
                        return this._computeBonesUsingShaders
                    },
                    set: function(e) {
                        this._computeBonesUsingShaders !== e && (this._computeBonesUsingShaders = e,
                        this._markSubMeshesAsAttributesDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "numBoneInfluencers", {
                    get: function() {
                        return this._numBoneInfluencers
                    },
                    set: function(e) {
                        this._numBoneInfluencers !== e && (this._numBoneInfluencers = e,
                        this._markSubMeshesAsAttributesDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "applyFog", {
                    get: function() {
                        return this._applyFog
                    },
                    set: function(e) {
                        this._applyFog !== e && (this._applyFog = e,
                        this._markSubMeshesAsMiscDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "layerMask", {
                    get: function() {
                        return this._layerMask
                    },
                    set: function(e) {
                        e !== this._layerMask && (this._layerMask = e,
                        this._resyncLightSources())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "collisionMask", {
                    get: function() {
                        return this._collisionMask
                    },
                    set: function(e) {
                        this._collisionMask = isNaN(e) ? -1 : e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "collisionGroup", {
                    get: function() {
                        return this._collisionGroup
                    },
                    set: function(e) {
                        this._collisionGroup = isNaN(e) ? -1 : e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "_positions", {
                    get: function() {
                        return null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "skeleton", {
                    get: function() {
                        return this._skeleton
                    },
                    set: function(e) {
                        this._skeleton && this._skeleton.needInitialSkinMatrix && this._skeleton._unregisterMeshWithPoseMatrix(this),
                        e && e.needInitialSkinMatrix && e._registerMeshWithPoseMatrix(this),
                        this._skeleton = e,
                        this._skeleton || (this._bonesTransformMatrices = null),
                        this._markSubMeshesAsAttributesDirty()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getClassName = function() {
                    return "AbstractMesh"
                }
                ,
                i.prototype.toString = function(t) {
                    var r = "Name: " + this.name + ", isInstance: " + (this instanceof e.InstancedMesh ? "YES" : "NO");
                    return r += ", # of submeshes: " + (this.subMeshes ? this.subMeshes.length : 0),
                    this._skeleton && (r += ", skeleton: " + this._skeleton.name),
                    t && (r += ", billboard mode: " + ["NONE", "X", "Y", null, "Z", null, null, "ALL"][this.billboardMode],
                    r += ", freeze wrld mat: " + (this._isWorldMatrixFrozen || this._waitingFreezeWorldMatrix ? "YES" : "NO")),
                    r
                }
                ,
                i.prototype._rebuild = function() {
                    if (this.onRebuildObservable.notifyObservers(this),
                    this._occlusionQuery && (this._occlusionQuery = null),
                    this.subMeshes)
                        for (var e = 0, t = this.subMeshes; e < t.length; e++) {
                            t[e]._rebuild()
                        }
                }
                ,
                i.prototype._resyncLightSources = function() {
                    this._lightSources.length = 0;
                    for (var e = 0, t = this.getScene().lights; e < t.length; e++) {
                        var r = t[e];
                        r.isEnabled() && (r.canAffectMesh(this) && this._lightSources.push(r))
                    }
                    this._markSubMeshesAsLightDirty()
                }
                ,
                i.prototype._resyncLighSource = function(e) {
                    var t = e.isEnabled() && e.canAffectMesh(this)
                      , r = this._lightSources.indexOf(e);
                    if (-1 === r) {
                        if (!t)
                            return;
                        this._lightSources.push(e)
                    } else {
                        if (t)
                            return;
                        this._lightSources.splice(r, 1)
                    }
                    this._markSubMeshesAsLightDirty()
                }
                ,
                i.prototype._unBindEffect = function() {
                    for (var e = 0, t = this.subMeshes; e < t.length; e++) {
                        t[e].setEffect(null)
                    }
                }
                ,
                i.prototype._removeLightSource = function(e) {
                    var t = this._lightSources.indexOf(e);
                    -1 !== t && (this._lightSources.splice(t, 1),
                    this._markSubMeshesAsLightDirty())
                }
                ,
                i.prototype._markSubMeshesAsDirty = function(e) {
                    if (this.subMeshes)
                        for (var t = 0, r = this.subMeshes; t < r.length; t++) {
                            var i = r[t];
                            i._materialDefines && e(i._materialDefines)
                        }
                }
                ,
                i.prototype._markSubMeshesAsLightDirty = function() {
                    this._markSubMeshesAsDirty((function(e) {
                        return e.markAsLightDirty()
                    }
                    ))
                }
                ,
                i.prototype._markSubMeshesAsAttributesDirty = function() {
                    this._markSubMeshesAsDirty((function(e) {
                        return e.markAsAttributesDirty()
                    }
                    ))
                }
                ,
                i.prototype._markSubMeshesAsMiscDirty = function() {
                    if (this.subMeshes)
                        for (var t = 0, r = this.subMeshes; t < r.length; t++) {
                            var i = r[t].getMaterial();
                            i && i.markAsDirty(e.Material.MiscDirtyFlag)
                        }
                }
                ,
                Object.defineProperty(i.prototype, "scaling", {
                    get: function() {
                        return this._scaling
                    },
                    set: function(e) {
                        this._scaling = e,
                        this.physicsImpostor && this.physicsImpostor.forceUpdate()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "isBlocked", {
                    get: function() {
                        return !1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getLOD = function(e) {
                    return this
                }
                ,
                i.prototype.getTotalVertices = function() {
                    return 0
                }
                ,
                i.prototype.getIndices = function() {
                    return null
                }
                ,
                i.prototype.getVerticesData = function(e) {
                    return null
                }
                ,
                i.prototype.setVerticesData = function(e, t, r, i) {
                    return this
                }
                ,
                i.prototype.updateVerticesData = function(e, t, r, i) {
                    return this
                }
                ,
                i.prototype.setIndices = function(e, t) {
                    return this
                }
                ,
                i.prototype.isVerticesDataPresent = function(e) {
                    return !1
                }
                ,
                i.prototype.getBoundingInfo = function() {
                    return this._masterMesh ? this._masterMesh.getBoundingInfo() : (this._boundingInfo || this._updateBoundingInfo(),
                    this._boundingInfo)
                }
                ,
                i.prototype.normalizeToUnitCube = function(e) {
                    void 0 === e && (e = !0);
                    var t = this.getHierarchyBoundingVectors(e)
                      , r = t.max.subtract(t.min)
                      , i = Math.max(r.x, r.y, r.z);
                    if (0 === i)
                        return this;
                    var n = 1 / i;
                    return this.scaling.scaleInPlace(n),
                    this
                }
                ,
                i.prototype.setBoundingInfo = function(e) {
                    return this._boundingInfo = e,
                    this
                }
                ,
                Object.defineProperty(i.prototype, "useBones", {
                    get: function() {
                        return this.skeleton && this.getScene().skeletonsEnabled && this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind) && this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype._preActivate = function() {}
                ,
                i.prototype._preActivateForIntermediateRendering = function(e) {}
                ,
                i.prototype._activate = function(e) {
                    this._renderId = e
                }
                ,
                i.prototype.getWorldMatrix = function() {
                    return this._masterMesh ? this._masterMesh.getWorldMatrix() : r.prototype.getWorldMatrix.call(this)
                }
                ,
                i.prototype._getWorldMatrixDeterminant = function() {
                    return this._masterMesh ? this._masterMesh._getWorldMatrixDeterminant() : r.prototype._getWorldMatrixDeterminant.call(this)
                }
                ,
                i.prototype.movePOV = function(e, t, r) {
                    return this.position.addInPlace(this.calcMovePOV(e, t, r)),
                    this
                }
                ,
                i.prototype.calcMovePOV = function(t, r, i) {
                    var n = new e.Matrix;
                    (this.rotationQuaternion ? this.rotationQuaternion : e.Quaternion.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z)).toRotationMatrix(n);
                    var o = e.Vector3.Zero()
                      , a = this.definedFacingForward ? -1 : 1;
                    return e.Vector3.TransformCoordinatesFromFloatsToRef(t * a, r, i * a, n, o),
                    o
                }
                ,
                i.prototype.rotatePOV = function(e, t, r) {
                    return this.rotation.addInPlace(this.calcRotatePOV(e, t, r)),
                    this
                }
                ,
                i.prototype.calcRotatePOV = function(t, r, i) {
                    var n = this.definedFacingForward ? 1 : -1;
                    return new e.Vector3(t * n,r,i * n)
                }
                ,
                i.prototype.getHierarchyBoundingVectors = function(t, r) {
                    var i, n;
                    void 0 === t && (t = !0),
                    void 0 === r && (r = null),
                    this.getScene().incrementRenderId(),
                    this.computeWorldMatrix(!0);
                    var o = this.getBoundingInfo();
                    if (this.subMeshes ? (i = o.boundingBox.minimumWorld,
                    n = o.boundingBox.maximumWorld) : (i = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),
                    n = new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)),
                    t)
                        for (var a = 0, s = this.getDescendants(!1); a < s.length; a++) {
                            var y = s[a];
                            if (y.computeWorldMatrix(!0),
                            (!r || r(y)) && y.getBoundingInfo && 0 !== y.getTotalVertices()) {
                                var l = y.getBoundingInfo().boundingBox
                                  , c = l.minimumWorld
                                  , h = l.maximumWorld;
                                e.Tools.CheckExtends(c, i, n),
                                e.Tools.CheckExtends(h, i, n)
                            }
                        }
                    return {
                        min: i,
                        max: n
                    }
                }
                ,
                i.prototype._updateBoundingInfo = function() {
                    return this._boundingInfo = this._boundingInfo || new e.BoundingInfo(this.absolutePosition,this.absolutePosition),
                    this._boundingInfo.update(this.worldMatrixFromCache),
                    this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),
                    this
                }
                ,
                i.prototype._updateSubMeshesBoundingInfo = function(e) {
                    if (!this.subMeshes)
                        return this;
                    for (var t = this.subMeshes.length, r = 0; r < t; r++) {
                        var i = this.subMeshes[r];
                        (t > 1 || !i.IsGlobal) && i.updateBoundingInfo(e)
                    }
                    return this
                }
                ,
                i.prototype._afterComputeWorldMatrix = function() {
                    this._updateBoundingInfo()
                }
                ,
                i.prototype.isInFrustum = function(e) {
                    return null !== this._boundingInfo && this._boundingInfo.isInFrustum(e, this.cullingStrategy)
                }
                ,
                i.prototype.isCompletelyInFrustum = function(e) {
                    return null !== this._boundingInfo && this._boundingInfo.isCompletelyInFrustum(e)
                }
                ,
                i.prototype.intersectsMesh = function(e, t, r) {
                    if (void 0 === t && (t = !1),
                    !this._boundingInfo || !e._boundingInfo)
                        return !1;
                    if (this._boundingInfo.intersects(e._boundingInfo, t))
                        return this;
                    if (r)
                        for (var i = 0, n = this.getChildMeshes(); i < n.length; i++) {
                            var o = n[i];
                            if (o.intersectsMesh(e, t, !0))
                                return o
                        }
                    return !1
                }
                ,
                i.prototype.intersectsPoint = function(e, t) {
                    return !!this._boundingInfo && this._boundingInfo.intersectsPoint(e, t)
                }
                ,
                i.prototype.getPositionInCameraSpace = function(t) {
                    return void 0 === t && (t = null),
                    t || (t = this.getScene().activeCamera),
                    e.Vector3.TransformCoordinates(this.absolutePosition, t.getViewMatrix())
                }
                ,
                i.prototype.getDistanceToCamera = function(e) {
                    return void 0 === e && (e = null),
                    e || (e = this.getScene().activeCamera),
                    this.absolutePosition.subtract(e.position).length()
                }
                ,
                Object.defineProperty(i.prototype, "checkCollisions", {
                    get: function() {
                        return this._checkCollisions
                    },
                    set: function(e) {
                        this._checkCollisions = e,
                        this.getScene().workerCollisions && this.getScene().collisionCoordinator.onMeshUpdated(this)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "collider", {
                    get: function() {
                        return this._collider
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.moveWithCollisions = function(t) {
                    return this.getAbsolutePosition().addToRef(this.ellipsoidOffset, this._oldPositionForCollisions),
                    this._collider || (this._collider = new e.Collider),
                    this._collider._radius = this.ellipsoid,
                    this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions, t, this._collider, 3, this, this._onCollisionPositionChange, this.uniqueId),
                    this
                }
                ,
                i.prototype._collideForSubMesh = function(t, r, i) {
                    if (this._generatePointsArray(),
                    !this._positions)
                        return this;
                    if (!t._lastColliderWorldVertices || !t._lastColliderTransformMatrix.equals(r)) {
                        t._lastColliderTransformMatrix = r.clone(),
                        t._lastColliderWorldVertices = [],
                        t._trianglePlanes = [];
                        for (var n = t.verticesStart, o = t.verticesStart + t.verticesCount, a = n; a < o; a++)
                            t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[a], r))
                    }
                    return i._collide(t._trianglePlanes, t._lastColliderWorldVertices, this.getIndices(), t.indexStart, t.indexStart + t.indexCount, t.verticesStart, !!t.getMaterial()),
                    i.collisionFound && (i.collidedMesh = this),
                    this
                }
                ,
                i.prototype._processCollisionsForSubMeshes = function(e, t) {
                    for (var r = this._scene.getCollidingSubMeshCandidates(this, e), i = r.length, n = 0; n < i; n++) {
                        var o = r.data[n];
                        i > 1 && !o._checkCollision(e) || this._collideForSubMesh(o, t, e)
                    }
                    return this
                }
                ,
                i.prototype._checkCollision = function(t) {
                    if (!this._boundingInfo || !this._boundingInfo._checkCollision(t))
                        return this;
                    var r = e.Tmp.Matrix[0]
                      , i = e.Tmp.Matrix[1];
                    return e.Matrix.ScalingToRef(1 / t._radius.x, 1 / t._radius.y, 1 / t._radius.z, r),
                    this.worldMatrixFromCache.multiplyToRef(r, i),
                    this._processCollisionsForSubMeshes(t, i),
                    this
                }
                ,
                i.prototype._generatePointsArray = function() {
                    return !1
                }
                ,
                i.prototype.intersects = function(t, r) {
                    var i = new e.PickingInfo;
                    if (!(this.subMeshes && this._boundingInfo && t.intersectsSphere(this._boundingInfo.boundingSphere) && t.intersectsBox(this._boundingInfo.boundingBox)))
                        return i;
                    if (!this._generatePointsArray())
                        return i;
                    for (var n = null, o = this._scene.getIntersectingSubMeshCandidates(this, t), a = o.length, s = 0; s < a; s++) {
                        var y = o.data[s];
                        if (!(a > 1) || y.canIntersects(t)) {
                            var l = y.intersects(t, this._positions, this.getIndices(), r);
                            if (l && (r || !n || l.distance < n.distance) && ((n = l).subMeshId = s,
                            r))
                                break
                        }
                    }
                    if (n) {
                        var c = this.getWorldMatrix()
                          , h = e.Vector3.TransformCoordinates(t.origin, c)
                          , u = t.direction.clone();
                        u = u.scale(n.distance);
                        var d = e.Vector3.TransformNormal(u, c)
                          , x = h.add(d);
                        return i.hit = !0,
                        i.distance = e.Vector3.Distance(h, x),
                        i.pickedPoint = x,
                        i.pickedMesh = this,
                        i.bu = n.bu || 0,
                        i.bv = n.bv || 0,
                        i.faceId = n.faceId,
                        i.subMeshId = n.subMeshId,
                        i
                    }
                    return i
                }
                ,
                i.prototype.clone = function(e, t, r) {
                    return null
                }
                ,
                i.prototype.releaseSubMeshes = function() {
                    if (this.subMeshes)
                        for (; this.subMeshes.length; )
                            this.subMeshes[0].dispose();
                    else
                        this.subMeshes = new Array;
                    return this
                }
                ,
                i.prototype.dispose = function(e, t) {
                    var i, n = this;
                    for (void 0 === t && (t = !1),
                    this.getScene().freeActiveMeshes(),
                    this.getScene().freeRenderingGroups(),
                    void 0 !== this.actionManager && null !== this.actionManager && (this.actionManager.dispose(),
                    this.actionManager = null),
                    this._skeleton = null,
                    i = 0; i < this._intersectionsInProgress.length; i++) {
                        var o = this._intersectionsInProgress[i]
                          , a = o._intersectionsInProgress.indexOf(this);
                        o._intersectionsInProgress.splice(a, 1)
                    }
                    this._intersectionsInProgress = [],
                    this.getScene().lights.forEach((function(e) {
                        var t = e.includedOnlyMeshes.indexOf(n);
                        -1 !== t && e.includedOnlyMeshes.splice(t, 1),
                        -1 !== (t = e.excludedMeshes.indexOf(n)) && e.excludedMeshes.splice(t, 1);
                        var r = e.getShadowGenerator();
                        if (r) {
                            var i = r.getShadowMap();
                            i && i.renderList && -1 !== (t = i.renderList.indexOf(n)) && i.renderList.splice(t, 1)
                        }
                    }
                    )),
                    "InstancedMesh" !== this.getClassName() && this.releaseSubMeshes();
                    var s = this.getScene().getEngine();
                    if (this._occlusionQuery && (this.isOcclusionQueryInProgress = !1,
                    s.deleteQuery(this._occlusionQuery),
                    this._occlusionQuery = null),
                    s.wipeCaches(),
                    this.getScene().removeMesh(this),
                    t && this.material && this.material.dispose(!1, !0),
                    !e)
                        for (i = 0; i < this.getScene().particleSystems.length; i++)
                            this.getScene().particleSystems[i].emitter === this && (this.getScene().particleSystems[i].dispose(),
                            i--);
                    this._facetData.facetDataEnabled && this.disableFacetData(),
                    this.onAfterWorldMatrixUpdateObservable.clear(),
                    this.onCollideObservable.clear(),
                    this.onCollisionPositionChangeObservable.clear(),
                    this.onRebuildObservable.clear(),
                    r.prototype.dispose.call(this, e, t)
                }
                ,
                i.prototype.addChild = function(e) {
                    return e.setParent(this),
                    this
                }
                ,
                i.prototype.removeChild = function(e) {
                    return e.setParent(null),
                    this
                }
                ,
                i.prototype._initFacetData = function() {
                    var t = this._facetData;
                    t.facetNormals || (t.facetNormals = new Array),
                    t.facetPositions || (t.facetPositions = new Array),
                    t.facetPartitioning || (t.facetPartitioning = new Array),
                    t.facetNb = this.getIndices().length / 3 | 0,
                    t.partitioningSubdivisions = t.partitioningSubdivisions ? t.partitioningSubdivisions : 10,
                    t.partitioningBBoxRatio = t.partitioningBBoxRatio ? t.partitioningBBoxRatio : 1.01;
                    for (var r = 0; r < t.facetNb; r++)
                        t.facetNormals[r] = e.Vector3.Zero(),
                        t.facetPositions[r] = e.Vector3.Zero();
                    return t.facetDataEnabled = !0,
                    this
                }
                ,
                i.prototype.updateFacetData = function() {
                    var t = this._facetData;
                    t.facetDataEnabled || this._initFacetData();
                    var r = this.getVerticesData(e.VertexBuffer.PositionKind)
                      , i = this.getIndices()
                      , n = this.getVerticesData(e.VertexBuffer.NormalKind)
                      , o = this.getBoundingInfo();
                    if (t.facetDepthSort && !t.facetDepthSortEnabled) {
                        if (t.facetDepthSortEnabled = !0,
                        i instanceof Uint16Array)
                            t.depthSortedIndices = new Uint16Array(i);
                        else if (i instanceof Uint32Array)
                            t.depthSortedIndices = new Uint32Array(i);
                        else {
                            for (var a = !1, s = 0; s < i.length; s++)
                                if (i[s] > 65535) {
                                    a = !0;
                                    break
                                }
                            t.depthSortedIndices = a ? new Uint32Array(i) : new Uint16Array(i)
                        }
                        if (t.facetDepthSortFunction = function(e, t) {
                            return t.sqDistance - e.sqDistance
                        }
                        ,
                        !t.facetDepthSortFrom) {
                            var y = this.getScene().activeCamera;
                            t.facetDepthSortFrom = y ? y.position : e.Vector3.Zero()
                        }
                        t.depthSortedFacets = [];
                        for (var l = 0; l < t.facetNb; l++) {
                            var c = {
                                ind: 3 * l,
                                sqDistance: 0
                            };
                            t.depthSortedFacets.push(c)
                        }
                        t.invertedMatrix = e.Matrix.Identity(),
                        t.facetDepthSortOrigin = e.Vector3.Zero()
                    }
                    t.bbSize.x = o.maximum.x - o.minimum.x > e.Epsilon ? o.maximum.x - o.minimum.x : e.Epsilon,
                    t.bbSize.y = o.maximum.y - o.minimum.y > e.Epsilon ? o.maximum.y - o.minimum.y : e.Epsilon,
                    t.bbSize.z = o.maximum.z - o.minimum.z > e.Epsilon ? o.maximum.z - o.minimum.z : e.Epsilon;
                    var h = t.bbSize.x > t.bbSize.y ? t.bbSize.x : t.bbSize.y;
                    if (h = h > t.bbSize.z ? h : t.bbSize.z,
                    t.subDiv.max = t.partitioningSubdivisions,
                    t.subDiv.X = Math.floor(t.subDiv.max * t.bbSize.x / h),
                    t.subDiv.Y = Math.floor(t.subDiv.max * t.bbSize.y / h),
                    t.subDiv.Z = Math.floor(t.subDiv.max * t.bbSize.z / h),
                    t.subDiv.X = t.subDiv.X < 1 ? 1 : t.subDiv.X,
                    t.subDiv.Y = t.subDiv.Y < 1 ? 1 : t.subDiv.Y,
                    t.subDiv.Z = t.subDiv.Z < 1 ? 1 : t.subDiv.Z,
                    t.facetParameters.facetNormals = this.getFacetLocalNormals(),
                    t.facetParameters.facetPositions = this.getFacetLocalPositions(),
                    t.facetParameters.facetPartitioning = this.getFacetLocalPartitioning(),
                    t.facetParameters.bInfo = o,
                    t.facetParameters.bbSize = t.bbSize,
                    t.facetParameters.subDiv = t.subDiv,
                    t.facetParameters.ratio = this.partitioningBBoxRatio,
                    t.facetParameters.depthSort = t.facetDepthSort,
                    t.facetDepthSort && t.facetDepthSortEnabled && (this.computeWorldMatrix(!0),
                    this._worldMatrix.invertToRef(t.invertedMatrix),
                    e.Vector3.TransformCoordinatesToRef(t.facetDepthSortFrom, t.invertedMatrix, t.facetDepthSortOrigin),
                    t.facetParameters.distanceTo = t.facetDepthSortOrigin),
                    t.facetParameters.depthSortedFacets = t.depthSortedFacets,
                    e.VertexData.ComputeNormals(r, i, n, t.facetParameters),
                    t.facetDepthSort && t.facetDepthSortEnabled) {
                        t.depthSortedFacets.sort(t.facetDepthSortFunction);
                        var u = t.depthSortedIndices.length / 3 | 0;
                        for (l = 0; l < u; l++) {
                            var d = t.depthSortedFacets[l].ind;
                            t.depthSortedIndices[3 * l] = i[d],
                            t.depthSortedIndices[3 * l + 1] = i[d + 1],
                            t.depthSortedIndices[3 * l + 2] = i[d + 2]
                        }
                        this.updateIndices(t.depthSortedIndices)
                    }
                    return this
                }
                ,
                i.prototype.getFacetLocalNormals = function() {
                    return this._facetData.facetNormals || this.updateFacetData(),
                    this._facetData.facetNormals
                }
                ,
                i.prototype.getFacetLocalPositions = function() {
                    return this._facetData.facetPositions || this.updateFacetData(),
                    this._facetData.facetPositions
                }
                ,
                i.prototype.getFacetLocalPartitioning = function() {
                    return this._facetData.facetPartitioning || this.updateFacetData(),
                    this._facetData.facetPartitioning
                }
                ,
                i.prototype.getFacetPosition = function(t) {
                    var r = e.Vector3.Zero();
                    return this.getFacetPositionToRef(t, r),
                    r
                }
                ,
                i.prototype.getFacetPositionToRef = function(t, r) {
                    var i = this.getFacetLocalPositions()[t]
                      , n = this.getWorldMatrix();
                    return e.Vector3.TransformCoordinatesToRef(i, n, r),
                    this
                }
                ,
                i.prototype.getFacetNormal = function(t) {
                    var r = e.Vector3.Zero();
                    return this.getFacetNormalToRef(t, r),
                    r
                }
                ,
                i.prototype.getFacetNormalToRef = function(t, r) {
                    var i = this.getFacetLocalNormals()[t];
                    return e.Vector3.TransformNormalToRef(i, this.getWorldMatrix(), r),
                    this
                }
                ,
                i.prototype.getFacetsAtLocalCoordinates = function(e, t, r) {
                    var i = this.getBoundingInfo()
                      , n = this._facetData
                      , o = Math.floor((e - i.minimum.x * n.partitioningBBoxRatio) * n.subDiv.X * n.partitioningBBoxRatio / n.bbSize.x)
                      , a = Math.floor((t - i.minimum.y * n.partitioningBBoxRatio) * n.subDiv.Y * n.partitioningBBoxRatio / n.bbSize.y)
                      , s = Math.floor((r - i.minimum.z * n.partitioningBBoxRatio) * n.subDiv.Z * n.partitioningBBoxRatio / n.bbSize.z);
                    return o < 0 || o > n.subDiv.max || a < 0 || a > n.subDiv.max || s < 0 || s > n.subDiv.max ? null : n.facetPartitioning[o + n.subDiv.max * a + n.subDiv.max * n.subDiv.max * s]
                }
                ,
                i.prototype.getClosestFacetAtCoordinates = function(t, r, i, n, o, a) {
                    void 0 === o && (o = !1),
                    void 0 === a && (a = !0);
                    var s = this.getWorldMatrix()
                      , y = e.Tmp.Matrix[5];
                    s.invertToRef(y);
                    var l = e.Tmp.Vector3[8];
                    e.Vector3.TransformCoordinatesFromFloatsToRef(t, r, i, y, l);
                    var c = this.getClosestFacetAtLocalCoordinates(l.x, l.y, l.z, n, o, a);
                    return n && e.Vector3.TransformCoordinatesFromFloatsToRef(n.x, n.y, n.z, s, n),
                    c
                }
                ,
                i.prototype.getClosestFacetAtLocalCoordinates = function(e, t, r, i, n, o) {
                    void 0 === n && (n = !1),
                    void 0 === o && (o = !0);
                    var a = null
                      , s = 0
                      , y = 0
                      , l = 0
                      , c = 0
                      , h = 0
                      , u = 0
                      , d = 0
                      , x = 0
                      , p = this.getFacetLocalPositions()
                      , f = this.getFacetLocalNormals()
                      , m = this.getFacetsAtLocalCoordinates(e, t, r);
                    if (!m)
                        return null;
                    for (var z, _, g, v = Number.MAX_VALUE, b = v, T = 0; T < m.length; T++)
                        _ = f[z = m[T]],
                        c = (e - (g = p[z]).x) * _.x + (t - g.y) * _.y + (r - g.z) * _.z,
                        (!n || n && o && c >= 0 || n && !o && c <= 0) && (c = _.x * g.x + _.y * g.y + _.z * g.z,
                        h = -(_.x * e + _.y * t + _.z * r - c) / (_.x * _.x + _.y * _.y + _.z * _.z),
                        (b = (s = (u = e + _.x * h) - e) * s + (y = (d = t + _.y * h) - t) * y + (l = (x = r + _.z * h) - r) * l) < v && (v = b,
                        a = z,
                        i && (i.x = u,
                        i.y = d,
                        i.z = x)));
                    return a
                }
                ,
                i.prototype.getFacetDataParameters = function() {
                    return this._facetData.facetParameters
                }
                ,
                i.prototype.disableFacetData = function() {
                    return this._facetData.facetDataEnabled && (this._facetData.facetDataEnabled = !1,
                    this._facetData.facetPositions = new Array,
                    this._facetData.facetNormals = new Array,
                    this._facetData.facetPartitioning = new Array,
                    this._facetData.facetParameters = null,
                    this._facetData.depthSortedIndices = new Uint32Array(0)),
                    this
                }
                ,
                i.prototype.updateIndices = function(e) {
                    return this
                }
                ,
                i.prototype.createNormals = function(t) {
                    var r, i = this.getVerticesData(e.VertexBuffer.PositionKind), n = this.getIndices();
                    return r = this.isVerticesDataPresent(e.VertexBuffer.NormalKind) ? this.getVerticesData(e.VertexBuffer.NormalKind) : [],
                    e.VertexData.ComputeNormals(i, n, r, {
                        useRightHandedSystem: this.getScene().useRightHandedSystem
                    }),
                    this.setVerticesData(e.VertexBuffer.NormalKind, r, t),
                    this
                }
                ,
                i.prototype.alignWithNormal = function(t, r) {
                    r || (r = e.Axis.Y);
                    var i = e.Tmp.Vector3[0]
                      , n = e.Tmp.Vector3[1];
                    return e.Vector3.CrossToRef(r, t, n),
                    e.Vector3.CrossToRef(t, n, i),
                    this.rotationQuaternion ? e.Quaternion.RotationQuaternionFromAxisToRef(i, t, n, this.rotationQuaternion) : e.Vector3.RotationFromAxisToRef(i, t, n, this.rotation),
                    this
                }
                ,
                i.prototype._checkOcclusionQuery = function() {
                    return !1
                }
                ,
                i.OCCLUSION_TYPE_NONE = 0,
                i.OCCLUSION_TYPE_OPTIMISTIC = 1,
                i.OCCLUSION_TYPE_STRICT = 2,
                i.OCCLUSION_ALGORITHM_TYPE_ACCURATE = 0,
                i.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE = 1,
                i.CULLINGSTRATEGY_STANDARD = 0,
                i.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY = 1,
                i
            }(e.TransformNode);
            e.AbstractMesh = r
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(i, n) {
                    var o = t.call(this, i, n) || this;
                    return o.diffuse = new e.Color3(1,1,1),
                    o.specular = new e.Color3(1,1,1),
                    o.falloffType = r.FALLOFF_DEFAULT,
                    o.intensity = 1,
                    o._range = Number.MAX_VALUE,
                    o._inverseSquaredRange = 0,
                    o._photometricScale = 1,
                    o._intensityMode = r.INTENSITYMODE_AUTOMATIC,
                    o._radius = 1e-5,
                    o.renderPriority = 0,
                    o._shadowEnabled = !0,
                    o._excludeWithLayerMask = 0,
                    o._includeOnlyWithLayerMask = 0,
                    o._lightmapMode = 0,
                    o._excludedMeshesIds = new Array,
                    o._includedOnlyMeshesIds = new Array,
                    o.getScene().addLight(o),
                    o._uniformBuffer = new e.UniformBuffer(o.getScene().getEngine()),
                    o._buildUniformLayout(),
                    o.includedOnlyMeshes = new Array,
                    o.excludedMeshes = new Array,
                    o._resyncMeshes(),
                    o
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "range", {
                    get: function() {
                        return this._range
                    },
                    set: function(e) {
                        this._range = e,
                        this._inverseSquaredRange = 1 / (this.range * this.range)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "intensityMode", {
                    get: function() {
                        return this._intensityMode
                    },
                    set: function(e) {
                        this._intensityMode = e,
                        this._computePhotometricScale()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "radius", {
                    get: function() {
                        return this._radius
                    },
                    set: function(e) {
                        this._radius = e,
                        this._computePhotometricScale()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "shadowEnabled", {
                    get: function() {
                        return this._shadowEnabled
                    },
                    set: function(e) {
                        this._shadowEnabled !== e && (this._shadowEnabled = e,
                        this._markMeshesAsLightDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "includedOnlyMeshes", {
                    get: function() {
                        return this._includedOnlyMeshes
                    },
                    set: function(e) {
                        this._includedOnlyMeshes = e,
                        this._hookArrayForIncludedOnly(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "excludedMeshes", {
                    get: function() {
                        return this._excludedMeshes
                    },
                    set: function(e) {
                        this._excludedMeshes = e,
                        this._hookArrayForExcluded(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "excludeWithLayerMask", {
                    get: function() {
                        return this._excludeWithLayerMask
                    },
                    set: function(e) {
                        this._excludeWithLayerMask = e,
                        this._resyncMeshes()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "includeOnlyWithLayerMask", {
                    get: function() {
                        return this._includeOnlyWithLayerMask
                    },
                    set: function(e) {
                        this._includeOnlyWithLayerMask = e,
                        this._resyncMeshes()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "lightmapMode", {
                    get: function() {
                        return this._lightmapMode
                    },
                    set: function(e) {
                        this._lightmapMode !== e && (this._lightmapMode = e,
                        this._markMeshesAsLightDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getClassName = function() {
                    return "Light"
                }
                ,
                r.prototype.toString = function(e) {
                    var t = "Name: " + this.name;
                    if (t += ", type: " + ["Point", "Directional", "Spot", "Hemispheric"][this.getTypeID()],
                    this.animations)
                        for (var r = 0; r < this.animations.length; r++)
                            t += ", animation[0]: " + this.animations[r].toString(e);
                    return t
                }
                ,
                r.prototype._syncParentEnabledState = function() {
                    t.prototype._syncParentEnabledState.call(this),
                    this._resyncMeshes()
                }
                ,
                r.prototype.setEnabled = function(e) {
                    t.prototype.setEnabled.call(this, e),
                    this._resyncMeshes()
                }
                ,
                r.prototype.getShadowGenerator = function() {
                    return this._shadowGenerator
                }
                ,
                r.prototype.getAbsolutePosition = function() {
                    return e.Vector3.Zero()
                }
                ,
                r.prototype.canAffectMesh = function(e) {
                    return !e || !(this.includedOnlyMeshes && this.includedOnlyMeshes.length > 0 && -1 === this.includedOnlyMeshes.indexOf(e)) && (!(this.excludedMeshes && this.excludedMeshes.length > 0 && -1 !== this.excludedMeshes.indexOf(e)) && ((0 === this.includeOnlyWithLayerMask || 0 != (this.includeOnlyWithLayerMask & e.layerMask)) && !(0 !== this.excludeWithLayerMask && this.excludeWithLayerMask & e.layerMask)))
                }
                ,
                r.CompareLightsPriority = function(e, t) {
                    return e.shadowEnabled !== t.shadowEnabled ? (t.shadowEnabled ? 1 : 0) - (e.shadowEnabled ? 1 : 0) : t.renderPriority - e.renderPriority
                }
                ,
                r.prototype.dispose = function(e, r) {
                    void 0 === r && (r = !1),
                    this._shadowGenerator && (this._shadowGenerator.dispose(),
                    this._shadowGenerator = null),
                    this.getScene().stopAnimation(this);
                    for (var i = 0, n = this.getScene().meshes; i < n.length; i++) {
                        n[i]._removeLightSource(this)
                    }
                    this._uniformBuffer.dispose(),
                    this.getScene().removeLight(this),
                    t.prototype.dispose.call(this, e, r)
                }
                ,
                r.prototype.getTypeID = function() {
                    return 0
                }
                ,
                r.prototype.getScaledIntensity = function() {
                    return this._photometricScale * this.intensity
                }
                ,
                r.prototype.clone = function(t) {
                    var i = r.GetConstructorFromName(this.getTypeID(), t, this.getScene());
                    return i ? e.SerializationHelper.Clone(i, this) : null
                }
                ,
                r.prototype.serialize = function() {
                    var t = e.SerializationHelper.Serialize(this);
                    return t.type = this.getTypeID(),
                    this.parent && (t.parentId = this.parent.id),
                    this.excludedMeshes.length > 0 && (t.excludedMeshesIds = [],
                    this.excludedMeshes.forEach((function(e) {
                        t.excludedMeshesIds.push(e.id)
                    }
                    ))),
                    this.includedOnlyMeshes.length > 0 && (t.includedOnlyMeshesIds = [],
                    this.includedOnlyMeshes.forEach((function(e) {
                        t.includedOnlyMeshesIds.push(e.id)
                    }
                    ))),
                    e.Animation.AppendSerializedAnimations(this, t),
                    t.ranges = this.serializeAnimationRanges(),
                    t
                }
                ,
                r.GetConstructorFromName = function(t, r, i) {
                    var n = e.Node.Construct("Light_Type_" + t, r, i);
                    return n || null
                }
                ,
                r.Parse = function(t, i) {
                    var n = r.GetConstructorFromName(t.type, t.name, i);
                    if (!n)
                        return null;
                    var o = e.SerializationHelper.Parse(n, t, i);
                    if (t.excludedMeshesIds && (o._excludedMeshesIds = t.excludedMeshesIds),
                    t.includedOnlyMeshesIds && (o._includedOnlyMeshesIds = t.includedOnlyMeshesIds),
                    t.parentId && (o._waitingParentId = t.parentId),
                    t.animations) {
                        for (var a = 0; a < t.animations.length; a++) {
                            var s = t.animations[a];
                            o.animations.push(e.Animation.Parse(s))
                        }
                        e.Node.ParseAnimationRanges(o, t, i)
                    }
                    return t.autoAnimate && i.beginAnimation(o, t.autoAnimateFrom, t.autoAnimateTo, t.autoAnimateLoop, t.autoAnimateSpeed || 1),
                    o
                }
                ,
                r.prototype._hookArrayForExcluded = function(e) {
                    var t = this
                      , r = e.push;
                    e.push = function() {
                        for (var i = [], n = 0; n < arguments.length; n++)
                            i[n] = arguments[n];
                        for (var o = r.apply(e, i), a = 0, s = i; a < s.length; a++) {
                            var y = s[a];
                            y._resyncLighSource(t)
                        }
                        return o
                    }
                    ;
                    var i = e.splice;
                    e.splice = function(r, n) {
                        for (var o = i.apply(e, [r, n]), a = 0, s = o; a < s.length; a++) {
                            s[a]._resyncLighSource(t)
                        }
                        return o
                    }
                    ;
                    for (var n = 0, o = e; n < o.length; n++) {
                        o[n]._resyncLighSource(this)
                    }
                }
                ,
                r.prototype._hookArrayForIncludedOnly = function(e) {
                    var t = this
                      , r = e.push;
                    e.push = function() {
                        for (var i = [], n = 0; n < arguments.length; n++)
                            i[n] = arguments[n];
                        var o = r.apply(e, i);
                        return t._resyncMeshes(),
                        o
                    }
                    ;
                    var i = e.splice;
                    e.splice = function(r, n) {
                        var o = i.apply(e, [r, n]);
                        return t._resyncMeshes(),
                        o
                    }
                    ,
                    this._resyncMeshes()
                }
                ,
                r.prototype._resyncMeshes = function() {
                    for (var e = 0, t = this.getScene().meshes; e < t.length; e++) {
                        t[e]._resyncLighSource(this)
                    }
                }
                ,
                r.prototype._markMeshesAsLightDirty = function() {
                    for (var e = 0, t = this.getScene().meshes; e < t.length; e++) {
                        var r = t[e];
                        -1 !== r._lightSources.indexOf(this) && r._markSubMeshesAsLightDirty()
                    }
                }
                ,
                r.prototype._computePhotometricScale = function() {
                    this._photometricScale = this._getPhotometricScale(),
                    this.getScene().resetCachedMaterial()
                }
                ,
                r.prototype._getPhotometricScale = function() {
                    var e = 0
                      , t = this.getTypeID()
                      , i = this.intensityMode;
                    switch (i === r.INTENSITYMODE_AUTOMATIC && (i = t === r.LIGHTTYPEID_DIRECTIONALLIGHT ? r.INTENSITYMODE_ILLUMINANCE : r.INTENSITYMODE_LUMINOUSINTENSITY),
                    t) {
                    case r.LIGHTTYPEID_POINTLIGHT:
                    case r.LIGHTTYPEID_SPOTLIGHT:
                        switch (i) {
                        case r.INTENSITYMODE_LUMINOUSPOWER:
                            e = 1 / (4 * Math.PI);
                            break;
                        case r.INTENSITYMODE_LUMINOUSINTENSITY:
                            e = 1;
                            break;
                        case r.INTENSITYMODE_LUMINANCE:
                            e = this.radius * this.radius
                        }
                        break;
                    case r.LIGHTTYPEID_DIRECTIONALLIGHT:
                        switch (i) {
                        case r.INTENSITYMODE_ILLUMINANCE:
                            e = 1;
                            break;
                        case r.INTENSITYMODE_LUMINANCE:
                            var n = this.radius;
                            n = Math.max(n, .001),
                            e = 2 * Math.PI * (1 - Math.cos(n))
                        }
                        break;
                    case r.LIGHTTYPEID_HEMISPHERICLIGHT:
                        e = 1
                    }
                    return e
                }
                ,
                r.prototype._reorderLightsInScene = function() {
                    var e = this.getScene();
                    0 != this._renderPriority && (e.requireLightSorting = !0),
                    this.getScene().sortLightsByPriority()
                }
                ,
                r.FALLOFF_DEFAULT = 0,
                r.FALLOFF_PHYSICAL = 1,
                r.FALLOFF_GLTF = 2,
                r.FALLOFF_STANDARD = 3,
                r.LIGHTMAP_DEFAULT = 0,
                r.LIGHTMAP_SPECULAR = 1,
                r.LIGHTMAP_SHADOWSONLY = 2,
                r.INTENSITYMODE_AUTOMATIC = 0,
                r.INTENSITYMODE_LUMINOUSPOWER = 1,
                r.INTENSITYMODE_LUMINOUSINTENSITY = 2,
                r.INTENSITYMODE_ILLUMINANCE = 3,
                r.INTENSITYMODE_LUMINANCE = 4,
                r.LIGHTTYPEID_POINTLIGHT = 0,
                r.LIGHTTYPEID_DIRECTIONALLIGHT = 1,
                r.LIGHTTYPEID_SPOTLIGHT = 2,
                r.LIGHTTYPEID_HEMISPHERICLIGHT = 3,
                n([e.serializeAsColor3()], r.prototype, "diffuse", void 0),
                n([e.serializeAsColor3()], r.prototype, "specular", void 0),
                n([e.serialize()], r.prototype, "falloffType", void 0),
                n([e.serialize()], r.prototype, "intensity", void 0),
                n([e.serialize()], r.prototype, "range", null),
                n([e.serialize()], r.prototype, "intensityMode", null),
                n([e.serialize()], r.prototype, "radius", null),
                n([e.serialize()], r.prototype, "_renderPriority", void 0),
                n([e.expandToProperty("_reorderLightsInScene")], r.prototype, "renderPriority", void 0),
                n([e.serialize("shadowEnabled")], r.prototype, "_shadowEnabled", void 0),
                n([e.serialize("excludeWithLayerMask")], r.prototype, "_excludeWithLayerMask", void 0),
                n([e.serialize("includeOnlyWithLayerMask")], r.prototype, "_includeOnlyWithLayerMask", void 0),
                n([e.serialize("lightmapMode")], r.prototype, "_lightmapMode", void 0),
                r
            }(e.Node);
            e.Light = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(i, n, o, a) {
                    void 0 === a && (a = !0);
                    var s = t.call(this, i, o) || this;
                    return s.upVector = e.Vector3.Up(),
                    s.orthoLeft = null,
                    s.orthoRight = null,
                    s.orthoBottom = null,
                    s.orthoTop = null,
                    s.fov = .8,
                    s.minZ = 1,
                    s.maxZ = 1e4,
                    s.inertia = .9,
                    s.mode = r.PERSPECTIVE_CAMERA,
                    s.isIntermediate = !1,
                    s.viewport = new e.Viewport(0,0,1,1),
                    s.layerMask = 268435455,
                    s.fovMode = r.FOVMODE_VERTICAL_FIXED,
                    s.cameraRigMode = r.RIG_MODE_NONE,
                    s.customRenderTargets = new Array,
                    s.onViewMatrixChangedObservable = new e.Observable,
                    s.onProjectionMatrixChangedObservable = new e.Observable,
                    s.onAfterCheckInputsObservable = new e.Observable,
                    s.onRestoreStateObservable = new e.Observable,
                    s._rigCameras = new Array,
                    s._webvrViewMatrix = e.Matrix.Identity(),
                    s._skipRendering = !1,
                    s._projectionMatrix = new e.Matrix,
                    s._postProcesses = new Array,
                    s._activeMeshes = new e.SmartArray(256),
                    s._globalPosition = e.Vector3.Zero(),
                    s._computedViewMatrix = e.Matrix.Identity(),
                    s._doNotComputeProjectionMatrix = !1,
                    s._transformMatrix = e.Matrix.Zero(),
                    s._refreshFrustumPlanes = !0,
                    s.autoClear = !0,
                    s.getScene().addCamera(s),
                    a && !s.getScene().activeCamera && (s.getScene().activeCamera = s),
                    s.position = n,
                    s
                }
                return o(r, t),
                r.prototype.storeState = function() {
                    return this._stateStored = !0,
                    this._storedFov = this.fov,
                    this
                }
                ,
                r.prototype._restoreStateValues = function() {
                    return !!this._stateStored && (this.fov = this._storedFov,
                    !0)
                }
                ,
                r.prototype.restoreState = function() {
                    return !!this._restoreStateValues() && (this.onRestoreStateObservable.notifyObservers(this),
                    !0)
                }
                ,
                r.prototype.getClassName = function() {
                    return "Camera"
                }
                ,
                r.prototype.toString = function(e) {
                    var t = "Name: " + this.name;
                    if (t += ", type: " + this.getClassName(),
                    this.animations)
                        for (var r = 0; r < this.animations.length; r++)
                            t += ", animation[0]: " + this.animations[r].toString(e);
                    return t
                }
                ,
                Object.defineProperty(r.prototype, "globalPosition", {
                    get: function() {
                        return this._globalPosition
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getActiveMeshes = function() {
                    return this._activeMeshes
                }
                ,
                r.prototype.isActiveMesh = function(e) {
                    return -1 !== this._activeMeshes.indexOf(e)
                }
                ,
                r.prototype.isReady = function(e) {
                    if (void 0 === e && (e = !1),
                    e)
                        for (var r = 0, i = this._postProcesses; r < i.length; r++) {
                            var n = i[r];
                            if (n && !n.isReady())
                                return !1
                        }
                    return t.prototype.isReady.call(this, e)
                }
                ,
                r.prototype._initCache = function() {
                    t.prototype._initCache.call(this),
                    this._cache.position = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),
                    this._cache.upVector = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),
                    this._cache.mode = void 0,
                    this._cache.minZ = void 0,
                    this._cache.maxZ = void 0,
                    this._cache.fov = void 0,
                    this._cache.fovMode = void 0,
                    this._cache.aspectRatio = void 0,
                    this._cache.orthoLeft = void 0,
                    this._cache.orthoRight = void 0,
                    this._cache.orthoBottom = void 0,
                    this._cache.orthoTop = void 0,
                    this._cache.renderWidth = void 0,
                    this._cache.renderHeight = void 0
                }
                ,
                r.prototype._updateCache = function(e) {
                    e || t.prototype._updateCache.call(this),
                    this._cache.position.copyFrom(this.position),
                    this._cache.upVector.copyFrom(this.upVector)
                }
                ,
                r.prototype._isSynchronized = function() {
                    return this._isSynchronizedViewMatrix() && this._isSynchronizedProjectionMatrix()
                }
                ,
                r.prototype._isSynchronizedViewMatrix = function() {
                    return !!t.prototype._isSynchronized.call(this) && (this._cache.position.equals(this.position) && this._cache.upVector.equals(this.upVector) && this.isSynchronizedWithParent())
                }
                ,
                r.prototype._isSynchronizedProjectionMatrix = function() {
                    var e = this._cache.mode === this.mode && this._cache.minZ === this.minZ && this._cache.maxZ === this.maxZ;
                    if (!e)
                        return !1;
                    var t = this.getEngine();
                    return e = this.mode === r.PERSPECTIVE_CAMERA ? this._cache.fov === this.fov && this._cache.fovMode === this.fovMode && this._cache.aspectRatio === t.getAspectRatio(this) : this._cache.orthoLeft === this.orthoLeft && this._cache.orthoRight === this.orthoRight && this._cache.orthoBottom === this.orthoBottom && this._cache.orthoTop === this.orthoTop && this._cache.renderWidth === t.getRenderWidth() && this._cache.renderHeight === t.getRenderHeight()
                }
                ,
                r.prototype.attachControl = function(e, t) {}
                ,
                r.prototype.detachControl = function(e) {}
                ,
                r.prototype.update = function() {
                    this._checkInputs(),
                    this.cameraRigMode !== r.RIG_MODE_NONE && this._updateRigCameras()
                }
                ,
                r.prototype._checkInputs = function() {
                    this.onAfterCheckInputsObservable.notifyObservers(this)
                }
                ,
                Object.defineProperty(r.prototype, "rigCameras", {
                    get: function() {
                        return this._rigCameras
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "rigPostProcess", {
                    get: function() {
                        return this._rigPostProcess
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._getFirstPostProcess = function() {
                    for (var e = 0; e < this._postProcesses.length; e++)
                        if (null !== this._postProcesses[e])
                            return this._postProcesses[e];
                    return null
                }
                ,
                r.prototype._cascadePostProcessesToRigCams = function() {
                    var t = this._getFirstPostProcess();
                    t && t.markTextureDirty();
                    for (var r = 0, i = this._rigCameras.length; r < i; r++) {
                        var n = this._rigCameras[r]
                          , o = n._rigPostProcess;
                        if (o)
                            o instanceof e.PassPostProcess && (n.isIntermediate = 0 === this._postProcesses.length),
                            n._postProcesses = this._postProcesses.slice(0).concat(o),
                            o.markTextureDirty();
                        else
                            n._postProcesses = this._postProcesses.slice(0)
                    }
                }
                ,
                r.prototype.attachPostProcess = function(t, r) {
                    return void 0 === r && (r = null),
                    !t.isReusable() && this._postProcesses.indexOf(t) > -1 ? (e.Tools.Error("You're trying to reuse a post process not defined as reusable."),
                    0) : (null == r || r < 0 ? this._postProcesses.push(t) : null === this._postProcesses[r] ? this._postProcesses[r] = t : this._postProcesses.splice(r, 0, t),
                    this._cascadePostProcessesToRigCams(),
                    this._postProcesses.indexOf(t))
                }
                ,
                r.prototype.detachPostProcess = function(e) {
                    var t = this._postProcesses.indexOf(e);
                    -1 !== t && (this._postProcesses[t] = null),
                    this._cascadePostProcessesToRigCams()
                }
                ,
                r.prototype.getWorldMatrix = function() {
                    return this._isSynchronizedViewMatrix() ? this._worldMatrix : (this.getViewMatrix(),
                    this._worldMatrix)
                }
                ,
                r.prototype._getViewMatrix = function() {
                    return e.Matrix.Identity()
                }
                ,
                r.prototype.getViewMatrix = function(e) {
                    return !e && this._isSynchronizedViewMatrix() ? this._computedViewMatrix : (this.updateCache(),
                    this._computedViewMatrix = this._getViewMatrix(),
                    this._currentRenderId = this.getScene().getRenderId(),
                    this._childRenderId = this._currentRenderId,
                    this._refreshFrustumPlanes = !0,
                    this._cameraRigParams && this._cameraRigParams.vrPreViewMatrix && this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix, this._computedViewMatrix),
                    this.onViewMatrixChangedObservable.notifyObservers(this),
                    this._computedViewMatrix.invertToRef(this._worldMatrix),
                    this._computedViewMatrix)
                }
                ,
                r.prototype.freezeProjectionMatrix = function(e) {
                    this._doNotComputeProjectionMatrix = !0,
                    void 0 !== e && (this._projectionMatrix = e)
                }
                ,
                r.prototype.unfreezeProjectionMatrix = function() {
                    this._doNotComputeProjectionMatrix = !1
                }
                ,
                r.prototype.getProjectionMatrix = function(t) {
                    if (this._doNotComputeProjectionMatrix || !t && this._isSynchronizedProjectionMatrix())
                        return this._projectionMatrix;
                    this._cache.mode = this.mode,
                    this._cache.minZ = this.minZ,
                    this._cache.maxZ = this.maxZ,
                    this._refreshFrustumPlanes = !0;
                    var i = this.getEngine()
                      , n = this.getScene();
                    if (this.mode === r.PERSPECTIVE_CAMERA)
                        this._cache.fov = this.fov,
                        this._cache.fovMode = this.fovMode,
                        this._cache.aspectRatio = i.getAspectRatio(this),
                        this.minZ <= 0 && (this.minZ = .1),
                        n.useRightHandedSystem ? e.Matrix.PerspectiveFovRHToRef(this.fov, i.getAspectRatio(this), this.minZ, this.maxZ, this._projectionMatrix, this.fovMode === r.FOVMODE_VERTICAL_FIXED) : e.Matrix.PerspectiveFovLHToRef(this.fov, i.getAspectRatio(this), this.minZ, this.maxZ, this._projectionMatrix, this.fovMode === r.FOVMODE_VERTICAL_FIXED);
                    else {
                        var o = i.getRenderWidth() / 2
                          , a = i.getRenderHeight() / 2;
                        n.useRightHandedSystem ? e.Matrix.OrthoOffCenterRHToRef(this.orthoLeft || -o, this.orthoRight || o, this.orthoBottom || -a, this.orthoTop || a, this.minZ, this.maxZ, this._projectionMatrix) : e.Matrix.OrthoOffCenterLHToRef(this.orthoLeft || -o, this.orthoRight || o, this.orthoBottom || -a, this.orthoTop || a, this.minZ, this.maxZ, this._projectionMatrix),
                        this._cache.orthoLeft = this.orthoLeft,
                        this._cache.orthoRight = this.orthoRight,
                        this._cache.orthoBottom = this.orthoBottom,
                        this._cache.orthoTop = this.orthoTop,
                        this._cache.renderWidth = i.getRenderWidth(),
                        this._cache.renderHeight = i.getRenderHeight()
                    }
                    return this.onProjectionMatrixChangedObservable.notifyObservers(this),
                    this._projectionMatrix
                }
                ,
                r.prototype.getTransformationMatrix = function() {
                    return this._computedViewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix),
                    this._transformMatrix
                }
                ,
                r.prototype._updateFrustumPlanes = function() {
                    this._refreshFrustumPlanes && (this.getTransformationMatrix(),
                    this._frustumPlanes ? e.Frustum.GetPlanesToRef(this._transformMatrix, this._frustumPlanes) : this._frustumPlanes = e.Frustum.GetPlanes(this._transformMatrix),
                    this._refreshFrustumPlanes = !1)
                }
                ,
                r.prototype.isInFrustum = function(e) {
                    return this._updateFrustumPlanes(),
                    e.isInFrustum(this._frustumPlanes)
                }
                ,
                r.prototype.isCompletelyInFrustum = function(e) {
                    return this._updateFrustumPlanes(),
                    e.isCompletelyInFrustum(this._frustumPlanes)
                }
                ,
                r.prototype.getForwardRay = function(t, r, i) {
                    void 0 === t && (t = 100),
                    r || (r = this.getWorldMatrix()),
                    i || (i = this.position);
                    var n = this._scene.useRightHandedSystem ? new e.Vector3(0,0,-1) : new e.Vector3(0,0,1)
                      , o = e.Vector3.TransformNormal(n, r)
                      , a = e.Vector3.Normalize(o);
                    return new e.Ray(i,a,t)
                }
                ,
                r.prototype.dispose = function(e, i) {
                    for (void 0 === i && (i = !1),
                    this.onViewMatrixChangedObservable.clear(),
                    this.onProjectionMatrixChangedObservable.clear(),
                    this.onAfterCheckInputsObservable.clear(),
                    this.onRestoreStateObservable.clear(),
                    this.inputs && this.inputs.clear(),
                    this.getScene().stopAnimation(this),
                    this.getScene().removeCamera(this); this._rigCameras.length > 0; ) {
                        var n = this._rigCameras.pop();
                        n && n.dispose()
                    }
                    if (this._rigPostProcess)
                        this._rigPostProcess.dispose(this),
                        this._rigPostProcess = null,
                        this._postProcesses = [];
                    else if (this.cameraRigMode !== r.RIG_MODE_NONE)
                        this._rigPostProcess = null,
                        this._postProcesses = [];
                    else
                        for (var o = this._postProcesses.length; --o >= 0; ) {
                            var a = this._postProcesses[o];
                            a && a.dispose(this)
                        }
                    for (o = this.customRenderTargets.length; --o >= 0; )
                        this.customRenderTargets[o].dispose();
                    this.customRenderTargets = [],
                    this._activeMeshes.dispose(),
                    t.prototype.dispose.call(this, e, i)
                }
                ,
                Object.defineProperty(r.prototype, "leftCamera", {
                    get: function() {
                        return this._rigCameras.length < 1 ? null : this._rigCameras[0]
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "rightCamera", {
                    get: function() {
                        return this._rigCameras.length < 2 ? null : this._rigCameras[1]
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getLeftTarget = function() {
                    return this._rigCameras.length < 1 ? null : this._rigCameras[0].getTarget()
                }
                ,
                r.prototype.getRightTarget = function() {
                    return this._rigCameras.length < 2 ? null : this._rigCameras[1].getTarget()
                }
                ,
                r.prototype.setCameraRigMode = function(t, i) {
                    if (this.cameraRigMode !== t) {
                        for (; this._rigCameras.length > 0; ) {
                            var n = this._rigCameras.pop();
                            n && n.dispose()
                        }
                        if (this.cameraRigMode = t,
                        this._cameraRigParams = {},
                        this._cameraRigParams.interaxialDistance = i.interaxialDistance || .0637,
                        this._cameraRigParams.stereoHalfAngle = e.Tools.ToRadians(this._cameraRigParams.interaxialDistance / .0637),
                        this.cameraRigMode !== r.RIG_MODE_NONE) {
                            var o = this.createRigCamera(this.name + "_L", 0)
                              , a = this.createRigCamera(this.name + "_R", 1);
                            o && a && (this._rigCameras.push(o),
                            this._rigCameras.push(a))
                        }
                        switch (this.cameraRigMode) {
                        case r.RIG_MODE_STEREOSCOPIC_ANAGLYPH:
                            this._rigCameras[0]._rigPostProcess = new e.PassPostProcess(this.name + "_passthru",1,this._rigCameras[0]),
                            this._rigCameras[1]._rigPostProcess = new e.AnaglyphPostProcess(this.name + "_anaglyph",1,this._rigCameras);
                            break;
                        case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:
                        case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:
                        case r.RIG_MODE_STEREOSCOPIC_OVERUNDER:
                            var s = this.cameraRigMode === r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL || this.cameraRigMode === r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;
                            this._rigCameras[0]._rigPostProcess = new e.PassPostProcess(this.name + "_passthru",1,this._rigCameras[0]),
                            this._rigCameras[1]._rigPostProcess = new e.StereoscopicInterlacePostProcess(this.name + "_stereoInterlace",this._rigCameras,s);
                            break;
                        case r.RIG_MODE_VR:
                            var y = i.vrCameraMetrics || e.VRCameraMetrics.GetDefault();
                            this._rigCameras[0]._cameraRigParams.vrMetrics = y,
                            this._rigCameras[0].viewport = new e.Viewport(0,0,.5,1),
                            this._rigCameras[0]._cameraRigParams.vrWorkMatrix = new e.Matrix,
                            this._rigCameras[0]._cameraRigParams.vrHMatrix = y.leftHMatrix,
                            this._rigCameras[0]._cameraRigParams.vrPreViewMatrix = y.leftPreViewMatrix,
                            this._rigCameras[0].getProjectionMatrix = this._rigCameras[0]._getVRProjectionMatrix,
                            this._rigCameras[1]._cameraRigParams.vrMetrics = y,
                            this._rigCameras[1].viewport = new e.Viewport(.5,0,.5,1),
                            this._rigCameras[1]._cameraRigParams.vrWorkMatrix = new e.Matrix,
                            this._rigCameras[1]._cameraRigParams.vrHMatrix = y.rightHMatrix,
                            this._rigCameras[1]._cameraRigParams.vrPreViewMatrix = y.rightPreViewMatrix,
                            this._rigCameras[1].getProjectionMatrix = this._rigCameras[1]._getVRProjectionMatrix,
                            y.compensateDistortion && (this._rigCameras[0]._rigPostProcess = new e.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",this._rigCameras[0],!1,y),
                            this._rigCameras[1]._rigPostProcess = new e.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[1],!0,y));
                            break;
                        case r.RIG_MODE_WEBVR:
                            if (i.vrDisplay) {
                                var l = i.vrDisplay.getEyeParameters("left")
                                  , c = i.vrDisplay.getEyeParameters("right");
                                this._rigCameras[0].viewport = new e.Viewport(0,0,.5,1),
                                this._rigCameras[0].setCameraRigParameter("left", !0),
                                this._rigCameras[0].setCameraRigParameter("specs", i.specs),
                                this._rigCameras[0].setCameraRigParameter("eyeParameters", l),
                                this._rigCameras[0].setCameraRigParameter("frameData", i.frameData),
                                this._rigCameras[0].setCameraRigParameter("parentCamera", i.parentCamera),
                                this._rigCameras[0]._cameraRigParams.vrWorkMatrix = new e.Matrix,
                                this._rigCameras[0].getProjectionMatrix = this._getWebVRProjectionMatrix,
                                this._rigCameras[0].parent = this,
                                this._rigCameras[0]._getViewMatrix = this._getWebVRViewMatrix,
                                this._rigCameras[1].viewport = new e.Viewport(.5,0,.5,1),
                                this._rigCameras[1].setCameraRigParameter("eyeParameters", c),
                                this._rigCameras[1].setCameraRigParameter("specs", i.specs),
                                this._rigCameras[1].setCameraRigParameter("frameData", i.frameData),
                                this._rigCameras[1].setCameraRigParameter("parentCamera", i.parentCamera),
                                this._rigCameras[1]._cameraRigParams.vrWorkMatrix = new e.Matrix,
                                this._rigCameras[1].getProjectionMatrix = this._getWebVRProjectionMatrix,
                                this._rigCameras[1].parent = this,
                                this._rigCameras[1]._getViewMatrix = this._getWebVRViewMatrix,
                                r.UseAlternateWebVRRendering && (this._rigCameras[1]._skipRendering = !0,
                                this._rigCameras[0]._alternateCamera = this._rigCameras[1])
                            }
                        }
                        this._cascadePostProcessesToRigCams(),
                        this.update()
                    }
                }
                ,
                r.prototype._getVRProjectionMatrix = function() {
                    return e.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov, this._cameraRigParams.vrMetrics.aspectRatio, this.minZ, this.maxZ, this._cameraRigParams.vrWorkMatrix),
                    this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix, this._projectionMatrix),
                    this._projectionMatrix
                }
                ,
                r.prototype._updateCameraRotationMatrix = function() {}
                ,
                r.prototype._updateWebVRCameraRotationMatrix = function() {}
                ,
                r.prototype._getWebVRProjectionMatrix = function() {
                    return e.Matrix.Identity()
                }
                ,
                r.prototype._getWebVRViewMatrix = function() {
                    return e.Matrix.Identity()
                }
                ,
                r.prototype.setCameraRigParameter = function(t, r) {
                    this._cameraRigParams || (this._cameraRigParams = {}),
                    this._cameraRigParams[t] = r,
                    "interaxialDistance" === t && (this._cameraRigParams.stereoHalfAngle = e.Tools.ToRadians(r / .0637))
                }
                ,
                r.prototype.createRigCamera = function(e, t) {
                    return null
                }
                ,
                r.prototype._updateRigCameras = function() {
                    for (var e = 0; e < this._rigCameras.length; e++)
                        this._rigCameras[e].minZ = this.minZ,
                        this._rigCameras[e].maxZ = this.maxZ,
                        this._rigCameras[e].fov = this.fov;
                    this.cameraRigMode === r.RIG_MODE_STEREOSCOPIC_ANAGLYPH && (this._rigCameras[0].viewport = this._rigCameras[1].viewport = this.viewport)
                }
                ,
                r.prototype._setupInputs = function() {}
                ,
                r.prototype.serialize = function() {
                    var t = e.SerializationHelper.Serialize(this);
                    return t.type = this.getClassName(),
                    this.parent && (t.parentId = this.parent.id),
                    this.inputs && this.inputs.serialize(t),
                    e.Animation.AppendSerializedAnimations(this, t),
                    t.ranges = this.serializeAnimationRanges(),
                    t
                }
                ,
                r.prototype.clone = function(t) {
                    return e.SerializationHelper.Clone(r.GetConstructorFromName(this.getClassName(), t, this.getScene(), this.interaxialDistance, this.isStereoscopicSideBySide), this)
                }
                ,
                r.prototype.getDirection = function(t) {
                    var r = e.Vector3.Zero();
                    return this.getDirectionToRef(t, r),
                    r
                }
                ,
                r.prototype.getDirectionToRef = function(t, r) {
                    e.Vector3.TransformNormalToRef(t, this.getWorldMatrix(), r)
                }
                ,
                r.GetConstructorFromName = function(t, r, i, n, o) {
                    void 0 === n && (n = 0),
                    void 0 === o && (o = !0);
                    var a = e.Node.Construct(t, r, i, {
                        interaxial_distance: n,
                        isStereoscopicSideBySide: o
                    });
                    return a || function() {
                        return new e.UniversalCamera(r,e.Vector3.Zero(),i)
                    }
                }
                ,
                r.prototype.computeWorldMatrix = function() {
                    return this.getWorldMatrix()
                }
                ,
                r.Parse = function(t, i) {
                    var n = t.type
                      , o = r.GetConstructorFromName(n, t.name, i, t.interaxial_distance, t.isStereoscopicSideBySide)
                      , a = e.SerializationHelper.Parse(o, t, i);
                    if (t.parentId && (a._waitingParentId = t.parentId),
                    a.inputs && (a.inputs.parse(t),
                    a._setupInputs()),
                    a.setPosition && (a.position.copyFromFloats(0, 0, 0),
                    a.setPosition(e.Vector3.FromArray(t.position))),
                    t.target && a.setTarget && a.setTarget(e.Vector3.FromArray(t.target)),
                    t.cameraRigMode) {
                        var s = t.interaxial_distance ? {
                            interaxialDistance: t.interaxial_distance
                        } : {};
                        a.setCameraRigMode(t.cameraRigMode, s)
                    }
                    if (t.animations) {
                        for (var y = 0; y < t.animations.length; y++) {
                            var l = t.animations[y];
                            a.animations.push(e.Animation.Parse(l))
                        }
                        e.Node.ParseAnimationRanges(a, t, i)
                    }
                    return t.autoAnimate && i.beginAnimation(a, t.autoAnimateFrom, t.autoAnimateTo, t.autoAnimateLoop, t.autoAnimateSpeed || 1),
                    a
                }
                ,
                r.PERSPECTIVE_CAMERA = 0,
                r.ORTHOGRAPHIC_CAMERA = 1,
                r.FOVMODE_VERTICAL_FIXED = 0,
                r.FOVMODE_HORIZONTAL_FIXED = 1,
                r.RIG_MODE_NONE = 0,
                r.RIG_MODE_STEREOSCOPIC_ANAGLYPH = 10,
                r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL = 11,
                r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED = 12,
                r.RIG_MODE_STEREOSCOPIC_OVERUNDER = 13,
                r.RIG_MODE_VR = 20,
                r.RIG_MODE_WEBVR = 21,
                r.ForceAttachControlToAlwaysPreventDefault = !1,
                r.UseAlternateWebVRRendering = !1,
                n([e.serializeAsVector3()], r.prototype, "position", void 0),
                n([e.serializeAsVector3()], r.prototype, "upVector", void 0),
                n([e.serialize()], r.prototype, "orthoLeft", void 0),
                n([e.serialize()], r.prototype, "orthoRight", void 0),
                n([e.serialize()], r.prototype, "orthoBottom", void 0),
                n([e.serialize()], r.prototype, "orthoTop", void 0),
                n([e.serialize()], r.prototype, "fov", void 0),
                n([e.serialize()], r.prototype, "minZ", void 0),
                n([e.serialize()], r.prototype, "maxZ", void 0),
                n([e.serialize()], r.prototype, "inertia", void 0),
                n([e.serialize()], r.prototype, "mode", void 0),
                n([e.serialize()], r.prototype, "layerMask", void 0),
                n([e.serialize()], r.prototype, "fovMode", void 0),
                n([e.serialize()], r.prototype, "cameraRigMode", void 0),
                n([e.serialize()], r.prototype, "interaxialDistance", void 0),
                n([e.serialize()], r.prototype, "isStereoscopicSideBySide", void 0),
                r
            }(e.Node);
            e.Camera = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(r) {
                    this._useSceneAutoClearSetup = !1,
                    this._renderingGroups = new Array,
                    this._autoClearDepthStencil = {},
                    this._customOpaqueSortCompareFn = {},
                    this._customAlphaTestSortCompareFn = {},
                    this._customTransparentSortCompareFn = {},
                    this._renderingGroupInfo = new e.RenderingGroupInfo,
                    this._scene = r;
                    for (var i = t.MIN_RENDERINGGROUPS; i < t.MAX_RENDERINGGROUPS; i++)
                        this._autoClearDepthStencil[i] = {
                            autoClear: !0,
                            depth: !0,
                            stencil: !0
                        }
                }
                return t.prototype._clearDepthStencilBuffer = function(e, t) {
                    void 0 === e && (e = !0),
                    void 0 === t && (t = !0),
                    this._depthStencilBufferAlreadyCleaned || (this._scene.getEngine().clear(null, !1, e, t),
                    this._depthStencilBufferAlreadyCleaned = !0)
                }
                ,
                t.prototype.render = function(e, r, i, n) {
                    var o = this._renderingGroupInfo;
                    if (o.scene = this._scene,
                    o.camera = this._scene.activeCamera,
                    this._scene.spriteManagers && n)
                        for (var a = 0; a < this._scene.spriteManagers.length; a++) {
                            var s = this._scene.spriteManagers[a];
                            this.dispatchSprites(s)
                        }
                    for (a = t.MIN_RENDERINGGROUPS; a < t.MAX_RENDERINGGROUPS; a++) {
                        this._depthStencilBufferAlreadyCleaned = a === t.MIN_RENDERINGGROUPS;
                        var y = this._renderingGroups[a];
                        if (y) {
                            var l = Math.pow(2, a);
                            if (o.renderingGroupId = a,
                            this._scene.onBeforeRenderingGroupObservable.notifyObservers(o, l),
                            t.AUTOCLEAR) {
                                var c = this._useSceneAutoClearSetup ? this._scene.getAutoClearDepthStencilSetup(a) : this._autoClearDepthStencil[a];
                                c && c.autoClear && this._clearDepthStencilBuffer(c.depth, c.stencil)
                            }
                            for (var h = 0, u = this._scene._beforeRenderingGroupDrawStage; h < u.length; h++) {
                                u[h].action(a)
                            }
                            y.render(e, n, i, r);
                            for (var d = 0, x = this._scene._afterRenderingGroupDrawStage; d < x.length; d++) {
                                x[d].action(a)
                            }
                            this._scene.onAfterRenderingGroupObservable.notifyObservers(o, l)
                        }
                    }
                }
                ,
                t.prototype.reset = function() {
                    for (var e = t.MIN_RENDERINGGROUPS; e < t.MAX_RENDERINGGROUPS; e++) {
                        var r = this._renderingGroups[e];
                        r && r.prepare()
                    }
                }
                ,
                t.prototype.dispose = function() {
                    this.freeRenderingGroups(),
                    this._renderingGroups.length = 0,
                    this._renderingGroupInfo = null
                }
                ,
                t.prototype.freeRenderingGroups = function() {
                    for (var e = t.MIN_RENDERINGGROUPS; e < t.MAX_RENDERINGGROUPS; e++) {
                        var r = this._renderingGroups[e];
                        r && r.dispose()
                    }
                }
                ,
                t.prototype._prepareRenderingGroup = function(t) {
                    void 0 === this._renderingGroups[t] && (this._renderingGroups[t] = new e.RenderingGroup(t,this._scene,this._customOpaqueSortCompareFn[t],this._customAlphaTestSortCompareFn[t],this._customTransparentSortCompareFn[t]))
                }
                ,
                t.prototype.dispatchSprites = function(e) {
                    var t = e.renderingGroupId || 0;
                    this._prepareRenderingGroup(t),
                    this._renderingGroups[t].dispatchSprites(e)
                }
                ,
                t.prototype.dispatchParticles = function(e) {
                    var t = e.renderingGroupId || 0;
                    this._prepareRenderingGroup(t),
                    this._renderingGroups[t].dispatchParticles(e)
                }
                ,
                t.prototype.dispatch = function(e, t, r) {
                    void 0 === t && (t = e.getMesh());
                    var i = t.renderingGroupId || 0;
                    this._prepareRenderingGroup(i),
                    this._renderingGroups[i].dispatch(e, t, r)
                }
                ,
                t.prototype.setRenderingOrder = function(e, t, r, i) {
                    if (void 0 === t && (t = null),
                    void 0 === r && (r = null),
                    void 0 === i && (i = null),
                    this._customOpaqueSortCompareFn[e] = t,
                    this._customAlphaTestSortCompareFn[e] = r,
                    this._customTransparentSortCompareFn[e] = i,
                    this._renderingGroups[e]) {
                        var n = this._renderingGroups[e];
                        n.opaqueSortCompareFn = this._customOpaqueSortCompareFn[e],
                        n.alphaTestSortCompareFn = this._customAlphaTestSortCompareFn[e],
                        n.transparentSortCompareFn = this._customTransparentSortCompareFn[e]
                    }
                }
                ,
                t.prototype.setRenderingAutoClearDepthStencil = function(e, t, r, i) {
                    void 0 === r && (r = !0),
                    void 0 === i && (i = !0),
                    this._autoClearDepthStencil[e] = {
                        autoClear: t,
                        depth: r,
                        stencil: i
                    }
                }
                ,
                t.prototype.getAutoClearDepthStencilSetup = function(e) {
                    return this._autoClearDepthStencil[e]
                }
                ,
                t.MAX_RENDERINGGROUPS = 4,
                t.MIN_RENDERINGGROUPS = 0,
                t.AUTOCLEAR = !0,
                t
            }();
            e.RenderingManager = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n, o) {
                    void 0 === i && (i = null),
                    void 0 === n && (n = null),
                    void 0 === o && (o = null),
                    this.index = t,
                    this._opaqueSubMeshes = new e.SmartArray(256),
                    this._transparentSubMeshes = new e.SmartArray(256),
                    this._alphaTestSubMeshes = new e.SmartArray(256),
                    this._depthOnlySubMeshes = new e.SmartArray(256),
                    this._particleSystems = new e.SmartArray(256),
                    this._spriteManagers = new e.SmartArray(256),
                    this._edgesRenderers = new e.SmartArray(16),
                    this._scene = r,
                    this.opaqueSortCompareFn = i,
                    this.alphaTestSortCompareFn = n,
                    this.transparentSortCompareFn = o
                }
                return Object.defineProperty(t.prototype, "opaqueSortCompareFn", {
                    set: function(e) {
                        this._opaqueSortCompareFn = e,
                        this._renderOpaque = e ? this.renderOpaqueSorted : t.renderUnsorted
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "alphaTestSortCompareFn", {
                    set: function(e) {
                        this._alphaTestSortCompareFn = e,
                        this._renderAlphaTest = e ? this.renderAlphaTestSorted : t.renderUnsorted
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "transparentSortCompareFn", {
                    set: function(e) {
                        this._transparentSortCompareFn = e || t.defaultTransparentSortCompare,
                        this._renderTransparent = this.renderTransparentSorted
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.render = function(t, r, i, n) {
                    if (t)
                        t(this._opaqueSubMeshes, this._alphaTestSubMeshes, this._transparentSubMeshes, this._depthOnlySubMeshes);
                    else {
                        var o = this._scene.getEngine();
                        0 !== this._depthOnlySubMeshes.length && (o.setColorWrite(!1),
                        this._renderAlphaTest(this._depthOnlySubMeshes),
                        o.setColorWrite(!0)),
                        0 !== this._opaqueSubMeshes.length && this._renderOpaque(this._opaqueSubMeshes),
                        0 !== this._alphaTestSubMeshes.length && this._renderAlphaTest(this._alphaTestSubMeshes);
                        var a = o.getStencilBuffer();
                        if (o.setStencilBuffer(!1),
                        r && this._renderSprites(),
                        i && this._renderParticles(n),
                        this.onBeforeTransparentRendering && this.onBeforeTransparentRendering(),
                        0 !== this._transparentSubMeshes.length && (this._renderTransparent(this._transparentSubMeshes),
                        o.setAlphaMode(e.Engine.ALPHA_DISABLE)),
                        o.setStencilBuffer(!1),
                        this._edgesRenderers.length) {
                            for (var s = 0; s < this._edgesRenderers.length; s++)
                                this._edgesRenderers.data[s].render();
                            o.setAlphaMode(e.Engine.ALPHA_DISABLE)
                        }
                        o.setStencilBuffer(a)
                    }
                }
                ,
                t.prototype.renderOpaqueSorted = function(e) {
                    return t.renderSorted(e, this._opaqueSortCompareFn, this._scene.activeCamera, !1)
                }
                ,
                t.prototype.renderAlphaTestSorted = function(e) {
                    return t.renderSorted(e, this._alphaTestSortCompareFn, this._scene.activeCamera, !1)
                }
                ,
                t.prototype.renderTransparentSorted = function(e) {
                    return t.renderSorted(e, this._transparentSortCompareFn, this._scene.activeCamera, !0)
                }
                ,
                t.renderSorted = function(t, r, i, n) {
                    for (var o, a = 0, s = i ? i.globalPosition : e.Vector3.Zero(); a < t.length; a++)
                        (o = t.data[a])._alphaIndex = o.getMesh().alphaIndex,
                        o._distanceToCamera = o.getBoundingInfo().boundingSphere.centerWorld.subtract(s).length();
                    var y = t.data.slice(0, t.length);
                    for (r && y.sort(r),
                    a = 0; a < y.length; a++) {
                        if (o = y[a],
                        n) {
                            var l = o.getMaterial();
                            if (l && l.needDepthPrePass) {
                                var c = l.getScene().getEngine();
                                c.setColorWrite(!1),
                                c.setAlphaMode(e.Engine.ALPHA_DISABLE),
                                o.render(!1),
                                c.setColorWrite(!0)
                            }
                        }
                        o.render(n)
                    }
                }
                ,
                t.renderUnsorted = function(e) {
                    for (var t = 0; t < e.length; t++) {
                        e.data[t].render(!1)
                    }
                }
                ,
                t.defaultTransparentSortCompare = function(e, r) {
                    return e._alphaIndex > r._alphaIndex ? 1 : e._alphaIndex < r._alphaIndex ? -1 : t.backToFrontSortCompare(e, r)
                }
                ,
                t.backToFrontSortCompare = function(e, t) {
                    return e._distanceToCamera < t._distanceToCamera ? 1 : e._distanceToCamera > t._distanceToCamera ? -1 : 0
                }
                ,
                t.frontToBackSortCompare = function(e, t) {
                    return e._distanceToCamera < t._distanceToCamera ? -1 : e._distanceToCamera > t._distanceToCamera ? 1 : 0
                }
                ,
                t.prototype.prepare = function() {
                    this._opaqueSubMeshes.reset(),
                    this._transparentSubMeshes.reset(),
                    this._alphaTestSubMeshes.reset(),
                    this._depthOnlySubMeshes.reset(),
                    this._particleSystems.reset(),
                    this._spriteManagers.reset(),
                    this._edgesRenderers.reset()
                }
                ,
                t.prototype.dispose = function() {
                    this._opaqueSubMeshes.dispose(),
                    this._transparentSubMeshes.dispose(),
                    this._alphaTestSubMeshes.dispose(),
                    this._depthOnlySubMeshes.dispose(),
                    this._particleSystems.dispose(),
                    this._spriteManagers.dispose(),
                    this._edgesRenderers.dispose()
                }
                ,
                t.prototype.dispatch = function(e, t, r) {
                    void 0 === t && (t = e.getMesh()),
                    void 0 === r && (r = e.getMaterial()),
                    null != r && (r.needAlphaBlendingForMesh(t) ? this._transparentSubMeshes.push(e) : r.needAlphaTesting() ? (r.needDepthPrePass && this._depthOnlySubMeshes.push(e),
                    this._alphaTestSubMeshes.push(e)) : (r.needDepthPrePass && this._depthOnlySubMeshes.push(e),
                    this._opaqueSubMeshes.push(e)),
                    t._edgesRenderer && t._edgesRenderer.isEnabled && this._edgesRenderers.push(t._edgesRenderer))
                }
                ,
                t.prototype.dispatchSprites = function(e) {
                    this._spriteManagers.push(e)
                }
                ,
                t.prototype.dispatchParticles = function(e) {
                    this._particleSystems.push(e)
                }
                ,
                t.prototype._renderParticles = function(e) {
                    if (0 !== this._particleSystems.length) {
                        var t = this._scene.activeCamera;
                        this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);
                        for (var r = 0; r < this._particleSystems.length; r++) {
                            var i = this._particleSystems.data[r];
                            if (0 !== (t && t.layerMask & i.layerMask)) {
                                var n = i.emitter;
                                n.position && e && -1 === e.indexOf(n) || this._scene._activeParticles.addCount(i.render(), !1)
                            }
                        }
                        this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)
                    }
                }
                ,
                t.prototype._renderSprites = function() {
                    if (this._scene.spritesEnabled && 0 !== this._spriteManagers.length) {
                        var e = this._scene.activeCamera;
                        this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);
                        for (var t = 0; t < this._spriteManagers.length; t++) {
                            var r = this._spriteManagers.data[t];
                            0 !== (e && e.layerMask & r.layerMask) && r.render()
                        }
                        this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)
                    }
                }
                ,
                t
            }();
            e.RenderingGroup = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {}
                return e.NAME_EFFECTLAYER = "EffectLayer",
                e.NAME_LAYER = "Layer",
                e.NAME_LENSFLARESYSTEM = "LensFlareSystem",
                e.NAME_BOUNDINGBOXRENDERER = "BoundingBoxRenderer",
                e.NAME_PARTICLESYSTEM = "ParticleSystem",
                e.NAME_GAMEPAD = "Gamepad",
                e.NAME_SIMPLIFICATIONQUEUE = "SimplificationQueue",
                e.NAME_GEOMETRYBUFFERRENDERER = "GeometryBufferRenderer",
                e.NAME_DEPTHRENDERER = "DepthRenderer",
                e.NAME_POSTPROCESSRENDERPIPELINEMANAGER = "PostProcessRenderPipelineManager",
                e.NAME_SPRITE = "Sprite",
                e.NAME_OUTLINERENDERER = "Outline",
                e.NAME_PROCEDURALTEXTURE = "ProceduralTexture",
                e.NAME_SHADOWGENERATOR = "ShadowGenerator",
                e.NAME_OCTREE = "Octree",
                e.NAME_PHYSICSENGINE = "PhysicsEngine",
                e.NAME_AUDIO = "Audio",
                e.STEP_ISREADYFORMESH_EFFECTLAYER = 0,
                e.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER = 0,
                e.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER = 0,
                e.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER = 0,
                e.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER = 1,
                e.STEP_BEFORECAMERADRAW_EFFECTLAYER = 0,
                e.STEP_BEFORECAMERADRAW_LAYER = 1,
                e.STEP_BEFORERENDERINGMESH_OUTLINE = 0,
                e.STEP_AFTERRENDERINGMESH_OUTLINE = 0,
                e.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW = 0,
                e.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER = 1,
                e.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE = 0,
                e.STEP_BEFORECAMERAUPDATE_GAMEPAD = 1,
                e.STEP_BEFORECLEAR_PROCEDURALTEXTURE = 0,
                e.STEP_AFTERCAMERADRAW_EFFECTLAYER = 0,
                e.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM = 1,
                e.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW = 2,
                e.STEP_AFTERCAMERADRAW_LAYER = 3,
                e.STEP_AFTERRENDER_AUDIO = 0,
                e.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR = 0,
                e.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER = 1,
                e.STEP_GATHERRENDERTARGETS_DEPTHRENDERER = 2,
                e.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER = 3,
                e.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER = 0,
                e.STEP_POINTERMOVE_SPRITE = 0,
                e.STEP_POINTERDOWN_SPRITE = 0,
                e.STEP_POINTERUP_SPRITE = 0,
                e
            }();
            e.SceneComponentConstants = t;
            var r = function(e) {
                function t(t) {
                    return e.apply(this, t) || this
                }
                return o(t, e),
                t.Create = function() {
                    return Object.create(t.prototype)
                }
                ,
                t.prototype.registerStep = function(e, t, r) {
                    var i = 0;
                    for (Number.MAX_VALUE; i < this.length; i++) {
                        if (e < this[i].index)
                            break
                    }
                    this.splice(i, 0, {
                        index: e,
                        component: t,
                        action: r.bind(t)
                    })
                }
                ,
                t.prototype.clear = function() {
                    this.length = 0
                }
                ,
                t
            }(Array);
            e.Stage = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {
                    this.rootNodes = new Array,
                    this.cameras = new Array,
                    this.lights = new Array,
                    this.meshes = new Array,
                    this.skeletons = new Array,
                    this.particleSystems = new Array,
                    this.animations = [],
                    this.animationGroups = new Array,
                    this.multiMaterials = new Array,
                    this.materials = new Array,
                    this.morphTargetManagers = new Array,
                    this.geometries = new Array,
                    this.transformNodes = new Array,
                    this.actionManagers = new Array,
                    this.textures = new Array
                }
                return e.AddParser = function(e, t) {
                    this._BabylonFileParsers[e] = t
                }
                ,
                e.GetParser = function(e) {
                    return this._BabylonFileParsers[e] ? this._BabylonFileParsers[e] : null
                }
                ,
                e.AddIndividualParser = function(e, t) {
                    this._IndividualBabylonFileParsers[e] = t
                }
                ,
                e.GetIndividualParser = function(e) {
                    return this._IndividualBabylonFileParsers[e] ? this._IndividualBabylonFileParsers[e] : null
                }
                ,
                e.Parse = function(e, t, r, i) {
                    for (var n in this._BabylonFileParsers)
                        this._BabylonFileParsers.hasOwnProperty(n) && this._BabylonFileParsers[n](e, t, r, i)
                }
                ,
                e._BabylonFileParsers = {},
                e._IndividualBabylonFileParsers = {},
                e
            }();
            e.AbstractScene = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {
                    this._singleClick = !1,
                    this._doubleClick = !1,
                    this._hasSwiped = !1,
                    this._ignore = !1
                }
                return Object.defineProperty(e.prototype, "singleClick", {
                    get: function() {
                        return this._singleClick
                    },
                    set: function(e) {
                        this._singleClick = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "doubleClick", {
                    get: function() {
                        return this._doubleClick
                    },
                    set: function(e) {
                        this._doubleClick = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "hasSwiped", {
                    get: function() {
                        return this._hasSwiped
                    },
                    set: function(e) {
                        this._hasSwiped = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "ignore", {
                    get: function() {
                        return this._ignore
                    },
                    set: function(e) {
                        this._ignore = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e
            }()
              , r = function() {};
            e.RenderingGroupInfo = r;
            var i = function(r) {
                function i(t) {
                    var n = r.call(this) || this;
                    return n.autoClear = !0,
                    n.autoClearDepthAndStencil = !0,
                    n.clearColor = new e.Color4(.2,.2,.3,1),
                    n.ambientColor = new e.Color3(0,0,0),
                    n._forceWireframe = !1,
                    n._forcePointsCloud = !1,
                    n.animationsEnabled = !0,
                    n._animationPropertiesOverride = null,
                    n.useConstantAnimationDeltaTime = !1,
                    n.constantlyUpdateMeshUnderPointer = !1,
                    n.hoverCursor = "pointer",
                    n.defaultCursor = "",
                    n.preventDefaultOnPointerDown = !0,
                    n.metadata = null,
                    n.disableOfflineSupportExceptionRules = new Array,
                    n.onDisposeObservable = new e.Observable,
                    n._onDisposeObserver = null,
                    n.onBeforeRenderObservable = new e.Observable,
                    n._onBeforeRenderObserver = null,
                    n.onAfterRenderObservable = new e.Observable,
                    n._onAfterRenderObserver = null,
                    n.onBeforeAnimationsObservable = new e.Observable,
                    n.onAfterAnimationsObservable = new e.Observable,
                    n.onBeforeDrawPhaseObservable = new e.Observable,
                    n.onAfterDrawPhaseObservable = new e.Observable,
                    n.onReadyObservable = new e.Observable,
                    n.onBeforeCameraRenderObservable = new e.Observable,
                    n._onBeforeCameraRenderObserver = null,
                    n.onAfterCameraRenderObservable = new e.Observable,
                    n._onAfterCameraRenderObserver = null,
                    n.onBeforeActiveMeshesEvaluationObservable = new e.Observable,
                    n.onAfterActiveMeshesEvaluationObservable = new e.Observable,
                    n.onBeforeParticlesRenderingObservable = new e.Observable,
                    n.onAfterParticlesRenderingObservable = new e.Observable,
                    n.onDataLoadedObservable = new e.Observable,
                    n.onNewCameraAddedObservable = new e.Observable,
                    n.onCameraRemovedObservable = new e.Observable,
                    n.onNewLightAddedObservable = new e.Observable,
                    n.onLightRemovedObservable = new e.Observable,
                    n.onNewGeometryAddedObservable = new e.Observable,
                    n.onGeometryRemovedObservable = new e.Observable,
                    n.onNewTransformNodeAddedObservable = new e.Observable,
                    n.onTransformNodeRemovedObservable = new e.Observable,
                    n.onNewMeshAddedObservable = new e.Observable,
                    n.onMeshRemovedObservable = new e.Observable,
                    n.onNewMaterialAddedObservable = new e.Observable,
                    n.onMaterialRemovedObservable = new e.Observable,
                    n.onNewTextureAddedObservable = new e.Observable,
                    n.onTextureRemovedObservable = new e.Observable,
                    n.onBeforeRenderTargetsRenderObservable = new e.Observable,
                    n.onAfterRenderTargetsRenderObservable = new e.Observable,
                    n.onBeforeStepObservable = new e.Observable,
                    n.onAfterStepObservable = new e.Observable,
                    n.onBeforeRenderingGroupObservable = new e.Observable,
                    n.onAfterRenderingGroupObservable = new e.Observable,
                    n.onMeshImportedObservable = new e.Observable,
                    n._registeredForLateAnimationBindings = new e.SmartArrayNoDuplicate(256),
                    n.onPrePointerObservable = new e.Observable,
                    n.onPointerObservable = new e.Observable,
                    n._meshPickProceed = !1,
                    n._currentPickResult = null,
                    n._previousPickResult = null,
                    n._totalPointersPressed = 0,
                    n._doubleClickOccured = !1,
                    n.cameraToUseForPointers = null,
                    n._pointerX = 0,
                    n._pointerY = 0,
                    n._startingPointerPosition = new e.Vector2(0,0),
                    n._previousStartingPointerPosition = new e.Vector2(0,0),
                    n._startingPointerTime = 0,
                    n._previousStartingPointerTime = 0,
                    n._pointerCaptures = {},
                    n._timeAccumulator = 0,
                    n._currentStepId = 0,
                    n._currentInternalStep = 0,
                    n.onPreKeyboardObservable = new e.Observable,
                    n.onKeyboardObservable = new e.Observable,
                    n._useRightHandedSystem = !1,
                    n._fogEnabled = !0,
                    n._fogMode = i.FOGMODE_NONE,
                    n.fogColor = new e.Color3(.2,.2,.3),
                    n.fogDensity = .1,
                    n.fogStart = 0,
                    n.fogEnd = 1e3,
                    n._shadowsEnabled = !0,
                    n._lightsEnabled = !0,
                    n.activeCameras = new Array,
                    n._texturesEnabled = !0,
                    n.particlesEnabled = !0,
                    n.spritesEnabled = !0,
                    n._skeletonsEnabled = !0,
                    n.lensFlaresEnabled = !0,
                    n.collisionsEnabled = !0,
                    n.gravity = new e.Vector3(0,-9.807,0),
                    n.postProcessesEnabled = !0,
                    n.postProcesses = new Array,
                    n.renderTargetsEnabled = !0,
                    n.dumpNextRenderTargets = !1,
                    n.customRenderTargets = new Array,
                    n.importedMeshesFiles = new Array,
                    n.probesEnabled = !0,
                    n._meshesForIntersections = new e.SmartArrayNoDuplicate(256),
                    n.proceduralTexturesEnabled = !0,
                    n._totalVertices = new e.PerfCounter,
                    n._activeIndices = new e.PerfCounter,
                    n._activeParticles = new e.PerfCounter,
                    n._activeBones = new e.PerfCounter,
                    n._animationTime = 0,
                    n.animationTimeScale = 1,
                    n._renderId = 0,
                    n._frameId = 0,
                    n._executeWhenReadyTimeoutId = -1,
                    n._intermediateRendering = !1,
                    n._viewUpdateFlag = -1,
                    n._projectionUpdateFlag = -1,
                    n._alternateViewUpdateFlag = -1,
                    n._alternateProjectionUpdateFlag = -1,
                    n._toBeDisposed = new Array(256),
                    n._activeRequests = new Array,
                    n._pendingData = new Array,
                    n._isDisposed = !1,
                    n.dispatchAllSubMeshesOfActiveMeshes = !1,
                    n._activeMeshes = new e.SmartArray(256),
                    n._processedMaterials = new e.SmartArray(256),
                    n._renderTargets = new e.SmartArrayNoDuplicate(256),
                    n._activeParticleSystems = new e.SmartArray(256),
                    n._activeSkeletons = new e.SmartArrayNoDuplicate(32),
                    n._softwareSkinnedMeshes = new e.SmartArrayNoDuplicate(32),
                    n._activeAnimatables = new Array,
                    n._transformMatrix = e.Matrix.Zero(),
                    n._useAlternateCameraConfiguration = !1,
                    n._alternateRendering = !1,
                    n.requireLightSorting = !1,
                    n._components = [],
                    n._serializableComponents = [],
                    n._transientComponents = [],
                    n._beforeCameraUpdateStage = e.Stage.Create(),
                    n._beforeClearStage = e.Stage.Create(),
                    n._gatherRenderTargetsStage = e.Stage.Create(),
                    n._gatherActiveCameraRenderTargetsStage = e.Stage.Create(),
                    n._isReadyForMeshStage = e.Stage.Create(),
                    n._beforeEvaluateActiveMeshStage = e.Stage.Create(),
                    n._evaluateSubMeshStage = e.Stage.Create(),
                    n._activeMeshStage = e.Stage.Create(),
                    n._cameraDrawRenderTargetStage = e.Stage.Create(),
                    n._beforeCameraDrawStage = e.Stage.Create(),
                    n._beforeRenderingGroupDrawStage = e.Stage.Create(),
                    n._beforeRenderingMeshStage = e.Stage.Create(),
                    n._afterRenderingMeshStage = e.Stage.Create(),
                    n._afterRenderingGroupDrawStage = e.Stage.Create(),
                    n._afterCameraDrawStage = e.Stage.Create(),
                    n._afterRenderStage = e.Stage.Create(),
                    n._pointerMoveStage = e.Stage.Create(),
                    n._pointerDownStage = e.Stage.Create(),
                    n._pointerUpStage = e.Stage.Create(),
                    n._defaultMeshCandidates = {
                        data: [],
                        length: 0
                    },
                    n._defaultSubMeshCandidates = {
                        data: [],
                        length: 0
                    },
                    n._activeMeshesFrozen = !1,
                    n._allowPostProcessClearColor = !0,
                    n.getDeterministicFrameTime = function() {
                        return 1e3 / 60
                    }
                    ,
                    n._tempPickingRay = e.Ray ? e.Ray.Zero() : null,
                    n._blockMaterialDirtyMechanism = !1,
                    n._engine = t || e.Engine.LastCreatedEngine,
                    n._engine.scenes.push(n),
                    n._uid = null,
                    n._renderingManager = new e.RenderingManager(n),
                    e.PostProcessManager && (n.postProcessManager = new e.PostProcessManager(n)),
                    e.Tools.IsWindowObjectExist(),
                    n.workerCollisions = !1,
                    n._createUbo(),
                    e.ImageProcessingConfiguration && (n._imageProcessingConfiguration = new e.ImageProcessingConfiguration),
                    n.setDefaultCandidateProviders(),
                    n
                }
                return o(i, r),
                Object.defineProperty(i.prototype, "environmentTexture", {
                    get: function() {
                        return this._environmentTexture
                    },
                    set: function(t) {
                        this._environmentTexture !== t && (this._environmentTexture = t,
                        this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "imageProcessingConfiguration", {
                    get: function() {
                        return this._imageProcessingConfiguration
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "forceWireframe", {
                    get: function() {
                        return this._forceWireframe
                    },
                    set: function(t) {
                        this._forceWireframe !== t && (this._forceWireframe = t,
                        this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "forcePointsCloud", {
                    get: function() {
                        return this._forcePointsCloud
                    },
                    set: function(t) {
                        this._forcePointsCloud !== t && (this._forcePointsCloud = t,
                        this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "animationPropertiesOverride", {
                    get: function() {
                        return this._animationPropertiesOverride
                    },
                    set: function(e) {
                        this._animationPropertiesOverride = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "onDispose", {
                    set: function(e) {
                        this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver),
                        this._onDisposeObserver = this.onDisposeObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "beforeRender", {
                    set: function(e) {
                        this._onBeforeRenderObserver && this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),
                        e && (this._onBeforeRenderObserver = this.onBeforeRenderObservable.add(e))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "afterRender", {
                    set: function(e) {
                        this._onAfterRenderObserver && this.onAfterRenderObservable.remove(this._onAfterRenderObserver),
                        e && (this._onAfterRenderObserver = this.onAfterRenderObservable.add(e))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "beforeCameraRender", {
                    set: function(e) {
                        this._onBeforeCameraRenderObserver && this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),
                        this._onBeforeCameraRenderObserver = this.onBeforeCameraRenderObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "afterCameraRender", {
                    set: function(e) {
                        this._onAfterCameraRenderObserver && this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),
                        this._onAfterCameraRenderObserver = this.onAfterCameraRenderObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "unTranslatedPointer", {
                    get: function() {
                        return new e.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "useRightHandedSystem", {
                    get: function() {
                        return this._useRightHandedSystem
                    },
                    set: function(t) {
                        this._useRightHandedSystem !== t && (this._useRightHandedSystem = t,
                        this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.setStepId = function(e) {
                    this._currentStepId = e
                }
                ,
                i.prototype.getStepId = function() {
                    return this._currentStepId
                }
                ,
                i.prototype.getInternalStep = function() {
                    return this._currentInternalStep
                }
                ,
                Object.defineProperty(i.prototype, "fogEnabled", {
                    get: function() {
                        return this._fogEnabled
                    },
                    set: function(t) {
                        this._fogEnabled !== t && (this._fogEnabled = t,
                        this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "fogMode", {
                    get: function() {
                        return this._fogMode
                    },
                    set: function(t) {
                        this._fogMode !== t && (this._fogMode = t,
                        this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "shadowsEnabled", {
                    get: function() {
                        return this._shadowsEnabled
                    },
                    set: function(t) {
                        this._shadowsEnabled !== t && (this._shadowsEnabled = t,
                        this.markAllMaterialsAsDirty(e.Material.LightDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "lightsEnabled", {
                    get: function() {
                        return this._lightsEnabled
                    },
                    set: function(t) {
                        this._lightsEnabled !== t && (this._lightsEnabled = t,
                        this.markAllMaterialsAsDirty(e.Material.LightDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "defaultMaterial", {
                    get: function() {
                        return this._defaultMaterial || (this._defaultMaterial = new e.StandardMaterial("default material",this)),
                        this._defaultMaterial
                    },
                    set: function(e) {
                        this._defaultMaterial = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "texturesEnabled", {
                    get: function() {
                        return this._texturesEnabled
                    },
                    set: function(t) {
                        this._texturesEnabled !== t && (this._texturesEnabled = t,
                        this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "skeletonsEnabled", {
                    get: function() {
                        return this._skeletonsEnabled
                    },
                    set: function(t) {
                        this._skeletonsEnabled !== t && (this._skeletonsEnabled = t,
                        this.markAllMaterialsAsDirty(e.Material.AttributesDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "_isAlternateRenderingEnabled", {
                    get: function() {
                        return this._alternateRendering
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "frustumPlanes", {
                    get: function() {
                        return this._frustumPlanes
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype._registerTransientComponents = function() {
                    if (this._transientComponents.length > 0) {
                        for (var e = 0, t = this._transientComponents; e < t.length; e++) {
                            t[e].register()
                        }
                        this._transientComponents = []
                    }
                }
                ,
                i.prototype._addComponent = function(e) {
                    this._components.push(e),
                    this._transientComponents.push(e);
                    var t = e;
                    t.addFromContainer && this._serializableComponents.push(t)
                }
                ,
                i.prototype._getComponent = function(e) {
                    for (var t = 0, r = this._components; t < r.length; t++) {
                        var i = r[t];
                        if (i.name === e)
                            return i
                    }
                    return null
                }
                ,
                i.prototype._getDefaultMeshCandidates = function() {
                    return this._defaultMeshCandidates.data = this.meshes,
                    this._defaultMeshCandidates.length = this.meshes.length,
                    this._defaultMeshCandidates
                }
                ,
                i.prototype._getDefaultSubMeshCandidates = function(e) {
                    return this._defaultSubMeshCandidates.data = e.subMeshes,
                    this._defaultSubMeshCandidates.length = e.subMeshes.length,
                    this._defaultSubMeshCandidates
                }
                ,
                i.prototype.setDefaultCandidateProviders = function() {
                    this.getActiveMeshCandidates = this._getDefaultMeshCandidates.bind(this),
                    this.getActiveSubMeshCandidates = this._getDefaultSubMeshCandidates.bind(this),
                    this.getIntersectingSubMeshCandidates = this._getDefaultSubMeshCandidates.bind(this),
                    this.getCollidingSubMeshCandidates = this._getDefaultSubMeshCandidates.bind(this)
                }
                ,
                Object.defineProperty(i.prototype, "workerCollisions", {
                    get: function() {
                        return this._workerCollisions
                    },
                    set: function(t) {
                        e.CollisionCoordinatorLegacy && (t = t && !!Worker && !!e.CollisionWorker,
                        this._workerCollisions = t,
                        this.collisionCoordinator && this.collisionCoordinator.destroy(),
                        this.collisionCoordinator = t ? new e.CollisionCoordinatorWorker : new e.CollisionCoordinatorLegacy,
                        this.collisionCoordinator.init(this))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "meshUnderPointer", {
                    get: function() {
                        return this._pointerOverMesh
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "pointerX", {
                    get: function() {
                        return this._pointerX
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "pointerY", {
                    get: function() {
                        return this._pointerY
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getCachedMaterial = function() {
                    return this._cachedMaterial
                }
                ,
                i.prototype.getCachedEffect = function() {
                    return this._cachedEffect
                }
                ,
                i.prototype.getCachedVisibility = function() {
                    return this._cachedVisibility
                }
                ,
                i.prototype.isCachedMaterialInvalid = function(e, t, r) {
                    return void 0 === r && (r = 1),
                    this._cachedEffect !== t || this._cachedMaterial !== e || this._cachedVisibility !== r
                }
                ,
                i.prototype.getEngine = function() {
                    return this._engine
                }
                ,
                i.prototype.getTotalVertices = function() {
                    return this._totalVertices.current
                }
                ,
                Object.defineProperty(i.prototype, "totalVerticesPerfCounter", {
                    get: function() {
                        return this._totalVertices
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getActiveIndices = function() {
                    return this._activeIndices.current
                }
                ,
                Object.defineProperty(i.prototype, "totalActiveIndicesPerfCounter", {
                    get: function() {
                        return this._activeIndices
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getActiveParticles = function() {
                    return this._activeParticles.current
                }
                ,
                Object.defineProperty(i.prototype, "activeParticlesPerfCounter", {
                    get: function() {
                        return this._activeParticles
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getActiveBones = function() {
                    return this._activeBones.current
                }
                ,
                Object.defineProperty(i.prototype, "activeBonesPerfCounter", {
                    get: function() {
                        return this._activeBones
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getInterFramePerfCounter = function() {
                    return e.Tools.Warn("getInterFramePerfCounter is deprecated. Please use SceneInstrumentation class"),
                    0
                }
                ,
                Object.defineProperty(i.prototype, "interFramePerfCounter", {
                    get: function() {
                        return e.Tools.Warn("interFramePerfCounter is deprecated. Please use SceneInstrumentation class"),
                        null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getLastFrameDuration = function() {
                    return e.Tools.Warn("getLastFrameDuration is deprecated. Please use SceneInstrumentation class"),
                    0
                }
                ,
                Object.defineProperty(i.prototype, "lastFramePerfCounter", {
                    get: function() {
                        return e.Tools.Warn("lastFramePerfCounter is deprecated. Please use SceneInstrumentation class"),
                        null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getEvaluateActiveMeshesDuration = function() {
                    return e.Tools.Warn("getEvaluateActiveMeshesDuration is deprecated. Please use SceneInstrumentation class"),
                    0
                }
                ,
                Object.defineProperty(i.prototype, "evaluateActiveMeshesDurationPerfCounter", {
                    get: function() {
                        return e.Tools.Warn("evaluateActiveMeshesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),
                        null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getActiveMeshes = function() {
                    return this._activeMeshes
                }
                ,
                i.prototype.getRenderTargetsDuration = function() {
                    return e.Tools.Warn("getRenderTargetsDuration is deprecated. Please use SceneInstrumentation class"),
                    0
                }
                ,
                i.prototype.getRenderDuration = function() {
                    return e.Tools.Warn("getRenderDuration is deprecated. Please use SceneInstrumentation class"),
                    0
                }
                ,
                Object.defineProperty(i.prototype, "renderDurationPerfCounter", {
                    get: function() {
                        return e.Tools.Warn("renderDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),
                        null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getParticlesDuration = function() {
                    return e.Tools.Warn("getParticlesDuration is deprecated. Please use SceneInstrumentation class"),
                    0
                }
                ,
                Object.defineProperty(i.prototype, "particlesDurationPerfCounter", {
                    get: function() {
                        return e.Tools.Warn("particlesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),
                        null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getSpritesDuration = function() {
                    return e.Tools.Warn("getSpritesDuration is deprecated. Please use SceneInstrumentation class"),
                    0
                }
                ,
                Object.defineProperty(i.prototype, "spriteDuractionPerfCounter", {
                    get: function() {
                        return e.Tools.Warn("spriteDuractionPerfCounter is deprecated. Please use SceneInstrumentation class"),
                        null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getAnimationRatio = function() {
                    return void 0 !== this._animationRatio ? this._animationRatio : 1
                }
                ,
                i.prototype.getRenderId = function() {
                    return this._renderId
                }
                ,
                i.prototype.getFrameId = function() {
                    return this._frameId
                }
                ,
                i.prototype.incrementRenderId = function() {
                    this._renderId++
                }
                ,
                i.prototype._updatePointerPosition = function(e) {
                    var t = this._engine.getRenderingCanvasClientRect();
                    t && (this._pointerX = e.clientX - t.left,
                    this._pointerY = e.clientY - t.top,
                    this._unTranslatedPointerX = this._pointerX,
                    this._unTranslatedPointerY = this._pointerY)
                }
                ,
                i.prototype._createUbo = function() {
                    this._sceneUbo = new e.UniformBuffer(this._engine,void 0,!0),
                    this._sceneUbo.addUniform("viewProjection", 16),
                    this._sceneUbo.addUniform("view", 16)
                }
                ,
                i.prototype._createAlternateUbo = function() {
                    this._alternateSceneUbo = new e.UniformBuffer(this._engine,void 0,!0),
                    this._alternateSceneUbo.addUniform("viewProjection", 16),
                    this._alternateSceneUbo.addUniform("view", 16)
                }
                ,
                i.prototype._setRayOnPointerInfo = function(t) {
                    t.pickInfo && (t.pickInfo.ray || (t.pickInfo.ray = this.createPickingRay(t.event.offsetX, t.event.offsetY, e.Matrix.Identity(), this.activeCamera)))
                }
                ,
                i.prototype.simulatePointerMove = function(t, r) {
                    var i = new PointerEvent("pointermove",r);
                    return this._checkPrePointerObservable(t, i, e.PointerEventTypes.POINTERMOVE) ? this : this._processPointerMove(t, i)
                }
                ,
                i.prototype._processPointerMove = function(t, r) {
                    var i = this._engine.getRenderingCanvas();
                    if (!i)
                        return this;
                    i.style.cursor = this.defaultCursor;
                    var n = !!(t && t.hit && t.pickedMesh);
                    n ? (this.setPointerOverMesh(t.pickedMesh),
                    this._pointerOverMesh && this._pointerOverMesh.actionManager && this._pointerOverMesh.actionManager.hasPointerTriggers && (this._pointerOverMesh.actionManager.hoverCursor ? i.style.cursor = this._pointerOverMesh.actionManager.hoverCursor : i.style.cursor = this.hoverCursor)) : this.setPointerOverMesh(null);
                    for (var o = 0, a = this._pointerMoveStage; o < a.length; o++) {
                        t = a[o].action(this._unTranslatedPointerX, this._unTranslatedPointerY, t, n, i)
                    }
                    if (t) {
                        var s = "mousewheel" === r.type || "DOMMouseScroll" === r.type ? e.PointerEventTypes.POINTERWHEEL : e.PointerEventTypes.POINTERMOVE;
                        if (this.onPointerMove && this.onPointerMove(r, t, s),
                        this.onPointerObservable.hasObservers()) {
                            var y = new e.PointerInfo(s,r,t);
                            this._setRayOnPointerInfo(y),
                            this.onPointerObservable.notifyObservers(y, s)
                        }
                    }
                    return this
                }
                ,
                i.prototype._checkPrePointerObservable = function(t, r, i) {
                    var n = new e.PointerInfoPre(i,r,this._unTranslatedPointerX,this._unTranslatedPointerY);
                    return t && (n.ray = t.ray),
                    this.onPrePointerObservable.notifyObservers(n, i),
                    !!n.skipOnPointerObservable
                }
                ,
                i.prototype.simulatePointerDown = function(t, r) {
                    var i = new PointerEvent("pointerdown",r);
                    return this._checkPrePointerObservable(t, i, e.PointerEventTypes.POINTERDOWN) ? this : this._processPointerDown(t, i)
                }
                ,
                i.prototype._processPointerDown = function(t, r) {
                    var n = this;
                    if (t && t.hit && t.pickedMesh) {
                        this._pickedDownMesh = t.pickedMesh;
                        var o = t.pickedMesh.actionManager;
                        if (o) {
                            if (o.hasPickTriggers)
                                switch (o.processTrigger(e.ActionManager.OnPickDownTrigger, e.ActionEvent.CreateNew(t.pickedMesh, r)),
                                r.button) {
                                case 0:
                                    o.processTrigger(e.ActionManager.OnLeftPickTrigger, e.ActionEvent.CreateNew(t.pickedMesh, r));
                                    break;
                                case 1:
                                    o.processTrigger(e.ActionManager.OnCenterPickTrigger, e.ActionEvent.CreateNew(t.pickedMesh, r));
                                    break;
                                case 2:
                                    o.processTrigger(e.ActionManager.OnRightPickTrigger, e.ActionEvent.CreateNew(t.pickedMesh, r))
                                }
                            o.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger) && window.setTimeout((function() {
                                var t = n.pick(n._unTranslatedPointerX, n._unTranslatedPointerY, (function(t) {
                                    return t.isPickable && t.isVisible && t.isReady() && t.actionManager && t.actionManager.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger) && t == n._pickedDownMesh
                                }
                                ), !1, n.cameraToUseForPointers);
                                t && t.hit && t.pickedMesh && o && 0 !== n._totalPointersPressed && Date.now() - n._startingPointerTime > i.LongPressDelay && !n._isPointerSwiping() && (n._startingPointerTime = 0,
                                o.processTrigger(e.ActionManager.OnLongPressTrigger, e.ActionEvent.CreateNew(t.pickedMesh, r)))
                            }
                            ), i.LongPressDelay)
                        }
                    } else
                        for (var a = 0, s = this._pointerDownStage; a < s.length; a++) {
                            t = s[a].action(this._unTranslatedPointerX, this._unTranslatedPointerY, t, r)
                        }
                    if (t) {
                        var y = e.PointerEventTypes.POINTERDOWN;
                        if (this.onPointerDown && this.onPointerDown(r, t, y),
                        this.onPointerObservable.hasObservers()) {
                            var l = new e.PointerInfo(y,r,t);
                            this._setRayOnPointerInfo(l),
                            this.onPointerObservable.notifyObservers(l, y)
                        }
                    }
                    return this
                }
                ,
                i.prototype.simulatePointerUp = function(r, i) {
                    var n = new PointerEvent("pointerup",i)
                      , o = new t;
                    return o.singleClick = !0,
                    o.ignore = !0,
                    this._checkPrePointerObservable(r, n, e.PointerEventTypes.POINTERUP) ? this : this._processPointerUp(r, n, o)
                }
                ,
                i.prototype._processPointerUp = function(t, r, i) {
                    if (t && t && t.pickedMesh) {
                        if (this._pickedUpMesh = t.pickedMesh,
                        this._pickedDownMesh === this._pickedUpMesh && (this.onPointerPick && this.onPointerPick(r, t),
                        i.singleClick && !i.ignore && this.onPointerObservable.hasObservers())) {
                            var n = e.PointerEventTypes.POINTERPICK
                              , o = new e.PointerInfo(n,r,t);
                            this._setRayOnPointerInfo(o),
                            this.onPointerObservable.notifyObservers(o, n)
                        }
                        t.pickedMesh.actionManager && (i.ignore && t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger, e.ActionEvent.CreateNew(t.pickedMesh, r)),
                        i.hasSwiped || i.ignore || !i.singleClick || t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickTrigger, e.ActionEvent.CreateNew(t.pickedMesh, r)),
                        i.doubleClick && !i.ignore && t.pickedMesh.actionManager.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger) && t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnDoublePickTrigger, e.ActionEvent.CreateNew(t.pickedMesh, r)))
                    } else if (!i.ignore)
                        for (var a = 0, s = this._pointerUpStage; a < s.length; a++) {
                            t = s[a].action(this._unTranslatedPointerX, this._unTranslatedPointerY, t, r)
                        }
                    this._pickedDownMesh && this._pickedDownMesh.actionManager && this._pickedDownMesh.actionManager.hasSpecificTrigger(e.ActionManager.OnPickOutTrigger) && this._pickedDownMesh !== this._pickedUpMesh && this._pickedDownMesh.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger, e.ActionEvent.CreateNew(this._pickedDownMesh, r));
                    var y = e.PointerEventTypes.POINTERUP;
                    if (this.onPointerObservable.hasObservers())
                        if (i.ignore) {
                            o = new e.PointerInfo(y,r,t);
                            this._setRayOnPointerInfo(o),
                            this.onPointerObservable.notifyObservers(o, y)
                        } else if (!i.hasSwiped) {
                            if (i.singleClick && this.onPointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERTAP)) {
                                var l = e.PointerEventTypes.POINTERTAP
                                  , o = new e.PointerInfo(l,r,t);
                                this._setRayOnPointerInfo(o),
                                this.onPointerObservable.notifyObservers(o, l)
                            }
                            if (i.doubleClick && this.onPointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)) {
                                var c = e.PointerEventTypes.POINTERDOUBLETAP;
                                o = new e.PointerInfo(c,r,t);
                                this._setRayOnPointerInfo(o),
                                this.onPointerObservable.notifyObservers(o, c)
                            }
                        }
                    return this.onPointerUp && this.onPointerUp(r, t, y),
                    this
                }
                ,
                i.prototype.isPointerCaptured = function(e) {
                    return void 0 === e && (e = 0),
                    this._pointerCaptures[e]
                }
                ,
                i.prototype._isPointerSwiping = function() {
                    return Math.abs(this._startingPointerPosition.x - this._pointerX) > i.DragMovementThreshold || Math.abs(this._startingPointerPosition.y - this._pointerY) > i.DragMovementThreshold
                }
                ,
                i.prototype.attachControl = function(r, n, o) {
                    var a = this;
                    void 0 === r && (r = !0),
                    void 0 === n && (n = !0),
                    void 0 === o && (o = !0),
                    this._initActionManager = function(e, t) {
                        if (!a._meshPickProceed) {
                            var r = a.pick(a._unTranslatedPointerX, a._unTranslatedPointerY, a.pointerDownPredicate, !1, a.cameraToUseForPointers);
                            a._currentPickResult = r,
                            r && (e = r.hit && r.pickedMesh ? r.pickedMesh.actionManager : null),
                            a._meshPickProceed = !0
                        }
                        return e
                    }
                    ,
                    this._delayedSimpleClick = function(e, t, r) {
                        (Date.now() - a._previousStartingPointerTime > i.DoubleClickDelay && !a._doubleClickOccured || e !== a._previousButtonPressed) && (a._doubleClickOccured = !1,
                        t.singleClick = !0,
                        t.ignore = !1,
                        r(t, a._currentPickResult))
                    }
                    ,
                    this._initClickEvent = function(r, n, o, s) {
                        var y = new t;
                        a._currentPickResult = null;
                        var l = null
                          , c = r.hasSpecificMask(e.PointerEventTypes.POINTERPICK) || n.hasSpecificMask(e.PointerEventTypes.POINTERPICK) || r.hasSpecificMask(e.PointerEventTypes.POINTERTAP) || n.hasSpecificMask(e.PointerEventTypes.POINTERTAP) || r.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP) || n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP);
                        if (!c && e.ActionManager && e.ActionManager.HasPickTriggers && (l = a._initActionManager(l, y)) && (c = l.hasPickTriggers),
                        c) {
                            var h = o.button;
                            if (y.hasSwiped = a._isPointerSwiping(),
                            !y.hasSwiped) {
                                var u = !i.ExclusiveDoubleClickMode;
                                u || (u = !r.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP) && !n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)) && !e.ActionManager.HasSpecificTrigger(e.ActionManager.OnDoublePickTrigger) && (l = a._initActionManager(l, y)) && (u = !l.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)),
                                u ? (Date.now() - a._previousStartingPointerTime > i.DoubleClickDelay || h !== a._previousButtonPressed) && (y.singleClick = !0,
                                s(y, a._currentPickResult)) : (a._previousDelayedSimpleClickTimeout = a._delayedSimpleClickTimeout,
                                a._delayedSimpleClickTimeout = window.setTimeout(a._delayedSimpleClick.bind(a, h, y, s), i.DoubleClickDelay));
                                var d = r.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP) || n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP);
                                !d && e.ActionManager.HasSpecificTrigger(e.ActionManager.OnDoublePickTrigger) && (l = a._initActionManager(l, y)) && (d = l.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)),
                                d && (h === a._previousButtonPressed && Date.now() - a._previousStartingPointerTime < i.DoubleClickDelay && !a._doubleClickOccured ? y.hasSwiped || a._isPointerSwiping() ? (a._doubleClickOccured = !1,
                                a._previousStartingPointerTime = a._startingPointerTime,
                                a._previousStartingPointerPosition.x = a._startingPointerPosition.x,
                                a._previousStartingPointerPosition.y = a._startingPointerPosition.y,
                                a._previousButtonPressed = h,
                                i.ExclusiveDoubleClickMode ? (a._previousDelayedSimpleClickTimeout && clearTimeout(a._previousDelayedSimpleClickTimeout),
                                a._previousDelayedSimpleClickTimeout = a._delayedSimpleClickTimeout,
                                s(y, a._previousPickResult)) : s(y, a._currentPickResult)) : (a._previousStartingPointerTime = 0,
                                a._doubleClickOccured = !0,
                                y.doubleClick = !0,
                                y.ignore = !1,
                                i.ExclusiveDoubleClickMode && a._previousDelayedSimpleClickTimeout && clearTimeout(a._previousDelayedSimpleClickTimeout),
                                a._previousDelayedSimpleClickTimeout = a._delayedSimpleClickTimeout,
                                s(y, a._currentPickResult)) : (a._doubleClickOccured = !1,
                                a._previousStartingPointerTime = a._startingPointerTime,
                                a._previousStartingPointerPosition.x = a._startingPointerPosition.x,
                                a._previousStartingPointerPosition.y = a._startingPointerPosition.y,
                                a._previousButtonPressed = h))
                            }
                        }
                        y.ignore = !0,
                        s(y, a._currentPickResult)
                    }
                    ,
                    this._onPointerMove = function(t) {
                        if (a._updatePointerPosition(t),
                        !a._checkPrePointerObservable(null, t, "mousewheel" === t.type || "DOMMouseScroll" === t.type ? e.PointerEventTypes.POINTERWHEEL : e.PointerEventTypes.POINTERMOVE) && (a.cameraToUseForPointers || a.activeCamera)) {
                            a.pointerMovePredicate || (a.pointerMovePredicate = function(e) {
                                return e.isPickable && e.isVisible && e.isReady() && e.isEnabled() && (e.enablePointerMoveEvents || a.constantlyUpdateMeshUnderPointer || null !== e.actionManager && void 0 !== e.actionManager)
                            }
                            );
                            var r = a.pick(a._unTranslatedPointerX, a._unTranslatedPointerY, a.pointerMovePredicate, !1, a.cameraToUseForPointers);
                            a._processPointerMove(r, t)
                        }
                    }
                    ,
                    this._onPointerDown = function(t) {
                        if (a._totalPointersPressed++,
                        a._pickedDownMesh = null,
                        a._meshPickProceed = !1,
                        a._updatePointerPosition(t),
                        a.preventDefaultOnPointerDown && l && (t.preventDefault(),
                        l.focus()),
                        !a._checkPrePointerObservable(null, t, e.PointerEventTypes.POINTERDOWN) && (a.cameraToUseForPointers || a.activeCamera)) {
                            a._pointerCaptures[t.pointerId] = !0,
                            a._startingPointerPosition.x = a._pointerX,
                            a._startingPointerPosition.y = a._pointerY,
                            a._startingPointerTime = Date.now(),
                            a.pointerDownPredicate || (a.pointerDownPredicate = function(e) {
                                return e.isPickable && e.isVisible && e.isReady() && e.isEnabled()
                            }
                            ),
                            a._pickedDownMesh = null;
                            var r = a.pick(a._unTranslatedPointerX, a._unTranslatedPointerY, a.pointerDownPredicate, !1, a.cameraToUseForPointers);
                            a._processPointerDown(r, t)
                        }
                    }
                    ,
                    this._onPointerUp = function(t) {
                        0 !== a._totalPointersPressed && (a._totalPointersPressed--,
                        a._pickedUpMesh = null,
                        a._meshPickProceed = !1,
                        a._updatePointerPosition(t),
                        a._initClickEvent(a.onPrePointerObservable, a.onPointerObservable, t, (function(r, i) {
                            if (a.onPrePointerObservable.hasObservers())
                                if (r.ignore) {
                                    if (a._checkPrePointerObservable(null, t, e.PointerEventTypes.POINTERUP))
                                        return
                                } else if (!r.hasSwiped) {
                                    if (r.singleClick && a.onPrePointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERTAP) && a._checkPrePointerObservable(null, t, e.PointerEventTypes.POINTERTAP))
                                        return;
                                    if (r.doubleClick && a.onPrePointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP) && a._checkPrePointerObservable(null, t, e.PointerEventTypes.POINTERDOUBLETAP))
                                        return
                                }
                            (a.cameraToUseForPointers || a.activeCamera) && (a._pointerCaptures[t.pointerId] = !1,
                            a.pointerUpPredicate || (a.pointerUpPredicate = function(e) {
                                return e.isPickable && e.isVisible && e.isReady() && e.isEnabled()
                            }
                            ),
                            !a._meshPickProceed && (e.ActionManager && e.ActionManager.HasTriggers || a.onPointerObservable.hasObservers()) && a._initActionManager(null, r),
                            i || (i = a._currentPickResult),
                            a._processPointerUp(i, t, r),
                            a._previousPickResult = a._currentPickResult)
                        }
                        )))
                    }
                    ,
                    this._onKeyDown = function(t) {
                        var r = e.KeyboardEventTypes.KEYDOWN;
                        if (a.onPreKeyboardObservable.hasObservers()) {
                            var i = new e.KeyboardInfoPre(r,t);
                            if (a.onPreKeyboardObservable.notifyObservers(i, r),
                            i.skipOnPointerObservable)
                                return
                        }
                        if (a.onKeyboardObservable.hasObservers()) {
                            i = new e.KeyboardInfo(r,t);
                            a.onKeyboardObservable.notifyObservers(i, r)
                        }
                        a.actionManager && a.actionManager.processTrigger(e.ActionManager.OnKeyDownTrigger, e.ActionEvent.CreateNewFromScene(a, t))
                    }
                    ,
                    this._onKeyUp = function(t) {
                        var r = e.KeyboardEventTypes.KEYUP;
                        if (a.onPreKeyboardObservable.hasObservers()) {
                            var i = new e.KeyboardInfoPre(r,t);
                            if (a.onPreKeyboardObservable.notifyObservers(i, r),
                            i.skipOnPointerObservable)
                                return
                        }
                        if (a.onKeyboardObservable.hasObservers()) {
                            i = new e.KeyboardInfo(r,t);
                            a.onKeyboardObservable.notifyObservers(i, r)
                        }
                        a.actionManager && a.actionManager.processTrigger(e.ActionManager.OnKeyUpTrigger, e.ActionEvent.CreateNewFromScene(a, t))
                    }
                    ;
                    var s = this.getEngine();
                    this._onCanvasFocusObserver = s.onCanvasFocusObservable.add((function() {
                        l && (l.addEventListener("keydown", a._onKeyDown, !1),
                        l.addEventListener("keyup", a._onKeyUp, !1))
                    }
                    )),
                    this._onCanvasBlurObserver = s.onCanvasBlurObservable.add((function() {
                        l && (l.removeEventListener("keydown", a._onKeyDown),
                        l.removeEventListener("keyup", a._onKeyUp))
                    }
                    ));
                    var y = e.Tools.GetPointerPrefix()
                      , l = this._engine.getRenderingCanvas();
                    l && (o && (l.addEventListener(y + "move", this._onPointerMove, !1),
                    l.addEventListener("mousewheel", this._onPointerMove, !1),
                    l.addEventListener("DOMMouseScroll", this._onPointerMove, !1)),
                    n && l.addEventListener(y + "down", this._onPointerDown, !1),
                    r && window.addEventListener(y + "up", this._onPointerUp, !1),
                    l.tabIndex = 1)
                }
                ,
                i.prototype.detachControl = function() {
                    var t = this.getEngine()
                      , r = e.Tools.GetPointerPrefix()
                      , i = t.getRenderingCanvas();
                    i && (i.removeEventListener(r + "move", this._onPointerMove),
                    i.removeEventListener(r + "down", this._onPointerDown),
                    window.removeEventListener(r + "up", this._onPointerUp),
                    this._onCanvasBlurObserver && t.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),
                    this._onCanvasFocusObserver && t.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),
                    i.removeEventListener("mousewheel", this._onPointerMove),
                    i.removeEventListener("DOMMouseScroll", this._onPointerMove),
                    i.removeEventListener("keydown", this._onKeyDown),
                    i.removeEventListener("keyup", this._onKeyUp),
                    this.onKeyboardObservable.clear(),
                    this.onPreKeyboardObservable.clear(),
                    this.onPointerObservable.clear(),
                    this.onPrePointerObservable.clear())
                }
                ,
                i.prototype.isReady = function() {
                    if (this._isDisposed)
                        return !1;
                    if (this._pendingData.length > 0)
                        return !1;
                    var t, r = this.getEngine();
                    for (t = 0; t < this.geometries.length; t++) {
                        if (this.geometries[t].delayLoadState === e.Engine.DELAYLOADSTATE_LOADING)
                            return !1
                    }
                    for (t = 0; t < this.meshes.length; t++) {
                        var i = this.meshes[t];
                        if (i.isEnabled() && (i.subMeshes && 0 !== i.subMeshes.length)) {
                            if (!i.isReady(!0))
                                return !1;
                            for (var n = "InstancedMesh" === i.getClassName() || r.getCaps().instancedArrays && i.instances.length > 0, o = 0, a = this._isReadyForMeshStage; o < a.length; o++) {
                                if (!a[o].action(i, n))
                                    return !1
                            }
                        }
                    }
                    if (this.activeCameras && this.activeCameras.length > 0)
                        for (var s = 0, y = this.activeCameras; s < y.length; s++) {
                            if (!y[s].isReady(!0))
                                return !1
                        }
                    else if (this.activeCamera && !this.activeCamera.isReady(!0))
                        return !1;
                    for (var l = 0, c = this.particleSystems; l < c.length; l++) {
                        if (!c[l].isReady())
                            return !1
                    }
                    return !0
                }
                ,
                i.prototype.resetCachedMaterial = function() {
                    this._cachedMaterial = null,
                    this._cachedEffect = null,
                    this._cachedVisibility = null
                }
                ,
                i.prototype.registerBeforeRender = function(e) {
                    this.onBeforeRenderObservable.add(e)
                }
                ,
                i.prototype.unregisterBeforeRender = function(e) {
                    this.onBeforeRenderObservable.removeCallback(e)
                }
                ,
                i.prototype.registerAfterRender = function(e) {
                    this.onAfterRenderObservable.add(e)
                }
                ,
                i.prototype.unregisterAfterRender = function(e) {
                    this.onAfterRenderObservable.removeCallback(e)
                }
                ,
                i.prototype._executeOnceBeforeRender = function(e) {
                    var t = this
                      , r = function() {
                        e(),
                        setTimeout((function() {
                            t.unregisterBeforeRender(r)
                        }
                        ))
                    };
                    this.registerBeforeRender(r)
                }
                ,
                i.prototype.executeOnceBeforeRender = function(e, t) {
                    var r = this;
                    void 0 !== t ? setTimeout((function() {
                        r._executeOnceBeforeRender(e)
                    }
                    ), t) : this._executeOnceBeforeRender(e)
                }
                ,
                i.prototype._addPendingData = function(e) {
                    this._pendingData.push(e)
                }
                ,
                i.prototype._removePendingData = function(e) {
                    var t = this.isLoading
                      , r = this._pendingData.indexOf(e);
                    -1 !== r && this._pendingData.splice(r, 1),
                    t && !this.isLoading && this.onDataLoadedObservable.notifyObservers(this)
                }
                ,
                i.prototype.getWaitingItemsCount = function() {
                    return this._pendingData.length
                }
                ,
                Object.defineProperty(i.prototype, "isLoading", {
                    get: function() {
                        return this._pendingData.length > 0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.executeWhenReady = function(e) {
                    var t = this;
                    this.onReadyObservable.add(e),
                    -1 === this._executeWhenReadyTimeoutId && (this._executeWhenReadyTimeoutId = setTimeout((function() {
                        t._checkIsReady()
                    }
                    ), 150))
                }
                ,
                i.prototype.whenReadyAsync = function() {
                    var e = this;
                    return new Promise((function(t) {
                        e.executeWhenReady((function() {
                            t()
                        }
                        ))
                    }
                    ))
                }
                ,
                i.prototype._checkIsReady = function() {
                    var e = this;
                    if (this._registerTransientComponents(),
                    this.isReady())
                        return this.onReadyObservable.notifyObservers(this),
                        this.onReadyObservable.clear(),
                        void (this._executeWhenReadyTimeoutId = -1);
                    this._executeWhenReadyTimeoutId = setTimeout((function() {
                        e._checkIsReady()
                    }
                    ), 150)
                }
                ,
                i.prototype.beginWeightedAnimation = function(e, t, r, i, n, o, a, s, y) {
                    void 0 === i && (i = 1),
                    void 0 === o && (o = 1);
                    var l = this.beginAnimation(e, t, r, n, o, a, s, !1, y);
                    return l.weight = i,
                    l
                }
                ,
                i.prototype.beginAnimation = function(t, r, i, n, o, a, s, y, l) {
                    void 0 === o && (o = 1),
                    void 0 === y && (y = !0),
                    r > i && o > 0 && (o *= -1),
                    y && this.stopAnimation(t, void 0, l),
                    s || (s = new e.Animatable(this,t,r,i,n,o,a));
                    var c = !l || l(t);
                    if (t.animations && c && s.appendAnimations(t, t.animations),
                    t.getAnimatables)
                        for (var h = t.getAnimatables(), u = 0; u < h.length; u++)
                            this.beginAnimation(h[u], r, i, n, o, a, s, y, l);
                    return s.reset(),
                    s
                }
                ,
                i.prototype.beginDirectAnimation = function(t, r, i, n, o, a, s) {
                    return void 0 === a && (a = 1),
                    new e.Animatable(this,t,i,n,o,a,s,r)
                }
                ,
                i.prototype.beginDirectHierarchyAnimation = function(e, t, r, i, n, o, a, s) {
                    var y = e.getDescendants(t)
                      , l = [];
                    l.push(this.beginDirectAnimation(e, r, i, n, o, a, s));
                    for (var c = 0, h = y; c < h.length; c++) {
                        var u = h[c];
                        l.push(this.beginDirectAnimation(u, r, i, n, o, a, s))
                    }
                    return l
                }
                ,
                i.prototype.getAnimatableByTarget = function(e) {
                    for (var t = 0; t < this._activeAnimatables.length; t++)
                        if (this._activeAnimatables[t].target === e)
                            return this._activeAnimatables[t];
                    return null
                }
                ,
                i.prototype.getAllAnimatablesByTarget = function(e) {
                    for (var t = [], r = 0; r < this._activeAnimatables.length; r++)
                        this._activeAnimatables[r].target === e && t.push(this._activeAnimatables[r]);
                    return t
                }
                ,
                Object.defineProperty(i.prototype, "animatables", {
                    get: function() {
                        return this._activeAnimatables
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.stopAnimation = function(e, t, r) {
                    for (var i = 0, n = this.getAllAnimatablesByTarget(e); i < n.length; i++) {
                        n[i].stop(t, r)
                    }
                }
                ,
                i.prototype.stopAllAnimations = function() {
                    if (this._activeAnimatables) {
                        for (var e = 0; e < this._activeAnimatables.length; e++)
                            this._activeAnimatables[e].stop();
                        this._activeAnimatables = []
                    }
                    for (var t = 0, r = this.animationGroups; t < r.length; t++) {
                        r[t].stop()
                    }
                }
                ,
                i.prototype._animate = function() {
                    if (this.animationsEnabled && 0 !== this._activeAnimatables.length) {
                        var t = e.Tools.Now;
                        if (!this._animationTimeLast) {
                            if (this._pendingData.length > 0)
                                return;
                            this._animationTimeLast = t
                        }
                        var r = this.useConstantAnimationDeltaTime ? 16 : (t - this._animationTimeLast) * this.animationTimeScale;
                        this._animationTime += r,
                        this._animationTimeLast = t;
                        for (var i = 0; i < this._activeAnimatables.length; i++)
                            this._activeAnimatables[i]._animate(this._animationTime);
                        this._processLateAnimationBindings()
                    }
                }
                ,
                i.prototype._registerTargetForLateAnimationBinding = function(e, t) {
                    var r = e.target;
                    this._registeredForLateAnimationBindings.pushNoDuplicate(r),
                    r._lateAnimationHolders || (r._lateAnimationHolders = {}),
                    r._lateAnimationHolders[e.targetPath] || (r._lateAnimationHolders[e.targetPath] = {
                        totalWeight: 0,
                        animations: [],
                        originalValue: t
                    }),
                    r._lateAnimationHolders[e.targetPath].animations.push(e),
                    r._lateAnimationHolders[e.targetPath].totalWeight += e.weight
                }
                ,
                i.prototype._processLateAnimationBindingsForMatrices = function(t) {
                    var r = 1
                      , i = e.Tmp.Vector3[0]
                      , n = e.Tmp.Vector3[1]
                      , o = e.Tmp.Quaternion[0]
                      , a = 0
                      , s = t.animations[0]
                      , y = t.originalValue
                      , l = 1;
                    if (t.totalWeight < 1)
                        y.decompose(n, o, i),
                        l = 1 - t.totalWeight;
                    else if (a = 1,
                    r = t.totalWeight,
                    s.currentValue.decompose(n, o, i),
                    1 == (l = s.weight / r))
                        return s.currentValue;
                    n.scaleInPlace(l),
                    i.scaleInPlace(l),
                    o.scaleInPlace(l);
                    for (var c = a; c < t.animations.length; c++) {
                        var h = t.animations[c]
                          , u = (l = h.weight / r,
                        e.Tmp.Vector3[2])
                          , d = e.Tmp.Vector3[3]
                          , x = e.Tmp.Quaternion[1];
                        h.currentValue.decompose(d, x, u),
                        d.scaleAndAddToRef(l, n),
                        x.scaleAndAddToRef(l, o),
                        u.scaleAndAddToRef(l, i)
                    }
                    return e.Matrix.ComposeToRef(n, o, i, s._workValue),
                    s._workValue
                }
                ,
                i.prototype._processLateAnimationBindingsForQuaternions = function(t, r) {
                    var i = t.animations[0]
                      , n = t.originalValue;
                    if (1 === t.animations.length)
                        return e.Quaternion.SlerpToRef(n, i.currentValue, Math.min(1, t.totalWeight), r),
                        r;
                    var o, a, s = 1;
                    if (t.totalWeight < 1) {
                        var y = 1 - t.totalWeight;
                        a = [],
                        (o = []).push(n),
                        a.push(y)
                    } else {
                        if (2 === t.animations.length)
                            return e.Quaternion.SlerpToRef(t.animations[0].currentValue, t.animations[1].currentValue, t.animations[1].weight / t.totalWeight, r),
                            r;
                        o = [],
                        a = [],
                        s = t.totalWeight
                    }
                    for (var l = 0; l < t.animations.length; l++) {
                        var c = t.animations[l];
                        o.push(c.currentValue),
                        a.push(c.weight / s)
                    }
                    for (var h = 0, u = null, d = 0; d < o.length; )
                        u ? (h += a[d],
                        e.Quaternion.SlerpToRef(u, o[d], a[d] / h, u),
                        d++) : (e.Quaternion.SlerpToRef(o[d], o[d + 1], a[d + 1] / (a[d] + a[d + 1]), r),
                        u = r,
                        h = a[d] + a[d + 1],
                        d += 2);
                    return u
                }
                ,
                i.prototype._processLateAnimationBindings = function() {
                    if (this._registeredForLateAnimationBindings.length) {
                        for (var t = 0; t < this._registeredForLateAnimationBindings.length; t++) {
                            var r = this._registeredForLateAnimationBindings.data[t];
                            for (var i in r._lateAnimationHolders) {
                                var n = r._lateAnimationHolders[i]
                                  , o = n.animations[0]
                                  , a = n.originalValue
                                  , s = e.Animation.AllowMatrixDecomposeForInterpolation && a.m
                                  , y = r[i];
                                if (s)
                                    y = this._processLateAnimationBindingsForMatrices(n);
                                else if (void 0 !== a.w)
                                    y = this._processLateAnimationBindingsForQuaternions(n, y || e.Quaternion.Identity());
                                else {
                                    var l = 0
                                      , c = 1;
                                    if (n.totalWeight < 1)
                                        y = a.scale ? a.scale(1 - n.totalWeight) : a * (1 - n.totalWeight);
                                    else {
                                        c = n.totalWeight;
                                        var h = o.weight / c;
                                        y = 1 !== h ? o.currentValue.scale ? o.currentValue.scale(h) : o.currentValue * h : o.currentValue,
                                        l = 1
                                    }
                                    for (var u = l; u < n.animations.length; u++) {
                                        var d = n.animations[u]
                                          , x = d.weight / c;
                                        d.currentValue.scaleAndAddToRef ? d.currentValue.scaleAndAddToRef(x, y) : y += d.currentValue * x
                                    }
                                }
                                r[i] = y
                            }
                            r._lateAnimationHolders = {}
                        }
                        this._registeredForLateAnimationBindings.reset()
                    }
                }
                ,
                i.prototype._switchToAlternateCameraConfiguration = function(e) {
                    this._useAlternateCameraConfiguration = e
                }
                ,
                i.prototype.getViewMatrix = function() {
                    return this._useAlternateCameraConfiguration ? this._alternateViewMatrix : this._viewMatrix
                }
                ,
                i.prototype.getProjectionMatrix = function() {
                    return this._useAlternateCameraConfiguration ? this._alternateProjectionMatrix : this._projectionMatrix
                }
                ,
                i.prototype.getTransformMatrix = function() {
                    return this._useAlternateCameraConfiguration ? this._alternateTransformMatrix : this._transformMatrix
                }
                ,
                i.prototype.setTransformMatrix = function(t, r) {
                    if (this._viewUpdateFlag !== t.updateFlag || this._projectionUpdateFlag !== r.updateFlag) {
                        if (this._viewUpdateFlag = t.updateFlag,
                        this._projectionUpdateFlag = r.updateFlag,
                        this._viewMatrix = t,
                        this._projectionMatrix = r,
                        this._viewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix),
                        this._frustumPlanes ? e.Frustum.GetPlanesToRef(this._transformMatrix, this._frustumPlanes) : this._frustumPlanes = e.Frustum.GetPlanes(this._transformMatrix),
                        this.activeCamera && this.activeCamera._alternateCamera) {
                            var i = this.activeCamera._alternateCamera;
                            i.getViewMatrix().multiplyToRef(i.getProjectionMatrix(), e.Tmp.Matrix[0]),
                            e.Frustum.GetRightPlaneToRef(e.Tmp.Matrix[0], this._frustumPlanes[3])
                        }
                        this._sceneUbo.useUbo && (this._sceneUbo.updateMatrix("viewProjection", this._transformMatrix),
                        this._sceneUbo.updateMatrix("view", this._viewMatrix),
                        this._sceneUbo.update())
                    }
                }
                ,
                i.prototype._setAlternateTransformMatrix = function(t, r) {
                    this._alternateViewUpdateFlag === t.updateFlag && this._alternateProjectionUpdateFlag === r.updateFlag || (this._alternateViewUpdateFlag = t.updateFlag,
                    this._alternateProjectionUpdateFlag = r.updateFlag,
                    this._alternateViewMatrix = t,
                    this._alternateProjectionMatrix = r,
                    this._alternateTransformMatrix || (this._alternateTransformMatrix = e.Matrix.Zero()),
                    this._alternateViewMatrix.multiplyToRef(this._alternateProjectionMatrix, this._alternateTransformMatrix),
                    this._alternateSceneUbo || this._createAlternateUbo(),
                    this._alternateSceneUbo.useUbo && (this._alternateSceneUbo.updateMatrix("viewProjection", this._alternateTransformMatrix),
                    this._alternateSceneUbo.updateMatrix("view", this._alternateViewMatrix),
                    this._alternateSceneUbo.update()))
                }
                ,
                i.prototype.getSceneUniformBuffer = function() {
                    return this._useAlternateCameraConfiguration ? this._alternateSceneUbo : this._sceneUbo
                }
                ,
                i.prototype.getUniqueId = function() {
                    var e = i._uniqueIdCounter;
                    return i._uniqueIdCounter++,
                    e
                }
                ,
                i.prototype.addMesh = function(e, t) {
                    var r = this;
                    void 0 === t && (t = !1),
                    this.meshes.push(e),
                    this.collisionCoordinator && this.collisionCoordinator.onMeshAdded(e),
                    e._resyncLightSources(),
                    this.onNewMeshAddedObservable.notifyObservers(e),
                    t && e.getChildMeshes().forEach((function(e) {
                        r.addMesh(e)
                    }
                    ))
                }
                ,
                i.prototype.removeMesh = function(e, t) {
                    var r = this;
                    void 0 === t && (t = !1);
                    var i = this.meshes.indexOf(e);
                    return -1 !== i && this.meshes.splice(i, 1),
                    this.onMeshRemovedObservable.notifyObservers(e),
                    t && e.getChildMeshes().forEach((function(e) {
                        r.removeMesh(e)
                    }
                    )),
                    i
                }
                ,
                i.prototype.addTransformNode = function(e) {
                    this.transformNodes.push(e),
                    this.onNewTransformNodeAddedObservable.notifyObservers(e)
                }
                ,
                i.prototype.removeTransformNode = function(e) {
                    var t = this.transformNodes.indexOf(e);
                    return -1 !== t && this.transformNodes.splice(t, 1),
                    this.onTransformNodeRemovedObservable.notifyObservers(e),
                    t
                }
                ,
                i.prototype.removeSkeleton = function(e) {
                    var t = this.skeletons.indexOf(e);
                    return -1 !== t && this.skeletons.splice(t, 1),
                    t
                }
                ,
                i.prototype.removeMorphTargetManager = function(e) {
                    var t = this.morphTargetManagers.indexOf(e);
                    return -1 !== t && this.morphTargetManagers.splice(t, 1),
                    t
                }
                ,
                i.prototype.removeLight = function(e) {
                    var t = this.lights.indexOf(e);
                    if (-1 !== t) {
                        for (var r = 0, i = this.meshes; r < i.length; r++) {
                            i[r]._removeLightSource(e)
                        }
                        this.lights.splice(t, 1),
                        this.sortLightsByPriority()
                    }
                    return this.onLightRemovedObservable.notifyObservers(e),
                    t
                }
                ,
                i.prototype.removeCamera = function(e) {
                    var t = this.cameras.indexOf(e);
                    -1 !== t && this.cameras.splice(t, 1);
                    var r = this.activeCameras.indexOf(e);
                    return -1 !== r && this.activeCameras.splice(r, 1),
                    this.activeCamera === e && (this.cameras.length > 0 ? this.activeCamera = this.cameras[0] : this.activeCamera = null),
                    this.onCameraRemovedObservable.notifyObservers(e),
                    t
                }
                ,
                i.prototype.removeParticleSystem = function(e) {
                    var t = this.particleSystems.indexOf(e);
                    return -1 !== t && this.particleSystems.splice(t, 1),
                    t
                }
                ,
                i.prototype.removeAnimation = function(e) {
                    var t = this.animations.indexOf(e);
                    return -1 !== t && this.animations.splice(t, 1),
                    t
                }
                ,
                i.prototype.removeAnimationGroup = function(e) {
                    var t = this.animationGroups.indexOf(e);
                    return -1 !== t && this.animationGroups.splice(t, 1),
                    t
                }
                ,
                i.prototype.removeMultiMaterial = function(e) {
                    var t = this.multiMaterials.indexOf(e);
                    return -1 !== t && this.multiMaterials.splice(t, 1),
                    t
                }
                ,
                i.prototype.removeMaterial = function(e) {
                    var t = this.materials.indexOf(e);
                    return -1 !== t && this.materials.splice(t, 1),
                    this.onMaterialRemovedObservable.notifyObservers(e),
                    t
                }
                ,
                i.prototype.removeActionManager = function(e) {
                    var t = this.actionManagers.indexOf(e);
                    return -1 !== t && this.actionManagers.splice(t, 1),
                    t
                }
                ,
                i.prototype.removeTexture = function(e) {
                    var t = this.textures.indexOf(e);
                    return -1 !== t && this.textures.splice(t, 1),
                    this.onTextureRemovedObservable.notifyObservers(e),
                    t
                }
                ,
                i.prototype.addLight = function(e) {
                    this.lights.push(e),
                    this.sortLightsByPriority();
                    for (var t = 0, r = this.meshes; t < r.length; t++) {
                        var i = r[t];
                        -1 === i._lightSources.indexOf(e) && (i._lightSources.push(e),
                        i._resyncLightSources())
                    }
                    this.onNewLightAddedObservable.notifyObservers(e)
                }
                ,
                i.prototype.sortLightsByPriority = function() {
                    this.requireLightSorting && this.lights.sort(e.Light.CompareLightsPriority)
                }
                ,
                i.prototype.addCamera = function(e) {
                    this.cameras.push(e),
                    this.onNewCameraAddedObservable.notifyObservers(e)
                }
                ,
                i.prototype.addSkeleton = function(e) {
                    this.skeletons.push(e)
                }
                ,
                i.prototype.addParticleSystem = function(e) {
                    this.particleSystems.push(e)
                }
                ,
                i.prototype.addAnimation = function(e) {
                    this.animations.push(e)
                }
                ,
                i.prototype.addAnimationGroup = function(e) {
                    this.animationGroups.push(e)
                }
                ,
                i.prototype.addMultiMaterial = function(e) {
                    this.multiMaterials.push(e)
                }
                ,
                i.prototype.addMaterial = function(e) {
                    this.materials.push(e),
                    this.onNewMaterialAddedObservable.notifyObservers(e)
                }
                ,
                i.prototype.addMorphTargetManager = function(e) {
                    this.morphTargetManagers.push(e)
                }
                ,
                i.prototype.addGeometry = function(e) {
                    this.geometries.push(e)
                }
                ,
                i.prototype.addActionManager = function(e) {
                    this.actionManagers.push(e)
                }
                ,
                i.prototype.addTexture = function(e) {
                    this.textures.push(e),
                    this.onNewTextureAddedObservable.notifyObservers(e)
                }
                ,
                i.prototype.switchActiveCamera = function(e, t) {
                    void 0 === t && (t = !0);
                    var r = this._engine.getRenderingCanvas();
                    r && (this.activeCamera && this.activeCamera.detachControl(r),
                    this.activeCamera = e,
                    t && e.attachControl(r))
                }
                ,
                i.prototype.setActiveCameraByID = function(e) {
                    var t = this.getCameraByID(e);
                    return t ? (this.activeCamera = t,
                    t) : null
                }
                ,
                i.prototype.setActiveCameraByName = function(e) {
                    var t = this.getCameraByName(e);
                    return t ? (this.activeCamera = t,
                    t) : null
                }
                ,
                i.prototype.getAnimationGroupByName = function(e) {
                    for (var t = 0; t < this.animationGroups.length; t++)
                        if (this.animationGroups[t].name === e)
                            return this.animationGroups[t];
                    return null
                }
                ,
                i.prototype.getMaterialByID = function(e) {
                    for (var t = 0; t < this.materials.length; t++)
                        if (this.materials[t].id === e)
                            return this.materials[t];
                    return null
                }
                ,
                i.prototype.getMaterialByName = function(e) {
                    for (var t = 0; t < this.materials.length; t++)
                        if (this.materials[t].name === e)
                            return this.materials[t];
                    return null
                }
                ,
                i.prototype.getCameraByID = function(e) {
                    for (var t = 0; t < this.cameras.length; t++)
                        if (this.cameras[t].id === e)
                            return this.cameras[t];
                    return null
                }
                ,
                i.prototype.getCameraByUniqueID = function(e) {
                    for (var t = 0; t < this.cameras.length; t++)
                        if (this.cameras[t].uniqueId === e)
                            return this.cameras[t];
                    return null
                }
                ,
                i.prototype.getCameraByName = function(e) {
                    for (var t = 0; t < this.cameras.length; t++)
                        if (this.cameras[t].name === e)
                            return this.cameras[t];
                    return null
                }
                ,
                i.prototype.getBoneByID = function(e) {
                    for (var t = 0; t < this.skeletons.length; t++)
                        for (var r = this.skeletons[t], i = 0; i < r.bones.length; i++)
                            if (r.bones[i].id === e)
                                return r.bones[i];
                    return null
                }
                ,
                i.prototype.getBoneByName = function(e) {
                    for (var t = 0; t < this.skeletons.length; t++)
                        for (var r = this.skeletons[t], i = 0; i < r.bones.length; i++)
                            if (r.bones[i].name === e)
                                return r.bones[i];
                    return null
                }
                ,
                i.prototype.getLightByName = function(e) {
                    for (var t = 0; t < this.lights.length; t++)
                        if (this.lights[t].name === e)
                            return this.lights[t];
                    return null
                }
                ,
                i.prototype.getLightByID = function(e) {
                    for (var t = 0; t < this.lights.length; t++)
                        if (this.lights[t].id === e)
                            return this.lights[t];
                    return null
                }
                ,
                i.prototype.getLightByUniqueID = function(e) {
                    for (var t = 0; t < this.lights.length; t++)
                        if (this.lights[t].uniqueId === e)
                            return this.lights[t];
                    return null
                }
                ,
                i.prototype.getParticleSystemByID = function(e) {
                    for (var t = 0; t < this.particleSystems.length; t++)
                        if (this.particleSystems[t].id === e)
                            return this.particleSystems[t];
                    return null
                }
                ,
                i.prototype.getGeometryByID = function(e) {
                    for (var t = 0; t < this.geometries.length; t++)
                        if (this.geometries[t].id === e)
                            return this.geometries[t];
                    return null
                }
                ,
                i.prototype.pushGeometry = function(e, t) {
                    return !(!t && this.getGeometryByID(e.id)) && (this.geometries.push(e),
                    this.collisionCoordinator && this.collisionCoordinator.onGeometryAdded(e),
                    this.onNewGeometryAddedObservable.notifyObservers(e),
                    !0)
                }
                ,
                i.prototype.removeGeometry = function(e) {
                    var t = this.geometries.indexOf(e);
                    return t > -1 && (this.geometries.splice(t, 1),
                    this.collisionCoordinator && this.collisionCoordinator.onGeometryDeleted(e),
                    this.onGeometryRemovedObservable.notifyObservers(e),
                    !0)
                }
                ,
                i.prototype.getGeometries = function() {
                    return this.geometries
                }
                ,
                i.prototype.getMeshByID = function(e) {
                    for (var t = 0; t < this.meshes.length; t++)
                        if (this.meshes[t].id === e)
                            return this.meshes[t];
                    return null
                }
                ,
                i.prototype.getMeshesByID = function(e) {
                    return this.meshes.filter((function(t) {
                        return t.id === e
                    }
                    ))
                }
                ,
                i.prototype.getTransformNodeByID = function(e) {
                    for (var t = 0; t < this.transformNodes.length; t++)
                        if (this.transformNodes[t].id === e)
                            return this.transformNodes[t];
                    return null
                }
                ,
                i.prototype.getTransformNodesByID = function(e) {
                    return this.transformNodes.filter((function(t) {
                        return t.id === e
                    }
                    ))
                }
                ,
                i.prototype.getMeshByUniqueID = function(e) {
                    for (var t = 0; t < this.meshes.length; t++)
                        if (this.meshes[t].uniqueId === e)
                            return this.meshes[t];
                    return null
                }
                ,
                i.prototype.getLastMeshByID = function(e) {
                    for (var t = this.meshes.length - 1; t >= 0; t--)
                        if (this.meshes[t].id === e)
                            return this.meshes[t];
                    return null
                }
                ,
                i.prototype.getLastEntryByID = function(e) {
                    var t;
                    for (t = this.meshes.length - 1; t >= 0; t--)
                        if (this.meshes[t].id === e)
                            return this.meshes[t];
                    for (t = this.transformNodes.length - 1; t >= 0; t--)
                        if (this.transformNodes[t].id === e)
                            return this.transformNodes[t];
                    for (t = this.cameras.length - 1; t >= 0; t--)
                        if (this.cameras[t].id === e)
                            return this.cameras[t];
                    for (t = this.lights.length - 1; t >= 0; t--)
                        if (this.lights[t].id === e)
                            return this.lights[t];
                    return null
                }
                ,
                i.prototype.getNodeByID = function(e) {
                    var t = this.getMeshByID(e);
                    if (t)
                        return t;
                    var r = this.getLightByID(e);
                    if (r)
                        return r;
                    var i = this.getCameraByID(e);
                    return i || this.getBoneByID(e)
                }
                ,
                i.prototype.getNodeByName = function(e) {
                    var t = this.getMeshByName(e);
                    if (t)
                        return t;
                    var r = this.getLightByName(e);
                    if (r)
                        return r;
                    var i = this.getCameraByName(e);
                    return i || this.getBoneByName(e)
                }
                ,
                i.prototype.getMeshByName = function(e) {
                    for (var t = 0; t < this.meshes.length; t++)
                        if (this.meshes[t].name === e)
                            return this.meshes[t];
                    return null
                }
                ,
                i.prototype.getTransformNodeByName = function(e) {
                    for (var t = 0; t < this.transformNodes.length; t++)
                        if (this.transformNodes[t].name === e)
                            return this.transformNodes[t];
                    return null
                }
                ,
                i.prototype.getLastSkeletonByID = function(e) {
                    for (var t = this.skeletons.length - 1; t >= 0; t--)
                        if (this.skeletons[t].id === e)
                            return this.skeletons[t];
                    return null
                }
                ,
                i.prototype.getSkeletonById = function(e) {
                    for (var t = 0; t < this.skeletons.length; t++)
                        if (this.skeletons[t].id === e)
                            return this.skeletons[t];
                    return null
                }
                ,
                i.prototype.getSkeletonByName = function(e) {
                    for (var t = 0; t < this.skeletons.length; t++)
                        if (this.skeletons[t].name === e)
                            return this.skeletons[t];
                    return null
                }
                ,
                i.prototype.getMorphTargetManagerById = function(e) {
                    for (var t = 0; t < this.morphTargetManagers.length; t++)
                        if (this.morphTargetManagers[t].uniqueId === e)
                            return this.morphTargetManagers[t];
                    return null
                }
                ,
                i.prototype.isActiveMesh = function(e) {
                    return -1 !== this._activeMeshes.indexOf(e)
                }
                ,
                Object.defineProperty(i.prototype, "uid", {
                    get: function() {
                        return this._uid || (this._uid = e.Tools.RandomId()),
                        this._uid
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.addExternalData = function(t, r) {
                    return this._externalData || (this._externalData = new e.StringDictionary),
                    this._externalData.add(t, r)
                }
                ,
                i.prototype.getExternalData = function(e) {
                    return this._externalData ? this._externalData.get(e) : null
                }
                ,
                i.prototype.getOrAddExternalDataWithFactory = function(t, r) {
                    return this._externalData || (this._externalData = new e.StringDictionary),
                    this._externalData.getOrAddWithFactory(t, r)
                }
                ,
                i.prototype.removeExternalData = function(e) {
                    return this._externalData.remove(e)
                }
                ,
                i.prototype._evaluateSubMesh = function(e, t) {
                    if (this.dispatchAllSubMeshesOfActiveMeshes || t.alwaysSelectAsActiveMesh || 1 === t.subMeshes.length || e.isInFrustum(this._frustumPlanes)) {
                        for (var r = 0, i = this._evaluateSubMeshStage; r < i.length; r++) {
                            i[r].action(t, e)
                        }
                        var n = e.getMaterial();
                        null != n && (n.hasRenderTargetTextures && void 0 !== n.getRenderTargetTextures && -1 === this._processedMaterials.indexOf(n) && (this._processedMaterials.push(n),
                        this._renderTargets.concatWithNoDuplicate(n.getRenderTargetTextures())),
                        this._activeIndices.addCount(e.indexCount, !1),
                        this._renderingManager.dispatch(e, t, n))
                    }
                }
                ,
                i.prototype.freeProcessedMaterials = function() {
                    this._processedMaterials.dispose()
                }
                ,
                i.prototype.freeActiveMeshes = function() {
                    if (this._activeMeshes.dispose(),
                    this.activeCamera && this.activeCamera._activeMeshes && this.activeCamera._activeMeshes.dispose(),
                    this.activeCameras)
                        for (var e = 0; e < this.activeCameras.length; e++) {
                            var t = this.activeCameras[e];
                            t && t._activeMeshes && t._activeMeshes.dispose()
                        }
                }
                ,
                i.prototype.freeRenderingGroups = function() {
                    if (this._renderingManager && this._renderingManager.freeRenderingGroups(),
                    this.textures)
                        for (var e = 0; e < this.textures.length; e++) {
                            var t = this.textures[e];
                            t && t.renderList && t.freeRenderingGroups()
                        }
                }
                ,
                i.prototype._isInIntermediateRendering = function() {
                    return this._intermediateRendering
                }
                ,
                i.prototype.freezeActiveMeshes = function() {
                    return this.activeCamera ? (this._frustumPlanes || this.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix()),
                    this._evaluateActiveMeshes(),
                    this._activeMeshesFrozen = !0,
                    this) : this
                }
                ,
                i.prototype.unfreezeActiveMeshes = function() {
                    return this._activeMeshesFrozen = !1,
                    this
                }
                ,
                i.prototype._evaluateActiveMeshes = function() {
                    if ((!this._activeMeshesFrozen || !this._activeMeshes.length) && this.activeCamera) {
                        this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),
                        this.activeCamera._activeMeshes.reset(),
                        this._activeMeshes.reset(),
                        this._renderingManager.reset(),
                        this._processedMaterials.reset(),
                        this._activeParticleSystems.reset(),
                        this._activeSkeletons.reset(),
                        this._softwareSkinnedMeshes.reset();
                        for (var t = 0, r = this._beforeEvaluateActiveMeshStage; t < r.length; t++) {
                            r[t].action()
                        }
                        for (var i = this.getActiveMeshCandidates(), n = i.length, o = 0; o < n; o++) {
                            var a = i.data[o];
                            if (!a.isBlocked && (this._totalVertices.addCount(a.getTotalVertices(), !1),
                            a.isReady() && a.isEnabled())) {
                                a.computeWorldMatrix(),
                                a.actionManager && a.actionManager.hasSpecificTriggers2(e.ActionManager.OnIntersectionEnterTrigger, e.ActionManager.OnIntersectionExitTrigger) && this._meshesForIntersections.pushNoDuplicate(a);
                                var s = a.getLOD(this.activeCamera);
                                null != s && (a._preActivate(),
                                a.isVisible && a.visibility > 0 && (a.alwaysSelectAsActiveMesh || 0 != (a.layerMask & this.activeCamera.layerMask) && a.isInFrustum(this._frustumPlanes)) && (this._activeMeshes.push(a),
                                this.activeCamera._activeMeshes.push(a),
                                a._activate(this._renderId),
                                s !== a && s._activate(this._renderId),
                                this._activeMesh(a, s)))
                            }
                        }
                        if (this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),
                        this.particlesEnabled) {
                            this.onBeforeParticlesRenderingObservable.notifyObservers(this);
                            for (var y = 0; y < this.particleSystems.length; y++) {
                                var l = this.particleSystems[y];
                                if (l.isStarted() && l.emitter) {
                                    var c = l.emitter;
                                    c.position && !c.isEnabled() || (this._activeParticleSystems.push(l),
                                    l.animate(),
                                    this._renderingManager.dispatchParticles(l))
                                }
                            }
                            this.onAfterParticlesRenderingObservable.notifyObservers(this)
                        }
                    }
                }
                ,
                i.prototype._activeMesh = function(e, t) {
                    this._skeletonsEnabled && null !== t.skeleton && void 0 !== t.skeleton && (this._activeSkeletons.pushNoDuplicate(t.skeleton) && t.skeleton.prepare(),
                    t.computeBonesUsingShaders || this._softwareSkinnedMeshes.pushNoDuplicate(t));
                    for (var r = 0, i = this._activeMeshStage; r < i.length; r++) {
                        i[r].action(e, t)
                    }
                    if (null != t && void 0 !== t.subMeshes && null !== t.subMeshes && t.subMeshes.length > 0)
                        for (var n = this.getActiveSubMeshCandidates(t), o = n.length, a = 0; a < o; a++) {
                            var s = n.data[a];
                            this._evaluateSubMesh(s, t)
                        }
                }
                ,
                i.prototype.updateTransformMatrix = function(e) {
                    this.activeCamera && this.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix(e))
                }
                ,
                i.prototype.updateAlternateTransformMatrix = function(e) {
                    this._setAlternateTransformMatrix(e.getViewMatrix(), e.getProjectionMatrix())
                }
                ,
                i.prototype._renderForCamera = function(t, r) {
                    if (!t || !t._skipRendering) {
                        var i = this._engine;
                        if (this.activeCamera = t,
                        !this.activeCamera)
                            throw new Error("Active camera not set");
                        i.setViewport(this.activeCamera.viewport),
                        this.resetCachedMaterial(),
                        this._renderId++,
                        this.updateTransformMatrix(),
                        t._alternateCamera && (this.updateAlternateTransformMatrix(t._alternateCamera),
                        this._alternateRendering = !0),
                        this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),
                        this._evaluateActiveMeshes();
                        for (var n = 0; n < this._softwareSkinnedMeshes.length; n++) {
                            var o = this._softwareSkinnedMeshes.data[n];
                            o.applySkeleton(o.skeleton)
                        }
                        this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),
                        t.customRenderTargets && t.customRenderTargets.length > 0 && this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),
                        r && r.customRenderTargets && r.customRenderTargets.length > 0 && this._renderTargets.concatWithNoDuplicate(r.customRenderTargets);
                        for (var a = 0, s = this._gatherActiveCameraRenderTargetsStage; a < s.length; a++) {
                            s[a].action(this._renderTargets)
                        }
                        if (this.renderTargetsEnabled) {
                            if (this._intermediateRendering = !0,
                            this._renderTargets.length > 0) {
                                e.Tools.StartPerformanceCounter("Render targets", this._renderTargets.length > 0);
                                for (var y = 0; y < this._renderTargets.length; y++) {
                                    var l = this._renderTargets.data[y];
                                    if (l._shouldRender()) {
                                        this._renderId++;
                                        var c = l.activeCamera && l.activeCamera !== this.activeCamera;
                                        l.render(c, this.dumpNextRenderTargets)
                                    }
                                }
                                e.Tools.EndPerformanceCounter("Render targets", this._renderTargets.length > 0),
                                this._renderId++
                            }
                            for (var h = 0, u = this._cameraDrawRenderTargetStage; h < u.length; h++) {
                                u[h].action(this.activeCamera)
                            }
                            this._intermediateRendering = !1,
                            i.restoreDefaultFramebuffer()
                        }
                        this.onAfterRenderTargetsRenderObservable.notifyObservers(this),
                        this.postProcessManager && this.postProcessManager._prepareFrame();
                        for (var d = 0, x = this._beforeCameraDrawStage; d < x.length; d++) {
                            x[d].action(this.activeCamera)
                        }
                        this.onBeforeDrawPhaseObservable.notifyObservers(this),
                        this._renderingManager.render(null, null, !0, !0),
                        this.onAfterDrawPhaseObservable.notifyObservers(this);
                        for (var p = 0, f = this._afterCameraDrawStage; p < f.length; p++) {
                            f[p].action(this.activeCamera)
                        }
                        this.postProcessManager && this.postProcessManager._finalizeFrame(t.isIntermediate),
                        this._renderTargets.reset(),
                        this._alternateRendering = !1,
                        this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)
                    }
                }
                ,
                i.prototype._processSubCameras = function(t) {
                    if (t.cameraRigMode !== e.Camera.RIG_MODE_NONE) {
                        for (var r = 0; r < t._rigCameras.length; r++)
                            this._renderForCamera(t._rigCameras[r], t);
                        this.activeCamera = t,
                        this.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix())
                    } else
                        this._renderForCamera(t)
                }
                ,
                i.prototype._checkIntersections = function() {
                    for (var t = 0; t < this._meshesForIntersections.length; t++) {
                        var r = this._meshesForIntersections.data[t];
                        if (r.actionManager)
                            for (var i = 0; i < r.actionManager.actions.length; i++) {
                                var n = r.actionManager.actions[i];
                                if (n.trigger === e.ActionManager.OnIntersectionEnterTrigger || n.trigger === e.ActionManager.OnIntersectionExitTrigger) {
                                    var o = n.getTriggerParameter()
                                      , a = o instanceof e.AbstractMesh ? o : o.mesh
                                      , s = a.intersectsMesh(r, o.usePreciseIntersection)
                                      , y = r._intersectionsInProgress.indexOf(a);
                                    s && -1 === y ? n.trigger === e.ActionManager.OnIntersectionEnterTrigger ? (n._executeCurrent(e.ActionEvent.CreateNew(r, void 0, a)),
                                    r._intersectionsInProgress.push(a)) : n.trigger === e.ActionManager.OnIntersectionExitTrigger && r._intersectionsInProgress.push(a) : !s && y > -1 && (n.trigger === e.ActionManager.OnIntersectionExitTrigger && n._executeCurrent(e.ActionEvent.CreateNew(r, void 0, a)),
                                    r.actionManager.hasSpecificTrigger(e.ActionManager.OnIntersectionExitTrigger, (function(t) {
                                        var r = t instanceof e.AbstractMesh ? t : t.mesh;
                                        return a === r
                                    }
                                    )) && n.trigger !== e.ActionManager.OnIntersectionExitTrigger || r._intersectionsInProgress.splice(y, 1))
                                }
                            }
                    }
                }
                ,
                i.prototype._advancePhysicsEngineStep = function(e) {}
                ,
                i.prototype.render = function(t) {
                    if (void 0 === t && (t = !0),
                    !this.isDisposed) {
                        if (this._frameId++,
                        this._registerTransientComponents(),
                        this._activeParticles.fetchNewFrame(),
                        this._totalVertices.fetchNewFrame(),
                        this._activeIndices.fetchNewFrame(),
                        this._activeBones.fetchNewFrame(),
                        this._meshesForIntersections.reset(),
                        this.resetCachedMaterial(),
                        this.onBeforeAnimationsObservable.notifyObservers(this),
                        this.actionManager && this.actionManager.processTrigger(e.ActionManager.OnEveryFrameTrigger),
                        this._engine.isDeterministicLockStep()) {
                            var r = Math.max(i.MinDeltaTime, Math.min(this._engine.getDeltaTime(), i.MaxDeltaTime)) + this._timeAccumulator
                              , n = this.getDeterministicFrameTime()
                              , o = 0
                              , a = this._engine.getLockstepMaxSteps()
                              , s = Math.floor(r / 60);
                            s = Math.min(s, a);
                            do {
                                this.onBeforeStepObservable.notifyObservers(this),
                                this._animationRatio = .06 * n,
                                this._animate(),
                                this.onAfterAnimationsObservable.notifyObservers(this),
                                this._advancePhysicsEngineStep(n),
                                this.onAfterStepObservable.notifyObservers(this),
                                this._currentStepId++,
                                o++,
                                r -= n
                            } while (r > 0 && o < s);this._timeAccumulator = r < 0 ? 0 : r
                        } else {
                            r = this.useConstantAnimationDeltaTime ? 16 : Math.max(i.MinDeltaTime, Math.min(this._engine.getDeltaTime(), i.MaxDeltaTime));
                            this._animationRatio = .06 * r,
                            this._animate(),
                            this.onAfterAnimationsObservable.notifyObservers(this),
                            this._advancePhysicsEngineStep(r)
                        }
                        for (var y = 0, l = this._beforeCameraUpdateStage; y < l.length; y++) {
                            l[y].action()
                        }
                        if (t)
                            if (this.activeCameras.length > 0)
                                for (var c = 0; c < this.activeCameras.length; c++) {
                                    var h = this.activeCameras[c];
                                    if (h.update(),
                                    h.cameraRigMode !== e.Camera.RIG_MODE_NONE)
                                        for (var u = 0; u < h._rigCameras.length; u++)
                                            h._rigCameras[u].update()
                                }
                            else if (this.activeCamera && (this.activeCamera.update(),
                            this.activeCamera.cameraRigMode !== e.Camera.RIG_MODE_NONE))
                                for (u = 0; u < this.activeCamera._rigCameras.length; u++)
                                    this.activeCamera._rigCameras[u].update();
                        this.onBeforeRenderObservable.notifyObservers(this),
                        this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);
                        var d = this.getEngine()
                          , x = this.activeCamera;
                        if (this.renderTargetsEnabled) {
                            e.Tools.StartPerformanceCounter("Custom render targets", this.customRenderTargets.length > 0),
                            this._intermediateRendering = !0;
                            for (var p = 0; p < this.customRenderTargets.length; p++) {
                                var f = this.customRenderTargets[p];
                                if (f._shouldRender()) {
                                    if (this._renderId++,
                                    this.activeCamera = f.activeCamera || this.activeCamera,
                                    !this.activeCamera)
                                        throw new Error("Active camera not set");
                                    d.setViewport(this.activeCamera.viewport),
                                    this.updateTransformMatrix(),
                                    f.render(x !== this.activeCamera, this.dumpNextRenderTargets)
                                }
                            }
                            e.Tools.EndPerformanceCounter("Custom render targets", this.customRenderTargets.length > 0),
                            this._intermediateRendering = !1,
                            this._renderId++
                        }
                        this.customRenderTargets.length > 0 && d.restoreDefaultFramebuffer(),
                        this.onAfterRenderTargetsRenderObservable.notifyObservers(this),
                        this.activeCamera = x;
                        for (var m = 0, z = this._beforeClearStage; m < z.length; m++) {
                            z[m].action()
                        }
                        (this.autoClearDepthAndStencil || this.autoClear) && this._engine.clear(this.clearColor, this.autoClear || this.forceWireframe || this.forcePointsCloud, this.autoClearDepthAndStencil, this.autoClearDepthAndStencil);
                        for (var _ = 0, g = this._gatherRenderTargetsStage; _ < g.length; _++) {
                            g[_].action(this._renderTargets)
                        }
                        if (this.activeCameras.length > 0)
                            for (c = 0; c < this.activeCameras.length; c++)
                                c > 0 && this.activeCameras[c].autoClear && this._engine.clear(null, !1, !0, !0),
                                this._processSubCameras(this.activeCameras[c]);
                        else {
                            if (!this.activeCamera)
                                throw new Error("No camera defined");
                            this._processSubCameras(this.activeCamera)
                        }
                        this._checkIntersections();
                        for (var v = 0, b = this._afterRenderStage; v < b.length; v++) {
                            b[v].action()
                        }
                        if (this.afterRender && this.afterRender(),
                        this.onAfterRenderObservable.notifyObservers(this),
                        this._toBeDisposed.length) {
                            for (u = 0; u < this._toBeDisposed.length; u++) {
                                var T = this._toBeDisposed[u];
                                T && T.dispose()
                            }
                            this._toBeDisposed = []
                        }
                        this.dumpNextRenderTargets && (this.dumpNextRenderTargets = !1),
                        this._activeBones.addCount(0, !0),
                        this._activeIndices.addCount(0, !0),
                        this._activeParticles.addCount(0, !0)
                    }
                }
                ,
                i.prototype.freezeMaterials = function() {
                    for (var e = 0; e < this.materials.length; e++)
                        this.materials[e].freeze()
                }
                ,
                i.prototype.unfreezeMaterials = function() {
                    for (var e = 0; e < this.materials.length; e++)
                        this.materials[e].unfreeze()
                }
                ,
                i.prototype.dispose = function() {
                    this.beforeRender = null,
                    this.afterRender = null,
                    this.skeletons = [],
                    this.morphTargetManagers = [],
                    this._transientComponents = [],
                    this._isReadyForMeshStage.clear(),
                    this._beforeEvaluateActiveMeshStage.clear(),
                    this._evaluateSubMeshStage.clear(),
                    this._activeMeshStage.clear(),
                    this._cameraDrawRenderTargetStage.clear(),
                    this._beforeCameraDrawStage.clear(),
                    this._beforeRenderingGroupDrawStage.clear(),
                    this._beforeRenderingMeshStage.clear(),
                    this._afterRenderingMeshStage.clear(),
                    this._afterRenderingGroupDrawStage.clear(),
                    this._afterCameraDrawStage.clear(),
                    this._afterRenderStage.clear(),
                    this._beforeCameraUpdateStage.clear(),
                    this._beforeClearStage.clear(),
                    this._gatherRenderTargetsStage.clear(),
                    this._gatherActiveCameraRenderTargetsStage.clear(),
                    this._pointerMoveStage.clear(),
                    this._pointerDownStage.clear(),
                    this._pointerUpStage.clear();
                    for (var e = 0, t = this._components; e < t.length; e++) {
                        t[e].dispose()
                    }
                    this.importedMeshesFiles = new Array,
                    this.stopAllAnimations(),
                    this.resetCachedMaterial(),
                    this.activeCamera && (this.activeCamera._activeMeshes.dispose(),
                    this.activeCamera = null),
                    this._activeMeshes.dispose(),
                    this._renderingManager.dispose(),
                    this._processedMaterials.dispose(),
                    this._activeParticleSystems.dispose(),
                    this._activeSkeletons.dispose(),
                    this._softwareSkinnedMeshes.dispose(),
                    this._renderTargets.dispose(),
                    this._registeredForLateAnimationBindings.dispose(),
                    this._meshesForIntersections.dispose(),
                    this._toBeDisposed = [];
                    for (var r = 0, i = this._activeRequests; r < i.length; r++) {
                        i[r].abort()
                    }
                    this.onDisposeObservable.notifyObservers(this),
                    this.onDisposeObservable.clear(),
                    this.onBeforeRenderObservable.clear(),
                    this.onAfterRenderObservable.clear(),
                    this.onBeforeRenderTargetsRenderObservable.clear(),
                    this.onAfterRenderTargetsRenderObservable.clear(),
                    this.onAfterStepObservable.clear(),
                    this.onBeforeStepObservable.clear(),
                    this.onBeforeActiveMeshesEvaluationObservable.clear(),
                    this.onAfterActiveMeshesEvaluationObservable.clear(),
                    this.onBeforeParticlesRenderingObservable.clear(),
                    this.onAfterParticlesRenderingObservable.clear(),
                    this.onBeforeDrawPhaseObservable.clear(),
                    this.onAfterDrawPhaseObservable.clear(),
                    this.onBeforeAnimationsObservable.clear(),
                    this.onAfterAnimationsObservable.clear(),
                    this.onDataLoadedObservable.clear(),
                    this.onBeforeRenderingGroupObservable.clear(),
                    this.onAfterRenderingGroupObservable.clear(),
                    this.onMeshImportedObservable.clear(),
                    this.onBeforeCameraRenderObservable.clear(),
                    this.onAfterCameraRenderObservable.clear(),
                    this.onReadyObservable.clear(),
                    this.onNewCameraAddedObservable.clear(),
                    this.onCameraRemovedObservable.clear(),
                    this.onNewLightAddedObservable.clear(),
                    this.onLightRemovedObservable.clear(),
                    this.onNewGeometryAddedObservable.clear(),
                    this.onGeometryRemovedObservable.clear(),
                    this.onNewTransformNodeAddedObservable.clear(),
                    this.onTransformNodeRemovedObservable.clear(),
                    this.onNewMeshAddedObservable.clear(),
                    this.onMeshRemovedObservable.clear(),
                    this.onNewMaterialAddedObservable.clear(),
                    this.onMaterialRemovedObservable.clear(),
                    this.onNewTextureAddedObservable.clear(),
                    this.onTextureRemovedObservable.clear(),
                    this.onPrePointerObservable.clear(),
                    this.onPointerObservable.clear(),
                    this.onPreKeyboardObservable.clear(),
                    this.onKeyboardObservable.clear(),
                    this.detachControl();
                    var n, o = this._engine.getRenderingCanvas();
                    if (o)
                        for (n = 0; n < this.cameras.length; n++)
                            this.cameras[n].detachControl(o);
                    for (; this.animationGroups.length; )
                        this.animationGroups[0].dispose();
                    for (; this.lights.length; )
                        this.lights[0].dispose();
                    for (; this.meshes.length; )
                        this.meshes[0].dispose(!0);
                    for (; this.transformNodes.length; )
                        this.removeTransformNode(this.transformNodes[0]);
                    for (; this.cameras.length; )
                        this.cameras[0].dispose();
                    for (this.defaultMaterial && this.defaultMaterial.dispose(); this.multiMaterials.length; )
                        this.multiMaterials[0].dispose();
                    for (; this.materials.length; )
                        this.materials[0].dispose();
                    for (; this.particleSystems.length; )
                        this.particleSystems[0].dispose();
                    for (; this.postProcesses.length; )
                        this.postProcesses[0].dispose();
                    for (; this.textures.length; )
                        this.textures[0].dispose();
                    this._sceneUbo.dispose(),
                    this._alternateSceneUbo && this._alternateSceneUbo.dispose(),
                    this.postProcessManager.dispose(),
                    (n = this._engine.scenes.indexOf(this)) > -1 && this._engine.scenes.splice(n, 1),
                    this._engine.wipeCaches(!0),
                    this._isDisposed = !0
                }
                ,
                Object.defineProperty(i.prototype, "isDisposed", {
                    get: function() {
                        return this._isDisposed
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.clearCachedVertexData = function() {
                    for (var e = 0; e < this.meshes.length; e++) {
                        var t = this.meshes[e].geometry;
                        if (t)
                            for (var r in t._indices = [],
                            t._vertexBuffers)
                                t._vertexBuffers.hasOwnProperty(r) && (t._vertexBuffers[r]._buffer._data = null)
                    }
                }
                ,
                i.prototype.cleanCachedTextureBuffer = function() {
                    for (var e = 0, t = this.textures; e < t.length; e++) {
                        var r = t[e];
                        r._buffer && (r._buffer = null)
                    }
                }
                ,
                i.prototype.getWorldExtends = function(t) {
                    var r = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)
                      , i = new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);
                    return t = t || function() {
                        return !0
                    }
                    ,
                    this.meshes.filter(t).forEach((function(t) {
                        if (t.computeWorldMatrix(!0),
                        t.subMeshes && 0 !== t.subMeshes.length && !t.infiniteDistance) {
                            var n = t.getBoundingInfo()
                              , o = n.boundingBox.minimumWorld
                              , a = n.boundingBox.maximumWorld;
                            e.Tools.CheckExtends(o, r, i),
                            e.Tools.CheckExtends(a, r, i)
                        }
                    }
                    )),
                    {
                        min: r,
                        max: i
                    }
                }
                ,
                i.prototype.createPickingRay = function(t, r, i, n, o) {
                    void 0 === o && (o = !1);
                    var a = e.Ray.Zero();
                    return this.createPickingRayToRef(t, r, i, a, n, o),
                    a
                }
                ,
                i.prototype.createPickingRayToRef = function(t, r, i, n, o, a) {
                    void 0 === a && (a = !1);
                    var s = this._engine;
                    if (!o) {
                        if (!this.activeCamera)
                            throw new Error("Active camera not set");
                        o = this.activeCamera
                    }
                    var y = o.viewport.toGlobal(s.getRenderWidth(), s.getRenderHeight());
                    return t = t / this._engine.getHardwareScalingLevel() - y.x,
                    r = r / this._engine.getHardwareScalingLevel() - (this._engine.getRenderHeight() - y.y - y.height),
                    n.update(t, r, y.width, y.height, i || e.Matrix.Identity(), a ? e.Matrix.Identity() : o.getViewMatrix(), o.getProjectionMatrix()),
                    this
                }
                ,
                i.prototype.createPickingRayInCameraSpace = function(t, r, i) {
                    var n = e.Ray.Zero();
                    return this.createPickingRayInCameraSpaceToRef(t, r, n, i),
                    n
                }
                ,
                i.prototype.createPickingRayInCameraSpaceToRef = function(t, r, i, n) {
                    if (!e.PickingInfo)
                        return this;
                    var o = this._engine;
                    if (!n) {
                        if (!this.activeCamera)
                            throw new Error("Active camera not set");
                        n = this.activeCamera
                    }
                    var a = n.viewport.toGlobal(o.getRenderWidth(), o.getRenderHeight())
                      , s = e.Matrix.Identity();
                    return t = t / this._engine.getHardwareScalingLevel() - a.x,
                    r = r / this._engine.getHardwareScalingLevel() - (this._engine.getRenderHeight() - a.y - a.height),
                    i.update(t, r, a.width, a.height, s, s, n.getProjectionMatrix()),
                    this
                }
                ,
                i.prototype._internalPick = function(t, r, i) {
                    if (!e.PickingInfo)
                        return null;
                    for (var n = null, o = 0; o < this.meshes.length; o++) {
                        var a = this.meshes[o];
                        if (r) {
                            if (!r(a))
                                continue
                        } else if (!a.isEnabled() || !a.isVisible || !a.isPickable)
                            continue;
                        var s = t(a.getWorldMatrix())
                          , y = a.intersects(s, i);
                        if (y && y.hit && ((i || null == n || !(y.distance >= n.distance)) && (n = y,
                        i)))
                            break
                    }
                    return n || new e.PickingInfo
                }
                ,
                i.prototype._internalMultiPick = function(t, r) {
                    if (!e.PickingInfo)
                        return null;
                    for (var i = new Array, n = 0; n < this.meshes.length; n++) {
                        var o = this.meshes[n];
                        if (r) {
                            if (!r(o))
                                continue
                        } else if (!o.isEnabled() || !o.isVisible || !o.isPickable)
                            continue;
                        var a = t(o.getWorldMatrix())
                          , s = o.intersects(a, !1);
                        s && s.hit && i.push(s)
                    }
                    return i
                }
                ,
                i.prototype.pick = function(t, r, i, n, o) {
                    var a = this;
                    if (!e.PickingInfo)
                        return null;
                    var s = this._internalPick((function(e) {
                        return a.createPickingRayToRef(t, r, e, a._tempPickingRay, o || null),
                        a._tempPickingRay
                    }
                    ), i, n);
                    return s && (s.ray = this.createPickingRay(t, r, e.Matrix.Identity(), o || null)),
                    s
                }
                ,
                i.prototype.pickWithRay = function(t, r, i) {
                    var n = this
                      , o = this._internalPick((function(r) {
                        return n._pickWithRayInverseMatrix || (n._pickWithRayInverseMatrix = e.Matrix.Identity()),
                        r.invertToRef(n._pickWithRayInverseMatrix),
                        n._cachedRayForTransform || (n._cachedRayForTransform = e.Ray.Zero()),
                        e.Ray.TransformToRef(t, n._pickWithRayInverseMatrix, n._cachedRayForTransform),
                        n._cachedRayForTransform
                    }
                    ), r, i);
                    return o && (o.ray = t),
                    o
                }
                ,
                i.prototype.multiPick = function(e, t, r, i) {
                    var n = this;
                    return this._internalMultiPick((function(r) {
                        return n.createPickingRay(e, t, r, i || null)
                    }
                    ), r)
                }
                ,
                i.prototype.multiPickWithRay = function(t, r) {
                    var i = this;
                    return this._internalMultiPick((function(r) {
                        return i._pickWithRayInverseMatrix || (i._pickWithRayInverseMatrix = e.Matrix.Identity()),
                        r.invertToRef(i._pickWithRayInverseMatrix),
                        i._cachedRayForTransform || (i._cachedRayForTransform = e.Ray.Zero()),
                        e.Ray.TransformToRef(t, i._pickWithRayInverseMatrix, i._cachedRayForTransform),
                        i._cachedRayForTransform
                    }
                    ), r)
                }
                ,
                i.prototype.setPointerOverMesh = function(t) {
                    this._pointerOverMesh !== t && (this._pointerOverMesh && this._pointerOverMesh.actionManager && this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger, e.ActionEvent.CreateNew(this._pointerOverMesh)),
                    this._pointerOverMesh = t,
                    this._pointerOverMesh && this._pointerOverMesh.actionManager && this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger, e.ActionEvent.CreateNew(this._pointerOverMesh)))
                }
                ,
                i.prototype.getPointerOverMesh = function() {
                    return this._pointerOverMesh
                }
                ,
                i.prototype._rebuildGeometries = function() {
                    for (var e = 0, t = this.geometries; e < t.length; e++) {
                        t[e]._rebuild()
                    }
                    for (var r = 0, i = this.meshes; r < i.length; r++) {
                        i[r]._rebuild()
                    }
                    this.postProcessManager && this.postProcessManager._rebuild();
                    for (var n = 0, o = this._components; n < o.length; n++) {
                        o[n].rebuild()
                    }
                    for (var a = 0, s = this.particleSystems; a < s.length; a++) {
                        s[a].rebuild()
                    }
                }
                ,
                i.prototype._rebuildTextures = function() {
                    for (var t = 0, r = this.textures; t < r.length; t++) {
                        r[t]._rebuild()
                    }
                    this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag)
                }
                ,
                i.prototype._getByTags = function(t, r, i) {
                    if (void 0 === r)
                        return t;
                    var n = [];
                    for (var o in i = i || function(e) {}
                    ,
                    t) {
                        var a = t[o];
                        e.Tags && e.Tags.MatchesQuery(a, r) && (n.push(a),
                        i(a))
                    }
                    return n
                }
                ,
                i.prototype.getMeshesByTags = function(e, t) {
                    return this._getByTags(this.meshes, e, t)
                }
                ,
                i.prototype.getCamerasByTags = function(e, t) {
                    return this._getByTags(this.cameras, e, t)
                }
                ,
                i.prototype.getLightsByTags = function(e, t) {
                    return this._getByTags(this.lights, e, t)
                }
                ,
                i.prototype.getMaterialByTags = function(e, t) {
                    return this._getByTags(this.materials, e, t).concat(this._getByTags(this.multiMaterials, e, t))
                }
                ,
                i.prototype.setRenderingOrder = function(e, t, r, i) {
                    void 0 === t && (t = null),
                    void 0 === r && (r = null),
                    void 0 === i && (i = null),
                    this._renderingManager.setRenderingOrder(e, t, r, i)
                }
                ,
                i.prototype.setRenderingAutoClearDepthStencil = function(e, t, r, i) {
                    void 0 === r && (r = !0),
                    void 0 === i && (i = !0),
                    this._renderingManager.setRenderingAutoClearDepthStencil(e, t, r, i)
                }
                ,
                i.prototype.getAutoClearDepthStencilSetup = function(e) {
                    return this._renderingManager.getAutoClearDepthStencilSetup(e)
                }
                ,
                Object.defineProperty(i.prototype, "blockMaterialDirtyMechanism", {
                    get: function() {
                        return this._blockMaterialDirtyMechanism
                    },
                    set: function(t) {
                        this._blockMaterialDirtyMechanism !== t && (this._blockMaterialDirtyMechanism = t,
                        t || this.markAllMaterialsAsDirty(e.Material.AllDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.markAllMaterialsAsDirty = function(e, t) {
                    if (!this._blockMaterialDirtyMechanism)
                        for (var r = 0, i = this.materials; r < i.length; r++) {
                            var n = i[r];
                            t && !t(n) || n.markAsDirty(e)
                        }
                }
                ,
                i.prototype._loadFile = function(t, r, i, n, o, a) {
                    var s = this
                      , y = e.Tools.LoadFile(t, r, i, n ? this.database : void 0, o, a);
                    return this._activeRequests.push(y),
                    y.onCompleteObservable.add((function(e) {
                        s._activeRequests.splice(s._activeRequests.indexOf(e), 1)
                    }
                    )),
                    y
                }
                ,
                i.prototype._loadFileAsync = function(e, t, r) {
                    var i = this;
                    return new Promise((function(n, o) {
                        i._loadFile(e, (function(e) {
                            n(e)
                        }
                        ), void 0, t, r, (function(e, t) {
                            o(t)
                        }
                        ))
                    }
                    ))
                }
                ,
                i._uniqueIdCounter = 0,
                i.FOGMODE_NONE = 0,
                i.FOGMODE_EXP = 1,
                i.FOGMODE_EXP2 = 2,
                i.FOGMODE_LINEAR = 3,
                i.MinDeltaTime = 1,
                i.MaxDeltaTime = 1e3,
                i.DragMovementThreshold = 10,
                i.LongPressDelay = 500,
                i.DoubleClickDelay = 300,
                i.ExclusiveDoubleClickMode = !1,
                i
            }(e.AbstractScene);
            e.Scene = i
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t
            }(e.AbstractScene);
            e.KeepAssets = t;
            var r = function(r) {
                function i(e) {
                    var t = r.call(this) || this;
                    return t.scene = e,
                    t
                }
                return o(i, r),
                i.prototype.addAllToScene = function() {
                    var e = this;
                    this.cameras.forEach((function(t) {
                        e.scene.addCamera(t)
                    }
                    )),
                    this.lights.forEach((function(t) {
                        e.scene.addLight(t)
                    }
                    )),
                    this.meshes.forEach((function(t) {
                        e.scene.addMesh(t)
                    }
                    )),
                    this.skeletons.forEach((function(t) {
                        e.scene.addSkeleton(t)
                    }
                    )),
                    this.animations.forEach((function(t) {
                        e.scene.addAnimation(t)
                    }
                    )),
                    this.animationGroups.forEach((function(t) {
                        e.scene.addAnimationGroup(t)
                    }
                    )),
                    this.multiMaterials.forEach((function(t) {
                        e.scene.addMultiMaterial(t)
                    }
                    )),
                    this.materials.forEach((function(t) {
                        e.scene.addMaterial(t)
                    }
                    )),
                    this.morphTargetManagers.forEach((function(t) {
                        e.scene.addMorphTargetManager(t)
                    }
                    )),
                    this.geometries.forEach((function(t) {
                        e.scene.addGeometry(t)
                    }
                    )),
                    this.transformNodes.forEach((function(t) {
                        e.scene.addTransformNode(t)
                    }
                    )),
                    this.actionManagers.forEach((function(t) {
                        e.scene.addActionManager(t)
                    }
                    )),
                    this.textures.forEach((function(t) {
                        e.scene.addTexture(t)
                    }
                    ));
                    for (var t = 0, r = this.scene._serializableComponents; t < r.length; t++) {
                        r[t].addFromContainer(this.scene)
                    }
                }
                ,
                i.prototype.removeAllFromScene = function() {
                    var e = this;
                    this.cameras.forEach((function(t) {
                        e.scene.removeCamera(t)
                    }
                    )),
                    this.lights.forEach((function(t) {
                        e.scene.removeLight(t)
                    }
                    )),
                    this.meshes.forEach((function(t) {
                        e.scene.removeMesh(t)
                    }
                    )),
                    this.skeletons.forEach((function(t) {
                        e.scene.removeSkeleton(t)
                    }
                    )),
                    this.animations.forEach((function(t) {
                        e.scene.removeAnimation(t)
                    }
                    )),
                    this.animationGroups.forEach((function(t) {
                        e.scene.removeAnimationGroup(t)
                    }
                    )),
                    this.multiMaterials.forEach((function(t) {
                        e.scene.removeMultiMaterial(t)
                    }
                    )),
                    this.materials.forEach((function(t) {
                        e.scene.removeMaterial(t)
                    }
                    )),
                    this.morphTargetManagers.forEach((function(t) {
                        e.scene.removeMorphTargetManager(t)
                    }
                    )),
                    this.geometries.forEach((function(t) {
                        e.scene.removeGeometry(t)
                    }
                    )),
                    this.transformNodes.forEach((function(t) {
                        e.scene.removeTransformNode(t)
                    }
                    )),
                    this.actionManagers.forEach((function(t) {
                        e.scene.removeActionManager(t)
                    }
                    )),
                    this.textures.forEach((function(t) {
                        e.scene.removeTexture(t)
                    }
                    ));
                    for (var t = 0, r = this.scene._serializableComponents; t < r.length; t++) {
                        r[t].removeFromContainer(this.scene)
                    }
                }
                ,
                i.prototype._moveAssets = function(e, t, r) {
                    if (e)
                        for (var i = 0, n = e; i < n.length; i++) {
                            var o = n[i]
                              , a = !0;
                            if (r)
                                for (var s = 0, y = r; s < y.length; s++) {
                                    if (o === y[s]) {
                                        a = !1;
                                        break
                                    }
                                }
                            a && t.push(o)
                        }
                }
                ,
                i.prototype.moveAllFromScene = function(e) {
                    for (var r in void 0 === e && (e = new t),
                    this)
                        this.hasOwnProperty(r) && (this[r] = this[r] || [],
                        this._moveAssets(this.scene[r], this[r], e[r]));
                    this.removeAllFromScene()
                }
                ,
                i.prototype.createRootMesh = function() {
                    var t = new e.Mesh("assetContainerRootMesh",this.scene);
                    return this.meshes.forEach((function(e) {
                        e.parent || t.addChild(e)
                    }
                    )),
                    this.meshes.unshift(t),
                    t
                }
                ,
                i
            }(e.AbstractScene);
            e.AssetContainer = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n, o, a, s) {
                    void 0 === n && (n = 0),
                    void 0 === o && (o = !1),
                    void 0 === a && (a = !1),
                    void 0 === s && (s = !1),
                    t instanceof e.Mesh ? this._engine = t.getScene().getEngine() : this._engine = t,
                    this._updatable = i,
                    this._instanced = a,
                    this._data = r,
                    this.byteStride = s ? n : n * Float32Array.BYTES_PER_ELEMENT,
                    o || this.create()
                }
                return t.prototype.createVertexBuffer = function(t, r, i, n, o, a) {
                    void 0 === a && (a = !1);
                    var s = a ? r : r * Float32Array.BYTES_PER_ELEMENT
                      , y = n ? a ? n : n * Float32Array.BYTES_PER_ELEMENT : this.byteStride;
                    return new e.VertexBuffer(this._engine,this,t,this._updatable,!0,y,void 0 === o ? this._instanced : o,s,i,void 0,void 0,!0)
                }
                ,
                t.prototype.isUpdatable = function() {
                    return this._updatable
                }
                ,
                t.prototype.getData = function() {
                    return this._data
                }
                ,
                t.prototype.getBuffer = function() {
                    return this._buffer
                }
                ,
                t.prototype.getStrideSize = function() {
                    return this.byteStride / Float32Array.BYTES_PER_ELEMENT
                }
                ,
                t.prototype.create = function(e) {
                    void 0 === e && (e = null),
                    !e && this._buffer || (e = e || this._data) && (this._buffer ? this._updatable && (this._engine.updateDynamicVertexBuffer(this._buffer, e),
                    this._data = e) : this._updatable ? (this._buffer = this._engine.createDynamicVertexBuffer(e),
                    this._data = e) : this._buffer = this._engine.createVertexBuffer(e))
                }
                ,
                t.prototype._rebuild = function() {
                    this._buffer = null,
                    this.create(this._data)
                }
                ,
                t.prototype.update = function(e) {
                    this.create(e)
                }
                ,
                t.prototype.updateDirectly = function(e, t, r, i) {
                    void 0 === i && (i = !1),
                    this._buffer && this._updatable && (this._engine.updateDynamicVertexBuffer(this._buffer, e, i ? t : t * Float32Array.BYTES_PER_ELEMENT, r ? r * this.byteStride : void 0),
                    this._data = null)
                }
                ,
                t.prototype.dispose = function() {
                    this._buffer && this._engine._releaseBuffer(this._buffer) && (this._buffer = null)
                }
                ,
                t
            }();
            e.Buffer = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(r, i, n, o, a, s, y, l, c, h, u, d) {
                    if (void 0 === u && (u = !1),
                    void 0 === d && (d = !1),
                    i instanceof e.Buffer ? (this._buffer = i,
                    this._ownsBuffer = !1) : (this._buffer = new e.Buffer(r,i,o,s,a,y,d),
                    this._ownsBuffer = !0),
                    this._kind = n,
                    null == h) {
                        var x = this.getData();
                        this.type = t.FLOAT,
                        x instanceof Int8Array ? this.type = t.BYTE : x instanceof Uint8Array ? this.type = t.UNSIGNED_BYTE : x instanceof Int16Array ? this.type = t.SHORT : x instanceof Uint16Array ? this.type = t.UNSIGNED_SHORT : x instanceof Int32Array ? this.type = t.INT : x instanceof Uint32Array && (this.type = t.UNSIGNED_INT)
                    } else
                        this.type = h;
                    var p = t.GetTypeByteLength(this.type);
                    d ? (this._size = c || (s ? s / p : t.DeduceStride(n)),
                    this.byteStride = s || this._buffer.byteStride || this._size * p,
                    this.byteOffset = l || 0) : (this._size = c || s || t.DeduceStride(n),
                    this.byteStride = s ? s * p : this._buffer.byteStride || this._size * p,
                    this.byteOffset = (l || 0) * p),
                    this.normalized = u,
                    this._instanced = void 0 !== y && y,
                    this._instanceDivisor = y ? 1 : 0
                }
                return Object.defineProperty(t.prototype, "instanceDivisor", {
                    get: function() {
                        return this._instanceDivisor
                    },
                    set: function(e) {
                        this._instanceDivisor = e,
                        this._instanced = 0 != e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._rebuild = function() {
                    this._buffer && this._buffer._rebuild()
                }
                ,
                t.prototype.getKind = function() {
                    return this._kind
                }
                ,
                t.prototype.isUpdatable = function() {
                    return this._buffer.isUpdatable()
                }
                ,
                t.prototype.getData = function() {
                    return this._buffer.getData()
                }
                ,
                t.prototype.getBuffer = function() {
                    return this._buffer.getBuffer()
                }
                ,
                t.prototype.getStrideSize = function() {
                    return this.byteStride / t.GetTypeByteLength(this.type)
                }
                ,
                t.prototype.getOffset = function() {
                    return this.byteOffset / t.GetTypeByteLength(this.type)
                }
                ,
                t.prototype.getSize = function() {
                    return this._size
                }
                ,
                t.prototype.getIsInstanced = function() {
                    return this._instanced
                }
                ,
                t.prototype.getInstanceDivisor = function() {
                    return this._instanceDivisor
                }
                ,
                t.prototype.create = function(e) {
                    this._buffer.create(e)
                }
                ,
                t.prototype.update = function(e) {
                    this._buffer.update(e)
                }
                ,
                t.prototype.updateDirectly = function(e, t, r) {
                    void 0 === r && (r = !1),
                    this._buffer.updateDirectly(e, t, void 0, r)
                }
                ,
                t.prototype.dispose = function() {
                    this._ownsBuffer && this._buffer.dispose()
                }
                ,
                t.prototype.forEach = function(e, r) {
                    t.ForEach(this._buffer.getData(), this.byteOffset, this.byteStride, this._size, this.type, e, this.normalized, r)
                }
                ,
                t.DeduceStride = function(e) {
                    switch (e) {
                    case t.UVKind:
                    case t.UV2Kind:
                    case t.UV3Kind:
                    case t.UV4Kind:
                    case t.UV5Kind:
                    case t.UV6Kind:
                        return 2;
                    case t.NormalKind:
                    case t.PositionKind:
                        return 3;
                    case t.ColorKind:
                    case t.MatricesIndicesKind:
                    case t.MatricesIndicesExtraKind:
                    case t.MatricesWeightsKind:
                    case t.MatricesWeightsExtraKind:
                    case t.TangentKind:
                        return 4;
                    default:
                        throw new Error("Invalid kind '" + e + "'")
                    }
                }
                ,
                t.GetTypeByteLength = function(e) {
                    switch (e) {
                    case t.BYTE:
                    case t.UNSIGNED_BYTE:
                        return 1;
                    case t.SHORT:
                    case t.UNSIGNED_SHORT:
                        return 2;
                    case t.INT:
                    case t.FLOAT:
                        return 4;
                    default:
                        throw new Error("Invalid type '" + e + "'")
                    }
                }
                ,
                t.ForEach = function(e, r, i, n, o, a, s, y) {
                    if (e instanceof Array)
                        for (var l = r / 4, c = i / 4, h = 0; h < a; h += n) {
                            for (var u = 0; u < n; u++)
                                y(e[l + u], h + u);
                            l += c
                        }
                    else {
                        var d = e instanceof ArrayBuffer ? new DataView(e) : new DataView(e.buffer,e.byteOffset,e.byteLength)
                          , x = t.GetTypeByteLength(o);
                        for (h = 0; h < a; h += n) {
                            var p = r;
                            for (u = 0; u < n; u++) {
                                y(t._GetFloatValue(d, o, p, s), h + u),
                                p += x
                            }
                            r += i
                        }
                    }
                }
                ,
                t._GetFloatValue = function(e, r, i, n) {
                    switch (r) {
                    case t.BYTE:
                        var o = e.getInt8(i);
                        return n && (o = Math.max(o / 127, -1)),
                        o;
                    case t.UNSIGNED_BYTE:
                        o = e.getUint8(i);
                        return n && (o /= 255),
                        o;
                    case t.SHORT:
                        o = e.getInt16(i, !0);
                        return n && (o = Math.max(o / 16383, -1)),
                        o;
                    case t.UNSIGNED_SHORT:
                        o = e.getUint16(i, !0);
                        return n && (o /= 65535),
                        o;
                    case t.FLOAT:
                        return e.getFloat32(i, !0);
                    default:
                        throw new Error("Invalid component type " + r)
                    }
                }
                ,
                t.BYTE = 5120,
                t.UNSIGNED_BYTE = 5121,
                t.SHORT = 5122,
                t.UNSIGNED_SHORT = 5123,
                t.INT = 5124,
                t.UNSIGNED_INT = 5125,
                t.FLOAT = 5126,
                t.PositionKind = "position",
                t.NormalKind = "normal",
                t.TangentKind = "tangent",
                t.UVKind = "uv",
                t.UV2Kind = "uv2",
                t.UV3Kind = "uv3",
                t.UV4Kind = "uv4",
                t.UV5Kind = "uv5",
                t.UV6Kind = "uv6",
                t.ColorKind = "color",
                t.MatricesIndicesKind = "matricesIndices",
                t.MatricesWeightsKind = "matricesWeights",
                t.MatricesIndicesExtraKind = "matricesIndicesExtra",
                t.MatricesWeightsExtraKind = "matricesWeightsExtra",
                t
            }();
            e.VertexBuffer = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                this.previous = null,
                this.next = null
            };
            e.DummyInternalTextureTracker = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(r, i) {
                    this.onLoadedObservable = new e.Observable,
                    this.previous = null,
                    this.next = null,
                    this._initialSlot = -1,
                    this._designatedSlot = -1,
                    this._dataSource = t.DATASOURCE_UNKNOWN,
                    this._comparisonFunction = 0,
                    this._sphericalPolynomial = null,
                    this._lodGenerationScale = 0,
                    this._lodGenerationOffset = 0,
                    this._isRGBD = !1,
                    this._references = 1,
                    this._engine = r,
                    this._dataSource = i,
                    this._webGLTexture = r._createTexture()
                }
                return t.prototype.getEngine = function() {
                    return this._engine
                }
                ,
                Object.defineProperty(t.prototype, "dataSource", {
                    get: function() {
                        return this._dataSource
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.incrementReferences = function() {
                    this._references++
                }
                ,
                t.prototype.updateSize = function(e, t, r) {
                    void 0 === r && (r = 1),
                    this.width = e,
                    this.height = t,
                    this.depth = r,
                    this.baseWidth = e,
                    this.baseHeight = t,
                    this.baseDepth = r,
                    this._size = e * t * r
                }
                ,
                t.prototype._rebuild = function() {
                    var r, i = this;
                    switch (this.isReady = !1,
                    this._cachedCoordinatesMode = null,
                    this._cachedWrapU = null,
                    this._cachedWrapV = null,
                    this._cachedAnisotropicFilteringLevel = null,
                    this._dataSource) {
                    case t.DATASOURCE_TEMP:
                        return;
                    case t.DATASOURCE_URL:
                        return void (r = this._engine.createTexture(this.url, !this.generateMipMaps, this.invertY, null, this.samplingMode, (function() {
                            i.isReady = !0
                        }
                        ), null, this._buffer, void 0, this.format))._swapAndDie(this);
                    case t.DATASOURCE_RAW:
                        return (r = this._engine.createRawTexture(this._bufferView, this.baseWidth, this.baseHeight, this.format, this.generateMipMaps, this.invertY, this.samplingMode, this._compression))._swapAndDie(this),
                        void (this.isReady = !0);
                    case t.DATASOURCE_RAW3D:
                        return (r = this._engine.createRawTexture3D(this._bufferView, this.baseWidth, this.baseHeight, this.baseDepth, this.format, this.generateMipMaps, this.invertY, this.samplingMode, this._compression))._swapAndDie(this),
                        void (this.isReady = !0);
                    case t.DATASOURCE_DYNAMIC:
                        return void (r = this._engine.createDynamicTexture(this.baseWidth, this.baseHeight, this.generateMipMaps, this.samplingMode))._swapAndDie(this);
                    case t.DATASOURCE_RENDERTARGET:
                        var n = new e.RenderTargetCreationOptions;
                        if (n.generateDepthBuffer = this._generateDepthBuffer,
                        n.generateMipMaps = this.generateMipMaps,
                        n.generateStencilBuffer = this._generateStencilBuffer,
                        n.samplingMode = this.samplingMode,
                        n.type = this.type,
                        this.isCube)
                            r = this._engine.createRenderTargetCubeTexture(this.width, n);
                        else {
                            var o = {
                                width: this.width,
                                height: this.height
                            };
                            r = this._engine.createRenderTargetTexture(o, n)
                        }
                        return r._swapAndDie(this),
                        void (this.isReady = !0);
                    case t.DATASOURCE_DEPTHTEXTURE:
                        var a = {
                            bilinearFiltering: this.samplingMode !== e.Texture.BILINEAR_SAMPLINGMODE,
                            comparisonFunction: this._comparisonFunction,
                            generateStencil: this._generateStencilBuffer,
                            isCube: this.isCube
                        };
                        return (r = this._engine.createDepthStencilTexture({
                            width: this.width,
                            height: this.height
                        }, a))._swapAndDie(this),
                        void (this.isReady = !0);
                    case t.DATASOURCE_CUBE:
                        return void (r = this._engine.createCubeTexture(this.url, null, this._files, !this.generateMipMaps, (function() {
                            i.isReady = !0
                        }
                        ), null, this.format, this._extension))._swapAndDie(this);
                    case t.DATASOURCE_CUBERAW:
                        return (r = this._engine.createRawCubeTexture(this._bufferViewArray, this.width, this.format, this.type, this.generateMipMaps, this.invertY, this.samplingMode, this._compression))._swapAndDie(this),
                        void (this.isReady = !0);
                    case t.DATASOURCE_CUBERAW_RGBD:
                        return r = this._engine.createRawCubeTexture(null, this.width, this.format, this.type, this.generateMipMaps, this.invertY, this.samplingMode, this._compression),
                        e.RawCubeTexture._UpdateRGBDAsync(r, this._bufferViewArrayArray, this._sphericalPolynomial, this._lodGenerationScale, this._lodGenerationOffset).then((function() {
                            i.isReady = !0
                        }
                        )),
                        void r._swapAndDie(this);
                    case t.DATASOURCE_CUBEPREFILTERED:
                        return void ((r = this._engine.createPrefilteredCubeTexture(this.url, null, this._lodGenerationScale, this._lodGenerationOffset, (function(e) {
                            e && e._swapAndDie(i),
                            i.isReady = !0
                        }
                        ), null, this.format, this._extension))._sphericalPolynomial = this._sphericalPolynomial)
                    }
                }
                ,
                t.prototype._swapAndDie = function(e) {
                    e._webGLTexture = this._webGLTexture,
                    this._framebuffer && (e._framebuffer = this._framebuffer),
                    this._depthStencilBuffer && (e._depthStencilBuffer = this._depthStencilBuffer),
                    this._lodTextureHigh && (e._lodTextureHigh && e._lodTextureHigh.dispose(),
                    e._lodTextureHigh = this._lodTextureHigh),
                    this._lodTextureMid && (e._lodTextureMid && e._lodTextureMid.dispose(),
                    e._lodTextureMid = this._lodTextureMid),
                    this._lodTextureLow && (e._lodTextureLow && e._lodTextureLow.dispose(),
                    e._lodTextureLow = this._lodTextureLow);
                    var t = this._engine.getLoadedTexturesCache()
                      , r = t.indexOf(this);
                    -1 !== r && t.splice(r, 1)
                }
                ,
                t.prototype.dispose = function() {
                    this._webGLTexture && (this._references--,
                    0 === this._references && (this._engine._releaseTexture(this),
                    this._webGLTexture = null,
                    this.previous = null,
                    this.next = null))
                }
                ,
                t.DATASOURCE_UNKNOWN = 0,
                t.DATASOURCE_URL = 1,
                t.DATASOURCE_TEMP = 2,
                t.DATASOURCE_RAW = 3,
                t.DATASOURCE_DYNAMIC = 4,
                t.DATASOURCE_RENDERTARGET = 5,
                t.DATASOURCE_MULTIRENDERTARGET = 6,
                t.DATASOURCE_CUBE = 7,
                t.DATASOURCE_CUBERAW = 8,
                t.DATASOURCE_CUBEPREFILTERED = 9,
                t.DATASOURCE_RAW3D = 10,
                t.DATASOURCE_DEPTHTEXTURE = 11,
                t.DATASOURCE_CUBERAW_RGBD = 12,
                t
            }();
            e.InternalTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(r) {
                    this._hasAlpha = !1,
                    this.getAlphaFromRGB = !1,
                    this.level = 1,
                    this.coordinatesIndex = 0,
                    this._coordinatesMode = e.Texture.EXPLICIT_MODE,
                    this.wrapU = e.Texture.WRAP_ADDRESSMODE,
                    this.wrapV = e.Texture.WRAP_ADDRESSMODE,
                    this.wrapR = e.Texture.WRAP_ADDRESSMODE,
                    this.anisotropicFilteringLevel = t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,
                    this.isCube = !1,
                    this.is3D = !1,
                    this.gammaSpace = !0,
                    this.invertZ = !1,
                    this.lodLevelInAlpha = !1,
                    this.isRenderTarget = !1,
                    this.animations = new Array,
                    this.onDisposeObservable = new e.Observable,
                    this.delayLoadState = e.Engine.DELAYLOADSTATE_NONE,
                    this._cachedSize = e.Size.Zero(),
                    this._scene = r || e.Engine.LastCreatedScene,
                    this._scene && (this._scene.textures.push(this),
                    this._scene.onNewTextureAddedObservable.notifyObservers(this)),
                    this._uid = null
                }
                return Object.defineProperty(t.prototype, "hasAlpha", {
                    get: function() {
                        return this._hasAlpha
                    },
                    set: function(t) {
                        this._hasAlpha !== t && (this._hasAlpha = t,
                        this._scene && this._scene.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag | e.Material.MiscDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "coordinatesMode", {
                    get: function() {
                        return this._coordinatesMode
                    },
                    set: function(t) {
                        this._coordinatesMode !== t && (this._coordinatesMode = t,
                        this._scene && this._scene.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "isRGBD", {
                    get: function() {
                        return null != this._texture && this._texture._isRGBD
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "lodGenerationOffset", {
                    get: function() {
                        return this._texture ? this._texture._lodGenerationOffset : 0
                    },
                    set: function(e) {
                        this._texture && (this._texture._lodGenerationOffset = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "lodGenerationScale", {
                    get: function() {
                        return this._texture ? this._texture._lodGenerationScale : 0
                    },
                    set: function(e) {
                        this._texture && (this._texture._lodGenerationScale = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "uid", {
                    get: function() {
                        return this._uid || (this._uid = e.Tools.RandomId()),
                        this._uid
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.toString = function() {
                    return this.name
                }
                ,
                t.prototype.getClassName = function() {
                    return "BaseTexture"
                }
                ,
                Object.defineProperty(t.prototype, "onDispose", {
                    set: function(e) {
                        this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver),
                        this._onDisposeObserver = this.onDisposeObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "isBlocking", {
                    get: function() {
                        return !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getScene = function() {
                    return this._scene
                }
                ,
                t.prototype.getTextureMatrix = function() {
                    return e.Matrix.IdentityReadOnly
                }
                ,
                t.prototype.getReflectionTextureMatrix = function() {
                    return e.Matrix.IdentityReadOnly
                }
                ,
                t.prototype.getInternalTexture = function() {
                    return this._texture
                }
                ,
                t.prototype.isReadyOrNotBlocking = function() {
                    return !this.isBlocking || this.isReady()
                }
                ,
                t.prototype.isReady = function() {
                    return this.delayLoadState === e.Engine.DELAYLOADSTATE_NOTLOADED ? (this.delayLoad(),
                    !1) : !!this._texture && this._texture.isReady
                }
                ,
                t.prototype.getSize = function() {
                    if (this._texture) {
                        if (this._texture.width)
                            return this._cachedSize.width = this._texture.width,
                            this._cachedSize.height = this._texture.height,
                            this._cachedSize;
                        if (this._texture._size)
                            return this._cachedSize.width = this._texture._size,
                            this._cachedSize.height = this._texture._size,
                            this._cachedSize
                    }
                    return this._cachedSize
                }
                ,
                t.prototype.getBaseSize = function() {
                    return this.isReady() && this._texture ? this._texture._size ? new e.Size(this._texture._size,this._texture._size) : new e.Size(this._texture.baseWidth,this._texture.baseHeight) : e.Size.Zero()
                }
                ,
                t.prototype.scale = function(e) {}
                ,
                Object.defineProperty(t.prototype, "canRescale", {
                    get: function() {
                        return !1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._getFromCache = function(e, t, r) {
                    if (!this._scene)
                        return null;
                    for (var i = this._scene.getEngine().getLoadedTexturesCache(), n = 0; n < i.length; n++) {
                        var o = i[n];
                        if (o.url === e && o.generateMipMaps === !t && (!r || r === o.samplingMode))
                            return o.incrementReferences(),
                            o
                    }
                    return null
                }
                ,
                t.prototype._rebuild = function() {}
                ,
                t.prototype.delayLoad = function() {}
                ,
                t.prototype.clone = function() {
                    return null
                }
                ,
                Object.defineProperty(t.prototype, "textureType", {
                    get: function() {
                        return this._texture && void 0 !== this._texture.type ? this._texture.type : e.Engine.TEXTURETYPE_UNSIGNED_INT
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "textureFormat", {
                    get: function() {
                        return this._texture && void 0 !== this._texture.format ? this._texture.format : e.Engine.TEXTUREFORMAT_RGBA
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.readPixels = function(e, t, r) {
                    if (void 0 === e && (e = 0),
                    void 0 === t && (t = 0),
                    void 0 === r && (r = null),
                    !this._texture)
                        return null;
                    var i = this.getSize()
                      , n = i.width
                      , o = i.height
                      , a = this.getScene();
                    if (!a)
                        return null;
                    var s = a.getEngine();
                    return 0 != t && (n /= Math.pow(2, t),
                    o /= Math.pow(2, t),
                    n = Math.round(n),
                    o = Math.round(o)),
                    this._texture.isCube ? s._readTexturePixels(this._texture, n, o, e, t, r) : s._readTexturePixels(this._texture, n, o, -1, t, r)
                }
                ,
                t.prototype.releaseInternalTexture = function() {
                    this._texture && (this._texture.dispose(),
                    this._texture = null)
                }
                ,
                Object.defineProperty(t.prototype, "sphericalPolynomial", {
                    get: function() {
                        return this._texture && e.CubeMapToSphericalPolynomialTools && this.isReady() ? (this._texture._sphericalPolynomial || (this._texture._sphericalPolynomial = e.CubeMapToSphericalPolynomialTools.ConvertCubeMapTextureToSphericalPolynomial(this)),
                        this._texture._sphericalPolynomial) : null
                    },
                    set: function(e) {
                        this._texture && (this._texture._sphericalPolynomial = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "_lodTextureHigh", {
                    get: function() {
                        return this._texture ? this._texture._lodTextureHigh : null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "_lodTextureMid", {
                    get: function() {
                        return this._texture ? this._texture._lodTextureMid : null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "_lodTextureLow", {
                    get: function() {
                        return this._texture ? this._texture._lodTextureLow : null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.dispose = function() {
                    if (this._scene) {
                        this._scene.stopAnimation(this),
                        this._scene._removePendingData(this);
                        var e = this._scene.textures.indexOf(this);
                        e >= 0 && this._scene.textures.splice(e, 1),
                        this._scene.onTextureRemovedObservable.notifyObservers(this),
                        void 0 !== this._texture && (this.releaseInternalTexture(),
                        this.onDisposeObservable.notifyObservers(this),
                        this.onDisposeObservable.clear())
                    }
                }
                ,
                t.prototype.serialize = function() {
                    if (!this.name)
                        return null;
                    var t = e.SerializationHelper.Serialize(this);
                    return e.Animation.AppendSerializedAnimations(this, t),
                    t
                }
                ,
                t.WhenAllReady = function(e, t) {
                    var r = e.length;
                    if (0 !== r)
                        for (var i, n, o = function() {
                            if ((i = e[a]).isReady())
                                0 == --r && t();
                            else {
                                n = i.onLoadObservable;
                                var o = function() {
                                    n.removeCallback(o),
                                    0 == --r && t()
                                };
                                n.add(o)
                            }
                        }, a = 0; a < e.length; a++)
                            o();
                    else
                        t()
                }
                ,
                t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL = 4,
                n([e.serialize()], t.prototype, "name", void 0),
                n([e.serialize("hasAlpha")], t.prototype, "_hasAlpha", void 0),
                n([e.serialize()], t.prototype, "getAlphaFromRGB", void 0),
                n([e.serialize()], t.prototype, "level", void 0),
                n([e.serialize()], t.prototype, "coordinatesIndex", void 0),
                n([e.serialize("coordinatesMode")], t.prototype, "_coordinatesMode", void 0),
                n([e.serialize()], t.prototype, "wrapU", void 0),
                n([e.serialize()], t.prototype, "wrapV", void 0),
                n([e.serialize()], t.prototype, "wrapR", void 0),
                n([e.serialize()], t.prototype, "anisotropicFilteringLevel", void 0),
                n([e.serialize()], t.prototype, "isCube", void 0),
                n([e.serialize()], t.prototype, "is3D", void 0),
                n([e.serialize()], t.prototype, "gammaSpace", void 0),
                n([e.serialize()], t.prototype, "invertZ", void 0),
                n([e.serialize()], t.prototype, "lodLevelInAlpha", void 0),
                n([e.serialize()], t.prototype, "lodGenerationOffset", null),
                n([e.serialize()], t.prototype, "lodGenerationScale", null),
                n([e.serialize()], t.prototype, "isRenderTarget", void 0),
                t
            }();
            e.BaseTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(i, n, o, a, s, y, l, c, h, u) {
                    void 0 === o && (o = !1),
                    void 0 === a && (a = !0),
                    void 0 === s && (s = r.TRILINEAR_SAMPLINGMODE),
                    void 0 === y && (y = null),
                    void 0 === l && (l = null),
                    void 0 === c && (c = null),
                    void 0 === h && (h = !1);
                    var d = t.call(this, n) || this;
                    if (d.uOffset = 0,
                    d.vOffset = 0,
                    d.uScale = 1,
                    d.vScale = 1,
                    d.uAng = 0,
                    d.vAng = 0,
                    d.wAng = 0,
                    d.uRotationCenter = .5,
                    d.vRotationCenter = .5,
                    d.wRotationCenter = .5,
                    d.onLoadObservable = new e.Observable,
                    d._isBlocking = !0,
                    d.name = i || "",
                    d.url = i,
                    d._noMipmap = o,
                    d._invertY = a,
                    d._samplingMode = s,
                    d._buffer = c,
                    d._deleteBuffer = h,
                    u && (d._format = u),
                    !(n = d.getScene()))
                        return d;
                    n.getEngine().onBeforeTextureInitObservable.notifyObservers(d);
                    var x = function() {
                        d.onLoadObservable.hasObservers() && d.onLoadObservable.notifyObservers(d),
                        y && y(),
                        !d.isBlocking && n && n.resetCachedMaterial()
                    };
                    return d.url ? (d._texture = d._getFromCache(d.url, o, s),
                    d._texture ? d._texture.isReady ? e.Tools.SetImmediate((function() {
                        return x()
                    }
                    )) : d._texture.onLoadedObservable.add(x) : n.useDelayedTextureLoading ? (d.delayLoadState = e.Engine.DELAYLOADSTATE_NOTLOADED,
                    d._delayedOnLoad = x,
                    d._delayedOnError = l) : (d._texture = n.getEngine().createTexture(d.url, o, a, n, d._samplingMode, x, l, d._buffer, void 0, d._format),
                    h && delete d._buffer),
                    d) : (d._delayedOnLoad = x,
                    d._delayedOnError = l,
                    d)
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "noMipmap", {
                    get: function() {
                        return this._noMipmap
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "isBlocking", {
                    get: function() {
                        return this._isBlocking
                    },
                    set: function(e) {
                        this._isBlocking = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "samplingMode", {
                    get: function() {
                        return this._samplingMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.updateURL = function(t, r) {
                    if (void 0 === r && (r = null),
                    this.url)
                        throw new Error("URL is already set");
                    this.url = t,
                    this._buffer = r,
                    this.delayLoadState = e.Engine.DELAYLOADSTATE_NOTLOADED,
                    this.delayLoad()
                }
                ,
                r.prototype.delayLoad = function() {
                    if (this.delayLoadState === e.Engine.DELAYLOADSTATE_NOTLOADED) {
                        var t = this.getScene();
                        t && (this.delayLoadState = e.Engine.DELAYLOADSTATE_LOADED,
                        this._texture = this._getFromCache(this.url, this._noMipmap, this._samplingMode),
                        this._texture ? this._delayedOnLoad && (this._texture.isReady ? e.Tools.SetImmediate(this._delayedOnLoad) : this._texture.onLoadedObservable.add(this._delayedOnLoad)) : (this._texture = t.getEngine().createTexture(this.url, this._noMipmap, this._invertY, t, this._samplingMode, this._delayedOnLoad, this._delayedOnError, this._buffer, null, this._format),
                        this._deleteBuffer && delete this._buffer),
                        this._delayedOnLoad = null,
                        this._delayedOnError = null)
                    }
                }
                ,
                r.prototype.updateSamplingMode = function(e) {
                    if (this._texture) {
                        var t = this.getScene();
                        t && (this._samplingMode = e,
                        t.getEngine().updateTextureSamplingMode(e, this._texture))
                    }
                }
                ,
                r.prototype._prepareRowForTextureGeneration = function(t, r, i, n) {
                    t *= this.uScale,
                    r *= this.vScale,
                    t -= this.uRotationCenter * this.uScale,
                    r -= this.vRotationCenter * this.vScale,
                    i -= this.wRotationCenter,
                    e.Vector3.TransformCoordinatesFromFloatsToRef(t, r, i, this._rowGenerationMatrix, n),
                    n.x += this.uRotationCenter * this.uScale + this.uOffset,
                    n.y += this.vRotationCenter * this.vScale + this.vOffset,
                    n.z += this.wRotationCenter
                }
                ,
                r.prototype.getTextureMatrix = function() {
                    var t = this;
                    if (this.uOffset === this._cachedUOffset && this.vOffset === this._cachedVOffset && this.uScale === this._cachedUScale && this.vScale === this._cachedVScale && this.uAng === this._cachedUAng && this.vAng === this._cachedVAng && this.wAng === this._cachedWAng)
                        return this._cachedTextureMatrix;
                    this._cachedUOffset = this.uOffset,
                    this._cachedVOffset = this.vOffset,
                    this._cachedUScale = this.uScale,
                    this._cachedVScale = this.vScale,
                    this._cachedUAng = this.uAng,
                    this._cachedVAng = this.vAng,
                    this._cachedWAng = this.wAng,
                    this._cachedTextureMatrix || (this._cachedTextureMatrix = e.Matrix.Zero(),
                    this._rowGenerationMatrix = new e.Matrix,
                    this._t0 = e.Vector3.Zero(),
                    this._t1 = e.Vector3.Zero(),
                    this._t2 = e.Vector3.Zero()),
                    e.Matrix.RotationYawPitchRollToRef(this.vAng, this.uAng, this.wAng, this._rowGenerationMatrix),
                    this._prepareRowForTextureGeneration(0, 0, 0, this._t0),
                    this._prepareRowForTextureGeneration(1, 0, 0, this._t1),
                    this._prepareRowForTextureGeneration(0, 1, 0, this._t2),
                    this._t1.subtractInPlace(this._t0),
                    this._t2.subtractInPlace(this._t0),
                    e.Matrix.IdentityToRef(this._cachedTextureMatrix),
                    this._cachedTextureMatrix.m[0] = this._t1.x,
                    this._cachedTextureMatrix.m[1] = this._t1.y,
                    this._cachedTextureMatrix.m[2] = this._t1.z,
                    this._cachedTextureMatrix.m[4] = this._t2.x,
                    this._cachedTextureMatrix.m[5] = this._t2.y,
                    this._cachedTextureMatrix.m[6] = this._t2.z,
                    this._cachedTextureMatrix.m[8] = this._t0.x,
                    this._cachedTextureMatrix.m[9] = this._t0.y,
                    this._cachedTextureMatrix.m[10] = this._t0.z;
                    var r = this.getScene();
                    return r ? (r.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag, (function(e) {
                        return e.hasTexture(t)
                    }
                    )),
                    this._cachedTextureMatrix) : this._cachedTextureMatrix
                }
                ,
                r.prototype.getReflectionTextureMatrix = function() {
                    var t = this
                      , i = this.getScene();
                    if (!i)
                        return this._cachedTextureMatrix;
                    if (this.uOffset === this._cachedUOffset && this.vOffset === this._cachedVOffset && this.uScale === this._cachedUScale && this.vScale === this._cachedVScale && this.coordinatesMode === this._cachedCoordinatesMode) {
                        if (this.coordinatesMode !== r.PROJECTION_MODE)
                            return this._cachedTextureMatrix;
                        if (this._cachedProjectionMatrixId === i.getProjectionMatrix().updateFlag)
                            return this._cachedTextureMatrix
                    }
                    switch (this._cachedTextureMatrix || (this._cachedTextureMatrix = e.Matrix.Zero()),
                    this._projectionModeMatrix || (this._projectionModeMatrix = e.Matrix.Zero()),
                    this._cachedUOffset = this.uOffset,
                    this._cachedVOffset = this.vOffset,
                    this._cachedUScale = this.uScale,
                    this._cachedVScale = this.vScale,
                    this._cachedCoordinatesMode = this.coordinatesMode,
                    this.coordinatesMode) {
                    case r.PLANAR_MODE:
                        e.Matrix.IdentityToRef(this._cachedTextureMatrix),
                        this._cachedTextureMatrix[0] = this.uScale,
                        this._cachedTextureMatrix[5] = this.vScale,
                        this._cachedTextureMatrix[12] = this.uOffset,
                        this._cachedTextureMatrix[13] = this.vOffset;
                        break;
                    case r.PROJECTION_MODE:
                        e.Matrix.IdentityToRef(this._projectionModeMatrix),
                        this._projectionModeMatrix.m[0] = .5,
                        this._projectionModeMatrix.m[5] = -.5,
                        this._projectionModeMatrix.m[10] = 0,
                        this._projectionModeMatrix.m[12] = .5,
                        this._projectionModeMatrix.m[13] = .5,
                        this._projectionModeMatrix.m[14] = 1,
                        this._projectionModeMatrix.m[15] = 1;
                        var n = i.getProjectionMatrix();
                        this._cachedProjectionMatrixId = n.updateFlag,
                        n.multiplyToRef(this._projectionModeMatrix, this._cachedTextureMatrix);
                        break;
                    default:
                        e.Matrix.IdentityToRef(this._cachedTextureMatrix)
                    }
                    return i.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag, (function(e) {
                        return -1 !== e.getActiveTextures().indexOf(t)
                    }
                    )),
                    this._cachedTextureMatrix
                }
                ,
                r.prototype.clone = function() {
                    var t = this;
                    return e.SerializationHelper.Clone((function() {
                        return new r(t._texture ? t._texture.url : null,t.getScene(),t._noMipmap,t._invertY,t._samplingMode)
                    }
                    ), this)
                }
                ,
                r.prototype.serialize = function() {
                    var e = t.prototype.serialize.call(this);
                    return "string" == typeof this._buffer && "data:" === this._buffer.substr(0, 5) && (e.base64String = this._buffer,
                    e.name = e.name.replace("data:", "")),
                    e.invertY = this._invertY,
                    e.samplingMode = this.samplingMode,
                    e
                }
                ,
                r.prototype.getClassName = function() {
                    return "Texture"
                }
                ,
                r.prototype.dispose = function() {
                    t.prototype.dispose.call(this),
                    this.onLoadObservable.clear(),
                    this._delayedOnLoad = null,
                    this._delayedOnError = null
                }
                ,
                r.Parse = function(t, i, n) {
                    if (t.customType) {
                        var o = e.Tools.Instantiate(t.customType).Parse(t, i, n);
                        return t.samplingMode && o.updateSamplingMode && o._samplingMode && o._samplingMode !== t.samplingMode && o.updateSamplingMode(t.samplingMode),
                        o
                    }
                    if (t.isCube)
                        return e.CubeTexture.Parse(t, i, n);
                    if (!t.name && !t.isRenderTarget)
                        return null;
                    var a = e.SerializationHelper.Parse((function() {
                        var o, a = !0;
                        if (t.noMipmap && (a = !1),
                        t.mirrorPlane) {
                            var s = new e.MirrorTexture(t.name,t.renderTargetSize,i,a);
                            return s._waitingRenderList = t.renderList,
                            s.mirrorPlane = e.Plane.FromArray(t.mirrorPlane),
                            s
                        }
                        if (t.isRenderTarget) {
                            var y = new e.RenderTargetTexture(t.name,t.renderTargetSize,i,a);
                            return y._waitingRenderList = t.renderList,
                            y
                        }
                        if (t.base64String)
                            o = r.CreateFromBase64String(t.base64String, t.name, i, !a);
                        else {
                            var l = n + t.name;
                            r.UseSerializedUrlIfAny && t.url && (l = t.url),
                            o = new r(l,i,!a,t.invertY)
                        }
                        return o
                    }
                    ), t, i);
                    if (t.samplingMode) {
                        var s = t.samplingMode;
                        a._samplingMode !== s && a.updateSamplingMode(s)
                    }
                    if (t.animations)
                        for (var y = 0; y < t.animations.length; y++) {
                            var l = t.animations[y];
                            a.animations.push(e.Animation.Parse(l))
                        }
                    return a
                }
                ,
                r.CreateFromBase64String = function(t, i, n, o, a, s, y, l, c) {
                    return void 0 === s && (s = r.TRILINEAR_SAMPLINGMODE),
                    void 0 === y && (y = null),
                    void 0 === l && (l = null),
                    void 0 === c && (c = e.Engine.TEXTUREFORMAT_RGBA),
                    new r("data:" + i,n,o,a,s,y,l,t,!1,c)
                }
                ,
                r.LoadFromDataString = function(t, i, n, o, a, s, y, l, c, h) {
                    return void 0 === o && (o = !1),
                    void 0 === a && (a = !1),
                    void 0 === s && (s = !0),
                    void 0 === y && (y = r.TRILINEAR_SAMPLINGMODE),
                    void 0 === l && (l = null),
                    void 0 === c && (c = null),
                    void 0 === h && (h = e.Engine.TEXTUREFORMAT_RGBA),
                    "data:" !== t.substr(0, 5) && (t = "data:" + t),
                    new r(t,n,a,s,y,l,c,i,o,h)
                }
                ,
                r.NEAREST_SAMPLINGMODE = e.Engine.TEXTURE_NEAREST_SAMPLINGMODE,
                r.NEAREST_NEAREST_MIPLINEAR = e.Engine.TEXTURE_NEAREST_NEAREST_MIPLINEAR,
                r.BILINEAR_SAMPLINGMODE = e.Engine.TEXTURE_BILINEAR_SAMPLINGMODE,
                r.LINEAR_LINEAR_MIPNEAREST = e.Engine.TEXTURE_LINEAR_LINEAR_MIPNEAREST,
                r.TRILINEAR_SAMPLINGMODE = e.Engine.TEXTURE_TRILINEAR_SAMPLINGMODE,
                r.LINEAR_LINEAR_MIPLINEAR = e.Engine.TEXTURE_LINEAR_LINEAR_MIPLINEAR,
                r.NEAREST_NEAREST_MIPNEAREST = e.Engine.TEXTURE_NEAREST_NEAREST_MIPNEAREST,
                r.NEAREST_LINEAR_MIPNEAREST = e.Engine.TEXTURE_NEAREST_LINEAR_MIPNEAREST,
                r.NEAREST_LINEAR_MIPLINEAR = e.Engine.TEXTURE_NEAREST_LINEAR_MIPLINEAR,
                r.NEAREST_LINEAR = e.Engine.TEXTURE_NEAREST_LINEAR,
                r.NEAREST_NEAREST = e.Engine.TEXTURE_NEAREST_NEAREST,
                r.LINEAR_NEAREST_MIPNEAREST = e.Engine.TEXTURE_LINEAR_NEAREST_MIPNEAREST,
                r.LINEAR_NEAREST_MIPLINEAR = e.Engine.TEXTURE_LINEAR_NEAREST_MIPLINEAR,
                r.LINEAR_LINEAR = e.Engine.TEXTURE_LINEAR_LINEAR,
                r.LINEAR_NEAREST = e.Engine.TEXTURE_LINEAR_NEAREST,
                r.EXPLICIT_MODE = e.Engine.TEXTURE_EXPLICIT_MODE,
                r.SPHERICAL_MODE = e.Engine.TEXTURE_SPHERICAL_MODE,
                r.PLANAR_MODE = e.Engine.TEXTURE_PLANAR_MODE,
                r.CUBIC_MODE = e.Engine.TEXTURE_CUBIC_MODE,
                r.PROJECTION_MODE = e.Engine.TEXTURE_PROJECTION_MODE,
                r.SKYBOX_MODE = e.Engine.TEXTURE_SKYBOX_MODE,
                r.INVCUBIC_MODE = e.Engine.TEXTURE_INVCUBIC_MODE,
                r.EQUIRECTANGULAR_MODE = e.Engine.TEXTURE_EQUIRECTANGULAR_MODE,
                r.FIXED_EQUIRECTANGULAR_MODE = e.Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,
                r.FIXED_EQUIRECTANGULAR_MIRRORED_MODE = e.Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,
                r.CLAMP_ADDRESSMODE = e.Engine.TEXTURE_CLAMP_ADDRESSMODE,
                r.WRAP_ADDRESSMODE = e.Engine.TEXTURE_WRAP_ADDRESSMODE,
                r.MIRROR_ADDRESSMODE = e.Engine.TEXTURE_MIRROR_ADDRESSMODE,
                r.UseSerializedUrlIfAny = !1,
                n([e.serialize()], r.prototype, "url", void 0),
                n([e.serialize()], r.prototype, "uOffset", void 0),
                n([e.serialize()], r.prototype, "vOffset", void 0),
                n([e.serialize()], r.prototype, "uScale", void 0),
                n([e.serialize()], r.prototype, "vScale", void 0),
                n([e.serialize()], r.prototype, "uAng", void 0),
                n([e.serialize()], r.prototype, "vAng", void 0),
                n([e.serialize()], r.prototype, "wAng", void 0),
                n([e.serialize()], r.prototype, "uRotationCenter", void 0),
                n([e.serialize()], r.prototype, "vRotationCenter", void 0),
                n([e.serialize()], r.prototype, "wRotationCenter", void 0),
                n([e.serialize()], r.prototype, "isBlocking", null),
                r
            }(e.BaseTexture);
            e.Texture = t
        }(s || (s = {})),
        function(e) {
            var t = function() {};
            e._CreationDataStorage = t;
            var r = function() {
                this.visibleInstances = {},
                this.renderIdForInstances = new Array,
                this.batchCache = new i,
                this.instancesBufferSize = 2048
            }
              , i = function() {
                this.mustReturn = !1,
                this.visibleInstances = new Array,
                this.renderSelf = new Array
            };
            e._InstancesBatch = i;
            var n = function(t) {
                function i(n, o, a, s, y, l) {
                    void 0 === o && (o = null),
                    void 0 === a && (a = null),
                    void 0 === s && (s = null),
                    void 0 === l && (l = !0);
                    var c = t.call(this, n, o) || this;
                    if (c.delayLoadState = e.Engine.DELAYLOADSTATE_NONE,
                    c.instances = new Array,
                    c._LODLevels = new Array,
                    c._instanceDataStorage = new r,
                    c._originalBuilderSideOrientation = i.DEFAULTSIDE,
                    c.overrideMaterialSideOrientation = null,
                    c._areNormalsFrozen = !1,
                    c._source = null,
                    o = c.getScene(),
                    s) {
                        if (s._geometry && s._geometry.applyToMesh(c),
                        e.Tools.DeepCopy(s, c, ["name", "material", "skeleton", "instances", "parent", "uniqueId", "source", "metadata", "hasLODLevels", "geometry", "isBlocked", "areNormalsFrozen", "onBeforeDrawObservable", "onBeforeRenderObservable", "onAfterRenderObservable", "onBeforeDraw"], ["_poseMatrix"]),
                        c._source = s,
                        c._originalBuilderSideOrientation = s._originalBuilderSideOrientation,
                        c._creationDataStorage = s._creationDataStorage,
                        c._source._ranges) {
                            var h = c._source._ranges;
                            for (var n in h)
                                h.hasOwnProperty(n) && h[n] && c.createAnimationRange(n, h[n].from, h[n].to)
                        }
                        var u;
                        if (s.metadata && s.metadata.clone ? c.metadata = s.metadata.clone() : c.metadata = s.metadata,
                        e.Tags && e.Tags.HasTags(s) && e.Tags.AddTagsTo(c, e.Tags.GetTags(s, !0)),
                        c.parent = s.parent,
                        c.setPivotMatrix(s.getPivotMatrix()),
                        c.id = n + "." + s.id,
                        c.material = s.material,
                        !y)
                            for (var d = s.getDescendants(!0), x = 0; x < d.length; x++) {
                                var p = d[x];
                                p.clone && p.clone(n + "." + p.name, c)
                            }
                        var f = c.getScene().getPhysicsEngine();
                        if (l && f) {
                            var m = f.getImpostorForPhysicsObject(s);
                            m && (c.physicsImpostor = m.clone(c))
                        }
                        for (u = 0; u < o.particleSystems.length; u++) {
                            var z = o.particleSystems[u];
                            z.emitter === s && z.clone(z.name, c)
                        }
                        c.refreshBoundingInfo(),
                        c.computeWorldMatrix(!0)
                    }
                    return null !== a && (c.parent = a),
                    c
                }
                return o(i, t),
                Object.defineProperty(i.prototype, "onBeforeRenderObservable", {
                    get: function() {
                        return this._onBeforeRenderObservable || (this._onBeforeRenderObservable = new e.Observable),
                        this._onBeforeRenderObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "onAfterRenderObservable", {
                    get: function() {
                        return this._onAfterRenderObservable || (this._onAfterRenderObservable = new e.Observable),
                        this._onAfterRenderObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "onBeforeDrawObservable", {
                    get: function() {
                        return this._onBeforeDrawObservable || (this._onBeforeDrawObservable = new e.Observable),
                        this._onBeforeDrawObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "onBeforeDraw", {
                    set: function(e) {
                        this._onBeforeDrawObserver && this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),
                        this._onBeforeDrawObserver = this.onBeforeDrawObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "morphTargetManager", {
                    get: function() {
                        return this._morphTargetManager
                    },
                    set: function(e) {
                        this._morphTargetManager !== e && (this._morphTargetManager = e,
                        this._syncGeometryWithMorphTargetManager())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "source", {
                    get: function() {
                        return this._source
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "isUnIndexed", {
                    get: function() {
                        return this._unIndexed
                    },
                    set: function(e) {
                        this._unIndexed !== e && (this._unIndexed = e,
                        this._markSubMeshesAsAttributesDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getClassName = function() {
                    return "Mesh"
                }
                ,
                i.prototype.toString = function(r) {
                    var i = t.prototype.toString.call(this, r);
                    if (i += ", n vertices: " + this.getTotalVertices(),
                    i += ", parent: " + (this._waitingParentId ? this._waitingParentId : this.parent ? this.parent.name : "NONE"),
                    this.animations)
                        for (var n = 0; n < this.animations.length; n++)
                            i += ", animation[0]: " + this.animations[n].toString(r);
                    if (r)
                        if (this._geometry) {
                            var o = this.getIndices()
                              , a = this.getVerticesData(e.VertexBuffer.PositionKind);
                            a && o && (i += ", flat shading: " + (a.length / 3 === o.length ? "YES" : "NO"))
                        } else
                            i += ", flat shading: UNKNOWN";
                    return i
                }
                ,
                i.prototype._unBindEffect = function() {
                    t.prototype._unBindEffect.call(this);
                    for (var e = 0, r = this.instances; e < r.length; e++) {
                        r[e]._unBindEffect()
                    }
                }
                ,
                Object.defineProperty(i.prototype, "hasLODLevels", {
                    get: function() {
                        return this._LODLevels.length > 0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getLODLevels = function() {
                    return this._LODLevels
                }
                ,
                i.prototype._sortLODLevels = function() {
                    this._LODLevels.sort((function(e, t) {
                        return e.distance < t.distance ? 1 : e.distance > t.distance ? -1 : 0
                    }
                    ))
                }
                ,
                i.prototype.addLODLevel = function(t, r) {
                    if (r && r._masterMesh)
                        return e.Tools.Warn("You cannot use a mesh as LOD level twice"),
                        this;
                    var i = new e.MeshLODLevel(t,r);
                    return this._LODLevels.push(i),
                    r && (r._masterMesh = this),
                    this._sortLODLevels(),
                    this
                }
                ,
                i.prototype.getLODLevelAtDistance = function(e) {
                    for (var t = 0; t < this._LODLevels.length; t++) {
                        var r = this._LODLevels[t];
                        if (r.distance === e)
                            return r.mesh
                    }
                    return null
                }
                ,
                i.prototype.removeLODLevel = function(e) {
                    for (var t = 0; t < this._LODLevels.length; t++)
                        this._LODLevels[t].mesh === e && (this._LODLevels.splice(t, 1),
                        e && (e._masterMesh = null));
                    return this._sortLODLevels(),
                    this
                }
                ,
                i.prototype.getLOD = function(e, t) {
                    if (!this._LODLevels || 0 === this._LODLevels.length)
                        return this;
                    var r;
                    t ? r = t : r = this.getBoundingInfo().boundingSphere;
                    var i = r.centerWorld.subtract(e.globalPosition).length();
                    if (this._LODLevels[this._LODLevels.length - 1].distance > i)
                        return this.onLODLevelSelection && this.onLODLevelSelection(i, this, this._LODLevels[this._LODLevels.length - 1].mesh),
                        this;
                    for (var n = 0; n < this._LODLevels.length; n++) {
                        var o = this._LODLevels[n];
                        if (o.distance < i)
                            return o.mesh && (o.mesh._preActivate(),
                            o.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),
                            this.onLODLevelSelection && this.onLODLevelSelection(i, this, o.mesh),
                            o.mesh
                    }
                    return this.onLODLevelSelection && this.onLODLevelSelection(i, this, this),
                    this
                }
                ,
                Object.defineProperty(i.prototype, "geometry", {
                    get: function() {
                        return this._geometry
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getTotalVertices = function() {
                    return null === this._geometry || void 0 === this._geometry ? 0 : this._geometry.getTotalVertices()
                }
                ,
                i.prototype.getVerticesData = function(e, t, r) {
                    return this._geometry ? this._geometry.getVerticesData(e, t, r) : null
                }
                ,
                i.prototype.getVertexBuffer = function(e) {
                    return this._geometry ? this._geometry.getVertexBuffer(e) : null
                }
                ,
                i.prototype.isVerticesDataPresent = function(e) {
                    return this._geometry ? this._geometry.isVerticesDataPresent(e) : !!this._delayInfo && -1 !== this._delayInfo.indexOf(e)
                }
                ,
                i.prototype.isVertexBufferUpdatable = function(e) {
                    return this._geometry ? this._geometry.isVertexBufferUpdatable(e) : !!this._delayInfo && -1 !== this._delayInfo.indexOf(e)
                }
                ,
                i.prototype.getVerticesDataKinds = function() {
                    if (!this._geometry) {
                        var e = new Array;
                        return this._delayInfo && this._delayInfo.forEach((function(t, r, i) {
                            e.push(t)
                        }
                        )),
                        e
                    }
                    return this._geometry.getVerticesDataKinds()
                }
                ,
                i.prototype.getTotalIndices = function() {
                    return this._geometry ? this._geometry.getTotalIndices() : 0
                }
                ,
                i.prototype.getIndices = function(e, t) {
                    return this._geometry ? this._geometry.getIndices(e, t) : []
                }
                ,
                Object.defineProperty(i.prototype, "isBlocked", {
                    get: function() {
                        return null !== this._masterMesh && void 0 !== this._masterMesh
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.isReady = function(r, i) {
                    if (void 0 === r && (r = !1),
                    void 0 === i && (i = !1),
                    this.delayLoadState === e.Engine.DELAYLOADSTATE_LOADING)
                        return !1;
                    if (!t.prototype.isReady.call(this, r))
                        return !1;
                    if (!this.subMeshes || 0 === this.subMeshes.length)
                        return !0;
                    if (!r)
                        return !0;
                    var n = this.getEngine()
                      , o = this.getScene()
                      , a = i || n.getCaps().instancedArrays && this.instances.length > 0;
                    this.computeWorldMatrix();
                    var s = this.material || o.defaultMaterial;
                    if (s)
                        if (s.storeEffectOnSubMeshes)
                            for (var y = 0, l = this.subMeshes; y < l.length; y++) {
                                var c = (f = l[y]).getMaterial();
                                if (c)
                                    if (c.storeEffectOnSubMeshes) {
                                        if (!c.isReadyForSubMesh(this, f, a))
                                            return !1
                                    } else if (!c.isReady(this, a))
                                        return !1
                            }
                        else if (!s.isReady(this, a))
                            return !1;
                    for (var h = 0, u = this._lightSources; h < u.length; h++) {
                        var d = u[h].getShadowGenerator();
                        if (d)
                            for (var x = 0, p = this.subMeshes; x < p.length; x++) {
                                var f = p[x];
                                if (!d.isReady(f, a))
                                    return !1
                            }
                    }
                    for (var m = 0, z = this._LODLevels; m < z.length; m++) {
                        var _ = z[m];
                        if (_.mesh && !_.mesh.isReady(a))
                            return !1
                    }
                    return !0
                }
                ,
                Object.defineProperty(i.prototype, "areNormalsFrozen", {
                    get: function() {
                        return this._areNormalsFrozen
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.freezeNormals = function() {
                    return this._areNormalsFrozen = !0,
                    this
                }
                ,
                i.prototype.unfreezeNormals = function() {
                    return this._areNormalsFrozen = !1,
                    this
                }
                ,
                Object.defineProperty(i.prototype, "overridenInstanceCount", {
                    set: function(e) {
                        this._instanceDataStorage.overridenInstanceCount = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype._preActivate = function() {
                    var e = this.getScene().getRenderId();
                    return this._preActivateId === e ? this : (this._preActivateId = e,
                    this._instanceDataStorage.visibleInstances = null,
                    this)
                }
                ,
                i.prototype._preActivateForIntermediateRendering = function(e) {
                    return this._instanceDataStorage.visibleInstances && (this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId = e),
                    this
                }
                ,
                i.prototype._registerInstanceForRenderId = function(e, t) {
                    return this._instanceDataStorage.visibleInstances || (this._instanceDataStorage.visibleInstances = {},
                    this._instanceDataStorage.visibleInstances.defaultRenderId = t,
                    this._instanceDataStorage.visibleInstances.selfDefaultRenderId = this._renderId),
                    this._instanceDataStorage.visibleInstances[t] || (this._instanceDataStorage.visibleInstances[t] = new Array),
                    this._instanceDataStorage.visibleInstances[t].push(e),
                    this
                }
                ,
                i.prototype.refreshBoundingInfo = function() {
                    return this._refreshBoundingInfo(!1)
                }
                ,
                i.prototype._refreshBoundingInfo = function(t) {
                    if (this._boundingInfo && this._boundingInfo.isLocked)
                        return this;
                    var r = this._getPositionData(t);
                    if (r) {
                        var i = this.geometry ? this.geometry.boundingBias : null
                          , n = e.Tools.ExtractMinAndMax(r, 0, this.getTotalVertices(), i);
                        this._boundingInfo = new e.BoundingInfo(n.minimum,n.maximum)
                    }
                    if (this.subMeshes)
                        for (var o = 0; o < this.subMeshes.length; o++)
                            this.subMeshes[o].refreshBoundingInfo();
                    return this._updateBoundingInfo(),
                    this
                }
                ,
                i.prototype._getPositionData = function(t) {
                    var r = this.getVerticesData(e.VertexBuffer.PositionKind);
                    if (r && t && this.skeleton) {
                        r = e.Tools.Slice(r);
                        var i = this.getVerticesData(e.VertexBuffer.MatricesIndicesKind)
                          , n = this.getVerticesData(e.VertexBuffer.MatricesWeightsKind);
                        if (n && i)
                            for (var o = this.numBoneInfluencers > 4, a = o ? this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind) : null, s = o ? this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind) : null, y = this.skeleton.getTransformMatrices(this), l = e.Tmp.Vector3[0], c = e.Tmp.Matrix[0], h = e.Tmp.Matrix[1], u = 0, d = 0; d < r.length; d += 3,
                            u += 4) {
                                var x, p;
                                for (c.reset(),
                                x = 0; x < 4; x++)
                                    (p = n[u + x]) > 0 && (e.Matrix.FromFloat32ArrayToRefScaled(y, Math.floor(16 * i[u + x]), p, h),
                                    c.addToSelf(h));
                                if (o)
                                    for (x = 0; x < 4; x++)
                                        (p = s[u + x]) > 0 && (e.Matrix.FromFloat32ArrayToRefScaled(y, Math.floor(16 * a[u + x]), p, h),
                                        c.addToSelf(h));
                                e.Vector3.TransformCoordinatesFromFloatsToRef(r[d], r[d + 1], r[d + 2], c, l),
                                l.toArray(r, d)
                            }
                    }
                    return r
                }
                ,
                i.prototype._createGlobalSubMesh = function(t) {
                    var r = this.getTotalVertices();
                    if (!r || !this.getIndices())
                        return null;
                    if (this.subMeshes && this.subMeshes.length > 0) {
                        var i = this.getIndices();
                        if (!i)
                            return null;
                        var n = i.length
                          , o = !1;
                        if (t)
                            o = !0;
                        else
                            for (var a = 0, s = this.subMeshes; a < s.length; a++) {
                                var y = s[a];
                                if (y.indexStart + y.indexCount >= n) {
                                    o = !0;
                                    break
                                }
                                if (y.verticesStart + y.verticesCount >= r) {
                                    o = !0;
                                    break
                                }
                            }
                        if (!o)
                            return this.subMeshes[0]
                    }
                    return this.releaseSubMeshes(),
                    new e.SubMesh(0,0,r,0,this.getTotalIndices(),this)
                }
                ,
                i.prototype.subdivide = function(t) {
                    if (!(t < 1)) {
                        for (var r = this.getTotalIndices(), i = r / t | 0, n = 0; i % 3 != 0; )
                            i++;
                        this.releaseSubMeshes();
                        for (var o = 0; o < t && !(n >= r); o++)
                            e.SubMesh.CreateFromIndices(0, n, Math.min(i, r - n), this),
                            n += i;
                        this.synchronizeInstances()
                    }
                }
                ,
                i.prototype.setVerticesData = function(t, r, i, n) {
                    if (void 0 === i && (i = !1),
                    this._geometry)
                        this._geometry.setVerticesData(t, r, i, n);
                    else {
                        var o = new e.VertexData;
                        o.set(r, t);
                        var a = this.getScene();
                        new e.Geometry(e.Geometry.RandomId(),a,o,i,this)
                    }
                    return this
                }
                ,
                i.prototype.markVerticesDataAsUpdatable = function(e, t) {
                    void 0 === t && (t = !0);
                    var r = this.getVertexBuffer(e);
                    r && r.isUpdatable() !== t && this.setVerticesData(e, this.getVerticesData(e), t)
                }
                ,
                i.prototype.setVerticesBuffer = function(t) {
                    return this._geometry || (this._geometry = e.Geometry.CreateGeometryForMesh(this)),
                    this._geometry.setVerticesBuffer(t),
                    this
                }
                ,
                i.prototype.updateVerticesData = function(e, t, r, i) {
                    return this._geometry ? (i ? (this.makeGeometryUnique(),
                    this.updateVerticesData(e, t, r, !1)) : this._geometry.updateVerticesData(e, t, r),
                    this) : this
                }
                ,
                i.prototype.updateMeshPositions = function(t, r) {
                    void 0 === r && (r = !0);
                    var i = this.getVerticesData(e.VertexBuffer.PositionKind);
                    if (!i)
                        return this;
                    if (t(i),
                    this.updateVerticesData(e.VertexBuffer.PositionKind, i, !1, !1),
                    r) {
                        var n = this.getIndices()
                          , o = this.getVerticesData(e.VertexBuffer.NormalKind);
                        if (!o)
                            return this;
                        e.VertexData.ComputeNormals(i, n, o),
                        this.updateVerticesData(e.VertexBuffer.NormalKind, o, !1, !1)
                    }
                    return this
                }
                ,
                i.prototype.makeGeometryUnique = function() {
                    if (!this._geometry)
                        return this;
                    var t = this._geometry
                      , r = this._geometry.copy(e.Geometry.RandomId());
                    return t.releaseForMesh(this, !0),
                    r.applyToMesh(this),
                    this
                }
                ,
                i.prototype.setIndices = function(t, r, i) {
                    if (void 0 === r && (r = null),
                    void 0 === i && (i = !1),
                    this._geometry)
                        this._geometry.setIndices(t, r, i);
                    else {
                        var n = new e.VertexData;
                        n.indices = t;
                        var o = this.getScene();
                        new e.Geometry(e.Geometry.RandomId(),o,n,i,this)
                    }
                    return this
                }
                ,
                i.prototype.updateIndices = function(e, t) {
                    return this._geometry ? (this._geometry.updateIndices(e, t),
                    this) : this
                }
                ,
                i.prototype.toLeftHanded = function() {
                    return this._geometry ? (this._geometry.toLeftHanded(),
                    this) : this
                }
                ,
                i.prototype._bind = function(t, r, i) {
                    if (!this._geometry)
                        return this;
                    var n, o = this.getScene().getEngine();
                    if (this._unIndexed)
                        n = null;
                    else
                        switch (i) {
                        case e.Material.PointFillMode:
                            n = null;
                            break;
                        case e.Material.WireFrameFillMode:
                            n = t._getLinesIndexBuffer(this.getIndices(), o);
                            break;
                        default:
                        case e.Material.TriangleFillMode:
                            n = this._unIndexed ? null : this._geometry.getIndexBuffer()
                        }
                    return this._geometry._bind(r, n),
                    this
                }
                ,
                i.prototype._draw = function(t, r, i, n) {
                    if (void 0 === n && (n = !1),
                    !this._geometry || !this._geometry.getVertexBuffers() || !this._unIndexed && !this._geometry.getIndexBuffer())
                        return this;
                    this._onBeforeDrawObservable && this._onBeforeDrawObservable.notifyObservers(this);
                    var o = this.getScene()
                      , a = o.getEngine();
                    if (this._unIndexed || r == e.Material.PointFillMode ? a.drawArraysType(r, t.verticesStart, t.verticesCount, i) : r == e.Material.WireFrameFillMode ? a.drawElementsType(r, 0, t._linesIndexCount, i) : a.drawElementsType(r, t.indexStart, t.indexCount, i),
                    o._isAlternateRenderingEnabled && !n) {
                        var s = t.effect || this._effectiveMaterial.getEffect();
                        if (!s || !o.activeCamera)
                            return this;
                        o._switchToAlternateCameraConfiguration(!0),
                        this._effectiveMaterial.bindView(s),
                        this._effectiveMaterial.bindViewProjection(s),
                        a.setViewport(o.activeCamera._alternateCamera.viewport),
                        this._draw(t, r, i, !0),
                        a.setViewport(o.activeCamera.viewport),
                        o._switchToAlternateCameraConfiguration(!1),
                        this._effectiveMaterial.bindView(s),
                        this._effectiveMaterial.bindViewProjection(s)
                    }
                    return this
                }
                ,
                i.prototype.registerBeforeRender = function(e) {
                    return this.onBeforeRenderObservable.add(e),
                    this
                }
                ,
                i.prototype.unregisterBeforeRender = function(e) {
                    return this.onBeforeRenderObservable.removeCallback(e),
                    this
                }
                ,
                i.prototype.registerAfterRender = function(e) {
                    return this.onAfterRenderObservable.add(e),
                    this
                }
                ,
                i.prototype.unregisterAfterRender = function(e) {
                    return this.onAfterRenderObservable.removeCallback(e),
                    this
                }
                ,
                i.prototype._getInstancesRenderList = function(e) {
                    var t = this.getScene()
                      , r = this._instanceDataStorage.batchCache;
                    if (r.mustReturn = !1,
                    r.renderSelf[e] = this.isEnabled() && this.isVisible,
                    r.visibleInstances[e] = null,
                    this._instanceDataStorage.visibleInstances) {
                        var i = this._instanceDataStorage.visibleInstances
                          , n = t.getRenderId()
                          , o = t._isInIntermediateRendering() ? i.intermediateDefaultRenderId : i.defaultRenderId;
                        r.visibleInstances[e] = i[n];
                        var a = this._renderId;
                        !r.visibleInstances[e] && o && (r.visibleInstances[e] = i[o],
                        n = Math.max(o, n),
                        a = Math.max(i.selfDefaultRenderId, n));
                        var s = r.visibleInstances[e];
                        if (s && s.length) {
                            if (this._instanceDataStorage.renderIdForInstances[e] === n)
                                return r.mustReturn = !0,
                                r;
                            n !== a && (r.renderSelf[e] = !1)
                        }
                        this._instanceDataStorage.renderIdForInstances[e] = n
                    }
                    return r
                }
                ,
                i.prototype._renderWithInstances = function(t, r, i, n, o) {
                    var a = i.visibleInstances[t._id];
                    if (!a)
                        return this;
                    for (var s = 16 * (a.length + 1) * 4, y = this._instanceDataStorage, l = y.instancesBufferSize, c = y.instancesBuffer; y.instancesBufferSize < s; )
                        y.instancesBufferSize *= 2;
                    y.instancesData && l == y.instancesBufferSize || (y.instancesData = new Float32Array(y.instancesBufferSize / 4));
                    var h = 0
                      , u = 0
                      , d = this.getWorldMatrix();
                    if (i.renderSelf[t._id] && (d.copyToArray(y.instancesData, h),
                    h += 16,
                    u++),
                    a)
                        for (var x = 0; x < a.length; x++) {
                            a[x].getWorldMatrix().copyToArray(y.instancesData, h),
                            h += 16,
                            u++
                        }
                    return c && l == y.instancesBufferSize ? c.updateDirectly(y.instancesData, 0, u) : (c && c.dispose(),
                    c = new e.Buffer(o,y.instancesData,!0,16,!1,!0),
                    y.instancesBuffer = c,
                    this.setVerticesBuffer(c.createVertexBuffer("world0", 0, 4)),
                    this.setVerticesBuffer(c.createVertexBuffer("world1", 4, 4)),
                    this.setVerticesBuffer(c.createVertexBuffer("world2", 8, 4)),
                    this.setVerticesBuffer(c.createVertexBuffer("world3", 12, 4))),
                    this._bind(t, n, r),
                    this._draw(t, r, u),
                    o.unbindInstanceAttributes(),
                    this
                }
                ,
                i.prototype._processRendering = function(e, t, r, i, n, o, a) {
                    var s = this.getScene().getEngine();
                    if (n)
                        this._renderWithInstances(e, r, i, t, s);
                    else {
                        i.renderSelf[e._id] && (o && o(!1, this.getWorldMatrix(), a),
                        this._draw(e, r, this._instanceDataStorage.overridenInstanceCount));
                        var y = i.visibleInstances[e._id];
                        if (y)
                            for (var l = 0; l < y.length; l++) {
                                var c = y[l].getWorldMatrix();
                                o && o(!0, c, a),
                                this._draw(e, r)
                            }
                    }
                    return this
                }
                ,
                i.prototype.render = function(t, r) {
                    if (this._checkOcclusionQuery())
                        return this;
                    var i = this.getScene()
                      , n = this._getInstancesRenderList(t._id);
                    if (n.mustReturn)
                        return this;
                    if (!this._geometry || !this._geometry.getVertexBuffers() || !this._unIndexed && !this._geometry.getIndexBuffer())
                        return this;
                    this._onBeforeRenderObservable && this._onBeforeRenderObservable.notifyObservers(this);
                    var o, a = i.getEngine(), s = a.getCaps().instancedArrays && null !== n.visibleInstances[t._id] && void 0 !== n.visibleInstances[t._id], y = t.getMaterial();
                    if (!y)
                        return this;
                    if (this._effectiveMaterial = y,
                    this._effectiveMaterial.storeEffectOnSubMeshes) {
                        if (!this._effectiveMaterial.isReadyForSubMesh(this, t, s))
                            return this
                    } else if (!this._effectiveMaterial.isReady(this, s))
                        return this;
                    r && a.setAlphaMode(this._effectiveMaterial.alphaMode);
                    for (var l = 0, c = i._beforeRenderingMeshStage; l < c.length; l++) {
                        c[l].action(this, t, n)
                    }
                    if (!(o = this._effectiveMaterial.storeEffectOnSubMeshes ? t.effect : this._effectiveMaterial.getEffect()))
                        return this;
                    var h = this.overrideMaterialSideOrientation;
                    null == h && (h = this._effectiveMaterial.sideOrientation,
                    this._getWorldMatrixDeterminant() < 0 && (h = h === e.Material.ClockWiseSideOrientation ? e.Material.CounterClockWiseSideOrientation : e.Material.ClockWiseSideOrientation));
                    var u = this._effectiveMaterial._preBind(o, h);
                    this._effectiveMaterial.forceDepthWrite && a.setDepthWrite(!0);
                    var d = i.forcePointsCloud ? e.Material.PointFillMode : i.forceWireframe ? e.Material.WireFrameFillMode : this._effectiveMaterial.fillMode;
                    s || this._bind(t, o, d);
                    var x = this.getWorldMatrix();
                    this._effectiveMaterial.storeEffectOnSubMeshes ? this._effectiveMaterial.bindForSubMesh(x, this, t) : this._effectiveMaterial.bind(x, this),
                    !this._effectiveMaterial.backFaceCulling && this._effectiveMaterial.separateCullingPass && (a.setState(!0, this._effectiveMaterial.zOffset, !1, !u),
                    this._processRendering(t, o, d, n, s, this._onBeforeDraw, this._effectiveMaterial),
                    a.setState(!0, this._effectiveMaterial.zOffset, !1, u)),
                    this._processRendering(t, o, d, n, s, this._onBeforeDraw, this._effectiveMaterial),
                    this._effectiveMaterial.unbind();
                    for (var p = 0, f = i._afterRenderingMeshStage; p < f.length; p++) {
                        f[p].action(this, t, n)
                    }
                    return this._onAfterRenderObservable && this._onAfterRenderObservable.notifyObservers(this),
                    this
                }
                ,
                i.prototype._onBeforeDraw = function(e, t, r) {
                    e && r && r.bindOnlyWorldMatrix(t)
                }
                ,
                i.prototype.cleanMatrixWeights = function() {
                    this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind) && (this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsExtraKind) ? this.normalizeSkinWeightsAndExtra() : this.normalizeSkinFourWeights())
                }
                ,
                i.prototype.normalizeSkinFourWeights = function() {
                    for (var t = this.getVerticesData(e.VertexBuffer.MatricesWeightsKind), r = t.length, i = 0; i < r; i += 4) {
                        var n = t[i] + t[i + 1] + t[i + 2] + t[i + 3];
                        if (0 === n)
                            t[i] = 1;
                        else {
                            var o = 1 / n;
                            t[i] *= o,
                            t[i + 1] *= o,
                            t[i + 2] *= o,
                            t[i + 3] *= o
                        }
                    }
                    this.setVerticesData(e.VertexBuffer.MatricesWeightsKind, t)
                }
                ,
                i.prototype.normalizeSkinWeightsAndExtra = function() {
                    for (var t = this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind), r = this.getVerticesData(e.VertexBuffer.MatricesWeightsKind), i = r.length, n = 0; n < i; n += 4) {
                        var o = r[n] + r[n + 1] + r[n + 2] + r[n + 3];
                        if (0 === (o += t[n] + t[n + 1] + t[n + 2] + t[n + 3]))
                            r[n] = 1;
                        else {
                            var a = 1 / o;
                            r[n] *= a,
                            r[n + 1] *= a,
                            r[n + 2] *= a,
                            r[n + 3] *= a,
                            t[n] *= a,
                            t[n + 1] *= a,
                            t[n + 2] *= a,
                            t[n + 3] *= a
                        }
                    }
                    this.setVerticesData(e.VertexBuffer.MatricesWeightsKind, r),
                    this.setVerticesData(e.VertexBuffer.MatricesWeightsKind, t)
                }
                ,
                i.prototype.validateSkinning = function() {
                    var t = this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind)
                      , r = this.getVerticesData(e.VertexBuffer.MatricesWeightsKind);
                    if (null === r || null == this.skeleton)
                        return {
                            skinned: !1,
                            valid: !0,
                            report: "not skinned"
                        };
                    for (var i = r.length, n = 0, o = 0, a = 0, s = 0, y = null === t ? 4 : 8, l = new Array, c = 0; c <= y; c++)
                        l[c] = 0;
                    for (c = 0; c < i; c += 4) {
                        for (var h = r[c], u = h, d = 0 === u ? 0 : 1, x = 1; x < y; x++) {
                            var p = x < 4 ? r[c + x] : t[c + x - 4];
                            p > h && n++,
                            0 !== p && d++,
                            u += p,
                            h = p
                        }
                        if (l[d]++,
                        d > a && (a = d),
                        0 === u)
                            o++;
                        else {
                            var f = 1 / u
                              , m = 0;
                            for (x = 0; x < y; x++)
                                m += x < 4 ? Math.abs(r[c + x] - r[c + x] * f) : Math.abs(t[c + x - 4] - t[c + x - 4] * f);
                            m > .001 && s++
                        }
                    }
                    var z = this.skeleton.bones.length
                      , _ = this.getVerticesData(e.VertexBuffer.MatricesIndicesKind)
                      , g = this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind)
                      , v = 0;
                    for (c = 0; c < i; c++)
                        for (x = 0; x < y; x++) {
                            var b = x < 4 ? _[x] : g[x - 4];
                            (b >= z || b < 0) && v++
                        }
                    return {
                        skinned: !0,
                        valid: 0 === o && 0 === s && 0 === v,
                        report: "Number of Weights = " + i / 4 + "\nMaximum influences = " + a + "\nMissing Weights = " + o + "\nNot Sorted = " + n + "\nNot Normalized = " + s + "\nWeightCounts = [" + l + "]\nNumber of bones = " + z + "\nBad Bone Indices = " + v
                    }
                }
                ,
                i.prototype._checkDelayState = function() {
                    var t = this.getScene();
                    return this._geometry ? this._geometry.load(t) : this.delayLoadState === e.Engine.DELAYLOADSTATE_NOTLOADED && (this.delayLoadState = e.Engine.DELAYLOADSTATE_LOADING,
                    this._queueLoad(t)),
                    this
                }
                ,
                i.prototype._queueLoad = function(t) {
                    var r = this;
                    t._addPendingData(this);
                    var i = -1 !== this.delayLoadingFile.indexOf(".babylonbinarymeshdata");
                    return e.Tools.LoadFile(this.delayLoadingFile, (function(i) {
                        i instanceof ArrayBuffer ? r._delayLoadingFunction(i, r) : r._delayLoadingFunction(JSON.parse(i), r),
                        r.instances.forEach((function(e) {
                            e._syncSubMeshes()
                        }
                        )),
                        r.delayLoadState = e.Engine.DELAYLOADSTATE_LOADED,
                        t._removePendingData(r)
                    }
                    ), (function() {}
                    ), t.database, i),
                    this
                }
                ,
                i.prototype.isInFrustum = function(r) {
                    return this.delayLoadState !== e.Engine.DELAYLOADSTATE_LOADING && (!!t.prototype.isInFrustum.call(this, r) && (this._checkDelayState(),
                    !0))
                }
                ,
                i.prototype.setMaterialByID = function(e) {
                    var t, r = this.getScene().materials;
                    for (t = r.length - 1; t > -1; t--)
                        if (r[t].id === e)
                            return this.material = r[t],
                            this;
                    var i = this.getScene().multiMaterials;
                    for (t = i.length - 1; t > -1; t--)
                        if (i[t].id === e)
                            return this.material = i[t],
                            this;
                    return this
                }
                ,
                i.prototype.getAnimatables = function() {
                    var e = new Array;
                    return this.material && e.push(this.material),
                    this.skeleton && e.push(this.skeleton),
                    e
                }
                ,
                i.prototype.bakeTransformIntoVertices = function(t) {
                    if (!this.isVerticesDataPresent(e.VertexBuffer.PositionKind))
                        return this;
                    var r = this.subMeshes.splice(0);
                    this._resetPointsArrayCache();
                    var i, n = this.getVerticesData(e.VertexBuffer.PositionKind), o = new Array;
                    for (i = 0; i < n.length; i += 3)
                        e.Vector3.TransformCoordinates(e.Vector3.FromArray(n, i), t).toArray(o, i);
                    if (this.setVerticesData(e.VertexBuffer.PositionKind, o, this.getVertexBuffer(e.VertexBuffer.PositionKind).isUpdatable()),
                    this.isVerticesDataPresent(e.VertexBuffer.NormalKind)) {
                        for (n = this.getVerticesData(e.VertexBuffer.NormalKind),
                        o = [],
                        i = 0; i < n.length; i += 3)
                            e.Vector3.TransformNormal(e.Vector3.FromArray(n, i), t).normalize().toArray(o, i);
                        this.setVerticesData(e.VertexBuffer.NormalKind, o, this.getVertexBuffer(e.VertexBuffer.NormalKind).isUpdatable())
                    }
                    return t.m[0] * t.m[5] * t.m[10] < 0 && this.flipFaces(),
                    this.releaseSubMeshes(),
                    this.subMeshes = r,
                    this
                }
                ,
                i.prototype.bakeCurrentTransformIntoVertices = function() {
                    return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),
                    this.scaling.copyFromFloats(1, 1, 1),
                    this.position.copyFromFloats(0, 0, 0),
                    this.rotation.copyFromFloats(0, 0, 0),
                    this.rotationQuaternion && (this.rotationQuaternion = e.Quaternion.Identity()),
                    this._worldMatrix = e.Matrix.Identity(),
                    this
                }
                ,
                Object.defineProperty(i.prototype, "_positions", {
                    get: function() {
                        return this._geometry ? this._geometry._positions : null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype._resetPointsArrayCache = function() {
                    return this._geometry && this._geometry._resetPointsArrayCache(),
                    this
                }
                ,
                i.prototype._generatePointsArray = function() {
                    return !!this._geometry && this._geometry._generatePointsArray()
                }
                ,
                i.prototype.clone = function(e, t, r, n) {
                    return void 0 === e && (e = ""),
                    void 0 === n && (n = !0),
                    new i(e,this.getScene(),t,this,r,n)
                }
                ,
                i.prototype.dispose = function(e, r) {
                    var i = this;
                    for (void 0 === r && (r = !1),
                    this.morphTargetManager = null,
                    this._geometry && this._geometry.releaseForMesh(this, !0),
                    this._onBeforeDrawObservable && this._onBeforeDrawObservable.clear(),
                    this._onBeforeRenderObservable && this._onBeforeRenderObservable.clear(),
                    this._onAfterRenderObservable && this._onAfterRenderObservable.clear(),
                    this.getScene().meshes.forEach((function(e) {
                        var t = e;
                        t._source && t._source === i && (t._source = null)
                    }
                    )),
                    this._source = null,
                    this._instanceDataStorage.instancesBuffer && (this._instanceDataStorage.instancesBuffer.dispose(),
                    this._instanceDataStorage.instancesBuffer = null); this.instances.length; )
                        this.instances[0].dispose();
                    t.prototype.dispose.call(this, e, r)
                }
                ,
                i.prototype.applyDisplacementMap = function(t, r, i, n, o, a, s) {
                    var y = this;
                    void 0 === s && (s = !1);
                    var l = this.getScene();
                    return e.Tools.LoadImage(t, (function(e) {
                        var t = document.createElement("canvas")
                          , l = t.getContext("2d")
                          , c = e.width
                          , h = e.height;
                        t.width = c,
                        t.height = h,
                        l.drawImage(e, 0, 0);
                        var u = l.getImageData(0, 0, c, h).data;
                        y.applyDisplacementMapFromBuffer(u, c, h, r, i, o, a, s),
                        n && n(y)
                    }
                    ), (function() {}
                    ), l.database),
                    this
                }
                ,
                i.prototype.applyDisplacementMapFromBuffer = function(t, r, i, n, o, a, s, y) {
                    if (void 0 === y && (y = !1),
                    !this.isVerticesDataPresent(e.VertexBuffer.PositionKind) || !this.isVerticesDataPresent(e.VertexBuffer.NormalKind) || !this.isVerticesDataPresent(e.VertexBuffer.UVKind))
                        return e.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),
                        this;
                    var l = this.getVerticesData(e.VertexBuffer.PositionKind, !0, !0)
                      , c = this.getVerticesData(e.VertexBuffer.NormalKind)
                      , h = this.getVerticesData(e.VertexBuffer.UVKind)
                      , u = e.Vector3.Zero()
                      , d = e.Vector3.Zero()
                      , x = e.Vector2.Zero();
                    a = a || e.Vector2.Zero(),
                    s = s || new e.Vector2(1,1);
                    for (var p = 0; p < l.length; p += 3) {
                        e.Vector3.FromArrayToRef(l, p, u),
                        e.Vector3.FromArrayToRef(c, p, d),
                        e.Vector2.FromArrayToRef(h, p / 3 * 2, x);
                        var f = 4 * ((Math.abs(x.x * s.x + a.x) * r % r | 0) + (Math.abs(x.y * s.y + a.y) * i % i | 0) * r)
                          , m = .3 * (t[f] / 255) + .59 * (t[f + 1] / 255) + .11 * (t[f + 2] / 255);
                        d.normalize(),
                        d.scaleInPlace(n + (o - n) * m),
                        (u = u.add(d)).toArray(l, p)
                    }
                    return e.VertexData.ComputeNormals(l, this.getIndices(), c),
                    y ? (this.setVerticesData(e.VertexBuffer.PositionKind, l),
                    this.setVerticesData(e.VertexBuffer.NormalKind, c)) : (this.updateVerticesData(e.VertexBuffer.PositionKind, l),
                    this.updateVerticesData(e.VertexBuffer.NormalKind, c)),
                    this
                }
                ,
                i.prototype.convertToFlatShadedMesh = function() {
                    var t, r, i = this.getVerticesDataKinds(), n = {}, o = {}, a = {}, s = !1;
                    for (t = 0; t < i.length; t++) {
                        r = i[t];
                        var y = this.getVertexBuffer(r);
                        r !== e.VertexBuffer.NormalKind ? (n[r] = y,
                        o[r] = n[r].getData(),
                        a[r] = []) : (s = y.isUpdatable(),
                        i.splice(t, 1),
                        t--)
                    }
                    var l, c = this.subMeshes.slice(0), h = this.getIndices(), u = this.getTotalIndices();
                    for (l = 0; l < u; l++) {
                        var d = h[l];
                        for (t = 0; t < i.length; t++)
                            for (var x = n[r = i[t]].getStrideSize(), p = 0; p < x; p++)
                                a[r].push(o[r][d * x + p])
                    }
                    var f = []
                      , m = a[e.VertexBuffer.PositionKind];
                    for (l = 0; l < u; l += 3) {
                        h[l] = l,
                        h[l + 1] = l + 1,
                        h[l + 2] = l + 2;
                        for (var z = e.Vector3.FromArray(m, 3 * l), _ = e.Vector3.FromArray(m, 3 * (l + 1)), g = e.Vector3.FromArray(m, 3 * (l + 2)), v = z.subtract(_), b = g.subtract(_), T = e.Vector3.Normalize(e.Vector3.Cross(v, b)), E = 0; E < 3; E++)
                            f.push(T.x),
                            f.push(T.y),
                            f.push(T.z)
                    }
                    for (this.setIndices(h),
                    this.setVerticesData(e.VertexBuffer.NormalKind, f, s),
                    t = 0; t < i.length; t++)
                        r = i[t],
                        this.setVerticesData(r, a[r], n[r].isUpdatable());
                    this.releaseSubMeshes();
                    for (var P = 0; P < c.length; P++) {
                        var A = c[P];
                        e.SubMesh.AddToMesh(A.materialIndex, A.indexStart, A.indexCount, A.indexStart, A.indexCount, this)
                    }
                    return this.synchronizeInstances(),
                    this
                }
                ,
                i.prototype.convertToUnIndexedMesh = function() {
                    var t, r, i = this.getVerticesDataKinds(), n = {}, o = {}, a = {};
                    for (t = 0; t < i.length; t++) {
                        r = i[t];
                        var s = this.getVertexBuffer(r);
                        n[r] = s,
                        o[r] = n[r].getData(),
                        a[r] = []
                    }
                    var y, l = this.subMeshes.slice(0), c = this.getIndices(), h = this.getTotalIndices();
                    for (y = 0; y < h; y++) {
                        var u = c[y];
                        for (t = 0; t < i.length; t++)
                            for (var d = n[r = i[t]].getStrideSize(), x = 0; x < d; x++)
                                a[r].push(o[r][u * d + x])
                    }
                    for (y = 0; y < h; y += 3)
                        c[y] = y,
                        c[y + 1] = y + 1,
                        c[y + 2] = y + 2;
                    for (this.setIndices(c),
                    t = 0; t < i.length; t++)
                        r = i[t],
                        this.setVerticesData(r, a[r], n[r].isUpdatable());
                    this.releaseSubMeshes();
                    for (var p = 0; p < l.length; p++) {
                        var f = l[p];
                        e.SubMesh.AddToMesh(f.materialIndex, f.indexStart, f.indexCount, f.indexStart, f.indexCount, this)
                    }
                    return this._unIndexed = !0,
                    this.synchronizeInstances(),
                    this
                }
                ,
                i.prototype.flipFaces = function(t) {
                    void 0 === t && (t = !1);
                    var r, i, n = e.VertexData.ExtractFromMesh(this);
                    if (t && this.isVerticesDataPresent(e.VertexBuffer.NormalKind) && n.normals)
                        for (r = 0; r < n.normals.length; r++)
                            n.normals[r] *= -1;
                    if (n.indices)
                        for (r = 0; r < n.indices.length; r += 3)
                            i = n.indices[r + 1],
                            n.indices[r + 1] = n.indices[r + 2],
                            n.indices[r + 2] = i;
                    return n.applyToMesh(this),
                    this
                }
                ,
                i.prototype.createInstance = function(t) {
                    return new e.InstancedMesh(t,this)
                }
                ,
                i.prototype.synchronizeInstances = function() {
                    for (var e = 0; e < this.instances.length; e++) {
                        this.instances[e]._syncSubMeshes()
                    }
                    return this
                }
                ,
                i.prototype.optimizeIndices = function(t) {
                    var r = this
                      , i = this.getIndices()
                      , n = this.getVerticesData(e.VertexBuffer.PositionKind);
                    if (!n || !i)
                        return this;
                    for (var o = new Array, a = 0; a < n.length; a += 3)
                        o.push(e.Vector3.FromArray(n, a));
                    var s = new Array;
                    return e.AsyncLoop.SyncAsyncForLoop(o.length, 40, (function(e) {
                        for (var t = o.length - 1 - e, r = o[t], i = 0; i < t; ++i) {
                            var n = o[i];
                            if (r.equals(n)) {
                                s[t] = i;
                                break
                            }
                        }
                    }
                    ), (function() {
                        for (var e = 0; e < i.length; ++e)
                            i[e] = s[i[e]] || i[e];
                        var n = r.subMeshes.slice(0);
                        r.setIndices(i),
                        r.subMeshes = n,
                        t && t(r)
                    }
                    )),
                    this
                }
                ,
                i.prototype.serialize = function(t) {
                    t.name = this.name,
                    t.id = this.id,
                    t.type = this.getClassName(),
                    e.Tags && e.Tags.HasTags(this) && (t.tags = e.Tags.GetTags(this)),
                    t.position = this.position.asArray(),
                    this.rotationQuaternion ? t.rotationQuaternion = this.rotationQuaternion.asArray() : this.rotation && (t.rotation = this.rotation.asArray()),
                    t.scaling = this.scaling.asArray(),
                    t.localMatrix = this.getPivotMatrix().asArray(),
                    t.isEnabled = this.isEnabled(!1),
                    t.isVisible = this.isVisible,
                    t.infiniteDistance = this.infiniteDistance,
                    t.pickable = this.isPickable,
                    t.receiveShadows = this.receiveShadows,
                    t.billboardMode = this.billboardMode,
                    t.visibility = this.visibility,
                    t.checkCollisions = this.checkCollisions,
                    t.isBlocker = this.isBlocker,
                    this.parent && (t.parentId = this.parent.id),
                    t.isUnIndexed = this.isUnIndexed;
                    var r = this._geometry;
                    if (r) {
                        var i = r.id;
                        t.geometryId = i,
                        t.subMeshes = [];
                        for (var n = 0; n < this.subMeshes.length; n++) {
                            var o = this.subMeshes[n];
                            t.subMeshes.push({
                                materialIndex: o.materialIndex,
                                verticesStart: o.verticesStart,
                                verticesCount: o.verticesCount,
                                indexStart: o.indexStart,
                                indexCount: o.indexCount
                            })
                        }
                    }
                    this.material ? t.materialId = this.material.id : this.material = null,
                    this.morphTargetManager && (t.morphTargetManagerId = this.morphTargetManager.uniqueId),
                    this.skeleton && (t.skeletonId = this.skeleton.id);
                    var a = this.getPhysicsImpostor();
                    a && (t.physicsMass = a.getParam("mass"),
                    t.physicsFriction = a.getParam("friction"),
                    t.physicsRestitution = a.getParam("mass"),
                    t.physicsImpostor = a.type),
                    this.metadata && (t.metadata = this.metadata),
                    t.instances = [];
                    for (var s = 0; s < this.instances.length; s++) {
                        var y = this.instances[s];
                        if (!y.doNotSerialize) {
                            var l = {
                                name: y.name,
                                id: y.id,
                                position: y.position.asArray(),
                                scaling: y.scaling.asArray()
                            };
                            y.parent && (l.parentId = y.parent.id),
                            y.rotationQuaternion ? l.rotationQuaternion = y.rotationQuaternion.asArray() : y.rotation && (l.rotation = y.rotation.asArray()),
                            t.instances.push(l),
                            e.Animation.AppendSerializedAnimations(y, l),
                            l.ranges = y.serializeAnimationRanges()
                        }
                    }
                    e.Animation.AppendSerializedAnimations(this, t),
                    t.ranges = this.serializeAnimationRanges(),
                    t.layerMask = this.layerMask,
                    t.alphaIndex = this.alphaIndex,
                    t.hasVertexAlpha = this.hasVertexAlpha,
                    t.overlayAlpha = this.overlayAlpha,
                    t.overlayColor = this.overlayColor.asArray(),
                    t.renderOverlay = this.renderOverlay,
                    t.applyFog = this.applyFog,
                    this.actionManager && (t.actions = this.actionManager.serialize(this.name))
                }
                ,
                i.prototype._syncGeometryWithMorphTargetManager = function() {
                    if (this.geometry) {
                        this._markSubMeshesAsAttributesDirty();
                        var t = this._morphTargetManager;
                        if (t && t.vertexCount) {
                            if (t.vertexCount !== this.getTotalVertices())
                                return e.Tools.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),
                                void (this.morphTargetManager = null);
                            for (var r = 0; r < t.numInfluencers; r++) {
                                var i = t.getActiveTarget(r)
                                  , n = i.getPositions();
                                if (!n)
                                    return void e.Tools.Error("Invalid morph target. Target must have positions.");
                                this.geometry.setVerticesData(e.VertexBuffer.PositionKind + r, n, !1, 3);
                                var o = i.getNormals();
                                o && this.geometry.setVerticesData(e.VertexBuffer.NormalKind + r, o, !1, 3);
                                var a = i.getTangents();
                                a && this.geometry.setVerticesData(e.VertexBuffer.TangentKind + r, a, !1, 3)
                            }
                        } else
                            for (r = 0; this.geometry.isVerticesDataPresent(e.VertexBuffer.PositionKind + r); )
                                this.geometry.removeVerticesData(e.VertexBuffer.PositionKind + r),
                                this.geometry.isVerticesDataPresent(e.VertexBuffer.NormalKind + r) && this.geometry.removeVerticesData(e.VertexBuffer.NormalKind + r),
                                this.geometry.isVerticesDataPresent(e.VertexBuffer.TangentKind + r) && this.geometry.removeVerticesData(e.VertexBuffer.TangentKind + r),
                                r++
                    }
                }
                ,
                i.Parse = function(t, r, n) {
                    var o;
                    if ((o = t.type && "GroundMesh" === t.type ? e.GroundMesh.Parse(t, r) : new i(t.name,r)).id = t.id,
                    e.Tags && e.Tags.AddTagsTo(o, t.tags),
                    o.position = e.Vector3.FromArray(t.position),
                    void 0 !== t.metadata && (o.metadata = t.metadata),
                    t.rotationQuaternion ? o.rotationQuaternion = e.Quaternion.FromArray(t.rotationQuaternion) : t.rotation && (o.rotation = e.Vector3.FromArray(t.rotation)),
                    o.scaling = e.Vector3.FromArray(t.scaling),
                    t.localMatrix ? o.setPreTransformMatrix(e.Matrix.FromArray(t.localMatrix)) : t.pivotMatrix && o.setPivotMatrix(e.Matrix.FromArray(t.pivotMatrix)),
                    o.setEnabled(t.isEnabled),
                    o.isVisible = t.isVisible,
                    o.infiniteDistance = t.infiniteDistance,
                    o.showBoundingBox = t.showBoundingBox,
                    o.showSubMeshesBoundingBox = t.showSubMeshesBoundingBox,
                    void 0 !== t.applyFog && (o.applyFog = t.applyFog),
                    void 0 !== t.pickable && (o.isPickable = t.pickable),
                    void 0 !== t.alphaIndex && (o.alphaIndex = t.alphaIndex),
                    o.receiveShadows = t.receiveShadows,
                    o.billboardMode = t.billboardMode,
                    void 0 !== t.visibility && (o.visibility = t.visibility),
                    o.checkCollisions = t.checkCollisions,
                    void 0 !== t.isBlocker && (o.isBlocker = t.isBlocker),
                    o._shouldGenerateFlatShading = t.useFlatShading,
                    t.freezeWorldMatrix && (o._waitingFreezeWorldMatrix = t.freezeWorldMatrix),
                    t.parentId && (o._waitingParentId = t.parentId),
                    void 0 !== t.actions && (o._waitingActions = t.actions),
                    void 0 !== t.overlayAlpha && (o.overlayAlpha = t.overlayAlpha),
                    void 0 !== t.overlayColor && (o.overlayColor = e.Color3.FromArray(t.overlayColor)),
                    void 0 !== t.renderOverlay && (o.renderOverlay = t.renderOverlay),
                    o.isUnIndexed = !!t.isUnIndexed,
                    o.hasVertexAlpha = t.hasVertexAlpha,
                    t.delayLoadingFile ? (o.delayLoadState = e.Engine.DELAYLOADSTATE_NOTLOADED,
                    o.delayLoadingFile = n + t.delayLoadingFile,
                    o._boundingInfo = new e.BoundingInfo(e.Vector3.FromArray(t.boundingBoxMinimum),e.Vector3.FromArray(t.boundingBoxMaximum)),
                    t._binaryInfo && (o._binaryInfo = t._binaryInfo),
                    o._delayInfo = [],
                    t.hasUVs && o._delayInfo.push(e.VertexBuffer.UVKind),
                    t.hasUVs2 && o._delayInfo.push(e.VertexBuffer.UV2Kind),
                    t.hasUVs3 && o._delayInfo.push(e.VertexBuffer.UV3Kind),
                    t.hasUVs4 && o._delayInfo.push(e.VertexBuffer.UV4Kind),
                    t.hasUVs5 && o._delayInfo.push(e.VertexBuffer.UV5Kind),
                    t.hasUVs6 && o._delayInfo.push(e.VertexBuffer.UV6Kind),
                    t.hasColors && o._delayInfo.push(e.VertexBuffer.ColorKind),
                    t.hasMatricesIndices && o._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),
                    t.hasMatricesWeights && o._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),
                    o._delayLoadingFunction = e.Geometry._ImportGeometry,
                    e.SceneLoader.ForceFullSceneLoadingForIncremental && o._checkDelayState()) : e.Geometry._ImportGeometry(t, o),
                    t.materialId ? o.setMaterialByID(t.materialId) : o.material = null,
                    t.morphTargetManagerId > -1 && (o.morphTargetManager = r.getMorphTargetManagerById(t.morphTargetManagerId)),
                    t.skeletonId > -1 && (o.skeleton = r.getLastSkeletonByID(t.skeletonId),
                    t.numBoneInfluencers && (o.numBoneInfluencers = t.numBoneInfluencers)),
                    t.animations) {
                        for (var a = 0; a < t.animations.length; a++) {
                            var s = t.animations[a];
                            o.animations.push(e.Animation.Parse(s))
                        }
                        e.Node.ParseAnimationRanges(o, t, r)
                    }
                    if (t.autoAnimate && r.beginAnimation(o, t.autoAnimateFrom, t.autoAnimateTo, t.autoAnimateLoop, t.autoAnimateSpeed || 1),
                    t.layerMask && !isNaN(t.layerMask) ? o.layerMask = Math.abs(parseInt(t.layerMask)) : o.layerMask = 268435455,
                    t.physicsImpostor && (o.physicsImpostor = new e.PhysicsImpostor(o,t.physicsImpostor,{
                        mass: t.physicsMass,
                        friction: t.physicsFriction,
                        restitution: t.physicsRestitution
                    },r)),
                    t.instances)
                        for (var y = 0; y < t.instances.length; y++) {
                            var l = t.instances[y]
                              , c = o.createInstance(l.name);
                            if (l.id && (c.id = l.id),
                            e.Tags && (l.tags ? e.Tags.AddTagsTo(c, l.tags) : e.Tags.AddTagsTo(c, t.tags)),
                            c.position = e.Vector3.FromArray(l.position),
                            l.parentId && (c._waitingParentId = l.parentId),
                            l.rotationQuaternion ? c.rotationQuaternion = e.Quaternion.FromArray(l.rotationQuaternion) : l.rotation && (c.rotation = e.Vector3.FromArray(l.rotation)),
                            c.scaling = e.Vector3.FromArray(l.scaling),
                            null != l.checkCollisions && null != l.checkCollisions && (c.checkCollisions = l.checkCollisions),
                            null != l.pickable && null != l.pickable && (c.isPickable = l.pickable),
                            null != l.showBoundingBox && null != l.showBoundingBox && (c.showBoundingBox = l.showBoundingBox),
                            null != l.showSubMeshesBoundingBox && null != l.showSubMeshesBoundingBox && (c.showSubMeshesBoundingBox = l.showSubMeshesBoundingBox),
                            null != l.alphaIndex && null != l.showSubMeshesBoundingBox && (c.alphaIndex = l.alphaIndex),
                            l.physicsImpostor && (c.physicsImpostor = new e.PhysicsImpostor(c,l.physicsImpostor,{
                                mass: l.physicsMass,
                                friction: l.physicsFriction,
                                restitution: l.physicsRestitution
                            },r)),
                            l.animations) {
                                for (a = 0; a < l.animations.length; a++)
                                    s = l.animations[a],
                                    c.animations.push(e.Animation.Parse(s));
                                e.Node.ParseAnimationRanges(c, l, r),
                                l.autoAnimate && r.beginAnimation(c, l.autoAnimateFrom, l.autoAnimateTo, l.autoAnimateLoop, l.autoAnimateSpeed || 1)
                            }
                        }
                    return o
                }
                ,
                i.CreateRibbon = function(t, r, i, n, o, a, s, y, l) {
                    return void 0 === i && (i = !1),
                    void 0 === s && (s = !1),
                    e.MeshBuilder.CreateRibbon(t, {
                        pathArray: r,
                        closeArray: i,
                        closePath: n,
                        offset: o,
                        updatable: s,
                        sideOrientation: y,
                        instance: l
                    }, a)
                }
                ,
                i.CreateDisc = function(t, r, i, n, o, a) {
                    void 0 === n && (n = null);
                    var s = {
                        radius: r,
                        tessellation: i,
                        sideOrientation: a,
                        updatable: o
                    };
                    return e.MeshBuilder.CreateDisc(t, s, n)
                }
                ,
                i.CreateBox = function(t, r, i, n, o) {
                    void 0 === i && (i = null);
                    var a = {
                        size: r,
                        sideOrientation: o,
                        updatable: n
                    };
                    return e.MeshBuilder.CreateBox(t, a, i)
                }
                ,
                i.CreateSphere = function(t, r, i, n, o, a) {
                    var s = {
                        segments: r,
                        diameterX: i,
                        diameterY: i,
                        diameterZ: i,
                        sideOrientation: a,
                        updatable: o
                    };
                    return e.MeshBuilder.CreateSphere(t, s, n)
                }
                ,
                i.CreateCylinder = function(t, r, n, o, a, s, y, l, c) {
                    void 0 !== y && y instanceof e.Scene || (void 0 !== y && (c = l || i.DEFAULTSIDE,
                    l = y),
                    y = s,
                    s = 1);
                    var h = {
                        height: r,
                        diameterTop: n,
                        diameterBottom: o,
                        tessellation: a,
                        subdivisions: s,
                        sideOrientation: c,
                        updatable: l
                    };
                    return e.MeshBuilder.CreateCylinder(t, h, y)
                }
                ,
                i.CreateTorus = function(t, r, i, n, o, a, s) {
                    var y = {
                        diameter: r,
                        thickness: i,
                        tessellation: n,
                        sideOrientation: s,
                        updatable: a
                    };
                    return e.MeshBuilder.CreateTorus(t, y, o)
                }
                ,
                i.CreateTorusKnot = function(t, r, i, n, o, a, s, y, l, c) {
                    var h = {
                        radius: r,
                        tube: i,
                        radialSegments: n,
                        tubularSegments: o,
                        p: a,
                        q: s,
                        sideOrientation: c,
                        updatable: l
                    };
                    return e.MeshBuilder.CreateTorusKnot(t, h, y)
                }
                ,
                i.CreateLines = function(t, r, i, n, o) {
                    void 0 === i && (i = null),
                    void 0 === n && (n = !1),
                    void 0 === o && (o = null);
                    var a = {
                        points: r,
                        updatable: n,
                        instance: o
                    };
                    return e.MeshBuilder.CreateLines(t, a, i)
                }
                ,
                i.CreateDashedLines = function(t, r, i, n, o, a, s, y) {
                    void 0 === a && (a = null);
                    var l = {
                        points: r,
                        dashSize: i,
                        gapSize: n,
                        dashNb: o,
                        updatable: s,
                        instance: y
                    };
                    return e.MeshBuilder.CreateDashedLines(t, l, a)
                }
                ,
                i.CreatePolygon = function(t, r, i, n, o, a) {
                    var s = {
                        shape: r,
                        holes: n,
                        updatable: o,
                        sideOrientation: a
                    };
                    return e.MeshBuilder.CreatePolygon(t, s, i)
                }
                ,
                i.ExtrudePolygon = function(t, r, i, n, o, a, s) {
                    var y = {
                        shape: r,
                        holes: o,
                        depth: i,
                        updatable: a,
                        sideOrientation: s
                    };
                    return e.MeshBuilder.ExtrudePolygon(t, y, n)
                }
                ,
                i.ExtrudeShape = function(t, r, n, o, a, s, y, l, c, h) {
                    void 0 === y && (y = null);
                    var u = {
                        shape: r,
                        path: n,
                        scale: o,
                        rotation: a,
                        cap: 0 === s ? 0 : s || i.NO_CAP,
                        sideOrientation: c,
                        instance: h,
                        updatable: l
                    };
                    return e.MeshBuilder.ExtrudeShape(t, u, y)
                }
                ,
                i.ExtrudeShapeCustom = function(t, r, n, o, a, s, y, l, c, h, u, d) {
                    var x = {
                        shape: r,
                        path: n,
                        scaleFunction: o,
                        rotationFunction: a,
                        ribbonCloseArray: s,
                        ribbonClosePath: y,
                        cap: 0 === l ? 0 : l || i.NO_CAP,
                        sideOrientation: u,
                        instance: d,
                        updatable: h
                    };
                    return e.MeshBuilder.ExtrudeShapeCustom(t, x, c)
                }
                ,
                i.CreateLathe = function(t, r, i, n, o, a, s) {
                    var y = {
                        shape: r,
                        radius: i,
                        tessellation: n,
                        sideOrientation: s,
                        updatable: a
                    };
                    return e.MeshBuilder.CreateLathe(t, y, o)
                }
                ,
                i.CreatePlane = function(t, r, i, n, o) {
                    var a = {
                        size: r,
                        width: r,
                        height: r,
                        sideOrientation: o,
                        updatable: n
                    };
                    return e.MeshBuilder.CreatePlane(t, a, i)
                }
                ,
                i.CreateGround = function(t, r, i, n, o, a) {
                    var s = {
                        width: r,
                        height: i,
                        subdivisions: n,
                        updatable: a
                    };
                    return e.MeshBuilder.CreateGround(t, s, o)
                }
                ,
                i.CreateTiledGround = function(t, r, i, n, o, a, s, y, l) {
                    var c = {
                        xmin: r,
                        zmin: i,
                        xmax: n,
                        zmax: o,
                        subdivisions: a,
                        precision: s,
                        updatable: l
                    };
                    return e.MeshBuilder.CreateTiledGround(t, c, y)
                }
                ,
                i.CreateGroundFromHeightMap = function(t, r, i, n, o, a, s, y, l, c, h) {
                    var u = {
                        width: i,
                        height: n,
                        subdivisions: o,
                        minHeight: a,
                        maxHeight: s,
                        updatable: l,
                        onReady: c,
                        alphaFilter: h
                    };
                    return e.MeshBuilder.CreateGroundFromHeightMap(t, r, u, y)
                }
                ,
                i.CreateTube = function(t, r, i, n, o, a, s, y, l, c) {
                    var h = {
                        path: r,
                        radius: i,
                        tessellation: n,
                        radiusFunction: o,
                        arc: 1,
                        cap: a,
                        updatable: y,
                        sideOrientation: l,
                        instance: c
                    };
                    return e.MeshBuilder.CreateTube(t, h, s)
                }
                ,
                i.CreatePolyhedron = function(t, r, i) {
                    return e.MeshBuilder.CreatePolyhedron(t, r, i)
                }
                ,
                i.CreateIcoSphere = function(t, r, i) {
                    return e.MeshBuilder.CreateIcoSphere(t, r, i)
                }
                ,
                i.CreateDecal = function(t, r, i, n, o, a) {
                    var s = {
                        position: i,
                        normal: n,
                        size: o,
                        angle: a
                    };
                    return e.MeshBuilder.CreateDecal(t, r, s)
                }
                ,
                i.prototype.setPositionsForCPUSkinning = function() {
                    if (!this._sourcePositions) {
                        var t = this.getVerticesData(e.VertexBuffer.PositionKind);
                        if (!t)
                            return this._sourcePositions;
                        this._sourcePositions = new Float32Array(t),
                        this.isVertexBufferUpdatable(e.VertexBuffer.PositionKind) || this.setVerticesData(e.VertexBuffer.PositionKind, t, !0)
                    }
                    return this._sourcePositions
                }
                ,
                i.prototype.setNormalsForCPUSkinning = function() {
                    if (!this._sourceNormals) {
                        var t = this.getVerticesData(e.VertexBuffer.NormalKind);
                        if (!t)
                            return this._sourceNormals;
                        this._sourceNormals = new Float32Array(t),
                        this.isVertexBufferUpdatable(e.VertexBuffer.NormalKind) || this.setVerticesData(e.VertexBuffer.NormalKind, t, !0)
                    }
                    return this._sourceNormals
                }
                ,
                i.prototype.applySkeleton = function(t) {
                    if (!this.geometry)
                        return this;
                    if (this.geometry._softwareSkinningFrameId == this.getScene().getFrameId())
                        return this;
                    if (this.geometry._softwareSkinningFrameId = this.getScene().getFrameId(),
                    !this.isVerticesDataPresent(e.VertexBuffer.PositionKind))
                        return this;
                    if (!this.isVerticesDataPresent(e.VertexBuffer.NormalKind))
                        return this;
                    if (!this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind))
                        return this;
                    if (!this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind))
                        return this;
                    if (!this._sourcePositions) {
                        var r = this.subMeshes.slice();
                        this.setPositionsForCPUSkinning(),
                        this.subMeshes = r
                    }
                    this._sourceNormals || this.setNormalsForCPUSkinning();
                    var i = this.getVerticesData(e.VertexBuffer.PositionKind);
                    if (!i)
                        return this;
                    i instanceof Float32Array || (i = new Float32Array(i));
                    var n = this.getVerticesData(e.VertexBuffer.NormalKind);
                    if (!n)
                        return this;
                    n instanceof Float32Array || (n = new Float32Array(n));
                    var o = this.getVerticesData(e.VertexBuffer.MatricesIndicesKind)
                      , a = this.getVerticesData(e.VertexBuffer.MatricesWeightsKind);
                    if (!a || !o)
                        return this;
                    for (var s, y = this.numBoneInfluencers > 4, l = y ? this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind) : null, c = y ? this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind) : null, h = t.getTransformMatrices(this), u = e.Vector3.Zero(), d = new e.Matrix, x = new e.Matrix, p = 0, f = 0; f < i.length; f += 3,
                    p += 4) {
                        var m;
                        for (s = 0; s < 4; s++)
                            (m = a[p + s]) > 0 && (e.Matrix.FromFloat32ArrayToRefScaled(h, Math.floor(16 * o[p + s]), m, x),
                            d.addToSelf(x));
                        if (y)
                            for (s = 0; s < 4; s++)
                                (m = c[p + s]) > 0 && (e.Matrix.FromFloat32ArrayToRefScaled(h, Math.floor(16 * l[p + s]), m, x),
                                d.addToSelf(x));
                        e.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[f], this._sourcePositions[f + 1], this._sourcePositions[f + 2], d, u),
                        u.toArray(i, f),
                        e.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[f], this._sourceNormals[f + 1], this._sourceNormals[f + 2], d, u),
                        u.toArray(n, f),
                        d.reset()
                    }
                    return this.updateVerticesData(e.VertexBuffer.PositionKind, i),
                    this.updateVerticesData(e.VertexBuffer.NormalKind, n),
                    this
                }
                ,
                i.MinMax = function(t) {
                    var r = null
                      , i = null;
                    return t.forEach((function(e, t, n) {
                        var o = e.getBoundingInfo().boundingBox;
                        r && i ? (r.minimizeInPlace(o.minimumWorld),
                        i.maximizeInPlace(o.maximumWorld)) : (r = o.minimumWorld,
                        i = o.maximumWorld)
                    }
                    )),
                    r && i ? {
                        min: r,
                        max: i
                    } : {
                        min: e.Vector3.Zero(),
                        max: e.Vector3.Zero()
                    }
                }
                ,
                i.Center = function(t) {
                    var r = t instanceof Array ? i.MinMax(t) : t;
                    return e.Vector3.Center(r.min, r.max)
                }
                ,
                i.MergeMeshes = function(t, r, n, o, a) {
                    var s;
                    if (void 0 === r && (r = !0),
                    !n) {
                        var y = 0;
                        for (s = 0; s < t.length; s++)
                            if (t[s] && (y += t[s].getTotalVertices()) > 65536)
                                return e.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),
                                null
                    }
                    var l, c = null, h = new Array, u = null;
                    for (s = 0; s < t.length; s++)
                        if (t[s]) {
                            var d = t[s].computeWorldMatrix(!0);
                            (l = e.VertexData.ExtractFromMesh(t[s], !0, !0)).transform(d),
                            c ? c.merge(l, n) : (c = l,
                            u = t[s]),
                            a && h.push(t[s].getTotalIndices())
                        }
                    if (u = u,
                    o || (o = new i(u.name + "_merged",u.getScene())),
                    c.applyToMesh(o),
                    o.material = u.material,
                    o.checkCollisions = u.checkCollisions,
                    r)
                        for (s = 0; s < t.length; s++)
                            t[s] && t[s].dispose();
                    if (a) {
                        o.releaseSubMeshes(),
                        s = 0;
                        for (var x = 0; s < h.length; )
                            e.SubMesh.CreateFromIndices(0, x, h[s], o),
                            x += h[s],
                            s++
                    }
                    return o
                }
                ,
                i.FRONTSIDE = 0,
                i.BACKSIDE = 1,
                i.DOUBLESIDE = 2,
                i.DEFAULTSIDE = 0,
                i.NO_CAP = 0,
                i.CAP_START = 1,
                i.CAP_END = 2,
                i.CAP_ALL = 3,
                i
            }(e.AbstractMesh);
            e.Mesh = n
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {}
                return Object.defineProperty(e.prototype, "effect", {
                    get: function() {
                        return this._materialEffect
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype.setEffect = function(e, t) {
                    void 0 === t && (t = null),
                    this._materialEffect !== e ? (this._materialDefines = t,
                    this._materialEffect = e) : e || (this._materialDefines = null)
                }
                ,
                e
            }();
            e.BaseSubMesh = t;
            var r = function(t) {
                function r(e, r, i, n, o, a, s, y) {
                    void 0 === y && (y = !0);
                    var l = t.call(this) || this;
                    return l.materialIndex = e,
                    l.verticesStart = r,
                    l.verticesCount = i,
                    l.indexStart = n,
                    l.indexCount = o,
                    l._renderId = 0,
                    l._mesh = a,
                    l._renderingMesh = s || a,
                    a.subMeshes.push(l),
                    l._trianglePlanes = [],
                    l._id = a.subMeshes.length - 1,
                    y && (l.refreshBoundingInfo(),
                    a.computeWorldMatrix(!0)),
                    l
                }
                return o(r, t),
                r.AddToMesh = function(e, t, i, n, o, a, s, y) {
                    return void 0 === y && (y = !0),
                    new r(e,t,i,n,o,a,s,y)
                }
                ,
                Object.defineProperty(r.prototype, "IsGlobal", {
                    get: function() {
                        return 0 === this.verticesStart && this.verticesCount === this._mesh.getTotalVertices()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getBoundingInfo = function() {
                    return this.IsGlobal ? this._mesh.getBoundingInfo() : this._boundingInfo
                }
                ,
                r.prototype.setBoundingInfo = function(e) {
                    return this._boundingInfo = e,
                    this
                }
                ,
                r.prototype.getMesh = function() {
                    return this._mesh
                }
                ,
                r.prototype.getRenderingMesh = function() {
                    return this._renderingMesh
                }
                ,
                r.prototype.getMaterial = function() {
                    var e = this._renderingMesh.material;
                    if (null == e)
                        return this._mesh.getScene().defaultMaterial;
                    if (e.getSubMaterial) {
                        var t = e.getSubMaterial(this.materialIndex);
                        return this._currentMaterial !== t && (this._currentMaterial = t,
                        this._materialDefines = null),
                        t
                    }
                    return e
                }
                ,
                r.prototype.refreshBoundingInfo = function() {
                    if (this._lastColliderWorldVertices = null,
                    this.IsGlobal || !this._renderingMesh || !this._renderingMesh.geometry)
                        return this;
                    var t = this._renderingMesh.getVerticesData(e.VertexBuffer.PositionKind);
                    if (!t)
                        return this._boundingInfo = this._mesh.getBoundingInfo(),
                        this;
                    var r, i = this._renderingMesh.getIndices();
                    if (0 === this.indexStart && this.indexCount === i.length) {
                        var n = this._renderingMesh.getBoundingInfo();
                        r = {
                            minimum: n.minimum.clone(),
                            maximum: n.maximum.clone()
                        }
                    } else
                        r = e.Tools.ExtractMinAndMaxIndexed(t, i, this.indexStart, this.indexCount, this._renderingMesh.geometry.boundingBias);
                    return this._boundingInfo = new e.BoundingInfo(r.minimum,r.maximum),
                    this
                }
                ,
                r.prototype._checkCollision = function(e) {
                    return this.getBoundingInfo()._checkCollision(e)
                }
                ,
                r.prototype.updateBoundingInfo = function(e) {
                    var t = this.getBoundingInfo();
                    return t || (this.refreshBoundingInfo(),
                    t = this.getBoundingInfo()),
                    t.update(e),
                    this
                }
                ,
                r.prototype.isInFrustum = function(e) {
                    var t = this.getBoundingInfo();
                    return !!t && t.isInFrustum(e, this._mesh.cullingStrategy)
                }
                ,
                r.prototype.isCompletelyInFrustum = function(e) {
                    var t = this.getBoundingInfo();
                    return !!t && t.isCompletelyInFrustum(e)
                }
                ,
                r.prototype.render = function(e) {
                    return this._renderingMesh.render(this, e),
                    this
                }
                ,
                r.prototype._getLinesIndexBuffer = function(e, t) {
                    if (!this._linesIndexBuffer) {
                        for (var r = [], i = this.indexStart; i < this.indexStart + this.indexCount; i += 3)
                            r.push(e[i], e[i + 1], e[i + 1], e[i + 2], e[i + 2], e[i]);
                        this._linesIndexBuffer = t.createIndexBuffer(r),
                        this._linesIndexCount = r.length
                    }
                    return this._linesIndexBuffer
                }
                ,
                r.prototype.canIntersects = function(e) {
                    var t = this.getBoundingInfo();
                    return !!t && e.intersectsBox(t.boundingBox)
                }
                ,
                r.prototype.intersects = function(t, r, i, n) {
                    var o = this.getMaterial();
                    if (!o)
                        return null;
                    switch (o.fillMode) {
                    case e.Material.PointListDrawMode:
                    case e.Material.LineListDrawMode:
                    case e.Material.LineLoopDrawMode:
                    case e.Material.LineStripDrawMode:
                    case e.Material.TriangleFanDrawMode:
                    case e.Material.TriangleStripDrawMode:
                        return null
                    }
                    if (e.LinesMesh) {
                        var a = this._mesh instanceof e.InstancedMesh ? this._mesh.sourceMesh : this._mesh;
                        if (a instanceof e.LinesMesh) {
                            var s = a;
                            return this._intersectLines(t, r, i, s.intersectionThreshold, n)
                        }
                    }
                    return this._intersectTriangles(t, r, i, n)
                }
                ,
                r.prototype._intersectLines = function(t, r, i, n, o) {
                    for (var a = null, s = this.indexStart; s < this.indexStart + this.indexCount; s += 2) {
                        var y = r[i[s]]
                          , l = r[i[s + 1]]
                          , c = t.intersectionSegment(y, l, n);
                        if (!(c < 0) && ((o || !a || c < a.distance) && (a = new e.IntersectionInfo(null,null,c),
                        o)))
                            break
                    }
                    return a
                }
                ,
                r.prototype._intersectTriangles = function(e, t, r, i) {
                    for (var n = null, o = this.indexStart; o < this.indexStart + this.indexCount; o += 3) {
                        var a = t[r[o]]
                          , s = t[r[o + 1]]
                          , y = t[r[o + 2]]
                          , l = e.intersectsTriangle(a, s, y);
                        if (l) {
                            if (l.distance < 0)
                                continue;
                            if ((i || !n || l.distance < n.distance) && ((n = l).faceId = o / 3,
                            i))
                                break
                        }
                    }
                    return n
                }
                ,
                r.prototype._rebuild = function() {
                    this._linesIndexBuffer && (this._linesIndexBuffer = null)
                }
                ,
                r.prototype.clone = function(t, i) {
                    var n = new r(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,i,!1);
                    if (!this.IsGlobal) {
                        var o = this.getBoundingInfo();
                        if (!o)
                            return n;
                        n._boundingInfo = new e.BoundingInfo(o.minimum,o.maximum)
                    }
                    return n
                }
                ,
                r.prototype.dispose = function() {
                    this._linesIndexBuffer && (this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),
                    this._linesIndexBuffer = null);
                    var e = this._mesh.subMeshes.indexOf(this);
                    this._mesh.subMeshes.splice(e, 1)
                }
                ,
                r.CreateFromIndices = function(e, t, i, n, o) {
                    for (var a = Number.MAX_VALUE, s = -Number.MAX_VALUE, y = (o = o || n).getIndices(), l = t; l < t + i; l++) {
                        var c = y[l];
                        c < a && (a = c),
                        c > s && (s = c)
                    }
                    return new r(e,a,s - a + 1,t,i,n,o)
                }
                ,
                r
            }(t);
            e.SubMesh = r
        }(s || (s = {}));
        a = this && this.__assign || function() {
            return (a = Object.assign || function(e) {
                for (var t, r = 1, i = arguments.length; r < i; r++)
                    for (var n in t = arguments[r])
                        Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]);
                return e
            }
            ).apply(this, arguments)
        }
        ;
        !function(e) {
            var t = function() {
                function e() {
                    this._isDirty = !0,
                    this._areLightsDirty = !0,
                    this._areAttributesDirty = !0,
                    this._areTexturesDirty = !0,
                    this._areFresnelDirty = !0,
                    this._areMiscDirty = !0,
                    this._areImageProcessingDirty = !0,
                    this._normals = !1,
                    this._uvs = !1,
                    this._needNormals = !1,
                    this._needUVs = !1
                }
                return Object.defineProperty(e.prototype, "isDirty", {
                    get: function() {
                        return this._isDirty
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype.markAsProcessed = function() {
                    this._isDirty = !1,
                    this._areAttributesDirty = !1,
                    this._areTexturesDirty = !1,
                    this._areFresnelDirty = !1,
                    this._areLightsDirty = !1,
                    this._areMiscDirty = !1,
                    this._areImageProcessingDirty = !1
                }
                ,
                e.prototype.markAsUnprocessed = function() {
                    this._isDirty = !0
                }
                ,
                e.prototype.markAllAsDirty = function() {
                    this._areTexturesDirty = !0,
                    this._areAttributesDirty = !0,
                    this._areLightsDirty = !0,
                    this._areFresnelDirty = !0,
                    this._areMiscDirty = !0,
                    this._areImageProcessingDirty = !0,
                    this._isDirty = !0
                }
                ,
                e.prototype.markAsImageProcessingDirty = function() {
                    this._areImageProcessingDirty = !0,
                    this._isDirty = !0
                }
                ,
                e.prototype.markAsLightDirty = function() {
                    this._areLightsDirty = !0,
                    this._isDirty = !0
                }
                ,
                e.prototype.markAsAttributesDirty = function() {
                    this._areAttributesDirty = !0,
                    this._isDirty = !0
                }
                ,
                e.prototype.markAsTexturesDirty = function() {
                    this._areTexturesDirty = !0,
                    this._isDirty = !0
                }
                ,
                e.prototype.markAsFresnelDirty = function() {
                    this._areFresnelDirty = !0,
                    this._isDirty = !0
                }
                ,
                e.prototype.markAsMiscDirty = function() {
                    this._areMiscDirty = !0,
                    this._isDirty = !0
                }
                ,
                e.prototype.rebuild = function() {
                    this._keys && delete this._keys,
                    this._keys = [];
                    for (var e = 0, t = Object.keys(this); e < t.length; e++) {
                        var r = t[e];
                        "_" !== r[0] && this._keys.push(r)
                    }
                }
                ,
                e.prototype.isEqual = function(e) {
                    if (this._keys.length !== e._keys.length)
                        return !1;
                    for (var t = 0; t < this._keys.length; t++) {
                        var r = this._keys[t];
                        if (this[r] !== e[r])
                            return !1
                    }
                    return !0
                }
                ,
                e.prototype.cloneTo = function(e) {
                    this._keys.length !== e._keys.length && (e._keys = this._keys.slice(0));
                    for (var t = 0; t < this._keys.length; t++) {
                        var r = this._keys[t];
                        e[r] = this[r]
                    }
                }
                ,
                e.prototype.reset = function() {
                    for (var e = 0; e < this._keys.length; e++) {
                        var t = this._keys[e];
                        switch (typeof this[t]) {
                        case "number":
                            this[t] = 0;
                            break;
                        case "string":
                            this[t] = "";
                            break;
                        default:
                            this[t] = !1
                        }
                    }
                }
                ,
                e.prototype.toString = function() {
                    for (var e = "", t = 0; t < this._keys.length; t++) {
                        var r = this._keys[t]
                          , i = this[r];
                        switch (typeof i) {
                        case "number":
                        case "string":
                            e += "#define " + r + " " + i + "\n";
                            break;
                        default:
                            i && (e += "#define " + r + "\n")
                        }
                    }
                    return e
                }
                ,
                e
            }();
            e.MaterialDefines = t;
            var r = function() {
                function t(r, i, n) {
                    this.checkReadyOnEveryCall = !1,
                    this.checkReadyOnlyOnce = !1,
                    this.state = "",
                    this._alpha = 1,
                    this._backFaceCulling = !0,
                    this.doNotSerialize = !1,
                    this.storeEffectOnSubMeshes = !1,
                    this.onDisposeObservable = new e.Observable,
                    this._alphaMode = e.Engine.ALPHA_COMBINE,
                    this._needDepthPrePass = !1,
                    this.disableDepthWrite = !1,
                    this.forceDepthWrite = !1,
                    this.separateCullingPass = !1,
                    this._fogEnabled = !0,
                    this.pointSize = 1,
                    this.zOffset = 0,
                    this._wasPreviouslyReady = !1,
                    this._fillMode = t.TriangleFillMode,
                    this.name = r,
                    this.id = r || e.Tools.RandomId(),
                    this._scene = i || e.Engine.LastCreatedScene,
                    this.uniqueId = this._scene.getUniqueId(),
                    this._scene.useRightHandedSystem ? this.sideOrientation = t.ClockWiseSideOrientation : this.sideOrientation = t.CounterClockWiseSideOrientation,
                    this._uniformBuffer = new e.UniformBuffer(this._scene.getEngine()),
                    this._useUBO = this.getScene().getEngine().supportsUniformBuffers,
                    n || (this._scene.materials.push(this),
                    this._scene.onNewMaterialAddedObservable.notifyObservers(this))
                }
                return Object.defineProperty(t, "TriangleFillMode", {
                    get: function() {
                        return t._TriangleFillMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "WireFrameFillMode", {
                    get: function() {
                        return t._WireFrameFillMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "PointFillMode", {
                    get: function() {
                        return t._PointFillMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "PointListDrawMode", {
                    get: function() {
                        return t._PointListDrawMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "LineListDrawMode", {
                    get: function() {
                        return t._LineListDrawMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "LineLoopDrawMode", {
                    get: function() {
                        return t._LineLoopDrawMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "LineStripDrawMode", {
                    get: function() {
                        return t._LineStripDrawMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "TriangleStripDrawMode", {
                    get: function() {
                        return t._TriangleStripDrawMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "TriangleFanDrawMode", {
                    get: function() {
                        return t._TriangleFanDrawMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "ClockWiseSideOrientation", {
                    get: function() {
                        return t._ClockWiseSideOrientation
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "CounterClockWiseSideOrientation", {
                    get: function() {
                        return t._CounterClockWiseSideOrientation
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "alpha", {
                    get: function() {
                        return this._alpha
                    },
                    set: function(e) {
                        this._alpha !== e && (this._alpha = e,
                        this.markAsDirty(t.MiscDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "backFaceCulling", {
                    get: function() {
                        return this._backFaceCulling
                    },
                    set: function(e) {
                        this._backFaceCulling !== e && (this._backFaceCulling = e,
                        this.markAsDirty(t.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "hasRenderTargetTextures", {
                    get: function() {
                        return !1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onDispose", {
                    set: function(e) {
                        this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver),
                        this._onDisposeObserver = this.onDisposeObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onBindObservable", {
                    get: function() {
                        return this._onBindObservable || (this._onBindObservable = new e.Observable),
                        this._onBindObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onBind", {
                    set: function(e) {
                        this._onBindObserver && this.onBindObservable.remove(this._onBindObserver),
                        this._onBindObserver = this.onBindObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onUnBindObservable", {
                    get: function() {
                        return this._onUnBindObservable || (this._onUnBindObservable = new e.Observable),
                        this._onUnBindObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "alphaMode", {
                    get: function() {
                        return this._alphaMode
                    },
                    set: function(e) {
                        this._alphaMode !== e && (this._alphaMode = e,
                        this.markAsDirty(t.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "needDepthPrePass", {
                    get: function() {
                        return this._needDepthPrePass
                    },
                    set: function(e) {
                        this._needDepthPrePass !== e && (this._needDepthPrePass = e,
                        this._needDepthPrePass && (this.checkReadyOnEveryCall = !0))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "fogEnabled", {
                    get: function() {
                        return this._fogEnabled
                    },
                    set: function(e) {
                        this._fogEnabled !== e && (this._fogEnabled = e,
                        this.markAsDirty(t.MiscDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "wireframe", {
                    get: function() {
                        switch (this._fillMode) {
                        case t.WireFrameFillMode:
                        case t.LineListDrawMode:
                        case t.LineLoopDrawMode:
                        case t.LineStripDrawMode:
                            return !0
                        }
                        return this._scene.forceWireframe
                    },
                    set: function(e) {
                        this.fillMode = e ? t.WireFrameFillMode : t.TriangleFillMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "pointsCloud", {
                    get: function() {
                        switch (this._fillMode) {
                        case t.PointFillMode:
                        case t.PointListDrawMode:
                            return !0
                        }
                        return this._scene.forcePointsCloud
                    },
                    set: function(e) {
                        this.fillMode = e ? t.PointFillMode : t.TriangleFillMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "fillMode", {
                    get: function() {
                        return this._fillMode
                    },
                    set: function(e) {
                        this._fillMode !== e && (this._fillMode = e,
                        this.markAsDirty(t.MiscDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.toString = function(e) {
                    return "Name: " + this.name
                }
                ,
                t.prototype.getClassName = function() {
                    return "Material"
                }
                ,
                Object.defineProperty(t.prototype, "isFrozen", {
                    get: function() {
                        return this.checkReadyOnlyOnce
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.freeze = function() {
                    this.checkReadyOnlyOnce = !0
                }
                ,
                t.prototype.unfreeze = function() {
                    this.checkReadyOnlyOnce = !1
                }
                ,
                t.prototype.isReady = function(e, t) {
                    return !0
                }
                ,
                t.prototype.isReadyForSubMesh = function(e, t, r) {
                    return !1
                }
                ,
                t.prototype.getEffect = function() {
                    return this._effect
                }
                ,
                t.prototype.getScene = function() {
                    return this._scene
                }
                ,
                t.prototype.needAlphaBlending = function() {
                    return this.alpha < 1
                }
                ,
                t.prototype.needAlphaBlendingForMesh = function(e) {
                    return this.needAlphaBlending() || e.visibility < 1 || e.hasVertexAlpha
                }
                ,
                t.prototype.needAlphaTesting = function() {
                    return !1
                }
                ,
                t.prototype.getAlphaTestTexture = function() {
                    return null
                }
                ,
                t.prototype.markDirty = function() {
                    this._wasPreviouslyReady = !1
                }
                ,
                t.prototype._preBind = function(e, r) {
                    void 0 === r && (r = null);
                    var i = this._scene.getEngine()
                      , n = (null == r ? this.sideOrientation : r) === t.ClockWiseSideOrientation;
                    return i.enableEffect(e || this._effect),
                    i.setState(this.backFaceCulling, this.zOffset, !1, n),
                    n
                }
                ,
                t.prototype.bind = function(e, t) {}
                ,
                t.prototype.bindForSubMesh = function(e, t, r) {}
                ,
                t.prototype.bindOnlyWorldMatrix = function(e) {}
                ,
                t.prototype.bindSceneUniformBuffer = function(e, t) {
                    t.bindToEffect(e, "Scene")
                }
                ,
                t.prototype.bindView = function(e) {
                    this._useUBO ? this.bindSceneUniformBuffer(e, this.getScene().getSceneUniformBuffer()) : e.setMatrix("view", this.getScene().getViewMatrix())
                }
                ,
                t.prototype.bindViewProjection = function(e) {
                    this._useUBO ? this.bindSceneUniformBuffer(e, this.getScene().getSceneUniformBuffer()) : e.setMatrix("viewProjection", this.getScene().getTransformMatrix())
                }
                ,
                t.prototype._shouldTurnAlphaTestOn = function(e) {
                    return !this.needAlphaBlendingForMesh(e) && this.needAlphaTesting()
                }
                ,
                t.prototype._afterBind = function(e) {
                    if (this._scene._cachedMaterial = this,
                    this._scene._cachedVisibility = e ? e.visibility : 1,
                    this._onBindObservable && e && this._onBindObservable.notifyObservers(e),
                    this.disableDepthWrite) {
                        var t = this._scene.getEngine();
                        this._cachedDepthWriteState = t.getDepthWrite(),
                        t.setDepthWrite(!1)
                    }
                }
                ,
                t.prototype.unbind = function() {
                    (this._onUnBindObservable && this._onUnBindObservable.notifyObservers(this),
                    this.disableDepthWrite) && this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)
                }
                ,
                t.prototype.getActiveTextures = function() {
                    return []
                }
                ,
                t.prototype.hasTexture = function(e) {
                    return !1
                }
                ,
                t.prototype.clone = function(e) {
                    return null
                }
                ,
                t.prototype.getBindedMeshes = function() {
                    for (var e = new Array, t = 0; t < this._scene.meshes.length; t++) {
                        var r = this._scene.meshes[t];
                        r.material === this && e.push(r)
                    }
                    return e
                }
                ,
                t.prototype.forceCompilation = function(t, r, i) {
                    var n = this
                      , o = a({
                        clipPlane: !1
                    }, i)
                      , s = new e.BaseSubMesh
                      , y = this.getScene()
                      , l = function() {
                        if (n._scene && n._scene.getEngine()) {
                            s._materialDefines && (s._materialDefines._renderId = -1);
                            var i = y.clipPlane;
                            o.clipPlane && (y.clipPlane = new e.Plane(0,0,0,1)),
                            n.storeEffectOnSubMeshes ? n.isReadyForSubMesh(t, s) ? r && r(n) : setTimeout(l, 16) : n.isReady(t) ? r && r(n) : setTimeout(l, 16),
                            o.clipPlane && (y.clipPlane = i)
                        }
                    };
                    l()
                }
                ,
                t.prototype.forceCompilationAsync = function(e, t) {
                    var r = this;
                    return new Promise((function(i) {
                        r.forceCompilation(e, (function() {
                            i()
                        }
                        ), t)
                    }
                    ))
                }
                ,
                t.prototype.markAsDirty = function(e) {
                    e & t.TextureDirtyFlag && this._markAllSubMeshesAsTexturesDirty(),
                    e & t.LightDirtyFlag && this._markAllSubMeshesAsLightsDirty(),
                    e & t.FresnelDirtyFlag && this._markAllSubMeshesAsFresnelDirty(),
                    e & t.AttributesDirtyFlag && this._markAllSubMeshesAsAttributesDirty(),
                    e & t.MiscDirtyFlag && this._markAllSubMeshesAsMiscDirty(),
                    this.getScene().resetCachedMaterial()
                }
                ,
                t.prototype._markAllSubMeshesAsDirty = function(e) {
                    for (var t = 0, r = this.getScene().meshes; t < r.length; t++) {
                        var i = r[t];
                        if (i.subMeshes)
                            for (var n = 0, o = i.subMeshes; n < o.length; n++) {
                                var a = o[n];
                                a.getMaterial() === this && (a._materialDefines && e(a._materialDefines))
                            }
                    }
                }
                ,
                t.prototype._markAllSubMeshesAsImageProcessingDirty = function() {
                    this._markAllSubMeshesAsDirty((function(e) {
                        return e.markAsImageProcessingDirty()
                    }
                    ))
                }
                ,
                t.prototype._markAllSubMeshesAsTexturesDirty = function() {
                    this._markAllSubMeshesAsDirty((function(e) {
                        return e.markAsTexturesDirty()
                    }
                    ))
                }
                ,
                t.prototype._markAllSubMeshesAsFresnelDirty = function() {
                    this._markAllSubMeshesAsDirty((function(e) {
                        return e.markAsFresnelDirty()
                    }
                    ))
                }
                ,
                t.prototype._markAllSubMeshesAsFresnelAndMiscDirty = function() {
                    this._markAllSubMeshesAsDirty((function(e) {
                        e.markAsFresnelDirty(),
                        e.markAsMiscDirty()
                    }
                    ))
                }
                ,
                t.prototype._markAllSubMeshesAsLightsDirty = function() {
                    this._markAllSubMeshesAsDirty((function(e) {
                        return e.markAsLightDirty()
                    }
                    ))
                }
                ,
                t.prototype._markAllSubMeshesAsAttributesDirty = function() {
                    this._markAllSubMeshesAsDirty((function(e) {
                        return e.markAsAttributesDirty()
                    }
                    ))
                }
                ,
                t.prototype._markAllSubMeshesAsMiscDirty = function() {
                    this._markAllSubMeshesAsDirty((function(e) {
                        return e.markAsMiscDirty()
                    }
                    ))
                }
                ,
                t.prototype._markAllSubMeshesAsTexturesAndMiscDirty = function() {
                    this._markAllSubMeshesAsDirty((function(e) {
                        e.markAsTexturesDirty(),
                        e.markAsMiscDirty()
                    }
                    ))
                }
                ,
                t.prototype.dispose = function(e, t) {
                    this.getScene().stopAnimation(this),
                    this.getScene().freeProcessedMaterials();
                    var r = this._scene.materials.indexOf(this);
                    for (r >= 0 && this._scene.materials.splice(r, 1),
                    this._scene.onMaterialRemovedObservable.notifyObservers(this),
                    r = 0; r < this._scene.meshes.length; r++) {
                        var i = this._scene.meshes[r];
                        if (i.material === this && (i.material = null,
                        i.geometry)) {
                            var n = i.geometry;
                            if (this.storeEffectOnSubMeshes)
                                for (var o = 0, a = i.subMeshes; o < a.length; o++) {
                                    var s = a[o];
                                    n._releaseVertexArrayObject(s._materialEffect),
                                    e && s._materialEffect && this._scene.getEngine()._releaseEffect(s._materialEffect)
                                }
                            else
                                n._releaseVertexArrayObject(this._effect)
                        }
                    }
                    this._uniformBuffer.dispose(),
                    e && this._effect && (this.storeEffectOnSubMeshes || this._scene.getEngine()._releaseEffect(this._effect),
                    this._effect = null),
                    this.onDisposeObservable.notifyObservers(this),
                    this.onDisposeObservable.clear(),
                    this._onBindObservable && this._onBindObservable.clear(),
                    this._onUnBindObservable && this._onUnBindObservable.clear()
                }
                ,
                t.prototype.serialize = function() {
                    return e.SerializationHelper.Serialize(this)
                }
                ,
                t.ParseMultiMaterial = function(t, r) {
                    var i = new e.MultiMaterial(t.name,r);
                    i.id = t.id,
                    e.Tags && e.Tags.AddTagsTo(i, t.tags);
                    for (var n = 0; n < t.materials.length; n++) {
                        var o = t.materials[n];
                        o ? i.subMaterials.push(r.getMaterialByID(o)) : i.subMaterials.push(null)
                    }
                    return i
                }
                ,
                t.Parse = function(t, r, i) {
                    return t.customType && "BABYLON.StandardMaterial" !== t.customType ? "BABYLON.PBRMaterial" !== t.customType || !t.overloadedAlbedo || (t.customType = "BABYLON.LegacyPBRMaterial",
                    e.LegacyPBRMaterial) ? e.Tools.Instantiate(t.customType).Parse(t, r, i) : void e.Tools.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library.") : e.StandardMaterial.Parse(t, r, i)
                }
                ,
                t._TriangleFillMode = 0,
                t._WireFrameFillMode = 1,
                t._PointFillMode = 2,
                t._PointListDrawMode = 3,
                t._LineListDrawMode = 4,
                t._LineLoopDrawMode = 5,
                t._LineStripDrawMode = 6,
                t._TriangleStripDrawMode = 7,
                t._TriangleFanDrawMode = 8,
                t._ClockWiseSideOrientation = 0,
                t._CounterClockWiseSideOrientation = 1,
                t.TextureDirtyFlag = 1,
                t.LightDirtyFlag = 2,
                t.FresnelDirtyFlag = 4,
                t.AttributesDirtyFlag = 8,
                t.MiscDirtyFlag = 16,
                t.AllDirtyFlag = 31,
                n([e.serialize()], t.prototype, "id", void 0),
                n([e.serialize()], t.prototype, "uniqueId", void 0),
                n([e.serialize()], t.prototype, "name", void 0),
                n([e.serialize()], t.prototype, "checkReadyOnEveryCall", void 0),
                n([e.serialize()], t.prototype, "checkReadyOnlyOnce", void 0),
                n([e.serialize()], t.prototype, "state", void 0),
                n([e.serialize("alpha")], t.prototype, "_alpha", void 0),
                n([e.serialize("backFaceCulling")], t.prototype, "_backFaceCulling", void 0),
                n([e.serialize()], t.prototype, "sideOrientation", void 0),
                n([e.serialize("alphaMode")], t.prototype, "_alphaMode", void 0),
                n([e.serialize()], t.prototype, "_needDepthPrePass", void 0),
                n([e.serialize()], t.prototype, "disableDepthWrite", void 0),
                n([e.serialize()], t.prototype, "forceDepthWrite", void 0),
                n([e.serialize()], t.prototype, "separateCullingPass", void 0),
                n([e.serialize("fogEnabled")], t.prototype, "_fogEnabled", void 0),
                n([e.serialize()], t.prototype, "pointSize", void 0),
                n([e.serialize()], t.prototype, "zOffset", void 0),
                n([e.serialize()], t.prototype, "wireframe", null),
                n([e.serialize()], t.prototype, "pointsCloud", null),
                n([e.serialize()], t.prototype, "fillMode", null),
                t
            }();
            e.Material = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t, r) {
                    this._engine = e,
                    this._noUBO = !e.supportsUniformBuffers,
                    this._dynamic = r,
                    this._data = t || [],
                    this._uniformLocations = {},
                    this._uniformSizes = {},
                    this._uniformLocationPointer = 0,
                    this._needSync = !1,
                    this._noUBO ? (this.updateMatrix3x3 = this._updateMatrix3x3ForEffect,
                    this.updateMatrix2x2 = this._updateMatrix2x2ForEffect,
                    this.updateFloat = this._updateFloatForEffect,
                    this.updateFloat2 = this._updateFloat2ForEffect,
                    this.updateFloat3 = this._updateFloat3ForEffect,
                    this.updateFloat4 = this._updateFloat4ForEffect,
                    this.updateMatrix = this._updateMatrixForEffect,
                    this.updateVector3 = this._updateVector3ForEffect,
                    this.updateVector4 = this._updateVector4ForEffect,
                    this.updateColor3 = this._updateColor3ForEffect,
                    this.updateColor4 = this._updateColor4ForEffect) : (this._engine._uniformBuffers.push(this),
                    this.updateMatrix3x3 = this._updateMatrix3x3ForUniform,
                    this.updateMatrix2x2 = this._updateMatrix2x2ForUniform,
                    this.updateFloat = this._updateFloatForUniform,
                    this.updateFloat2 = this._updateFloat2ForUniform,
                    this.updateFloat3 = this._updateFloat3ForUniform,
                    this.updateFloat4 = this._updateFloat4ForUniform,
                    this.updateMatrix = this._updateMatrixForUniform,
                    this.updateVector3 = this._updateVector3ForUniform,
                    this.updateVector4 = this._updateVector4ForUniform,
                    this.updateColor3 = this._updateColor3ForUniform,
                    this.updateColor4 = this._updateColor4ForUniform)
                }
                return Object.defineProperty(t.prototype, "useUbo", {
                    get: function() {
                        return !this._noUBO
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "isSync", {
                    get: function() {
                        return !this._needSync
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.isDynamic = function() {
                    return void 0 !== this._dynamic
                }
                ,
                t.prototype.getData = function() {
                    return this._bufferData
                }
                ,
                t.prototype.getBuffer = function() {
                    return this._buffer
                }
                ,
                t.prototype._fillAlignment = function(e) {
                    var t;
                    if (t = e <= 2 ? e : 4,
                    this._uniformLocationPointer % t != 0) {
                        var r = this._uniformLocationPointer;
                        this._uniformLocationPointer += t - this._uniformLocationPointer % t;
                        for (var i = this._uniformLocationPointer - r, n = 0; n < i; n++)
                            this._data.push(0)
                    }
                }
                ,
                t.prototype.addUniform = function(e, t) {
                    if (!this._noUBO && void 0 === this._uniformLocations[e]) {
                        var r;
                        if (t instanceof Array)
                            t = (r = t).length;
                        else {
                            t = t,
                            r = [];
                            for (var i = 0; i < t; i++)
                                r.push(0)
                        }
                        this._fillAlignment(t),
                        this._uniformSizes[e] = t,
                        this._uniformLocations[e] = this._uniformLocationPointer,
                        this._uniformLocationPointer += t;
                        for (i = 0; i < t; i++)
                            this._data.push(r[i]);
                        this._needSync = !0
                    }
                }
                ,
                t.prototype.addMatrix = function(e, t) {
                    this.addUniform(e, Array.prototype.slice.call(t.toArray()))
                }
                ,
                t.prototype.addFloat2 = function(e, t, r) {
                    var i = [t, r];
                    this.addUniform(e, i)
                }
                ,
                t.prototype.addFloat3 = function(e, t, r, i) {
                    var n = [t, r, i];
                    this.addUniform(e, n)
                }
                ,
                t.prototype.addColor3 = function(e, t) {
                    var r = new Array;
                    t.toArray(r),
                    this.addUniform(e, r)
                }
                ,
                t.prototype.addColor4 = function(e, t, r) {
                    var i = new Array;
                    t.toArray(i),
                    i.push(r),
                    this.addUniform(e, i)
                }
                ,
                t.prototype.addVector3 = function(e, t) {
                    var r = new Array;
                    t.toArray(r),
                    this.addUniform(e, r)
                }
                ,
                t.prototype.addMatrix3x3 = function(e) {
                    this.addUniform(e, 12)
                }
                ,
                t.prototype.addMatrix2x2 = function(e) {
                    this.addUniform(e, 8)
                }
                ,
                t.prototype.create = function() {
                    this._noUBO || this._buffer || (this._fillAlignment(4),
                    this._bufferData = new Float32Array(this._data),
                    this._rebuild(),
                    this._needSync = !0)
                }
                ,
                t.prototype._rebuild = function() {
                    this._noUBO || (this._dynamic ? this._buffer = this._engine.createDynamicUniformBuffer(this._bufferData) : this._buffer = this._engine.createUniformBuffer(this._bufferData))
                }
                ,
                t.prototype.update = function() {
                    this._buffer ? (this._dynamic || this._needSync) && (this._engine.updateUniformBuffer(this._buffer, this._bufferData),
                    this._needSync = !1) : this.create()
                }
                ,
                t.prototype.updateUniform = function(t, r, i) {
                    var n = this._uniformLocations[t];
                    if (void 0 === n) {
                        if (this._buffer)
                            return void e.Tools.Error("Cannot add an uniform after UBO has been created.");
                        this.addUniform(t, i),
                        n = this._uniformLocations[t]
                    }
                    if (this._buffer || this.create(),
                    this._dynamic)
                        for (a = 0; a < i; a++)
                            this._bufferData[n + a] = r[a];
                    else {
                        for (var o = !1, a = 0; a < i; a++)
                            this._bufferData[n + a] !== r[a] && (o = !0,
                            this._bufferData[n + a] = r[a]);
                        this._needSync = this._needSync || o
                    }
                }
                ,
                t.prototype._updateMatrix3x3ForUniform = function(e, r) {
                    for (var i = 0; i < 3; i++)
                        t._tempBuffer[4 * i] = r[3 * i],
                        t._tempBuffer[4 * i + 1] = r[3 * i + 1],
                        t._tempBuffer[4 * i + 2] = r[3 * i + 2],
                        t._tempBuffer[4 * i + 3] = 0;
                    this.updateUniform(e, t._tempBuffer, 12)
                }
                ,
                t.prototype._updateMatrix3x3ForEffect = function(e, t) {
                    this._currentEffect.setMatrix3x3(e, t)
                }
                ,
                t.prototype._updateMatrix2x2ForEffect = function(e, t) {
                    this._currentEffect.setMatrix2x2(e, t)
                }
                ,
                t.prototype._updateMatrix2x2ForUniform = function(e, r) {
                    for (var i = 0; i < 2; i++)
                        t._tempBuffer[4 * i] = r[2 * i],
                        t._tempBuffer[4 * i + 1] = r[2 * i + 1],
                        t._tempBuffer[4 * i + 2] = 0,
                        t._tempBuffer[4 * i + 3] = 0;
                    this.updateUniform(e, t._tempBuffer, 8)
                }
                ,
                t.prototype._updateFloatForEffect = function(e, t) {
                    this._currentEffect.setFloat(e, t)
                }
                ,
                t.prototype._updateFloatForUniform = function(e, r) {
                    t._tempBuffer[0] = r,
                    this.updateUniform(e, t._tempBuffer, 1)
                }
                ,
                t.prototype._updateFloat2ForEffect = function(e, t, r, i) {
                    void 0 === i && (i = ""),
                    this._currentEffect.setFloat2(e + i, t, r)
                }
                ,
                t.prototype._updateFloat2ForUniform = function(e, r, i, n) {
                    void 0 === n && (n = ""),
                    t._tempBuffer[0] = r,
                    t._tempBuffer[1] = i,
                    this.updateUniform(e, t._tempBuffer, 2)
                }
                ,
                t.prototype._updateFloat3ForEffect = function(e, t, r, i, n) {
                    void 0 === n && (n = ""),
                    this._currentEffect.setFloat3(e + n, t, r, i)
                }
                ,
                t.prototype._updateFloat3ForUniform = function(e, r, i, n, o) {
                    void 0 === o && (o = ""),
                    t._tempBuffer[0] = r,
                    t._tempBuffer[1] = i,
                    t._tempBuffer[2] = n,
                    this.updateUniform(e, t._tempBuffer, 3)
                }
                ,
                t.prototype._updateFloat4ForEffect = function(e, t, r, i, n, o) {
                    void 0 === o && (o = ""),
                    this._currentEffect.setFloat4(e + o, t, r, i, n)
                }
                ,
                t.prototype._updateFloat4ForUniform = function(e, r, i, n, o, a) {
                    void 0 === a && (a = ""),
                    t._tempBuffer[0] = r,
                    t._tempBuffer[1] = i,
                    t._tempBuffer[2] = n,
                    t._tempBuffer[3] = o,
                    this.updateUniform(e, t._tempBuffer, 4)
                }
                ,
                t.prototype._updateMatrixForEffect = function(e, t) {
                    this._currentEffect.setMatrix(e, t)
                }
                ,
                t.prototype._updateMatrixForUniform = function(e, t) {
                    this.updateUniform(e, t.toArray(), 16)
                }
                ,
                t.prototype._updateVector3ForEffect = function(e, t) {
                    this._currentEffect.setVector3(e, t)
                }
                ,
                t.prototype._updateVector3ForUniform = function(e, r) {
                    r.toArray(t._tempBuffer),
                    this.updateUniform(e, t._tempBuffer, 3)
                }
                ,
                t.prototype._updateVector4ForEffect = function(e, t) {
                    this._currentEffect.setVector4(e, t)
                }
                ,
                t.prototype._updateVector4ForUniform = function(e, r) {
                    r.toArray(t._tempBuffer),
                    this.updateUniform(e, t._tempBuffer, 4)
                }
                ,
                t.prototype._updateColor3ForEffect = function(e, t, r) {
                    void 0 === r && (r = ""),
                    this._currentEffect.setColor3(e + r, t)
                }
                ,
                t.prototype._updateColor3ForUniform = function(e, r, i) {
                    void 0 === i && (i = ""),
                    r.toArray(t._tempBuffer),
                    this.updateUniform(e, t._tempBuffer, 3)
                }
                ,
                t.prototype._updateColor4ForEffect = function(e, t, r, i) {
                    void 0 === i && (i = ""),
                    this._currentEffect.setColor4(e + i, t, r)
                }
                ,
                t.prototype._updateColor4ForUniform = function(e, r, i, n) {
                    void 0 === n && (n = ""),
                    r.toArray(t._tempBuffer),
                    t._tempBuffer[3] = i,
                    this.updateUniform(e, t._tempBuffer, 4)
                }
                ,
                t.prototype.setTexture = function(e, t) {
                    this._currentEffect.setTexture(e, t)
                }
                ,
                t.prototype.updateUniformDirectly = function(e, t) {
                    this.updateUniform(e, t, t.length),
                    this.update()
                }
                ,
                t.prototype.bindToEffect = function(e, t) {
                    this._currentEffect = e,
                    !this._noUBO && this._buffer && e.bindUniformBuffer(this._buffer, t)
                }
                ,
                t.prototype.dispose = function() {
                    if (!this._noUBO) {
                        var e = this._engine._uniformBuffers.indexOf(this);
                        -1 !== e && this._engine._uniformBuffers.splice(e, 1),
                        this._buffer && this._engine._releaseBuffer(this._buffer) && (this._buffer = null)
                    }
                }
                ,
                t._MAX_UNIFORM_SIZE = 256,
                t._tempBuffer = new Float32Array(t._MAX_UNIFORM_SIZE),
                t
            }();
            e.UniformBuffer = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.prototype.set = function(t, r) {
                    switch (r) {
                    case e.VertexBuffer.PositionKind:
                        this.positions = t;
                        break;
                    case e.VertexBuffer.NormalKind:
                        this.normals = t;
                        break;
                    case e.VertexBuffer.TangentKind:
                        this.tangents = t;
                        break;
                    case e.VertexBuffer.UVKind:
                        this.uvs = t;
                        break;
                    case e.VertexBuffer.UV2Kind:
                        this.uvs2 = t;
                        break;
                    case e.VertexBuffer.UV3Kind:
                        this.uvs3 = t;
                        break;
                    case e.VertexBuffer.UV4Kind:
                        this.uvs4 = t;
                        break;
                    case e.VertexBuffer.UV5Kind:
                        this.uvs5 = t;
                        break;
                    case e.VertexBuffer.UV6Kind:
                        this.uvs6 = t;
                        break;
                    case e.VertexBuffer.ColorKind:
                        this.colors = t;
                        break;
                    case e.VertexBuffer.MatricesIndicesKind:
                        this.matricesIndices = t;
                        break;
                    case e.VertexBuffer.MatricesWeightsKind:
                        this.matricesWeights = t;
                        break;
                    case e.VertexBuffer.MatricesIndicesExtraKind:
                        this.matricesIndicesExtra = t;
                        break;
                    case e.VertexBuffer.MatricesWeightsExtraKind:
                        this.matricesWeightsExtra = t
                    }
                }
                ,
                t.prototype.applyToMesh = function(e, t) {
                    return this._applyTo(e, t),
                    this
                }
                ,
                t.prototype.applyToGeometry = function(e, t) {
                    return this._applyTo(e, t),
                    this
                }
                ,
                t.prototype.updateMesh = function(e, t, r) {
                    return this._update(e),
                    this
                }
                ,
                t.prototype.updateGeometry = function(e, t, r) {
                    return this._update(e),
                    this
                }
                ,
                t.prototype._applyTo = function(t, r) {
                    return void 0 === r && (r = !1),
                    this.positions && t.setVerticesData(e.VertexBuffer.PositionKind, this.positions, r),
                    this.normals && t.setVerticesData(e.VertexBuffer.NormalKind, this.normals, r),
                    this.tangents && t.setVerticesData(e.VertexBuffer.TangentKind, this.tangents, r),
                    this.uvs && t.setVerticesData(e.VertexBuffer.UVKind, this.uvs, r),
                    this.uvs2 && t.setVerticesData(e.VertexBuffer.UV2Kind, this.uvs2, r),
                    this.uvs3 && t.setVerticesData(e.VertexBuffer.UV3Kind, this.uvs3, r),
                    this.uvs4 && t.setVerticesData(e.VertexBuffer.UV4Kind, this.uvs4, r),
                    this.uvs5 && t.setVerticesData(e.VertexBuffer.UV5Kind, this.uvs5, r),
                    this.uvs6 && t.setVerticesData(e.VertexBuffer.UV6Kind, this.uvs6, r),
                    this.colors && t.setVerticesData(e.VertexBuffer.ColorKind, this.colors, r),
                    this.matricesIndices && t.setVerticesData(e.VertexBuffer.MatricesIndicesKind, this.matricesIndices, r),
                    this.matricesWeights && t.setVerticesData(e.VertexBuffer.MatricesWeightsKind, this.matricesWeights, r),
                    this.matricesIndicesExtra && t.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind, this.matricesIndicesExtra, r),
                    this.matricesWeightsExtra && t.setVerticesData(e.VertexBuffer.MatricesWeightsExtraKind, this.matricesWeightsExtra, r),
                    this.indices ? t.setIndices(this.indices, null, r) : t.setIndices([], null),
                    this
                }
                ,
                t.prototype._update = function(t, r, i) {
                    return this.positions && t.updateVerticesData(e.VertexBuffer.PositionKind, this.positions, r, i),
                    this.normals && t.updateVerticesData(e.VertexBuffer.NormalKind, this.normals, r, i),
                    this.tangents && t.updateVerticesData(e.VertexBuffer.TangentKind, this.tangents, r, i),
                    this.uvs && t.updateVerticesData(e.VertexBuffer.UVKind, this.uvs, r, i),
                    this.uvs2 && t.updateVerticesData(e.VertexBuffer.UV2Kind, this.uvs2, r, i),
                    this.uvs3 && t.updateVerticesData(e.VertexBuffer.UV3Kind, this.uvs3, r, i),
                    this.uvs4 && t.updateVerticesData(e.VertexBuffer.UV4Kind, this.uvs4, r, i),
                    this.uvs5 && t.updateVerticesData(e.VertexBuffer.UV5Kind, this.uvs5, r, i),
                    this.uvs6 && t.updateVerticesData(e.VertexBuffer.UV6Kind, this.uvs6, r, i),
                    this.colors && t.updateVerticesData(e.VertexBuffer.ColorKind, this.colors, r, i),
                    this.matricesIndices && t.updateVerticesData(e.VertexBuffer.MatricesIndicesKind, this.matricesIndices, r, i),
                    this.matricesWeights && t.updateVerticesData(e.VertexBuffer.MatricesWeightsKind, this.matricesWeights, r, i),
                    this.matricesIndicesExtra && t.updateVerticesData(e.VertexBuffer.MatricesIndicesExtraKind, this.matricesIndicesExtra, r, i),
                    this.matricesWeightsExtra && t.updateVerticesData(e.VertexBuffer.MatricesWeightsExtraKind, this.matricesWeightsExtra, r, i),
                    this.indices && t.setIndices(this.indices, null),
                    this
                }
                ,
                t.prototype.transform = function(t) {
                    var r, i = t.m[0] * t.m[5] * t.m[10] < 0, n = e.Vector3.Zero();
                    if (this.positions) {
                        var o = e.Vector3.Zero();
                        for (r = 0; r < this.positions.length; r += 3)
                            e.Vector3.FromArrayToRef(this.positions, r, o),
                            e.Vector3.TransformCoordinatesToRef(o, t, n),
                            this.positions[r] = n.x,
                            this.positions[r + 1] = n.y,
                            this.positions[r + 2] = n.z
                    }
                    if (this.normals) {
                        var a = e.Vector3.Zero();
                        for (r = 0; r < this.normals.length; r += 3)
                            e.Vector3.FromArrayToRef(this.normals, r, a),
                            e.Vector3.TransformNormalToRef(a, t, n),
                            this.normals[r] = n.x,
                            this.normals[r + 1] = n.y,
                            this.normals[r + 2] = n.z
                    }
                    if (this.tangents) {
                        var s = e.Vector4.Zero()
                          , y = e.Vector4.Zero();
                        for (r = 0; r < this.tangents.length; r += 4)
                            e.Vector4.FromArrayToRef(this.tangents, r, s),
                            e.Vector4.TransformNormalToRef(s, t, y),
                            this.tangents[r] = y.x,
                            this.tangents[r + 1] = y.y,
                            this.tangents[r + 2] = y.z,
                            this.tangents[r + 3] = y.w
                    }
                    if (i && this.indices)
                        for (r = 0; r < this.indices.length; r += 3) {
                            var l = this.indices[r + 1];
                            this.indices[r + 1] = this.indices[r + 2],
                            this.indices[r + 2] = l
                        }
                    return this
                }
                ,
                t.prototype.merge = function(e, t) {
                    if (void 0 === t && (t = !1),
                    this._validate(),
                    e._validate(),
                    !this.normals != !e.normals || !this.tangents != !e.tangents || !this.uvs != !e.uvs || !this.uvs2 != !e.uvs2 || !this.uvs3 != !e.uvs3 || !this.uvs4 != !e.uvs4 || !this.uvs5 != !e.uvs5 || !this.uvs6 != !e.uvs6 || !this.colors != !e.colors || !this.matricesIndices != !e.matricesIndices || !this.matricesWeights != !e.matricesWeights || !this.matricesIndicesExtra != !e.matricesIndicesExtra || !this.matricesWeightsExtra != !e.matricesWeightsExtra)
                        throw new Error("Cannot merge vertex data that do not have the same set of attributes");
                    if (e.indices) {
                        this.indices || (this.indices = []);
                        var r = this.positions ? this.positions.length / 3 : 0;
                        if (void 0 !== this.indices.BYTES_PER_ELEMENT) {
                            var i = this.indices.length + e.indices.length
                              , n = t || this.indices instanceof Uint32Array ? new Uint32Array(i) : new Uint16Array(i);
                            n.set(this.indices);
                            for (var o = this.indices.length, a = 0; a < e.indices.length; a++)
                                n[o + a] = e.indices[a] + r;
                            this.indices = n
                        } else
                            for (a = 0; a < e.indices.length; a++)
                                this.indices.push(e.indices[a] + r)
                    }
                    return this.positions = this._mergeElement(this.positions, e.positions),
                    this.normals = this._mergeElement(this.normals, e.normals),
                    this.tangents = this._mergeElement(this.tangents, e.tangents),
                    this.uvs = this._mergeElement(this.uvs, e.uvs),
                    this.uvs2 = this._mergeElement(this.uvs2, e.uvs2),
                    this.uvs3 = this._mergeElement(this.uvs3, e.uvs3),
                    this.uvs4 = this._mergeElement(this.uvs4, e.uvs4),
                    this.uvs5 = this._mergeElement(this.uvs5, e.uvs5),
                    this.uvs6 = this._mergeElement(this.uvs6, e.uvs6),
                    this.colors = this._mergeElement(this.colors, e.colors),
                    this.matricesIndices = this._mergeElement(this.matricesIndices, e.matricesIndices),
                    this.matricesWeights = this._mergeElement(this.matricesWeights, e.matricesWeights),
                    this.matricesIndicesExtra = this._mergeElement(this.matricesIndicesExtra, e.matricesIndicesExtra),
                    this.matricesWeightsExtra = this._mergeElement(this.matricesWeightsExtra, e.matricesWeightsExtra),
                    this
                }
                ,
                t.prototype._mergeElement = function(e, t) {
                    if (!e)
                        return t;
                    if (!t)
                        return e;
                    var r = t.length + e.length
                      , i = e instanceof Float32Array
                      , n = t instanceof Float32Array;
                    if (i) {
                        var o = new Float32Array(r);
                        return o.set(e),
                        o.set(t, e.length),
                        o
                    }
                    if (n) {
                        var a = e.slice(0)
                          , s = 0;
                        for (r = t.length; s < r; s++)
                            a.push(t[s]);
                        return a
                    }
                    return e.concat(t)
                }
                ,
                t.prototype._validate = function() {
                    if (!this.positions)
                        throw new Error("Positions are required");
                    var t = function(t, r) {
                        var i = e.VertexBuffer.DeduceStride(t);
                        if (r.length % i != 0)
                            throw new Error("The " + t + "s array count must be a multiple of " + i);
                        return r.length / i
                    }
                      , r = t(e.VertexBuffer.PositionKind, this.positions)
                      , i = function(e, i) {
                        var n = t(e, i);
                        if (n !== r)
                            throw new Error("The " + e + "s element count (" + n + ") does not match the positions count (" + r + ")")
                    };
                    this.normals && i(e.VertexBuffer.NormalKind, this.normals),
                    this.tangents && i(e.VertexBuffer.TangentKind, this.tangents),
                    this.uvs && i(e.VertexBuffer.UVKind, this.uvs),
                    this.uvs2 && i(e.VertexBuffer.UV2Kind, this.uvs2),
                    this.uvs3 && i(e.VertexBuffer.UV3Kind, this.uvs3),
                    this.uvs4 && i(e.VertexBuffer.UV4Kind, this.uvs4),
                    this.uvs5 && i(e.VertexBuffer.UV5Kind, this.uvs5),
                    this.uvs6 && i(e.VertexBuffer.UV6Kind, this.uvs6),
                    this.colors && i(e.VertexBuffer.ColorKind, this.colors),
                    this.matricesIndices && i(e.VertexBuffer.MatricesIndicesKind, this.matricesIndices),
                    this.matricesWeights && i(e.VertexBuffer.MatricesWeightsKind, this.matricesWeights),
                    this.matricesIndicesExtra && i(e.VertexBuffer.MatricesIndicesExtraKind, this.matricesIndicesExtra),
                    this.matricesWeightsExtra && i(e.VertexBuffer.MatricesWeightsExtraKind, this.matricesWeightsExtra)
                }
                ,
                t.prototype.serialize = function() {
                    var e = this.serialize();
                    return this.positions && (e.positions = this.positions),
                    this.normals && (e.normals = this.normals),
                    this.tangents && (e.tangents = this.tangents),
                    this.uvs && (e.uvs = this.uvs),
                    this.uvs2 && (e.uvs2 = this.uvs2),
                    this.uvs3 && (e.uvs3 = this.uvs3),
                    this.uvs4 && (e.uvs4 = this.uvs4),
                    this.uvs5 && (e.uvs5 = this.uvs5),
                    this.uvs6 && (e.uvs6 = this.uvs6),
                    this.colors && (e.colors = this.colors),
                    this.matricesIndices && (e.matricesIndices = this.matricesIndices,
                    e.matricesIndices._isExpanded = !0),
                    this.matricesWeights && (e.matricesWeights = this.matricesWeights),
                    this.matricesIndicesExtra && (e.matricesIndicesExtra = this.matricesIndicesExtra,
                    e.matricesIndicesExtra._isExpanded = !0),
                    this.matricesWeightsExtra && (e.matricesWeightsExtra = this.matricesWeightsExtra),
                    e.indices = this.indices,
                    e
                }
                ,
                t.ExtractFromMesh = function(e, r, i) {
                    return t._ExtractFrom(e, r, i)
                }
                ,
                t.ExtractFromGeometry = function(e, r, i) {
                    return t._ExtractFrom(e, r, i)
                }
                ,
                t._ExtractFrom = function(r, i, n) {
                    var o = new t;
                    return r.isVerticesDataPresent(e.VertexBuffer.PositionKind) && (o.positions = r.getVerticesData(e.VertexBuffer.PositionKind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.NormalKind) && (o.normals = r.getVerticesData(e.VertexBuffer.NormalKind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.TangentKind) && (o.tangents = r.getVerticesData(e.VertexBuffer.TangentKind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.UVKind) && (o.uvs = r.getVerticesData(e.VertexBuffer.UVKind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.UV2Kind) && (o.uvs2 = r.getVerticesData(e.VertexBuffer.UV2Kind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.UV3Kind) && (o.uvs3 = r.getVerticesData(e.VertexBuffer.UV3Kind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.UV4Kind) && (o.uvs4 = r.getVerticesData(e.VertexBuffer.UV4Kind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.UV5Kind) && (o.uvs5 = r.getVerticesData(e.VertexBuffer.UV5Kind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.UV6Kind) && (o.uvs6 = r.getVerticesData(e.VertexBuffer.UV6Kind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.ColorKind) && (o.colors = r.getVerticesData(e.VertexBuffer.ColorKind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind) && (o.matricesIndices = r.getVerticesData(e.VertexBuffer.MatricesIndicesKind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind) && (o.matricesWeights = r.getVerticesData(e.VertexBuffer.MatricesWeightsKind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesExtraKind) && (o.matricesIndicesExtra = r.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind, i, n)),
                    r.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsExtraKind) && (o.matricesWeightsExtra = r.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind, i, n)),
                    o.indices = r.getIndices(i, n),
                    o
                }
                ,
                t.CreateRibbon = function(r) {
                    var i = r.pathArray
                      , n = r.closeArray || !1
                      , o = r.closePath || !1
                      , a = r.invertUV || !1
                      , s = Math.floor(i[0].length / 2)
                      , y = r.offset || s;
                    y = y > s ? s : Math.floor(y);
                    var l, c, h, u, d = 0 === r.sideOrientation ? 0 : r.sideOrientation || e.Mesh.DEFAULTSIDE, x = r.uvs, p = r.colors, f = [], m = [], z = [], _ = [], g = [], v = [], b = [], T = [], E = [], P = [];
                    if (i.length < 2) {
                        var A = []
                          , S = [];
                        for (h = 0; h < i[0].length - y; h++)
                            A.push(i[0][h]),
                            S.push(i[0][h + y]);
                        i = [A, S]
                    }
                    var M, C, R, O, I, w = 0, D = o ? 1 : 0;
                    for (l = i[0].length,
                    c = 0; c < i.length; c++) {
                        for (b[c] = 0,
                        g[c] = [0],
                        l = l < (C = (M = i[c]).length) ? l : C,
                        u = 0; u < C; )
                            f.push(M[u].x, M[u].y, M[u].z),
                            u > 0 && (R = M[u].subtract(M[u - 1]).length() + b[c],
                            g[c].push(R),
                            b[c] = R),
                            u++;
                        o && (u--,
                        f.push(M[0].x, M[0].y, M[0].z),
                        R = M[u].subtract(M[0]).length() + b[c],
                        g[c].push(R),
                        b[c] = R),
                        E[c] = C + D,
                        P[c] = w,
                        w += C + D
                    }
                    var L, B, F = null, N = null;
                    for (h = 0; h < l + D; h++) {
                        for (T[h] = 0,
                        v[h] = [0],
                        c = 0; c < i.length - 1; c++)
                            O = i[c],
                            I = i[c + 1],
                            h === l ? (F = O[0],
                            N = I[0]) : (F = O[h],
                            N = I[h]),
                            R = N.subtract(F).length() + T[h],
                            v[h].push(R),
                            T[h] = R;
                        n && N && F && (O = i[c],
                        I = i[0],
                        h === l && (N = I[0]),
                        R = N.subtract(F).length() + T[h],
                        T[h] = R)
                    }
                    if (x)
                        for (c = 0; c < x.length; c++)
                            _.push(x[c].x, x[c].y);
                    else
                        for (c = 0; c < i.length; c++)
                            for (h = 0; h < l + D; h++)
                                L = 0 != b[c] ? g[c][h] / b[c] : 0,
                                B = 0 != T[h] ? v[h][c] / T[h] : 0,
                                a ? _.push(B, L) : _.push(L, B);
                    for (var V = 0, k = E[c = 0] - 1, U = E[c + 1] - 1, G = k < U ? k : U, H = P[1] - P[0], W = n ? E.length : E.length - 1; V <= G && c < W; )
                        m.push(V, V + H, V + 1),
                        m.push(V + H + 1, V + 1, V + H),
                        (V += 1) === G && (++c === E.length - 1 ? (H = P[0] - P[c],
                        k = E[c] - 1,
                        U = E[0] - 1) : (H = P[c + 1] - P[c],
                        k = E[c] - 1,
                        U = E[c + 1] - 1),
                        V = P[c],
                        G = k < U ? k + V : U + V);
                    if (t.ComputeNormals(f, m, z),
                    o) {
                        var j = 0
                          , X = 0;
                        for (c = 0; c < i.length; c++)
                            j = 3 * P[c],
                            X = c + 1 < i.length ? 3 * (P[c + 1] - 1) : z.length - 3,
                            z[j] = .5 * (z[j] + z[X]),
                            z[j + 1] = .5 * (z[j + 1] + z[X + 1]),
                            z[j + 2] = .5 * (z[j + 2] + z[X + 2]),
                            z[X] = z[j],
                            z[X + 1] = z[j + 1],
                            z[X + 2] = z[j + 2]
                    }
                    t._ComputeSides(d, f, m, z, _, r.frontUVs, r.backUVs);
                    var Y = null;
                    if (p) {
                        Y = new Float32Array(4 * p.length);
                        for (var K = 0; K < p.length; K++)
                            Y[4 * K] = p[K].r,
                            Y[4 * K + 1] = p[K].g,
                            Y[4 * K + 2] = p[K].b,
                            Y[4 * K + 3] = p[K].a
                    }
                    var Q = new t
                      , Z = new Float32Array(f)
                      , q = new Float32Array(z)
                      , J = new Float32Array(_);
                    return Q.indices = m,
                    Q.positions = Z,
                    Q.normals = q,
                    Q.uvs = J,
                    Y && Q.set(Y, e.VertexBuffer.ColorKind),
                    o && (Q._idx = P),
                    Q
                }
                ,
                t.CreateBox = function(r) {
                    for (var i = [new e.Vector3(0,0,1), new e.Vector3(0,0,-1), new e.Vector3(1,0,0), new e.Vector3(-1,0,0), new e.Vector3(0,1,0), new e.Vector3(0,-1,0)], n = [], o = [], a = [], s = [], y = r.width || r.size || 1, l = r.height || r.size || 1, c = r.depth || r.size || 1, h = 0 === r.sideOrientation ? 0 : r.sideOrientation || e.Mesh.DEFAULTSIDE, u = r.faceUV || new Array(6), d = r.faceColors, x = [], p = 0; p < 6; p++)
                        void 0 === u[p] && (u[p] = new e.Vector4(0,0,1,1)),
                        d && void 0 === d[p] && (d[p] = new e.Color4(1,1,1,1));
                    for (var f = new e.Vector3(y / 2,l / 2,c / 2), m = 0; m < i.length; m++) {
                        var z = i[m]
                          , _ = new e.Vector3(z.y,z.z,z.x)
                          , g = e.Vector3.Cross(z, _)
                          , v = o.length / 3;
                        n.push(v),
                        n.push(v + 1),
                        n.push(v + 2),
                        n.push(v),
                        n.push(v + 2),
                        n.push(v + 3);
                        var b = z.subtract(_).subtract(g).multiply(f);
                        o.push(b.x, b.y, b.z),
                        a.push(z.x, z.y, z.z),
                        s.push(u[m].z, u[m].w),
                        d && x.push(d[m].r, d[m].g, d[m].b, d[m].a),
                        b = z.subtract(_).add(g).multiply(f),
                        o.push(b.x, b.y, b.z),
                        a.push(z.x, z.y, z.z),
                        s.push(u[m].x, u[m].w),
                        d && x.push(d[m].r, d[m].g, d[m].b, d[m].a),
                        b = z.add(_).add(g).multiply(f),
                        o.push(b.x, b.y, b.z),
                        a.push(z.x, z.y, z.z),
                        s.push(u[m].x, u[m].y),
                        d && x.push(d[m].r, d[m].g, d[m].b, d[m].a),
                        b = z.add(_).subtract(g).multiply(f),
                        o.push(b.x, b.y, b.z),
                        a.push(z.x, z.y, z.z),
                        s.push(u[m].z, u[m].y),
                        d && x.push(d[m].r, d[m].g, d[m].b, d[m].a)
                    }
                    t._ComputeSides(h, o, n, a, s, r.frontUVs, r.backUVs);
                    var T = new t;
                    if (T.indices = n,
                    T.positions = o,
                    T.normals = a,
                    T.uvs = s,
                    d) {
                        var E = h === e.Mesh.DOUBLESIDE ? x.concat(x) : x;
                        T.colors = E
                    }
                    return T
                }
                ,
                t.CreateSphere = function(r) {
                    for (var i = r.segments || 32, n = r.diameterX || r.diameter || 1, o = r.diameterY || r.diameter || 1, a = r.diameterZ || r.diameter || 1, s = r.arc && (r.arc <= 0 || r.arc > 1) ? 1 : r.arc || 1, y = r.slice && r.slice <= 0 ? 1 : r.slice || 1, l = 0 === r.sideOrientation ? 0 : r.sideOrientation || e.Mesh.DEFAULTSIDE, c = new e.Vector3(n / 2,o / 2,a / 2), h = 2 + i, u = 2 * h, d = [], x = [], p = [], f = [], m = 0; m <= h; m++) {
                        for (var z = m / h, _ = z * Math.PI * y, g = 0; g <= u; g++) {
                            var v = g / u
                              , b = v * Math.PI * 2 * s
                              , T = e.Matrix.RotationZ(-_)
                              , E = e.Matrix.RotationY(b)
                              , P = e.Vector3.TransformCoordinates(e.Vector3.Up(), T)
                              , A = e.Vector3.TransformCoordinates(P, E)
                              , S = A.multiply(c)
                              , M = A.divide(c).normalize();
                            x.push(S.x, S.y, S.z),
                            p.push(M.x, M.y, M.z),
                            f.push(v, z)
                        }
                        if (m > 0)
                            for (var C = x.length / 3, R = C - 2 * (u + 1); R + u + 2 < C; R++)
                                d.push(R),
                                d.push(R + 1),
                                d.push(R + u + 1),
                                d.push(R + u + 1),
                                d.push(R + 1),
                                d.push(R + u + 2)
                    }
                    t._ComputeSides(l, x, d, p, f, r.frontUVs, r.backUVs);
                    var O = new t;
                    return O.indices = d,
                    O.positions = x,
                    O.normals = p,
                    O.uvs = f,
                    O
                }
                ,
                t.CreateCylinder = function(r) {
                    var i, n = r.height || 2, o = 0 === r.diameterTop ? 0 : r.diameterTop || r.diameter || 1, a = 0 === r.diameterBottom ? 0 : r.diameterBottom || r.diameter || 1, s = r.tessellation || 24, y = r.subdivisions || 1, l = !!r.hasRings, c = !!r.enclose, h = r.arc && (r.arc <= 0 || r.arc > 1) ? 1 : r.arc || 1, u = 0 === r.sideOrientation ? 0 : r.sideOrientation || e.Mesh.DEFAULTSIDE, d = r.faceUV || new Array(3), x = r.faceColors, p = 2 + (1 + (1 !== h && c ? 2 : 0)) * (l ? y : 1);
                    for (i = 0; i < p; i++)
                        x && void 0 === x[i] && (x[i] = new e.Color4(1,1,1,1));
                    for (i = 0; i < p; i++)
                        d && void 0 === d[i] && (d[i] = new e.Vector4(0,0,1,1));
                    var f, m, z, _, g, v, b = new Array, T = new Array, E = new Array, P = new Array, A = new Array, S = 2 * Math.PI * h / s, M = (a - o) / 2 / n, C = e.Vector3.Zero(), R = e.Vector3.Zero(), O = e.Vector3.Zero(), I = e.Vector3.Zero(), w = e.Vector3.Zero(), D = e.Axis.Y, L = 1, B = 1, F = 0, N = 0;
                    for (_ = 0; _ <= y; _++)
                        for (z = ((m = _ / y) * (o - a) + a) / 2,
                        L = l && 0 !== _ && _ !== y ? 2 : 1,
                        v = 0; v < L; v++) {
                            for (l && (B += v),
                            c && (B += 2 * v),
                            g = 0; g <= s; g++)
                                f = g * S,
                                C.x = Math.cos(-f) * z,
                                C.y = -n / 2 + m * n,
                                C.z = Math.sin(-f) * z,
                                0 === o && _ === y ? (R.x = E[E.length - 3 * (s + 1)],
                                R.y = E[E.length - 3 * (s + 1) + 1],
                                R.z = E[E.length - 3 * (s + 1) + 2]) : (R.x = C.x,
                                R.z = C.z,
                                R.y = Math.sqrt(R.x * R.x + R.z * R.z) * M,
                                R.normalize()),
                                0 === g && (O.copyFrom(C),
                                I.copyFrom(R)),
                                T.push(C.x, C.y, C.z),
                                E.push(R.x, R.y, R.z),
                                N = l ? F !== B ? d[B].y : d[B].w : d[B].y + (d[B].w - d[B].y) * m,
                                P.push(d[B].x + (d[B].z - d[B].x) * g / s, N),
                                x && A.push(x[B].r, x[B].g, x[B].b, x[B].a);
                            1 !== h && c && (T.push(C.x, C.y, C.z),
                            T.push(0, C.y, 0),
                            T.push(0, C.y, 0),
                            T.push(O.x, O.y, O.z),
                            e.Vector3.CrossToRef(D, R, w),
                            w.normalize(),
                            E.push(w.x, w.y, w.z, w.x, w.y, w.z),
                            e.Vector3.CrossToRef(I, D, w),
                            w.normalize(),
                            E.push(w.x, w.y, w.z, w.x, w.y, w.z),
                            N = l ? F !== B ? d[B + 1].y : d[B + 1].w : d[B + 1].y + (d[B + 1].w - d[B + 1].y) * m,
                            P.push(d[B + 1].x, N),
                            P.push(d[B + 1].z, N),
                            N = l ? F !== B ? d[B + 2].y : d[B + 2].w : d[B + 2].y + (d[B + 2].w - d[B + 2].y) * m,
                            P.push(d[B + 2].x, N),
                            P.push(d[B + 2].z, N),
                            x && (A.push(x[B + 1].r, x[B + 1].g, x[B + 1].b, x[B + 1].a),
                            A.push(x[B + 1].r, x[B + 1].g, x[B + 1].b, x[B + 1].a),
                            A.push(x[B + 2].r, x[B + 2].g, x[B + 2].b, x[B + 2].a),
                            A.push(x[B + 2].r, x[B + 2].g, x[B + 2].b, x[B + 2].a))),
                            F !== B && (F = B)
                        }
                    var V = 1 !== h && c ? s + 4 : s;
                    for (_ = 0,
                    B = 0; B < y; B++) {
                        var k = 0
                          , U = 0
                          , G = 0
                          , H = 0;
                        for (g = 0; g < s; g++)
                            k = _ * (V + 1) + g,
                            U = (_ + 1) * (V + 1) + g,
                            G = _ * (V + 1) + (g + 1),
                            H = (_ + 1) * (V + 1) + (g + 1),
                            b.push(k, U, G),
                            b.push(H, G, U);
                        1 !== h && c && (b.push(k + 2, U + 2, G + 2),
                        b.push(H + 2, G + 2, U + 2),
                        b.push(k + 4, U + 4, G + 4),
                        b.push(H + 4, G + 4, U + 4)),
                        _ = l ? _ + 2 : _ + 1
                    }
                    var W = function(t) {
                        var r = t ? o / 2 : a / 2;
                        if (0 !== r) {
                            var i, y, l, c = t ? d[p - 1] : d[0], u = null;
                            x && (u = t ? x[p - 1] : x[0]);
                            var f = T.length / 3
                              , m = t ? n / 2 : -n / 2
                              , z = new e.Vector3(0,m,0);
                            T.push(z.x, z.y, z.z),
                            E.push(0, t ? 1 : -1, 0),
                            P.push(c.x + .5 * (c.z - c.x), c.y + .5 * (c.w - c.y)),
                            u && A.push(u.r, u.g, u.b, u.a);
                            var _ = new e.Vector2(.5,.5);
                            for (l = 0; l <= s; l++) {
                                i = 2 * Math.PI * l * h / s;
                                var g = Math.cos(-i)
                                  , v = Math.sin(-i);
                                y = new e.Vector3(g * r,m,v * r);
                                var S = new e.Vector2(g * _.x + .5,v * _.y + .5);
                                T.push(y.x, y.y, y.z),
                                E.push(0, t ? 1 : -1, 0),
                                P.push(c.x + (c.z - c.x) * S.x, c.y + (c.w - c.y) * S.y),
                                u && A.push(u.r, u.g, u.b, u.a)
                            }
                            for (l = 0; l < s; l++)
                                t ? (b.push(f),
                                b.push(f + (l + 2)),
                                b.push(f + (l + 1))) : (b.push(f),
                                b.push(f + (l + 1)),
                                b.push(f + (l + 2)))
                        }
                    };
                    W(!1),
                    W(!0),
                    t._ComputeSides(u, T, b, E, P, r.frontUVs, r.backUVs);
                    var j = new t;
                    return j.indices = b,
                    j.positions = T,
                    j.normals = E,
                    j.uvs = P,
                    x && (j.colors = A),
                    j
                }
                ,
                t.CreateTorus = function(r) {
                    for (var i = [], n = [], o = [], a = [], s = r.diameter || 1, y = r.thickness || .5, l = r.tessellation || 16, c = 0 === r.sideOrientation ? 0 : r.sideOrientation || e.Mesh.DEFAULTSIDE, h = l + 1, u = 0; u <= l; u++)
                        for (var d = u / l, x = u * Math.PI * 2 / l - Math.PI / 2, p = e.Matrix.Translation(s / 2, 0, 0).multiply(e.Matrix.RotationY(x)), f = 0; f <= l; f++) {
                            var m = 1 - f / l
                              , z = f * Math.PI * 2 / l + Math.PI
                              , _ = Math.cos(z)
                              , g = Math.sin(z)
                              , v = new e.Vector3(_,g,0)
                              , b = v.scale(y / 2)
                              , T = new e.Vector2(d,m);
                            b = e.Vector3.TransformCoordinates(b, p),
                            v = e.Vector3.TransformNormal(v, p),
                            n.push(b.x, b.y, b.z),
                            o.push(v.x, v.y, v.z),
                            a.push(T.x, T.y);
                            var E = (u + 1) % h
                              , P = (f + 1) % h;
                            i.push(u * h + f),
                            i.push(u * h + P),
                            i.push(E * h + f),
                            i.push(u * h + P),
                            i.push(E * h + P),
                            i.push(E * h + f)
                        }
                    t._ComputeSides(c, n, i, o, a, r.frontUVs, r.backUVs);
                    var A = new t;
                    return A.indices = i,
                    A.positions = n,
                    A.normals = o,
                    A.uvs = a,
                    A
                }
                ,
                t.CreateLineSystem = function(e) {
                    for (var r = [], i = [], n = e.lines, o = e.colors, a = [], s = 0, y = 0; y < n.length; y++)
                        for (var l = n[y], c = 0; c < l.length; c++) {
                            if (i.push(l[c].x, l[c].y, l[c].z),
                            o) {
                                var h = o[y];
                                a.push(h[c].r, h[c].g, h[c].b, h[c].a)
                            }
                            c > 0 && (r.push(s - 1),
                            r.push(s)),
                            s++
                        }
                    var u = new t;
                    return u.indices = r,
                    u.positions = i,
                    o && (u.colors = a),
                    u
                }
                ,
                t.CreateDashedLines = function(r) {
                    var i, n, o = r.dashSize || 3, a = r.gapSize || 1, s = r.dashNb || 200, y = r.points, l = new Array, c = new Array, h = e.Vector3.Zero(), u = 0, d = 0, x = 0, p = 0, f = 0;
                    for (f = 0; f < y.length - 1; f++)
                        y[f + 1].subtractToRef(y[f], h),
                        u += h.length();
                    for (n = o * (i = u / s) / (o + a),
                    f = 0; f < y.length - 1; f++) {
                        y[f + 1].subtractToRef(y[f], h),
                        d = Math.floor(h.length() / i),
                        h.normalize();
                        for (var m = 0; m < d; m++)
                            x = i * m,
                            l.push(y[f].x + x * h.x, y[f].y + x * h.y, y[f].z + x * h.z),
                            l.push(y[f].x + (x + n) * h.x, y[f].y + (x + n) * h.y, y[f].z + (x + n) * h.z),
                            c.push(p, p + 1),
                            p += 2
                    }
                    var z = new t;
                    return z.positions = l,
                    z.indices = c,
                    z
                }
                ,
                t.CreateGround = function(r) {
                    var i, n, o = [], a = [], s = [], y = [], l = r.width || 1, c = r.height || 1, h = r.subdivisionsX || r.subdivisions || 1, u = r.subdivisionsY || r.subdivisions || 1;
                    for (i = 0; i <= u; i++)
                        for (n = 0; n <= h; n++) {
                            var d = new e.Vector3(n * l / h - l / 2,0,(u - i) * c / u - c / 2)
                              , x = new e.Vector3(0,1,0);
                            a.push(d.x, d.y, d.z),
                            s.push(x.x, x.y, x.z),
                            y.push(n / h, 1 - i / u)
                        }
                    for (i = 0; i < u; i++)
                        for (n = 0; n < h; n++)
                            o.push(n + 1 + (i + 1) * (h + 1)),
                            o.push(n + 1 + i * (h + 1)),
                            o.push(n + i * (h + 1)),
                            o.push(n + (i + 1) * (h + 1)),
                            o.push(n + 1 + (i + 1) * (h + 1)),
                            o.push(n + i * (h + 1));
                    var p = new t;
                    return p.indices = o,
                    p.positions = a,
                    p.normals = s,
                    p.uvs = y,
                    p
                }
                ,
                t.CreateTiledGround = function(r) {
                    var i, n, o, a, s = void 0 !== r.xmin && null !== r.xmin ? r.xmin : -1, y = void 0 !== r.zmin && null !== r.zmin ? r.zmin : -1, l = void 0 !== r.xmax && null !== r.xmax ? r.xmax : 1, c = void 0 !== r.zmax && null !== r.zmax ? r.zmax : 1, h = r.subdivisions || {
                        w: 1,
                        h: 1
                    }, u = r.precision || {
                        w: 1,
                        h: 1
                    }, d = new Array, x = new Array, p = new Array, f = new Array;
                    h.h = h.h < 1 ? 1 : h.h,
                    h.w = h.w < 1 ? 1 : h.w,
                    u.w = u.w < 1 ? 1 : u.w,
                    u.h = u.h < 1 ? 1 : u.h;
                    var m = (l - s) / h.w
                      , z = (c - y) / h.h;
                    function _(t, r, o, a) {
                        var s = x.length / 3
                          , y = u.w + 1;
                        for (i = 0; i < u.h; i++)
                            for (n = 0; n < u.w; n++) {
                                var l = [s + n + i * y, s + (n + 1) + i * y, s + (n + 1) + (i + 1) * y, s + n + (i + 1) * y];
                                d.push(l[1]),
                                d.push(l[2]),
                                d.push(l[3]),
                                d.push(l[0]),
                                d.push(l[1]),
                                d.push(l[3])
                            }
                        var c = e.Vector3.Zero()
                          , h = new e.Vector3(0,1,0);
                        for (i = 0; i <= u.h; i++)
                            for (c.z = i * (a - r) / u.h + r,
                            n = 0; n <= u.w; n++)
                                c.x = n * (o - t) / u.w + t,
                                c.y = 0,
                                x.push(c.x, c.y, c.z),
                                p.push(h.x, h.y, h.z),
                                f.push(n / u.w, i / u.h)
                    }
                    for (o = 0; o < h.h; o++)
                        for (a = 0; a < h.w; a++)
                            _(s + a * m, y + o * z, s + (a + 1) * m, y + (o + 1) * z);
                    var g = new t;
                    return g.indices = d,
                    g.positions = x,
                    g.normals = p,
                    g.uvs = f,
                    g
                }
                ,
                t.CreateGroundFromHeightMap = function(r) {
                    var i, n, o = [], a = [], s = [], y = [], l = r.colorFilter || new e.Color3(.3,.59,.11), c = r.alphaFilter || 0;
                    for (i = 0; i <= r.subdivisions; i++)
                        for (n = 0; n <= r.subdivisions; n++) {
                            var h = new e.Vector3(n * r.width / r.subdivisions - r.width / 2,0,(r.subdivisions - i) * r.height / r.subdivisions - r.height / 2)
                              , u = 4 * (((h.x + r.width / 2) / r.width * (r.bufferWidth - 1) | 0) + ((1 - (h.z + r.height / 2) / r.height) * (r.bufferHeight - 1) | 0) * r.bufferWidth)
                              , d = r.buffer[u] / 255
                              , x = r.buffer[u + 1] / 255
                              , p = r.buffer[u + 2] / 255
                              , f = r.buffer[u + 3] / 255
                              , m = d * l.r + x * l.g + p * l.b;
                            h.y = f >= c ? r.minHeight + (r.maxHeight - r.minHeight) * m : r.minHeight - e.Epsilon,
                            a.push(h.x, h.y, h.z),
                            s.push(0, 0, 0),
                            y.push(n / r.subdivisions, 1 - i / r.subdivisions)
                        }
                    for (i = 0; i < r.subdivisions; i++)
                        for (n = 0; n < r.subdivisions; n++) {
                            var z = n + 1 + (i + 1) * (r.subdivisions + 1)
                              , _ = n + 1 + i * (r.subdivisions + 1)
                              , g = n + i * (r.subdivisions + 1)
                              , v = n + (i + 1) * (r.subdivisions + 1)
                              , b = a[3 * z + 1] >= r.minHeight
                              , T = a[3 * _ + 1] >= r.minHeight
                              , E = a[3 * g + 1] >= r.minHeight;
                            b && T && E && (o.push(z),
                            o.push(_),
                            o.push(g)),
                            a[3 * v + 1] >= r.minHeight && b && E && (o.push(v),
                            o.push(z),
                            o.push(g))
                        }
                    t.ComputeNormals(a, o, s);
                    var P = new t;
                    return P.indices = o,
                    P.positions = a,
                    P.normals = s,
                    P.uvs = y,
                    P
                }
                ,
                t.CreatePlane = function(r) {
                    var i = []
                      , n = []
                      , o = []
                      , a = []
                      , s = r.width || r.size || 1
                      , y = r.height || r.size || 1
                      , l = 0 === r.sideOrientation ? 0 : r.sideOrientation || e.Mesh.DEFAULTSIDE
                      , c = s / 2
                      , h = y / 2;
                    n.push(-c, -h, 0),
                    o.push(0, 0, -1),
                    a.push(0, 0),
                    n.push(c, -h, 0),
                    o.push(0, 0, -1),
                    a.push(1, 0),
                    n.push(c, h, 0),
                    o.push(0, 0, -1),
                    a.push(1, 1),
                    n.push(-c, h, 0),
                    o.push(0, 0, -1),
                    a.push(0, 1),
                    i.push(0),
                    i.push(1),
                    i.push(2),
                    i.push(0),
                    i.push(2),
                    i.push(3),
                    t._ComputeSides(l, n, i, o, a, r.frontUVs, r.backUVs);
                    var u = new t;
                    return u.indices = i,
                    u.positions = n,
                    u.normals = o,
                    u.uvs = a,
                    u
                }
                ,
                t.CreateDisc = function(r) {
                    var i = new Array
                      , n = new Array
                      , o = new Array
                      , a = new Array
                      , s = r.radius || .5
                      , y = r.tessellation || 64
                      , l = r.arc && (r.arc <= 0 || r.arc > 1) ? 1 : r.arc || 1
                      , c = 0 === r.sideOrientation ? 0 : r.sideOrientation || e.Mesh.DEFAULTSIDE;
                    i.push(0, 0, 0),
                    a.push(.5, .5);
                    for (var h = 2 * Math.PI * l, u = h / y, d = 0; d < h; d += u) {
                        var x = Math.cos(d)
                          , p = Math.sin(d)
                          , f = (x + 1) / 2
                          , m = (1 - p) / 2;
                        i.push(s * x, s * p, 0),
                        a.push(f, m)
                    }
                    1 === l && (i.push(i[3], i[4], i[5]),
                    a.push(a[2], a[3]));
                    for (var z = i.length / 3, _ = 1; _ < z - 1; _++)
                        n.push(_ + 1, 0, _);
                    t.ComputeNormals(i, n, o),
                    t._ComputeSides(c, i, n, o, a, r.frontUVs, r.backUVs);
                    var g = new t;
                    return g.indices = n,
                    g.positions = i,
                    g.normals = o,
                    g.uvs = a,
                    g
                }
                ,
                t.CreatePolygon = function(r, i, n, o, a, s) {
                    for (var y = n || new Array(3), l = o, c = [], h = 0; h < 3; h++)
                        void 0 === y[h] && (y[h] = new e.Vector4(0,0,1,1)),
                        l && void 0 === l[h] && (l[h] = new e.Color4(1,1,1,1));
                    for (var u = r.getVerticesData(e.VertexBuffer.PositionKind), d = r.getVerticesData(e.VertexBuffer.NormalKind), x = r.getVerticesData(e.VertexBuffer.UVKind), p = r.getIndices(), f = 0, m = 0, z = 0; z < d.length; z += 3)
                        Math.abs(d[z + 1]) < .001 && (m = 1),
                        Math.abs(d[z + 1] - 1) < .001 && (m = 0),
                        Math.abs(d[z + 1] + 1) < .001 && (m = 2),
                        x[2 * (f = z / 3)] = (1 - x[2 * f]) * y[m].x + x[2 * f] * y[m].z,
                        x[2 * f + 1] = (1 - x[2 * f + 1]) * y[m].y + x[2 * f + 1] * y[m].w,
                        l && c.push(l[m].r, l[m].g, l[m].b, l[m].a);
                    t._ComputeSides(i, u, p, d, x, a, s);
                    var _ = new t;
                    if (_.indices = p,
                    _.positions = u,
                    _.normals = d,
                    _.uvs = x,
                    l) {
                        var g = i === e.Mesh.DOUBLESIDE ? c.concat(c) : c;
                        _.colors = g
                    }
                    return _
                }
                ,
                t.CreateIcoSphere = function(r) {
                    var i, n = r.sideOrientation || e.Mesh.DEFAULTSIDE, o = r.radius || 1, a = void 0 === r.flat || r.flat, s = r.subdivisions || 4, y = r.radiusX || o, l = r.radiusY || o, c = r.radiusZ || o, h = (1 + Math.sqrt(5)) / 2, u = [-1, h, -0, 1, h, 0, -1, -h, 0, 1, -h, 0, 0, -1, -h, 0, 1, -h, 0, -1, h, 0, 1, h, h, 0, 1, h, 0, -1, -h, 0, 1, -h, 0, -1], d = [0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 12, 22, 23, 1, 5, 20, 5, 11, 4, 23, 22, 13, 22, 18, 6, 7, 1, 8, 14, 21, 4, 14, 4, 2, 16, 13, 6, 15, 6, 19, 3, 8, 9, 4, 21, 5, 13, 17, 23, 6, 13, 22, 19, 6, 18, 9, 8, 1], x = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 2, 3, 3, 3, 4, 7, 8, 9, 9, 10, 11], p = [5, 1, 3, 1, 6, 4, 0, 0, 5, 3, 4, 2, 2, 2, 4, 0, 2, 0, 1, 1, 6, 0, 6, 2, 0, 4, 3, 3, 4, 4, 3, 1, 4, 2, 4, 4, 0, 2, 1, 1, 2, 2, 3, 3, 1, 3, 2, 4], f = [0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0], m = new Array, z = new Array, _ = new Array, g = new Array, v = 0, b = new Array(3), T = new Array(3);
                    for (i = 0; i < 3; i++)
                        b[i] = e.Vector3.Zero(),
                        T[i] = e.Vector2.Zero();
                    for (var E = 0; E < 20; E++) {
                        for (i = 0; i < 3; i++) {
                            var P = d[3 * E + i];
                            b[i].copyFromFloats(u[3 * x[P]], u[3 * x[P] + 1], u[3 * x[P] + 2]),
                            b[i].normalize().scaleInPlace(o),
                            T[i].copyFromFloats(p[2 * P] * (138 / 1024) + 60 / 1024 + f[E] * (-40 / 1024), p[2 * P + 1] * (239 / 1024) + 26 / 1024 + f[E] * (20 / 1024))
                        }
                        for (var A = function(t, r, i, n) {
                            var o, h = e.Vector3.Lerp(b[0], b[2], r / s), u = e.Vector3.Lerp(b[1], b[2], r / s), d = s === r ? b[2] : e.Vector3.Lerp(h, u, t / (s - r));
                            if (d.normalize(),
                            a) {
                                var x = e.Vector3.Lerp(b[0], b[2], n / s)
                                  , p = e.Vector3.Lerp(b[1], b[2], n / s);
                                o = e.Vector3.Lerp(x, p, i / (s - n))
                            } else
                                o = new e.Vector3(d.x,d.y,d.z);
                            o.x /= y,
                            o.y /= l,
                            o.z /= c,
                            o.normalize();
                            var f = e.Vector2.Lerp(T[0], T[2], r / s)
                              , E = e.Vector2.Lerp(T[1], T[2], r / s)
                              , P = s === r ? T[2] : e.Vector2.Lerp(f, E, t / (s - r));
                            z.push(d.x * y, d.y * l, d.z * c),
                            _.push(o.x, o.y, o.z),
                            g.push(P.x, P.y),
                            m.push(v),
                            v++
                        }, S = 0; S < s; S++)
                            for (var M = 0; M + S < s; M++)
                                A(M, S, M + 1 / 3, S + 1 / 3),
                                A(M + 1, S, M + 1 / 3, S + 1 / 3),
                                A(M, S + 1, M + 1 / 3, S + 1 / 3),
                                M + S + 1 < s && (A(M + 1, S, M + 2 / 3, S + 2 / 3),
                                A(M + 1, S + 1, M + 2 / 3, S + 2 / 3),
                                A(M, S + 1, M + 2 / 3, S + 2 / 3))
                    }
                    t._ComputeSides(n, z, m, _, g, r.frontUVs, r.backUVs);
                    var C = new t;
                    return C.indices = m,
                    C.positions = z,
                    C.normals = _,
                    C.uvs = g,
                    C
                }
                ,
                t.CreatePolyhedron = function(r) {
                    var i = [];
                    i[0] = {
                        vertex: [[0, 0, 1.732051], [1.632993, 0, -.5773503], [-.8164966, 1.414214, -.5773503], [-.8164966, -1.414214, -.5773503]],
                        face: [[0, 1, 2], [0, 2, 3], [0, 3, 1], [1, 3, 2]]
                    },
                    i[1] = {
                        vertex: [[0, 0, 1.414214], [1.414214, 0, 0], [0, 1.414214, 0], [-1.414214, 0, 0], [0, -1.414214, 0], [0, 0, -1.414214]],
                        face: [[0, 1, 2], [0, 2, 3], [0, 3, 4], [0, 4, 1], [1, 4, 5], [1, 5, 2], [2, 5, 3], [3, 5, 4]]
                    },
                    i[2] = {
                        vertex: [[0, 0, 1.070466], [.7136442, 0, .7978784], [-.3568221, .618034, .7978784], [-.3568221, -.618034, .7978784], [.7978784, .618034, .3568221], [.7978784, -.618034, .3568221], [-.9341724, .381966, .3568221], [.1362939, 1, .3568221], [.1362939, -1, .3568221], [-.9341724, -.381966, .3568221], [.9341724, .381966, -.3568221], [.9341724, -.381966, -.3568221], [-.7978784, .618034, -.3568221], [-.1362939, 1, -.3568221], [-.1362939, -1, -.3568221], [-.7978784, -.618034, -.3568221], [.3568221, .618034, -.7978784], [.3568221, -.618034, -.7978784], [-.7136442, 0, -.7978784], [0, 0, -1.070466]],
                        face: [[0, 1, 4, 7, 2], [0, 2, 6, 9, 3], [0, 3, 8, 5, 1], [1, 5, 11, 10, 4], [2, 7, 13, 12, 6], [3, 9, 15, 14, 8], [4, 10, 16, 13, 7], [5, 8, 14, 17, 11], [6, 12, 18, 15, 9], [10, 11, 17, 19, 16], [12, 13, 16, 19, 18], [14, 15, 18, 19, 17]]
                    },
                    i[3] = {
                        vertex: [[0, 0, 1.175571], [1.051462, 0, .5257311], [.3249197, 1, .5257311], [-.8506508, .618034, .5257311], [-.8506508, -.618034, .5257311], [.3249197, -1, .5257311], [.8506508, .618034, -.5257311], [.8506508, -.618034, -.5257311], [-.3249197, 1, -.5257311], [-1.051462, 0, -.5257311], [-.3249197, -1, -.5257311], [0, 0, -1.175571]],
                        face: [[0, 1, 2], [0, 2, 3], [0, 3, 4], [0, 4, 5], [0, 5, 1], [1, 5, 7], [1, 7, 6], [1, 6, 2], [2, 6, 8], [2, 8, 3], [3, 8, 9], [3, 9, 4], [4, 9, 10], [4, 10, 5], [5, 10, 7], [6, 7, 11], [6, 11, 8], [7, 10, 11], [8, 11, 9], [9, 11, 10]]
                    },
                    i[4] = {
                        vertex: [[0, 0, 1.070722], [.7148135, 0, .7971752], [-.104682, .7071068, .7971752], [-.6841528, .2071068, .7971752], [-.104682, -.7071068, .7971752], [.6101315, .7071068, .5236279], [1.04156, .2071068, .1367736], [.6101315, -.7071068, .5236279], [-.3574067, 1, .1367736], [-.7888348, -.5, .5236279], [-.9368776, .5, .1367736], [-.3574067, -1, .1367736], [.3574067, 1, -.1367736], [.9368776, -.5, -.1367736], [.7888348, .5, -.5236279], [.3574067, -1, -.1367736], [-.6101315, .7071068, -.5236279], [-1.04156, -.2071068, -.1367736], [-.6101315, -.7071068, -.5236279], [.104682, .7071068, -.7971752], [.6841528, -.2071068, -.7971752], [.104682, -.7071068, -.7971752], [-.7148135, 0, -.7971752], [0, 0, -1.070722]],
                        face: [[0, 2, 3], [1, 6, 5], [4, 9, 11], [7, 15, 13], [8, 16, 10], [12, 14, 19], [17, 22, 18], [20, 21, 23], [0, 1, 5, 2], [0, 3, 9, 4], [0, 4, 7, 1], [1, 7, 13, 6], [2, 5, 12, 8], [2, 8, 10, 3], [3, 10, 17, 9], [4, 11, 15, 7], [5, 6, 14, 12], [6, 13, 20, 14], [8, 12, 19, 16], [9, 17, 18, 11], [10, 16, 22, 17], [11, 18, 21, 15], [13, 15, 21, 20], [14, 20, 23, 19], [16, 19, 23, 22], [18, 22, 23, 21]]
                    },
                    i[5] = {
                        vertex: [[0, 0, 1.322876], [1.309307, 0, .1889822], [-.9819805, .8660254, .1889822], [.1636634, -1.299038, .1889822], [.3273268, .8660254, -.9449112], [-.8183171, -.4330127, -.9449112]],
                        face: [[0, 3, 1], [2, 4, 5], [0, 1, 4, 2], [0, 2, 5, 3], [1, 3, 5, 4]]
                    },
                    i[6] = {
                        vertex: [[0, 0, 1.159953], [1.013464, 0, .5642542], [-.3501431, .9510565, .5642542], [-.7715208, -.6571639, .5642542], [.6633206, .9510565, -.03144481], [.8682979, -.6571639, -.3996071], [-1.121664, .2938926, -.03144481], [-.2348831, -1.063314, -.3996071], [.5181548, .2938926, -.9953061], [-.5850262, -.112257, -.9953061]],
                        face: [[0, 1, 4, 2], [0, 2, 6, 3], [1, 5, 8, 4], [3, 6, 9, 7], [5, 7, 9, 8], [0, 3, 7, 5, 1], [2, 4, 8, 9, 6]]
                    },
                    i[7] = {
                        vertex: [[0, 0, 1.118034], [.8944272, 0, .6708204], [-.2236068, .8660254, .6708204], [-.7826238, -.4330127, .6708204], [.6708204, .8660254, .2236068], [1.006231, -.4330127, -.2236068], [-1.006231, .4330127, .2236068], [-.6708204, -.8660254, -.2236068], [.7826238, .4330127, -.6708204], [.2236068, -.8660254, -.6708204], [-.8944272, 0, -.6708204], [0, 0, -1.118034]],
                        face: [[0, 1, 4, 2], [0, 2, 6, 3], [1, 5, 8, 4], [3, 6, 10, 7], [5, 9, 11, 8], [7, 10, 11, 9], [0, 3, 7, 9, 5, 1], [2, 4, 8, 11, 10, 6]]
                    },
                    i[8] = {
                        vertex: [[-.729665, .670121, .319155], [-.655235, -.29213, -.754096], [-.093922, -.607123, .537818], [.702196, .595691, .485187], [.776626, -.36656, -.588064]],
                        face: [[1, 4, 2], [0, 1, 2], [3, 0, 2], [4, 3, 2], [4, 1, 0, 3]]
                    },
                    i[9] = {
                        vertex: [[-.868849, -.100041, .61257], [-.329458, .976099, .28078], [-.26629, -.013796, -.477654], [-.13392, -1.034115, .229829], [.738834, .707117, -.307018], [.859683, -.535264, -.338508]],
                        face: [[3, 0, 2], [5, 3, 2], [4, 5, 2], [1, 4, 2], [0, 1, 2], [0, 3, 5, 4, 1]]
                    },
                    i[10] = {
                        vertex: [[-.610389, .243975, .531213], [-.187812, -.48795, -.664016], [-.187812, .9759, -.664016], [.187812, -.9759, .664016], [.798201, .243975, .132803]],
                        face: [[1, 3, 0], [3, 4, 0], [3, 1, 4], [0, 2, 1], [0, 4, 2], [2, 4, 1]]
                    },
                    i[11] = {
                        vertex: [[-1.028778, .392027, -.048786], [-.640503, -.646161, .621837], [-.125162, -.395663, -.540059], [.004683, .888447, -.651988], [.125161, .395663, .540059], [.632925, -.791376, .433102], [1.031672, .157063, -.354165]],
                        face: [[3, 2, 0], [2, 1, 0], [2, 5, 1], [0, 4, 3], [0, 1, 4], [4, 1, 5], [2, 3, 6], [3, 4, 6], [5, 2, 6], [4, 5, 6]]
                    },
                    i[12] = {
                        vertex: [[-.669867, .334933, -.529576], [-.669867, .334933, .529577], [-.4043, 1.212901, 0], [-.334933, -.669867, -.529576], [-.334933, -.669867, .529577], [.334933, .669867, -.529576], [.334933, .669867, .529577], [.4043, -1.212901, 0], [.669867, -.334933, -.529576], [.669867, -.334933, .529577]],
                        face: [[8, 9, 7], [6, 5, 2], [3, 8, 7], [5, 0, 2], [4, 3, 7], [0, 1, 2], [9, 4, 7], [1, 6, 2], [9, 8, 5, 6], [8, 3, 0, 5], [3, 4, 1, 0], [4, 9, 6, 1]]
                    },
                    i[13] = {
                        vertex: [[-.931836, .219976, -.264632], [-.636706, .318353, .692816], [-.613483, -.735083, -.264632], [-.326545, .979634, 0], [-.318353, -.636706, .692816], [-.159176, .477529, -.856368], [.159176, -.477529, -.856368], [.318353, .636706, .692816], [.326545, -.979634, 0], [.613482, .735082, -.264632], [.636706, -.318353, .692816], [.931835, -.219977, -.264632]],
                        face: [[11, 10, 8], [7, 9, 3], [6, 11, 8], [9, 5, 3], [2, 6, 8], [5, 0, 3], [4, 2, 8], [0, 1, 3], [10, 4, 8], [1, 7, 3], [10, 11, 9, 7], [11, 6, 5, 9], [6, 2, 0, 5], [2, 4, 1, 0], [4, 10, 7, 1]]
                    },
                    i[14] = {
                        vertex: [[-.93465, .300459, -.271185], [-.838689, -.260219, -.516017], [-.711319, .717591, .128359], [-.710334, -.156922, .080946], [-.599799, .556003, -.725148], [-.503838, -.004675, -.969981], [-.487004, .26021, .48049], [-.460089, -.750282, -.512622], [-.376468, .973135, -.325605], [-.331735, -.646985, .084342], [-.254001, .831847, .530001], [-.125239, -.494738, -.966586], [.029622, .027949, .730817], [.056536, -.982543, -.262295], [.08085, 1.087391, .076037], [.125583, -.532729, .485984], [.262625, .599586, .780328], [.391387, -.726999, -.716259], [.513854, -.868287, .139347], [.597475, .85513, .326364], [.641224, .109523, .783723], [.737185, -.451155, .538891], [.848705, -.612742, -.314616], [.976075, .365067, .32976], [1.072036, -.19561, .084927]],
                        face: [[15, 18, 21], [12, 20, 16], [6, 10, 2], [3, 0, 1], [9, 7, 13], [2, 8, 4, 0], [0, 4, 5, 1], [1, 5, 11, 7], [7, 11, 17, 13], [13, 17, 22, 18], [18, 22, 24, 21], [21, 24, 23, 20], [20, 23, 19, 16], [16, 19, 14, 10], [10, 14, 8, 2], [15, 9, 13, 18], [12, 15, 21, 20], [6, 12, 16, 10], [3, 6, 2, 0], [9, 3, 1, 7], [9, 15, 12, 6, 3], [22, 17, 11, 5, 4, 8, 14, 19, 23, 24]]
                    };
                    var n, o, a, s, y, l, c = r.type && (r.type < 0 || r.type >= i.length) ? 0 : r.type || 0, h = r.size, u = r.sizeX || h || 1, d = r.sizeY || h || 1, x = r.sizeZ || h || 1, p = r.custom || i[c], f = p.face.length, m = r.faceUV || new Array(f), z = r.faceColors, _ = void 0 === r.flat || r.flat, g = 0 === r.sideOrientation ? 0 : r.sideOrientation || e.Mesh.DEFAULTSIDE, v = new Array, b = new Array, T = new Array, E = new Array, P = new Array, A = 0, S = 0, M = new Array, C = 0, R = 0;
                    if (_)
                        for (R = 0; R < f; R++)
                            z && void 0 === z[R] && (z[R] = new e.Color4(1,1,1,1)),
                            m && void 0 === m[R] && (m[R] = new e.Vector4(0,0,1,1));
                    if (_)
                        for (R = 0; R < f; R++) {
                            var O = p.face[R].length;
                            for (a = 2 * Math.PI / O,
                            s = .5 * Math.tan(a / 2),
                            y = .5,
                            C = 0; C < O; C++)
                                v.push(p.vertex[p.face[R][C]][0] * u, p.vertex[p.face[R][C]][1] * d, p.vertex[p.face[R][C]][2] * x),
                                M.push(A),
                                A++,
                                n = m[R].x + (m[R].z - m[R].x) * (.5 + s),
                                o = m[R].y + (m[R].w - m[R].y) * (y - .5),
                                E.push(n, o),
                                l = s * Math.cos(a) - y * Math.sin(a),
                                y = s * Math.sin(a) + y * Math.cos(a),
                                s = l,
                                z && P.push(z[R].r, z[R].g, z[R].b, z[R].a);
                            for (C = 0; C < O - 2; C++)
                                b.push(M[0 + S], M[C + 2 + S], M[C + 1 + S]);
                            S += O
                        }
                    else {
                        for (C = 0; C < p.vertex.length; C++)
                            v.push(p.vertex[C][0] * u, p.vertex[C][1] * d, p.vertex[C][2] * x),
                            E.push(0, 0);
                        for (R = 0; R < f; R++)
                            for (C = 0; C < p.face[R].length - 2; C++)
                                b.push(p.face[R][0], p.face[R][C + 2], p.face[R][C + 1])
                    }
                    t.ComputeNormals(v, b, T),
                    t._ComputeSides(g, v, b, T, E, r.frontUVs, r.backUVs);
                    var I = new t;
                    return I.positions = v,
                    I.indices = b,
                    I.normals = T,
                    I.uvs = E,
                    z && _ && (I.colors = P),
                    I
                }
                ,
                t.CreateTorusKnot = function(r) {
                    var i, n, o = new Array, a = new Array, s = new Array, y = new Array, l = r.radius || 2, c = r.tube || .5, h = r.radialSegments || 32, u = r.tubularSegments || 32, d = r.p || 2, x = r.q || 3, p = 0 === r.sideOrientation ? 0 : r.sideOrientation || e.Mesh.DEFAULTSIDE, f = function(t) {
                        var r = Math.cos(t)
                          , i = Math.sin(t)
                          , n = x / d * t
                          , o = Math.cos(n)
                          , a = l * (2 + o) * .5 * r
                          , s = l * (2 + o) * i * .5
                          , y = l * Math.sin(n) * .5;
                        return new e.Vector3(a,s,y)
                    };
                    for (i = 0; i <= h; i++) {
                        var m = i % h / h * 2 * d * Math.PI
                          , z = f(m)
                          , _ = f(m + .01)
                          , g = _.subtract(z)
                          , v = _.add(z)
                          , b = e.Vector3.Cross(g, v);
                        for (v = e.Vector3.Cross(b, g),
                        b.normalize(),
                        v.normalize(),
                        n = 0; n < u; n++) {
                            var T = n % u / u * 2 * Math.PI
                              , E = -c * Math.cos(T)
                              , P = c * Math.sin(T);
                            a.push(z.x + E * v.x + P * b.x),
                            a.push(z.y + E * v.y + P * b.y),
                            a.push(z.z + E * v.z + P * b.z),
                            y.push(i / h),
                            y.push(n / u)
                        }
                    }
                    for (i = 0; i < h; i++)
                        for (n = 0; n < u; n++) {
                            var A = (n + 1) % u
                              , S = i * u + n
                              , M = (i + 1) * u + n
                              , C = (i + 1) * u + A
                              , R = i * u + A;
                            o.push(R),
                            o.push(M),
                            o.push(S),
                            o.push(R),
                            o.push(C),
                            o.push(M)
                        }
                    t.ComputeNormals(a, o, s),
                    t._ComputeSides(p, a, o, s, y, r.frontUVs, r.backUVs);
                    var O = new t;
                    return O.indices = o,
                    O.positions = a,
                    O.normals = s,
                    O.uvs = y,
                    O
                }
                ,
                t.ComputeNormals = function(t, r, i, n) {
                    var o = 0
                      , a = 0
                      , s = 0
                      , y = 0
                      , l = 0
                      , c = 0
                      , h = 0
                      , u = 0
                      , d = 0
                      , x = 0
                      , p = 0
                      , f = 0
                      , m = 0
                      , z = 0
                      , _ = 0
                      , g = 0
                      , v = 0
                      , b = 0
                      , T = 0
                      , E = 0
                      , P = !1
                      , A = !1
                      , S = !1
                      , M = !1
                      , C = 1
                      , R = 0
                      , O = null;
                    if (n && (P = !!n.facetNormals,
                    A = !!n.facetPositions,
                    S = !!n.facetPartitioning,
                    C = !0 === n.useRightHandedSystem ? -1 : 1,
                    R = n.ratio || 0,
                    M = !!n.depthSort,
                    O = n.distanceTo,
                    M)) {
                        void 0 === O && (O = e.Vector3.Zero());
                        var I = n.depthSortedFacets
                    }
                    var w = 0
                      , D = 0
                      , L = 0
                      , B = 0;
                    if (S && n && n.bbSize) {
                        var F = 0
                          , N = 0
                          , V = 0
                          , k = 0
                          , U = 0
                          , G = 0
                          , H = 0
                          , W = 0
                          , j = 0
                          , X = 0
                          , Y = 0
                          , K = 0
                          , Q = 0
                          , Z = 0
                          , q = 0
                          , J = 0
                          , $ = n.bbSize.x > n.bbSize.y ? n.bbSize.x : n.bbSize.y;
                        $ = $ > n.bbSize.z ? $ : n.bbSize.z,
                        w = n.subDiv.X * R / n.bbSize.x,
                        D = n.subDiv.Y * R / n.bbSize.y,
                        L = n.subDiv.Z * R / n.bbSize.z,
                        B = n.subDiv.max * n.subDiv.max,
                        n.facetPartitioning.length = 0
                    }
                    for (o = 0; o < t.length; o++)
                        i[o] = 0;
                    var ee = r.length / 3 | 0;
                    for (o = 0; o < ee; o++) {
                        if (m = (f = 3 * r[3 * o]) + 1,
                        z = f + 2,
                        g = (_ = 3 * r[3 * o + 1]) + 1,
                        v = _ + 2,
                        T = (b = 3 * r[3 * o + 2]) + 1,
                        E = b + 2,
                        a = t[f] - t[_],
                        s = t[m] - t[g],
                        y = t[z] - t[v],
                        l = t[b] - t[_],
                        c = t[T] - t[g],
                        u = C * (s * (h = t[E] - t[v]) - y * c),
                        d = C * (y * l - a * h),
                        x = C * (a * c - s * l),
                        u /= p = 0 === (p = Math.sqrt(u * u + d * d + x * x)) ? 1 : p,
                        d /= p,
                        x /= p,
                        P && n && (n.facetNormals[o].x = u,
                        n.facetNormals[o].y = d,
                        n.facetNormals[o].z = x),
                        A && n && (n.facetPositions[o].x = (t[f] + t[_] + t[b]) / 3,
                        n.facetPositions[o].y = (t[m] + t[g] + t[T]) / 3,
                        n.facetPositions[o].z = (t[z] + t[v] + t[E]) / 3),
                        S && n && (F = Math.floor((n.facetPositions[o].x - n.bInfo.minimum.x * R) * w),
                        N = Math.floor((n.facetPositions[o].y - n.bInfo.minimum.y * R) * D),
                        V = Math.floor((n.facetPositions[o].z - n.bInfo.minimum.z * R) * L),
                        k = Math.floor((t[f] - n.bInfo.minimum.x * R) * w),
                        U = Math.floor((t[m] - n.bInfo.minimum.y * R) * D),
                        G = Math.floor((t[z] - n.bInfo.minimum.z * R) * L),
                        H = Math.floor((t[_] - n.bInfo.minimum.x * R) * w),
                        W = Math.floor((t[g] - n.bInfo.minimum.y * R) * D),
                        j = Math.floor((t[v] - n.bInfo.minimum.z * R) * L),
                        X = Math.floor((t[b] - n.bInfo.minimum.x * R) * w),
                        Y = Math.floor((t[T] - n.bInfo.minimum.y * R) * D),
                        K = Math.floor((t[E] - n.bInfo.minimum.z * R) * L),
                        Z = k + n.subDiv.max * U + B * G,
                        q = H + n.subDiv.max * W + B * j,
                        J = X + n.subDiv.max * Y + B * K,
                        Q = F + n.subDiv.max * N + B * V,
                        n.facetPartitioning[Q] = n.facetPartitioning[Q] ? n.facetPartitioning[Q] : new Array,
                        n.facetPartitioning[Z] = n.facetPartitioning[Z] ? n.facetPartitioning[Z] : new Array,
                        n.facetPartitioning[q] = n.facetPartitioning[q] ? n.facetPartitioning[q] : new Array,
                        n.facetPartitioning[J] = n.facetPartitioning[J] ? n.facetPartitioning[J] : new Array,
                        n.facetPartitioning[Z].push(o),
                        q != Z && n.facetPartitioning[q].push(o),
                        J != q && J != Z && n.facetPartitioning[J].push(o),
                        Q != Z && Q != q && Q != J && n.facetPartitioning[Q].push(o)),
                        M && n && n.facetPositions) {
                            var te = I[o];
                            te.ind = 3 * o,
                            te.sqDistance = e.Vector3.DistanceSquared(n.facetPositions[o], O)
                        }
                        i[f] += u,
                        i[m] += d,
                        i[z] += x,
                        i[_] += u,
                        i[g] += d,
                        i[v] += x,
                        i[b] += u,
                        i[T] += d,
                        i[E] += x
                    }
                    for (o = 0; o < i.length / 3; o++)
                        u = i[3 * o],
                        d = i[3 * o + 1],
                        x = i[3 * o + 2],
                        u /= p = 0 === (p = Math.sqrt(u * u + d * d + x * x)) ? 1 : p,
                        d /= p,
                        x /= p,
                        i[3 * o] = u,
                        i[3 * o + 1] = d,
                        i[3 * o + 2] = x
                }
                ,
                t._ComputeSides = function(t, r, i, n, o, a, s) {
                    var y, l, c = i.length, h = n.length;
                    switch (t = t || e.Mesh.DEFAULTSIDE) {
                    case e.Mesh.FRONTSIDE:
                        break;
                    case e.Mesh.BACKSIDE:
                        var u;
                        for (y = 0; y < c; y += 3)
                            u = i[y],
                            i[y] = i[y + 2],
                            i[y + 2] = u;
                        for (l = 0; l < h; l++)
                            n[l] = -n[l];
                        break;
                    case e.Mesh.DOUBLESIDE:
                        for (var d = r.length, x = d / 3, p = 0; p < d; p++)
                            r[d + p] = r[p];
                        for (y = 0; y < c; y += 3)
                            i[y + c] = i[y + 2] + x,
                            i[y + 1 + c] = i[y + 1] + x,
                            i[y + 2 + c] = i[y] + x;
                        for (l = 0; l < h; l++)
                            n[h + l] = -n[l];
                        var f = o.length
                          , m = 0;
                        for (m = 0; m < f; m++)
                            o[m + f] = o[m];
                        for (a = a || new e.Vector4(0,0,1,1),
                        s = s || new e.Vector4(0,0,1,1),
                        m = 0,
                        y = 0; y < f / 2; y++)
                            o[m] = a.x + (a.z - a.x) * o[m],
                            o[m + 1] = a.y + (a.w - a.y) * o[m + 1],
                            o[m + f] = s.x + (s.z - s.x) * o[m + f],
                            o[m + f + 1] = s.y + (s.w - s.y) * o[m + f + 1],
                            m += 2
                    }
                }
                ,
                t.ImportVertexData = function(r, i) {
                    var n = new t
                      , o = r.positions;
                    o && n.set(o, e.VertexBuffer.PositionKind);
                    var a = r.normals;
                    a && n.set(a, e.VertexBuffer.NormalKind);
                    var s = r.tangents;
                    s && n.set(s, e.VertexBuffer.TangentKind);
                    var y = r.uvs;
                    y && n.set(y, e.VertexBuffer.UVKind);
                    var l = r.uv2s;
                    l && n.set(l, e.VertexBuffer.UV2Kind);
                    var c = r.uv3s;
                    c && n.set(c, e.VertexBuffer.UV3Kind);
                    var h = r.uv4s;
                    h && n.set(h, e.VertexBuffer.UV4Kind);
                    var u = r.uv5s;
                    u && n.set(u, e.VertexBuffer.UV5Kind);
                    var d = r.uv6s;
                    d && n.set(d, e.VertexBuffer.UV6Kind);
                    var x = r.colors;
                    x && n.set(e.Color4.CheckColors4(x, o.length / 3), e.VertexBuffer.ColorKind);
                    var p = r.matricesIndices;
                    p && n.set(p, e.VertexBuffer.MatricesIndicesKind);
                    var f = r.matricesWeights;
                    f && n.set(f, e.VertexBuffer.MatricesWeightsKind);
                    var m = r.indices;
                    m && (n.indices = m),
                    i.setAllVerticesData(n, r.updatable)
                }
                ,
                t
            }();
            e.VertexData = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n, o) {
                    void 0 === n && (n = !1),
                    void 0 === o && (o = null),
                    this.delayLoadState = e.Engine.DELAYLOADSTATE_NONE,
                    this._totalVertices = 0,
                    this._isDisposed = !1,
                    this._indexBufferIsUpdatable = !1,
                    this.id = t,
                    this._engine = r.getEngine(),
                    this._meshes = [],
                    this._scene = r,
                    this._vertexBuffers = {},
                    this._indices = [],
                    this._updatable = n,
                    i ? this.setAllVerticesData(i, n) : (this._totalVertices = 0,
                    this._indices = []),
                    this._engine.getCaps().vertexArrayObject && (this._vertexArrayObjects = {}),
                    o && ("LinesMesh" === o.getClassName() && (this.boundingBias = new e.Vector2(0,o.intersectionThreshold),
                    this._updateExtend()),
                    this.applyToMesh(o),
                    o.computeWorldMatrix(!0))
                }
                return Object.defineProperty(t.prototype, "boundingBias", {
                    get: function() {
                        return this._boundingBias
                    },
                    set: function(e) {
                        if (this._boundingBias) {
                            if (this._boundingBias.equals(e))
                                return;
                            this._boundingBias.copyFrom(e)
                        } else
                            this._boundingBias = e.clone();
                        this._updateBoundingInfo(!0, null)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.CreateGeometryForMesh = function(e) {
                    var r = new t(t.RandomId(),e.getScene());
                    return r.applyToMesh(e),
                    r
                }
                ,
                Object.defineProperty(t.prototype, "extend", {
                    get: function() {
                        return this._extend
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getScene = function() {
                    return this._scene
                }
                ,
                t.prototype.getEngine = function() {
                    return this._engine
                }
                ,
                t.prototype.isReady = function() {
                    return this.delayLoadState === e.Engine.DELAYLOADSTATE_LOADED || this.delayLoadState === e.Engine.DELAYLOADSTATE_NONE
                }
                ,
                Object.defineProperty(t.prototype, "doNotSerialize", {
                    get: function() {
                        for (var e = 0; e < this._meshes.length; e++)
                            if (!this._meshes[e].doNotSerialize)
                                return !1;
                        return !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._rebuild = function() {
                    for (var e in this._vertexArrayObjects && (this._vertexArrayObjects = {}),
                    0 !== this._meshes.length && this._indices && (this._indexBuffer = this._engine.createIndexBuffer(this._indices)),
                    this._vertexBuffers) {
                        this._vertexBuffers[e]._rebuild()
                    }
                }
                ,
                t.prototype.setAllVerticesData = function(e, t) {
                    e.applyToGeometry(this, t),
                    this.notifyUpdate()
                }
                ,
                t.prototype.setVerticesData = function(t, r, i, n) {
                    void 0 === i && (i = !1);
                    var o = new e.VertexBuffer(this._engine,r,t,i,0 === this._meshes.length,n);
                    this.setVerticesBuffer(o)
                }
                ,
                t.prototype.removeVerticesData = function(e) {
                    this._vertexBuffers[e] && (this._vertexBuffers[e].dispose(),
                    delete this._vertexBuffers[e])
                }
                ,
                t.prototype.setVerticesBuffer = function(t, r) {
                    void 0 === r && (r = null);
                    var i = t.getKind();
                    if (this._vertexBuffers[i] && this._vertexBuffers[i].dispose(),
                    this._vertexBuffers[i] = t,
                    i === e.VertexBuffer.PositionKind) {
                        var n = t.getData();
                        null != r ? this._totalVertices = r : null != n && (this._totalVertices = n.length / (t.byteStride / 4)),
                        this._updateExtend(n),
                        this._resetPointsArrayCache();
                        for (var o = this._meshes, a = o.length, s = 0; s < a; s++) {
                            var y = o[s];
                            y._boundingInfo = new e.BoundingInfo(this._extend.minimum,this._extend.maximum),
                            y._createGlobalSubMesh(!1),
                            y.computeWorldMatrix(!0)
                        }
                    }
                    this.notifyUpdate(i),
                    this._vertexArrayObjects && (this._disposeVertexArrayObjects(),
                    this._vertexArrayObjects = {})
                }
                ,
                t.prototype.updateVerticesDataDirectly = function(e, t, r, i) {
                    void 0 === i && (i = !1);
                    var n = this.getVertexBuffer(e);
                    n && (n.updateDirectly(t, r, i),
                    this.notifyUpdate(e))
                }
                ,
                t.prototype.updateVerticesData = function(t, r, i) {
                    void 0 === i && (i = !1);
                    var n = this.getVertexBuffer(t);
                    n && (n.update(r),
                    t === e.VertexBuffer.PositionKind && this._updateBoundingInfo(i, r),
                    this.notifyUpdate(t))
                }
                ,
                t.prototype._updateBoundingInfo = function(t, r) {
                    t && this._updateExtend(r);
                    var i = this._meshes
                      , n = i.length;
                    this._resetPointsArrayCache();
                    for (var o = 0; o < n; o++) {
                        var a = i[o];
                        if (t) {
                            a._boundingInfo = new e.BoundingInfo(this._extend.minimum,this._extend.maximum);
                            for (var s = 0; s < a.subMeshes.length; s++) {
                                a.subMeshes[s].refreshBoundingInfo()
                            }
                        }
                    }
                }
                ,
                t.prototype._bind = function(e, t) {
                    if (e) {
                        void 0 === t && (t = this._indexBuffer);
                        var r = this.getVertexBuffers();
                        r && (t == this._indexBuffer && this._vertexArrayObjects ? (this._vertexArrayObjects[e.key] || (this._vertexArrayObjects[e.key] = this._engine.recordVertexArrayObject(r, t, e)),
                        this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key], t)) : this._engine.bindBuffers(r, t, e))
                    }
                }
                ,
                t.prototype.getTotalVertices = function() {
                    return this.isReady() ? this._totalVertices : 0
                }
                ,
                t.prototype.getVerticesData = function(t, r, i) {
                    var n = this.getVertexBuffer(t);
                    if (!n)
                        return null;
                    var o = n.getData();
                    if (!o)
                        return null;
                    var a = n.getSize() * e.VertexBuffer.GetTypeByteLength(n.type)
                      , s = this._totalVertices * n.getSize();
                    if (n.type !== e.VertexBuffer.FLOAT || n.byteStride !== a) {
                        var y = new Array(s);
                        return n.forEach(s, (function(e, t) {
                            y[t] = e
                        }
                        )),
                        y
                    }
                    if (!(o instanceof Array || o instanceof Float32Array) || 0 !== n.byteOffset || o.length !== s) {
                        if (o instanceof Array) {
                            var l = n.byteOffset / 4;
                            return e.Tools.Slice(o, l, l + s)
                        }
                        if (o instanceof ArrayBuffer)
                            return new Float32Array(o,n.byteOffset,s);
                        l = o.byteOffset + n.byteOffset;
                        if (i || r && 1 !== this._meshes.length) {
                            var c = new Float32Array(s)
                              , h = new Float32Array(o.buffer,l,s);
                            return c.set(h),
                            c
                        }
                        return new Float32Array(o.buffer,l,s)
                    }
                    return i || r && 1 !== this._meshes.length ? e.Tools.Slice(o) : o
                }
                ,
                t.prototype.isVertexBufferUpdatable = function(e) {
                    var t = this._vertexBuffers[e];
                    return !!t && t.isUpdatable()
                }
                ,
                t.prototype.getVertexBuffer = function(e) {
                    return this.isReady() ? this._vertexBuffers[e] : null
                }
                ,
                t.prototype.getVertexBuffers = function() {
                    return this.isReady() ? this._vertexBuffers : null
                }
                ,
                t.prototype.isVerticesDataPresent = function(e) {
                    return this._vertexBuffers ? void 0 !== this._vertexBuffers[e] : !!this._delayInfo && -1 !== this._delayInfo.indexOf(e)
                }
                ,
                t.prototype.getVerticesDataKinds = function() {
                    var e, t = [];
                    if (!this._vertexBuffers && this._delayInfo)
                        for (e in this._delayInfo)
                            t.push(e);
                    else
                        for (e in this._vertexBuffers)
                            t.push(e);
                    return t
                }
                ,
                t.prototype.updateIndices = function(e, t) {
                    this._indexBuffer && (this._indexBufferIsUpdatable ? this._engine.updateDynamicIndexBuffer(this._indexBuffer, e, t) : this.setIndices(e, null, !0))
                }
                ,
                t.prototype.setIndices = function(e, t, r) {
                    void 0 === t && (t = null),
                    void 0 === r && (r = !1),
                    this._indexBuffer && this._engine._releaseBuffer(this._indexBuffer),
                    this._disposeVertexArrayObjects(),
                    this._indices = e,
                    this._indexBufferIsUpdatable = r,
                    0 !== this._meshes.length && this._indices && (this._indexBuffer = this._engine.createIndexBuffer(this._indices, r)),
                    null != t && (this._totalVertices = t);
                    for (var i = this._meshes, n = i.length, o = 0; o < n; o++)
                        i[o]._createGlobalSubMesh(!0);
                    this.notifyUpdate()
                }
                ,
                t.prototype.getTotalIndices = function() {
                    return this.isReady() ? this._indices.length : 0
                }
                ,
                t.prototype.getIndices = function(e, t) {
                    if (!this.isReady())
                        return null;
                    var r = this._indices;
                    if (t || e && 1 !== this._meshes.length) {
                        for (var i = r.length, n = [], o = 0; o < i; o++)
                            n.push(r[o]);
                        return n
                    }
                    return r
                }
                ,
                t.prototype.getIndexBuffer = function() {
                    return this.isReady() ? this._indexBuffer : null
                }
                ,
                t.prototype._releaseVertexArrayObject = function(e) {
                    void 0 === e && (e = null),
                    e && this._vertexArrayObjects && this._vertexArrayObjects[e.key] && (this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),
                    delete this._vertexArrayObjects[e.key])
                }
                ,
                t.prototype.releaseForMesh = function(e, t) {
                    var r = this._meshes
                      , i = r.indexOf(e);
                    -1 !== i && (r.splice(i, 1),
                    e._geometry = null,
                    0 === r.length && t && this.dispose())
                }
                ,
                t.prototype.applyToMesh = function(e) {
                    if (e._geometry !== this) {
                        var t = e._geometry;
                        t && t.releaseForMesh(e);
                        var r = this._meshes;
                        e._geometry = this,
                        this._scene.pushGeometry(this),
                        r.push(e),
                        this.isReady() ? this._applyToMesh(e) : e._boundingInfo = this._boundingInfo
                    }
                }
                ,
                t.prototype._updateExtend = function(t) {
                    void 0 === t && (t = null),
                    t || (t = this.getVerticesData(e.VertexBuffer.PositionKind)),
                    this._extend = e.Tools.ExtractMinAndMax(t, 0, this._totalVertices, this.boundingBias, 3)
                }
                ,
                t.prototype._applyToMesh = function(t) {
                    var r = this._meshes.length;
                    for (var i in this._vertexBuffers) {
                        1 === r && this._vertexBuffers[i].create();
                        var n = this._vertexBuffers[i].getBuffer();
                        n && (n.references = r),
                        i === e.VertexBuffer.PositionKind && (this._extend || this._updateExtend(),
                        t._boundingInfo = new e.BoundingInfo(this._extend.minimum,this._extend.maximum),
                        t._createGlobalSubMesh(!1),
                        t._updateBoundingInfo())
                    }
                    1 === r && this._indices && this._indices.length > 0 && (this._indexBuffer = this._engine.createIndexBuffer(this._indices)),
                    this._indexBuffer && (this._indexBuffer.references = r),
                    t._syncGeometryWithMorphTargetManager()
                }
                ,
                t.prototype.notifyUpdate = function(e) {
                    this.onGeometryUpdated && this.onGeometryUpdated(this, e);
                    for (var t = 0, r = this._meshes; t < r.length; t++) {
                        r[t]._markSubMeshesAsAttributesDirty()
                    }
                }
                ,
                t.prototype.load = function(t, r) {
                    this.delayLoadState !== e.Engine.DELAYLOADSTATE_LOADING && (this.isReady() ? r && r() : (this.delayLoadState = e.Engine.DELAYLOADSTATE_LOADING,
                    this._queueLoad(t, r)))
                }
                ,
                t.prototype._queueLoad = function(t, r) {
                    var i = this;
                    this.delayLoadingFile && (t._addPendingData(this),
                    t._loadFile(this.delayLoadingFile, (function(n) {
                        if (i._delayLoadingFunction) {
                            i._delayLoadingFunction(JSON.parse(n), i),
                            i.delayLoadState = e.Engine.DELAYLOADSTATE_LOADED,
                            i._delayInfo = [],
                            t._removePendingData(i);
                            for (var o = i._meshes, a = o.length, s = 0; s < a; s++)
                                i._applyToMesh(o[s]);
                            r && r()
                        }
                    }
                    ), void 0, !0))
                }
                ,
                t.prototype.toLeftHanded = function() {
                    var t = this.getIndices(!1);
                    if (null != t && t.length > 0) {
                        for (var r = 0; r < t.length; r += 3) {
                            var i = t[r + 0];
                            t[r + 0] = t[r + 2],
                            t[r + 2] = i
                        }
                        this.setIndices(t)
                    }
                    var n = this.getVerticesData(e.VertexBuffer.PositionKind, !1);
                    if (null != n && n.length > 0) {
                        for (r = 0; r < n.length; r += 3)
                            n[r + 2] = -n[r + 2];
                        this.setVerticesData(e.VertexBuffer.PositionKind, n, !1)
                    }
                    var o = this.getVerticesData(e.VertexBuffer.NormalKind, !1);
                    if (null != o && o.length > 0) {
                        for (r = 0; r < o.length; r += 3)
                            o[r + 2] = -o[r + 2];
                        this.setVerticesData(e.VertexBuffer.NormalKind, o, !1)
                    }
                }
                ,
                t.prototype._resetPointsArrayCache = function() {
                    this._positions = null
                }
                ,
                t.prototype._generatePointsArray = function() {
                    if (this._positions)
                        return !0;
                    var t = this.getVerticesData(e.VertexBuffer.PositionKind);
                    if (!t || 0 === t.length)
                        return !1;
                    this._positions = [];
                    for (var r = 0; r < t.length; r += 3)
                        this._positions.push(e.Vector3.FromArray(t, r));
                    return !0
                }
                ,
                t.prototype.isDisposed = function() {
                    return this._isDisposed
                }
                ,
                t.prototype._disposeVertexArrayObjects = function() {
                    if (this._vertexArrayObjects) {
                        for (var e in this._vertexArrayObjects)
                            this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);
                        this._vertexArrayObjects = {}
                    }
                }
                ,
                t.prototype.dispose = function() {
                    var t, r = this._meshes, i = r.length;
                    for (t = 0; t < i; t++)
                        this.releaseForMesh(r[t]);
                    for (var n in this._meshes = [],
                    this._disposeVertexArrayObjects(),
                    this._vertexBuffers)
                        this._vertexBuffers[n].dispose();
                    this._vertexBuffers = {},
                    this._totalVertices = 0,
                    this._indexBuffer && this._engine._releaseBuffer(this._indexBuffer),
                    this._indexBuffer = null,
                    this._indices = [],
                    this.delayLoadState = e.Engine.DELAYLOADSTATE_NONE,
                    this.delayLoadingFile = null,
                    this._delayLoadingFunction = null,
                    this._delayInfo = [],
                    this._boundingInfo = null,
                    this._scene.removeGeometry(this),
                    this._isDisposed = !0
                }
                ,
                t.prototype.copy = function(r) {
                    var i = new e.VertexData;
                    i.indices = [];
                    var n = this.getIndices();
                    if (n)
                        for (var o = 0; o < n.length; o++)
                            i.indices.push(n[o]);
                    var a, s = !1, y = !1;
                    for (a in this._vertexBuffers) {
                        var l = this.getVerticesData(a);
                        if (l instanceof Float32Array ? i.set(new Float32Array(l), a) : i.set(l.slice(0), a),
                        !y) {
                            var c = this.getVertexBuffer(a);
                            c && (y = !(s = c.isUpdatable()))
                        }
                    }
                    var h = new t(r,this._scene,i,s);
                    for (a in h.delayLoadState = this.delayLoadState,
                    h.delayLoadingFile = this.delayLoadingFile,
                    h._delayLoadingFunction = this._delayLoadingFunction,
                    this._delayInfo)
                        h._delayInfo = h._delayInfo || [],
                        h._delayInfo.push(a);
                    return h._boundingInfo = new e.BoundingInfo(this._extend.minimum,this._extend.maximum),
                    h
                }
                ,
                t.prototype.serialize = function() {
                    var t = {};
                    return t.id = this.id,
                    t.updatable = this._updatable,
                    e.Tags && e.Tags.HasTags(this) && (t.tags = e.Tags.GetTags(this)),
                    t
                }
                ,
                t.prototype.toNumberArray = function(e) {
                    return Array.isArray(e) ? e : Array.prototype.slice.call(e)
                }
                ,
                t.prototype.serializeVerticeData = function() {
                    var t = this.serialize();
                    return this.isVerticesDataPresent(e.VertexBuffer.PositionKind) && (t.positions = this.toNumberArray(this.getVerticesData(e.VertexBuffer.PositionKind)),
                    this.isVertexBufferUpdatable(e.VertexBuffer.PositionKind) && (t.positions._updatable = !0)),
                    this.isVerticesDataPresent(e.VertexBuffer.NormalKind) && (t.normals = this.toNumberArray(this.getVerticesData(e.VertexBuffer.NormalKind)),
                    this.isVertexBufferUpdatable(e.VertexBuffer.NormalKind) && (t.normals._updatable = !0)),
                    this.isVerticesDataPresent(e.VertexBuffer.TangentKind) && (t.tangets = this.toNumberArray(this.getVerticesData(e.VertexBuffer.TangentKind)),
                    this.isVertexBufferUpdatable(e.VertexBuffer.TangentKind) && (t.tangets._updatable = !0)),
                    this.isVerticesDataPresent(e.VertexBuffer.UVKind) && (t.uvs = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UVKind)),
                    this.isVertexBufferUpdatable(e.VertexBuffer.UVKind) && (t.uvs._updatable = !0)),
                    this.isVerticesDataPresent(e.VertexBuffer.UV2Kind) && (t.uv2s = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV2Kind)),
                    this.isVertexBufferUpdatable(e.VertexBuffer.UV2Kind) && (t.uv2s._updatable = !0)),
                    this.isVerticesDataPresent(e.VertexBuffer.UV3Kind) && (t.uv3s = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV3Kind)),
                    this.isVertexBufferUpdatable(e.VertexBuffer.UV3Kind) && (t.uv3s._updatable = !0)),
                    this.isVerticesDataPresent(e.VertexBuffer.UV4Kind) && (t.uv4s = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV4Kind)),
                    this.isVertexBufferUpdatable(e.VertexBuffer.UV4Kind) && (t.uv4s._updatable = !0)),
                    this.isVerticesDataPresent(e.VertexBuffer.UV5Kind) && (t.uv5s = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV5Kind)),
                    this.isVertexBufferUpdatable(e.VertexBuffer.UV5Kind) && (t.uv5s._updatable = !0)),
                    this.isVerticesDataPresent(e.VertexBuffer.UV6Kind) && (t.uv6s = this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV6Kind)),
                    this.isVertexBufferUpdatable(e.VertexBuffer.UV6Kind) && (t.uv6s._updatable = !0)),
                    this.isVerticesDataPresent(e.VertexBuffer.ColorKind) && (t.colors = this.toNumberArray(this.getVerticesData(e.VertexBuffer.ColorKind)),
                    this.isVertexBufferUpdatable(e.VertexBuffer.ColorKind) && (t.colors._updatable = !0)),
                    this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind) && (t.matricesIndices = this.toNumberArray(this.getVerticesData(e.VertexBuffer.MatricesIndicesKind)),
                    t.matricesIndices._isExpanded = !0,
                    this.isVertexBufferUpdatable(e.VertexBuffer.MatricesIndicesKind) && (t.matricesIndices._updatable = !0)),
                    this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind) && (t.matricesWeights = this.toNumberArray(this.getVerticesData(e.VertexBuffer.MatricesWeightsKind)),
                    this.isVertexBufferUpdatable(e.VertexBuffer.MatricesWeightsKind) && (t.matricesWeights._updatable = !0)),
                    t.indices = this.toNumberArray(this.getIndices()),
                    t
                }
                ,
                t.ExtractFromMesh = function(e, t) {
                    var r = e._geometry;
                    return r ? r.copy(t) : null
                }
                ,
                t.RandomId = function() {
                    return e.Tools.RandomId()
                }
                ,
                t._ImportGeometry = function(r, i) {
                    var n = i.getScene()
                      , o = r.geometryId;
                    if (o) {
                        var a = n.getGeometryByID(o);
                        a && a.applyToMesh(i)
                    } else if (r instanceof ArrayBuffer) {
                        var s = i._binaryInfo;
                        if (s.positionsAttrDesc && s.positionsAttrDesc.count > 0) {
                            var y = new Float32Array(r,s.positionsAttrDesc.offset,s.positionsAttrDesc.count);
                            i.setVerticesData(e.VertexBuffer.PositionKind, y, !1)
                        }
                        if (s.normalsAttrDesc && s.normalsAttrDesc.count > 0) {
                            var l = new Float32Array(r,s.normalsAttrDesc.offset,s.normalsAttrDesc.count);
                            i.setVerticesData(e.VertexBuffer.NormalKind, l, !1)
                        }
                        if (s.tangetsAttrDesc && s.tangetsAttrDesc.count > 0) {
                            var c = new Float32Array(r,s.tangetsAttrDesc.offset,s.tangetsAttrDesc.count);
                            i.setVerticesData(e.VertexBuffer.TangentKind, c, !1)
                        }
                        if (s.uvsAttrDesc && s.uvsAttrDesc.count > 0) {
                            var h = new Float32Array(r,s.uvsAttrDesc.offset,s.uvsAttrDesc.count);
                            i.setVerticesData(e.VertexBuffer.UVKind, h, !1)
                        }
                        if (s.uvs2AttrDesc && s.uvs2AttrDesc.count > 0) {
                            var u = new Float32Array(r,s.uvs2AttrDesc.offset,s.uvs2AttrDesc.count);
                            i.setVerticesData(e.VertexBuffer.UV2Kind, u, !1)
                        }
                        if (s.uvs3AttrDesc && s.uvs3AttrDesc.count > 0) {
                            var d = new Float32Array(r,s.uvs3AttrDesc.offset,s.uvs3AttrDesc.count);
                            i.setVerticesData(e.VertexBuffer.UV3Kind, d, !1)
                        }
                        if (s.uvs4AttrDesc && s.uvs4AttrDesc.count > 0) {
                            var x = new Float32Array(r,s.uvs4AttrDesc.offset,s.uvs4AttrDesc.count);
                            i.setVerticesData(e.VertexBuffer.UV4Kind, x, !1)
                        }
                        if (s.uvs5AttrDesc && s.uvs5AttrDesc.count > 0) {
                            var p = new Float32Array(r,s.uvs5AttrDesc.offset,s.uvs5AttrDesc.count);
                            i.setVerticesData(e.VertexBuffer.UV5Kind, p, !1)
                        }
                        if (s.uvs6AttrDesc && s.uvs6AttrDesc.count > 0) {
                            var f = new Float32Array(r,s.uvs6AttrDesc.offset,s.uvs6AttrDesc.count);
                            i.setVerticesData(e.VertexBuffer.UV6Kind, f, !1)
                        }
                        if (s.colorsAttrDesc && s.colorsAttrDesc.count > 0) {
                            var m = new Float32Array(r,s.colorsAttrDesc.offset,s.colorsAttrDesc.count);
                            i.setVerticesData(e.VertexBuffer.ColorKind, m, !1, s.colorsAttrDesc.stride)
                        }
                        if (s.matricesIndicesAttrDesc && s.matricesIndicesAttrDesc.count > 0) {
                            for (var z = new Int32Array(r,s.matricesIndicesAttrDesc.offset,s.matricesIndicesAttrDesc.count), _ = [], g = 0; g < z.length; g++) {
                                var v = z[g];
                                _.push(255 & v),
                                _.push((65280 & v) >> 8),
                                _.push((16711680 & v) >> 16),
                                _.push(v >> 24)
                            }
                            i.setVerticesData(e.VertexBuffer.MatricesIndicesKind, _, !1)
                        }
                        if (s.matricesWeightsAttrDesc && s.matricesWeightsAttrDesc.count > 0) {
                            var b = new Float32Array(r,s.matricesWeightsAttrDesc.offset,s.matricesWeightsAttrDesc.count);
                            i.setVerticesData(e.VertexBuffer.MatricesWeightsKind, b, !1)
                        }
                        if (s.indicesAttrDesc && s.indicesAttrDesc.count > 0) {
                            var T = new Int32Array(r,s.indicesAttrDesc.offset,s.indicesAttrDesc.count);
                            i.setIndices(T, null)
                        }
                        if (s.subMeshesAttrDesc && s.subMeshesAttrDesc.count > 0) {
                            var E = new Int32Array(r,s.subMeshesAttrDesc.offset,5 * s.subMeshesAttrDesc.count);
                            i.subMeshes = [];
                            for (g = 0; g < s.subMeshesAttrDesc.count; g++) {
                                var P = E[5 * g + 0]
                                  , A = E[5 * g + 1]
                                  , S = E[5 * g + 2]
                                  , M = E[5 * g + 3]
                                  , C = E[5 * g + 4];
                                e.SubMesh.AddToMesh(P, A, S, M, C, i)
                            }
                        }
                    } else if (r.positions && r.normals && r.indices) {
                        if (i.setVerticesData(e.VertexBuffer.PositionKind, r.positions, r.positions._updatable),
                        i.setVerticesData(e.VertexBuffer.NormalKind, r.normals, r.normals._updatable),
                        r.tangents && i.setVerticesData(e.VertexBuffer.TangentKind, r.tangents, r.tangents._updatable),
                        r.uvs && i.setVerticesData(e.VertexBuffer.UVKind, r.uvs, r.uvs._updatable),
                        r.uvs2 && i.setVerticesData(e.VertexBuffer.UV2Kind, r.uvs2, r.uvs2._updatable),
                        r.uvs3 && i.setVerticesData(e.VertexBuffer.UV3Kind, r.uvs3, r.uvs3._updatable),
                        r.uvs4 && i.setVerticesData(e.VertexBuffer.UV4Kind, r.uvs4, r.uvs4._updatable),
                        r.uvs5 && i.setVerticesData(e.VertexBuffer.UV5Kind, r.uvs5, r.uvs5._updatable),
                        r.uvs6 && i.setVerticesData(e.VertexBuffer.UV6Kind, r.uvs6, r.uvs6._updatable),
                        r.colors && i.setVerticesData(e.VertexBuffer.ColorKind, e.Color4.CheckColors4(r.colors, r.positions.length / 3), r.colors._updatable),
                        r.matricesIndices)
                            if (r.matricesIndices._isExpanded)
                                delete r.matricesIndices._isExpanded,
                                i.setVerticesData(e.VertexBuffer.MatricesIndicesKind, r.matricesIndices, r.matricesIndices._updatable);
                            else {
                                for (_ = [],
                                g = 0; g < r.matricesIndices.length; g++) {
                                    var R = r.matricesIndices[g];
                                    _.push(255 & R),
                                    _.push((65280 & R) >> 8),
                                    _.push((16711680 & R) >> 16),
                                    _.push(R >> 24)
                                }
                                i.setVerticesData(e.VertexBuffer.MatricesIndicesKind, _, r.matricesIndices._updatable)
                            }
                        if (r.matricesIndicesExtra)
                            if (r.matricesIndicesExtra._isExpanded)
                                delete r.matricesIndices._isExpanded,
                                i.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind, r.matricesIndicesExtra, r.matricesIndicesExtra._updatable);
                            else {
                                for (_ = [],
                                g = 0; g < r.matricesIndicesExtra.length; g++) {
                                    R = r.matricesIndicesExtra[g];
                                    _.push(255 & R),
                                    _.push((65280 & R) >> 8),
                                    _.push((16711680 & R) >> 16),
                                    _.push(R >> 24)
                                }
                                i.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind, _, r.matricesIndicesExtra._updatable)
                            }
                        r.matricesWeights && (t._CleanMatricesWeights(r, i),
                        i.setVerticesData(e.VertexBuffer.MatricesWeightsKind, r.matricesWeights, r.matricesWeights._updatable)),
                        r.matricesWeightsExtra && i.setVerticesData(e.VertexBuffer.MatricesWeightsExtraKind, r.matricesWeightsExtra, r.matricesWeights._updatable),
                        i.setIndices(r.indices, null)
                    }
                    if (r.subMeshes) {
                        i.subMeshes = [];
                        for (var O = 0; O < r.subMeshes.length; O++) {
                            var I = r.subMeshes[O];
                            e.SubMesh.AddToMesh(I.materialIndex, I.verticesStart, I.verticesCount, I.indexStart, I.indexCount, i)
                        }
                    }
                    i._shouldGenerateFlatShading && (i.convertToFlatShadedMesh(),
                    delete i._shouldGenerateFlatShading),
                    i.computeWorldMatrix(!0),
                    n.onMeshImportedObservable.notifyObservers(i)
                }
                ,
                t._CleanMatricesWeights = function(t, r) {
                    if (e.SceneLoader.CleanBoneMatrixWeights) {
                        var i = 0;
                        if (t.skeletonId > -1) {
                            var n = r.getScene().getLastSkeletonByID(t.skeletonId);
                            if (n) {
                                i = n.bones.length;
                                for (var o = r.getVerticesData(e.VertexBuffer.MatricesIndicesKind), a = r.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind), s = t.matricesWeights, y = t.matricesWeightsExtra, l = t.numBoneInfluencer, c = s.length, h = 0; h < c; h += 4) {
                                    for (var u = 0, d = -1, x = 0; x < 4; x++) {
                                        u += p = s[h + x],
                                        p < .001 && d < 0 && (d = x)
                                    }
                                    if (y)
                                        for (x = 0; x < 4; x++) {
                                            var p;
                                            u += p = y[h + x],
                                            p < .001 && d < 0 && (d = x + 4)
                                        }
                                    if ((d < 0 || d > l - 1) && (d = l - 1),
                                    u > .001) {
                                        var f = 1 / u;
                                        for (x = 0; x < 4; x++)
                                            s[h + x] *= f;
                                        if (y)
                                            for (x = 0; x < 4; x++)
                                                y[h + x] *= f
                                    } else
                                        d >= 4 ? (y[h + d - 4] = 1 - u,
                                        a[h + d - 4] = i) : (s[h + d] = 1 - u,
                                        o[h + d] = i)
                                }
                                r.setVerticesData(e.VertexBuffer.MatricesIndicesKind, o),
                                t.matricesWeightsExtra && r.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind, a)
                            }
                        }
                    }
                }
                ,
                t.Parse = function(r, i, n) {
                    if (i.getGeometryByID(r.id))
                        return null;
                    var o = new t(r.id,i,void 0,r.updatable);
                    return e.Tags && e.Tags.AddTagsTo(o, r.tags),
                    r.delayLoadingFile ? (o.delayLoadState = e.Engine.DELAYLOADSTATE_NOTLOADED,
                    o.delayLoadingFile = n + r.delayLoadingFile,
                    o._boundingInfo = new e.BoundingInfo(e.Vector3.FromArray(r.boundingBoxMinimum),e.Vector3.FromArray(r.boundingBoxMaximum)),
                    o._delayInfo = [],
                    r.hasUVs && o._delayInfo.push(e.VertexBuffer.UVKind),
                    r.hasUVs2 && o._delayInfo.push(e.VertexBuffer.UV2Kind),
                    r.hasUVs3 && o._delayInfo.push(e.VertexBuffer.UV3Kind),
                    r.hasUVs4 && o._delayInfo.push(e.VertexBuffer.UV4Kind),
                    r.hasUVs5 && o._delayInfo.push(e.VertexBuffer.UV5Kind),
                    r.hasUVs6 && o._delayInfo.push(e.VertexBuffer.UV6Kind),
                    r.hasColors && o._delayInfo.push(e.VertexBuffer.ColorKind),
                    r.hasMatricesIndices && o._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),
                    r.hasMatricesWeights && o._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),
                    o._delayLoadingFunction = e.VertexData.ImportVertexData) : e.VertexData.ImportVertexData(r, o),
                    i.pushGeometry(o, !0),
                    o
                }
                ,
                t
            }();
            e.Geometry = t;
            var r = function(e) {
                function t(t, r, i, n) {
                    void 0 === i && (i = !1),
                    void 0 === n && (n = null);
                    var o = e.call(this, t, r, void 0, !1, n) || this;
                    return o._canBeRegenerated = i,
                    o._beingRegenerated = !0,
                    o.regenerate(),
                    o._beingRegenerated = !1,
                    o
                }
                return o(t, e),
                t.prototype.canBeRegenerated = function() {
                    return this._canBeRegenerated
                }
                ,
                t.prototype.regenerate = function() {
                    this._canBeRegenerated && (this._beingRegenerated = !0,
                    this.setAllVerticesData(this._regenerateVertexData(), !1),
                    this._beingRegenerated = !1)
                }
                ,
                t.prototype.asNewGeometry = function(t) {
                    return e.prototype.copy.call(this, t)
                }
                ,
                t.prototype.setAllVerticesData = function(t, r) {
                    this._beingRegenerated && e.prototype.setAllVerticesData.call(this, t, !1)
                }
                ,
                t.prototype.setVerticesData = function(t, r, i) {
                    this._beingRegenerated && e.prototype.setVerticesData.call(this, t, r, !1)
                }
                ,
                t.prototype._regenerateVertexData = function() {
                    throw new Error("Abstract method")
                }
                ,
                t.prototype.copy = function(e) {
                    throw new Error("Must be overriden in sub-classes.")
                }
                ,
                t.prototype.serialize = function() {
                    var t = e.prototype.serialize.call(this);
                    return t.canBeRegenerated = this.canBeRegenerated(),
                    t
                }
                ,
                t
            }(t);
            e._PrimitiveGeometry = r;
            var i = function(t) {
                function r(r, i, n, o, a, s, y, l, c) {
                    void 0 === c && (c = e.Mesh.DEFAULTSIDE);
                    var h = t.call(this, r, i, y, l) || this;
                    return h.pathArray = n,
                    h.closeArray = o,
                    h.closePath = a,
                    h.offset = s,
                    h.side = c,
                    h
                }
                return o(r, t),
                r.prototype._regenerateVertexData = function() {
                    return e.VertexData.CreateRibbon({
                        pathArray: this.pathArray,
                        closeArray: this.closeArray,
                        closePath: this.closePath,
                        offset: this.offset,
                        sideOrientation: this.side
                    })
                }
                ,
                r.prototype.copy = function(e) {
                    return new r(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),void 0,this.side)
                }
                ,
                r
            }(r);
            e.RibbonGeometry = i;
            var n = function(t) {
                function r(r, i, n, o, a, s) {
                    void 0 === a && (a = null),
                    void 0 === s && (s = e.Mesh.DEFAULTSIDE);
                    var y = t.call(this, r, i, o, a) || this;
                    return y.size = n,
                    y.side = s,
                    y
                }
                return o(r, t),
                r.prototype._regenerateVertexData = function() {
                    return e.VertexData.CreateBox({
                        size: this.size,
                        sideOrientation: this.side
                    })
                }
                ,
                r.prototype.copy = function(e) {
                    return new r(e,this.getScene(),this.size,this.canBeRegenerated(),void 0,this.side)
                }
                ,
                r.prototype.serialize = function() {
                    var e = t.prototype.serialize.call(this);
                    return e.size = this.size,
                    e
                }
                ,
                r.Parse = function(t, i) {
                    if (i.getGeometryByID(t.id))
                        return null;
                    var n = new r(t.id,i,t.size,t.canBeRegenerated,null);
                    return e.Tags && e.Tags.AddTagsTo(n, t.tags),
                    i.pushGeometry(n, !0),
                    n
                }
                ,
                r
            }(r);
            e.BoxGeometry = n;
            var a = function(t) {
                function r(r, i, n, o, a, s, y) {
                    void 0 === s && (s = null),
                    void 0 === y && (y = e.Mesh.DEFAULTSIDE);
                    var l = t.call(this, r, i, a, s) || this;
                    return l.segments = n,
                    l.diameter = o,
                    l.side = y,
                    l
                }
                return o(r, t),
                r.prototype._regenerateVertexData = function() {
                    return e.VertexData.CreateSphere({
                        segments: this.segments,
                        diameter: this.diameter,
                        sideOrientation: this.side
                    })
                }
                ,
                r.prototype.copy = function(e) {
                    return new r(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)
                }
                ,
                r.prototype.serialize = function() {
                    var e = t.prototype.serialize.call(this);
                    return e.segments = this.segments,
                    e.diameter = this.diameter,
                    e
                }
                ,
                r.Parse = function(t, i) {
                    if (i.getGeometryByID(t.id))
                        return null;
                    var n = new r(t.id,i,t.segments,t.diameter,t.canBeRegenerated,null);
                    return e.Tags && e.Tags.AddTagsTo(n, t.tags),
                    i.pushGeometry(n, !0),
                    n
                }
                ,
                r
            }(r);
            e.SphereGeometry = a;
            var s = function(t) {
                function r(r, i, n, o, a, s, y) {
                    void 0 === s && (s = null),
                    void 0 === y && (y = e.Mesh.DEFAULTSIDE);
                    var l = t.call(this, r, i, a, s) || this;
                    return l.radius = n,
                    l.tessellation = o,
                    l.side = y,
                    l
                }
                return o(r, t),
                r.prototype._regenerateVertexData = function() {
                    return e.VertexData.CreateDisc({
                        radius: this.radius,
                        tessellation: this.tessellation,
                        sideOrientation: this.side
                    })
                }
                ,
                r.prototype.copy = function(e) {
                    return new r(e,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)
                }
                ,
                r
            }(r);
            e.DiscGeometry = s;
            var y = function(t) {
                function r(r, i, n, o, a, s, y, l, c, h) {
                    void 0 === y && (y = 1),
                    void 0 === c && (c = null),
                    void 0 === h && (h = e.Mesh.DEFAULTSIDE);
                    var u = t.call(this, r, i, l, c) || this;
                    return u.height = n,
                    u.diameterTop = o,
                    u.diameterBottom = a,
                    u.tessellation = s,
                    u.subdivisions = y,
                    u.side = h,
                    u
                }
                return o(r, t),
                r.prototype._regenerateVertexData = function() {
                    return e.VertexData.CreateCylinder({
                        height: this.height,
                        diameterTop: this.diameterTop,
                        diameterBottom: this.diameterBottom,
                        tessellation: this.tessellation,
                        subdivisions: this.subdivisions,
                        sideOrientation: this.side
                    })
                }
                ,
                r.prototype.copy = function(e) {
                    return new r(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)
                }
                ,
                r.prototype.serialize = function() {
                    var e = t.prototype.serialize.call(this);
                    return e.height = this.height,
                    e.diameterTop = this.diameterTop,
                    e.diameterBottom = this.diameterBottom,
                    e.tessellation = this.tessellation,
                    e
                }
                ,
                r.Parse = function(t, i) {
                    if (i.getGeometryByID(t.id))
                        return null;
                    var n = new r(t.id,i,t.height,t.diameterTop,t.diameterBottom,t.tessellation,t.subdivisions,t.canBeRegenerated,null);
                    return e.Tags && e.Tags.AddTagsTo(n, t.tags),
                    i.pushGeometry(n, !0),
                    n
                }
                ,
                r
            }(r);
            e.CylinderGeometry = y;
            var l = function(t) {
                function r(r, i, n, o, a, s, y, l) {
                    void 0 === y && (y = null),
                    void 0 === l && (l = e.Mesh.DEFAULTSIDE);
                    var c = t.call(this, r, i, s, y) || this;
                    return c.diameter = n,
                    c.thickness = o,
                    c.tessellation = a,
                    c.side = l,
                    c
                }
                return o(r, t),
                r.prototype._regenerateVertexData = function() {
                    return e.VertexData.CreateTorus({
                        diameter: this.diameter,
                        thickness: this.thickness,
                        tessellation: this.tessellation,
                        sideOrientation: this.side
                    })
                }
                ,
                r.prototype.copy = function(e) {
                    return new r(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)
                }
                ,
                r.prototype.serialize = function() {
                    var e = t.prototype.serialize.call(this);
                    return e.diameter = this.diameter,
                    e.thickness = this.thickness,
                    e.tessellation = this.tessellation,
                    e
                }
                ,
                r.Parse = function(t, i) {
                    if (i.getGeometryByID(t.id))
                        return null;
                    var n = new r(t.id,i,t.diameter,t.thickness,t.tessellation,t.canBeRegenerated,null);
                    return e.Tags && e.Tags.AddTagsTo(n, t.tags),
                    i.pushGeometry(n, !0),
                    n
                }
                ,
                r
            }(r);
            e.TorusGeometry = l;
            var c = function(t) {
                function r(e, r, i, n, o, a, s) {
                    void 0 === s && (s = null);
                    var y = t.call(this, e, r, a, s) || this;
                    return y.width = i,
                    y.height = n,
                    y.subdivisions = o,
                    y
                }
                return o(r, t),
                r.prototype._regenerateVertexData = function() {
                    return e.VertexData.CreateGround({
                        width: this.width,
                        height: this.height,
                        subdivisions: this.subdivisions
                    })
                }
                ,
                r.prototype.copy = function(e) {
                    return new r(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)
                }
                ,
                r.prototype.serialize = function() {
                    var e = t.prototype.serialize.call(this);
                    return e.width = this.width,
                    e.height = this.height,
                    e.subdivisions = this.subdivisions,
                    e
                }
                ,
                r.Parse = function(t, i) {
                    if (i.getGeometryByID(t.id))
                        return null;
                    var n = new r(t.id,i,t.width,t.height,t.subdivisions,t.canBeRegenerated,null);
                    return e.Tags && e.Tags.AddTagsTo(n, t.tags),
                    i.pushGeometry(n, !0),
                    n
                }
                ,
                r
            }(r);
            e.GroundGeometry = c;
            var h = function(t) {
                function r(e, r, i, n, o, a, s, y, l, c) {
                    void 0 === c && (c = null);
                    var h = t.call(this, e, r, l, c) || this;
                    return h.xmin = i,
                    h.zmin = n,
                    h.xmax = o,
                    h.zmax = a,
                    h.subdivisions = s,
                    h.precision = y,
                    h
                }
                return o(r, t),
                r.prototype._regenerateVertexData = function() {
                    return e.VertexData.CreateTiledGround({
                        xmin: this.xmin,
                        zmin: this.zmin,
                        xmax: this.xmax,
                        zmax: this.zmax,
                        subdivisions: this.subdivisions,
                        precision: this.precision
                    })
                }
                ,
                r.prototype.copy = function(e) {
                    return new r(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)
                }
                ,
                r
            }(r);
            e.TiledGroundGeometry = h;
            var u = function(t) {
                function r(r, i, n, o, a, s) {
                    void 0 === a && (a = null),
                    void 0 === s && (s = e.Mesh.DEFAULTSIDE);
                    var y = t.call(this, r, i, o, a) || this;
                    return y.size = n,
                    y.side = s,
                    y
                }
                return o(r, t),
                r.prototype._regenerateVertexData = function() {
                    return e.VertexData.CreatePlane({
                        size: this.size,
                        sideOrientation: this.side
                    })
                }
                ,
                r.prototype.copy = function(e) {
                    return new r(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)
                }
                ,
                r.prototype.serialize = function() {
                    var e = t.prototype.serialize.call(this);
                    return e.size = this.size,
                    e
                }
                ,
                r.Parse = function(t, i) {
                    if (i.getGeometryByID(t.id))
                        return null;
                    var n = new r(t.id,i,t.size,t.canBeRegenerated,null);
                    return e.Tags && e.Tags.AddTagsTo(n, t.tags),
                    i.pushGeometry(n, !0),
                    n
                }
                ,
                r
            }(r);
            e.PlaneGeometry = u;
            var d = function(t) {
                function r(r, i, n, o, a, s, y, l, c, h, u) {
                    void 0 === h && (h = null),
                    void 0 === u && (u = e.Mesh.DEFAULTSIDE);
                    var d = t.call(this, r, i, c, h) || this;
                    return d.radius = n,
                    d.tube = o,
                    d.radialSegments = a,
                    d.tubularSegments = s,
                    d.p = y,
                    d.q = l,
                    d.side = u,
                    d
                }
                return o(r, t),
                r.prototype._regenerateVertexData = function() {
                    return e.VertexData.CreateTorusKnot({
                        radius: this.radius,
                        tube: this.tube,
                        radialSegments: this.radialSegments,
                        tubularSegments: this.tubularSegments,
                        p: this.p,
                        q: this.q,
                        sideOrientation: this.side
                    })
                }
                ,
                r.prototype.copy = function(e) {
                    return new r(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)
                }
                ,
                r.prototype.serialize = function() {
                    var e = t.prototype.serialize.call(this);
                    return e.radius = this.radius,
                    e.tube = this.tube,
                    e.radialSegments = this.radialSegments,
                    e.tubularSegments = this.tubularSegments,
                    e.p = this.p,
                    e.q = this.q,
                    e
                }
                ,
                r.Parse = function(t, i) {
                    if (i.getGeometryByID(t.id))
                        return null;
                    var n = new r(t.id,i,t.radius,t.tube,t.radialSegments,t.tubularSegments,t.p,t.q,t.canBeRegenerated,null);
                    return e.Tags && e.Tags.AddTagsTo(n, t.tags),
                    i.pushGeometry(n, !0),
                    n
                }
                ,
                r
            }(r);
            e.TorusKnotGeometry = d
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e) {
                    void 0 === e && (e = 30),
                    this._enabled = !0,
                    this._rollingFrameTime = new r(e)
                }
                return t.prototype.sampleFrame = function(t) {
                    if (void 0 === t && (t = e.Tools.Now),
                    this._enabled) {
                        if (null != this._lastFrameTimeMs) {
                            var r = t - this._lastFrameTimeMs;
                            this._rollingFrameTime.add(r)
                        }
                        this._lastFrameTimeMs = t
                    }
                }
                ,
                Object.defineProperty(t.prototype, "averageFrameTime", {
                    get: function() {
                        return this._rollingFrameTime.average
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "averageFrameTimeVariance", {
                    get: function() {
                        return this._rollingFrameTime.variance
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "instantaneousFrameTime", {
                    get: function() {
                        return this._rollingFrameTime.history(0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "averageFPS", {
                    get: function() {
                        return 1e3 / this._rollingFrameTime.average
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "instantaneousFPS", {
                    get: function() {
                        var e = this._rollingFrameTime.history(0);
                        return 0 === e ? 0 : 1e3 / e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "isSaturated", {
                    get: function() {
                        return this._rollingFrameTime.isSaturated()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.enable = function() {
                    this._enabled = !0
                }
                ,
                t.prototype.disable = function() {
                    this._enabled = !1,
                    this._lastFrameTimeMs = null
                }
                ,
                Object.defineProperty(t.prototype, "isEnabled", {
                    get: function() {
                        return this._enabled
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.reset = function() {
                    this._lastFrameTimeMs = null,
                    this._rollingFrameTime.reset()
                }
                ,
                t
            }();
            e.PerformanceMonitor = t;
            var r = function() {
                function e(e) {
                    this._samples = new Array(e),
                    this.reset()
                }
                return e.prototype.add = function(e) {
                    var t;
                    if (this.isSaturated()) {
                        var r = this._samples[this._pos];
                        t = r - this.average,
                        this.average -= t / (this._sampleCount - 1),
                        this._m2 -= t * (r - this.average)
                    } else
                        this._sampleCount++;
                    t = e - this.average,
                    this.average += t / this._sampleCount,
                    this._m2 += t * (e - this.average),
                    this.variance = this._m2 / (this._sampleCount - 1),
                    this._samples[this._pos] = e,
                    this._pos++,
                    this._pos %= this._samples.length
                }
                ,
                e.prototype.history = function(e) {
                    if (e >= this._sampleCount || e >= this._samples.length)
                        return 0;
                    var t = this._wrapPosition(this._pos - 1);
                    return this._samples[this._wrapPosition(t - e)]
                }
                ,
                e.prototype.isSaturated = function() {
                    return this._sampleCount >= this._samples.length
                }
                ,
                e.prototype.reset = function() {
                    this.average = 0,
                    this.variance = 0,
                    this._sampleCount = 0,
                    this._pos = 0,
                    this._m2 = 0
                }
                ,
                e.prototype._wrapPosition = function(e) {
                    var t = this._samples.length;
                    return (e % t + t) % t
                }
                ,
                e
            }();
            e.RollingAverage = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.BindEyePosition = function(e, t) {
                    t._forcedViewPosition ? e.setVector3("vEyePosition", t._forcedViewPosition) : e.setVector3("vEyePosition", t._mirroredCameraPosition ? t._mirroredCameraPosition : t.activeCamera.globalPosition)
                }
                ,
                t.PrepareDefinesForMergedUV = function(e, t, r) {
                    t._needUVs = !0,
                    t[r] = !0,
                    e.getTextureMatrix().isIdentity(!0) ? (t[r + "DIRECTUV"] = e.coordinatesIndex + 1,
                    0 === e.coordinatesIndex ? t.MAINUV1 = !0 : t.MAINUV2 = !0) : t[r + "DIRECTUV"] = 0
                }
                ,
                t.BindTextureMatrix = function(e, t, r) {
                    var i = e.getTextureMatrix();
                    i.isIdentity(!0) || t.updateMatrix(r + "Matrix", i)
                }
                ,
                t.PrepareDefinesForMisc = function(t, r, i, n, o, a, s) {
                    s._areMiscDirty && (s.LOGARITHMICDEPTH = i,
                    s.POINTSIZE = n,
                    s.FOG = r.fogEnabled && t.applyFog && r.fogMode !== e.Scene.FOGMODE_NONE && o,
                    s.NONUNIFORMSCALING = t.nonUniformScaling,
                    s.ALPHATEST = a)
                }
                ,
                t.PrepareDefinesForFrameBoundValues = function(e, t, r, i, n) {
                    void 0 === n && (n = null);
                    var o, a, s, y, l = !1;
                    o = null == n ? void 0 !== e.clipPlane && null !== e.clipPlane : n,
                    a = null == n ? void 0 !== e.clipPlane2 && null !== e.clipPlane2 : n,
                    s = null == n ? void 0 !== e.clipPlane3 && null !== e.clipPlane3 : n,
                    y = null == n ? void 0 !== e.clipPlane4 && null !== e.clipPlane4 : n,
                    r.CLIPPLANE !== o && (r.CLIPPLANE = o,
                    l = !0),
                    r.CLIPPLANE2 !== a && (r.CLIPPLANE2 = a,
                    l = !0),
                    r.CLIPPLANE3 !== s && (r.CLIPPLANE3 = s,
                    l = !0),
                    r.CLIPPLANE4 !== y && (r.CLIPPLANE4 = y,
                    l = !0),
                    r.DEPTHPREPASS !== !t.getColorWrite() && (r.DEPTHPREPASS = !r.DEPTHPREPASS,
                    l = !0),
                    r.INSTANCES !== i && (r.INSTANCES = i,
                    l = !0),
                    l && r.markAsUnprocessed()
                }
                ,
                t.PrepareDefinesForAttributes = function(t, r, i, n, o, a) {
                    if (void 0 === o && (o = !1),
                    void 0 === a && (a = !0),
                    !r._areAttributesDirty && r._needNormals === r._normals && r._needUVs === r._uvs)
                        return !1;
                    if (r._normals = r._needNormals,
                    r._uvs = r._needUVs,
                    r.NORMAL = r._needNormals && t.isVerticesDataPresent(e.VertexBuffer.NormalKind),
                    r._needNormals && t.isVerticesDataPresent(e.VertexBuffer.TangentKind) && (r.TANGENT = !0),
                    r._needUVs ? (r.UV1 = t.isVerticesDataPresent(e.VertexBuffer.UVKind),
                    r.UV2 = t.isVerticesDataPresent(e.VertexBuffer.UV2Kind)) : (r.UV1 = !1,
                    r.UV2 = !1),
                    i) {
                        var s = t.useVertexColors && t.isVerticesDataPresent(e.VertexBuffer.ColorKind);
                        r.VERTEXCOLOR = s,
                        r.VERTEXALPHA = t.hasVertexAlpha && s && a
                    }
                    if (n && (t.useBones && t.computeBonesUsingShaders && t.skeleton ? (r.NUM_BONE_INFLUENCERS = t.numBoneInfluencers,
                    r.BonesPerMesh = t.skeleton.bones.length + 1) : (r.NUM_BONE_INFLUENCERS = 0,
                    r.BonesPerMesh = 0)),
                    o) {
                        var y = t.morphTargetManager;
                        y ? (r.MORPHTARGETS_TANGENT = y.supportsTangents && r.TANGENT,
                        r.MORPHTARGETS_NORMAL = y.supportsNormals && r.NORMAL,
                        r.MORPHTARGETS = y.numInfluencers > 0,
                        r.NUM_MORPH_INFLUENCERS = y.numInfluencers) : (r.MORPHTARGETS_TANGENT = !1,
                        r.MORPHTARGETS_NORMAL = !1,
                        r.MORPHTARGETS = !1,
                        r.NUM_MORPH_INFLUENCERS = 0)
                    }
                    return !0
                }
                ,
                t.PrepareDefinesForLights = function(t, r, i, n, o, a) {
                    if (void 0 === o && (o = 4),
                    void 0 === a && (a = !1),
                    !i._areLightsDirty)
                        return i._needNormals;
                    var s = 0
                      , y = !1
                      , l = !1
                      , c = !1
                      , h = !1
                      , u = !1;
                    if (t.lightsEnabled && !a)
                        for (var d = 0, x = r._lightSources; d < x.length; d++) {
                            var p = x[d];
                            switch (y = !0,
                            void 0 === i["LIGHT" + s] && (l = !0),
                            i["LIGHT" + s] = !0,
                            i["SPOTLIGHT" + s] = !1,
                            i["HEMILIGHT" + s] = !1,
                            i["POINTLIGHT" + s] = !1,
                            i["DIRLIGHT" + s] = !1,
                            p.prepareLightSpecificDefines(i, s),
                            i["LIGHT_FALLOFF_PHYSICAL" + s] = !1,
                            i["LIGHT_FALLOFF_GLTF" + s] = !1,
                            i["LIGHT_FALLOFF_STANDARD" + s] = !1,
                            p.falloffType) {
                            case e.Light.FALLOFF_GLTF:
                                i["LIGHT_FALLOFF_GLTF" + s] = !0;
                                break;
                            case e.Light.FALLOFF_PHYSICAL:
                                i["LIGHT_FALLOFF_PHYSICAL" + s] = !0;
                                break;
                            case e.Light.FALLOFF_STANDARD:
                                i["LIGHT_FALLOFF_STANDARD" + s] = !0
                            }
                            if (n && !p.specular.equalsFloats(0, 0, 0) && (u = !0),
                            i["SHADOW" + s] = !1,
                            i["SHADOWPCF" + s] = !1,
                            i["SHADOWPCSS" + s] = !1,
                            i["SHADOWPOISSON" + s] = !1,
                            i["SHADOWESM" + s] = !1,
                            i["SHADOWCUBE" + s] = !1,
                            i["SHADOWLOWQUALITY" + s] = !1,
                            i["SHADOWMEDIUMQUALITY" + s] = !1,
                            r && r.receiveShadows && t.shadowsEnabled && p.shadowEnabled) {
                                var f = p.getShadowGenerator();
                                if (f) {
                                    var m = f.getShadowMap();
                                    m && m.renderList && m.renderList.length > 0 && (h = !0,
                                    f.prepareDefines(i, s))
                                }
                            }
                            if (p.lightmapMode != e.Light.LIGHTMAP_DEFAULT ? (c = !0,
                            i["LIGHTMAPEXCLUDED" + s] = !0,
                            i["LIGHTMAPNOSPECULAR" + s] = p.lightmapMode == e.Light.LIGHTMAP_SHADOWSONLY) : (i["LIGHTMAPEXCLUDED" + s] = !1,
                            i["LIGHTMAPNOSPECULAR" + s] = !1),
                            ++s === o)
                                break
                        }
                    i.SPECULARTERM = u,
                    i.SHADOWS = h;
                    for (var z = s; z < o; z++)
                        void 0 !== i["LIGHT" + z] && (i["LIGHT" + z] = !1,
                        i["HEMILIGHT" + s] = !1,
                        i["POINTLIGHT" + s] = !1,
                        i["DIRLIGHT" + s] = !1,
                        i["SPOTLIGHT" + s] = !1,
                        i["SHADOW" + s] = !1);
                    var _ = t.getEngine().getCaps();
                    return void 0 === i.SHADOWFLOAT && (l = !0),
                    i.SHADOWFLOAT = h && (_.textureFloatRender && _.textureFloatLinearFiltering || _.textureHalfFloatRender && _.textureHalfFloatLinearFiltering),
                    i.LIGHTMAPEXCLUDED = c,
                    l && i.rebuild(),
                    y
                }
                ,
                t.PrepareUniformsAndSamplersList = function(e, t, r, i) {
                    var n;
                    void 0 === i && (i = 4);
                    var o = null;
                    if (e.uniformsNames) {
                        var a = e;
                        n = a.uniformsNames,
                        o = a.uniformBuffersNames,
                        t = a.samplers,
                        r = a.defines,
                        i = a.maxSimultaneousLights
                    } else
                        n = e,
                        t || (t = []);
                    for (var s = 0; s < i && r["LIGHT" + s]; s++)
                        n.push("vLightData" + s, "vLightDiffuse" + s, "vLightSpecular" + s, "vLightDirection" + s, "vLightFalloff" + s, "vLightGround" + s, "lightMatrix" + s, "shadowsInfo" + s, "depthValues" + s),
                        o && o.push("Light" + s),
                        t.push("shadowSampler" + s),
                        t.push("depthSampler" + s),
                        r["PROJECTEDLIGHTTEXTURE" + s] && (t.push("projectionLightSampler" + s),
                        n.push("textureProjectionMatrix" + s));
                    r.NUM_MORPH_INFLUENCERS && n.push("morphTargetInfluences")
                }
                ,
                t.HandleFallbacksForShadows = function(e, t, r, i) {
                    void 0 === r && (r = 4),
                    void 0 === i && (i = 0);
                    for (var n = 0, o = 0; o < r && e["LIGHT" + o]; o++)
                        o > 0 && (n = i + o,
                        t.addFallback(n, "LIGHT" + o)),
                        e.SHADOWS || (e["SHADOW" + o] && t.addFallback(i, "SHADOW" + o),
                        e["SHADOWPCF" + o] && t.addFallback(i, "SHADOWPCF" + o),
                        e["SHADOWPCSS" + o] && t.addFallback(i, "SHADOWPCSS" + o),
                        e["SHADOWPOISSON" + o] && t.addFallback(i, "SHADOWPOISSON" + o),
                        e["SHADOWESM" + o] && t.addFallback(i, "SHADOWESM" + o));
                    return n++
                }
                ,
                t.PrepareAttributesForMorphTargets = function(t, r, i) {
                    var n = i.NUM_MORPH_INFLUENCERS;
                    if (n > 0 && e.Engine.LastCreatedEngine)
                        for (var o = e.Engine.LastCreatedEngine.getCaps().maxVertexAttribs, a = r.morphTargetManager, s = a && a.supportsNormals && i.NORMAL, y = a && a.supportsTangents && i.TANGENT, l = 0; l < n; l++)
                            t.push(e.VertexBuffer.PositionKind + l),
                            s && t.push(e.VertexBuffer.NormalKind + l),
                            y && t.push(e.VertexBuffer.TangentKind + l),
                            t.length > o && e.Tools.Error("Cannot add more vertex attributes for mesh " + r.name)
                }
                ,
                t.PrepareAttributesForBones = function(t, r, i, n) {
                    i.NUM_BONE_INFLUENCERS > 0 && (n.addCPUSkinningFallback(0, r),
                    t.push(e.VertexBuffer.MatricesIndicesKind),
                    t.push(e.VertexBuffer.MatricesWeightsKind),
                    i.NUM_BONE_INFLUENCERS > 4 && (t.push(e.VertexBuffer.MatricesIndicesExtraKind),
                    t.push(e.VertexBuffer.MatricesWeightsExtraKind)))
                }
                ,
                t.PrepareAttributesForInstances = function(e, t) {
                    t.INSTANCES && (e.push("world0"),
                    e.push("world1"),
                    e.push("world2"),
                    e.push("world3"))
                }
                ,
                t.BindLightShadow = function(e, t, r, i, n) {
                    if (e.shadowEnabled && r.receiveShadows) {
                        var o = e.getShadowGenerator();
                        o && o.bindShadowLight(i, n)
                    }
                }
                ,
                t.BindLightProperties = function(e, t, r) {
                    e.transferToEffect(t, r + "")
                }
                ,
                t.BindLights = function(r, i, n, o, a, s) {
                    void 0 === a && (a = 4),
                    void 0 === s && (s = !1);
                    for (var y = Math.min(i._lightSources.length, a), l = 0; l < y; l++) {
                        var c = i._lightSources[l]
                          , h = l.toString()
                          , u = c.getScaledIntensity();
                        c._uniformBuffer.bindToEffect(n, "Light" + l),
                        t.BindLightProperties(c, n, l),
                        c.diffuse.scaleToRef(u, e.Tmp.Color3[0]),
                        c._uniformBuffer.updateColor4("vLightDiffuse", e.Tmp.Color3[0], s ? c.radius : c.range, h),
                        o.SPECULARTERM && (c.specular.scaleToRef(u, e.Tmp.Color3[1]),
                        c._uniformBuffer.updateColor3("vLightSpecular", e.Tmp.Color3[1], h)),
                        r.shadowsEnabled && this.BindLightShadow(c, r, i, h, n),
                        c._uniformBuffer.update()
                    }
                }
                ,
                t.BindFogParameters = function(t, r, i, n) {
                    void 0 === n && (n = !1),
                    t.fogEnabled && r.applyFog && t.fogMode !== e.Scene.FOGMODE_NONE && (i.setFloat4("vFogInfos", t.fogMode, t.fogStart, t.fogEnd, t.fogDensity),
                    n ? (t.fogColor.toLinearSpaceToRef(this._tempFogColor),
                    i.setColor3("vFogColor", this._tempFogColor)) : i.setColor3("vFogColor", t.fogColor))
                }
                ,
                t.BindBonesParameters = function(e, t) {
                    if (t && e && (e.computeBonesUsingShaders && t._bonesComputationForcedToCPU && (e.computeBonesUsingShaders = !1),
                    e.useBones && e.computeBonesUsingShaders && e.skeleton)) {
                        var r = e.skeleton.getTransformMatrices(e);
                        r && t.setMatrices("mBones", r)
                    }
                }
                ,
                t.BindMorphTargetParameters = function(e, t) {
                    var r = e.morphTargetManager;
                    e && r && t.setFloatArray("morphTargetInfluences", r.influences)
                }
                ,
                t.BindLogDepth = function(e, t, r) {
                    e.LOGARITHMICDEPTH && t.setFloat("logarithmicDepthConstant", 2 / (Math.log(r.activeCamera.maxZ + 1) / Math.LN2))
                }
                ,
                t.BindClipPlane = function(e, t) {
                    if (t.clipPlane) {
                        var r = t.clipPlane;
                        e.setFloat4("vClipPlane", r.normal.x, r.normal.y, r.normal.z, r.d)
                    }
                    if (t.clipPlane2) {
                        r = t.clipPlane2;
                        e.setFloat4("vClipPlane2", r.normal.x, r.normal.y, r.normal.z, r.d)
                    }
                    if (t.clipPlane3) {
                        r = t.clipPlane3;
                        e.setFloat4("vClipPlane3", r.normal.x, r.normal.y, r.normal.z, r.d)
                    }
                    if (t.clipPlane4) {
                        r = t.clipPlane4;
                        e.setFloat4("vClipPlane4", r.normal.x, r.normal.y, r.normal.z, r.d)
                    }
                }
                ,
                t._tempFogColor = e.Color3.Black(),
                t
            }();
            e.MaterialHelper = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i) {
                    var n = t.call(this, r, i) || this;
                    return n._normalMatrix = new e.Matrix,
                    n.storeEffectOnSubMeshes = !0,
                    n
                }
                return o(r, t),
                r.prototype.getEffect = function() {
                    return this._activeEffect
                }
                ,
                r.prototype.isReady = function(e, t) {
                    return !!e && (!e.subMeshes || 0 === e.subMeshes.length || this.isReadyForSubMesh(e, e.subMeshes[0], t))
                }
                ,
                r.prototype.bindOnlyWorldMatrix = function(e) {
                    this._activeEffect.setMatrix("world", e)
                }
                ,
                r.prototype.bindOnlyNormalMatrix = function(e) {
                    this._activeEffect.setMatrix("normalMatrix", e)
                }
                ,
                r.prototype.bind = function(e, t) {
                    t && this.bindForSubMesh(e, t, t.subMeshes[0])
                }
                ,
                r.prototype._afterBind = function(e, r) {
                    void 0 === r && (r = null),
                    t.prototype._afterBind.call(this, e),
                    this.getScene()._cachedEffect = r
                }
                ,
                r.prototype._mustRebind = function(e, t, r) {
                    return void 0 === r && (r = 1),
                    e.isCachedMaterialInvalid(this, t, r)
                }
                ,
                r
            }(e.Material);
            e.PushMaterial = t
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t() {
                    var t = e.call(this) || this;
                    return t.MAINUV1 = !1,
                    t.MAINUV2 = !1,
                    t.DIFFUSE = !1,
                    t.DIFFUSEDIRECTUV = 0,
                    t.AMBIENT = !1,
                    t.AMBIENTDIRECTUV = 0,
                    t.OPACITY = !1,
                    t.OPACITYDIRECTUV = 0,
                    t.OPACITYRGB = !1,
                    t.REFLECTION = !1,
                    t.EMISSIVE = !1,
                    t.EMISSIVEDIRECTUV = 0,
                    t.SPECULAR = !1,
                    t.SPECULARDIRECTUV = 0,
                    t.BUMP = !1,
                    t.BUMPDIRECTUV = 0,
                    t.PARALLAX = !1,
                    t.PARALLAXOCCLUSION = !1,
                    t.SPECULAROVERALPHA = !1,
                    t.CLIPPLANE = !1,
                    t.CLIPPLANE2 = !1,
                    t.CLIPPLANE3 = !1,
                    t.CLIPPLANE4 = !1,
                    t.ALPHATEST = !1,
                    t.DEPTHPREPASS = !1,
                    t.ALPHAFROMDIFFUSE = !1,
                    t.POINTSIZE = !1,
                    t.FOG = !1,
                    t.SPECULARTERM = !1,
                    t.DIFFUSEFRESNEL = !1,
                    t.OPACITYFRESNEL = !1,
                    t.REFLECTIONFRESNEL = !1,
                    t.REFRACTIONFRESNEL = !1,
                    t.EMISSIVEFRESNEL = !1,
                    t.FRESNEL = !1,
                    t.NORMAL = !1,
                    t.UV1 = !1,
                    t.UV2 = !1,
                    t.VERTEXCOLOR = !1,
                    t.VERTEXALPHA = !1,
                    t.NUM_BONE_INFLUENCERS = 0,
                    t.BonesPerMesh = 0,
                    t.INSTANCES = !1,
                    t.GLOSSINESS = !1,
                    t.ROUGHNESS = !1,
                    t.EMISSIVEASILLUMINATION = !1,
                    t.LINKEMISSIVEWITHDIFFUSE = !1,
                    t.REFLECTIONFRESNELFROMSPECULAR = !1,
                    t.LIGHTMAP = !1,
                    t.LIGHTMAPDIRECTUV = 0,
                    t.OBJECTSPACE_NORMALMAP = !1,
                    t.USELIGHTMAPASSHADOWMAP = !1,
                    t.REFLECTIONMAP_3D = !1,
                    t.REFLECTIONMAP_SPHERICAL = !1,
                    t.REFLECTIONMAP_PLANAR = !1,
                    t.REFLECTIONMAP_CUBIC = !1,
                    t.USE_LOCAL_REFLECTIONMAP_CUBIC = !1,
                    t.REFLECTIONMAP_PROJECTION = !1,
                    t.REFLECTIONMAP_SKYBOX = !1,
                    t.REFLECTIONMAP_SKYBOX_TRANSFORMED = !1,
                    t.REFLECTIONMAP_EXPLICIT = !1,
                    t.REFLECTIONMAP_EQUIRECTANGULAR = !1,
                    t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !1,
                    t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !1,
                    t.INVERTCUBICMAP = !1,
                    t.LOGARITHMICDEPTH = !1,
                    t.REFRACTION = !1,
                    t.REFRACTIONMAP_3D = !1,
                    t.REFLECTIONOVERALPHA = !1,
                    t.TWOSIDEDLIGHTING = !1,
                    t.SHADOWFLOAT = !1,
                    t.MORPHTARGETS = !1,
                    t.MORPHTARGETS_NORMAL = !1,
                    t.MORPHTARGETS_TANGENT = !1,
                    t.NUM_MORPH_INFLUENCERS = 0,
                    t.NONUNIFORMSCALING = !1,
                    t.PREMULTIPLYALPHA = !1,
                    t.IMAGEPROCESSING = !1,
                    t.VIGNETTE = !1,
                    t.VIGNETTEBLENDMODEMULTIPLY = !1,
                    t.VIGNETTEBLENDMODEOPAQUE = !1,
                    t.TONEMAPPING = !1,
                    t.TONEMAPPING_ACES = !1,
                    t.CONTRAST = !1,
                    t.COLORCURVES = !1,
                    t.COLORGRADING = !1,
                    t.COLORGRADING3D = !1,
                    t.SAMPLER3DGREENDEPTH = !1,
                    t.SAMPLER3DBGRMAP = !1,
                    t.IMAGEPROCESSINGPOSTPROCESS = !1,
                    t.IS_REFLECTION_LINEAR = !1,
                    t.IS_REFRACTION_LINEAR = !1,
                    t.EXPOSURE = !1,
                    t.rebuild(),
                    t
                }
                return o(t, e),
                t.prototype.setReflectionMode = function(e) {
                    for (var t = 0, r = ["REFLECTIONMAP_CUBIC", "REFLECTIONMAP_EXPLICIT", "REFLECTIONMAP_PLANAR", "REFLECTIONMAP_PROJECTION", "REFLECTIONMAP_PROJECTION", "REFLECTIONMAP_SKYBOX", "REFLECTIONMAP_SPHERICAL", "REFLECTIONMAP_EQUIRECTANGULAR", "REFLECTIONMAP_EQUIRECTANGULAR_FIXED", "REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"]; t < r.length; t++) {
                        var i = r[t];
                        this[i] = i === e
                    }
                }
                ,
                t
            }(e.MaterialDefines);
            e.StandardMaterialDefines = t;
            var r = function(r) {
                function i(t, n) {
                    var o = r.call(this, t, n) || this;
                    return o.ambientColor = new e.Color3(0,0,0),
                    o.diffuseColor = new e.Color3(1,1,1),
                    o.specularColor = new e.Color3(1,1,1),
                    o.emissiveColor = new e.Color3(0,0,0),
                    o.specularPower = 64,
                    o._useAlphaFromDiffuseTexture = !1,
                    o._useEmissiveAsIllumination = !1,
                    o._linkEmissiveWithDiffuse = !1,
                    o._useSpecularOverAlpha = !1,
                    o._useReflectionOverAlpha = !1,
                    o._disableLighting = !1,
                    o._useObjectSpaceNormalMap = !1,
                    o._useParallax = !1,
                    o._useParallaxOcclusion = !1,
                    o.parallaxScaleBias = .05,
                    o._roughness = 0,
                    o.indexOfRefraction = .98,
                    o.invertRefractionY = !0,
                    o.alphaCutOff = .4,
                    o._useLightmapAsShadowmap = !1,
                    o._useReflectionFresnelFromSpecular = !1,
                    o._useGlossinessFromSpecularMapAlpha = !1,
                    o._maxSimultaneousLights = 4,
                    o._invertNormalMapX = !1,
                    o._invertNormalMapY = !1,
                    o._twoSidedLighting = !1,
                    o._renderTargets = new e.SmartArray(16),
                    o._worldViewProjectionMatrix = e.Matrix.Zero(),
                    o._globalAmbientColor = new e.Color3(0,0,0),
                    o._attachImageProcessingConfiguration(null),
                    o.getRenderTargetTextures = function() {
                        return o._renderTargets.reset(),
                        i.ReflectionTextureEnabled && o._reflectionTexture && o._reflectionTexture.isRenderTarget && o._renderTargets.push(o._reflectionTexture),
                        i.RefractionTextureEnabled && o._refractionTexture && o._refractionTexture.isRenderTarget && o._renderTargets.push(o._refractionTexture),
                        o._renderTargets
                    }
                    ,
                    o
                }
                return o(i, r),
                Object.defineProperty(i.prototype, "imageProcessingConfiguration", {
                    get: function() {
                        return this._imageProcessingConfiguration
                    },
                    set: function(e) {
                        this._attachImageProcessingConfiguration(e),
                        this._markAllSubMeshesAsTexturesDirty()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype._attachImageProcessingConfiguration = function(e) {
                    var t = this;
                    e !== this._imageProcessingConfiguration && (this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),
                    this._imageProcessingConfiguration = e || this.getScene().imageProcessingConfiguration,
                    this._imageProcessingConfiguration && (this._imageProcessingObserver = this._imageProcessingConfiguration.onUpdateParameters.add((function(e) {
                        t._markAllSubMeshesAsImageProcessingDirty()
                    }
                    ))))
                }
                ,
                Object.defineProperty(i.prototype, "cameraColorCurvesEnabled", {
                    get: function() {
                        return this.imageProcessingConfiguration.colorCurvesEnabled
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorCurvesEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraColorGradingEnabled", {
                    get: function() {
                        return this.imageProcessingConfiguration.colorGradingEnabled
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorGradingEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraToneMappingEnabled", {
                    get: function() {
                        return this._imageProcessingConfiguration.toneMappingEnabled
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.toneMappingEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraExposure", {
                    get: function() {
                        return this._imageProcessingConfiguration.exposure
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.exposure = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraContrast", {
                    get: function() {
                        return this._imageProcessingConfiguration.contrast
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.contrast = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraColorGradingTexture", {
                    get: function() {
                        return this._imageProcessingConfiguration.colorGradingTexture
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.colorGradingTexture = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraColorCurves", {
                    get: function() {
                        return this._imageProcessingConfiguration.colorCurves
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.colorCurves = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "hasRenderTargetTextures", {
                    get: function() {
                        return !!(i.ReflectionTextureEnabled && this._reflectionTexture && this._reflectionTexture.isRenderTarget) || !!(i.RefractionTextureEnabled && this._refractionTexture && this._refractionTexture.isRenderTarget)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getClassName = function() {
                    return "StandardMaterial"
                }
                ,
                Object.defineProperty(i.prototype, "useLogarithmicDepth", {
                    get: function() {
                        return this._useLogarithmicDepth
                    },
                    set: function(e) {
                        this._useLogarithmicDepth = e && this.getScene().getEngine().getCaps().fragmentDepthSupported,
                        this._markAllSubMeshesAsMiscDirty()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.needAlphaBlending = function() {
                    return this.alpha < 1 || null != this._opacityTexture || this._shouldUseAlphaFromDiffuseTexture() || this._opacityFresnelParameters && this._opacityFresnelParameters.isEnabled
                }
                ,
                i.prototype.needAlphaTesting = function() {
                    return null != this._diffuseTexture && this._diffuseTexture.hasAlpha
                }
                ,
                i.prototype._shouldUseAlphaFromDiffuseTexture = function() {
                    return null != this._diffuseTexture && this._diffuseTexture.hasAlpha && this._useAlphaFromDiffuseTexture
                }
                ,
                i.prototype.getAlphaTestTexture = function() {
                    return this._diffuseTexture
                }
                ,
                i.prototype.isReadyForSubMesh = function(r, n, o) {
                    if (void 0 === o && (o = !1),
                    n.effect && this.isFrozen && this._wasPreviouslyReady)
                        return !0;
                    n._materialDefines || (n._materialDefines = new t);
                    var a = this.getScene()
                      , s = n._materialDefines;
                    if (!this.checkReadyOnEveryCall && n.effect && s._renderId === a.getRenderId())
                        return !0;
                    var y = a.getEngine();
                    if (s._needNormals = e.MaterialHelper.PrepareDefinesForLights(a, r, s, !0, this._maxSimultaneousLights, this._disableLighting),
                    s._areTexturesDirty) {
                        if (s._needUVs = !1,
                        s.MAINUV1 = !1,
                        s.MAINUV2 = !1,
                        a.texturesEnabled) {
                            if (this._diffuseTexture && i.DiffuseTextureEnabled) {
                                if (!this._diffuseTexture.isReadyOrNotBlocking())
                                    return !1;
                                e.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture, s, "DIFFUSE")
                            } else
                                s.DIFFUSE = !1;
                            if (this._ambientTexture && i.AmbientTextureEnabled) {
                                if (!this._ambientTexture.isReadyOrNotBlocking())
                                    return !1;
                                e.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture, s, "AMBIENT")
                            } else
                                s.AMBIENT = !1;
                            if (this._opacityTexture && i.OpacityTextureEnabled) {
                                if (!this._opacityTexture.isReadyOrNotBlocking())
                                    return !1;
                                e.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture, s, "OPACITY"),
                                s.OPACITYRGB = this._opacityTexture.getAlphaFromRGB
                            } else
                                s.OPACITY = !1;
                            if (this._reflectionTexture && i.ReflectionTextureEnabled) {
                                if (!this._reflectionTexture.isReadyOrNotBlocking())
                                    return !1;
                                switch (s._needNormals = !0,
                                s.REFLECTION = !0,
                                s.ROUGHNESS = this._roughness > 0,
                                s.REFLECTIONOVERALPHA = this._useReflectionOverAlpha,
                                s.INVERTCUBICMAP = this._reflectionTexture.coordinatesMode === e.Texture.INVCUBIC_MODE,
                                s.REFLECTIONMAP_3D = this._reflectionTexture.isCube,
                                this._reflectionTexture.coordinatesMode) {
                                case e.Texture.EXPLICIT_MODE:
                                    s.setReflectionMode("REFLECTIONMAP_EXPLICIT");
                                    break;
                                case e.Texture.PLANAR_MODE:
                                    s.setReflectionMode("REFLECTIONMAP_PLANAR");
                                    break;
                                case e.Texture.PROJECTION_MODE:
                                    s.setReflectionMode("REFLECTIONMAP_PROJECTION");
                                    break;
                                case e.Texture.SKYBOX_MODE:
                                    s.setReflectionMode("REFLECTIONMAP_SKYBOX"),
                                    s.REFLECTIONMAP_SKYBOX_TRANSFORMED = !this._reflectionTexture.getReflectionTextureMatrix().isIdentity();
                                    break;
                                case e.Texture.SPHERICAL_MODE:
                                    s.setReflectionMode("REFLECTIONMAP_SPHERICAL");
                                    break;
                                case e.Texture.EQUIRECTANGULAR_MODE:
                                    s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");
                                    break;
                                case e.Texture.FIXED_EQUIRECTANGULAR_MODE:
                                    s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");
                                    break;
                                case e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:
                                    s.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");
                                    break;
                                case e.Texture.CUBIC_MODE:
                                case e.Texture.INVCUBIC_MODE:
                                default:
                                    s.setReflectionMode("REFLECTIONMAP_CUBIC")
                                }
                                s.USE_LOCAL_REFLECTIONMAP_CUBIC = !!this._reflectionTexture.boundingBoxSize
                            } else
                                s.REFLECTION = !1;
                            if (this._emissiveTexture && i.EmissiveTextureEnabled) {
                                if (!this._emissiveTexture.isReadyOrNotBlocking())
                                    return !1;
                                e.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture, s, "EMISSIVE")
                            } else
                                s.EMISSIVE = !1;
                            if (this._lightmapTexture && i.LightmapTextureEnabled) {
                                if (!this._lightmapTexture.isReadyOrNotBlocking())
                                    return !1;
                                e.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture, s, "LIGHTMAP"),
                                s.USELIGHTMAPASSHADOWMAP = this._useLightmapAsShadowmap
                            } else
                                s.LIGHTMAP = !1;
                            if (this._specularTexture && i.SpecularTextureEnabled) {
                                if (!this._specularTexture.isReadyOrNotBlocking())
                                    return !1;
                                e.MaterialHelper.PrepareDefinesForMergedUV(this._specularTexture, s, "SPECULAR"),
                                s.GLOSSINESS = this._useGlossinessFromSpecularMapAlpha
                            } else
                                s.SPECULAR = !1;
                            if (a.getEngine().getCaps().standardDerivatives && this._bumpTexture && i.BumpTextureEnabled) {
                                if (!this._bumpTexture.isReady())
                                    return !1;
                                e.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture, s, "BUMP"),
                                s.PARALLAX = this._useParallax,
                                s.PARALLAXOCCLUSION = this._useParallaxOcclusion,
                                s.OBJECTSPACE_NORMALMAP = this._useObjectSpaceNormalMap
                            } else
                                s.BUMP = !1;
                            if (this._refractionTexture && i.RefractionTextureEnabled) {
                                if (!this._refractionTexture.isReadyOrNotBlocking())
                                    return !1;
                                s._needUVs = !0,
                                s.REFRACTION = !0,
                                s.REFRACTIONMAP_3D = this._refractionTexture.isCube
                            } else
                                s.REFRACTION = !1;
                            s.TWOSIDEDLIGHTING = !this._backFaceCulling && this._twoSidedLighting
                        } else
                            s.DIFFUSE = !1,
                            s.AMBIENT = !1,
                            s.OPACITY = !1,
                            s.REFLECTION = !1,
                            s.EMISSIVE = !1,
                            s.LIGHTMAP = !1,
                            s.BUMP = !1,
                            s.REFRACTION = !1;
                        s.ALPHAFROMDIFFUSE = this._shouldUseAlphaFromDiffuseTexture(),
                        s.EMISSIVEASILLUMINATION = this._useEmissiveAsIllumination,
                        s.LINKEMISSIVEWITHDIFFUSE = this._linkEmissiveWithDiffuse,
                        s.SPECULAROVERALPHA = this._useSpecularOverAlpha,
                        s.PREMULTIPLYALPHA = this.alphaMode === e.Engine.ALPHA_PREMULTIPLIED || this.alphaMode === e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF
                    }
                    if (s._areImageProcessingDirty && this._imageProcessingConfiguration) {
                        if (!this._imageProcessingConfiguration.isReady())
                            return !1;
                        this._imageProcessingConfiguration.prepareDefines(s),
                        s.IS_REFLECTION_LINEAR = null != this.reflectionTexture && !this.reflectionTexture.gammaSpace,
                        s.IS_REFRACTION_LINEAR = null != this.refractionTexture && !this.refractionTexture.gammaSpace
                    }
                    if (s._areFresnelDirty && (i.FresnelEnabled ? (this._diffuseFresnelParameters || this._opacityFresnelParameters || this._emissiveFresnelParameters || this._refractionFresnelParameters || this._reflectionFresnelParameters) && (s.DIFFUSEFRESNEL = this._diffuseFresnelParameters && this._diffuseFresnelParameters.isEnabled,
                    s.OPACITYFRESNEL = this._opacityFresnelParameters && this._opacityFresnelParameters.isEnabled,
                    s.REFLECTIONFRESNEL = this._reflectionFresnelParameters && this._reflectionFresnelParameters.isEnabled,
                    s.REFLECTIONFRESNELFROMSPECULAR = this._useReflectionFresnelFromSpecular,
                    s.REFRACTIONFRESNEL = this._refractionFresnelParameters && this._refractionFresnelParameters.isEnabled,
                    s.EMISSIVEFRESNEL = this._emissiveFresnelParameters && this._emissiveFresnelParameters.isEnabled,
                    s._needNormals = !0,
                    s.FRESNEL = !0) : s.FRESNEL = !1),
                    e.MaterialHelper.PrepareDefinesForMisc(r, a, this._useLogarithmicDepth, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(r), s),
                    e.MaterialHelper.PrepareDefinesForAttributes(r, s, !0, !0, !0),
                    e.MaterialHelper.PrepareDefinesForFrameBoundValues(a, y, s, o),
                    s.isDirty) {
                        s.markAsProcessed(),
                        a.resetCachedMaterial();
                        var l = new e.EffectFallbacks;
                        s.REFLECTION && l.addFallback(0, "REFLECTION"),
                        s.SPECULAR && l.addFallback(0, "SPECULAR"),
                        s.BUMP && l.addFallback(0, "BUMP"),
                        s.PARALLAX && l.addFallback(1, "PARALLAX"),
                        s.PARALLAXOCCLUSION && l.addFallback(0, "PARALLAXOCCLUSION"),
                        s.SPECULAROVERALPHA && l.addFallback(0, "SPECULAROVERALPHA"),
                        s.FOG && l.addFallback(1, "FOG"),
                        s.POINTSIZE && l.addFallback(0, "POINTSIZE"),
                        s.LOGARITHMICDEPTH && l.addFallback(0, "LOGARITHMICDEPTH"),
                        e.MaterialHelper.HandleFallbacksForShadows(s, l, this._maxSimultaneousLights),
                        s.SPECULARTERM && l.addFallback(0, "SPECULARTERM"),
                        s.DIFFUSEFRESNEL && l.addFallback(1, "DIFFUSEFRESNEL"),
                        s.OPACITYFRESNEL && l.addFallback(2, "OPACITYFRESNEL"),
                        s.REFLECTIONFRESNEL && l.addFallback(3, "REFLECTIONFRESNEL"),
                        s.EMISSIVEFRESNEL && l.addFallback(4, "EMISSIVEFRESNEL"),
                        s.FRESNEL && l.addFallback(4, "FRESNEL");
                        var c = [e.VertexBuffer.PositionKind];
                        s.NORMAL && c.push(e.VertexBuffer.NormalKind),
                        s.UV1 && c.push(e.VertexBuffer.UVKind),
                        s.UV2 && c.push(e.VertexBuffer.UV2Kind),
                        s.VERTEXCOLOR && c.push(e.VertexBuffer.ColorKind),
                        e.MaterialHelper.PrepareAttributesForBones(c, r, s, l),
                        e.MaterialHelper.PrepareAttributesForInstances(c, s),
                        e.MaterialHelper.PrepareAttributesForMorphTargets(c, r, s);
                        var h = "default"
                          , u = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vAmbientColor", "vDiffuseColor", "vSpecularColor", "vEmissiveColor", "vFogInfos", "vFogColor", "pointSize", "vDiffuseInfos", "vAmbientInfos", "vOpacityInfos", "vReflectionInfos", "vEmissiveInfos", "vSpecularInfos", "vBumpInfos", "vLightmapInfos", "vRefractionInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "diffuseMatrix", "ambientMatrix", "opacityMatrix", "reflectionMatrix", "emissiveMatrix", "specularMatrix", "bumpMatrix", "normalMatrix", "lightmapMatrix", "refractionMatrix", "diffuseLeftColor", "diffuseRightColor", "opacityParts", "reflectionLeftColor", "reflectionRightColor", "emissiveLeftColor", "emissiveRightColor", "refractionLeftColor", "refractionRightColor", "vReflectionPosition", "vReflectionSize", "logarithmicDepthConstant", "vTangentSpaceParams", "alphaCutOff"]
                          , d = ["diffuseSampler", "ambientSampler", "opacitySampler", "reflectionCubeSampler", "reflection2DSampler", "emissiveSampler", "specularSampler", "bumpSampler", "lightmapSampler", "refractionCubeSampler", "refraction2DSampler"]
                          , x = ["Material", "Scene"];
                        e.ImageProcessingConfiguration && (e.ImageProcessingConfiguration.PrepareUniforms(u, s),
                        e.ImageProcessingConfiguration.PrepareSamplers(d, s)),
                        e.MaterialHelper.PrepareUniformsAndSamplersList({
                            uniformsNames: u,
                            uniformBuffersNames: x,
                            samplers: d,
                            defines: s,
                            maxSimultaneousLights: this._maxSimultaneousLights
                        }),
                        this.customShaderNameResolve && (h = this.customShaderNameResolve(h, u, x, d, s));
                        var p = s.toString();
                        n.setEffect(a.getEngine().createEffect(h, {
                            attributes: c,
                            uniformsNames: u,
                            uniformBuffersNames: x,
                            samplers: d,
                            defines: p,
                            fallbacks: l,
                            onCompiled: this.onCompiled,
                            onError: this.onError,
                            indexParameters: {
                                maxSimultaneousLights: this._maxSimultaneousLights,
                                maxSimultaneousMorphTargets: s.NUM_MORPH_INFLUENCERS
                            }
                        }, y), s),
                        this.buildUniformLayout()
                    }
                    return !(!n.effect || !n.effect.isReady()) && (s._renderId = a.getRenderId(),
                    this._wasPreviouslyReady = !0,
                    !0)
                }
                ,
                i.prototype.buildUniformLayout = function() {
                    this._uniformBuffer.addUniform("diffuseLeftColor", 4),
                    this._uniformBuffer.addUniform("diffuseRightColor", 4),
                    this._uniformBuffer.addUniform("opacityParts", 4),
                    this._uniformBuffer.addUniform("reflectionLeftColor", 4),
                    this._uniformBuffer.addUniform("reflectionRightColor", 4),
                    this._uniformBuffer.addUniform("refractionLeftColor", 4),
                    this._uniformBuffer.addUniform("refractionRightColor", 4),
                    this._uniformBuffer.addUniform("emissiveLeftColor", 4),
                    this._uniformBuffer.addUniform("emissiveRightColor", 4),
                    this._uniformBuffer.addUniform("vDiffuseInfos", 2),
                    this._uniformBuffer.addUniform("vAmbientInfos", 2),
                    this._uniformBuffer.addUniform("vOpacityInfos", 2),
                    this._uniformBuffer.addUniform("vReflectionInfos", 2),
                    this._uniformBuffer.addUniform("vReflectionPosition", 3),
                    this._uniformBuffer.addUniform("vReflectionSize", 3),
                    this._uniformBuffer.addUniform("vEmissiveInfos", 2),
                    this._uniformBuffer.addUniform("vLightmapInfos", 2),
                    this._uniformBuffer.addUniform("vSpecularInfos", 2),
                    this._uniformBuffer.addUniform("vBumpInfos", 3),
                    this._uniformBuffer.addUniform("diffuseMatrix", 16),
                    this._uniformBuffer.addUniform("ambientMatrix", 16),
                    this._uniformBuffer.addUniform("opacityMatrix", 16),
                    this._uniformBuffer.addUniform("reflectionMatrix", 16),
                    this._uniformBuffer.addUniform("emissiveMatrix", 16),
                    this._uniformBuffer.addUniform("lightmapMatrix", 16),
                    this._uniformBuffer.addUniform("specularMatrix", 16),
                    this._uniformBuffer.addUniform("bumpMatrix", 16),
                    this._uniformBuffer.addUniform("vTangentSpaceParams", 2),
                    this._uniformBuffer.addUniform("refractionMatrix", 16),
                    this._uniformBuffer.addUniform("vRefractionInfos", 4),
                    this._uniformBuffer.addUniform("vSpecularColor", 4),
                    this._uniformBuffer.addUniform("vEmissiveColor", 3),
                    this._uniformBuffer.addUniform("vDiffuseColor", 4),
                    this._uniformBuffer.addUniform("pointSize", 1),
                    this._uniformBuffer.create()
                }
                ,
                i.prototype.unbind = function() {
                    if (this._activeEffect) {
                        var e = !1;
                        this._reflectionTexture && this._reflectionTexture.isRenderTarget && (this._activeEffect.setTexture("reflection2DSampler", null),
                        e = !0),
                        this._refractionTexture && this._refractionTexture.isRenderTarget && (this._activeEffect.setTexture("refraction2DSampler", null),
                        e = !0),
                        e && this._markAllSubMeshesAsTexturesDirty()
                    }
                    r.prototype.unbind.call(this)
                }
                ,
                i.prototype.bindForSubMesh = function(t, r, n) {
                    var o = this.getScene()
                      , a = n._materialDefines;
                    if (a) {
                        var s = n.effect;
                        if (s) {
                            this._activeEffect = s,
                            this.bindOnlyWorldMatrix(t),
                            a.OBJECTSPACE_NORMALMAP && (t.toNormalMatrix(this._normalMatrix),
                            this.bindOnlyNormalMatrix(this._normalMatrix));
                            var y = this._mustRebind(o, s, r.visibility);
                            if (e.MaterialHelper.BindBonesParameters(r, s),
                            y) {
                                if (this._uniformBuffer.bindToEffect(s, "Material"),
                                this.bindViewProjection(s),
                                !this._uniformBuffer.useUbo || !this.isFrozen || !this._uniformBuffer.isSync) {
                                    if (i.FresnelEnabled && a.FRESNEL && (this.diffuseFresnelParameters && this.diffuseFresnelParameters.isEnabled && (this._uniformBuffer.updateColor4("diffuseLeftColor", this.diffuseFresnelParameters.leftColor, this.diffuseFresnelParameters.power),
                                    this._uniformBuffer.updateColor4("diffuseRightColor", this.diffuseFresnelParameters.rightColor, this.diffuseFresnelParameters.bias)),
                                    this.opacityFresnelParameters && this.opacityFresnelParameters.isEnabled && this._uniformBuffer.updateColor4("opacityParts", new e.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias), this.opacityFresnelParameters.power),
                                    this.reflectionFresnelParameters && this.reflectionFresnelParameters.isEnabled && (this._uniformBuffer.updateColor4("reflectionLeftColor", this.reflectionFresnelParameters.leftColor, this.reflectionFresnelParameters.power),
                                    this._uniformBuffer.updateColor4("reflectionRightColor", this.reflectionFresnelParameters.rightColor, this.reflectionFresnelParameters.bias)),
                                    this.refractionFresnelParameters && this.refractionFresnelParameters.isEnabled && (this._uniformBuffer.updateColor4("refractionLeftColor", this.refractionFresnelParameters.leftColor, this.refractionFresnelParameters.power),
                                    this._uniformBuffer.updateColor4("refractionRightColor", this.refractionFresnelParameters.rightColor, this.refractionFresnelParameters.bias)),
                                    this.emissiveFresnelParameters && this.emissiveFresnelParameters.isEnabled && (this._uniformBuffer.updateColor4("emissiveLeftColor", this.emissiveFresnelParameters.leftColor, this.emissiveFresnelParameters.power),
                                    this._uniformBuffer.updateColor4("emissiveRightColor", this.emissiveFresnelParameters.rightColor, this.emissiveFresnelParameters.bias))),
                                    o.texturesEnabled) {
                                        if (this._diffuseTexture && i.DiffuseTextureEnabled && (this._uniformBuffer.updateFloat2("vDiffuseInfos", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level),
                                        e.MaterialHelper.BindTextureMatrix(this._diffuseTexture, this._uniformBuffer, "diffuse"),
                                        this._diffuseTexture.hasAlpha && s.setFloat("alphaCutOff", this.alphaCutOff)),
                                        this._ambientTexture && i.AmbientTextureEnabled && (this._uniformBuffer.updateFloat2("vAmbientInfos", this._ambientTexture.coordinatesIndex, this._ambientTexture.level),
                                        e.MaterialHelper.BindTextureMatrix(this._ambientTexture, this._uniformBuffer, "ambient")),
                                        this._opacityTexture && i.OpacityTextureEnabled && (this._uniformBuffer.updateFloat2("vOpacityInfos", this._opacityTexture.coordinatesIndex, this._opacityTexture.level),
                                        e.MaterialHelper.BindTextureMatrix(this._opacityTexture, this._uniformBuffer, "opacity")),
                                        this._reflectionTexture && i.ReflectionTextureEnabled && (this._uniformBuffer.updateFloat2("vReflectionInfos", this._reflectionTexture.level, this.roughness),
                                        this._uniformBuffer.updateMatrix("reflectionMatrix", this._reflectionTexture.getReflectionTextureMatrix()),
                                        this._reflectionTexture.boundingBoxSize)) {
                                            var l = this._reflectionTexture;
                                            this._uniformBuffer.updateVector3("vReflectionPosition", l.boundingBoxPosition),
                                            this._uniformBuffer.updateVector3("vReflectionSize", l.boundingBoxSize)
                                        }
                                        if (this._emissiveTexture && i.EmissiveTextureEnabled && (this._uniformBuffer.updateFloat2("vEmissiveInfos", this._emissiveTexture.coordinatesIndex, this._emissiveTexture.level),
                                        e.MaterialHelper.BindTextureMatrix(this._emissiveTexture, this._uniformBuffer, "emissive")),
                                        this._lightmapTexture && i.LightmapTextureEnabled && (this._uniformBuffer.updateFloat2("vLightmapInfos", this._lightmapTexture.coordinatesIndex, this._lightmapTexture.level),
                                        e.MaterialHelper.BindTextureMatrix(this._lightmapTexture, this._uniformBuffer, "lightmap")),
                                        this._specularTexture && i.SpecularTextureEnabled && (this._uniformBuffer.updateFloat2("vSpecularInfos", this._specularTexture.coordinatesIndex, this._specularTexture.level),
                                        e.MaterialHelper.BindTextureMatrix(this._specularTexture, this._uniformBuffer, "specular")),
                                        this._bumpTexture && o.getEngine().getCaps().standardDerivatives && i.BumpTextureEnabled && (this._uniformBuffer.updateFloat3("vBumpInfos", this._bumpTexture.coordinatesIndex, 1 / this._bumpTexture.level, this.parallaxScaleBias),
                                        e.MaterialHelper.BindTextureMatrix(this._bumpTexture, this._uniformBuffer, "bump"),
                                        o._mirroredCameraPosition ? this._uniformBuffer.updateFloat2("vTangentSpaceParams", this._invertNormalMapX ? 1 : -1, this._invertNormalMapY ? 1 : -1) : this._uniformBuffer.updateFloat2("vTangentSpaceParams", this._invertNormalMapX ? -1 : 1, this._invertNormalMapY ? -1 : 1)),
                                        this._refractionTexture && i.RefractionTextureEnabled) {
                                            var c = 1;
                                            this._refractionTexture.isCube || (this._uniformBuffer.updateMatrix("refractionMatrix", this._refractionTexture.getReflectionTextureMatrix()),
                                            this._refractionTexture.depth && (c = this._refractionTexture.depth)),
                                            this._uniformBuffer.updateFloat4("vRefractionInfos", this._refractionTexture.level, this.indexOfRefraction, c, this.invertRefractionY ? -1 : 1)
                                        }
                                    }
                                    this.pointsCloud && this._uniformBuffer.updateFloat("pointSize", this.pointSize),
                                    a.SPECULARTERM && this._uniformBuffer.updateColor4("vSpecularColor", this.specularColor, this.specularPower),
                                    this._uniformBuffer.updateColor3("vEmissiveColor", this.emissiveColor),
                                    this._uniformBuffer.updateColor4("vDiffuseColor", this.diffuseColor, this.alpha * r.visibility)
                                }
                                if (o.texturesEnabled && (this._diffuseTexture && i.DiffuseTextureEnabled && s.setTexture("diffuseSampler", this._diffuseTexture),
                                this._ambientTexture && i.AmbientTextureEnabled && s.setTexture("ambientSampler", this._ambientTexture),
                                this._opacityTexture && i.OpacityTextureEnabled && s.setTexture("opacitySampler", this._opacityTexture),
                                this._reflectionTexture && i.ReflectionTextureEnabled && (this._reflectionTexture.isCube ? s.setTexture("reflectionCubeSampler", this._reflectionTexture) : s.setTexture("reflection2DSampler", this._reflectionTexture)),
                                this._emissiveTexture && i.EmissiveTextureEnabled && s.setTexture("emissiveSampler", this._emissiveTexture),
                                this._lightmapTexture && i.LightmapTextureEnabled && s.setTexture("lightmapSampler", this._lightmapTexture),
                                this._specularTexture && i.SpecularTextureEnabled && s.setTexture("specularSampler", this._specularTexture),
                                this._bumpTexture && o.getEngine().getCaps().standardDerivatives && i.BumpTextureEnabled && s.setTexture("bumpSampler", this._bumpTexture),
                                this._refractionTexture && i.RefractionTextureEnabled)) {
                                    c = 1;
                                    this._refractionTexture.isCube ? s.setTexture("refractionCubeSampler", this._refractionTexture) : s.setTexture("refraction2DSampler", this._refractionTexture)
                                }
                                e.MaterialHelper.BindClipPlane(s, o),
                                o.ambientColor.multiplyToRef(this.ambientColor, this._globalAmbientColor),
                                e.MaterialHelper.BindEyePosition(s, o),
                                s.setColor3("vAmbientColor", this._globalAmbientColor)
                            }
                            !y && this.isFrozen || (o.lightsEnabled && !this._disableLighting && e.MaterialHelper.BindLights(o, r, s, a, this._maxSimultaneousLights),
                            (o.fogEnabled && r.applyFog && o.fogMode !== e.Scene.FOGMODE_NONE || this._reflectionTexture || this._refractionTexture) && this.bindView(s),
                            e.MaterialHelper.BindFogParameters(o, r, s),
                            a.NUM_MORPH_INFLUENCERS && e.MaterialHelper.BindMorphTargetParameters(r, s),
                            e.MaterialHelper.BindLogDepth(a, s, o),
                            this._imageProcessingConfiguration && !this._imageProcessingConfiguration.applyByPostProcess && this._imageProcessingConfiguration.bind(this._activeEffect)),
                            this._uniformBuffer.update(),
                            this._afterBind(r, this._activeEffect)
                        }
                    }
                }
                ,
                i.prototype.getAnimatables = function() {
                    var e = [];
                    return this._diffuseTexture && this._diffuseTexture.animations && this._diffuseTexture.animations.length > 0 && e.push(this._diffuseTexture),
                    this._ambientTexture && this._ambientTexture.animations && this._ambientTexture.animations.length > 0 && e.push(this._ambientTexture),
                    this._opacityTexture && this._opacityTexture.animations && this._opacityTexture.animations.length > 0 && e.push(this._opacityTexture),
                    this._reflectionTexture && this._reflectionTexture.animations && this._reflectionTexture.animations.length > 0 && e.push(this._reflectionTexture),
                    this._emissiveTexture && this._emissiveTexture.animations && this._emissiveTexture.animations.length > 0 && e.push(this._emissiveTexture),
                    this._specularTexture && this._specularTexture.animations && this._specularTexture.animations.length > 0 && e.push(this._specularTexture),
                    this._bumpTexture && this._bumpTexture.animations && this._bumpTexture.animations.length > 0 && e.push(this._bumpTexture),
                    this._lightmapTexture && this._lightmapTexture.animations && this._lightmapTexture.animations.length > 0 && e.push(this._lightmapTexture),
                    this._refractionTexture && this._refractionTexture.animations && this._refractionTexture.animations.length > 0 && e.push(this._refractionTexture),
                    e
                }
                ,
                i.prototype.getActiveTextures = function() {
                    var e = r.prototype.getActiveTextures.call(this);
                    return this._diffuseTexture && e.push(this._diffuseTexture),
                    this._ambientTexture && e.push(this._ambientTexture),
                    this._opacityTexture && e.push(this._opacityTexture),
                    this._reflectionTexture && e.push(this._reflectionTexture),
                    this._emissiveTexture && e.push(this._emissiveTexture),
                    this._specularTexture && e.push(this._specularTexture),
                    this._bumpTexture && e.push(this._bumpTexture),
                    this._lightmapTexture && e.push(this._lightmapTexture),
                    this._refractionTexture && e.push(this._refractionTexture),
                    e
                }
                ,
                i.prototype.hasTexture = function(e) {
                    return !!r.prototype.hasTexture.call(this, e) || (this._diffuseTexture === e || (this._ambientTexture === e || (this._opacityTexture === e || (this._reflectionTexture === e || (this._emissiveTexture === e || (this._specularTexture === e || (this._bumpTexture === e || (this._lightmapTexture === e || this._refractionTexture === e))))))))
                }
                ,
                i.prototype.dispose = function(e, t) {
                    t && (this._diffuseTexture && this._diffuseTexture.dispose(),
                    this._ambientTexture && this._ambientTexture.dispose(),
                    this._opacityTexture && this._opacityTexture.dispose(),
                    this._reflectionTexture && this._reflectionTexture.dispose(),
                    this._emissiveTexture && this._emissiveTexture.dispose(),
                    this._specularTexture && this._specularTexture.dispose(),
                    this._bumpTexture && this._bumpTexture.dispose(),
                    this._lightmapTexture && this._lightmapTexture.dispose(),
                    this._refractionTexture && this._refractionTexture.dispose()),
                    this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),
                    r.prototype.dispose.call(this, e, t)
                }
                ,
                i.prototype.clone = function(t) {
                    var r = this
                      , n = e.SerializationHelper.Clone((function() {
                        return new i(t,r.getScene())
                    }
                    ), this);
                    return n.name = t,
                    n.id = t,
                    n
                }
                ,
                i.prototype.serialize = function() {
                    return e.SerializationHelper.Serialize(this)
                }
                ,
                i.Parse = function(t, r, n) {
                    return e.SerializationHelper.Parse((function() {
                        return new i(t.name,r)
                    }
                    ), t, r, n)
                }
                ,
                Object.defineProperty(i, "DiffuseTextureEnabled", {
                    get: function() {
                        return i._DiffuseTextureEnabled
                    },
                    set: function(t) {
                        i._DiffuseTextureEnabled !== t && (i._DiffuseTextureEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "AmbientTextureEnabled", {
                    get: function() {
                        return i._AmbientTextureEnabled
                    },
                    set: function(t) {
                        i._AmbientTextureEnabled !== t && (i._AmbientTextureEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "OpacityTextureEnabled", {
                    get: function() {
                        return i._OpacityTextureEnabled
                    },
                    set: function(t) {
                        i._OpacityTextureEnabled !== t && (i._OpacityTextureEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "ReflectionTextureEnabled", {
                    get: function() {
                        return i._ReflectionTextureEnabled
                    },
                    set: function(t) {
                        i._ReflectionTextureEnabled !== t && (i._ReflectionTextureEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "EmissiveTextureEnabled", {
                    get: function() {
                        return i._EmissiveTextureEnabled
                    },
                    set: function(t) {
                        i._EmissiveTextureEnabled !== t && (i._EmissiveTextureEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "SpecularTextureEnabled", {
                    get: function() {
                        return i._SpecularTextureEnabled
                    },
                    set: function(t) {
                        i._SpecularTextureEnabled !== t && (i._SpecularTextureEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "BumpTextureEnabled", {
                    get: function() {
                        return i._BumpTextureEnabled
                    },
                    set: function(t) {
                        i._BumpTextureEnabled !== t && (i._BumpTextureEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "LightmapTextureEnabled", {
                    get: function() {
                        return i._LightmapTextureEnabled
                    },
                    set: function(t) {
                        i._LightmapTextureEnabled !== t && (i._LightmapTextureEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "RefractionTextureEnabled", {
                    get: function() {
                        return i._RefractionTextureEnabled
                    },
                    set: function(t) {
                        i._RefractionTextureEnabled !== t && (i._RefractionTextureEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "ColorGradingTextureEnabled", {
                    get: function() {
                        return i._ColorGradingTextureEnabled
                    },
                    set: function(t) {
                        i._ColorGradingTextureEnabled !== t && (i._ColorGradingTextureEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i, "FresnelEnabled", {
                    get: function() {
                        return i._FresnelEnabled
                    },
                    set: function(t) {
                        i._FresnelEnabled !== t && (i._FresnelEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.FresnelDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i._DiffuseTextureEnabled = !0,
                i._AmbientTextureEnabled = !0,
                i._OpacityTextureEnabled = !0,
                i._ReflectionTextureEnabled = !0,
                i._EmissiveTextureEnabled = !0,
                i._SpecularTextureEnabled = !0,
                i._BumpTextureEnabled = !0,
                i._LightmapTextureEnabled = !0,
                i._RefractionTextureEnabled = !0,
                i._ColorGradingTextureEnabled = !0,
                i._FresnelEnabled = !0,
                n([e.serializeAsTexture("diffuseTexture")], i.prototype, "_diffuseTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], i.prototype, "diffuseTexture", void 0),
                n([e.serializeAsTexture("ambientTexture")], i.prototype, "_ambientTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "ambientTexture", void 0),
                n([e.serializeAsTexture("opacityTexture")], i.prototype, "_opacityTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], i.prototype, "opacityTexture", void 0),
                n([e.serializeAsTexture("reflectionTexture")], i.prototype, "_reflectionTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "reflectionTexture", void 0),
                n([e.serializeAsTexture("emissiveTexture")], i.prototype, "_emissiveTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "emissiveTexture", void 0),
                n([e.serializeAsTexture("specularTexture")], i.prototype, "_specularTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "specularTexture", void 0),
                n([e.serializeAsTexture("bumpTexture")], i.prototype, "_bumpTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "bumpTexture", void 0),
                n([e.serializeAsTexture("lightmapTexture")], i.prototype, "_lightmapTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "lightmapTexture", void 0),
                n([e.serializeAsTexture("refractionTexture")], i.prototype, "_refractionTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "refractionTexture", void 0),
                n([e.serializeAsColor3("ambient")], i.prototype, "ambientColor", void 0),
                n([e.serializeAsColor3("diffuse")], i.prototype, "diffuseColor", void 0),
                n([e.serializeAsColor3("specular")], i.prototype, "specularColor", void 0),
                n([e.serializeAsColor3("emissive")], i.prototype, "emissiveColor", void 0),
                n([e.serialize()], i.prototype, "specularPower", void 0),
                n([e.serialize("useAlphaFromDiffuseTexture")], i.prototype, "_useAlphaFromDiffuseTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "useAlphaFromDiffuseTexture", void 0),
                n([e.serialize("useEmissiveAsIllumination")], i.prototype, "_useEmissiveAsIllumination", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "useEmissiveAsIllumination", void 0),
                n([e.serialize("linkEmissiveWithDiffuse")], i.prototype, "_linkEmissiveWithDiffuse", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "linkEmissiveWithDiffuse", void 0),
                n([e.serialize("useSpecularOverAlpha")], i.prototype, "_useSpecularOverAlpha", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "useSpecularOverAlpha", void 0),
                n([e.serialize("useReflectionOverAlpha")], i.prototype, "_useReflectionOverAlpha", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "useReflectionOverAlpha", void 0),
                n([e.serialize("disableLighting")], i.prototype, "_disableLighting", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")], i.prototype, "disableLighting", void 0),
                n([e.serialize("useObjectSpaceNormalMap")], i.prototype, "_useObjectSpaceNormalMap", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "useObjectSpaceNormalMap", void 0),
                n([e.serialize("useParallax")], i.prototype, "_useParallax", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "useParallax", void 0),
                n([e.serialize("useParallaxOcclusion")], i.prototype, "_useParallaxOcclusion", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "useParallaxOcclusion", void 0),
                n([e.serialize()], i.prototype, "parallaxScaleBias", void 0),
                n([e.serialize("roughness")], i.prototype, "_roughness", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "roughness", void 0),
                n([e.serialize()], i.prototype, "indexOfRefraction", void 0),
                n([e.serialize()], i.prototype, "invertRefractionY", void 0),
                n([e.serialize()], i.prototype, "alphaCutOff", void 0),
                n([e.serialize("useLightmapAsShadowmap")], i.prototype, "_useLightmapAsShadowmap", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "useLightmapAsShadowmap", void 0),
                n([e.serializeAsFresnelParameters("diffuseFresnelParameters")], i.prototype, "_diffuseFresnelParameters", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")], i.prototype, "diffuseFresnelParameters", void 0),
                n([e.serializeAsFresnelParameters("opacityFresnelParameters")], i.prototype, "_opacityFresnelParameters", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsFresnelAndMiscDirty")], i.prototype, "opacityFresnelParameters", void 0),
                n([e.serializeAsFresnelParameters("reflectionFresnelParameters")], i.prototype, "_reflectionFresnelParameters", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")], i.prototype, "reflectionFresnelParameters", void 0),
                n([e.serializeAsFresnelParameters("refractionFresnelParameters")], i.prototype, "_refractionFresnelParameters", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")], i.prototype, "refractionFresnelParameters", void 0),
                n([e.serializeAsFresnelParameters("emissiveFresnelParameters")], i.prototype, "_emissiveFresnelParameters", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")], i.prototype, "emissiveFresnelParameters", void 0),
                n([e.serialize("useReflectionFresnelFromSpecular")], i.prototype, "_useReflectionFresnelFromSpecular", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")], i.prototype, "useReflectionFresnelFromSpecular", void 0),
                n([e.serialize("useGlossinessFromSpecularMapAlpha")], i.prototype, "_useGlossinessFromSpecularMapAlpha", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "useGlossinessFromSpecularMapAlpha", void 0),
                n([e.serialize("maxSimultaneousLights")], i.prototype, "_maxSimultaneousLights", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")], i.prototype, "maxSimultaneousLights", void 0),
                n([e.serialize("invertNormalMapX")], i.prototype, "_invertNormalMapX", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "invertNormalMapX", void 0),
                n([e.serialize("invertNormalMapY")], i.prototype, "_invertNormalMapY", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "invertNormalMapY", void 0),
                n([e.serialize("twoSidedLighting")], i.prototype, "_twoSidedLighting", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "twoSidedLighting", void 0),
                n([e.serialize()], i.prototype, "useLogarithmicDepth", null),
                i
            }(e.PushMaterial);
            e.StandardMaterial = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.x = e.Vector3.Zero(),
                    this.y = e.Vector3.Zero(),
                    this.z = e.Vector3.Zero(),
                    this.xx = e.Vector3.Zero(),
                    this.yy = e.Vector3.Zero(),
                    this.zz = e.Vector3.Zero(),
                    this.xy = e.Vector3.Zero(),
                    this.yz = e.Vector3.Zero(),
                    this.zx = e.Vector3.Zero()
                }
                return t.prototype.addAmbient = function(t) {
                    var r = new e.Vector3(t.r,t.g,t.b);
                    this.xx = this.xx.add(r),
                    this.yy = this.yy.add(r),
                    this.zz = this.zz.add(r)
                }
                ,
                t.prototype.scale = function(e) {
                    this.x = this.x.scale(e),
                    this.y = this.y.scale(e),
                    this.z = this.z.scale(e),
                    this.xx = this.xx.scale(e),
                    this.yy = this.yy.scale(e),
                    this.zz = this.zz.scale(e),
                    this.yz = this.yz.scale(e),
                    this.zx = this.zx.scale(e),
                    this.xy = this.xy.scale(e)
                }
                ,
                t.FromHarmonics = function(e) {
                    var r = new t;
                    return r.x = e.l11.scale(1.02333),
                    r.y = e.l1_1.scale(1.02333),
                    r.z = e.l10.scale(1.02333),
                    r.xx = e.l00.scale(.886277).subtract(e.l20.scale(.247708)).add(e.lL22.scale(.429043)),
                    r.yy = e.l00.scale(.886277).subtract(e.l20.scale(.247708)).subtract(e.lL22.scale(.429043)),
                    r.zz = e.l00.scale(.886277).add(e.l20.scale(.495417)),
                    r.yz = e.l2_1.scale(.858086),
                    r.zx = e.l21.scale(.858086),
                    r.xy = e.l2_2.scale(.858086),
                    r.scale(1 / Math.PI),
                    r
                }
                ,
                t.FromArray = function(r) {
                    var i = new t;
                    return e.Vector3.FromArrayToRef(r[0], 0, i.x),
                    e.Vector3.FromArrayToRef(r[1], 0, i.y),
                    e.Vector3.FromArrayToRef(r[2], 0, i.z),
                    e.Vector3.FromArrayToRef(r[3], 0, i.xx),
                    e.Vector3.FromArrayToRef(r[4], 0, i.yy),
                    e.Vector3.FromArrayToRef(r[5], 0, i.zz),
                    e.Vector3.FromArrayToRef(r[6], 0, i.yz),
                    e.Vector3.FromArrayToRef(r[7], 0, i.zx),
                    e.Vector3.FromArrayToRef(r[8], 0, i.xy),
                    i
                }
                ,
                t
            }();
            e.SphericalPolynomial = t;
            var r = function() {
                function t() {
                    this.l00 = e.Vector3.Zero(),
                    this.l1_1 = e.Vector3.Zero(),
                    this.l10 = e.Vector3.Zero(),
                    this.l11 = e.Vector3.Zero(),
                    this.l2_2 = e.Vector3.Zero(),
                    this.l2_1 = e.Vector3.Zero(),
                    this.l20 = e.Vector3.Zero(),
                    this.l21 = e.Vector3.Zero(),
                    this.lL22 = e.Vector3.Zero()
                }
                return t.prototype.addLight = function(t, r, i) {
                    var n = new e.Vector3(r.r,r.g,r.b).scale(i);
                    this.l00 = this.l00.add(n.scale(.282095)),
                    this.l1_1 = this.l1_1.add(n.scale(.488603 * t.y)),
                    this.l10 = this.l10.add(n.scale(.488603 * t.z)),
                    this.l11 = this.l11.add(n.scale(.488603 * t.x)),
                    this.l2_2 = this.l2_2.add(n.scale(1.092548 * t.x * t.y)),
                    this.l2_1 = this.l2_1.add(n.scale(1.092548 * t.y * t.z)),
                    this.l21 = this.l21.add(n.scale(1.092548 * t.x * t.z)),
                    this.l20 = this.l20.add(n.scale(.315392 * (3 * t.z * t.z - 1))),
                    this.lL22 = this.lL22.add(n.scale(.546274 * (t.x * t.x - t.y * t.y)))
                }
                ,
                t.prototype.scale = function(e) {
                    this.l00 = this.l00.scale(e),
                    this.l1_1 = this.l1_1.scale(e),
                    this.l10 = this.l10.scale(e),
                    this.l11 = this.l11.scale(e),
                    this.l2_2 = this.l2_2.scale(e),
                    this.l2_1 = this.l2_1.scale(e),
                    this.l20 = this.l20.scale(e),
                    this.l21 = this.l21.scale(e),
                    this.lL22 = this.lL22.scale(e)
                }
                ,
                t.prototype.convertIncidentRadianceToIrradiance = function() {
                    this.l00 = this.l00.scale(3.141593),
                    this.l1_1 = this.l1_1.scale(2.094395),
                    this.l10 = this.l10.scale(2.094395),
                    this.l11 = this.l11.scale(2.094395),
                    this.l2_2 = this.l2_2.scale(.785398),
                    this.l2_1 = this.l2_1.scale(.785398),
                    this.l20 = this.l20.scale(.785398),
                    this.l21 = this.l21.scale(.785398),
                    this.lL22 = this.lL22.scale(.785398)
                }
                ,
                t.prototype.convertIrradianceToLambertianRadiance = function() {
                    this.scale(1 / Math.PI)
                }
                ,
                t.FromPolynomial = function(e) {
                    var r = new t;
                    return r.l00 = e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)),
                    r.l1_1 = e.y.scale(.977204),
                    r.l10 = e.z.scale(.977204),
                    r.l11 = e.x.scale(.977204),
                    r.l2_2 = e.xy.scale(1.16538),
                    r.l2_1 = e.yz.scale(1.16538),
                    r.l20 = e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)),
                    r.l21 = e.zx.scale(1.16538),
                    r.lL22 = e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)),
                    r.scale(Math.PI),
                    r
                }
                ,
                t.FromArray = function(r) {
                    var i = new t;
                    return e.Vector3.FromArrayToRef(r[0], 0, i.l00),
                    e.Vector3.FromArrayToRef(r[1], 0, i.l1_1),
                    e.Vector3.FromArrayToRef(r[2], 0, i.l10),
                    e.Vector3.FromArrayToRef(r[3], 0, i.l11),
                    e.Vector3.FromArrayToRef(r[4], 0, i.l2_2),
                    e.Vector3.FromArrayToRef(r[5], 0, i.l2_1),
                    e.Vector3.FromArrayToRef(r[6], 0, i.l20),
                    e.Vector3.FromArrayToRef(r[7], 0, i.l21),
                    e.Vector3.FromArrayToRef(r[8], 0, i.lL22),
                    i
                }
                ,
                t
            }();
            e.SphericalHarmonics = r
        }(s || (s = {})),
        function(e) {
            var t = function(e, t, r, i) {
                this.name = e,
                this.worldAxisForNormal = t,
                this.worldAxisForFileX = r,
                this.worldAxisForFileY = i
            }
              , r = function() {
                function r() {}
                return r.ConvertCubeMapTextureToSphericalPolynomial = function(t) {
                    if (!t.isCube)
                        return null;
                    var r, i, n = t.getSize().width, o = t.readPixels(0), a = t.readPixels(1);
                    t.isRenderTarget ? (r = t.readPixels(3),
                    i = t.readPixels(2)) : (r = t.readPixels(2),
                    i = t.readPixels(3));
                    var s = t.readPixels(4)
                      , y = t.readPixels(5)
                      , l = t.gammaSpace
                      , c = e.Engine.TEXTUREFORMAT_RGBA
                      , h = e.Engine.TEXTURETYPE_UNSIGNED_INT;
                    t.textureType && t.textureType !== e.Engine.TEXTURETYPE_UNSIGNED_INT && (h = e.Engine.TEXTURETYPE_FLOAT);
                    var u = {
                        size: n,
                        right: o,
                        left: a,
                        up: r,
                        down: i,
                        front: s,
                        back: y,
                        format: c,
                        type: h,
                        gammaSpace: l
                    };
                    return this.ConvertCubeMapToSphericalPolynomial(u)
                }
                ,
                r.ConvertCubeMapToSphericalPolynomial = function(t) {
                    for (var r = new e.SphericalHarmonics, i = 0, n = 2 / t.size, o = n, a = .5 * n - 1, s = 0; s < 6; s++)
                        for (var y = this.FileFaces[s], l = t[y.name], c = a, h = t.format === e.Engine.TEXTUREFORMAT_RGBA ? 4 : 3, u = 0; u < t.size; u++) {
                            for (var d = a, x = 0; x < t.size; x++) {
                                var p = y.worldAxisForFileX.scale(d).add(y.worldAxisForFileY.scale(c)).add(y.worldAxisForNormal);
                                p.normalize();
                                var f = Math.pow(1 + d * d + c * c, -1.5)
                                  , m = l[u * t.size * h + x * h + 0]
                                  , z = l[u * t.size * h + x * h + 1]
                                  , _ = l[u * t.size * h + x * h + 2];
                                t.type === e.Engine.TEXTURETYPE_UNSIGNED_INT && (m /= 255,
                                z /= 255,
                                _ /= 255),
                                t.gammaSpace && (m = Math.pow(e.Scalar.Clamp(m), e.ToLinearSpace),
                                z = Math.pow(e.Scalar.Clamp(z), e.ToLinearSpace),
                                _ = Math.pow(e.Scalar.Clamp(_), e.ToLinearSpace));
                                var g = new e.Color3(m,z,_);
                                r.addLight(p, g, f),
                                i += f,
                                d += n
                            }
                            c += o
                        }
                    var v = 6 * (4 * Math.PI) / 6 / i;
                    return r.scale(v),
                    r.convertIncidentRadianceToIrradiance(),
                    r.convertIrradianceToLambertianRadiance(),
                    e.SphericalPolynomial.FromHarmonics(r)
                }
                ,
                r.FileFaces = [new t("right",new e.Vector3(1,0,0),new e.Vector3(0,0,-1),new e.Vector3(0,-1,0)), new t("left",new e.Vector3(-1,0,0),new e.Vector3(0,0,1),new e.Vector3(0,-1,0)), new t("up",new e.Vector3(0,1,0),new e.Vector3(1,0,0),new e.Vector3(0,0,1)), new t("down",new e.Vector3(0,-1,0),new e.Vector3(1,0,0),new e.Vector3(0,0,-1)), new t("front",new e.Vector3(0,0,1),new e.Vector3(1,0,0),new e.Vector3(0,-1,0)), new t("back",new e.Vector3(0,0,-1),new e.Vector3(-1,0,0),new e.Vector3(0,-1,0))],
                r
            }();
            e.CubeMapToSphericalPolynomialTools = r
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t() {
                    var t = e.call(this) || this;
                    return t.PBR = !0,
                    t.MAINUV1 = !1,
                    t.MAINUV2 = !1,
                    t.UV1 = !1,
                    t.UV2 = !1,
                    t.ALBEDO = !1,
                    t.ALBEDODIRECTUV = 0,
                    t.VERTEXCOLOR = !1,
                    t.AMBIENT = !1,
                    t.AMBIENTDIRECTUV = 0,
                    t.AMBIENTINGRAYSCALE = !1,
                    t.OPACITY = !1,
                    t.VERTEXALPHA = !1,
                    t.OPACITYDIRECTUV = 0,
                    t.OPACITYRGB = !1,
                    t.ALPHATEST = !1,
                    t.DEPTHPREPASS = !1,
                    t.ALPHABLEND = !1,
                    t.ALPHAFROMALBEDO = !1,
                    t.ALPHATESTVALUE = "0.5",
                    t.SPECULAROVERALPHA = !1,
                    t.RADIANCEOVERALPHA = !1,
                    t.ALPHAFRESNEL = !1,
                    t.LINEARALPHAFRESNEL = !1,
                    t.PREMULTIPLYALPHA = !1,
                    t.EMISSIVE = !1,
                    t.EMISSIVEDIRECTUV = 0,
                    t.REFLECTIVITY = !1,
                    t.REFLECTIVITYDIRECTUV = 0,
                    t.SPECULARTERM = !1,
                    t.MICROSURFACEFROMREFLECTIVITYMAP = !1,
                    t.MICROSURFACEAUTOMATIC = !1,
                    t.LODBASEDMICROSFURACE = !1,
                    t.MICROSURFACEMAP = !1,
                    t.MICROSURFACEMAPDIRECTUV = 0,
                    t.METALLICWORKFLOW = !1,
                    t.ROUGHNESSSTOREINMETALMAPALPHA = !1,
                    t.ROUGHNESSSTOREINMETALMAPGREEN = !1,
                    t.METALLNESSSTOREINMETALMAPBLUE = !1,
                    t.AOSTOREINMETALMAPRED = !1,
                    t.ENVIRONMENTBRDF = !1,
                    t.NORMAL = !1,
                    t.TANGENT = !1,
                    t.BUMP = !1,
                    t.BUMPDIRECTUV = 0,
                    t.OBJECTSPACE_NORMALMAP = !1,
                    t.PARALLAX = !1,
                    t.PARALLAXOCCLUSION = !1,
                    t.NORMALXYSCALE = !0,
                    t.LIGHTMAP = !1,
                    t.LIGHTMAPDIRECTUV = 0,
                    t.USELIGHTMAPASSHADOWMAP = !1,
                    t.GAMMALIGHTMAP = !1,
                    t.REFLECTION = !1,
                    t.REFLECTIONMAP_3D = !1,
                    t.REFLECTIONMAP_SPHERICAL = !1,
                    t.REFLECTIONMAP_PLANAR = !1,
                    t.REFLECTIONMAP_CUBIC = !1,
                    t.USE_LOCAL_REFLECTIONMAP_CUBIC = !1,
                    t.REFLECTIONMAP_PROJECTION = !1,
                    t.REFLECTIONMAP_SKYBOX = !1,
                    t.REFLECTIONMAP_SKYBOX_TRANSFORMED = !1,
                    t.REFLECTIONMAP_EXPLICIT = !1,
                    t.REFLECTIONMAP_EQUIRECTANGULAR = !1,
                    t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !1,
                    t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !1,
                    t.INVERTCUBICMAP = !1,
                    t.USESPHERICALFROMREFLECTIONMAP = !1,
                    t.USESPHERICALINVERTEX = !1,
                    t.REFLECTIONMAP_OPPOSITEZ = !1,
                    t.LODINREFLECTIONALPHA = !1,
                    t.GAMMAREFLECTION = !1,
                    t.RGBDREFLECTION = !1,
                    t.RADIANCEOCCLUSION = !1,
                    t.HORIZONOCCLUSION = !1,
                    t.REFRACTION = !1,
                    t.REFRACTIONMAP_3D = !1,
                    t.REFRACTIONMAP_OPPOSITEZ = !1,
                    t.LODINREFRACTIONALPHA = !1,
                    t.GAMMAREFRACTION = !1,
                    t.RGBDREFRACTION = !1,
                    t.LINKREFRACTIONTOTRANSPARENCY = !1,
                    t.INSTANCES = !1,
                    t.NUM_BONE_INFLUENCERS = 0,
                    t.BonesPerMesh = 0,
                    t.NONUNIFORMSCALING = !1,
                    t.MORPHTARGETS = !1,
                    t.MORPHTARGETS_NORMAL = !1,
                    t.MORPHTARGETS_TANGENT = !1,
                    t.NUM_MORPH_INFLUENCERS = 0,
                    t.IMAGEPROCESSING = !1,
                    t.VIGNETTE = !1,
                    t.VIGNETTEBLENDMODEMULTIPLY = !1,
                    t.VIGNETTEBLENDMODEOPAQUE = !1,
                    t.TONEMAPPING = !1,
                    t.TONEMAPPING_ACES = !1,
                    t.CONTRAST = !1,
                    t.COLORCURVES = !1,
                    t.COLORGRADING = !1,
                    t.COLORGRADING3D = !1,
                    t.SAMPLER3DGREENDEPTH = !1,
                    t.SAMPLER3DBGRMAP = !1,
                    t.IMAGEPROCESSINGPOSTPROCESS = !1,
                    t.EXPOSURE = !1,
                    t.USEPHYSICALLIGHTFALLOFF = !1,
                    t.USEGLTFLIGHTFALLOFF = !1,
                    t.TWOSIDEDLIGHTING = !1,
                    t.SHADOWFLOAT = !1,
                    t.CLIPPLANE = !1,
                    t.CLIPPLANE2 = !1,
                    t.CLIPPLANE3 = !1,
                    t.CLIPPLANE4 = !1,
                    t.POINTSIZE = !1,
                    t.FOG = !1,
                    t.LOGARITHMICDEPTH = !1,
                    t.FORCENORMALFORWARD = !1,
                    t.SPECULARAA = !1,
                    t.UNLIT = !1,
                    t.rebuild(),
                    t
                }
                return o(t, e),
                t.prototype.reset = function() {
                    e.prototype.reset.call(this),
                    this.ALPHATESTVALUE = "0.5",
                    this.PBR = !0
                }
                ,
                t
            }(e.MaterialDefines)
              , r = function(r) {
                function i(t, n) {
                    var o = r.call(this, t, n) || this;
                    return o._directIntensity = 1,
                    o._emissiveIntensity = 1,
                    o._environmentIntensity = 1,
                    o._specularIntensity = 1,
                    o._lightingInfos = new e.Vector4(o._directIntensity,o._emissiveIntensity,o._environmentIntensity,o._specularIntensity),
                    o._disableBumpMap = !1,
                    o._ambientTextureStrength = 1,
                    o._ambientTextureImpactOnAnalyticalLights = e.PBRMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,
                    o._ambientColor = new e.Color3(0,0,0),
                    o._albedoColor = new e.Color3(1,1,1),
                    o._reflectivityColor = new e.Color3(1,1,1),
                    o._reflectionColor = new e.Color3(1,1,1),
                    o._emissiveColor = new e.Color3(0,0,0),
                    o._microSurface = .9,
                    o._indexOfRefraction = .66,
                    o._invertRefractionY = !1,
                    o._linkRefractionWithTransparency = !1,
                    o._useLightmapAsShadowmap = !1,
                    o._useHorizonOcclusion = !0,
                    o._useRadianceOcclusion = !0,
                    o._useAlphaFromAlbedoTexture = !1,
                    o._useSpecularOverAlpha = !0,
                    o._useMicroSurfaceFromReflectivityMapAlpha = !1,
                    o._useRoughnessFromMetallicTextureAlpha = !0,
                    o._useRoughnessFromMetallicTextureGreen = !1,
                    o._useMetallnessFromMetallicTextureBlue = !1,
                    o._useAmbientOcclusionFromMetallicTextureRed = !1,
                    o._useAmbientInGrayScale = !1,
                    o._useAutoMicroSurfaceFromReflectivityMap = !1,
                    o._lightFalloff = i.LIGHTFALLOFF_PHYSICAL,
                    o._useRadianceOverAlpha = !0,
                    o._useObjectSpaceNormalMap = !1,
                    o._useParallax = !1,
                    o._useParallaxOcclusion = !1,
                    o._parallaxScaleBias = .05,
                    o._disableLighting = !1,
                    o._maxSimultaneousLights = 4,
                    o._invertNormalMapX = !1,
                    o._invertNormalMapY = !1,
                    o._twoSidedLighting = !1,
                    o._alphaCutOff = .4,
                    o._forceAlphaTest = !1,
                    o._useAlphaFresnel = !1,
                    o._useLinearAlphaFresnel = !1,
                    o._transparencyMode = null,
                    o._environmentBRDFTexture = null,
                    o._forceIrradianceInFragment = !1,
                    o._forceNormalForward = !1,
                    o._enableSpecularAntiAliasing = !1,
                    o._renderTargets = new e.SmartArray(16),
                    o._globalAmbientColor = new e.Color3(0,0,0),
                    o._unlit = !1,
                    o._attachImageProcessingConfiguration(null),
                    o.getRenderTargetTextures = function() {
                        return o._renderTargets.reset(),
                        e.StandardMaterial.ReflectionTextureEnabled && o._reflectionTexture && o._reflectionTexture.isRenderTarget && o._renderTargets.push(o._reflectionTexture),
                        e.StandardMaterial.RefractionTextureEnabled && o._refractionTexture && o._refractionTexture.isRenderTarget && o._renderTargets.push(o._refractionTexture),
                        o._renderTargets
                    }
                    ,
                    o._environmentBRDFTexture = e.TextureTools.GetEnvironmentBRDFTexture(n),
                    o
                }
                return o(i, r),
                i.prototype._attachImageProcessingConfiguration = function(e) {
                    var t = this;
                    e !== this._imageProcessingConfiguration && (this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),
                    this._imageProcessingConfiguration = e || this.getScene().imageProcessingConfiguration,
                    this._imageProcessingConfiguration && (this._imageProcessingObserver = this._imageProcessingConfiguration.onUpdateParameters.add((function(e) {
                        t._markAllSubMeshesAsImageProcessingDirty()
                    }
                    ))))
                }
                ,
                Object.defineProperty(i.prototype, "hasRenderTargetTextures", {
                    get: function() {
                        return !!(e.StandardMaterial.ReflectionTextureEnabled && this._reflectionTexture && this._reflectionTexture.isRenderTarget) || !!(e.StandardMaterial.RefractionTextureEnabled && this._refractionTexture && this._refractionTexture.isRenderTarget)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getClassName = function() {
                    return "PBRBaseMaterial"
                }
                ,
                Object.defineProperty(i.prototype, "useLogarithmicDepth", {
                    get: function() {
                        return this._useLogarithmicDepth
                    },
                    set: function(e) {
                        this._useLogarithmicDepth = e && this.getScene().getEngine().getCaps().fragmentDepthSupported
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "transparencyMode", {
                    get: function() {
                        return this._transparencyMode
                    },
                    set: function(t) {
                        this._transparencyMode !== t && (this._transparencyMode = t,
                        this._forceAlphaTest = t === e.PBRMaterial.PBRMATERIAL_ALPHATESTANDBLEND,
                        this._markAllSubMeshesAsTexturesAndMiscDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "_disableAlphaBlending", {
                    get: function() {
                        return this._linkRefractionWithTransparency || this._transparencyMode === e.PBRMaterial.PBRMATERIAL_OPAQUE || this._transparencyMode === e.PBRMaterial.PBRMATERIAL_ALPHATEST
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.needAlphaBlending = function() {
                    return !this._disableAlphaBlending && (this.alpha < 1 || null != this._opacityTexture || this._shouldUseAlphaFromAlbedoTexture())
                }
                ,
                i.prototype.needAlphaBlendingForMesh = function(e) {
                    return !this._disableAlphaBlending && r.prototype.needAlphaBlendingForMesh.call(this, e)
                }
                ,
                i.prototype.needAlphaTesting = function() {
                    return !!this._forceAlphaTest || !this._linkRefractionWithTransparency && (null != this._albedoTexture && this._albedoTexture.hasAlpha && (null == this._transparencyMode || this._transparencyMode === e.PBRMaterial.PBRMATERIAL_ALPHATEST))
                }
                ,
                i.prototype._shouldUseAlphaFromAlbedoTexture = function() {
                    return null != this._albedoTexture && this._albedoTexture.hasAlpha && this._useAlphaFromAlbedoTexture && this._transparencyMode !== e.PBRMaterial.PBRMATERIAL_OPAQUE
                }
                ,
                i.prototype.getAlphaTestTexture = function() {
                    return this._albedoTexture
                }
                ,
                i.prototype.isReadyForSubMesh = function(r, i, n) {
                    if (i.effect && this.isFrozen && this._wasPreviouslyReady)
                        return !0;
                    i._materialDefines || (i._materialDefines = new t);
                    var o = i._materialDefines;
                    if (!this.checkReadyOnEveryCall && i.effect && o._renderId === this.getScene().getRenderId())
                        return !0;
                    var a = this.getScene()
                      , s = a.getEngine();
                    if (o._areTexturesDirty && a.texturesEnabled) {
                        if (this._albedoTexture && e.StandardMaterial.DiffuseTextureEnabled && !this._albedoTexture.isReadyOrNotBlocking())
                            return !1;
                        if (this._ambientTexture && e.StandardMaterial.AmbientTextureEnabled && !this._ambientTexture.isReadyOrNotBlocking())
                            return !1;
                        if (this._opacityTexture && e.StandardMaterial.OpacityTextureEnabled && !this._opacityTexture.isReadyOrNotBlocking())
                            return !1;
                        var y = this._getReflectionTexture();
                        if (y && e.StandardMaterial.ReflectionTextureEnabled && !y.isReadyOrNotBlocking())
                            return !1;
                        if (this._lightmapTexture && e.StandardMaterial.LightmapTextureEnabled && !this._lightmapTexture.isReadyOrNotBlocking())
                            return !1;
                        if (this._emissiveTexture && e.StandardMaterial.EmissiveTextureEnabled && !this._emissiveTexture.isReadyOrNotBlocking())
                            return !1;
                        if (e.StandardMaterial.SpecularTextureEnabled) {
                            if (this._metallicTexture) {
                                if (!this._metallicTexture.isReadyOrNotBlocking())
                                    return !1
                            } else if (this._reflectivityTexture && !this._reflectivityTexture.isReadyOrNotBlocking())
                                return !1;
                            if (this._microSurfaceTexture && !this._microSurfaceTexture.isReadyOrNotBlocking())
                                return !1
                        }
                        if (s.getCaps().standardDerivatives && this._bumpTexture && e.StandardMaterial.BumpTextureEnabled && !this._disableBumpMap && !this._bumpTexture.isReady())
                            return !1;
                        var l = this._getRefractionTexture();
                        if (l && e.StandardMaterial.RefractionTextureEnabled && !l.isReadyOrNotBlocking())
                            return !1;
                        if (this._environmentBRDFTexture && e.StandardMaterial.ReflectionTextureEnabled && !this._environmentBRDFTexture.isReady())
                            return !1
                    }
                    if (o._areImageProcessingDirty && this._imageProcessingConfiguration && !this._imageProcessingConfiguration.isReady())
                        return !1;
                    s.getCaps().standardDerivatives || r.isVerticesDataPresent(e.VertexBuffer.NormalKind) || (r.createNormals(!0),
                    e.Tools.Warn("PBRMaterial: Normals have been created for the mesh: " + r.name));
                    var c = this._prepareEffect(r, o, this.onCompiled, this.onError, n);
                    return c && (a.resetCachedMaterial(),
                    i.setEffect(c, o),
                    this.buildUniformLayout()),
                    !(!i.effect || !i.effect.isReady()) && (o._renderId = a.getRenderId(),
                    this._wasPreviouslyReady = !0,
                    !0)
                }
                ,
                i.prototype.isMetallicWorkflow = function() {
                    return !(null == this._metallic && null == this._roughness && !this._metallicTexture)
                }
                ,
                i.prototype._prepareEffect = function(t, r, i, n, o, a) {
                    if (void 0 === i && (i = null),
                    void 0 === n && (n = null),
                    void 0 === o && (o = null),
                    void 0 === a && (a = null),
                    this._prepareDefines(t, r, o, a),
                    !r.isDirty)
                        return null;
                    r.markAsProcessed();
                    var s = this.getScene().getEngine()
                      , y = new e.EffectFallbacks
                      , l = 0;
                    r.USESPHERICALINVERTEX && y.addFallback(l++, "USESPHERICALINVERTEX"),
                    r.FOG && y.addFallback(l, "FOG"),
                    r.SPECULARAA && y.addFallback(l, "SPECULARAA"),
                    r.POINTSIZE && y.addFallback(l, "POINTSIZE"),
                    r.LOGARITHMICDEPTH && y.addFallback(l, "LOGARITHMICDEPTH"),
                    r.PARALLAX && y.addFallback(l, "PARALLAX"),
                    r.PARALLAXOCCLUSION && y.addFallback(l++, "PARALLAXOCCLUSION"),
                    r.ENVIRONMENTBRDF && y.addFallback(l++, "ENVIRONMENTBRDF"),
                    r.TANGENT && y.addFallback(l++, "TANGENT"),
                    r.BUMP && y.addFallback(l++, "BUMP"),
                    l = e.MaterialHelper.HandleFallbacksForShadows(r, y, this._maxSimultaneousLights, l++),
                    r.SPECULARTERM && y.addFallback(l++, "SPECULARTERM"),
                    r.USESPHERICALFROMREFLECTIONMAP && y.addFallback(l++, "USESPHERICALFROMREFLECTIONMAP"),
                    r.LIGHTMAP && y.addFallback(l++, "LIGHTMAP"),
                    r.NORMAL && y.addFallback(l++, "NORMAL"),
                    r.AMBIENT && y.addFallback(l++, "AMBIENT"),
                    r.EMISSIVE && y.addFallback(l++, "EMISSIVE"),
                    r.VERTEXCOLOR && y.addFallback(l++, "VERTEXCOLOR"),
                    r.NUM_BONE_INFLUENCERS > 0 && y.addCPUSkinningFallback(l++, t),
                    r.MORPHTARGETS && y.addFallback(l++, "MORPHTARGETS");
                    var c = [e.VertexBuffer.PositionKind];
                    r.NORMAL && c.push(e.VertexBuffer.NormalKind),
                    r.TANGENT && c.push(e.VertexBuffer.TangentKind),
                    r.UV1 && c.push(e.VertexBuffer.UVKind),
                    r.UV2 && c.push(e.VertexBuffer.UV2Kind),
                    r.VERTEXCOLOR && c.push(e.VertexBuffer.ColorKind),
                    e.MaterialHelper.PrepareAttributesForBones(c, t, r, y),
                    e.MaterialHelper.PrepareAttributesForInstances(c, r),
                    e.MaterialHelper.PrepareAttributesForMorphTargets(c, t, r);
                    var h = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vAmbientColor", "vAlbedoColor", "vReflectivityColor", "vEmissiveColor", "vReflectionColor", "vFogInfos", "vFogColor", "pointSize", "vAlbedoInfos", "vAmbientInfos", "vOpacityInfos", "vReflectionInfos", "vReflectionPosition", "vReflectionSize", "vEmissiveInfos", "vReflectivityInfos", "vMicroSurfaceSamplerInfos", "vBumpInfos", "vLightmapInfos", "vRefractionInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "albedoMatrix", "ambientMatrix", "opacityMatrix", "reflectionMatrix", "emissiveMatrix", "reflectivityMatrix", "normalMatrix", "microSurfaceSamplerMatrix", "bumpMatrix", "lightmapMatrix", "refractionMatrix", "vLightingIntensity", "logarithmicDepthConstant", "vSphericalX", "vSphericalY", "vSphericalZ", "vSphericalXX", "vSphericalYY", "vSphericalZZ", "vSphericalXY", "vSphericalYZ", "vSphericalZX", "vReflectionMicrosurfaceInfos", "vRefractionMicrosurfaceInfos", "vTangentSpaceParams"]
                      , u = ["albedoSampler", "reflectivitySampler", "ambientSampler", "emissiveSampler", "bumpSampler", "lightmapSampler", "opacitySampler", "refractionSampler", "refractionSamplerLow", "refractionSamplerHigh", "reflectionSampler", "reflectionSamplerLow", "reflectionSamplerHigh", "microSurfaceSampler", "environmentBrdfSampler"]
                      , d = ["Material", "Scene"];
                    e.ImageProcessingConfiguration && (e.ImageProcessingConfiguration.PrepareUniforms(h, r),
                    e.ImageProcessingConfiguration.PrepareSamplers(u, r)),
                    e.MaterialHelper.PrepareUniformsAndSamplersList({
                        uniformsNames: h,
                        uniformBuffersNames: d,
                        samplers: u,
                        defines: r,
                        maxSimultaneousLights: this._maxSimultaneousLights
                    });
                    var x = r.toString();
                    return s.createEffect("pbr", {
                        attributes: c,
                        uniformsNames: h,
                        uniformBuffersNames: d,
                        samplers: u,
                        defines: x,
                        fallbacks: y,
                        onCompiled: i,
                        onError: n,
                        indexParameters: {
                            maxSimultaneousLights: this._maxSimultaneousLights,
                            maxSimultaneousMorphTargets: r.NUM_MORPH_INFLUENCERS
                        }
                    }, s)
                }
                ,
                i.prototype._prepareDefines = function(t, r, n, o) {
                    void 0 === n && (n = null),
                    void 0 === o && (o = null);
                    var a = this.getScene()
                      , s = a.getEngine();
                    if (e.MaterialHelper.PrepareDefinesForLights(a, t, r, !0, this._maxSimultaneousLights, this._disableLighting),
                    r._needNormals = !0,
                    r.METALLICWORKFLOW = this.isMetallicWorkflow(),
                    r._areTexturesDirty) {
                        if (r._needUVs = !1,
                        a.texturesEnabled) {
                            a.getEngine().getCaps().textureLOD && (r.LODBASEDMICROSFURACE = !0),
                            this._albedoTexture && e.StandardMaterial.DiffuseTextureEnabled ? e.MaterialHelper.PrepareDefinesForMergedUV(this._albedoTexture, r, "ALBEDO") : r.ALBEDO = !1,
                            this._ambientTexture && e.StandardMaterial.AmbientTextureEnabled ? (e.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture, r, "AMBIENT"),
                            r.AMBIENTINGRAYSCALE = this._useAmbientInGrayScale) : r.AMBIENT = !1,
                            this._opacityTexture && e.StandardMaterial.OpacityTextureEnabled ? (e.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture, r, "OPACITY"),
                            r.OPACITYRGB = this._opacityTexture.getAlphaFromRGB) : r.OPACITY = !1;
                            var y = this._getReflectionTexture();
                            if (y && e.StandardMaterial.ReflectionTextureEnabled) {
                                switch (r.REFLECTION = !0,
                                r.GAMMAREFLECTION = y.gammaSpace,
                                r.RGBDREFLECTION = y.isRGBD,
                                r.REFLECTIONMAP_OPPOSITEZ = this.getScene().useRightHandedSystem ? !y.invertZ : y.invertZ,
                                r.LODINREFLECTIONALPHA = y.lodLevelInAlpha,
                                y.coordinatesMode === e.Texture.INVCUBIC_MODE && (r.INVERTCUBICMAP = !0),
                                r.REFLECTIONMAP_3D = y.isCube,
                                y.coordinatesMode) {
                                case e.Texture.EXPLICIT_MODE:
                                    r.REFLECTIONMAP_EXPLICIT = !0;
                                    break;
                                case e.Texture.PLANAR_MODE:
                                    r.REFLECTIONMAP_PLANAR = !0;
                                    break;
                                case e.Texture.PROJECTION_MODE:
                                    r.REFLECTIONMAP_PROJECTION = !0;
                                    break;
                                case e.Texture.SKYBOX_MODE:
                                    r.REFLECTIONMAP_SKYBOX = !0;
                                    break;
                                case e.Texture.SPHERICAL_MODE:
                                    r.REFLECTIONMAP_SPHERICAL = !0;
                                    break;
                                case e.Texture.EQUIRECTANGULAR_MODE:
                                    r.REFLECTIONMAP_EQUIRECTANGULAR = !0;
                                    break;
                                case e.Texture.FIXED_EQUIRECTANGULAR_MODE:
                                    r.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !0;
                                    break;
                                case e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:
                                    r.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !0;
                                    break;
                                case e.Texture.CUBIC_MODE:
                                case e.Texture.INVCUBIC_MODE:
                                default:
                                    r.REFLECTIONMAP_CUBIC = !0,
                                    r.USE_LOCAL_REFLECTIONMAP_CUBIC = !!y.boundingBoxSize
                                }
                                y.coordinatesMode !== e.Texture.SKYBOX_MODE ? y.sphericalPolynomial && (r.USESPHERICALFROMREFLECTIONMAP = !0,
                                this._forceIrradianceInFragment || a.getEngine().getCaps().maxVaryingVectors <= 8 ? r.USESPHERICALINVERTEX = !1 : r.USESPHERICALINVERTEX = !0) : r.REFLECTIONMAP_SKYBOX_TRANSFORMED = !y.getReflectionTextureMatrix().isIdentity()
                            } else
                                r.REFLECTION = !1,
                                r.REFLECTIONMAP_3D = !1,
                                r.REFLECTIONMAP_SPHERICAL = !1,
                                r.REFLECTIONMAP_PLANAR = !1,
                                r.REFLECTIONMAP_CUBIC = !1,
                                r.USE_LOCAL_REFLECTIONMAP_CUBIC = !1,
                                r.REFLECTIONMAP_PROJECTION = !1,
                                r.REFLECTIONMAP_SKYBOX = !1,
                                r.REFLECTIONMAP_SKYBOX_TRANSFORMED = !1,
                                r.REFLECTIONMAP_EXPLICIT = !1,
                                r.REFLECTIONMAP_EQUIRECTANGULAR = !1,
                                r.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !1,
                                r.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !1,
                                r.INVERTCUBICMAP = !1,
                                r.USESPHERICALFROMREFLECTIONMAP = !1,
                                r.USESPHERICALINVERTEX = !1,
                                r.REFLECTIONMAP_OPPOSITEZ = !1,
                                r.LODINREFLECTIONALPHA = !1,
                                r.GAMMAREFLECTION = !1,
                                r.RGBDREFLECTION = !1;
                            this._lightmapTexture && e.StandardMaterial.LightmapTextureEnabled ? (e.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture, r, "LIGHTMAP"),
                            r.USELIGHTMAPASSHADOWMAP = this._useLightmapAsShadowmap,
                            r.GAMMALIGHTMAP = this._lightmapTexture.gammaSpace) : r.LIGHTMAP = !1,
                            this._emissiveTexture && e.StandardMaterial.EmissiveTextureEnabled ? e.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture, r, "EMISSIVE") : r.EMISSIVE = !1,
                            e.StandardMaterial.SpecularTextureEnabled ? (this._metallicTexture ? (e.MaterialHelper.PrepareDefinesForMergedUV(this._metallicTexture, r, "REFLECTIVITY"),
                            r.ROUGHNESSSTOREINMETALMAPALPHA = this._useRoughnessFromMetallicTextureAlpha,
                            r.ROUGHNESSSTOREINMETALMAPGREEN = !this._useRoughnessFromMetallicTextureAlpha && this._useRoughnessFromMetallicTextureGreen,
                            r.METALLNESSSTOREINMETALMAPBLUE = this._useMetallnessFromMetallicTextureBlue,
                            r.AOSTOREINMETALMAPRED = this._useAmbientOcclusionFromMetallicTextureRed) : this._reflectivityTexture ? (e.MaterialHelper.PrepareDefinesForMergedUV(this._reflectivityTexture, r, "REFLECTIVITY"),
                            r.MICROSURFACEFROMREFLECTIVITYMAP = this._useMicroSurfaceFromReflectivityMapAlpha,
                            r.MICROSURFACEAUTOMATIC = this._useAutoMicroSurfaceFromReflectivityMap) : r.REFLECTIVITY = !1,
                            this._microSurfaceTexture ? e.MaterialHelper.PrepareDefinesForMergedUV(this._microSurfaceTexture, r, "MICROSURFACEMAP") : r.MICROSURFACEMAP = !1) : (r.REFLECTIVITY = !1,
                            r.MICROSURFACEMAP = !1),
                            a.getEngine().getCaps().standardDerivatives && this._bumpTexture && e.StandardMaterial.BumpTextureEnabled && !this._disableBumpMap ? (e.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture, r, "BUMP"),
                            this._useParallax && this._albedoTexture && e.StandardMaterial.DiffuseTextureEnabled ? (r.PARALLAX = !0,
                            r.PARALLAXOCCLUSION = !!this._useParallaxOcclusion) : r.PARALLAX = !1,
                            r.OBJECTSPACE_NORMALMAP = this._useObjectSpaceNormalMap) : r.BUMP = !1;
                            var l = this._getRefractionTexture();
                            l && e.StandardMaterial.RefractionTextureEnabled ? (r.REFRACTION = !0,
                            r.REFRACTIONMAP_3D = l.isCube,
                            r.GAMMAREFRACTION = l.gammaSpace,
                            r.RGBDREFRACTION = l.isRGBD,
                            r.REFRACTIONMAP_OPPOSITEZ = l.invertZ,
                            r.LODINREFRACTIONALPHA = l.lodLevelInAlpha,
                            this._linkRefractionWithTransparency && (r.LINKREFRACTIONTOTRANSPARENCY = !0)) : r.REFRACTION = !1,
                            this._environmentBRDFTexture && e.StandardMaterial.ReflectionTextureEnabled ? r.ENVIRONMENTBRDF = !0 : r.ENVIRONMENTBRDF = !1,
                            this._shouldUseAlphaFromAlbedoTexture() ? r.ALPHAFROMALBEDO = !0 : r.ALPHAFROMALBEDO = !1
                        }
                        r.SPECULAROVERALPHA = this._useSpecularOverAlpha,
                        this._lightFalloff === i.LIGHTFALLOFF_STANDARD ? (r.USEPHYSICALLIGHTFALLOFF = !1,
                        r.USEGLTFLIGHTFALLOFF = !1) : this._lightFalloff === i.LIGHTFALLOFF_GLTF ? (r.USEPHYSICALLIGHTFALLOFF = !1,
                        r.USEGLTFLIGHTFALLOFF = !0) : (r.USEPHYSICALLIGHTFALLOFF = !0,
                        r.USEGLTFLIGHTFALLOFF = !1),
                        r.RADIANCEOVERALPHA = this._useRadianceOverAlpha,
                        !this.backFaceCulling && this._twoSidedLighting ? r.TWOSIDEDLIGHTING = !0 : r.TWOSIDEDLIGHTING = !1,
                        r.ALPHATESTVALUE = this._alphaCutOff + (this._alphaCutOff % 1 == 0 ? "." : ""),
                        r.PREMULTIPLYALPHA = this.alphaMode === e.Engine.ALPHA_PREMULTIPLIED || this.alphaMode === e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,
                        r.ALPHABLEND = this.needAlphaBlendingForMesh(t),
                        r.ALPHAFRESNEL = this._useAlphaFresnel || this._useLinearAlphaFresnel,
                        r.LINEARALPHAFRESNEL = this._useLinearAlphaFresnel,
                        r.SPECULARAA = a.getEngine().getCaps().standardDerivatives && this._enableSpecularAntiAliasing
                    }
                    r._areImageProcessingDirty && this._imageProcessingConfiguration && this._imageProcessingConfiguration.prepareDefines(r),
                    r.FORCENORMALFORWARD = this._forceNormalForward,
                    r.RADIANCEOCCLUSION = this._useRadianceOcclusion,
                    r.HORIZONOCCLUSION = this._useHorizonOcclusion,
                    r._areMiscDirty && (e.MaterialHelper.PrepareDefinesForMisc(t, a, this._useLogarithmicDepth, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(t) || this._forceAlphaTest, r),
                    r.UNLIT = this._unlit || (this.pointsCloud || this.wireframe) && !t.isVerticesDataPresent(e.VertexBuffer.NormalKind)),
                    e.MaterialHelper.PrepareDefinesForFrameBoundValues(a, s, r, !!n, o),
                    e.MaterialHelper.PrepareDefinesForAttributes(t, r, !0, !0, !0, this._transparencyMode !== e.PBRMaterial.PBRMATERIAL_OPAQUE)
                }
                ,
                i.prototype.forceCompilation = function(e, r, i) {
                    var n = this
                      , o = a({
                        clipPlane: !1
                    }, i)
                      , s = new t
                      , y = this._prepareEffect(e, s, void 0, void 0, void 0, o.clipPlane);
                    y.isReady() ? r && r(this) : y.onCompileObservable.add((function() {
                        r && r(n)
                    }
                    ))
                }
                ,
                i.prototype.buildUniformLayout = function() {
                    this._uniformBuffer.addUniform("vAlbedoInfos", 2),
                    this._uniformBuffer.addUniform("vAmbientInfos", 4),
                    this._uniformBuffer.addUniform("vOpacityInfos", 2),
                    this._uniformBuffer.addUniform("vEmissiveInfos", 2),
                    this._uniformBuffer.addUniform("vLightmapInfos", 2),
                    this._uniformBuffer.addUniform("vReflectivityInfos", 3),
                    this._uniformBuffer.addUniform("vMicroSurfaceSamplerInfos", 2),
                    this._uniformBuffer.addUniform("vRefractionInfos", 4),
                    this._uniformBuffer.addUniform("vReflectionInfos", 2),
                    this._uniformBuffer.addUniform("vReflectionPosition", 3),
                    this._uniformBuffer.addUniform("vReflectionSize", 3),
                    this._uniformBuffer.addUniform("vBumpInfos", 3),
                    this._uniformBuffer.addUniform("albedoMatrix", 16),
                    this._uniformBuffer.addUniform("ambientMatrix", 16),
                    this._uniformBuffer.addUniform("opacityMatrix", 16),
                    this._uniformBuffer.addUniform("emissiveMatrix", 16),
                    this._uniformBuffer.addUniform("lightmapMatrix", 16),
                    this._uniformBuffer.addUniform("reflectivityMatrix", 16),
                    this._uniformBuffer.addUniform("microSurfaceSamplerMatrix", 16),
                    this._uniformBuffer.addUniform("bumpMatrix", 16),
                    this._uniformBuffer.addUniform("vTangentSpaceParams", 2),
                    this._uniformBuffer.addUniform("refractionMatrix", 16),
                    this._uniformBuffer.addUniform("reflectionMatrix", 16),
                    this._uniformBuffer.addUniform("vReflectionColor", 3),
                    this._uniformBuffer.addUniform("vAlbedoColor", 4),
                    this._uniformBuffer.addUniform("vLightingIntensity", 4),
                    this._uniformBuffer.addUniform("vRefractionMicrosurfaceInfos", 3),
                    this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos", 3),
                    this._uniformBuffer.addUniform("vReflectivityColor", 4),
                    this._uniformBuffer.addUniform("vEmissiveColor", 3),
                    this._uniformBuffer.addUniform("pointSize", 1),
                    this._uniformBuffer.create()
                }
                ,
                i.prototype.unbind = function() {
                    this._reflectionTexture && this._reflectionTexture.isRenderTarget && this._uniformBuffer.setTexture("reflectionSampler", null),
                    this._refractionTexture && this._refractionTexture.isRenderTarget && this._uniformBuffer.setTexture("refractionSampler", null),
                    r.prototype.unbind.call(this)
                }
                ,
                i.prototype.bindForSubMesh = function(t, r, n) {
                    var o = this.getScene()
                      , a = n._materialDefines;
                    if (a) {
                        var s = n.effect;
                        if (s) {
                            this._activeEffect = s,
                            this.bindOnlyWorldMatrix(t),
                            a.OBJECTSPACE_NORMALMAP && (t.toNormalMatrix(this._normalMatrix),
                            this.bindOnlyNormalMatrix(this._normalMatrix));
                            var y = this._mustRebind(o, s, r.visibility);
                            e.MaterialHelper.BindBonesParameters(r, this._activeEffect);
                            var l = null;
                            if (y) {
                                this._uniformBuffer.bindToEffect(s, "Material"),
                                this.bindViewProjection(s),
                                l = this._getReflectionTexture();
                                var c = this._getRefractionTexture();
                                if (!this._uniformBuffer.useUbo || !this.isFrozen || !this._uniformBuffer.isSync) {
                                    if (o.texturesEnabled) {
                                        if (this._albedoTexture && e.StandardMaterial.DiffuseTextureEnabled && (this._uniformBuffer.updateFloat2("vAlbedoInfos", this._albedoTexture.coordinatesIndex, this._albedoTexture.level),
                                        e.MaterialHelper.BindTextureMatrix(this._albedoTexture, this._uniformBuffer, "albedo")),
                                        this._ambientTexture && e.StandardMaterial.AmbientTextureEnabled && (this._uniformBuffer.updateFloat4("vAmbientInfos", this._ambientTexture.coordinatesIndex, this._ambientTexture.level, this._ambientTextureStrength, this._ambientTextureImpactOnAnalyticalLights),
                                        e.MaterialHelper.BindTextureMatrix(this._ambientTexture, this._uniformBuffer, "ambient")),
                                        this._opacityTexture && e.StandardMaterial.OpacityTextureEnabled && (this._uniformBuffer.updateFloat2("vOpacityInfos", this._opacityTexture.coordinatesIndex, this._opacityTexture.level),
                                        e.MaterialHelper.BindTextureMatrix(this._opacityTexture, this._uniformBuffer, "opacity")),
                                        l && e.StandardMaterial.ReflectionTextureEnabled) {
                                            if (this._uniformBuffer.updateMatrix("reflectionMatrix", l.getReflectionTextureMatrix()),
                                            this._uniformBuffer.updateFloat2("vReflectionInfos", l.level, 0),
                                            l.boundingBoxSize) {
                                                var h = l;
                                                this._uniformBuffer.updateVector3("vReflectionPosition", h.boundingBoxPosition),
                                                this._uniformBuffer.updateVector3("vReflectionSize", h.boundingBoxSize)
                                            }
                                            var u = l.sphericalPolynomial;
                                            a.USESPHERICALFROMREFLECTIONMAP && u && (this._activeEffect.setFloat3("vSphericalX", u.x.x, u.x.y, u.x.z),
                                            this._activeEffect.setFloat3("vSphericalY", u.y.x, u.y.y, u.y.z),
                                            this._activeEffect.setFloat3("vSphericalZ", u.z.x, u.z.y, u.z.z),
                                            this._activeEffect.setFloat3("vSphericalXX_ZZ", u.xx.x - u.zz.x, u.xx.y - u.zz.y, u.xx.z - u.zz.z),
                                            this._activeEffect.setFloat3("vSphericalYY_ZZ", u.yy.x - u.zz.x, u.yy.y - u.zz.y, u.yy.z - u.zz.z),
                                            this._activeEffect.setFloat3("vSphericalZZ", u.zz.x, u.zz.y, u.zz.z),
                                            this._activeEffect.setFloat3("vSphericalXY", u.xy.x, u.xy.y, u.xy.z),
                                            this._activeEffect.setFloat3("vSphericalYZ", u.yz.x, u.yz.y, u.yz.z),
                                            this._activeEffect.setFloat3("vSphericalZX", u.zx.x, u.zx.y, u.zx.z)),
                                            this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos", l.getSize().width, l.lodGenerationScale, l.lodGenerationOffset)
                                        }
                                        if (this._emissiveTexture && e.StandardMaterial.EmissiveTextureEnabled && (this._uniformBuffer.updateFloat2("vEmissiveInfos", this._emissiveTexture.coordinatesIndex, this._emissiveTexture.level),
                                        e.MaterialHelper.BindTextureMatrix(this._emissiveTexture, this._uniformBuffer, "emissive")),
                                        this._lightmapTexture && e.StandardMaterial.LightmapTextureEnabled && (this._uniformBuffer.updateFloat2("vLightmapInfos", this._lightmapTexture.coordinatesIndex, this._lightmapTexture.level),
                                        e.MaterialHelper.BindTextureMatrix(this._lightmapTexture, this._uniformBuffer, "lightmap")),
                                        e.StandardMaterial.SpecularTextureEnabled && (this._metallicTexture ? (this._uniformBuffer.updateFloat3("vReflectivityInfos", this._metallicTexture.coordinatesIndex, this._metallicTexture.level, this._ambientTextureStrength),
                                        e.MaterialHelper.BindTextureMatrix(this._metallicTexture, this._uniformBuffer, "reflectivity")) : this._reflectivityTexture && (this._uniformBuffer.updateFloat3("vReflectivityInfos", this._reflectivityTexture.coordinatesIndex, this._reflectivityTexture.level, 1),
                                        e.MaterialHelper.BindTextureMatrix(this._reflectivityTexture, this._uniformBuffer, "reflectivity")),
                                        this._microSurfaceTexture && (this._uniformBuffer.updateFloat2("vMicroSurfaceSamplerInfos", this._microSurfaceTexture.coordinatesIndex, this._microSurfaceTexture.level),
                                        e.MaterialHelper.BindTextureMatrix(this._microSurfaceTexture, this._uniformBuffer, "microSurfaceSampler"))),
                                        this._bumpTexture && o.getEngine().getCaps().standardDerivatives && e.StandardMaterial.BumpTextureEnabled && !this._disableBumpMap && (this._uniformBuffer.updateFloat3("vBumpInfos", this._bumpTexture.coordinatesIndex, this._bumpTexture.level, this._parallaxScaleBias),
                                        e.MaterialHelper.BindTextureMatrix(this._bumpTexture, this._uniformBuffer, "bump"),
                                        o._mirroredCameraPosition ? this._uniformBuffer.updateFloat2("vTangentSpaceParams", this._invertNormalMapX ? 1 : -1, this._invertNormalMapY ? 1 : -1) : this._uniformBuffer.updateFloat2("vTangentSpaceParams", this._invertNormalMapX ? -1 : 1, this._invertNormalMapY ? -1 : 1)),
                                        c && e.StandardMaterial.RefractionTextureEnabled) {
                                            this._uniformBuffer.updateMatrix("refractionMatrix", c.getReflectionTextureMatrix());
                                            var d = 1;
                                            c.isCube || c.depth && (d = c.depth),
                                            this._uniformBuffer.updateFloat4("vRefractionInfos", c.level, this._indexOfRefraction, d, this._invertRefractionY ? -1 : 1),
                                            this._uniformBuffer.updateFloat3("vRefractionMicrosurfaceInfos", c.getSize().width, c.lodGenerationScale, c.lodGenerationOffset)
                                        }
                                    }
                                    this.pointsCloud && this._uniformBuffer.updateFloat("pointSize", this.pointSize),
                                    a.METALLICWORKFLOW ? (e.PBRMaterial._scaledReflectivity.r = void 0 === this._metallic || null === this._metallic ? 1 : this._metallic,
                                    e.PBRMaterial._scaledReflectivity.g = void 0 === this._roughness || null === this._roughness ? 1 : this._roughness,
                                    this._uniformBuffer.updateColor4("vReflectivityColor", e.PBRMaterial._scaledReflectivity, 0)) : this._uniformBuffer.updateColor4("vReflectivityColor", this._reflectivityColor, this._microSurface),
                                    this._uniformBuffer.updateColor3("vEmissiveColor", this._emissiveColor),
                                    this._uniformBuffer.updateColor3("vReflectionColor", this._reflectionColor),
                                    this._uniformBuffer.updateColor4("vAlbedoColor", this._albedoColor, this.alpha * r.visibility),
                                    this._lightingInfos.x = this._directIntensity,
                                    this._lightingInfos.y = this._emissiveIntensity,
                                    this._lightingInfos.z = this._environmentIntensity,
                                    this._lightingInfos.w = this._specularIntensity,
                                    this._uniformBuffer.updateVector4("vLightingIntensity", this._lightingInfos)
                                }
                                o.texturesEnabled && (this._albedoTexture && e.StandardMaterial.DiffuseTextureEnabled && this._uniformBuffer.setTexture("albedoSampler", this._albedoTexture),
                                this._ambientTexture && e.StandardMaterial.AmbientTextureEnabled && this._uniformBuffer.setTexture("ambientSampler", this._ambientTexture),
                                this._opacityTexture && e.StandardMaterial.OpacityTextureEnabled && this._uniformBuffer.setTexture("opacitySampler", this._opacityTexture),
                                l && e.StandardMaterial.ReflectionTextureEnabled && (a.LODBASEDMICROSFURACE ? this._uniformBuffer.setTexture("reflectionSampler", l) : (this._uniformBuffer.setTexture("reflectionSampler", l._lodTextureMid || l),
                                this._uniformBuffer.setTexture("reflectionSamplerLow", l._lodTextureLow || l),
                                this._uniformBuffer.setTexture("reflectionSamplerHigh", l._lodTextureHigh || l))),
                                a.ENVIRONMENTBRDF && this._uniformBuffer.setTexture("environmentBrdfSampler", this._environmentBRDFTexture),
                                c && e.StandardMaterial.RefractionTextureEnabled && (a.LODBASEDMICROSFURACE ? this._uniformBuffer.setTexture("refractionSampler", c) : (this._uniformBuffer.setTexture("refractionSampler", c._lodTextureMid || c),
                                this._uniformBuffer.setTexture("refractionSamplerLow", c._lodTextureLow || c),
                                this._uniformBuffer.setTexture("refractionSamplerHigh", c._lodTextureHigh || c))),
                                this._emissiveTexture && e.StandardMaterial.EmissiveTextureEnabled && this._uniformBuffer.setTexture("emissiveSampler", this._emissiveTexture),
                                this._lightmapTexture && e.StandardMaterial.LightmapTextureEnabled && this._uniformBuffer.setTexture("lightmapSampler", this._lightmapTexture),
                                e.StandardMaterial.SpecularTextureEnabled && (this._metallicTexture ? this._uniformBuffer.setTexture("reflectivitySampler", this._metallicTexture) : this._reflectivityTexture && this._uniformBuffer.setTexture("reflectivitySampler", this._reflectivityTexture),
                                this._microSurfaceTexture && this._uniformBuffer.setTexture("microSurfaceSampler", this._microSurfaceTexture)),
                                this._bumpTexture && o.getEngine().getCaps().standardDerivatives && e.StandardMaterial.BumpTextureEnabled && !this._disableBumpMap && this._uniformBuffer.setTexture("bumpSampler", this._bumpTexture)),
                                e.MaterialHelper.BindClipPlane(this._activeEffect, o),
                                o.ambientColor.multiplyToRef(this._ambientColor, this._globalAmbientColor);
                                var x = o._forcedViewPosition ? o._forcedViewPosition : o._mirroredCameraPosition ? o._mirroredCameraPosition : o.activeCamera.globalPosition
                                  , p = o.useRightHandedSystem === (null != o._mirroredCameraPosition);
                                s.setFloat4("vEyePosition", x.x, x.y, x.z, p ? -1 : 1),
                                s.setColor3("vAmbientColor", this._globalAmbientColor)
                            }
                            !y && this.isFrozen || (o.lightsEnabled && !this._disableLighting && e.MaterialHelper.BindLights(o, r, this._activeEffect, a, this._maxSimultaneousLights, this._lightFalloff !== i.LIGHTFALLOFF_STANDARD),
                            (o.fogEnabled && r.applyFog && o.fogMode !== e.Scene.FOGMODE_NONE || l) && this.bindView(s),
                            e.MaterialHelper.BindFogParameters(o, r, this._activeEffect, !0),
                            a.NUM_MORPH_INFLUENCERS && e.MaterialHelper.BindMorphTargetParameters(r, this._activeEffect),
                            this._imageProcessingConfiguration.bind(this._activeEffect),
                            e.MaterialHelper.BindLogDepth(a, this._activeEffect, o)),
                            this._uniformBuffer.update(),
                            this._afterBind(r, this._activeEffect)
                        }
                    }
                }
                ,
                i.prototype.getAnimatables = function() {
                    var e = [];
                    return this._albedoTexture && this._albedoTexture.animations && this._albedoTexture.animations.length > 0 && e.push(this._albedoTexture),
                    this._ambientTexture && this._ambientTexture.animations && this._ambientTexture.animations.length > 0 && e.push(this._ambientTexture),
                    this._opacityTexture && this._opacityTexture.animations && this._opacityTexture.animations.length > 0 && e.push(this._opacityTexture),
                    this._reflectionTexture && this._reflectionTexture.animations && this._reflectionTexture.animations.length > 0 && e.push(this._reflectionTexture),
                    this._emissiveTexture && this._emissiveTexture.animations && this._emissiveTexture.animations.length > 0 && e.push(this._emissiveTexture),
                    this._metallicTexture && this._metallicTexture.animations && this._metallicTexture.animations.length > 0 ? e.push(this._metallicTexture) : this._reflectivityTexture && this._reflectivityTexture.animations && this._reflectivityTexture.animations.length > 0 && e.push(this._reflectivityTexture),
                    this._bumpTexture && this._bumpTexture.animations && this._bumpTexture.animations.length > 0 && e.push(this._bumpTexture),
                    this._lightmapTexture && this._lightmapTexture.animations && this._lightmapTexture.animations.length > 0 && e.push(this._lightmapTexture),
                    this._refractionTexture && this._refractionTexture.animations && this._refractionTexture.animations.length > 0 && e.push(this._refractionTexture),
                    e
                }
                ,
                i.prototype._getReflectionTexture = function() {
                    return this._reflectionTexture ? this._reflectionTexture : this.getScene().environmentTexture
                }
                ,
                i.prototype._getRefractionTexture = function() {
                    return this._refractionTexture ? this._refractionTexture : this._linkRefractionWithTransparency ? this.getScene().environmentTexture : null
                }
                ,
                i.prototype.dispose = function(e, t) {
                    t && (this._albedoTexture && this._albedoTexture.dispose(),
                    this._ambientTexture && this._ambientTexture.dispose(),
                    this._opacityTexture && this._opacityTexture.dispose(),
                    this._reflectionTexture && this._reflectionTexture.dispose(),
                    this._environmentBRDFTexture && this.getScene()._environmentBRDFTexture !== this._environmentBRDFTexture && this._environmentBRDFTexture.dispose(),
                    this._emissiveTexture && this._emissiveTexture.dispose(),
                    this._metallicTexture && this._metallicTexture.dispose(),
                    this._reflectivityTexture && this._reflectivityTexture.dispose(),
                    this._bumpTexture && this._bumpTexture.dispose(),
                    this._lightmapTexture && this._lightmapTexture.dispose(),
                    this._refractionTexture && this._refractionTexture.dispose()),
                    this._renderTargets.dispose(),
                    this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),
                    r.prototype.dispose.call(this, e, t)
                }
                ,
                i.LIGHTFALLOFF_PHYSICAL = 0,
                i.LIGHTFALLOFF_GLTF = 1,
                i.LIGHTFALLOFF_STANDARD = 2,
                i._scaledReflectivity = new e.Color3,
                n([e.serializeAsImageProcessingConfiguration()], i.prototype, "_imageProcessingConfiguration", void 0),
                n([e.serialize()], i.prototype, "useLogarithmicDepth", null),
                n([e.serialize()], i.prototype, "transparencyMode", null),
                i
            }(e.PushMaterial);
            e.PBRBaseMaterial = r
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i) {
                    var n = t.call(this, r, i) || this;
                    return n.maxSimultaneousLights = 4,
                    n.disableLighting = !1,
                    n.invertNormalMapX = !1,
                    n.invertNormalMapY = !1,
                    n.emissiveColor = new e.Color3(0,0,0),
                    n.occlusionStrength = 1,
                    n.useLightmapAsShadowmap = !1,
                    n._useAlphaFromAlbedoTexture = !0,
                    n._useAmbientInGrayScale = !0,
                    n
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "doubleSided", {
                    get: function() {
                        return this._twoSidedLighting
                    },
                    set: function(e) {
                        this._twoSidedLighting !== e && (this._twoSidedLighting = e,
                        this.backFaceCulling = !e,
                        this._markAllSubMeshesAsTexturesDirty())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getActiveTextures = function() {
                    var e = t.prototype.getActiveTextures.call(this);
                    return this.environmentTexture && e.push(this.environmentTexture),
                    this.normalTexture && e.push(this.normalTexture),
                    this.emissiveTexture && e.push(this.emissiveTexture),
                    this.occlusionTexture && e.push(this.occlusionTexture),
                    this.lightmapTexture && e.push(this.lightmapTexture),
                    e
                }
                ,
                r.prototype.hasTexture = function(e) {
                    return !!t.prototype.hasTexture.call(this, e) || this.lightmapTexture === e
                }
                ,
                r.prototype.getClassName = function() {
                    return "PBRBaseSimpleMaterial"
                }
                ,
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsLightsDirty")], r.prototype, "maxSimultaneousLights", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsLightsDirty")], r.prototype, "disableLighting", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_reflectionTexture")], r.prototype, "environmentTexture", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "invertNormalMapX", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "invertNormalMapY", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_bumpTexture")], r.prototype, "normalTexture", void 0),
                n([e.serializeAsColor3("emissive"), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "emissiveColor", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "emissiveTexture", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_ambientTextureStrength")], r.prototype, "occlusionStrength", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_ambientTexture")], r.prototype, "occlusionTexture", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_alphaCutOff")], r.prototype, "alphaCutOff", void 0),
                n([e.serialize()], r.prototype, "doubleSided", null),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", null)], r.prototype, "lightmapTexture", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useLightmapAsShadowmap", void 0),
                r
            }(e.PBRBaseMaterial);
            e.PBRBaseSimpleMaterial = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(i, n) {
                    var o = t.call(this, i, n) || this;
                    return o.directIntensity = 1,
                    o.emissiveIntensity = 1,
                    o.environmentIntensity = 1,
                    o.specularIntensity = 1,
                    o.disableBumpMap = !1,
                    o.ambientTextureStrength = 1,
                    o.ambientTextureImpactOnAnalyticalLights = r.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,
                    o.ambientColor = new e.Color3(0,0,0),
                    o.albedoColor = new e.Color3(1,1,1),
                    o.reflectivityColor = new e.Color3(1,1,1),
                    o.reflectionColor = new e.Color3(1,1,1),
                    o.emissiveColor = new e.Color3(0,0,0),
                    o.microSurface = 1,
                    o.indexOfRefraction = .66,
                    o.invertRefractionY = !1,
                    o.linkRefractionWithTransparency = !1,
                    o.useLightmapAsShadowmap = !1,
                    o.useAlphaFromAlbedoTexture = !1,
                    o.forceAlphaTest = !1,
                    o.alphaCutOff = .4,
                    o.useSpecularOverAlpha = !0,
                    o.useMicroSurfaceFromReflectivityMapAlpha = !1,
                    o.useRoughnessFromMetallicTextureAlpha = !0,
                    o.useRoughnessFromMetallicTextureGreen = !1,
                    o.useMetallnessFromMetallicTextureBlue = !1,
                    o.useAmbientOcclusionFromMetallicTextureRed = !1,
                    o.useAmbientInGrayScale = !1,
                    o.useAutoMicroSurfaceFromReflectivityMap = !1,
                    o.useRadianceOverAlpha = !0,
                    o.useObjectSpaceNormalMap = !1,
                    o.useParallax = !1,
                    o.useParallaxOcclusion = !1,
                    o.parallaxScaleBias = .05,
                    o.disableLighting = !1,
                    o.forceIrradianceInFragment = !1,
                    o.maxSimultaneousLights = 4,
                    o.invertNormalMapX = !1,
                    o.invertNormalMapY = !1,
                    o.twoSidedLighting = !1,
                    o.useAlphaFresnel = !1,
                    o.useLinearAlphaFresnel = !1,
                    o.environmentBRDFTexture = null,
                    o.forceNormalForward = !1,
                    o.enableSpecularAntiAliasing = !1,
                    o.useHorizonOcclusion = !0,
                    o.useRadianceOcclusion = !0,
                    o.unlit = !1,
                    o._environmentBRDFTexture = e.TextureTools.GetEnvironmentBRDFTexture(n),
                    o
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "usePhysicalLightFalloff", {
                    get: function() {
                        return this._lightFalloff === e.PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL
                    },
                    set: function(t) {
                        t !== this.usePhysicalLightFalloff && (this._markAllSubMeshesAsTexturesDirty(),
                        this._lightFalloff = t ? e.PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL : e.PBRBaseMaterial.LIGHTFALLOFF_STANDARD)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "useGLTFLightFalloff", {
                    get: function() {
                        return this._lightFalloff === e.PBRBaseMaterial.LIGHTFALLOFF_GLTF
                    },
                    set: function(t) {
                        t !== this.useGLTFLightFalloff && (this._markAllSubMeshesAsTexturesDirty(),
                        this._lightFalloff = t ? e.PBRBaseMaterial.LIGHTFALLOFF_GLTF : e.PBRBaseMaterial.LIGHTFALLOFF_STANDARD)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "imageProcessingConfiguration", {
                    get: function() {
                        return this._imageProcessingConfiguration
                    },
                    set: function(e) {
                        this._attachImageProcessingConfiguration(e),
                        this._markAllSubMeshesAsTexturesDirty()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "cameraColorCurvesEnabled", {
                    get: function() {
                        return this.imageProcessingConfiguration.colorCurvesEnabled
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorCurvesEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "cameraColorGradingEnabled", {
                    get: function() {
                        return this.imageProcessingConfiguration.colorGradingEnabled
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorGradingEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "cameraToneMappingEnabled", {
                    get: function() {
                        return this._imageProcessingConfiguration.toneMappingEnabled
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.toneMappingEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "cameraExposure", {
                    get: function() {
                        return this._imageProcessingConfiguration.exposure
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.exposure = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "cameraContrast", {
                    get: function() {
                        return this._imageProcessingConfiguration.contrast
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.contrast = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "cameraColorGradingTexture", {
                    get: function() {
                        return this._imageProcessingConfiguration.colorGradingTexture
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.colorGradingTexture = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "cameraColorCurves", {
                    get: function() {
                        return this._imageProcessingConfiguration.colorCurves
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.colorCurves = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getClassName = function() {
                    return "PBRMaterial"
                }
                ,
                r.prototype.getActiveTextures = function() {
                    var e = t.prototype.getActiveTextures.call(this);
                    return this._albedoTexture && e.push(this._albedoTexture),
                    this._ambientTexture && e.push(this._ambientTexture),
                    this._opacityTexture && e.push(this._opacityTexture),
                    this._reflectionTexture && e.push(this._reflectionTexture),
                    this._emissiveTexture && e.push(this._emissiveTexture),
                    this._reflectivityTexture && e.push(this._reflectivityTexture),
                    this._metallicTexture && e.push(this._metallicTexture),
                    this._microSurfaceTexture && e.push(this._microSurfaceTexture),
                    this._bumpTexture && e.push(this._bumpTexture),
                    this._lightmapTexture && e.push(this._lightmapTexture),
                    this._refractionTexture && e.push(this._refractionTexture),
                    e
                }
                ,
                r.prototype.hasTexture = function(e) {
                    return !!t.prototype.hasTexture.call(this, e) || (this._albedoTexture === e || (this._ambientTexture === e || (this._opacityTexture === e || (this._reflectionTexture === e || (this._reflectivityTexture === e || (this._metallicTexture === e || (this._microSurfaceTexture === e || (this._bumpTexture === e || (this._lightmapTexture === e || this._refractionTexture === e)))))))))
                }
                ,
                r.prototype.clone = function(t) {
                    var i = this
                      , n = e.SerializationHelper.Clone((function() {
                        return new r(t,i.getScene())
                    }
                    ), this);
                    return n.id = t,
                    n.name = t,
                    n
                }
                ,
                r.prototype.serialize = function() {
                    var t = e.SerializationHelper.Serialize(this);
                    return t.customType = "BABYLON.PBRMaterial",
                    t
                }
                ,
                r.Parse = function(t, i, n) {
                    return e.SerializationHelper.Parse((function() {
                        return new r(t.name,i)
                    }
                    ), t, i, n)
                }
                ,
                r.PBRMATERIAL_OPAQUE = 0,
                r.PBRMATERIAL_ALPHATEST = 1,
                r.PBRMATERIAL_ALPHABLEND = 2,
                r.PBRMATERIAL_ALPHATESTANDBLEND = 3,
                r.DEFAULT_AO_ON_ANALYTICAL_LIGHTS = 1,
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "directIntensity", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "emissiveIntensity", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "environmentIntensity", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "specularIntensity", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "disableBumpMap", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "albedoTexture", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "ambientTexture", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "ambientTextureStrength", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "ambientTextureImpactOnAnalyticalLights", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], r.prototype, "opacityTexture", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "reflectionTexture", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "emissiveTexture", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "reflectivityTexture", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "metallicTexture", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "metallic", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "roughness", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "microSurfaceTexture", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "bumpTexture", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", null)], r.prototype, "lightmapTexture", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "refractionTexture", void 0),
                n([e.serializeAsColor3("ambient"), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "ambientColor", void 0),
                n([e.serializeAsColor3("albedo"), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "albedoColor", void 0),
                n([e.serializeAsColor3("reflectivity"), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "reflectivityColor", void 0),
                n([e.serializeAsColor3("reflection"), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "reflectionColor", void 0),
                n([e.serializeAsColor3("emissive"), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "emissiveColor", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "microSurface", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "indexOfRefraction", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "invertRefractionY", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "linkRefractionWithTransparency", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useLightmapAsShadowmap", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], r.prototype, "useAlphaFromAlbedoTexture", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], r.prototype, "forceAlphaTest", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")], r.prototype, "alphaCutOff", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useSpecularOverAlpha", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useMicroSurfaceFromReflectivityMapAlpha", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useRoughnessFromMetallicTextureAlpha", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useRoughnessFromMetallicTextureGreen", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useMetallnessFromMetallicTextureBlue", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useAmbientOcclusionFromMetallicTextureRed", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useAmbientInGrayScale", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useAutoMicroSurfaceFromReflectivityMap", void 0),
                n([e.serialize()], r.prototype, "usePhysicalLightFalloff", null),
                n([e.serialize()], r.prototype, "useGLTFLightFalloff", null),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useRadianceOverAlpha", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useObjectSpaceNormalMap", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useParallax", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useParallaxOcclusion", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "parallaxScaleBias", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsLightsDirty")], r.prototype, "disableLighting", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "forceIrradianceInFragment", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsLightsDirty")], r.prototype, "maxSimultaneousLights", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "invertNormalMapX", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "invertNormalMapY", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "twoSidedLighting", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useAlphaFresnel", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useLinearAlphaFresnel", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "environmentBRDFTexture", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "forceNormalForward", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "enableSpecularAntiAliasing", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useHorizonOcclusion", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "useRadianceOcclusion", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsMiscDirty")], r.prototype, "unlit", void 0),
                r
            }(e.PBRBaseMaterial);
            e.PBRMaterial = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(e, r) {
                    var i = t.call(this, e, r) || this;
                    return i._useRoughnessFromMetallicTextureAlpha = !1,
                    i._useRoughnessFromMetallicTextureGreen = !0,
                    i._useMetallnessFromMetallicTextureBlue = !0,
                    i.metallic = 1,
                    i.roughness = 1,
                    i
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "PBRMetallicRoughnessMaterial"
                }
                ,
                r.prototype.getActiveTextures = function() {
                    var e = t.prototype.getActiveTextures.call(this);
                    return this.baseTexture && e.push(this.baseTexture),
                    this.metallicRoughnessTexture && e.push(this.metallicRoughnessTexture),
                    e
                }
                ,
                r.prototype.hasTexture = function(e) {
                    return !!t.prototype.hasTexture.call(this, e) || (this.baseTexture === e || this.metallicRoughnessTexture === e)
                }
                ,
                r.prototype.clone = function(t) {
                    var i = this
                      , n = e.SerializationHelper.Clone((function() {
                        return new r(t,i.getScene())
                    }
                    ), this);
                    return n.id = t,
                    n.name = t,
                    n
                }
                ,
                r.prototype.serialize = function() {
                    var t = e.SerializationHelper.Serialize(this);
                    return t.customType = "BABYLON.PBRMetallicRoughnessMaterial",
                    t
                }
                ,
                r.Parse = function(t, i, n) {
                    return e.SerializationHelper.Parse((function() {
                        return new r(t.name,i)
                    }
                    ), t, i, n)
                }
                ,
                n([e.serializeAsColor3(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_albedoColor")], r.prototype, "baseColor", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_albedoTexture")], r.prototype, "baseTexture", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "metallic", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], r.prototype, "roughness", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_metallicTexture")], r.prototype, "metallicRoughnessTexture", void 0),
                r
            }(e.PBRBaseSimpleMaterial);
            e.PBRMetallicRoughnessMaterial = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(e, r) {
                    var i = t.call(this, e, r) || this;
                    return i._useMicroSurfaceFromReflectivityMapAlpha = !0,
                    i
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "PBRSpecularGlossinessMaterial"
                }
                ,
                r.prototype.getActiveTextures = function() {
                    var e = t.prototype.getActiveTextures.call(this);
                    return this.diffuseTexture && e.push(this.diffuseTexture),
                    this.specularGlossinessTexture && e.push(this.specularGlossinessTexture),
                    e
                }
                ,
                r.prototype.hasTexture = function(e) {
                    return !!t.prototype.hasTexture.call(this, e) || (this.diffuseTexture === e || this.specularGlossinessTexture === e)
                }
                ,
                r.prototype.clone = function(t) {
                    var i = this
                      , n = e.SerializationHelper.Clone((function() {
                        return new r(t,i.getScene())
                    }
                    ), this);
                    return n.id = t,
                    n.name = t,
                    n
                }
                ,
                r.prototype.serialize = function() {
                    var t = e.SerializationHelper.Serialize(this);
                    return t.customType = "BABYLON.PBRSpecularGlossinessMaterial",
                    t
                }
                ,
                r.Parse = function(t, i, n) {
                    return e.SerializationHelper.Parse((function() {
                        return new r(t.name,i)
                    }
                    ), t, i, n)
                }
                ,
                n([e.serializeAsColor3("diffuse"), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_albedoColor")], r.prototype, "diffuseColor", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_albedoTexture")], r.prototype, "diffuseTexture", void 0),
                n([e.serializeAsColor3("specular"), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_reflectivityColor")], r.prototype, "specularColor", void 0),
                n([e.serialize(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_microSurface")], r.prototype, "glossiness", void 0),
                n([e.serializeAsTexture(), e.expandToProperty("_markAllSubMeshesAsTexturesDirty", "_reflectivityTexture")], r.prototype, "specularGlossinessTexture", void 0),
                r
            }(e.PBRBaseSimpleMaterial);
            e.PBRSpecularGlossinessMaterial = t
        }(s || (s = {})),
        function(e) {
            e.CameraInputTypes = {};
            var t = function() {
                function t(e) {
                    this.attached = {},
                    this.camera = e,
                    this.checkInputs = function() {}
                }
                return t.prototype.add = function(t) {
                    var r = t.getSimpleName();
                    this.attached[r] ? e.Tools.Warn("camera input of type " + r + " already exists on camera") : (this.attached[r] = t,
                    t.camera = this.camera,
                    t.checkInputs && (this.checkInputs = this._addCheckInputs(t.checkInputs.bind(t))),
                    this.attachedElement && t.attachControl(this.attachedElement))
                }
                ,
                t.prototype.remove = function(e) {
                    for (var t in this.attached) {
                        var r = this.attached[t];
                        r === e && (r.detachControl(this.attachedElement),
                        r.camera = null,
                        delete this.attached[t],
                        this.rebuildInputCheck())
                    }
                }
                ,
                t.prototype.removeByType = function(e) {
                    for (var t in this.attached) {
                        var r = this.attached[t];
                        r.getClassName() === e && (r.detachControl(this.attachedElement),
                        r.camera = null,
                        delete this.attached[t],
                        this.rebuildInputCheck())
                    }
                }
                ,
                t.prototype._addCheckInputs = function(e) {
                    var t = this.checkInputs;
                    return function() {
                        t(),
                        e()
                    }
                }
                ,
                t.prototype.attachInput = function(e) {
                    this.attachedElement && e.attachControl(this.attachedElement, this.noPreventDefault)
                }
                ,
                t.prototype.attachElement = function(t, r) {
                    if (void 0 === r && (r = !1),
                    !this.attachedElement)
                        for (var i in r = !e.Camera.ForceAttachControlToAlwaysPreventDefault && r,
                        this.attachedElement = t,
                        this.noPreventDefault = r,
                        this.attached)
                            this.attached[i].attachControl(t, r)
                }
                ,
                t.prototype.detachElement = function(e, t) {
                    if (void 0 === t && (t = !1),
                    this.attachedElement === e) {
                        for (var r in this.attached)
                            this.attached[r].detachControl(e),
                            t && (this.attached[r].camera = null);
                        this.attachedElement = null
                    }
                }
                ,
                t.prototype.rebuildInputCheck = function() {
                    for (var e in this.checkInputs = function() {}
                    ,
                    this.attached) {
                        var t = this.attached[e];
                        t.checkInputs && (this.checkInputs = this._addCheckInputs(t.checkInputs.bind(t)))
                    }
                }
                ,
                t.prototype.clear = function() {
                    this.attachedElement && this.detachElement(this.attachedElement, !0),
                    this.attached = {},
                    this.attachedElement = null,
                    this.checkInputs = function() {}
                }
                ,
                t.prototype.serialize = function(t) {
                    var r = {};
                    for (var i in this.attached) {
                        var n = this.attached[i]
                          , o = e.SerializationHelper.Serialize(n);
                        r[n.getClassName()] = o
                    }
                    t.inputsmgr = r
                }
                ,
                t.prototype.parse = function(t) {
                    var r = t.inputsmgr;
                    if (r)
                        for (var i in this.clear(),
                        r) {
                            if (a = e.CameraInputTypes[i]) {
                                var n = r[i]
                                  , o = e.SerializationHelper.Parse((function() {
                                    return new a
                                }
                                ), n, null);
                                this.add(o)
                            }
                        }
                    else
                        for (var i in this.attached) {
                            var a;
                            if (a = e.CameraInputTypes[this.attached[i].getClassName()]) {
                                o = e.SerializationHelper.Parse((function() {
                                    return new a
                                }
                                ), t, null);
                                this.remove(this.attached[i]),
                                this.add(o)
                            }
                        }
                }
                ,
                t
            }();
            e.CameraInputsManager = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o) {
                    void 0 === o && (o = !0);
                    var a = t.call(this, r, i, n, o) || this;
                    return a.cameraDirection = new e.Vector3(0,0,0),
                    a.cameraRotation = new e.Vector2(0,0),
                    a.rotation = new e.Vector3(0,0,0),
                    a.speed = 2,
                    a.noRotationConstraint = !1,
                    a.lockedTarget = null,
                    a._currentTarget = e.Vector3.Zero(),
                    a._viewMatrix = e.Matrix.Zero(),
                    a._camMatrix = e.Matrix.Zero(),
                    a._cameraTransformMatrix = e.Matrix.Zero(),
                    a._cameraRotationMatrix = e.Matrix.Zero(),
                    a._referencePoint = new e.Vector3(0,0,1),
                    a._transformedReferencePoint = e.Vector3.Zero(),
                    a._globalCurrentTarget = e.Vector3.Zero(),
                    a._globalCurrentUpVector = e.Vector3.Zero(),
                    a._defaultUp = e.Vector3.Up(),
                    a._cachedRotationZ = 0,
                    a._cachedQuaternionRotationZ = 0,
                    a
                }
                return o(r, t),
                r.prototype.getFrontPosition = function(e) {
                    this.getWorldMatrix();
                    var t = this.getTarget().subtract(this.position);
                    return t.normalize(),
                    t.scaleInPlace(e),
                    this.globalPosition.add(t)
                }
                ,
                r.prototype._getLockedTargetPosition = function() {
                    return this.lockedTarget ? (this.lockedTarget.absolutePosition && this.lockedTarget.computeWorldMatrix(),
                    this.lockedTarget.absolutePosition || this.lockedTarget) : null
                }
                ,
                r.prototype.storeState = function() {
                    return this._storedPosition = this.position.clone(),
                    this._storedRotation = this.rotation.clone(),
                    this.rotationQuaternion && (this._storedRotationQuaternion = this.rotationQuaternion.clone()),
                    t.prototype.storeState.call(this)
                }
                ,
                r.prototype._restoreStateValues = function() {
                    return !!t.prototype._restoreStateValues.call(this) && (this.position = this._storedPosition.clone(),
                    this.rotation = this._storedRotation.clone(),
                    this.rotationQuaternion && (this.rotationQuaternion = this._storedRotationQuaternion.clone()),
                    this.cameraDirection.copyFromFloats(0, 0, 0),
                    this.cameraRotation.copyFromFloats(0, 0),
                    !0)
                }
                ,
                r.prototype._initCache = function() {
                    t.prototype._initCache.call(this),
                    this._cache.lockedTarget = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),
                    this._cache.rotation = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),
                    this._cache.rotationQuaternion = new e.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)
                }
                ,
                r.prototype._updateCache = function(e) {
                    e || t.prototype._updateCache.call(this);
                    var r = this._getLockedTargetPosition();
                    r ? this._cache.lockedTarget ? this._cache.lockedTarget.copyFrom(r) : this._cache.lockedTarget = r.clone() : this._cache.lockedTarget = null,
                    this._cache.rotation.copyFrom(this.rotation),
                    this.rotationQuaternion && this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)
                }
                ,
                r.prototype._isSynchronizedViewMatrix = function() {
                    if (!t.prototype._isSynchronizedViewMatrix.call(this))
                        return !1;
                    var e = this._getLockedTargetPosition();
                    return (this._cache.lockedTarget ? this._cache.lockedTarget.equals(e) : !e) && (this.rotationQuaternion ? this.rotationQuaternion.equals(this._cache.rotationQuaternion) : this._cache.rotation.equals(this.rotation))
                }
                ,
                r.prototype._computeLocalCameraSpeed = function() {
                    var e = this.getEngine();
                    return this.speed * Math.sqrt(e.getDeltaTime() / (100 * e.getFps()))
                }
                ,
                r.prototype.setTarget = function(t) {
                    this.upVector.normalize(),
                    this.position.z === t.z && (this.position.z += e.Epsilon),
                    e.Matrix.LookAtLHToRef(this.position, t, this._defaultUp, this._camMatrix),
                    this._camMatrix.invert(),
                    this.rotation.x = Math.atan(this._camMatrix.m[6] / this._camMatrix.m[10]);
                    var r = t.subtract(this.position);
                    r.x >= 0 ? this.rotation.y = -Math.atan(r.z / r.x) + Math.PI / 2 : this.rotation.y = -Math.atan(r.z / r.x) - Math.PI / 2,
                    this.rotation.z = 0,
                    isNaN(this.rotation.x) && (this.rotation.x = 0),
                    isNaN(this.rotation.y) && (this.rotation.y = 0),
                    isNaN(this.rotation.z) && (this.rotation.z = 0),
                    this.rotationQuaternion && e.Quaternion.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this.rotationQuaternion)
                }
                ,
                r.prototype.getTarget = function() {
                    return this._currentTarget
                }
                ,
                r.prototype._decideIfNeedsToMove = function() {
                    return Math.abs(this.cameraDirection.x) > 0 || Math.abs(this.cameraDirection.y) > 0 || Math.abs(this.cameraDirection.z) > 0
                }
                ,
                r.prototype._updatePosition = function() {
                    if (this.parent)
                        return this.parent.getWorldMatrix().invertToRef(e.Tmp.Matrix[0]),
                        e.Vector3.TransformNormalToRef(this.cameraDirection, e.Tmp.Matrix[0], e.Tmp.Vector3[0]),
                        void this.position.addInPlace(e.Tmp.Vector3[0]);
                    this.position.addInPlace(this.cameraDirection)
                }
                ,
                r.prototype._checkInputs = function() {
                    var r = this._decideIfNeedsToMove()
                      , i = Math.abs(this.cameraRotation.x) > 0 || Math.abs(this.cameraRotation.y) > 0;
                    if (r && this._updatePosition(),
                    i) {
                        if (this.rotation.x += this.cameraRotation.x,
                        this.rotation.y += this.cameraRotation.y,
                        this.rotationQuaternion)
                            this.rotation.lengthSquared() && e.Quaternion.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this.rotationQuaternion);
                        if (!this.noRotationConstraint) {
                            var n = Math.PI / 2 * .95;
                            this.rotation.x > n && (this.rotation.x = n),
                            this.rotation.x < -n && (this.rotation.x = -n)
                        }
                    }
                    r && (Math.abs(this.cameraDirection.x) < this.speed * e.Epsilon && (this.cameraDirection.x = 0),
                    Math.abs(this.cameraDirection.y) < this.speed * e.Epsilon && (this.cameraDirection.y = 0),
                    Math.abs(this.cameraDirection.z) < this.speed * e.Epsilon && (this.cameraDirection.z = 0),
                    this.cameraDirection.scaleInPlace(this.inertia)),
                    i && (Math.abs(this.cameraRotation.x) < this.speed * e.Epsilon && (this.cameraRotation.x = 0),
                    Math.abs(this.cameraRotation.y) < this.speed * e.Epsilon && (this.cameraRotation.y = 0),
                    this.cameraRotation.scaleInPlace(this.inertia)),
                    t.prototype._checkInputs.call(this)
                }
                ,
                r.prototype._updateCameraRotationMatrix = function() {
                    this.rotationQuaternion ? this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix) : e.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this._cameraRotationMatrix)
                }
                ,
                r.prototype._rotateUpVectorWithCameraRotationMatrix = function() {
                    return e.Vector3.TransformNormalToRef(this._defaultUp, this._cameraRotationMatrix, this.upVector),
                    this
                }
                ,
                r.prototype._getViewMatrix = function() {
                    return this.lockedTarget && this.setTarget(this._getLockedTargetPosition()),
                    this._updateCameraRotationMatrix(),
                    this.rotationQuaternion && this._cachedQuaternionRotationZ != this.rotationQuaternion.z ? (this._rotateUpVectorWithCameraRotationMatrix(),
                    this._cachedQuaternionRotationZ = this.rotationQuaternion.z) : this._cachedRotationZ != this.rotation.z && (this._rotateUpVectorWithCameraRotationMatrix(),
                    this._cachedRotationZ = this.rotation.z),
                    e.Vector3.TransformCoordinatesToRef(this._referencePoint, this._cameraRotationMatrix, this._transformedReferencePoint),
                    this.position.addToRef(this._transformedReferencePoint, this._currentTarget),
                    this._computeViewMatrix(this.position, this._currentTarget, this.upVector),
                    this._viewMatrix
                }
                ,
                r.prototype._computeViewMatrix = function(t, r, i) {
                    if (this.parent) {
                        var n = this.parent.getWorldMatrix();
                        e.Vector3.TransformCoordinatesToRef(t, n, this._globalPosition),
                        e.Vector3.TransformCoordinatesToRef(r, n, this._globalCurrentTarget),
                        e.Vector3.TransformNormalToRef(i, n, this._globalCurrentUpVector),
                        this._markSyncedWithParent()
                    } else
                        this._globalPosition.copyFrom(t),
                        this._globalCurrentTarget.copyFrom(r),
                        this._globalCurrentUpVector.copyFrom(i);
                    this.getScene().useRightHandedSystem ? e.Matrix.LookAtRHToRef(this._globalPosition, this._globalCurrentTarget, this._globalCurrentUpVector, this._viewMatrix) : e.Matrix.LookAtLHToRef(this._globalPosition, this._globalCurrentTarget, this._globalCurrentUpVector, this._viewMatrix)
                }
                ,
                r.prototype.createRigCamera = function(t, i) {
                    if (this.cameraRigMode !== e.Camera.RIG_MODE_NONE) {
                        var n = new r(t,this.position.clone(),this.getScene());
                        return this.cameraRigMode !== e.Camera.RIG_MODE_VR && this.cameraRigMode !== e.Camera.RIG_MODE_WEBVR || (this.rotationQuaternion || (this.rotationQuaternion = new e.Quaternion),
                        n._cameraRigParams = {},
                        n.rotationQuaternion = new e.Quaternion),
                        n
                    }
                    return null
                }
                ,
                r.prototype._updateRigCameras = function() {
                    var r = this._rigCameras[0]
                      , i = this._rigCameras[1];
                    switch (this.cameraRigMode) {
                    case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:
                    case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:
                    case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:
                    case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:
                        var n = this.cameraRigMode === e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED ? 1 : -1
                          , o = this.cameraRigMode === e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED ? -1 : 1;
                        this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle * n, r.position),
                        this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle * o, i.position),
                        r.setTarget(this.getTarget()),
                        i.setTarget(this.getTarget());
                        break;
                    case e.Camera.RIG_MODE_VR:
                        r.rotationQuaternion ? (r.rotationQuaternion.copyFrom(this.rotationQuaternion),
                        i.rotationQuaternion.copyFrom(this.rotationQuaternion)) : (r.rotation.copyFrom(this.rotation),
                        i.rotation.copyFrom(this.rotation)),
                        r.position.copyFrom(this.position),
                        i.position.copyFrom(this.position)
                    }
                    t.prototype._updateRigCameras.call(this)
                }
                ,
                r.prototype._getRigCamPosition = function(t, r) {
                    this._rigCamTransformMatrix || (this._rigCamTransformMatrix = new e.Matrix);
                    var i = this.getTarget();
                    e.Matrix.Translation(-i.x, -i.y, -i.z).multiplyToRef(e.Matrix.RotationY(t), this._rigCamTransformMatrix),
                    this._rigCamTransformMatrix = this._rigCamTransformMatrix.multiply(e.Matrix.Translation(i.x, i.y, i.z)),
                    e.Vector3.TransformCoordinatesToRef(this.position, this._rigCamTransformMatrix, r)
                }
                ,
                r.prototype.getClassName = function() {
                    return "TargetCamera"
                }
                ,
                n([e.serializeAsVector3()], r.prototype, "rotation", void 0),
                n([e.serialize()], r.prototype, "speed", void 0),
                n([e.serializeAsMeshReference("lockedTargetId")], r.prototype, "lockedTarget", void 0),
                r
            }(e.Camera);
            e.TargetCamera = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e) {
                    void 0 === e && (e = !0),
                    this.touchEnabled = e,
                    this.buttons = [0, 1, 2],
                    this.angularSensibility = 2e3,
                    this.previousPosition = null
                }
                return t.prototype.attachControl = function(t, r) {
                    var i = this
                      , n = this.camera.getEngine();
                    this._pointerInput || (this._pointerInput = function(o, a) {
                        var s = o.event;
                        if (!n.isInVRExclusivePointerMode && (i.touchEnabled || "touch" !== s.pointerType) && (o.type === e.PointerEventTypes.POINTERMOVE || -1 !== i.buttons.indexOf(s.button))) {
                            var y = s.srcElement || s.target;
                            if (o.type === e.PointerEventTypes.POINTERDOWN && y) {
                                try {
                                    y.setPointerCapture(s.pointerId)
                                } catch (e) {}
                                i.previousPosition = {
                                    x: s.clientX,
                                    y: s.clientY
                                },
                                r || (s.preventDefault(),
                                t.focus())
                            } else if (o.type === e.PointerEventTypes.POINTERUP && y) {
                                try {
                                    y.releasePointerCapture(s.pointerId)
                                } catch (e) {}
                                i.previousPosition = null,
                                r || s.preventDefault()
                            } else if (o.type === e.PointerEventTypes.POINTERMOVE) {
                                if (!i.previousPosition || n.isPointerLock)
                                    return;
                                var l = s.clientX - i.previousPosition.x;
                                i.camera.getScene().useRightHandedSystem && (l *= -1),
                                i.camera.parent && i.camera.parent._getWorldMatrixDeterminant() < 0 && (l *= -1),
                                i.camera.cameraRotation.y += l / i.angularSensibility;
                                var c = s.clientY - i.previousPosition.y;
                                i.camera.cameraRotation.x += c / i.angularSensibility,
                                i.previousPosition = {
                                    x: s.clientX,
                                    y: s.clientY
                                },
                                r || s.preventDefault()
                            }
                        }
                    }
                    ),
                    this._onMouseMove = function(e) {
                        if (n.isPointerLock && !n.isInVRExclusivePointerMode) {
                            var t = e.movementX || e.mozMovementX || e.webkitMovementX || e.msMovementX || 0;
                            i.camera.getScene().useRightHandedSystem && (t *= -1),
                            i.camera.parent && i.camera.parent._getWorldMatrixDeterminant() < 0 && (t *= -1),
                            i.camera.cameraRotation.y += t / i.angularSensibility;
                            var o = e.movementY || e.mozMovementY || e.webkitMovementY || e.msMovementY || 0;
                            i.camera.cameraRotation.x += o / i.angularSensibility,
                            i.previousPosition = null,
                            r || e.preventDefault()
                        }
                    }
                    ,
                    this._observer = this.camera.getScene().onPointerObservable.add(this._pointerInput, e.PointerEventTypes.POINTERDOWN | e.PointerEventTypes.POINTERUP | e.PointerEventTypes.POINTERMOVE),
                    t.addEventListener("mousemove", this._onMouseMove, !1)
                }
                ,
                t.prototype.detachControl = function(e) {
                    this._observer && e && (this.camera.getScene().onPointerObservable.remove(this._observer),
                    this._onMouseMove && e.removeEventListener("mousemove", this._onMouseMove),
                    this._observer = null,
                    this._onMouseMove = null,
                    this.previousPosition = null)
                }
                ,
                t.prototype.getClassName = function() {
                    return "FreeCameraMouseInput"
                }
                ,
                t.prototype.getSimpleName = function() {
                    return "mouse"
                }
                ,
                n([e.serialize()], t.prototype, "buttons", void 0),
                n([e.serialize()], t.prototype, "angularSensibility", void 0),
                t
            }();
            e.FreeCameraMouseInput = t,
            e.CameraInputTypes.FreeCameraMouseInput = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.keysUp = [38],
                    this.keysDown = [40],
                    this.keysLeft = [37],
                    this.keysRight = [39],
                    this._keys = new Array
                }
                return t.prototype.attachControl = function(t, r) {
                    var i = this;
                    this._onCanvasBlurObserver || (this._scene = this.camera.getScene(),
                    this._engine = this._scene.getEngine(),
                    this._onCanvasBlurObserver = this._engine.onCanvasBlurObservable.add((function() {
                        i._keys = []
                    }
                    )),
                    this._onKeyboardObserver = this._scene.onKeyboardObservable.add((function(t) {
                        var n, o = t.event;
                        t.type === e.KeyboardEventTypes.KEYDOWN ? -1 === i.keysUp.indexOf(o.keyCode) && -1 === i.keysDown.indexOf(o.keyCode) && -1 === i.keysLeft.indexOf(o.keyCode) && -1 === i.keysRight.indexOf(o.keyCode) || (-1 === (n = i._keys.indexOf(o.keyCode)) && i._keys.push(o.keyCode),
                        r || o.preventDefault()) : -1 === i.keysUp.indexOf(o.keyCode) && -1 === i.keysDown.indexOf(o.keyCode) && -1 === i.keysLeft.indexOf(o.keyCode) && -1 === i.keysRight.indexOf(o.keyCode) || ((n = i._keys.indexOf(o.keyCode)) >= 0 && i._keys.splice(n, 1),
                        r || o.preventDefault())
                    }
                    )))
                }
                ,
                t.prototype.detachControl = function(e) {
                    this._scene && (this._onKeyboardObserver && this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),
                    this._onCanvasBlurObserver && this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),
                    this._onKeyboardObserver = null,
                    this._onCanvasBlurObserver = null),
                    this._keys = []
                }
                ,
                t.prototype.checkInputs = function() {
                    if (this._onKeyboardObserver)
                        for (var t = this.camera, r = 0; r < this._keys.length; r++) {
                            var i = this._keys[r]
                              , n = t._computeLocalCameraSpeed();
                            -1 !== this.keysLeft.indexOf(i) ? t._localDirection.copyFromFloats(-n, 0, 0) : -1 !== this.keysUp.indexOf(i) ? t._localDirection.copyFromFloats(0, 0, n) : -1 !== this.keysRight.indexOf(i) ? t._localDirection.copyFromFloats(n, 0, 0) : -1 !== this.keysDown.indexOf(i) && t._localDirection.copyFromFloats(0, 0, -n),
                            t.getScene().useRightHandedSystem && (t._localDirection.z *= -1),
                            t.getViewMatrix().invertToRef(t._cameraTransformMatrix),
                            e.Vector3.TransformNormalToRef(t._localDirection, t._cameraTransformMatrix, t._transformedDirection),
                            t.cameraDirection.addInPlace(t._transformedDirection)
                        }
                }
                ,
                t.prototype.getClassName = function() {
                    return "FreeCameraKeyboardMoveInput"
                }
                ,
                t.prototype._onLostFocus = function(e) {
                    this._keys = []
                }
                ,
                t.prototype.getSimpleName = function() {
                    return "keyboard"
                }
                ,
                n([e.serialize()], t.prototype, "keysUp", void 0),
                n([e.serialize()], t.prototype, "keysDown", void 0),
                n([e.serialize()], t.prototype, "keysLeft", void 0),
                n([e.serialize()], t.prototype, "keysRight", void 0),
                t
            }();
            e.FreeCameraKeyboardMoveInput = t,
            e.CameraInputTypes.FreeCameraKeyboardMoveInput = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(e) {
                    return t.call(this, e) || this
                }
                return o(r, t),
                r.prototype.addKeyboard = function() {
                    return this.add(new e.FreeCameraKeyboardMoveInput),
                    this
                }
                ,
                r.prototype.addMouse = function(t) {
                    return void 0 === t && (t = !0),
                    this.add(new e.FreeCameraMouseInput(t)),
                    this
                }
                ,
                r.prototype.addDeviceOrientation = function() {
                    return this.add(new e.FreeCameraDeviceOrientationInput),
                    this
                }
                ,
                r.prototype.addTouch = function() {
                    return this.add(new e.FreeCameraTouchInput),
                    this
                }
                ,
                r.prototype.addVirtualJoystick = function() {
                    return this.add(new e.FreeCameraVirtualJoystickInput),
                    this
                }
                ,
                r
            }(e.CameraInputsManager);
            e.FreeCameraInputsManager = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("FreeCamera", (function(t, r) {
                return function() {
                    return new e.UniversalCamera(t,e.Vector3.Zero(),r)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o) {
                    void 0 === o && (o = !0);
                    var a = t.call(this, r, i, n, o) || this;
                    return a.ellipsoid = new e.Vector3(.5,1,.5),
                    a.ellipsoidOffset = new e.Vector3(0,0,0),
                    a.checkCollisions = !1,
                    a.applyGravity = !1,
                    a._needMoveForGravity = !1,
                    a._oldPosition = e.Vector3.Zero(),
                    a._diffPosition = e.Vector3.Zero(),
                    a._newPosition = e.Vector3.Zero(),
                    a._collisionMask = -1,
                    a._onCollisionPositionChange = function(t, r, i) {
                        void 0 === i && (i = null),
                        a.getScene().workerCollisions && r.multiplyInPlace(a._collider._radius);
                        var n;
                        n = r,
                        a._newPosition.copyFrom(n),
                        a._newPosition.subtractToRef(a._oldPosition, a._diffPosition),
                        a._diffPosition.length() > e.Engine.CollisionsEpsilon && (a.position.addInPlace(a._diffPosition),
                        a.onCollide && i && a.onCollide(i))
                    }
                    ,
                    a.inputs = new e.FreeCameraInputsManager(a),
                    a.inputs.addKeyboard().addMouse(),
                    a
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "angularSensibility", {
                    get: function() {
                        var e = this.inputs.attached.mouse;
                        return e ? e.angularSensibility : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.mouse;
                        t && (t.angularSensibility = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "keysUp", {
                    get: function() {
                        var e = this.inputs.attached.keyboard;
                        return e ? e.keysUp : []
                    },
                    set: function(e) {
                        var t = this.inputs.attached.keyboard;
                        t && (t.keysUp = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "keysDown", {
                    get: function() {
                        var e = this.inputs.attached.keyboard;
                        return e ? e.keysDown : []
                    },
                    set: function(e) {
                        var t = this.inputs.attached.keyboard;
                        t && (t.keysDown = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "keysLeft", {
                    get: function() {
                        var e = this.inputs.attached.keyboard;
                        return e ? e.keysLeft : []
                    },
                    set: function(e) {
                        var t = this.inputs.attached.keyboard;
                        t && (t.keysLeft = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "keysRight", {
                    get: function() {
                        var e = this.inputs.attached.keyboard;
                        return e ? e.keysRight : []
                    },
                    set: function(e) {
                        var t = this.inputs.attached.keyboard;
                        t && (t.keysRight = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.attachControl = function(e, t) {
                    this.inputs.attachElement(e, t)
                }
                ,
                r.prototype.detachControl = function(t) {
                    this.inputs.detachElement(t),
                    this.cameraDirection = new e.Vector3(0,0,0),
                    this.cameraRotation = new e.Vector2(0,0)
                }
                ,
                Object.defineProperty(r.prototype, "collisionMask", {
                    get: function() {
                        return this._collisionMask
                    },
                    set: function(e) {
                        this._collisionMask = isNaN(e) ? -1 : e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._collideWithWorld = function(t) {
                    (this.parent ? e.Vector3.TransformCoordinates(this.position, this.parent.getWorldMatrix()) : this.position).subtractFromFloatsToRef(0, this.ellipsoid.y, 0, this._oldPosition),
                    this._oldPosition.addInPlace(this.ellipsoidOffset),
                    this._collider || (this._collider = new e.Collider),
                    this._collider._radius = this.ellipsoid,
                    this._collider.collisionMask = this._collisionMask;
                    var r = t;
                    this.applyGravity && (r = t.add(this.getScene().gravity)),
                    this.getScene().collisionCoordinator.getNewPosition(this._oldPosition, r, this._collider, 3, null, this._onCollisionPositionChange, this.uniqueId)
                }
                ,
                r.prototype._checkInputs = function() {
                    this._localDirection || (this._localDirection = e.Vector3.Zero(),
                    this._transformedDirection = e.Vector3.Zero()),
                    this.inputs.checkInputs(),
                    t.prototype._checkInputs.call(this)
                }
                ,
                r.prototype._decideIfNeedsToMove = function() {
                    return this._needMoveForGravity || Math.abs(this.cameraDirection.x) > 0 || Math.abs(this.cameraDirection.y) > 0 || Math.abs(this.cameraDirection.z) > 0
                }
                ,
                r.prototype._updatePosition = function() {
                    this.checkCollisions && this.getScene().collisionsEnabled ? this._collideWithWorld(this.cameraDirection) : t.prototype._updatePosition.call(this)
                }
                ,
                r.prototype.dispose = function() {
                    this.inputs.clear(),
                    t.prototype.dispose.call(this)
                }
                ,
                r.prototype.getClassName = function() {
                    return "FreeCamera"
                }
                ,
                n([e.serializeAsVector3()], r.prototype, "ellipsoid", void 0),
                n([e.serializeAsVector3()], r.prototype, "ellipsoidOffset", void 0),
                n([e.serialize()], r.prototype, "checkCollisions", void 0),
                n([e.serialize()], r.prototype, "applyGravity", void 0),
                r
            }(e.TargetCamera);
            e.FreeCamera = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.keysUp = [38],
                    this.keysDown = [40],
                    this.keysLeft = [37],
                    this.keysRight = [39],
                    this.keysReset = [220],
                    this.panningSensibility = 50,
                    this.zoomingSensibility = 25,
                    this.useAltToZoom = !0,
                    this.angularSpeed = .01,
                    this._keys = new Array
                }
                return t.prototype.attachControl = function(t, r) {
                    var i = this;
                    this._onCanvasBlurObserver || (this._scene = this.camera.getScene(),
                    this._engine = this._scene.getEngine(),
                    this._onCanvasBlurObserver = this._engine.onCanvasBlurObservable.add((function() {
                        i._keys = []
                    }
                    )),
                    this._onKeyboardObserver = this._scene.onKeyboardObservable.add((function(t) {
                        var n, o = t.event;
                        t.type === e.KeyboardEventTypes.KEYDOWN ? (i._ctrlPressed = o.ctrlKey,
                        i._altPressed = o.altKey,
                        (-1 !== i.keysUp.indexOf(o.keyCode) || -1 !== i.keysDown.indexOf(o.keyCode) || -1 !== i.keysLeft.indexOf(o.keyCode) || -1 !== i.keysRight.indexOf(o.keyCode) || -1 !== i.keysReset.indexOf(o.keyCode)) && (-1 === (n = i._keys.indexOf(o.keyCode)) && i._keys.push(o.keyCode),
                        o.preventDefault && (r || o.preventDefault()))) : -1 === i.keysUp.indexOf(o.keyCode) && -1 === i.keysDown.indexOf(o.keyCode) && -1 === i.keysLeft.indexOf(o.keyCode) && -1 === i.keysRight.indexOf(o.keyCode) && -1 === i.keysReset.indexOf(o.keyCode) || ((n = i._keys.indexOf(o.keyCode)) >= 0 && i._keys.splice(n, 1),
                        o.preventDefault && (r || o.preventDefault()))
                    }
                    )))
                }
                ,
                t.prototype.detachControl = function(e) {
                    this._scene && (this._onKeyboardObserver && this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),
                    this._onCanvasBlurObserver && this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),
                    this._onKeyboardObserver = null,
                    this._onCanvasBlurObserver = null),
                    this._keys = []
                }
                ,
                t.prototype.checkInputs = function() {
                    if (this._onKeyboardObserver)
                        for (var e = this.camera, t = 0; t < this._keys.length; t++) {
                            var r = this._keys[t];
                            -1 !== this.keysLeft.indexOf(r) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningX -= 1 / this.panningSensibility : e.inertialAlphaOffset -= this.angularSpeed : -1 !== this.keysUp.indexOf(r) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningY += 1 / this.panningSensibility : this._altPressed && this.useAltToZoom ? e.inertialRadiusOffset += 1 / this.zoomingSensibility : e.inertialBetaOffset -= this.angularSpeed : -1 !== this.keysRight.indexOf(r) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningX += 1 / this.panningSensibility : e.inertialAlphaOffset += this.angularSpeed : -1 !== this.keysDown.indexOf(r) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningY -= 1 / this.panningSensibility : this._altPressed && this.useAltToZoom ? e.inertialRadiusOffset -= 1 / this.zoomingSensibility : e.inertialBetaOffset += this.angularSpeed : -1 !== this.keysReset.indexOf(r) && e.useInputToRestoreState && e.restoreState()
                        }
                }
                ,
                t.prototype.getClassName = function() {
                    return "ArcRotateCameraKeyboardMoveInput"
                }
                ,
                t.prototype.getSimpleName = function() {
                    return "keyboard"
                }
                ,
                n([e.serialize()], t.prototype, "keysUp", void 0),
                n([e.serialize()], t.prototype, "keysDown", void 0),
                n([e.serialize()], t.prototype, "keysLeft", void 0),
                n([e.serialize()], t.prototype, "keysRight", void 0),
                n([e.serialize()], t.prototype, "keysReset", void 0),
                n([e.serialize()], t.prototype, "panningSensibility", void 0),
                n([e.serialize()], t.prototype, "zoomingSensibility", void 0),
                n([e.serialize()], t.prototype, "useAltToZoom", void 0),
                n([e.serialize()], t.prototype, "angularSpeed", void 0),
                t
            }();
            e.ArcRotateCameraKeyboardMoveInput = t,
            e.CameraInputTypes.ArcRotateCameraKeyboardMoveInput = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.wheelPrecision = 3,
                    this.wheelDeltaPercentage = 0
                }
                return t.prototype.attachControl = function(t, r) {
                    var i = this;
                    this._wheel = function(t, n) {
                        if (t.type === e.PointerEventTypes.POINTERWHEEL) {
                            var o = t.event
                              , a = 0;
                            if (o.wheelDelta)
                                if (i.wheelDeltaPercentage) {
                                    var s = .01 * o.wheelDelta * i.wheelDeltaPercentage * i.camera.radius;
                                    a = o.wheelDelta > 0 ? s / (1 + i.wheelDeltaPercentage) : s * (1 + i.wheelDeltaPercentage)
                                } else
                                    a = o.wheelDelta / (40 * i.wheelPrecision);
                            else
                                o.detail && (a = -o.detail / i.wheelPrecision);
                            a && (i.camera.inertialRadiusOffset += a),
                            o.preventDefault && (r || o.preventDefault())
                        }
                    }
                    ,
                    this._observer = this.camera.getScene().onPointerObservable.add(this._wheel, e.PointerEventTypes.POINTERWHEEL)
                }
                ,
                t.prototype.detachControl = function(e) {
                    this._observer && e && (this.camera.getScene().onPointerObservable.remove(this._observer),
                    this._observer = null,
                    this._wheel = null)
                }
                ,
                t.prototype.getClassName = function() {
                    return "ArcRotateCameraMouseWheelInput"
                }
                ,
                t.prototype.getSimpleName = function() {
                    return "mousewheel"
                }
                ,
                n([e.serialize()], t.prototype, "wheelPrecision", void 0),
                n([e.serialize()], t.prototype, "wheelDeltaPercentage", void 0),
                t
            }();
            e.ArcRotateCameraMouseWheelInput = t,
            e.CameraInputTypes.ArcRotateCameraMouseWheelInput = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.buttons = [0, 1, 2],
                    this.angularSensibilityX = 1e3,
                    this.angularSensibilityY = 1e3,
                    this.pinchPrecision = 12,
                    this.pinchDeltaPercentage = 0,
                    this.panningSensibility = 1e3,
                    this.multiTouchPanning = !0,
                    this.multiTouchPanAndZoom = !0,
                    this.pinchInwards = !0,
                    this._isPanClick = !1
                }
                return t.prototype.attachControl = function(t, r) {
                    var i, n = this, o = this.camera.getEngine(), a = null, s = null, y = 0, l = 0, c = 0, h = {
                        x: 0,
                        y: 0,
                        isPaning: !1,
                        isPinching: !1
                    };
                    this._pointerInput = function(u, d) {
                        var x = u.event
                          , p = "touch" === u.event.pointerType;
                        if (!o.isInVRExclusivePointerMode && (u.type === e.PointerEventTypes.POINTERMOVE || -1 !== n.buttons.indexOf(x.button))) {
                            var f = x.srcElement || x.target;
                            if (u.type === e.PointerEventTypes.POINTERDOWN && f) {
                                try {
                                    f.setPointerCapture(x.pointerId)
                                } catch (e) {}
                                n._isPanClick = x.button === n.camera._panningMouseButton,
                                i = {
                                    x: x.clientX,
                                    y: x.clientY,
                                    pointerId: x.pointerId,
                                    type: x.pointerType
                                },
                                null === a ? a = i : null === s && (s = i),
                                r || (x.preventDefault(),
                                t.focus())
                            } else if (u.type === e.PointerEventTypes.POINTERDOUBLETAP)
                                n.camera.useInputToRestoreState && n.camera.restoreState();
                            else if (u.type === e.PointerEventTypes.POINTERUP && f) {
                                try {
                                    f.releasePointerCapture(x.pointerId)
                                } catch (e) {}
                                i = null,
                                y = 0,
                                h.isPaning = !1,
                                h.isPinching = !1,
                                c = 0,
                                l = 0,
                                p || (s = null),
                                o._badOS ? a = s = null : s && a && a.pointerId == x.pointerId ? (a = s,
                                s = null,
                                i = {
                                    x: a.x,
                                    y: a.y,
                                    pointerId: a.pointerId,
                                    type: x.pointerType
                                }) : a && s && s.pointerId == x.pointerId ? (s = null,
                                i = {
                                    x: a.x,
                                    y: a.y,
                                    pointerId: a.pointerId,
                                    type: x.pointerType
                                }) : a = s = null,
                                r || x.preventDefault()
                            } else if (u.type === e.PointerEventTypes.POINTERMOVE)
                                if (r || x.preventDefault(),
                                a && null === s && i) {
                                    if (0 !== n.panningSensibility && (x.ctrlKey && n.camera._useCtrlForPanning || n._isPanClick))
                                        n.camera.inertialPanningX += -(x.clientX - i.x) / n.panningSensibility,
                                        n.camera.inertialPanningY += (x.clientY - i.y) / n.panningSensibility;
                                    else {
                                        var m = x.clientX - i.x
                                          , z = x.clientY - i.y;
                                        n.camera.inertialAlphaOffset -= m / n.angularSensibilityX,
                                        n.camera.inertialBetaOffset -= z / n.angularSensibilityY
                                    }
                                    i.x = x.clientX,
                                    i.y = x.clientY
                                } else if (a && s) {
                                    var _ = a.pointerId === x.pointerId ? a : s;
                                    _.x = x.clientX,
                                    _.y = x.clientY;
                                    var g = n.pinchInwards ? 1 : -1
                                      , v = a.x - s.x
                                      , b = a.y - s.y
                                      , T = v * v + b * b
                                      , E = Math.sqrt(T);
                                    if (0 === y)
                                        return l = E,
                                        y = T,
                                        h.x = (a.x + s.x) / 2,
                                        void (h.y = (a.y + s.y) / 2);
                                    if (n.multiTouchPanAndZoom) {
                                        if (n.pinchDeltaPercentage ? n.camera.inertialRadiusOffset += .001 * (T - y) * n.camera.radius * n.pinchDeltaPercentage : n.camera.inertialRadiusOffset += (T - y) / (n.pinchPrecision * ((n.angularSensibilityX + n.angularSensibilityY) / 2) * g),
                                        0 !== n.panningSensibility) {
                                            var P = (a.x + s.x) / 2
                                              , A = (a.y + s.y) / 2
                                              , S = P - h.x
                                              , M = A - h.y;
                                            h.x = P,
                                            h.y = A,
                                            n.camera.inertialPanningX += -S / n.panningSensibility,
                                            n.camera.inertialPanningY += M / n.panningSensibility
                                        }
                                    } else {
                                        if (c++,
                                        h.isPinching || c < 20 && Math.abs(E - l) > n.camera.pinchToPanMaxDistance)
                                            n.pinchDeltaPercentage ? n.camera.inertialRadiusOffset += .001 * (T - y) * n.camera.radius * n.pinchDeltaPercentage : n.camera.inertialRadiusOffset += (T - y) / (n.pinchPrecision * ((n.angularSensibilityX + n.angularSensibilityY) / 2) * g),
                                            h.isPaning = !1,
                                            h.isPinching = !0;
                                        else if (i && i.pointerId === _.pointerId && 0 !== n.panningSensibility && n.multiTouchPanning) {
                                            if (!h.isPaning)
                                                return h.isPaning = !0,
                                                h.isPinching = !1,
                                                h.x = _.x,
                                                void (h.y = _.y);
                                            n.camera.inertialPanningX += -(_.x - h.x) / n.panningSensibility,
                                            n.camera.inertialPanningY += (_.y - h.y) / n.panningSensibility
                                        }
                                        i && i.pointerId === x.pointerId && (h.x = _.x,
                                        h.y = _.y)
                                    }
                                    y = T
                                }
                        }
                    }
                    ,
                    this._observer = this.camera.getScene().onPointerObservable.add(this._pointerInput, e.PointerEventTypes.POINTERDOWN | e.PointerEventTypes.POINTERUP | e.PointerEventTypes.POINTERMOVE | e.PointerEventTypes.POINTERDOUBLETAP),
                    this._onContextMenu = function(e) {
                        e.preventDefault()
                    }
                    ,
                    this.camera._useCtrlForPanning || t.addEventListener("contextmenu", this._onContextMenu, !1),
                    this._onLostFocus = function() {
                        a = s = null,
                        y = 0,
                        h.isPaning = !1,
                        h.isPinching = !1,
                        c = 0,
                        i = null,
                        l = 0
                    }
                    ,
                    this._onMouseMove = function(e) {
                        if (o.isPointerLock) {
                            var t = e.movementX || e.mozMovementX || e.webkitMovementX || e.msMovementX || 0
                              , i = e.movementY || e.mozMovementY || e.webkitMovementY || e.msMovementY || 0;
                            n.camera.inertialAlphaOffset -= t / n.angularSensibilityX,
                            n.camera.inertialBetaOffset -= i / n.angularSensibilityY,
                            r || e.preventDefault()
                        }
                    }
                    ,
                    this._onGestureStart = function(e) {
                        void 0 !== window.MSGesture && (n._MSGestureHandler || (n._MSGestureHandler = new MSGesture,
                        n._MSGestureHandler.target = t),
                        n._MSGestureHandler.addPointer(e.pointerId))
                    }
                    ,
                    this._onGesture = function(e) {
                        n.camera.radius *= e.scale,
                        e.preventDefault && (r || (e.stopPropagation(),
                        e.preventDefault()))
                    }
                    ,
                    t.addEventListener("mousemove", this._onMouseMove, !1),
                    t.addEventListener("MSPointerDown", this._onGestureStart, !1),
                    t.addEventListener("MSGestureChange", this._onGesture, !1),
                    e.Tools.RegisterTopRootEvents([{
                        name: "blur",
                        handler: this._onLostFocus
                    }])
                }
                ,
                t.prototype.detachControl = function(t) {
                    this._onLostFocus && e.Tools.UnregisterTopRootEvents([{
                        name: "blur",
                        handler: this._onLostFocus
                    }]),
                    t && this._observer && (this.camera.getScene().onPointerObservable.remove(this._observer),
                    this._observer = null,
                    this._onContextMenu && t.removeEventListener("contextmenu", this._onContextMenu),
                    this._onMouseMove && t.removeEventListener("mousemove", this._onMouseMove),
                    this._onGestureStart && t.removeEventListener("MSPointerDown", this._onGestureStart),
                    this._onGesture && t.removeEventListener("MSGestureChange", this._onGesture),
                    this._isPanClick = !1,
                    this.pinchInwards = !0,
                    this._onMouseMove = null,
                    this._onGestureStart = null,
                    this._onGesture = null,
                    this._MSGestureHandler = null,
                    this._onLostFocus = null,
                    this._onContextMenu = null)
                }
                ,
                t.prototype.getClassName = function() {
                    return "ArcRotateCameraPointersInput"
                }
                ,
                t.prototype.getSimpleName = function() {
                    return "pointers"
                }
                ,
                n([e.serialize()], t.prototype, "buttons", void 0),
                n([e.serialize()], t.prototype, "angularSensibilityX", void 0),
                n([e.serialize()], t.prototype, "angularSensibilityY", void 0),
                n([e.serialize()], t.prototype, "pinchPrecision", void 0),
                n([e.serialize()], t.prototype, "pinchDeltaPercentage", void 0),
                n([e.serialize()], t.prototype, "panningSensibility", void 0),
                n([e.serialize()], t.prototype, "multiTouchPanning", void 0),
                n([e.serialize()], t.prototype, "multiTouchPanAndZoom", void 0),
                t
            }();
            e.ArcRotateCameraPointersInput = t,
            e.CameraInputTypes.ArcRotateCameraPointersInput = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(e) {
                    return t.call(this, e) || this
                }
                return o(r, t),
                r.prototype.addMouseWheel = function() {
                    return this.add(new e.ArcRotateCameraMouseWheelInput),
                    this
                }
                ,
                r.prototype.addPointers = function() {
                    return this.add(new e.ArcRotateCameraPointersInput),
                    this
                }
                ,
                r.prototype.addKeyboard = function() {
                    return this.add(new e.ArcRotateCameraKeyboardMoveInput),
                    this
                }
                ,
                r.prototype.addVRDeviceOrientation = function() {
                    return this.add(new e.ArcRotateCameraVRDeviceOrientationInput),
                    this
                }
                ,
                r
            }(e.CameraInputsManager);
            e.ArcRotateCameraInputsManager = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("ArcRotateCamera", (function(r, i) {
                return function() {
                    return new t(r,0,0,1,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o, a, s, y) {
                    void 0 === y && (y = !0);
                    var l = t.call(this, r, e.Vector3.Zero(), s, y) || this;
                    return l.inertialAlphaOffset = 0,
                    l.inertialBetaOffset = 0,
                    l.inertialRadiusOffset = 0,
                    l.lowerAlphaLimit = null,
                    l.upperAlphaLimit = null,
                    l.lowerBetaLimit = .01,
                    l.upperBetaLimit = Math.PI,
                    l.lowerRadiusLimit = null,
                    l.upperRadiusLimit = null,
                    l.inertialPanningX = 0,
                    l.inertialPanningY = 0,
                    l.pinchToPanMaxDistance = 20,
                    l.panningDistanceLimit = null,
                    l.panningOriginTarget = e.Vector3.Zero(),
                    l.panningInertia = .9,
                    l.zoomOnFactor = 1,
                    l.targetScreenOffset = e.Vector2.Zero(),
                    l.allowUpsideDown = !0,
                    l.useInputToRestoreState = !0,
                    l._viewMatrix = new e.Matrix,
                    l.panningAxis = new e.Vector3(1,1,0),
                    l.onMeshTargetChangedObservable = new e.Observable,
                    l.checkCollisions = !1,
                    l.collisionRadius = new e.Vector3(.5,.5,.5),
                    l._previousPosition = e.Vector3.Zero(),
                    l._collisionVelocity = e.Vector3.Zero(),
                    l._newPosition = e.Vector3.Zero(),
                    l._computationVector = e.Vector3.Zero(),
                    l._onCollisionPositionChange = function(e, t, r) {
                        void 0 === r && (r = null),
                        l.getScene().workerCollisions && l.checkCollisions && t.multiplyInPlace(l._collider._radius),
                        r ? (l.setPosition(t),
                        l.onCollide && l.onCollide(r)) : l._previousPosition.copyFrom(l.position);
                        var i = Math.cos(l.alpha)
                          , n = Math.sin(l.alpha)
                          , o = Math.cos(l.beta)
                          , a = Math.sin(l.beta);
                        0 === a && (a = 1e-4);
                        var s = l._getTargetPosition();
                        l._computationVector.copyFromFloats(l.radius * i * a, l.radius * o, l.radius * n * a),
                        s.addToRef(l._computationVector, l._newPosition),
                        l.position.copyFrom(l._newPosition);
                        var y = l.upVector;
                        l.allowUpsideDown && l.beta < 0 && (y = (y = y.clone()).negate()),
                        l._computeViewMatrix(l.position, s, y),
                        l._viewMatrix.m[12] += l.targetScreenOffset.x,
                        l._viewMatrix.m[13] += l.targetScreenOffset.y,
                        l._collisionTriggered = !1
                    }
                    ,
                    l._target = e.Vector3.Zero(),
                    a && l.setTarget(a),
                    l.alpha = i,
                    l.beta = n,
                    l.radius = o,
                    l.getViewMatrix(),
                    l.inputs = new e.ArcRotateCameraInputsManager(l),
                    l.inputs.addKeyboard().addMouseWheel().addPointers(),
                    l
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "target", {
                    get: function() {
                        return this._target
                    },
                    set: function(e) {
                        this.setTarget(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "angularSensibilityX", {
                    get: function() {
                        var e = this.inputs.attached.pointers;
                        return e ? e.angularSensibilityX : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.pointers;
                        t && (t.angularSensibilityX = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "angularSensibilityY", {
                    get: function() {
                        var e = this.inputs.attached.pointers;
                        return e ? e.angularSensibilityY : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.pointers;
                        t && (t.angularSensibilityY = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "pinchPrecision", {
                    get: function() {
                        var e = this.inputs.attached.pointers;
                        return e ? e.pinchPrecision : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.pointers;
                        t && (t.pinchPrecision = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "pinchDeltaPercentage", {
                    get: function() {
                        var e = this.inputs.attached.pointers;
                        return e ? e.pinchDeltaPercentage : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.pointers;
                        t && (t.pinchDeltaPercentage = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "panningSensibility", {
                    get: function() {
                        var e = this.inputs.attached.pointers;
                        return e ? e.panningSensibility : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.pointers;
                        t && (t.panningSensibility = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "keysUp", {
                    get: function() {
                        var e = this.inputs.attached.keyboard;
                        return e ? e.keysUp : []
                    },
                    set: function(e) {
                        var t = this.inputs.attached.keyboard;
                        t && (t.keysUp = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "keysDown", {
                    get: function() {
                        var e = this.inputs.attached.keyboard;
                        return e ? e.keysDown : []
                    },
                    set: function(e) {
                        var t = this.inputs.attached.keyboard;
                        t && (t.keysDown = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "keysLeft", {
                    get: function() {
                        var e = this.inputs.attached.keyboard;
                        return e ? e.keysLeft : []
                    },
                    set: function(e) {
                        var t = this.inputs.attached.keyboard;
                        t && (t.keysLeft = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "keysRight", {
                    get: function() {
                        var e = this.inputs.attached.keyboard;
                        return e ? e.keysRight : []
                    },
                    set: function(e) {
                        var t = this.inputs.attached.keyboard;
                        t && (t.keysRight = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "wheelPrecision", {
                    get: function() {
                        var e = this.inputs.attached.mousewheel;
                        return e ? e.wheelPrecision : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.mousewheel;
                        t && (t.wheelPrecision = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "wheelDeltaPercentage", {
                    get: function() {
                        var e = this.inputs.attached.mousewheel;
                        return e ? e.wheelDeltaPercentage : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.mousewheel;
                        t && (t.wheelDeltaPercentage = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "bouncingBehavior", {
                    get: function() {
                        return this._bouncingBehavior
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "useBouncingBehavior", {
                    get: function() {
                        return null != this._bouncingBehavior
                    },
                    set: function(t) {
                        t !== this.useBouncingBehavior && (t ? (this._bouncingBehavior = new e.BouncingBehavior,
                        this.addBehavior(this._bouncingBehavior)) : this._bouncingBehavior && (this.removeBehavior(this._bouncingBehavior),
                        this._bouncingBehavior = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "framingBehavior", {
                    get: function() {
                        return this._framingBehavior
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "useFramingBehavior", {
                    get: function() {
                        return null != this._framingBehavior
                    },
                    set: function(t) {
                        t !== this.useFramingBehavior && (t ? (this._framingBehavior = new e.FramingBehavior,
                        this.addBehavior(this._framingBehavior)) : this._framingBehavior && (this.removeBehavior(this._framingBehavior),
                        this._framingBehavior = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "autoRotationBehavior", {
                    get: function() {
                        return this._autoRotationBehavior
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "useAutoRotationBehavior", {
                    get: function() {
                        return null != this._autoRotationBehavior
                    },
                    set: function(t) {
                        t !== this.useAutoRotationBehavior && (t ? (this._autoRotationBehavior = new e.AutoRotationBehavior,
                        this.addBehavior(this._autoRotationBehavior)) : this._autoRotationBehavior && (this.removeBehavior(this._autoRotationBehavior),
                        this._autoRotationBehavior = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._initCache = function() {
                    t.prototype._initCache.call(this),
                    this._cache._target = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),
                    this._cache.alpha = void 0,
                    this._cache.beta = void 0,
                    this._cache.radius = void 0,
                    this._cache.targetScreenOffset = e.Vector2.Zero()
                }
                ,
                r.prototype._updateCache = function(e) {
                    e || t.prototype._updateCache.call(this),
                    this._cache._target.copyFrom(this._getTargetPosition()),
                    this._cache.alpha = this.alpha,
                    this._cache.beta = this.beta,
                    this._cache.radius = this.radius,
                    this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)
                }
                ,
                r.prototype._getTargetPosition = function() {
                    if (this._targetHost && this._targetHost.getAbsolutePosition) {
                        var e = this._targetHost.getAbsolutePosition();
                        this._targetBoundingCenter ? e.addToRef(this._targetBoundingCenter, this._target) : this._target.copyFrom(e)
                    }
                    var t = this._getLockedTargetPosition();
                    return t || this._target
                }
                ,
                r.prototype.storeState = function() {
                    return this._storedAlpha = this.alpha,
                    this._storedBeta = this.beta,
                    this._storedRadius = this.radius,
                    this._storedTarget = this._getTargetPosition().clone(),
                    t.prototype.storeState.call(this)
                }
                ,
                r.prototype._restoreStateValues = function() {
                    return !!t.prototype._restoreStateValues.call(this) && (this.alpha = this._storedAlpha,
                    this.beta = this._storedBeta,
                    this.radius = this._storedRadius,
                    this.setTarget(this._storedTarget.clone()),
                    this.inertialAlphaOffset = 0,
                    this.inertialBetaOffset = 0,
                    this.inertialRadiusOffset = 0,
                    this.inertialPanningX = 0,
                    this.inertialPanningY = 0,
                    !0)
                }
                ,
                r.prototype._isSynchronizedViewMatrix = function() {
                    return !!t.prototype._isSynchronizedViewMatrix.call(this) && (this._cache._target.equals(this._getTargetPosition()) && this._cache.alpha === this.alpha && this._cache.beta === this.beta && this._cache.radius === this.radius && this._cache.targetScreenOffset.equals(this.targetScreenOffset))
                }
                ,
                r.prototype.attachControl = function(e, t, r, i) {
                    var n = this;
                    void 0 === r && (r = !0),
                    void 0 === i && (i = 2),
                    this._useCtrlForPanning = r,
                    this._panningMouseButton = i,
                    this.inputs.attachElement(e, t),
                    this._reset = function() {
                        n.inertialAlphaOffset = 0,
                        n.inertialBetaOffset = 0,
                        n.inertialRadiusOffset = 0,
                        n.inertialPanningX = 0,
                        n.inertialPanningY = 0
                    }
                }
                ,
                r.prototype.detachControl = function(e) {
                    this.inputs.detachElement(e),
                    this._reset && this._reset()
                }
                ,
                r.prototype._checkInputs = function() {
                    if (!this._collisionTriggered) {
                        if (this.inputs.checkInputs(),
                        0 !== this.inertialAlphaOffset || 0 !== this.inertialBetaOffset || 0 !== this.inertialRadiusOffset) {
                            var r = this.inertialAlphaOffset;
                            this.beta <= 0 && (r *= -1),
                            this.getScene().useRightHandedSystem && (r *= -1),
                            this.parent && this.parent._getWorldMatrixDeterminant() < 0 && (r *= -1),
                            this.alpha += r,
                            this.beta += this.inertialBetaOffset,
                            this.radius -= this.inertialRadiusOffset,
                            this.inertialAlphaOffset *= this.inertia,
                            this.inertialBetaOffset *= this.inertia,
                            this.inertialRadiusOffset *= this.inertia,
                            Math.abs(this.inertialAlphaOffset) < e.Epsilon && (this.inertialAlphaOffset = 0),
                            Math.abs(this.inertialBetaOffset) < e.Epsilon && (this.inertialBetaOffset = 0),
                            Math.abs(this.inertialRadiusOffset) < this.speed * e.Epsilon && (this.inertialRadiusOffset = 0)
                        }
                        if (0 !== this.inertialPanningX || 0 !== this.inertialPanningY) {
                            if (this._localDirection || (this._localDirection = e.Vector3.Zero(),
                            this._transformedDirection = e.Vector3.Zero()),
                            this._localDirection.copyFromFloats(this.inertialPanningX, this.inertialPanningY, this.inertialPanningY),
                            this._localDirection.multiplyInPlace(this.panningAxis),
                            this._viewMatrix.invertToRef(this._cameraTransformMatrix),
                            e.Vector3.TransformNormalToRef(this._localDirection, this._cameraTransformMatrix, this._transformedDirection),
                            this.panningAxis.y || (this._transformedDirection.y = 0),
                            !this._targetHost)
                                if (this.panningDistanceLimit)
                                    this._transformedDirection.addInPlace(this._target),
                                    e.Vector3.DistanceSquared(this._transformedDirection, this.panningOriginTarget) <= this.panningDistanceLimit * this.panningDistanceLimit && this._target.copyFrom(this._transformedDirection);
                                else
                                    this._target.addInPlace(this._transformedDirection);
                            this.inertialPanningX *= this.panningInertia,
                            this.inertialPanningY *= this.panningInertia,
                            Math.abs(this.inertialPanningX) < this.speed * e.Epsilon && (this.inertialPanningX = 0),
                            Math.abs(this.inertialPanningY) < this.speed * e.Epsilon && (this.inertialPanningY = 0)
                        }
                        this._checkLimits(),
                        t.prototype._checkInputs.call(this)
                    }
                }
                ,
                r.prototype._checkLimits = function() {
                    null === this.lowerBetaLimit || void 0 === this.lowerBetaLimit ? this.allowUpsideDown && this.beta > Math.PI && (this.beta = this.beta - 2 * Math.PI) : this.beta < this.lowerBetaLimit && (this.beta = this.lowerBetaLimit),
                    null === this.upperBetaLimit || void 0 === this.upperBetaLimit ? this.allowUpsideDown && this.beta < -Math.PI && (this.beta = this.beta + 2 * Math.PI) : this.beta > this.upperBetaLimit && (this.beta = this.upperBetaLimit),
                    null !== this.lowerAlphaLimit && this.alpha < this.lowerAlphaLimit && (this.alpha = this.lowerAlphaLimit),
                    null !== this.upperAlphaLimit && this.alpha > this.upperAlphaLimit && (this.alpha = this.upperAlphaLimit),
                    null !== this.lowerRadiusLimit && this.radius < this.lowerRadiusLimit && (this.radius = this.lowerRadiusLimit),
                    null !== this.upperRadiusLimit && this.radius > this.upperRadiusLimit && (this.radius = this.upperRadiusLimit)
                }
                ,
                r.prototype.rebuildAnglesAndRadius = function() {
                    this.position.subtractToRef(this._getTargetPosition(), this._computationVector),
                    this.radius = this._computationVector.length(),
                    0 === this.radius && (this.radius = 1e-4),
                    this.alpha = Math.acos(this._computationVector.x / Math.sqrt(Math.pow(this._computationVector.x, 2) + Math.pow(this._computationVector.z, 2))),
                    this._computationVector.z < 0 && (this.alpha = 2 * Math.PI - this.alpha),
                    this.beta = Math.acos(this._computationVector.y / this.radius),
                    this._checkLimits()
                }
                ,
                r.prototype.setPosition = function(e) {
                    this.position.equals(e) || (this.position.copyFrom(e),
                    this.rebuildAnglesAndRadius())
                }
                ,
                r.prototype.setTarget = function(e, t, r) {
                    if (void 0 === t && (t = !1),
                    void 0 === r && (r = !1),
                    e.getBoundingInfo)
                        this._targetBoundingCenter = t ? e.getBoundingInfo().boundingBox.centerWorld.clone() : null,
                        this._targetHost = e,
                        this._target = this._getTargetPosition(),
                        this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);
                    else {
                        var i = e
                          , n = this._getTargetPosition();
                        if (n && !r && n.equals(i))
                            return;
                        this._targetHost = null,
                        this._target = i,
                        this._targetBoundingCenter = null,
                        this.onMeshTargetChangedObservable.notifyObservers(null)
                    }
                    this.rebuildAnglesAndRadius()
                }
                ,
                r.prototype._getViewMatrix = function() {
                    var t = Math.cos(this.alpha)
                      , r = Math.sin(this.alpha)
                      , i = Math.cos(this.beta)
                      , n = Math.sin(this.beta);
                    0 === n && (n = 1e-4);
                    var o = this._getTargetPosition();
                    if (this._computationVector.copyFromFloats(this.radius * t * n, this.radius * i, this.radius * r * n),
                    o.addToRef(this._computationVector, this._newPosition),
                    this.getScene().collisionsEnabled && this.checkCollisions)
                        this._collider || (this._collider = new e.Collider),
                        this._collider._radius = this.collisionRadius,
                        this._newPosition.subtractToRef(this.position, this._collisionVelocity),
                        this._collisionTriggered = !0,
                        this.getScene().collisionCoordinator.getNewPosition(this.position, this._collisionVelocity, this._collider, 3, null, this._onCollisionPositionChange, this.uniqueId);
                    else {
                        this.position.copyFrom(this._newPosition);
                        var a = this.upVector;
                        this.allowUpsideDown && n < 0 && (a = (a = a.clone()).negate()),
                        this._computeViewMatrix(this.position, o, a),
                        this._viewMatrix.m[12] += this.targetScreenOffset.x,
                        this._viewMatrix.m[13] += this.targetScreenOffset.y
                    }
                    return this._currentTarget = o,
                    this._viewMatrix
                }
                ,
                r.prototype.zoomOn = function(t, r) {
                    void 0 === r && (r = !1),
                    t = t || this.getScene().meshes;
                    var i = e.Mesh.MinMax(t)
                      , n = e.Vector3.Distance(i.min, i.max);
                    this.radius = n * this.zoomOnFactor,
                    this.focusOn({
                        min: i.min,
                        max: i.max,
                        distance: n
                    }, r)
                }
                ,
                r.prototype.focusOn = function(t, r) {
                    var i, n;
                    if (void 0 === r && (r = !1),
                    void 0 === t.min) {
                        var o = t || this.getScene().meshes;
                        i = e.Mesh.MinMax(o),
                        n = e.Vector3.Distance(i.min, i.max)
                    } else {
                        i = t,
                        n = t.distance
                    }
                    this._target = e.Mesh.Center(i),
                    r || (this.maxZ = 2 * n)
                }
                ,
                r.prototype.createRigCamera = function(t, i) {
                    var n = 0;
                    switch (this.cameraRigMode) {
                    case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:
                    case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:
                    case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:
                    case e.Camera.RIG_MODE_VR:
                        n = this._cameraRigParams.stereoHalfAngle * (0 === i ? 1 : -1);
                        break;
                    case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:
                        n = this._cameraRigParams.stereoHalfAngle * (0 === i ? -1 : 1)
                    }
                    var o = new r(t,this.alpha + n,this.beta,this.radius,this._target,this.getScene());
                    return o._cameraRigParams = {},
                    o
                }
                ,
                r.prototype._updateRigCameras = function() {
                    var r = this._rigCameras[0]
                      , i = this._rigCameras[1];
                    switch (r.beta = i.beta = this.beta,
                    r.radius = i.radius = this.radius,
                    this.cameraRigMode) {
                    case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:
                    case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:
                    case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:
                    case e.Camera.RIG_MODE_VR:
                        r.alpha = this.alpha - this._cameraRigParams.stereoHalfAngle,
                        i.alpha = this.alpha + this._cameraRigParams.stereoHalfAngle;
                        break;
                    case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:
                        r.alpha = this.alpha + this._cameraRigParams.stereoHalfAngle,
                        i.alpha = this.alpha - this._cameraRigParams.stereoHalfAngle
                    }
                    t.prototype._updateRigCameras.call(this)
                }
                ,
                r.prototype.dispose = function() {
                    this.inputs.clear(),
                    t.prototype.dispose.call(this)
                }
                ,
                r.prototype.getClassName = function() {
                    return "ArcRotateCamera"
                }
                ,
                n([e.serialize()], r.prototype, "alpha", void 0),
                n([e.serialize()], r.prototype, "beta", void 0),
                n([e.serialize()], r.prototype, "radius", void 0),
                n([e.serializeAsVector3("target")], r.prototype, "_target", void 0),
                n([e.serialize()], r.prototype, "inertialAlphaOffset", void 0),
                n([e.serialize()], r.prototype, "inertialBetaOffset", void 0),
                n([e.serialize()], r.prototype, "inertialRadiusOffset", void 0),
                n([e.serialize()], r.prototype, "lowerAlphaLimit", void 0),
                n([e.serialize()], r.prototype, "upperAlphaLimit", void 0),
                n([e.serialize()], r.prototype, "lowerBetaLimit", void 0),
                n([e.serialize()], r.prototype, "upperBetaLimit", void 0),
                n([e.serialize()], r.prototype, "lowerRadiusLimit", void 0),
                n([e.serialize()], r.prototype, "upperRadiusLimit", void 0),
                n([e.serialize()], r.prototype, "inertialPanningX", void 0),
                n([e.serialize()], r.prototype, "inertialPanningY", void 0),
                n([e.serialize()], r.prototype, "pinchToPanMaxDistance", void 0),
                n([e.serialize()], r.prototype, "panningDistanceLimit", void 0),
                n([e.serializeAsVector3()], r.prototype, "panningOriginTarget", void 0),
                n([e.serialize()], r.prototype, "panningInertia", void 0),
                n([e.serialize()], r.prototype, "zoomOnFactor", void 0),
                n([e.serialize()], r.prototype, "targetScreenOffset", void 0),
                n([e.serialize()], r.prototype, "allowUpsideDown", void 0),
                n([e.serialize()], r.prototype, "useInputToRestoreState", void 0),
                r
            }(e.TargetCamera);
            e.ArcRotateCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("Light_Type_3", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n) {
                    var o = t.call(this, r, n) || this;
                    return o.groundColor = new e.Color3(0,0,0),
                    o.direction = i || e.Vector3.Up(),
                    o
                }
                return o(r, t),
                r.prototype._buildUniformLayout = function() {
                    this._uniformBuffer.addUniform("vLightData", 4),
                    this._uniformBuffer.addUniform("vLightDiffuse", 4),
                    this._uniformBuffer.addUniform("vLightSpecular", 3),
                    this._uniformBuffer.addUniform("vLightGround", 3),
                    this._uniformBuffer.addUniform("shadowsInfo", 3),
                    this._uniformBuffer.addUniform("depthValues", 2),
                    this._uniformBuffer.create()
                }
                ,
                r.prototype.getClassName = function() {
                    return "HemisphericLight"
                }
                ,
                r.prototype.setDirectionToTarget = function(t) {
                    return this.direction = e.Vector3.Normalize(t.subtract(e.Vector3.Zero())),
                    this.direction
                }
                ,
                r.prototype.getShadowGenerator = function() {
                    return null
                }
                ,
                r.prototype.transferToEffect = function(t, r) {
                    var i = e.Vector3.Normalize(this.direction);
                    return this._uniformBuffer.updateFloat4("vLightData", i.x, i.y, i.z, 0, r),
                    this._uniformBuffer.updateColor3("vLightGround", this.groundColor.scale(this.intensity), r),
                    this
                }
                ,
                r.prototype.computeWorldMatrix = function(t, r) {
                    return this._worldMatrix || (this._worldMatrix = e.Matrix.Identity()),
                    this._worldMatrix
                }
                ,
                r.prototype.getTypeID = function() {
                    return e.Light.LIGHTTYPEID_HEMISPHERICLIGHT
                }
                ,
                r.prototype.prepareLightSpecificDefines = function(e, t) {
                    e["HEMILIGHT" + t] = !0
                }
                ,
                n([e.serializeAsColor3()], r.prototype, "groundColor", void 0),
                n([e.serializeAsVector3()], r.prototype, "direction", void 0),
                r
            }(e.Light);
            e.HemisphericLight = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r() {
                    var e = null !== t && t.apply(this, arguments) || this;
                    return e._needProjectionMatrixCompute = !0,
                    e
                }
                return o(r, t),
                r.prototype._setPosition = function(e) {
                    this._position = e
                }
                ,
                Object.defineProperty(r.prototype, "position", {
                    get: function() {
                        return this._position
                    },
                    set: function(e) {
                        this._setPosition(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._setDirection = function(e) {
                    this._direction = e
                }
                ,
                Object.defineProperty(r.prototype, "direction", {
                    get: function() {
                        return this._direction
                    },
                    set: function(e) {
                        this._setDirection(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "shadowMinZ", {
                    get: function() {
                        return this._shadowMinZ
                    },
                    set: function(e) {
                        this._shadowMinZ = e,
                        this.forceProjectionMatrixCompute()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "shadowMaxZ", {
                    get: function() {
                        return this._shadowMaxZ
                    },
                    set: function(e) {
                        this._shadowMaxZ = e,
                        this.forceProjectionMatrixCompute()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.computeTransformedInformation = function() {
                    return !(!this.parent || !this.parent.getWorldMatrix) && (this.transformedPosition || (this.transformedPosition = e.Vector3.Zero()),
                    e.Vector3.TransformCoordinatesToRef(this.position, this.parent.getWorldMatrix(), this.transformedPosition),
                    this.direction && (this.transformedDirection || (this.transformedDirection = e.Vector3.Zero()),
                    e.Vector3.TransformNormalToRef(this.direction, this.parent.getWorldMatrix(), this.transformedDirection)),
                    !0)
                }
                ,
                r.prototype.getDepthScale = function() {
                    return 50
                }
                ,
                r.prototype.getShadowDirection = function(e) {
                    return this.transformedDirection ? this.transformedDirection : this.direction
                }
                ,
                r.prototype.getAbsolutePosition = function() {
                    return this.transformedPosition ? this.transformedPosition : this.position
                }
                ,
                r.prototype.setDirectionToTarget = function(t) {
                    return this.direction = e.Vector3.Normalize(t.subtract(this.position)),
                    this.direction
                }
                ,
                r.prototype.getRotation = function() {
                    this.direction.normalize();
                    var t = e.Vector3.Cross(this.direction, e.Axis.Y)
                      , r = e.Vector3.Cross(t, this.direction);
                    return e.Vector3.RotationFromAxis(t, r, this.direction)
                }
                ,
                r.prototype.needCube = function() {
                    return !1
                }
                ,
                r.prototype.needProjectionMatrixCompute = function() {
                    return this._needProjectionMatrixCompute
                }
                ,
                r.prototype.forceProjectionMatrixCompute = function() {
                    this._needProjectionMatrixCompute = !0
                }
                ,
                r.prototype._initCache = function() {
                    t.prototype._initCache.call(this),
                    this._cache.position = e.Vector3.Zero()
                }
                ,
                r.prototype._isSynchronized = function() {
                    return !!this._cache.position.equals(this.position)
                }
                ,
                r.prototype.computeWorldMatrix = function(t) {
                    return !t && this.isSynchronized() ? (this._currentRenderId = this.getScene().getRenderId(),
                    this._worldMatrix) : (this._updateCache(),
                    this._cache.position.copyFrom(this.position),
                    this._worldMatrix || (this._worldMatrix = e.Matrix.Identity()),
                    e.Matrix.TranslationToRef(this.position.x, this.position.y, this.position.z, this._worldMatrix),
                    this.parent && this.parent.getWorldMatrix && (this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(), this._worldMatrix),
                    this._markSyncedWithParent()),
                    this._worldMatrixDeterminant = this._worldMatrix.determinant(),
                    this._worldMatrix)
                }
                ,
                r.prototype.getDepthMinZ = function(e) {
                    return void 0 !== this.shadowMinZ ? this.shadowMinZ : e.minZ
                }
                ,
                r.prototype.getDepthMaxZ = function(e) {
                    return void 0 !== this.shadowMaxZ ? this.shadowMaxZ : e.maxZ
                }
                ,
                r.prototype.setShadowProjectionMatrix = function(e, t, r) {
                    return this.customProjectionMatrixBuilder ? this.customProjectionMatrixBuilder(t, r, e) : this._setDefaultShadowProjectionMatrix(e, t, r),
                    this
                }
                ,
                n([e.serializeAsVector3()], r.prototype, "position", null),
                n([e.serializeAsVector3()], r.prototype, "direction", null),
                n([e.serialize()], r.prototype, "shadowMinZ", null),
                n([e.serialize()], r.prototype, "shadowMaxZ", null),
                r
            }(e.Light);
            e.ShadowLight = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("Light_Type_0", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(t) {
                function r(e, r, i) {
                    var n = t.call(this, e, i) || this;
                    return n._shadowAngle = Math.PI / 2,
                    n.position = r,
                    n
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "shadowAngle", {
                    get: function() {
                        return this._shadowAngle
                    },
                    set: function(e) {
                        this._shadowAngle = e,
                        this.forceProjectionMatrixCompute()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "direction", {
                    get: function() {
                        return this._direction
                    },
                    set: function(e) {
                        var t = this.needCube();
                        this._direction = e,
                        this.needCube() !== t && this._shadowGenerator && this._shadowGenerator.recreateShadowMap()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getClassName = function() {
                    return "PointLight"
                }
                ,
                r.prototype.getTypeID = function() {
                    return e.Light.LIGHTTYPEID_POINTLIGHT
                }
                ,
                r.prototype.needCube = function() {
                    return !this.direction
                }
                ,
                r.prototype.getShadowDirection = function(r) {
                    if (this.direction)
                        return t.prototype.getShadowDirection.call(this, r);
                    switch (r) {
                    case 0:
                        return new e.Vector3(1,0,0);
                    case 1:
                        return new e.Vector3(-1,0,0);
                    case 2:
                        return new e.Vector3(0,-1,0);
                    case 3:
                        return new e.Vector3(0,1,0);
                    case 4:
                        return new e.Vector3(0,0,1);
                    case 5:
                        return new e.Vector3(0,0,-1)
                    }
                    return e.Vector3.Zero()
                }
                ,
                r.prototype._setDefaultShadowProjectionMatrix = function(t, r, i) {
                    var n = this.getScene().activeCamera;
                    n && e.Matrix.PerspectiveFovLHToRef(this.shadowAngle, 1, this.getDepthMinZ(n), this.getDepthMaxZ(n), t)
                }
                ,
                r.prototype._buildUniformLayout = function() {
                    this._uniformBuffer.addUniform("vLightData", 4),
                    this._uniformBuffer.addUniform("vLightDiffuse", 4),
                    this._uniformBuffer.addUniform("vLightSpecular", 3),
                    this._uniformBuffer.addUniform("vLightFalloff", 4),
                    this._uniformBuffer.addUniform("shadowsInfo", 3),
                    this._uniformBuffer.addUniform("depthValues", 2),
                    this._uniformBuffer.create()
                }
                ,
                r.prototype.transferToEffect = function(e, t) {
                    return this.computeTransformedInformation() ? this._uniformBuffer.updateFloat4("vLightData", this.transformedPosition.x, this.transformedPosition.y, this.transformedPosition.z, 0, t) : this._uniformBuffer.updateFloat4("vLightData", this.position.x, this.position.y, this.position.z, 0, t),
                    this._uniformBuffer.updateFloat4("vLightFalloff", this.range, this._inverseSquaredRange, 0, 0, t),
                    this
                }
                ,
                r.prototype.prepareLightSpecificDefines = function(e, t) {
                    e["POINTLIGHT" + t] = !0
                }
                ,
                n([e.serialize()], r.prototype, "shadowAngle", null),
                r
            }(e.ShadowLight);
            e.PointLight = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("Light_Type_1", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(t) {
                function r(e, r, i) {
                    var n = t.call(this, e, i) || this;
                    return n._shadowFrustumSize = 0,
                    n._shadowOrthoScale = .1,
                    n.autoUpdateExtends = !0,
                    n._orthoLeft = Number.MAX_VALUE,
                    n._orthoRight = Number.MIN_VALUE,
                    n._orthoTop = Number.MIN_VALUE,
                    n._orthoBottom = Number.MAX_VALUE,
                    n.position = r.scale(-1),
                    n.direction = r,
                    n
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "shadowFrustumSize", {
                    get: function() {
                        return this._shadowFrustumSize
                    },
                    set: function(e) {
                        this._shadowFrustumSize = e,
                        this.forceProjectionMatrixCompute()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "shadowOrthoScale", {
                    get: function() {
                        return this._shadowOrthoScale
                    },
                    set: function(e) {
                        this._shadowOrthoScale = e,
                        this.forceProjectionMatrixCompute()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getClassName = function() {
                    return "DirectionalLight"
                }
                ,
                r.prototype.getTypeID = function() {
                    return e.Light.LIGHTTYPEID_DIRECTIONALLIGHT
                }
                ,
                r.prototype._setDefaultShadowProjectionMatrix = function(e, t, r) {
                    this.shadowFrustumSize > 0 ? this._setDefaultFixedFrustumShadowProjectionMatrix(e, t) : this._setDefaultAutoExtendShadowProjectionMatrix(e, t, r)
                }
                ,
                r.prototype._setDefaultFixedFrustumShadowProjectionMatrix = function(t, r) {
                    var i = this.getScene().activeCamera;
                    i && e.Matrix.OrthoLHToRef(this.shadowFrustumSize, this.shadowFrustumSize, void 0 !== this.shadowMinZ ? this.shadowMinZ : i.minZ, void 0 !== this.shadowMaxZ ? this.shadowMaxZ : i.maxZ, t)
                }
                ,
                r.prototype._setDefaultAutoExtendShadowProjectionMatrix = function(t, r, i) {
                    var n = this.getScene().activeCamera;
                    if (n) {
                        if (this.autoUpdateExtends || this._orthoLeft === Number.MAX_VALUE) {
                            var o = e.Vector3.Zero();
                            this._orthoLeft = Number.MAX_VALUE,
                            this._orthoRight = Number.MIN_VALUE,
                            this._orthoTop = Number.MIN_VALUE,
                            this._orthoBottom = Number.MAX_VALUE;
                            for (var a = 0; a < i.length; a++) {
                                var s = i[a];
                                if (s)
                                    for (var y = s.getBoundingInfo().boundingBox, l = 0; l < y.vectorsWorld.length; l++)
                                        e.Vector3.TransformCoordinatesToRef(y.vectorsWorld[l], r, o),
                                        o.x < this._orthoLeft && (this._orthoLeft = o.x),
                                        o.y < this._orthoBottom && (this._orthoBottom = o.y),
                                        o.x > this._orthoRight && (this._orthoRight = o.x),
                                        o.y > this._orthoTop && (this._orthoTop = o.y)
                            }
                        }
                        var c = this._orthoRight - this._orthoLeft
                          , h = this._orthoTop - this._orthoBottom;
                        e.Matrix.OrthoOffCenterLHToRef(this._orthoLeft - c * this.shadowOrthoScale, this._orthoRight + c * this.shadowOrthoScale, this._orthoBottom - h * this.shadowOrthoScale, this._orthoTop + h * this.shadowOrthoScale, void 0 !== this.shadowMinZ ? this.shadowMinZ : n.minZ, void 0 !== this.shadowMaxZ ? this.shadowMaxZ : n.maxZ, t)
                    }
                }
                ,
                r.prototype._buildUniformLayout = function() {
                    this._uniformBuffer.addUniform("vLightData", 4),
                    this._uniformBuffer.addUniform("vLightDiffuse", 4),
                    this._uniformBuffer.addUniform("vLightSpecular", 3),
                    this._uniformBuffer.addUniform("shadowsInfo", 3),
                    this._uniformBuffer.addUniform("depthValues", 2),
                    this._uniformBuffer.create()
                }
                ,
                r.prototype.transferToEffect = function(e, t) {
                    return this.computeTransformedInformation() ? (this._uniformBuffer.updateFloat4("vLightData", this.transformedDirection.x, this.transformedDirection.y, this.transformedDirection.z, 1, t),
                    this) : (this._uniformBuffer.updateFloat4("vLightData", this.direction.x, this.direction.y, this.direction.z, 1, t),
                    this)
                }
                ,
                r.prototype.getDepthMinZ = function(e) {
                    return 1
                }
                ,
                r.prototype.getDepthMaxZ = function(e) {
                    return 1
                }
                ,
                r.prototype.prepareLightSpecificDefines = function(e, t) {
                    e["DIRLIGHT" + t] = !0
                }
                ,
                n([e.serialize()], r.prototype, "shadowFrustumSize", null),
                n([e.serialize()], r.prototype, "shadowOrthoScale", null),
                n([e.serialize()], r.prototype, "autoUpdateExtends", void 0),
                r
            }(e.ShadowLight);
            e.DirectionalLight = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("Light_Type_2", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),e.Vector3.Zero(),0,0,i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o, a, s) {
                    var y = t.call(this, r, s) || this;
                    return y._innerAngle = 0,
                    y._projectionTextureMatrix = e.Matrix.Zero(),
                    y._projectionTextureLightNear = 1e-6,
                    y._projectionTextureLightFar = 1e3,
                    y._projectionTextureUpDirection = e.Vector3.Up(),
                    y._projectionTextureViewLightDirty = !0,
                    y._projectionTextureProjectionLightDirty = !0,
                    y._projectionTextureDirty = !0,
                    y._projectionTextureViewTargetVector = e.Vector3.Zero(),
                    y._projectionTextureViewLightMatrix = e.Matrix.Zero(),
                    y._projectionTextureProjectionLightMatrix = e.Matrix.Zero(),
                    y._projectionTextureScalingMatrix = e.Matrix.FromValues(.5, 0, 0, 0, 0, .5, 0, 0, 0, 0, .5, 0, .5, .5, .5, 1),
                    y.position = i,
                    y.direction = n,
                    y.angle = o,
                    y.exponent = a,
                    y
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "angle", {
                    get: function() {
                        return this._angle
                    },
                    set: function(e) {
                        this._angle = e,
                        this._cosHalfAngle = Math.cos(.5 * e),
                        this._projectionTextureProjectionLightDirty = !0,
                        this.forceProjectionMatrixCompute(),
                        this._computeAngleValues()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "innerAngle", {
                    get: function() {
                        return this._innerAngle
                    },
                    set: function(e) {
                        this._innerAngle = e,
                        this._computeAngleValues()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "shadowAngleScale", {
                    get: function() {
                        return this._shadowAngleScale
                    },
                    set: function(e) {
                        this._shadowAngleScale = e,
                        this.forceProjectionMatrixCompute()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "projectionTextureMatrix", {
                    get: function() {
                        return this._projectionTextureMatrix
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "projectionTextureLightNear", {
                    get: function() {
                        return this._projectionTextureLightNear
                    },
                    set: function(e) {
                        this._projectionTextureLightNear = e,
                        this._projectionTextureProjectionLightDirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "projectionTextureLightFar", {
                    get: function() {
                        return this._projectionTextureLightFar
                    },
                    set: function(e) {
                        this._projectionTextureLightFar = e,
                        this._projectionTextureProjectionLightDirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "projectionTextureUpDirection", {
                    get: function() {
                        return this._projectionTextureUpDirection
                    },
                    set: function(e) {
                        this._projectionTextureUpDirection = e,
                        this._projectionTextureProjectionLightDirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "projectionTexture", {
                    get: function() {
                        return this._projectionTexture
                    },
                    set: function(e) {
                        this._projectionTexture = e,
                        this._projectionTextureDirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getClassName = function() {
                    return "SpotLight"
                }
                ,
                r.prototype.getTypeID = function() {
                    return e.Light.LIGHTTYPEID_SPOTLIGHT
                }
                ,
                r.prototype._setDirection = function(e) {
                    t.prototype._setDirection.call(this, e),
                    this._projectionTextureViewLightDirty = !0
                }
                ,
                r.prototype._setPosition = function(e) {
                    t.prototype._setPosition.call(this, e),
                    this._projectionTextureViewLightDirty = !0
                }
                ,
                r.prototype._setDefaultShadowProjectionMatrix = function(t, r, i) {
                    var n = this.getScene().activeCamera;
                    if (n) {
                        this._shadowAngleScale = this._shadowAngleScale || 1;
                        var o = this._shadowAngleScale * this._angle;
                        e.Matrix.PerspectiveFovLHToRef(o, 1, this.getDepthMinZ(n), this.getDepthMaxZ(n), t)
                    }
                }
                ,
                r.prototype._computeProjectionTextureViewLightMatrix = function() {
                    this._projectionTextureViewLightDirty = !1,
                    this._projectionTextureDirty = !0,
                    this.position.addToRef(this.direction, this._projectionTextureViewTargetVector),
                    e.Matrix.LookAtLHToRef(this.position, this._projectionTextureViewTargetVector, this._projectionTextureUpDirection, this._projectionTextureViewLightMatrix)
                }
                ,
                r.prototype._computeProjectionTextureProjectionLightMatrix = function() {
                    this._projectionTextureProjectionLightDirty = !1,
                    this._projectionTextureDirty = !0;
                    var t = this.projectionTextureLightFar
                      , r = this.projectionTextureLightNear
                      , i = t / (t - r)
                      , n = -i * r
                      , o = 1 / Math.tan(this._angle / 2);
                    e.Matrix.FromValuesToRef(o / 1, 0, 0, 0, 0, o, 0, 0, 0, 0, i, 1, 0, 0, n, 0, this._projectionTextureProjectionLightMatrix)
                }
                ,
                r.prototype._computeProjectionTextureMatrix = function() {
                    this._projectionTextureDirty = !1,
                    this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix, this._projectionTextureMatrix),
                    this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix, this._projectionTextureMatrix)
                }
                ,
                r.prototype._buildUniformLayout = function() {
                    this._uniformBuffer.addUniform("vLightData", 4),
                    this._uniformBuffer.addUniform("vLightDiffuse", 4),
                    this._uniformBuffer.addUniform("vLightSpecular", 3),
                    this._uniformBuffer.addUniform("vLightDirection", 3),
                    this._uniformBuffer.addUniform("vLightFalloff", 4),
                    this._uniformBuffer.addUniform("shadowsInfo", 3),
                    this._uniformBuffer.addUniform("depthValues", 2),
                    this._uniformBuffer.create()
                }
                ,
                r.prototype._computeAngleValues = function() {
                    this._lightAngleScale = 1 / Math.max(.001, Math.cos(.5 * this._innerAngle) - this._cosHalfAngle),
                    this._lightAngleOffset = -this._cosHalfAngle * this._lightAngleScale
                }
                ,
                r.prototype.transferToEffect = function(t, r) {
                    var i;
                    return this.computeTransformedInformation() ? (this._uniformBuffer.updateFloat4("vLightData", this.transformedPosition.x, this.transformedPosition.y, this.transformedPosition.z, this.exponent, r),
                    i = e.Vector3.Normalize(this.transformedDirection)) : (this._uniformBuffer.updateFloat4("vLightData", this.position.x, this.position.y, this.position.z, this.exponent, r),
                    i = e.Vector3.Normalize(this.direction)),
                    this._uniformBuffer.updateFloat4("vLightDirection", i.x, i.y, i.z, this._cosHalfAngle, r),
                    this._uniformBuffer.updateFloat4("vLightFalloff", this.range, this._inverseSquaredRange, this._lightAngleScale, this._lightAngleOffset, r),
                    this.projectionTexture && this.projectionTexture.isReady() && (this._projectionTextureViewLightDirty && this._computeProjectionTextureViewLightMatrix(),
                    this._projectionTextureProjectionLightDirty && this._computeProjectionTextureProjectionLightMatrix(),
                    this._projectionTextureDirty && this._computeProjectionTextureMatrix(),
                    t.setMatrix("textureProjectionMatrix" + r, this._projectionTextureMatrix),
                    t.setTexture("projectionLightSampler" + r, this.projectionTexture)),
                    this
                }
                ,
                r.prototype.dispose = function() {
                    t.prototype.dispose.call(this),
                    this._projectionTexture && this._projectionTexture.dispose()
                }
                ,
                r.prototype.prepareLightSpecificDefines = function(e, t) {
                    e["SPOTLIGHT" + t] = !0,
                    e["PROJECTEDLIGHTTEXTURE" + t] = !!this.projectionTexture
                }
                ,
                n([e.serialize()], r.prototype, "angle", null),
                n([e.serialize()], r.prototype, "innerAngle", null),
                n([e.serialize()], r.prototype, "shadowAngleScale", null),
                n([e.serialize()], r.prototype, "exponent", void 0),
                n([e.serialize()], r.prototype, "projectionTextureLightNear", null),
                n([e.serialize()], r.prototype, "projectionTextureLightFar", null),
                n([e.serialize()], r.prototype, "projectionTextureUpDirection", null),
                n([e.serializeAsTexture("projectedLightTexture")], r.prototype, "_projectionTexture", void 0),
                r
            }(e.ShadowLight);
            e.SpotLight = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                this.enableBlending = !1,
                this.blendingSpeed = .01,
                this.loopMode = e.Animation.ANIMATIONLOOPMODE_CYCLE
            };
            e.AnimationPropertiesOverride = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e(e, t, r) {
                    this.name = e,
                    this.from = t,
                    this.to = r
                }
                return e.prototype.clone = function() {
                    return new e(this.name,this.from,this.to)
                }
                ,
                e
            }();
            e.AnimationRange = t;
            var r = function() {
                function e(e, t, r) {
                    this.frame = e,
                    this.action = t,
                    this.onlyOnce = r,
                    this.isDone = !1
                }
                return e.prototype._clone = function() {
                    return new e(this.frame,this.action,this.onlyOnce)
                }
                ,
                e
            }();
            e.AnimationEvent = r;
            var i, n = function() {
                function t(e) {
                    this.path = e,
                    this._onchange = new Array,
                    this.value = 0,
                    this.animations = new Array
                }
                return t.prototype.getPoint = function() {
                    var t = this.path.getPointAtLengthPosition(this.value);
                    return new e.Vector3(t.x,0,t.y)
                }
                ,
                t.prototype.moveAhead = function(e) {
                    return void 0 === e && (e = .002),
                    this.move(e),
                    this
                }
                ,
                t.prototype.moveBack = function(e) {
                    return void 0 === e && (e = .002),
                    this.move(-e),
                    this
                }
                ,
                t.prototype.move = function(e) {
                    if (Math.abs(e) > 1)
                        throw "step size should be less than 1.";
                    return this.value += e,
                    this.ensureLimits(),
                    this.raiseOnChange(),
                    this
                }
                ,
                t.prototype.ensureLimits = function() {
                    for (; this.value > 1; )
                        this.value -= 1;
                    for (; this.value < 0; )
                        this.value += 1;
                    return this
                }
                ,
                t.prototype.raiseOnChange = function() {
                    var e = this;
                    return this._onchange.forEach((function(t) {
                        return t(e)
                    }
                    )),
                    this
                }
                ,
                t.prototype.onchange = function(e) {
                    return this._onchange.push(e),
                    this
                }
                ,
                t
            }();
            e.PathCursor = n,
            function(e) {
                e[e.STEP = 1] = "STEP"
            }(i = e.AnimationKeyInterpolation || (e.AnimationKeyInterpolation = {}));
            var o = function() {
                function r(e, t, i, n, o, a) {
                    this.name = e,
                    this.targetProperty = t,
                    this.framePerSecond = i,
                    this.dataType = n,
                    this.loopMode = o,
                    this.enableBlending = a,
                    this._runtimeAnimations = new Array,
                    this._events = new Array,
                    this.blendingSpeed = .01,
                    this._ranges = {},
                    this.targetPropertyPath = t.split("."),
                    this.dataType = n,
                    this.loopMode = void 0 === o ? r.ANIMATIONLOOPMODE_CYCLE : o
                }
                return r._PrepareAnimation = function(t, i, n, o, a, s, y, l) {
                    var c = void 0;
                    if (!isNaN(parseFloat(a)) && isFinite(a) ? c = r.ANIMATIONTYPE_FLOAT : a instanceof e.Quaternion ? c = r.ANIMATIONTYPE_QUATERNION : a instanceof e.Vector3 ? c = r.ANIMATIONTYPE_VECTOR3 : a instanceof e.Vector2 ? c = r.ANIMATIONTYPE_VECTOR2 : a instanceof e.Color3 ? c = r.ANIMATIONTYPE_COLOR3 : a instanceof e.Size && (c = r.ANIMATIONTYPE_SIZE),
                    null == c)
                        return null;
                    var h = new r(t,i,n,c,y)
                      , u = [{
                        frame: 0,
                        value: a
                    }, {
                        frame: o,
                        value: s
                    }];
                    return h.setKeys(u),
                    void 0 !== l && h.setEasingFunction(l),
                    h
                }
                ,
                r.CreateAnimation = function(e, t, i, n) {
                    var o = new r(e + "Animation",e,i,t,r.ANIMATIONLOOPMODE_CONSTANT);
                    return o.setEasingFunction(n),
                    o
                }
                ,
                r.CreateAndStartAnimation = function(e, t, i, n, o, a, s, y, l, c) {
                    var h = r._PrepareAnimation(e, i, n, o, a, s, y, l);
                    return h ? t.getScene().beginDirectAnimation(t, [h], 0, o, 1 === h.loopMode, 1, c) : null
                }
                ,
                r.CreateAndStartHierarchyAnimation = function(e, t, i, n, o, a, s, y, l, c, h) {
                    var u = r._PrepareAnimation(e, n, o, a, s, y, l, c);
                    return u ? t.getScene().beginDirectHierarchyAnimation(t, i, [u], 0, a, 1 === u.loopMode, 1, h) : null
                }
                ,
                r.CreateMergeAndStartAnimation = function(e, t, i, n, o, a, s, y, l, c) {
                    var h = r._PrepareAnimation(e, i, n, o, a, s, y, l);
                    return h ? (t.animations.push(h),
                    t.getScene().beginAnimation(t, 0, o, 1 === h.loopMode, 1, c)) : null
                }
                ,
                r.TransitionTo = function(e, t, r, i, n, o, a, s) {
                    if (void 0 === s && (s = null),
                    a <= 0)
                        return r[e] = t,
                        s && s(),
                        null;
                    var y = n * (a / 1e3);
                    o.setKeys([{
                        frame: 0,
                        value: r[e].clone ? r[e].clone() : r[e]
                    }, {
                        frame: y,
                        value: t
                    }]),
                    r.animations || (r.animations = []),
                    r.animations.push(o);
                    var l = i.beginAnimation(r, 0, y, !1);
                    return l.onAnimationEnd = s,
                    l
                }
                ,
                Object.defineProperty(r.prototype, "runtimeAnimations", {
                    get: function() {
                        return this._runtimeAnimations
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "hasRunningRuntimeAnimations", {
                    get: function() {
                        for (var e = 0, t = this._runtimeAnimations; e < t.length; e++) {
                            if (!t[e].isStopped)
                                return !0
                        }
                        return !1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.toString = function(e) {
                    var t = "Name: " + this.name + ", property: " + this.targetProperty;
                    if (t += ", datatype: " + ["Float", "Vector3", "Quaternion", "Matrix", "Color3", "Vector2"][this.dataType],
                    t += ", nKeys: " + (this._keys ? this._keys.length : "none"),
                    t += ", nRanges: " + (this._ranges ? Object.keys(this._ranges).length : "none"),
                    e) {
                        t += ", Ranges: {";
                        var r = !0;
                        for (var i in this._ranges)
                            r && (t += ", ",
                            r = !1),
                            t += i;
                        t += "}"
                    }
                    return t
                }
                ,
                r.prototype.addEvent = function(e) {
                    this._events.push(e)
                }
                ,
                r.prototype.removeEvents = function(e) {
                    for (var t = 0; t < this._events.length; t++)
                        this._events[t].frame === e && (this._events.splice(t, 1),
                        t--)
                }
                ,
                r.prototype.getEvents = function() {
                    return this._events
                }
                ,
                r.prototype.createRange = function(e, r, i) {
                    this._ranges[e] || (this._ranges[e] = new t(e,r,i))
                }
                ,
                r.prototype.deleteRange = function(e, t) {
                    void 0 === t && (t = !0);
                    var r = this._ranges[e];
                    if (r) {
                        if (t)
                            for (var i = r.from, n = r.to, o = this._keys.length - 1; o >= 0; o--)
                                this._keys[o].frame >= i && this._keys[o].frame <= n && this._keys.splice(o, 1);
                        this._ranges[e] = null
                    }
                }
                ,
                r.prototype.getRange = function(e) {
                    return this._ranges[e]
                }
                ,
                r.prototype.getKeys = function() {
                    return this._keys
                }
                ,
                r.prototype.getHighestFrame = function() {
                    for (var e = 0, t = 0, r = this._keys.length; t < r; t++)
                        e < this._keys[t].frame && (e = this._keys[t].frame);
                    return e
                }
                ,
                r.prototype.getEasingFunction = function() {
                    return this._easingFunction
                }
                ,
                r.prototype.setEasingFunction = function(e) {
                    this._easingFunction = e
                }
                ,
                r.prototype.floatInterpolateFunction = function(t, r, i) {
                    return e.Scalar.Lerp(t, r, i)
                }
                ,
                r.prototype.floatInterpolateFunctionWithTangents = function(t, r, i, n, o) {
                    return e.Scalar.Hermite(t, r, i, n, o)
                }
                ,
                r.prototype.quaternionInterpolateFunction = function(t, r, i) {
                    return e.Quaternion.Slerp(t, r, i)
                }
                ,
                r.prototype.quaternionInterpolateFunctionWithTangents = function(t, r, i, n, o) {
                    return e.Quaternion.Hermite(t, r, i, n, o).normalize()
                }
                ,
                r.prototype.vector3InterpolateFunction = function(t, r, i) {
                    return e.Vector3.Lerp(t, r, i)
                }
                ,
                r.prototype.vector3InterpolateFunctionWithTangents = function(t, r, i, n, o) {
                    return e.Vector3.Hermite(t, r, i, n, o)
                }
                ,
                r.prototype.vector2InterpolateFunction = function(t, r, i) {
                    return e.Vector2.Lerp(t, r, i)
                }
                ,
                r.prototype.vector2InterpolateFunctionWithTangents = function(t, r, i, n, o) {
                    return e.Vector2.Hermite(t, r, i, n, o)
                }
                ,
                r.prototype.sizeInterpolateFunction = function(t, r, i) {
                    return e.Size.Lerp(t, r, i)
                }
                ,
                r.prototype.color3InterpolateFunction = function(t, r, i) {
                    return e.Color3.Lerp(t, r, i)
                }
                ,
                r.prototype._getKeyValue = function(e) {
                    return "function" == typeof e ? e() : e
                }
                ,
                r.prototype._interpolate = function(e, t, n, o, a, s) {
                    if (o === r.ANIMATIONLOOPMODE_CONSTANT && t > 0)
                        return s.clone ? s.clone() : s;
                    var y = this.getKeys()
                      , l = Math.max(0, Math.min(y.length - 1, Math.floor(y.length * (e - y[0].frame) / (y[y.length - 1].frame - y[0].frame)) - 1));
                    if (y[l].frame >= e)
                        for (; l - 1 >= 0 && y[l].frame >= e; )
                            l--;
                    for (var c = l; c < y.length; c++) {
                        var h = y[c + 1];
                        if (h.frame >= e) {
                            var u = y[c]
                              , d = this._getKeyValue(u.value);
                            if (u.interpolation === i.STEP)
                                return d;
                            var x = this._getKeyValue(h.value)
                              , p = void 0 !== u.outTangent && void 0 !== h.inTangent
                              , f = h.frame - u.frame
                              , m = (e - u.frame) / f
                              , z = this.getEasingFunction();
                            switch (null != z && (m = z.ease(m)),
                            this.dataType) {
                            case r.ANIMATIONTYPE_FLOAT:
                                var _ = p ? this.floatInterpolateFunctionWithTangents(d, u.outTangent * f, x, h.inTangent * f, m) : this.floatInterpolateFunction(d, x, m);
                                switch (o) {
                                case r.ANIMATIONLOOPMODE_CYCLE:
                                case r.ANIMATIONLOOPMODE_CONSTANT:
                                    return _;
                                case r.ANIMATIONLOOPMODE_RELATIVE:
                                    return a * t + _
                                }
                                break;
                            case r.ANIMATIONTYPE_QUATERNION:
                                var g = p ? this.quaternionInterpolateFunctionWithTangents(d, u.outTangent.scale(f), x, h.inTangent.scale(f), m) : this.quaternionInterpolateFunction(d, x, m);
                                switch (o) {
                                case r.ANIMATIONLOOPMODE_CYCLE:
                                case r.ANIMATIONLOOPMODE_CONSTANT:
                                    return g;
                                case r.ANIMATIONLOOPMODE_RELATIVE:
                                    return g.addInPlace(a.scale(t))
                                }
                                return g;
                            case r.ANIMATIONTYPE_VECTOR3:
                                var v = p ? this.vector3InterpolateFunctionWithTangents(d, u.outTangent.scale(f), x, h.inTangent.scale(f), m) : this.vector3InterpolateFunction(d, x, m);
                                switch (o) {
                                case r.ANIMATIONLOOPMODE_CYCLE:
                                case r.ANIMATIONLOOPMODE_CONSTANT:
                                    return v;
                                case r.ANIMATIONLOOPMODE_RELATIVE:
                                    return v.add(a.scale(t))
                                }
                            case r.ANIMATIONTYPE_VECTOR2:
                                var b = p ? this.vector2InterpolateFunctionWithTangents(d, u.outTangent.scale(f), x, h.inTangent.scale(f), m) : this.vector2InterpolateFunction(d, x, m);
                                switch (o) {
                                case r.ANIMATIONLOOPMODE_CYCLE:
                                case r.ANIMATIONLOOPMODE_CONSTANT:
                                    return b;
                                case r.ANIMATIONLOOPMODE_RELATIVE:
                                    return b.add(a.scale(t))
                                }
                            case r.ANIMATIONTYPE_SIZE:
                                switch (o) {
                                case r.ANIMATIONLOOPMODE_CYCLE:
                                case r.ANIMATIONLOOPMODE_CONSTANT:
                                    return this.sizeInterpolateFunction(d, x, m);
                                case r.ANIMATIONLOOPMODE_RELATIVE:
                                    return this.sizeInterpolateFunction(d, x, m).add(a.scale(t))
                                }
                            case r.ANIMATIONTYPE_COLOR3:
                                switch (o) {
                                case r.ANIMATIONLOOPMODE_CYCLE:
                                case r.ANIMATIONLOOPMODE_CONSTANT:
                                    return this.color3InterpolateFunction(d, x, m);
                                case r.ANIMATIONLOOPMODE_RELATIVE:
                                    return this.color3InterpolateFunction(d, x, m).add(a.scale(t))
                                }
                            case r.ANIMATIONTYPE_MATRIX:
                                switch (o) {
                                case r.ANIMATIONLOOPMODE_CYCLE:
                                case r.ANIMATIONLOOPMODE_CONSTANT:
                                    if (r.AllowMatricesInterpolation)
                                        return this.matrixInterpolateFunction(d, x, m, n);
                                case r.ANIMATIONLOOPMODE_RELATIVE:
                                    return d
                                }
                            }
                            break
                        }
                    }
                    return this._getKeyValue(y[y.length - 1].value)
                }
                ,
                r.prototype.matrixInterpolateFunction = function(t, i, n, o) {
                    return r.AllowMatrixDecomposeForInterpolation ? o ? (e.Matrix.DecomposeLerpToRef(t, i, n, o),
                    o) : e.Matrix.DecomposeLerp(t, i, n) : o ? (e.Matrix.LerpToRef(t, i, n, o),
                    o) : e.Matrix.Lerp(t, i, n)
                }
                ,
                r.prototype.clone = function() {
                    var e = new r(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);
                    if (e.enableBlending = this.enableBlending,
                    e.blendingSpeed = this.blendingSpeed,
                    this._keys && e.setKeys(this._keys),
                    this._ranges)
                        for (var t in e._ranges = {},
                        this._ranges) {
                            var i = this._ranges[t];
                            i && (e._ranges[t] = i.clone())
                        }
                    return e
                }
                ,
                r.prototype.setKeys = function(e) {
                    this._keys = e.slice(0)
                }
                ,
                r.prototype.serialize = function() {
                    var e = {};
                    e.name = this.name,
                    e.property = this.targetProperty,
                    e.framePerSecond = this.framePerSecond,
                    e.dataType = this.dataType,
                    e.loopBehavior = this.loopMode,
                    e.enableBlending = this.enableBlending,
                    e.blendingSpeed = this.blendingSpeed;
                    var t = this.dataType;
                    e.keys = [];
                    for (var i = this.getKeys(), n = 0; n < i.length; n++) {
                        var o = i[n]
                          , a = {};
                        switch (a.frame = o.frame,
                        t) {
                        case r.ANIMATIONTYPE_FLOAT:
                            a.values = [o.value];
                            break;
                        case r.ANIMATIONTYPE_QUATERNION:
                        case r.ANIMATIONTYPE_MATRIX:
                        case r.ANIMATIONTYPE_VECTOR3:
                        case r.ANIMATIONTYPE_COLOR3:
                            a.values = o.value.asArray()
                        }
                        e.keys.push(a)
                    }
                    for (var s in e.ranges = [],
                    this._ranges) {
                        var y = this._ranges[s];
                        if (y) {
                            var l = {};
                            l.name = s,
                            l.from = y.from,
                            l.to = y.to,
                            e.ranges.push(l)
                        }
                    }
                    return e
                }
                ,
                Object.defineProperty(r, "ANIMATIONTYPE_FLOAT", {
                    get: function() {
                        return r._ANIMATIONTYPE_FLOAT
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "ANIMATIONTYPE_VECTOR3", {
                    get: function() {
                        return r._ANIMATIONTYPE_VECTOR3
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "ANIMATIONTYPE_VECTOR2", {
                    get: function() {
                        return r._ANIMATIONTYPE_VECTOR2
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "ANIMATIONTYPE_SIZE", {
                    get: function() {
                        return r._ANIMATIONTYPE_SIZE
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "ANIMATIONTYPE_QUATERNION", {
                    get: function() {
                        return r._ANIMATIONTYPE_QUATERNION
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "ANIMATIONTYPE_MATRIX", {
                    get: function() {
                        return r._ANIMATIONTYPE_MATRIX
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "ANIMATIONTYPE_COLOR3", {
                    get: function() {
                        return r._ANIMATIONTYPE_COLOR3
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "ANIMATIONLOOPMODE_RELATIVE", {
                    get: function() {
                        return r._ANIMATIONLOOPMODE_RELATIVE
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "ANIMATIONLOOPMODE_CYCLE", {
                    get: function() {
                        return r._ANIMATIONLOOPMODE_CYCLE
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "ANIMATIONLOOPMODE_CONSTANT", {
                    get: function() {
                        return r._ANIMATIONLOOPMODE_CONSTANT
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r._UniversalLerp = function(e, t, r) {
                    var i = e.constructor;
                    return i.Lerp ? i.Lerp(e, t, r) : i.Slerp ? i.Slerp(e, t, r) : e.toFixed ? e * (1 - r) + r * t : t
                }
                ,
                r.Parse = function(t) {
                    var i, n, o = new r(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior), a = t.dataType, s = [];
                    for (t.enableBlending && (o.enableBlending = t.enableBlending),
                    t.blendingSpeed && (o.blendingSpeed = t.blendingSpeed),
                    n = 0; n < t.keys.length; n++) {
                        var y, l, c = t.keys[n];
                        switch (a) {
                        case r.ANIMATIONTYPE_FLOAT:
                            i = c.values[0],
                            c.values.length >= 1 && (y = c.values[1]),
                            c.values.length >= 2 && (l = c.values[2]);
                            break;
                        case r.ANIMATIONTYPE_QUATERNION:
                            if (i = e.Quaternion.FromArray(c.values),
                            c.values.length >= 8) {
                                var h = e.Quaternion.FromArray(c.values.slice(4, 8));
                                h.equals(e.Quaternion.Zero()) || (y = h)
                            }
                            if (c.values.length >= 12) {
                                var u = e.Quaternion.FromArray(c.values.slice(8, 12));
                                u.equals(e.Quaternion.Zero()) || (l = u)
                            }
                            break;
                        case r.ANIMATIONTYPE_MATRIX:
                            i = e.Matrix.FromArray(c.values);
                            break;
                        case r.ANIMATIONTYPE_COLOR3:
                            i = e.Color3.FromArray(c.values);
                            break;
                        case r.ANIMATIONTYPE_VECTOR3:
                        default:
                            i = e.Vector3.FromArray(c.values)
                        }
                        var d = {};
                        d.frame = c.frame,
                        d.value = i,
                        null != y && (d.inTangent = y),
                        null != l && (d.outTangent = l),
                        s.push(d)
                    }
                    if (o.setKeys(s),
                    t.ranges)
                        for (n = 0; n < t.ranges.length; n++)
                            i = t.ranges[n],
                            o.createRange(i.name, i.from, i.to);
                    return o
                }
                ,
                r.AppendSerializedAnimations = function(e, t) {
                    if (e.animations) {
                        t.animations = [];
                        for (var r = 0; r < e.animations.length; r++) {
                            var i = e.animations[r];
                            t.animations.push(i.serialize())
                        }
                    }
                }
                ,
                r.AllowMatricesInterpolation = !1,
                r.AllowMatrixDecomposeForInterpolation = !0,
                r._ANIMATIONTYPE_FLOAT = 0,
                r._ANIMATIONTYPE_VECTOR3 = 1,
                r._ANIMATIONTYPE_QUATERNION = 2,
                r._ANIMATIONTYPE_MATRIX = 3,
                r._ANIMATIONTYPE_COLOR3 = 4,
                r._ANIMATIONTYPE_VECTOR2 = 5,
                r._ANIMATIONTYPE_SIZE = 6,
                r._ANIMATIONLOOPMODE_RELATIVE = 0,
                r._ANIMATIONLOOPMODE_CYCLE = 1,
                r._ANIMATIONLOOPMODE_CONSTANT = 2,
                r
            }();
            e.Animation = o
        }(s || (s = {})),
        function(e) {
            var t = function() {};
            e.TargetedAnimation = t;
            var r = function() {
                function t(t, r) {
                    void 0 === r && (r = null),
                    this.name = t,
                    this._targetedAnimations = new Array,
                    this._animatables = new Array,
                    this._from = Number.MAX_VALUE,
                    this._to = -Number.MAX_VALUE,
                    this._speedRatio = 1,
                    this.onAnimationEndObservable = new e.Observable,
                    this.onAnimationGroupEndObservable = new e.Observable,
                    this.onAnimationGroupPauseObservable = new e.Observable,
                    this._scene = r || e.Engine.LastCreatedScene,
                    this._scene.animationGroups.push(this)
                }
                return Object.defineProperty(t.prototype, "from", {
                    get: function() {
                        return this._from
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "to", {
                    get: function() {
                        return this._to
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "isStarted", {
                    get: function() {
                        return this._isStarted
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "speedRatio", {
                    get: function() {
                        return this._speedRatio
                    },
                    set: function(e) {
                        if (this._speedRatio !== e) {
                            this._speedRatio = e;
                            for (var t = 0; t < this._animatables.length; t++) {
                                this._animatables[t].speedRatio = this._speedRatio
                            }
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "targetedAnimations", {
                    get: function() {
                        return this._targetedAnimations
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "animatables", {
                    get: function() {
                        return this._animatables
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.addTargetedAnimation = function(e, t) {
                    var r = {
                        animation: e,
                        target: t
                    }
                      , i = e.getKeys();
                    return this._from > i[0].frame && (this._from = i[0].frame),
                    this._to < i[i.length - 1].frame && (this._to = i[i.length - 1].frame),
                    this._targetedAnimations.push(r),
                    r
                }
                ,
                t.prototype.normalize = function(e, t) {
                    void 0 === e && (e = null),
                    void 0 === t && (t = null),
                    null == e && (e = this._from),
                    null == t && (t = this._to);
                    for (var r = 0; r < this._targetedAnimations.length; r++) {
                        var i = this._targetedAnimations[r].animation.getKeys()
                          , n = i[0]
                          , o = i[i.length - 1];
                        if (n.frame > e) {
                            var a = {
                                frame: e,
                                value: n.value,
                                inTangent: n.inTangent,
                                outTangent: n.outTangent,
                                interpolation: n.interpolation
                            };
                            i.splice(0, 0, a)
                        }
                        if (o.frame < t) {
                            a = {
                                frame: t,
                                value: o.value,
                                inTangent: o.outTangent,
                                outTangent: o.outTangent,
                                interpolation: o.interpolation
                            };
                            i.push(a)
                        }
                    }
                    return this._from = e,
                    this._to = t,
                    this
                }
                ,
                t.prototype.start = function(e, t, r, i) {
                    var n = this;
                    if (void 0 === e && (e = !1),
                    void 0 === t && (t = 1),
                    this._isStarted || 0 === this._targetedAnimations.length)
                        return this;
                    for (var o = function(o) {
                        var s = a._scene.beginDirectAnimation(o.target, [o.animation], void 0 !== r ? r : a._from, void 0 !== i ? i : a._to, e, t);
                        s.onAnimationEnd = function() {
                            n.onAnimationEndObservable.notifyObservers(o),
                            n._checkAnimationGroupEnded(s)
                        }
                        ,
                        a._animatables.push(s)
                    }, a = this, s = 0, y = this._targetedAnimations; s < y.length; s++) {
                        o(y[s])
                    }
                    return this._speedRatio = t,
                    this._isStarted = !0,
                    this
                }
                ,
                t.prototype.pause = function() {
                    if (!this._isStarted)
                        return this;
                    for (var e = 0; e < this._animatables.length; e++) {
                        this._animatables[e].pause()
                    }
                    return this.onAnimationGroupPauseObservable.notifyObservers(this),
                    this
                }
                ,
                t.prototype.play = function(e) {
                    if (this.isStarted && this._animatables.length === this._targetedAnimations.length) {
                        if (void 0 !== e)
                            for (var t = 0; t < this._animatables.length; t++) {
                                this._animatables[t].loopAnimation = e
                            }
                        this.restart()
                    } else
                        this.stop(),
                        this.start(e, this._speedRatio);
                    return this
                }
                ,
                t.prototype.reset = function() {
                    if (!this._isStarted)
                        return this;
                    for (var e = 0; e < this._animatables.length; e++) {
                        this._animatables[e].reset()
                    }
                    return this
                }
                ,
                t.prototype.restart = function() {
                    if (!this._isStarted)
                        return this;
                    for (var e = 0; e < this._animatables.length; e++) {
                        this._animatables[e].restart()
                    }
                    return this
                }
                ,
                t.prototype.stop = function() {
                    if (!this._isStarted)
                        return this;
                    for (var e = this._animatables.slice(), t = 0; t < e.length; t++)
                        e[t].stop();
                    return this._isStarted = !1,
                    this
                }
                ,
                t.prototype.setWeightForAllAnimatables = function(e) {
                    for (var t = 0; t < this._animatables.length; t++) {
                        this._animatables[t].weight = e
                    }
                    return this
                }
                ,
                t.prototype.syncAllAnimationsWith = function(e) {
                    for (var t = 0; t < this._animatables.length; t++) {
                        this._animatables[t].syncWith(e)
                    }
                    return this
                }
                ,
                t.prototype.goToFrame = function(e) {
                    if (!this._isStarted)
                        return this;
                    for (var t = 0; t < this._animatables.length; t++) {
                        this._animatables[t].goToFrame(e)
                    }
                    return this
                }
                ,
                t.prototype.dispose = function() {
                    this._targetedAnimations = [],
                    this._animatables = [];
                    var e = this._scene.animationGroups.indexOf(this);
                    e > -1 && this._scene.animationGroups.splice(e, 1)
                }
                ,
                t.prototype._checkAnimationGroupEnded = function(e) {
                    var t = this._animatables.indexOf(e);
                    t > -1 && this._animatables.splice(t, 1),
                    0 === this._animatables.length && (this._isStarted = !1,
                    this.onAnimationGroupEndObservable.notifyObservers(this))
                }
                ,
                t.Parse = function(t, r) {
                    for (var i = new e.AnimationGroup(t.name,r), n = 0; n < t.targetedAnimations.length; n++) {
                        var o = t.targetedAnimations[n]
                          , a = e.Animation.Parse(o.animation)
                          , s = o.targetId
                          , y = r.getNodeByID(s);
                        null != y && i.addTargetedAnimation(a, y)
                    }
                    return null !== t.from && null !== t.from && i.normalize(t.from, t.to),
                    i
                }
                ,
                t.prototype.getClassName = function() {
                    return "AnimationGroup"
                }
                ,
                t.prototype.toString = function(e) {
                    var t = "Name: " + this.name;
                    return t += ", type: " + this.getClassName(),
                    e && (t += ", from: " + this._from,
                    t += ", to: " + this._to,
                    t += ", isStarted: " + this._isStarted,
                    t += ", speedRatio: " + this._speedRatio,
                    t += ", targetedAnimations length: " + this._targetedAnimations.length,
                    t += ", animatables length: " + this._animatables),
                    t
                }
                ,
                t
            }();
            e.AnimationGroup = r
        }(s || (s = {})),
        function(e) {
            var t = Object.freeze(new e.Quaternion(0,0,0,0))
              , r = Object.freeze(e.Vector3.Zero())
              , i = Object.freeze(e.Vector2.Zero())
              , n = Object.freeze(e.Size.Zero())
              , o = Object.freeze(e.Color3.Black())
              , a = function() {
                function a(e, t, r, i) {
                    var n = this;
                    this._events = new Array,
                    this._currentFrame = 0,
                    this._originalValue = new Array,
                    this._offsetsCache = {},
                    this._highLimitsCache = {},
                    this._stopped = !1,
                    this._blendingFactor = 0,
                    this._targetPath = "",
                    this._weight = 1,
                    this._ratioOffset = 0,
                    this._previousDelay = 0,
                    this._previousRatio = 0,
                    this._animation = t,
                    this._target = e,
                    this._scene = r,
                    this._host = i,
                    t._runtimeAnimations.push(this);
                    var o = t.getEvents();
                    o && o.length > 0 && o.forEach((function(e) {
                        n._events.push(e._clone())
                    }
                    ))
                }
                return Object.defineProperty(a.prototype, "currentFrame", {
                    get: function() {
                        return this._currentFrame
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(a.prototype, "weight", {
                    get: function() {
                        return this._weight
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(a.prototype, "currentValue", {
                    get: function() {
                        return this._currentValue
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(a.prototype, "targetPath", {
                    get: function() {
                        return this._targetPath
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(a.prototype, "target", {
                    get: function() {
                        return this._activeTarget
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(a.prototype, "animation", {
                    get: function() {
                        return this._animation
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                a.prototype.reset = function(e) {
                    if (void 0 === e && (e = !1),
                    e)
                        if (this._target instanceof Array)
                            for (var t = 0, r = 0, i = this._target; r < i.length; r++) {
                                var n = i[r];
                                void 0 !== this._originalValue[t] && this._setValue(n, this._originalValue[t], -1),
                                t++
                            }
                        else
                            void 0 !== this._originalValue[0] && this._setValue(this._target, this._originalValue[0], -1);
                    this._offsetsCache = {},
                    this._highLimitsCache = {},
                    this._currentFrame = 0,
                    this._blendingFactor = 0,
                    this._originalValue = new Array;
                    for (t = 0; t < this._events.length; t++)
                        this._events[t].isDone = !1
                }
                ,
                a.prototype.isStopped = function() {
                    return this._stopped
                }
                ,
                a.prototype.dispose = function() {
                    var e = this._animation.runtimeAnimations.indexOf(this);
                    e > -1 && this._animation.runtimeAnimations.splice(e, 1)
                }
                ,
                a.prototype._interpolate = function(t, r, i, n, o) {
                    return this._currentFrame = t,
                    this._animation.dataType !== e.Animation.ANIMATIONTYPE_MATRIX || this._workValue || (this._workValue = e.Matrix.Zero()),
                    this._animation._interpolate(t, r, this._workValue, i, n, o)
                }
                ,
                a.prototype.setValue = function(e, t) {
                    if (void 0 === t && (t = 1),
                    this._target instanceof Array)
                        for (var r = 0, i = 0, n = this._target; i < n.length; i++) {
                            var o = n[i];
                            this._setValue(o, e, t, r),
                            r++
                        }
                    else
                        this._setValue(this._target, e, t)
                }
                ,
                a.prototype._setValue = function(t, r, i, n) {
                    var o, a;
                    void 0 === n && (n = 0);
                    var s = this._animation.targetPropertyPath;
                    if (s.length > 1) {
                        for (var y = t[s[0]], l = 1; l < s.length - 1; l++)
                            y = y[s[l]];
                        o = s[s.length - 1],
                        a = y
                    } else
                        o = s[0],
                        a = t;
                    if (this._targetPath = o,
                    this._activeTarget = a,
                    this._weight = i,
                    void 0 === this._originalValue[n]) {
                        var c = void 0;
                        (c = a.getRestPose && "_matrix" === o ? a.getRestPose() : a[o]) && c.clone ? this._originalValue[n] = c.clone() : this._originalValue[n] = c
                    }
                    if ((t && t.animationPropertiesOverride ? t.animationPropertiesOverride.enableBlending : this._animation.enableBlending) && this._blendingFactor <= 1) {
                        if (!this._originalBlendValue)
                            (c = a[o]).clone ? this._originalBlendValue = c.clone() : this._originalBlendValue = c;
                        this._originalBlendValue.m ? e.Animation.AllowMatrixDecomposeForInterpolation ? this._currentValue ? e.Matrix.DecomposeLerpToRef(this._originalBlendValue, r, this._blendingFactor, this._currentValue) : this._currentValue = e.Matrix.DecomposeLerp(this._originalBlendValue, r, this._blendingFactor) : this._currentValue ? e.Matrix.LerpToRef(this._originalBlendValue, r, this._blendingFactor, this._currentValue) : this._currentValue = e.Matrix.Lerp(this._originalBlendValue, r, this._blendingFactor) : this._currentValue = e.Animation._UniversalLerp(this._originalBlendValue, r, this._blendingFactor);
                        var h = t && t.animationPropertiesOverride ? t.animationPropertiesOverride.blendingSpeed : this._animation.blendingSpeed;
                        this._blendingFactor += h
                    } else
                        this._currentValue = r;
                    -1 !== i ? this._scene._registerTargetForLateAnimationBinding(this, this._originalValue[n]) : a[o] = this._currentValue,
                    t.markAsDirty && t.markAsDirty(this._animation.targetProperty)
                }
                ,
                a.prototype._getCorrectLoopMode = function() {
                    return this._target && this._target.animationPropertiesOverride ? this._target.animationPropertiesOverride.loopMode : this._animation.loopMode
                }
                ,
                a.prototype.goToFrame = function(e) {
                    var t = this._animation.getKeys();
                    e < t[0].frame ? e = t[0].frame : e > t[t.length - 1].frame && (e = t[t.length - 1].frame);
                    var r = this._interpolate(e, 0, this._getCorrectLoopMode());
                    this.setValue(r, -1)
                }
                ,
                a.prototype._prepareForSpeedRatioChange = function(e) {
                    var t = this._previousDelay * (this._animation.framePerSecond * e) / 1e3;
                    this._ratioOffset = this._previousRatio - t
                }
                ,
                a.prototype.animate = function(a, s, y, l, c, h) {
                    void 0 === h && (h = -1);
                    var u = this._animation.targetPropertyPath;
                    if (!u || u.length < 1)
                        return this._stopped = !0,
                        !1;
                    var d = !0
                      , x = this._animation.getKeys();
                    if (0 !== x[0].frame) {
                        var p = {
                            frame: 0,
                            value: x[0].value
                        };
                        x.splice(0, 0, p)
                    } else if (1 === x.length) {
                        p = {
                            frame: .001,
                            value: x[0].value
                        };
                        x.push(p)
                    }
                    (s < x[0].frame || s > x[x.length - 1].frame) && (s = x[0].frame),
                    (y < x[0].frame || y > x[x.length - 1].frame) && (y = x[x.length - 1].frame),
                    s === y && (s > x[0].frame ? s-- : y < x[x.length - 1].frame && y++);
                    var f, m = y - s, z = a * (this._animation.framePerSecond * c) / 1e3 + this._ratioOffset, _ = 0;
                    if (this._previousDelay = a,
                    this._previousRatio = z,
                    (y > s && z >= m || s > y && z <= m) && !l)
                        d = !1,
                        _ = this._animation._getKeyValue(x[x.length - 1].value);
                    else if (this._getCorrectLoopMode() !== e.Animation.ANIMATIONLOOPMODE_CYCLE) {
                        var g = y.toString() + s.toString();
                        if (!this._offsetsCache[g]) {
                            var v = this._interpolate(s, 0, e.Animation.ANIMATIONLOOPMODE_CYCLE)
                              , b = this._interpolate(y, 0, e.Animation.ANIMATIONLOOPMODE_CYCLE);
                            switch (this._animation.dataType) {
                            case e.Animation.ANIMATIONTYPE_FLOAT:
                                this._offsetsCache[g] = b - v;
                                break;
                            case e.Animation.ANIMATIONTYPE_QUATERNION:
                                this._offsetsCache[g] = b.subtract(v);
                                break;
                            case e.Animation.ANIMATIONTYPE_VECTOR3:
                                this._offsetsCache[g] = b.subtract(v);
                            case e.Animation.ANIMATIONTYPE_VECTOR2:
                                this._offsetsCache[g] = b.subtract(v);
                            case e.Animation.ANIMATIONTYPE_SIZE:
                                this._offsetsCache[g] = b.subtract(v);
                            case e.Animation.ANIMATIONTYPE_COLOR3:
                                this._offsetsCache[g] = b.subtract(v)
                            }
                            this._highLimitsCache[g] = b
                        }
                        _ = this._highLimitsCache[g],
                        f = this._offsetsCache[g]
                    }
                    if (void 0 === f)
                        switch (this._animation.dataType) {
                        case e.Animation.ANIMATIONTYPE_FLOAT:
                            f = 0;
                            break;
                        case e.Animation.ANIMATIONTYPE_QUATERNION:
                            f = t;
                            break;
                        case e.Animation.ANIMATIONTYPE_VECTOR3:
                            f = r;
                            break;
                        case e.Animation.ANIMATIONTYPE_VECTOR2:
                            f = i;
                            break;
                        case e.Animation.ANIMATIONTYPE_SIZE:
                            f = n;
                            break;
                        case e.Animation.ANIMATIONTYPE_COLOR3:
                            f = o
                        }
                    var T = z / m >> 0
                      , E = d ? s + z % m : y;
                    if (this._host && this._host.syncRoot) {
                        var P = this._host.syncRoot;
                        E = s + (y - s) * ((P.masterFrame - P.fromFrame) / (P.toFrame - P.fromFrame))
                    }
                    var A = this._events;
                    if (m > 0 && this.currentFrame > E || m < 0 && this.currentFrame < E)
                        for (var S = 0; S < A.length; S++)
                            A[S].onlyOnce || (A[S].isDone = !1);
                    var M = this._interpolate(E, T, this._getCorrectLoopMode(), f, _);
                    this.setValue(M, h);
                    for (S = 0; S < A.length; S++)
                        if (m > 0 && E >= A[S].frame && A[S].frame >= s || m < 0 && E <= A[S].frame && A[S].frame <= s) {
                            var C = A[S];
                            C.isDone || (C.onlyOnce && (A.splice(S, 1),
                            S--),
                            C.isDone = !0,
                            C.action(E))
                        }
                    return d || (this._stopped = !0),
                    d
                }
                ,
                a
            }();
            e.RuntimeAnimation = a
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n, o, a, s, y) {
                    void 0 === i && (i = 0),
                    void 0 === n && (n = 100),
                    void 0 === o && (o = !1),
                    void 0 === a && (a = 1),
                    this.target = r,
                    this.fromFrame = i,
                    this.toFrame = n,
                    this.loopAnimation = o,
                    this.onAnimationEnd = s,
                    this._localDelayOffset = null,
                    this._pausedDelay = null,
                    this._runtimeAnimations = new Array,
                    this._paused = !1,
                    this._speedRatio = 1,
                    this._weight = -1,
                    this.disposeOnEnd = !0,
                    this.animationStarted = !1,
                    this.onAnimationEndObservable = new e.Observable,
                    this._scene = t,
                    y && this.appendAnimations(r, y),
                    this._speedRatio = a,
                    t._activeAnimatables.push(this)
                }
                return Object.defineProperty(t.prototype, "syncRoot", {
                    get: function() {
                        return this._syncRoot
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "masterFrame", {
                    get: function() {
                        return 0 === this._runtimeAnimations.length ? 0 : this._runtimeAnimations[0].currentFrame
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "weight", {
                    get: function() {
                        return this._weight
                    },
                    set: function(e) {
                        this._weight = -1 !== e ? Math.min(Math.max(e, 0), 1) : -1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "speedRatio", {
                    get: function() {
                        return this._speedRatio
                    },
                    set: function(e) {
                        for (var t = 0; t < this._runtimeAnimations.length; t++) {
                            this._runtimeAnimations[t]._prepareForSpeedRatioChange(e)
                        }
                        this._speedRatio = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.syncWith = function(e) {
                    if (this._syncRoot = e,
                    e) {
                        var t = this._scene._activeAnimatables.indexOf(this);
                        t > -1 && (this._scene._activeAnimatables.splice(t, 1),
                        this._scene._activeAnimatables.push(this))
                    }
                    return this
                }
                ,
                t.prototype.getAnimations = function() {
                    return this._runtimeAnimations
                }
                ,
                t.prototype.appendAnimations = function(t, r) {
                    for (var i = 0; i < r.length; i++) {
                        var n = r[i];
                        this._runtimeAnimations.push(new e.RuntimeAnimation(t,n,this._scene,this))
                    }
                }
                ,
                t.prototype.getAnimationByTargetProperty = function(e) {
                    for (var t = this._runtimeAnimations, r = 0; r < t.length; r++)
                        if (t[r].animation.targetProperty === e)
                            return t[r].animation;
                    return null
                }
                ,
                t.prototype.getRuntimeAnimationByTargetProperty = function(e) {
                    for (var t = this._runtimeAnimations, r = 0; r < t.length; r++)
                        if (t[r].animation.targetProperty === e)
                            return t[r];
                    return null
                }
                ,
                t.prototype.reset = function() {
                    for (var e = this._runtimeAnimations, t = 0; t < e.length; t++)
                        e[t].reset(!0);
                    this._localDelayOffset = null,
                    this._pausedDelay = null
                }
                ,
                t.prototype.enableBlending = function(e) {
                    for (var t = this._runtimeAnimations, r = 0; r < t.length; r++)
                        t[r].animation.enableBlending = !0,
                        t[r].animation.blendingSpeed = e
                }
                ,
                t.prototype.disableBlending = function() {
                    for (var e = this._runtimeAnimations, t = 0; t < e.length; t++)
                        e[t].animation.enableBlending = !1
                }
                ,
                t.prototype.goToFrame = function(e) {
                    var t = this._runtimeAnimations;
                    if (t[0]) {
                        var r = t[0].animation.framePerSecond
                          , i = 1e3 * (e - t[0].currentFrame) / (r * this.speedRatio);
                        null === this._localDelayOffset && (this._localDelayOffset = 0),
                        this._localDelayOffset -= i
                    }
                    for (var n = 0; n < t.length; n++)
                        t[n].goToFrame(e)
                }
                ,
                t.prototype.pause = function() {
                    this._paused || (this._paused = !0)
                }
                ,
                t.prototype.restart = function() {
                    this._paused = !1
                }
                ,
                t.prototype._raiseOnAnimationEnd = function() {
                    this.onAnimationEnd && this.onAnimationEnd(),
                    this.onAnimationEndObservable.notifyObservers(this)
                }
                ,
                t.prototype.stop = function(e, t) {
                    if (e || t) {
                        var r = this._scene._activeAnimatables.indexOf(this);
                        if (r > -1) {
                            for (var i = (o = this._runtimeAnimations).length - 1; i >= 0; i--) {
                                var n = o[i];
                                e && n.animation.name != e || (t && !t(n.target) || (n.dispose(),
                                o.splice(i, 1)))
                            }
                            0 == o.length && (this._scene._activeAnimatables.splice(r, 1),
                            this._raiseOnAnimationEnd())
                        }
                    } else {
                        if ((i = this._scene._activeAnimatables.indexOf(this)) > -1) {
                            this._scene._activeAnimatables.splice(i, 1);
                            var o = this._runtimeAnimations;
                            for (i = 0; i < o.length; i++)
                                o[i].dispose();
                            this._raiseOnAnimationEnd()
                        }
                    }
                }
                ,
                t.prototype.waitAsync = function() {
                    var e = this;
                    return new Promise((function(t, r) {
                        e.onAnimationEndObservable.add((function() {
                            t(e)
                        }
                        ), void 0, void 0, e, !0)
                    }
                    ))
                }
                ,
                t.prototype._animate = function(e) {
                    if (this._paused)
                        return this.animationStarted = !1,
                        null === this._pausedDelay && (this._pausedDelay = e),
                        !0;
                    if (null === this._localDelayOffset ? (this._localDelayOffset = e,
                    this._pausedDelay = null) : null !== this._pausedDelay && (this._localDelayOffset += e - this._pausedDelay,
                    this._pausedDelay = null),
                    0 === this._weight)
                        return !0;
                    var t, r = !1, i = this._runtimeAnimations;
                    for (t = 0; t < i.length; t++) {
                        var n = i[t].animate(e - this._localDelayOffset, this.fromFrame, this.toFrame, this.loopAnimation, this._speedRatio, this._weight);
                        r = r || n
                    }
                    if (this.animationStarted = r,
                    !r) {
                        if (this.disposeOnEnd)
                            for (t = this._scene._activeAnimatables.indexOf(this),
                            this._scene._activeAnimatables.splice(t, 1),
                            t = 0; t < i.length; t++)
                                i[t].dispose();
                        this._raiseOnAnimationEnd(),
                        this.disposeOnEnd && (this.onAnimationEnd = null,
                        this.onAnimationEndObservable.clear())
                    }
                    return r
                }
                ,
                t
            }();
            e.Animatable = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {
                    this._easingMode = e.EASINGMODE_EASEIN
                }
                return e.prototype.setEasingMode = function(e) {
                    var t = Math.min(Math.max(e, 0), 2);
                    this._easingMode = t
                }
                ,
                e.prototype.getEasingMode = function() {
                    return this._easingMode
                }
                ,
                e.prototype.easeInCore = function(e) {
                    throw new Error("You must implement this method")
                }
                ,
                e.prototype.ease = function(t) {
                    switch (this._easingMode) {
                    case e.EASINGMODE_EASEIN:
                        return this.easeInCore(t);
                    case e.EASINGMODE_EASEOUT:
                        return 1 - this.easeInCore(1 - t)
                    }
                    return t >= .5 ? .5 * (1 - this.easeInCore(2 * (1 - t))) + .5 : .5 * this.easeInCore(2 * t)
                }
                ,
                e.EASINGMODE_EASEIN = 0,
                e.EASINGMODE_EASEOUT = 1,
                e.EASINGMODE_EASEINOUT = 2,
                e
            }();
            e.EasingFunction = t;
            var r = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.easeInCore = function(e) {
                    return e = Math.max(0, Math.min(1, e)),
                    1 - Math.sqrt(1 - e * e)
                }
                ,
                t
            }(t);
            e.CircleEase = r;
            var i = function(e) {
                function t(t) {
                    void 0 === t && (t = 1);
                    var r = e.call(this) || this;
                    return r.amplitude = t,
                    r
                }
                return o(t, e),
                t.prototype.easeInCore = function(e) {
                    var t = Math.max(0, this.amplitude);
                    return Math.pow(e, 3) - e * t * Math.sin(3.141592653589793 * e)
                }
                ,
                t
            }(t);
            e.BackEase = i;
            var n = function(e) {
                function t(t, r) {
                    void 0 === t && (t = 3),
                    void 0 === r && (r = 2);
                    var i = e.call(this) || this;
                    return i.bounces = t,
                    i.bounciness = r,
                    i
                }
                return o(t, e),
                t.prototype.easeInCore = function(e) {
                    var t = Math.max(0, this.bounces)
                      , r = this.bounciness;
                    r <= 1 && (r = 1.001);
                    var i = Math.pow(r, t)
                      , n = 1 - r
                      , o = (1 - i) / n + .5 * i
                      , a = e * o
                      , s = Math.log(-a * (1 - r) + 1) / Math.log(r)
                      , y = Math.floor(s)
                      , l = y + 1
                      , c = (1 - Math.pow(r, y)) / (n * o)
                      , h = .5 * (c + (1 - Math.pow(r, l)) / (n * o))
                      , u = e - h
                      , d = h - c;
                    return -Math.pow(1 / r, t - y) / (d * d) * (u - d) * (u + d)
                }
                ,
                t
            }(t);
            e.BounceEase = n;
            var a = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.easeInCore = function(e) {
                    return e * e * e
                }
                ,
                t
            }(t);
            e.CubicEase = a;
            var s = function(e) {
                function t(t, r) {
                    void 0 === t && (t = 3),
                    void 0 === r && (r = 3);
                    var i = e.call(this) || this;
                    return i.oscillations = t,
                    i.springiness = r,
                    i
                }
                return o(t, e),
                t.prototype.easeInCore = function(e) {
                    var t = Math.max(0, this.oscillations)
                      , r = Math.max(0, this.springiness);
                    return (0 == r ? e : (Math.exp(r * e) - 1) / (Math.exp(r) - 1)) * Math.sin((6.283185307179586 * t + 1.5707963267948966) * e)
                }
                ,
                t
            }(t);
            e.ElasticEase = s;
            var y = function(e) {
                function t(t) {
                    void 0 === t && (t = 2);
                    var r = e.call(this) || this;
                    return r.exponent = t,
                    r
                }
                return o(t, e),
                t.prototype.easeInCore = function(e) {
                    return this.exponent <= 0 ? e : (Math.exp(this.exponent * e) - 1) / (Math.exp(this.exponent) - 1)
                }
                ,
                t
            }(t);
            e.ExponentialEase = y;
            var l = function(e) {
                function t(t) {
                    void 0 === t && (t = 2);
                    var r = e.call(this) || this;
                    return r.power = t,
                    r
                }
                return o(t, e),
                t.prototype.easeInCore = function(e) {
                    var t = Math.max(0, this.power);
                    return Math.pow(e, t)
                }
                ,
                t
            }(t);
            e.PowerEase = l;
            var c = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.easeInCore = function(e) {
                    return e * e
                }
                ,
                t
            }(t);
            e.QuadraticEase = c;
            var h = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.easeInCore = function(e) {
                    return e * e * e * e
                }
                ,
                t
            }(t);
            e.QuarticEase = h;
            var u = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.easeInCore = function(e) {
                    return e * e * e * e * e
                }
                ,
                t
            }(t);
            e.QuinticEase = u;
            var d = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.easeInCore = function(e) {
                    return 1 - Math.sin(1.5707963267948966 * (1 - e))
                }
                ,
                t
            }(t);
            e.SineEase = d;
            var x = function(t) {
                function r(e, r, i, n) {
                    void 0 === e && (e = 0),
                    void 0 === r && (r = 0),
                    void 0 === i && (i = 1),
                    void 0 === n && (n = 1);
                    var o = t.call(this) || this;
                    return o.x1 = e,
                    o.y1 = r,
                    o.x2 = i,
                    o.y2 = n,
                    o
                }
                return o(r, t),
                r.prototype.easeInCore = function(t) {
                    return e.BezierCurve.Interpolate(t, this.x1, this.y1, this.x2, this.y2)
                }
                ,
                r
            }(t);
            e.BezierCurveEase = x
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e(e) {
                    this._actionManager = e
                }
                return e.prototype.isValid = function() {
                    return !0
                }
                ,
                e.prototype._getProperty = function(e) {
                    return this._actionManager._getProperty(e)
                }
                ,
                e.prototype._getEffectiveTarget = function(e, t) {
                    return this._actionManager._getEffectiveTarget(e, t)
                }
                ,
                e.prototype.serialize = function() {}
                ,
                e.prototype._serialize = function(e) {
                    return {
                        type: 2,
                        children: [],
                        name: e.name,
                        properties: e.properties
                    }
                }
                ,
                e
            }();
            e.Condition = t;
            var r = function(t) {
                function r(e, i, n, o, a) {
                    void 0 === a && (a = r.IsEqual);
                    var s = t.call(this, e) || this;
                    return s.propertyPath = n,
                    s.value = o,
                    s.operator = a,
                    s._target = i,
                    s._effectiveTarget = s._getEffectiveTarget(i, s.propertyPath),
                    s._property = s._getProperty(s.propertyPath),
                    s
                }
                return o(r, t),
                Object.defineProperty(r, "IsEqual", {
                    get: function() {
                        return r._IsEqual
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "IsDifferent", {
                    get: function() {
                        return r._IsDifferent
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "IsGreater", {
                    get: function() {
                        return r._IsGreater
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "IsLesser", {
                    get: function() {
                        return r._IsLesser
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.isValid = function() {
                    switch (this.operator) {
                    case r.IsGreater:
                        return this._effectiveTarget[this._property] > this.value;
                    case r.IsLesser:
                        return this._effectiveTarget[this._property] < this.value;
                    case r.IsEqual:
                    case r.IsDifferent:
                        var e;
                        return e = this.value.equals ? this.value.equals(this._effectiveTarget[this._property]) : this.value === this._effectiveTarget[this._property],
                        this.operator === r.IsEqual ? e : !e
                    }
                    return !1
                }
                ,
                r.prototype.serialize = function() {
                    return this._serialize({
                        name: "ValueCondition",
                        properties: [e.Action._GetTargetProperty(this._target), {
                            name: "propertyPath",
                            value: this.propertyPath
                        }, {
                            name: "value",
                            value: e.Action._SerializeValueAsString(this.value)
                        }, {
                            name: "operator",
                            value: r.GetOperatorName(this.operator)
                        }]
                    })
                }
                ,
                r.GetOperatorName = function(e) {
                    switch (e) {
                    case r._IsEqual:
                        return "IsEqual";
                    case r._IsDifferent:
                        return "IsDifferent";
                    case r._IsGreater:
                        return "IsGreater";
                    case r._IsLesser:
                        return "IsLesser";
                    default:
                        return ""
                    }
                }
                ,
                r._IsEqual = 0,
                r._IsDifferent = 1,
                r._IsGreater = 2,
                r._IsLesser = 3,
                r
            }(t);
            e.ValueCondition = r;
            var i = function(e) {
                function t(t, r) {
                    var i = e.call(this, t) || this;
                    return i.predicate = r,
                    i
                }
                return o(t, e),
                t.prototype.isValid = function() {
                    return this.predicate()
                }
                ,
                t
            }(t);
            e.PredicateCondition = i;
            var n = function(t) {
                function r(e, r, i) {
                    var n = t.call(this, e) || this;
                    return n.value = i,
                    n._target = r,
                    n
                }
                return o(r, t),
                r.prototype.isValid = function() {
                    return this._target.state === this.value
                }
                ,
                r.prototype.serialize = function() {
                    return this._serialize({
                        name: "StateCondition",
                        properties: [e.Action._GetTargetProperty(this._target), {
                            name: "value",
                            value: this.value
                        }]
                    })
                }
                ,
                r
            }(t);
            e.StateCondition = n
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r) {
                    this.triggerOptions = t,
                    this.onBeforeExecuteObservable = new e.Observable,
                    t.parameter ? (this.trigger = t.trigger,
                    this._triggerParameter = t.parameter) : t.trigger ? this.trigger = t.trigger : this.trigger = t,
                    this._nextActiveAction = this,
                    this._condition = r
                }
                return t.prototype._prepare = function() {}
                ,
                t.prototype.getTriggerParameter = function() {
                    return this._triggerParameter
                }
                ,
                t.prototype._executeCurrent = function(e) {
                    if (this._nextActiveAction._condition) {
                        var t = this._nextActiveAction._condition
                          , r = this._actionManager.getScene().getRenderId();
                        if (t._evaluationId === r) {
                            if (!t._currentResult)
                                return
                        } else {
                            if (t._evaluationId = r,
                            !t.isValid())
                                return void (t._currentResult = !1);
                            t._currentResult = !0
                        }
                    }
                    this.onBeforeExecuteObservable.notifyObservers(this),
                    this._nextActiveAction.execute(e),
                    this.skipToNextActiveAction()
                }
                ,
                t.prototype.execute = function(e) {}
                ,
                t.prototype.skipToNextActiveAction = function() {
                    this._nextActiveAction._child ? (this._nextActiveAction._child._actionManager || (this._nextActiveAction._child._actionManager = this._actionManager),
                    this._nextActiveAction = this._nextActiveAction._child) : this._nextActiveAction = this
                }
                ,
                t.prototype.then = function(e) {
                    return this._child = e,
                    e._actionManager = this._actionManager,
                    e._prepare(),
                    e
                }
                ,
                t.prototype._getProperty = function(e) {
                    return this._actionManager._getProperty(e)
                }
                ,
                t.prototype._getEffectiveTarget = function(e, t) {
                    return this._actionManager._getEffectiveTarget(e, t)
                }
                ,
                t.prototype.serialize = function(e) {}
                ,
                t.prototype._serialize = function(e, t) {
                    var r = {
                        type: 1,
                        children: [],
                        name: e.name,
                        properties: e.properties || []
                    };
                    if (this._child && this._child.serialize(r),
                    this._condition) {
                        var i = this._condition.serialize();
                        return i.children.push(r),
                        t && t.children.push(i),
                        i
                    }
                    return t && t.children.push(r),
                    r
                }
                ,
                t._SerializeValueAsString = function(t) {
                    return "number" == typeof t ? t.toString() : "boolean" == typeof t ? t ? "true" : "false" : t instanceof e.Vector2 ? t.x + ", " + t.y : t instanceof e.Vector3 ? t.x + ", " + t.y + ", " + t.z : t instanceof e.Color3 ? t.r + ", " + t.g + ", " + t.b : t instanceof e.Color4 ? t.r + ", " + t.g + ", " + t.b + ", " + t.a : t
                }
                ,
                t._GetTargetProperty = function(t) {
                    return {
                        name: "target",
                        targetType: t instanceof e.Mesh ? "MeshProperties" : t instanceof e.Light ? "LightProperties" : t instanceof e.Camera ? "CameraProperties" : "SceneProperties",
                        value: t instanceof e.Scene ? "Scene" : t.name
                    }
                }
                ,
                t
            }();
            e.Action = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e(e, t, r, i, n, o) {
                    this.source = e,
                    this.pointerX = t,
                    this.pointerY = r,
                    this.meshUnderPointer = i,
                    this.sourceEvent = n,
                    this.additionalData = o
                }
                return e.CreateNew = function(t, r, i) {
                    var n = t.getScene();
                    return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer,r,i)
                }
                ,
                e.CreateNewFromSprite = function(t, r, i, n) {
                    return new e(t,r.pointerX,r.pointerY,r.meshUnderPointer,i,n)
                }
                ,
                e.CreateNewFromScene = function(t, r) {
                    return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,r)
                }
                ,
                e.CreateNewFromPrimitive = function(t, r, i, n) {
                    return new e(t,r.x,r.y,null,i,n)
                }
                ,
                e
            }();
            e.ActionEvent = t;
            var r = function() {
                function t(t) {
                    this.actions = new Array,
                    this.hoverCursor = "",
                    this._scene = t || e.Engine.LastCreatedScene,
                    t.actionManagers.push(this)
                }
                return t.prototype.dispose = function() {
                    for (var e = this._scene.actionManagers.indexOf(this), r = 0; r < this.actions.length; r++) {
                        var i = this.actions[r];
                        t.Triggers[i.trigger]--,
                        0 === t.Triggers[i.trigger] && delete t.Triggers[i.trigger]
                    }
                    e > -1 && this._scene.actionManagers.splice(e, 1)
                }
                ,
                t.prototype.getScene = function() {
                    return this._scene
                }
                ,
                t.prototype.hasSpecificTriggers = function(e) {
                    for (var t = 0; t < this.actions.length; t++) {
                        var r = this.actions[t];
                        if (e.indexOf(r.trigger) > -1)
                            return !0
                    }
                    return !1
                }
                ,
                t.prototype.hasSpecificTriggers2 = function(e, t) {
                    for (var r = 0; r < this.actions.length; r++) {
                        var i = this.actions[r];
                        if (e == i.trigger || t == i.trigger)
                            return !0
                    }
                    return !1
                }
                ,
                t.prototype.hasSpecificTrigger = function(e, t) {
                    for (var r = 0; r < this.actions.length; r++) {
                        var i = this.actions[r];
                        if (i.trigger === e) {
                            if (!t)
                                return !0;
                            if (t(i.getTriggerParameter()))
                                return !0
                        }
                    }
                    return !1
                }
                ,
                Object.defineProperty(t.prototype, "hasPointerTriggers", {
                    get: function() {
                        for (var e = 0; e < this.actions.length; e++) {
                            var r = this.actions[e];
                            if (r.trigger >= t.OnPickTrigger && r.trigger <= t.OnPointerOutTrigger)
                                return !0
                        }
                        return !1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "hasPickTriggers", {
                    get: function() {
                        for (var e = 0; e < this.actions.length; e++) {
                            var r = this.actions[e];
                            if (r.trigger >= t.OnPickTrigger && r.trigger <= t.OnPickUpTrigger)
                                return !0
                        }
                        return !1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "HasTriggers", {
                    get: function() {
                        for (var e in t.Triggers)
                            if (t.Triggers.hasOwnProperty(e))
                                return !0;
                        return !1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "HasPickTriggers", {
                    get: function() {
                        for (var e in t.Triggers)
                            if (t.Triggers.hasOwnProperty(e)) {
                                var r = parseInt(e);
                                if (r >= t.OnPickTrigger && r <= t.OnPickUpTrigger)
                                    return !0
                            }
                        return !1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.HasSpecificTrigger = function(e) {
                    for (var r in t.Triggers) {
                        if (t.Triggers.hasOwnProperty(r))
                            if (parseInt(r) === e)
                                return !0
                    }
                    return !1
                }
                ,
                t.prototype.registerAction = function(r) {
                    return r.trigger === t.OnEveryFrameTrigger && this.getScene().actionManager !== this ? (e.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),
                    null) : (this.actions.push(r),
                    t.Triggers[r.trigger] ? t.Triggers[r.trigger]++ : t.Triggers[r.trigger] = 1,
                    r._actionManager = this,
                    r._prepare(),
                    r)
                }
                ,
                t.prototype.unregisterAction = function(e) {
                    var r = this.actions.indexOf(e);
                    return -1 !== r && (this.actions.splice(r, 1),
                    t.Triggers[e.trigger] -= 1,
                    0 === t.Triggers[e.trigger] && delete t.Triggers[e.trigger],
                    delete e._actionManager,
                    !0)
                }
                ,
                t.prototype.processTrigger = function(e, r) {
                    for (var i = 0; i < this.actions.length; i++) {
                        var n = this.actions[i];
                        if (n.trigger === e) {
                            if (r && (e === t.OnKeyUpTrigger || e === t.OnKeyDownTrigger)) {
                                var o = n.getTriggerParameter();
                                if (o && o !== r.sourceEvent.keyCode) {
                                    if (!o.toLowerCase)
                                        continue;
                                    var a = o.toLowerCase();
                                    if (a !== r.sourceEvent.key) {
                                        var s = r.sourceEvent.charCode ? r.sourceEvent.charCode : r.sourceEvent.keyCode;
                                        if (String.fromCharCode(s).toLowerCase() !== a)
                                            continue
                                    }
                                }
                            }
                            n._executeCurrent(r)
                        }
                    }
                }
                ,
                t.prototype._getEffectiveTarget = function(e, t) {
                    for (var r = t.split("."), i = 0; i < r.length - 1; i++)
                        e = e[r[i]];
                    return e
                }
                ,
                t.prototype._getProperty = function(e) {
                    var t = e.split(".");
                    return t[t.length - 1]
                }
                ,
                t.prototype.serialize = function(r) {
                    for (var i = {
                        children: new Array,
                        name: r,
                        type: 3,
                        properties: new Array
                    }, n = 0; n < this.actions.length; n++) {
                        var o = {
                            type: 0,
                            children: new Array,
                            name: t.GetTriggerName(this.actions[n].trigger),
                            properties: new Array
                        }
                          , a = this.actions[n].triggerOptions;
                        if (a && "number" != typeof a)
                            if (a.parameter instanceof e.Node)
                                o.properties.push(e.Action._GetTargetProperty(a.parameter));
                            else {
                                var s = {};
                                e.Tools.DeepCopy(a.parameter, s, ["mesh"]),
                                a.parameter && a.parameter.mesh && (s._meshId = a.parameter.mesh.id),
                                o.properties.push({
                                    name: "parameter",
                                    targetType: null,
                                    value: s
                                })
                            }
                        this.actions[n].serialize(o),
                        i.children.push(o)
                    }
                    return i
                }
                ,
                t.Parse = function(r, i, n) {
                    var o = new t(n);
                    null === i ? n.actionManager = o : i.actionManager = o;
                    for (var a = function(t, r, i, n) {
                        if (null === n) {
                            var o = parseFloat(r);
                            return "true" === r || "false" === r ? "true" === r : isNaN(o) ? r : o
                        }
                        for (var a = n.split("."), s = r.split(","), y = 0; y < a.length; y++)
                            i = i[a[y]];
                        if ("boolean" == typeof i)
                            return "true" === s[0];
                        if ("string" == typeof i)
                            return s[0];
                        var l = new Array;
                        for (y = 0; y < s.length; y++)
                            l.push(parseFloat(s[y]));
                        return i instanceof e.Vector3 ? e.Vector3.FromArray(l) : i instanceof e.Vector4 ? e.Vector4.FromArray(l) : i instanceof e.Color3 ? e.Color3.FromArray(l) : i instanceof e.Color4 ? e.Color4.FromArray(l) : parseFloat(s[0])
                    }, s = function(r, i, y, l, c) {
                        if (void 0 === c && (c = null),
                        !r.detached) {
                            var h = new Array
                              , u = null
                              , d = null
                              , x = r.combine && r.combine.length > 0;
                            if (2 === r.type ? h.push(o) : h.push(i),
                            x) {
                                for (var p = new Array, f = 0; f < r.combine.length; f++)
                                    s(r.combine[f], t.NothingTrigger, y, l, p);
                                h.push(p)
                            } else
                                for (var m = 0; m < r.properties.length; m++) {
                                    var z = r.properties[m].value
                                      , _ = r.properties[m].name
                                      , g = r.properties[m].targetType;
                                    "target" === _ ? z = u = null !== g && "SceneProperties" === g ? n : n.getNodeByName(z) : "parent" === _ ? z = n.getNodeByName(z) : "sound" === _ ? n.getSoundByName && (z = n.getSoundByName(z)) : "propertyPath" !== _ ? z = 2 === r.type && "operator" === _ ? e.ValueCondition[z] : a(0, z, u, "value" === _ ? d : null) : d = z,
                                    h.push(z)
                                }
                            if (null === c ? h.push(y) : h.push(null),
                            "InterpolateValueAction" === r.name) {
                                var v = h[h.length - 2];
                                h[h.length - 1] = v,
                                h[h.length - 2] = y
                            }
                            var b = function(t, r) {
                                var i = Object.create(e.Tools.Instantiate("BABYLON." + t).prototype);
                                return i.constructor.apply(i, r),
                                i
                            }(r.name, h);
                            if (b instanceof e.Condition && null !== y) {
                                var T = new e.DoNothingAction(i,y);
                                l ? l.then(T) : o.registerAction(T),
                                l = T
                            }
                            null === c ? b instanceof e.Condition ? (y = b,
                            b = l) : (y = null,
                            l ? l.then(b) : o.registerAction(b)) : c.push(b);
                            for (m = 0; m < r.children.length; m++)
                                s(r.children[m], i, y, b, null)
                        }
                    }, y = 0; y < r.children.length; y++) {
                        var l, c = r.children[y];
                        if (c.properties.length > 0) {
                            var h = c.properties[0].value
                              , u = null === c.properties[0].targetType ? h : n.getMeshByName(h);
                            u._meshId && (u.mesh = n.getMeshByID(u._meshId)),
                            l = {
                                trigger: t[c.name],
                                parameter: u
                            }
                        } else
                            l = t[c.name];
                        for (var d = 0; d < c.children.length; d++)
                            c.detached || s(c.children[d], l, null, null)
                    }
                }
                ,
                t.GetTriggerName = function(e) {
                    switch (e) {
                    case 0:
                        return "NothingTrigger";
                    case 1:
                        return "OnPickTrigger";
                    case 2:
                        return "OnLeftPickTrigger";
                    case 3:
                        return "OnRightPickTrigger";
                    case 4:
                        return "OnCenterPickTrigger";
                    case 5:
                        return "OnPickDownTrigger";
                    case 6:
                        return "OnPickUpTrigger";
                    case 7:
                        return "OnLongPressTrigger";
                    case 8:
                        return "OnPointerOverTrigger";
                    case 9:
                        return "OnPointerOutTrigger";
                    case 10:
                        return "OnEveryFrameTrigger";
                    case 11:
                        return "OnIntersectionEnterTrigger";
                    case 12:
                        return "OnIntersectionExitTrigger";
                    case 13:
                        return "OnKeyDownTrigger";
                    case 14:
                        return "OnKeyUpTrigger";
                    case 15:
                        return "OnPickOutTrigger";
                    default:
                        return ""
                    }
                }
                ,
                t.NothingTrigger = 0,
                t.OnPickTrigger = 1,
                t.OnLeftPickTrigger = 2,
                t.OnRightPickTrigger = 3,
                t.OnCenterPickTrigger = 4,
                t.OnPickDownTrigger = 5,
                t.OnDoublePickTrigger = 6,
                t.OnPickUpTrigger = 7,
                t.OnPickOutTrigger = 16,
                t.OnLongPressTrigger = 8,
                t.OnPointerOverTrigger = 9,
                t.OnPointerOutTrigger = 10,
                t.OnEveryFrameTrigger = 11,
                t.OnIntersectionEnterTrigger = 12,
                t.OnIntersectionExitTrigger = 13,
                t.OnKeyDownTrigger = 14,
                t.OnKeyUpTrigger = 15,
                t.Triggers = {},
                t
            }();
            e.ActionManager = r
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l) {
                    void 0 === a && (a = 1e3);
                    var c = t.call(this, r, s) || this;
                    return c.duration = 1e3,
                    c.onInterpolationDoneObservable = new e.Observable,
                    c.propertyPath = n,
                    c.value = o,
                    c.duration = a,
                    c.stopOtherAnimations = y,
                    c.onInterpolationDone = l,
                    c._target = c._effectiveTarget = i,
                    c
                }
                return o(r, t),
                r.prototype._prepare = function() {
                    this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath),
                    this._property = this._getProperty(this.propertyPath)
                }
                ,
                r.prototype.execute = function() {
                    var t, r = this, i = this._actionManager.getScene(), n = [{
                        frame: 0,
                        value: this._effectiveTarget[this._property]
                    }, {
                        frame: 100,
                        value: this.value
                    }];
                    if ("number" == typeof this.value)
                        t = e.Animation.ANIMATIONTYPE_FLOAT;
                    else if (this.value instanceof e.Color3)
                        t = e.Animation.ANIMATIONTYPE_COLOR3;
                    else if (this.value instanceof e.Vector3)
                        t = e.Animation.ANIMATIONTYPE_VECTOR3;
                    else if (this.value instanceof e.Matrix)
                        t = e.Animation.ANIMATIONTYPE_MATRIX;
                    else {
                        if (!(this.value instanceof e.Quaternion))
                            return void e.Tools.Warn("InterpolateValueAction: Unsupported type (" + typeof this.value + ")");
                        t = e.Animation.ANIMATIONTYPE_QUATERNION
                    }
                    var o = new e.Animation("InterpolateValueAction",this._property,1e3 / this.duration * 100,t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);
                    o.setKeys(n),
                    this.stopOtherAnimations && i.stopAnimation(this._effectiveTarget);
                    i.beginDirectAnimation(this._effectiveTarget, [o], 0, 100, !1, 1, (function() {
                        r.onInterpolationDoneObservable.notifyObservers(r),
                        r.onInterpolationDone && r.onInterpolationDone()
                    }
                    ))
                }
                ,
                r.prototype.serialize = function(r) {
                    return t.prototype._serialize.call(this, {
                        name: "InterpolateValueAction",
                        properties: [e.Action._GetTargetProperty(this._target), {
                            name: "propertyPath",
                            value: this.propertyPath
                        }, {
                            name: "value",
                            value: e.Action._SerializeValueAsString(this.value)
                        }, {
                            name: "duration",
                            value: e.Action._SerializeValueAsString(this.duration)
                        }, {
                            name: "stopOtherAnimations",
                            value: e.Action._SerializeValueAsString(this.stopOtherAnimations) || !1
                        }]
                    }, r)
                }
                ,
                r
            }(e.Action);
            e.InterpolateValueAction = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(e, r, i, n) {
                    var o = t.call(this, e, n) || this;
                    return o.propertyPath = i,
                    o._target = o._effectiveTarget = r,
                    o
                }
                return o(r, t),
                r.prototype._prepare = function() {
                    this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath),
                    this._property = this._getProperty(this.propertyPath)
                }
                ,
                r.prototype.execute = function() {
                    this._effectiveTarget[this._property] = !this._effectiveTarget[this._property]
                }
                ,
                r.prototype.serialize = function(r) {
                    return t.prototype._serialize.call(this, {
                        name: "SwitchBooleanAction",
                        properties: [e.Action._GetTargetProperty(this._target), {
                            name: "propertyPath",
                            value: this.propertyPath
                        }]
                    }, r)
                }
                ,
                r
            }(e.Action);
            e.SwitchBooleanAction = t;
            var r = function(t) {
                function r(e, r, i, n) {
                    var o = t.call(this, e, n) || this;
                    return o.value = i,
                    o._target = r,
                    o
                }
                return o(r, t),
                r.prototype.execute = function() {
                    this._target.state = this.value
                }
                ,
                r.prototype.serialize = function(r) {
                    return t.prototype._serialize.call(this, {
                        name: "SetStateAction",
                        properties: [e.Action._GetTargetProperty(this._target), {
                            name: "value",
                            value: this.value
                        }]
                    }, r)
                }
                ,
                r
            }(e.Action);
            e.SetStateAction = r;
            var i = function(t) {
                function r(e, r, i, n, o) {
                    var a = t.call(this, e, o) || this;
                    return a.propertyPath = i,
                    a.value = n,
                    a._target = a._effectiveTarget = r,
                    a
                }
                return o(r, t),
                r.prototype._prepare = function() {
                    this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath),
                    this._property = this._getProperty(this.propertyPath)
                }
                ,
                r.prototype.execute = function() {
                    this._effectiveTarget[this._property] = this.value,
                    this._target.markAsDirty && this._target.markAsDirty(this._property)
                }
                ,
                r.prototype.serialize = function(r) {
                    return t.prototype._serialize.call(this, {
                        name: "SetValueAction",
                        properties: [e.Action._GetTargetProperty(this._target), {
                            name: "propertyPath",
                            value: this.propertyPath
                        }, {
                            name: "value",
                            value: e.Action._SerializeValueAsString(this.value)
                        }]
                    }, r)
                }
                ,
                r
            }(e.Action);
            e.SetValueAction = i;
            var n = function(t) {
                function r(e, r, i, n, o) {
                    var a = t.call(this, e, o) || this;
                    return a.propertyPath = i,
                    a.value = n,
                    a._target = a._effectiveTarget = r,
                    a
                }
                return o(r, t),
                r.prototype._prepare = function() {
                    this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath),
                    this._property = this._getProperty(this.propertyPath),
                    "number" != typeof this._effectiveTarget[this._property] && e.Tools.Warn("Warning: IncrementValueAction can only be used with number values")
                }
                ,
                r.prototype.execute = function() {
                    this._effectiveTarget[this._property] += this.value,
                    this._target.markAsDirty && this._target.markAsDirty(this._property)
                }
                ,
                r.prototype.serialize = function(r) {
                    return t.prototype._serialize.call(this, {
                        name: "IncrementValueAction",
                        properties: [e.Action._GetTargetProperty(this._target), {
                            name: "propertyPath",
                            value: this.propertyPath
                        }, {
                            name: "value",
                            value: e.Action._SerializeValueAsString(this.value)
                        }]
                    }, r)
                }
                ,
                r
            }(e.Action);
            e.IncrementValueAction = n;
            var a = function(t) {
                function r(e, r, i, n, o, a) {
                    var s = t.call(this, e, a) || this;
                    return s.from = i,
                    s.to = n,
                    s.loop = o,
                    s._target = r,
                    s
                }
                return o(r, t),
                r.prototype._prepare = function() {}
                ,
                r.prototype.execute = function() {
                    this._actionManager.getScene().beginAnimation(this._target, this.from, this.to, this.loop)
                }
                ,
                r.prototype.serialize = function(r) {
                    return t.prototype._serialize.call(this, {
                        name: "PlayAnimationAction",
                        properties: [e.Action._GetTargetProperty(this._target), {
                            name: "from",
                            value: String(this.from)
                        }, {
                            name: "to",
                            value: String(this.to)
                        }, {
                            name: "loop",
                            value: e.Action._SerializeValueAsString(this.loop) || !1
                        }]
                    }, r)
                }
                ,
                r
            }(e.Action);
            e.PlayAnimationAction = a;
            var s = function(t) {
                function r(e, r, i) {
                    var n = t.call(this, e, i) || this;
                    return n._target = r,
                    n
                }
                return o(r, t),
                r.prototype._prepare = function() {}
                ,
                r.prototype.execute = function() {
                    this._actionManager.getScene().stopAnimation(this._target)
                }
                ,
                r.prototype.serialize = function(r) {
                    return t.prototype._serialize.call(this, {
                        name: "StopAnimationAction",
                        properties: [e.Action._GetTargetProperty(this._target)]
                    }, r)
                }
                ,
                r
            }(e.Action);
            e.StopAnimationAction = s;
            var y = function(t) {
                function r(r, i) {
                    return void 0 === r && (r = e.ActionManager.NothingTrigger),
                    t.call(this, r, i) || this
                }
                return o(r, t),
                r.prototype.execute = function() {}
                ,
                r.prototype.serialize = function(e) {
                    return t.prototype._serialize.call(this, {
                        name: "DoNothingAction",
                        properties: []
                    }, e)
                }
                ,
                r
            }(e.Action);
            e.DoNothingAction = y;
            var l = function(e) {
                function t(t, r, i) {
                    var n = e.call(this, t, i) || this;
                    return n.children = r,
                    n
                }
                return o(t, e),
                t.prototype._prepare = function() {
                    for (var e = 0; e < this.children.length; e++)
                        this.children[e]._actionManager = this._actionManager,
                        this.children[e]._prepare()
                }
                ,
                t.prototype.execute = function(e) {
                    for (var t = 0; t < this.children.length; t++)
                        this.children[t].execute(e)
                }
                ,
                t.prototype.serialize = function(t) {
                    for (var r = e.prototype._serialize.call(this, {
                        name: "CombineAction",
                        properties: [],
                        combine: []
                    }, t), i = 0; i < this.children.length; i++)
                        r.combine.push(this.children[i].serialize(null));
                    return r
                }
                ,
                t
            }(e.Action);
            e.CombineAction = l;
            var c = function(e) {
                function t(t, r, i) {
                    var n = e.call(this, t, i) || this;
                    return n.func = r,
                    n
                }
                return o(t, e),
                t.prototype.execute = function(e) {
                    this.func(e)
                }
                ,
                t
            }(e.Action);
            e.ExecuteCodeAction = c;
            var h = function(t) {
                function r(e, r, i, n) {
                    var o = t.call(this, e, n) || this;
                    return o._target = r,
                    o._parent = i,
                    o
                }
                return o(r, t),
                r.prototype._prepare = function() {}
                ,
                r.prototype.execute = function() {
                    if (this._target.parent !== this._parent) {
                        var t = this._parent.getWorldMatrix().clone();
                        t.invert(),
                        this._target.position = e.Vector3.TransformCoordinates(this._target.position, t),
                        this._target.parent = this._parent
                    }
                }
                ,
                r.prototype.serialize = function(r) {
                    return t.prototype._serialize.call(this, {
                        name: "SetParentAction",
                        properties: [e.Action._GetTargetProperty(this._target), e.Action._GetTargetProperty(this._parent)]
                    }, r)
                }
                ,
                r
            }(e.Action);
            e.SetParentAction = h
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n, o, a, s) {
                    if (void 0 === a && (a = .01),
                    void 0 === s && (s = e.Texture.TRILINEAR_SAMPLINGMODE),
                    this.name = t,
                    this.sprites = new Array,
                    this.renderingGroupId = 0,
                    this.layerMask = 268435455,
                    this.fogEnabled = !0,
                    this.isPickable = !1,
                    this.onDisposeObservable = new e.Observable,
                    this._vertexBuffers = {},
                    o._getComponent(e.SceneComponentConstants.NAME_SPRITE) || o._addComponent(new e.SpriteSceneComponent(o)),
                    this._capacity = i,
                    this._spriteTexture = new e.Texture(r,o,!0,!1,s),
                    this._spriteTexture.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    this._spriteTexture.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    n.width && n.height)
                        this.cellWidth = n.width,
                        this.cellHeight = n.height;
                    else {
                        if (void 0 === n)
                            return;
                        this.cellWidth = n,
                        this.cellHeight = n
                    }
                    this._epsilon = a,
                    this._scene = o,
                    this._scene.spriteManagers.push(this);
                    for (var y = [], l = 0, c = 0; c < i; c++)
                        y.push(l),
                        y.push(l + 1),
                        y.push(l + 2),
                        y.push(l),
                        y.push(l + 2),
                        y.push(l + 3),
                        l += 4;
                    this._indexBuffer = o.getEngine().createIndexBuffer(y),
                    this._vertexData = new Float32Array(16 * i * 4),
                    this._buffer = new e.Buffer(o.getEngine(),this._vertexData,!0,16);
                    var h = this._buffer.createVertexBuffer(e.VertexBuffer.PositionKind, 0, 4)
                      , u = this._buffer.createVertexBuffer("options", 4, 4)
                      , d = this._buffer.createVertexBuffer("cellInfo", 8, 4)
                      , x = this._buffer.createVertexBuffer(e.VertexBuffer.ColorKind, 12, 4);
                    this._vertexBuffers[e.VertexBuffer.PositionKind] = h,
                    this._vertexBuffers.options = u,
                    this._vertexBuffers.cellInfo = d,
                    this._vertexBuffers[e.VertexBuffer.ColorKind] = x,
                    this._effectBase = this._scene.getEngine().createEffect("sprites", [e.VertexBuffer.PositionKind, "options", "cellInfo", e.VertexBuffer.ColorKind], ["view", "projection", "textureInfos", "alphaTest"], ["diffuseSampler"], ""),
                    this._effectFog = this._scene.getEngine().createEffect("sprites", [e.VertexBuffer.PositionKind, "options", "cellInfo", e.VertexBuffer.ColorKind], ["view", "projection", "textureInfos", "alphaTest", "vFogInfos", "vFogColor"], ["diffuseSampler"], "#define FOG")
                }
                return Object.defineProperty(t.prototype, "onDispose", {
                    set: function(e) {
                        this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver),
                        this._onDisposeObserver = this.onDisposeObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "texture", {
                    get: function() {
                        return this._spriteTexture
                    },
                    set: function(e) {
                        this._spriteTexture = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._appendSpriteVertex = function(e, t, r, i, n) {
                    var o = 16 * e;
                    0 === r ? r = this._epsilon : 1 === r && (r = 1 - this._epsilon),
                    0 === i ? i = this._epsilon : 1 === i && (i = 1 - this._epsilon),
                    this._vertexData[o] = t.position.x,
                    this._vertexData[o + 1] = t.position.y,
                    this._vertexData[o + 2] = t.position.z,
                    this._vertexData[o + 3] = t.angle,
                    this._vertexData[o + 4] = t.width,
                    this._vertexData[o + 5] = t.height,
                    this._vertexData[o + 6] = r,
                    this._vertexData[o + 7] = i,
                    this._vertexData[o + 8] = t.invertU ? 1 : 0,
                    this._vertexData[o + 9] = t.invertV ? 1 : 0;
                    var a = t.cellIndex / n >> 0;
                    this._vertexData[o + 10] = t.cellIndex - a * n,
                    this._vertexData[o + 11] = a,
                    this._vertexData[o + 12] = t.color.r,
                    this._vertexData[o + 13] = t.color.g,
                    this._vertexData[o + 14] = t.color.b,
                    this._vertexData[o + 15] = t.color.a
                }
                ,
                t.prototype.intersects = function(t, r, i, n) {
                    for (var o = Math.min(this._capacity, this.sprites.length), a = e.Vector3.Zero(), s = e.Vector3.Zero(), y = Number.MAX_VALUE, l = null, c = e.Vector3.Zero(), h = r.getViewMatrix(), u = 0; u < o; u++) {
                        var d = this.sprites[u];
                        if (d) {
                            if (i) {
                                if (!i(d))
                                    continue
                            } else if (!d.isPickable)
                                continue;
                            if (e.Vector3.TransformCoordinatesToRef(d.position, h, c),
                            a.copyFromFloats(c.x - d.width / 2, c.y - d.height / 2, c.z),
                            s.copyFromFloats(c.x + d.width / 2, c.y + d.height / 2, c.z),
                            t.intersectsBoxMinMax(a, s)) {
                                var x = e.Vector3.Distance(c, t.origin);
                                if (y > x && (y = x,
                                l = d,
                                n))
                                    break
                            }
                        }
                    }
                    if (l) {
                        var p = new e.PickingInfo;
                        return p.hit = !0,
                        p.pickedSprite = l,
                        p.distance = y,
                        p
                    }
                    return null
                }
                ,
                t.prototype.render = function() {
                    if (this._effectBase.isReady() && this._effectFog.isReady() && this._spriteTexture && this._spriteTexture.isReady()) {
                        for (var t = this._scene.getEngine(), r = this._spriteTexture.getBaseSize(), i = t.getDeltaTime(), n = Math.min(this._capacity, this.sprites.length), o = r.width / this.cellWidth, a = 0, s = 0; s < n; s++) {
                            var y = this.sprites[s];
                            y && y.isVisible && (y._animate(i),
                            this._appendSpriteVertex(a++, y, 0, 0, o),
                            this._appendSpriteVertex(a++, y, 1, 0, o),
                            this._appendSpriteVertex(a++, y, 1, 1, o),
                            this._appendSpriteVertex(a++, y, 0, 1, o))
                        }
                        this._buffer.update(this._vertexData);
                        var l = this._effectBase;
                        this._scene.fogEnabled && this._scene.fogMode !== e.Scene.FOGMODE_NONE && this.fogEnabled && (l = this._effectFog),
                        t.enableEffect(l);
                        var c = this._scene.getViewMatrix();
                        l.setTexture("diffuseSampler", this._spriteTexture),
                        l.setMatrix("view", c),
                        l.setMatrix("projection", this._scene.getProjectionMatrix()),
                        l.setFloat2("textureInfos", this.cellWidth / r.width, this.cellHeight / r.height),
                        this._scene.fogEnabled && this._scene.fogMode !== e.Scene.FOGMODE_NONE && this.fogEnabled && (l.setFloat4("vFogInfos", this._scene.fogMode, this._scene.fogStart, this._scene.fogEnd, this._scene.fogDensity),
                        l.setColor3("vFogColor", this._scene.fogColor)),
                        t.bindBuffers(this._vertexBuffers, this._indexBuffer, l),
                        this.blendMode == e.Engine.ALPHA_ADD ? (t.setAlphaMode(e.Engine.ALPHA_ADD),
                        t.drawElementsType(e.Material.TriangleFillMode, 0, a / 4 * 6),
                        t.setAlphaMode(e.Engine.ALPHA_DISABLE)) : (this.noAlphaTest || (t.setDepthFunctionToLessOrEqual(),
                        l.setBool("alphaTest", !0),
                        t.setColorWrite(!1),
                        t.drawElementsType(e.Material.TriangleFillMode, 0, a / 4 * 6),
                        t.setColorWrite(!0),
                        l.setBool("alphaTest", !1)),
                        t.setAlphaMode(e.Engine.ALPHA_COMBINE),
                        t.drawElementsType(e.Material.TriangleFillMode, 0, a / 4 * 6),
                        t.setAlphaMode(e.Engine.ALPHA_DISABLE))
                    }
                }
                ,
                t.prototype.dispose = function() {
                    this._buffer && (this._buffer.dispose(),
                    this._buffer = null),
                    this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer),
                    this._indexBuffer = null),
                    this._spriteTexture && (this._spriteTexture.dispose(),
                    this._spriteTexture = null);
                    var e = this._scene.spriteManagers.indexOf(this);
                    this._scene.spriteManagers.splice(e, 1),
                    this.onDisposeObservable.notifyObservers(this),
                    this.onDisposeObservable.clear()
                }
                ,
                t
            }();
            e.SpriteManager = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r) {
                    this.name = t,
                    this.color = new e.Color4(1,1,1,1),
                    this.width = 1,
                    this.height = 1,
                    this.angle = 0,
                    this.cellIndex = 0,
                    this.invertU = 0,
                    this.invertV = 0,
                    this.animations = new Array,
                    this.isPickable = !1,
                    this._animationStarted = !1,
                    this._loopAnimation = !1,
                    this._fromIndex = 0,
                    this._toIndex = 0,
                    this._delay = 0,
                    this._direction = 1,
                    this._time = 0,
                    this.isVisible = !0,
                    this._manager = r,
                    this._manager.sprites.push(this),
                    this.position = e.Vector3.Zero()
                }
                return Object.defineProperty(t.prototype, "size", {
                    get: function() {
                        return this.width
                    },
                    set: function(e) {
                        this.width = e,
                        this.height = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.playAnimation = function(e, t, r, i, n) {
                    this._fromIndex = e,
                    this._toIndex = t,
                    this._loopAnimation = r,
                    this._delay = i,
                    this._animationStarted = !0,
                    this._direction = e < t ? 1 : -1,
                    this.cellIndex = e,
                    this._time = 0,
                    this._onAnimationEnd = n
                }
                ,
                t.prototype.stopAnimation = function() {
                    this._animationStarted = !1
                }
                ,
                t.prototype._animate = function(e) {
                    this._animationStarted && (this._time += e,
                    this._time > this._delay && (this._time = this._time % this._delay,
                    this.cellIndex += this._direction,
                    this.cellIndex > this._toIndex && (this._loopAnimation ? this.cellIndex = this._fromIndex : (this.cellIndex = this._toIndex,
                    this._animationStarted = !1,
                    this._onAnimationEnd && this._onAnimationEnd(),
                    this.disposeWhenFinishedAnimating && this.dispose()))))
                }
                ,
                t.prototype.dispose = function() {
                    for (var e = 0; e < this._manager.sprites.length; e++)
                        this._manager.sprites[e] == this && this._manager.sprites.splice(e, 1)
                }
                ,
                t
            }();
            e.Sprite = t
        }(s || (s = {})),
        function(e) {
            e.Scene.prototype._internalPickSprites = function(t, r, i, n) {
                if (!e.PickingInfo)
                    return null;
                var o = null;
                if (!n) {
                    if (!this.activeCamera)
                        return null;
                    n = this.activeCamera
                }
                if (this.spriteManagers.length > 0)
                    for (var a = 0; a < this.spriteManagers.length; a++) {
                        var s = this.spriteManagers[a];
                        if (s.isPickable) {
                            var y = s.intersects(t, n, r, i);
                            if (y && y.hit && (i || null == o || !(y.distance >= o.distance)) && (o = y,
                            i))
                                break
                        }
                    }
                return o || new e.PickingInfo
            }
            ,
            e.Scene.prototype.pickSprite = function(e, t, r, i, n) {
                return this.createPickingRayInCameraSpaceToRef(e, t, this._tempSpritePickingRay, n),
                this._internalPickSprites(this._tempSpritePickingRay, r, i, n)
            }
            ,
            e.Scene.prototype.pickSpriteWithRay = function(t, r, i, n) {
                if (!this._tempSpritePickingRay)
                    return null;
                if (!n) {
                    if (!this.activeCamera)
                        return null;
                    n = this.activeCamera
                }
                return e.Ray.TransformToRef(t, n.getViewMatrix(), this._tempSpritePickingRay),
                this._internalPickSprites(this._tempSpritePickingRay, r, i, n)
            }
            ,
            e.Scene.prototype.setPointerOverSprite = function(t) {
                this._pointerOverSprite !== t && (this._pointerOverSprite && this._pointerOverSprite.actionManager && this._pointerOverSprite.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger, e.ActionEvent.CreateNewFromSprite(this._pointerOverSprite, this)),
                this._pointerOverSprite = t,
                this._pointerOverSprite && this._pointerOverSprite.actionManager && this._pointerOverSprite.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger, e.ActionEvent.CreateNewFromSprite(this._pointerOverSprite, this)))
            }
            ,
            e.Scene.prototype.getPointerOverSprite = function() {
                return this._pointerOverSprite
            }
            ;
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_SPRITE,
                    this.scene = t,
                    this.scene.spriteManagers = new Array,
                    this.scene._tempSpritePickingRay = e.Ray ? e.Ray.Zero() : null,
                    this.scene.onBeforeSpritesRenderingObservable = new e.Observable,
                    this.scene.onAfterSpritesRenderingObservable = new e.Observable,
                    this._spritePredicate = function(e) {
                        return !!e.actionManager && (e.isPickable && e.actionManager.hasPointerTriggers)
                    }
                }
                return t.prototype.register = function() {
                    this.scene._pointerMoveStage.registerStep(e.SceneComponentConstants.STEP_POINTERMOVE_SPRITE, this, this._pointerMove),
                    this.scene._pointerDownStage.registerStep(e.SceneComponentConstants.STEP_POINTERDOWN_SPRITE, this, this._pointerDown),
                    this.scene._pointerUpStage.registerStep(e.SceneComponentConstants.STEP_POINTERUP_SPRITE, this, this._pointerUp)
                }
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.dispose = function() {
                    this.scene.onBeforeSpritesRenderingObservable.clear(),
                    this.scene.onAfterSpritesRenderingObservable.clear();
                    for (var e = this.scene.spriteManagers; e.length; )
                        e[0].dispose()
                }
                ,
                t.prototype._pickSpriteButKeepRay = function(e, t, r, i, n) {
                    var o = this.scene.pickSprite(t, r, this._spritePredicate, i, n);
                    return o && (o.ray = e ? e.ray : null),
                    o
                }
                ,
                t.prototype._pointerMove = function(e, t, r, i, n) {
                    var o = this.scene;
                    return i ? o.setPointerOverSprite(null) : (r = this._pickSpriteButKeepRay(r, e, t, !1, o.cameraToUseForPointers || void 0)) && r.hit && r.pickedSprite ? (o.setPointerOverSprite(r.pickedSprite),
                    o._pointerOverSprite && o._pointerOverSprite.actionManager && o._pointerOverSprite.actionManager.hoverCursor ? n.style.cursor = o._pointerOverSprite.actionManager.hoverCursor : n.style.cursor = o.hoverCursor) : o.setPointerOverSprite(null),
                    r
                }
                ,
                t.prototype._pointerDown = function(t, r, i, n) {
                    var o = this.scene;
                    if (o._pickedDownSprite = null,
                    o.spriteManagers.length > 0 && (i = o.pickSprite(t, r, this._spritePredicate, !1, o.cameraToUseForPointers || void 0)) && i.hit && i.pickedSprite && i.pickedSprite.actionManager) {
                        switch (o._pickedDownSprite = i.pickedSprite,
                        n.button) {
                        case 0:
                            i.pickedSprite.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger, e.ActionEvent.CreateNewFromSprite(i.pickedSprite, o, n));
                            break;
                        case 1:
                            i.pickedSprite.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger, e.ActionEvent.CreateNewFromSprite(i.pickedSprite, o, n));
                            break;
                        case 2:
                            i.pickedSprite.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger, e.ActionEvent.CreateNewFromSprite(i.pickedSprite, o, n))
                        }
                        i.pickedSprite.actionManager && i.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickDownTrigger, e.ActionEvent.CreateNewFromSprite(i.pickedSprite, o, n))
                    }
                    return i
                }
                ,
                t.prototype._pointerUp = function(t, r, i, n) {
                    var o = this.scene;
                    if (o.spriteManagers.length > 0) {
                        var a = o.pickSprite(t, r, this._spritePredicate, !1, o.cameraToUseForPointers || void 0);
                        a && (a.hit && a.pickedSprite && a.pickedSprite.actionManager && (a.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger, e.ActionEvent.CreateNewFromSprite(a.pickedSprite, o, n)),
                        a.pickedSprite.actionManager && (this.scene._isPointerSwiping() || a.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickTrigger, e.ActionEvent.CreateNewFromSprite(a.pickedSprite, o, n)))),
                        o._pickedDownSprite && o._pickedDownSprite.actionManager && o._pickedDownSprite !== a.pickedSprite && o._pickedDownSprite.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger, e.ActionEvent.CreateNewFromSprite(o._pickedDownSprite, o, n)))
                    }
                    return i
                }
                ,
                t
            }();
            e.SpriteSceneComponent = t
        }(s || (s = {})),
        function(e) {
            var t = function(e, t, r) {
                this.bu = e,
                this.bv = t,
                this.distance = r,
                this.faceId = 0,
                this.subMeshId = 0
            };
            e.IntersectionInfo = t;
            var r = function() {
                function t() {
                    this.hit = !1,
                    this.distance = 0,
                    this.pickedPoint = null,
                    this.pickedMesh = null,
                    this.bu = 0,
                    this.bv = 0,
                    this.faceId = -1,
                    this.subMeshId = 0,
                    this.pickedSprite = null,
                    this.originMesh = null,
                    this.ray = null
                }
                return t.prototype.getNormal = function(t, r) {
                    if (void 0 === t && (t = !1),
                    void 0 === r && (r = !0),
                    !this.pickedMesh || !this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))
                        return null;
                    var i, n = this.pickedMesh.getIndices();
                    if (!n)
                        return null;
                    if (r) {
                        var o = this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind)
                          , a = e.Vector3.FromArray(o, 3 * n[3 * this.faceId])
                          , s = e.Vector3.FromArray(o, 3 * n[3 * this.faceId + 1])
                          , y = e.Vector3.FromArray(o, 3 * n[3 * this.faceId + 2]);
                        a = a.scale(this.bu),
                        s = s.scale(this.bv),
                        y = y.scale(1 - this.bu - this.bv),
                        i = new e.Vector3(a.x + s.x + y.x,a.y + s.y + y.y,a.z + s.z + y.z)
                    } else {
                        var l = this.pickedMesh.getVerticesData(e.VertexBuffer.PositionKind)
                          , c = e.Vector3.FromArray(l, 3 * n[3 * this.faceId])
                          , h = e.Vector3.FromArray(l, 3 * n[3 * this.faceId + 1])
                          , u = e.Vector3.FromArray(l, 3 * n[3 * this.faceId + 2])
                          , d = c.subtract(h)
                          , x = u.subtract(h);
                        i = e.Vector3.Cross(d, x)
                    }
                    if (t) {
                        var p = this.pickedMesh.getWorldMatrix();
                        this.pickedMesh.nonUniformScaling && (e.Tmp.Matrix[0].copyFrom(p),
                        (p = e.Tmp.Matrix[0]).setTranslationFromFloats(0, 0, 0),
                        p.invert(),
                        p.transposeToRef(e.Tmp.Matrix[1]),
                        p = e.Tmp.Matrix[1]),
                        i = e.Vector3.TransformNormal(i, p)
                    }
                    return i.normalize(),
                    i
                }
                ,
                t.prototype.getTextureCoordinates = function() {
                    if (!this.pickedMesh || !this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))
                        return null;
                    var t = this.pickedMesh.getIndices();
                    if (!t)
                        return null;
                    var r = this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind);
                    if (!r)
                        return null;
                    var i = e.Vector2.FromArray(r, 2 * t[3 * this.faceId])
                      , n = e.Vector2.FromArray(r, 2 * t[3 * this.faceId + 1])
                      , o = e.Vector2.FromArray(r, 2 * t[3 * this.faceId + 2]);
                    return i = i.scale(1 - this.bu - this.bv),
                    n = n.scale(this.bu),
                    o = o.scale(this.bv),
                    new e.Vector2(i.x + n.x + o.x,i.y + n.y + o.y)
                }
                ,
                t
            }();
            e.PickingInfo = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t, r) {
                    void 0 === r && (r = Number.MAX_VALUE),
                    this.origin = e,
                    this.direction = t,
                    this.length = r
                }
                return t.prototype.intersectsBoxMinMax = function(e, t) {
                    var r, i, n, o, a = 0, s = Number.MAX_VALUE;
                    if (Math.abs(this.direction.x) < 1e-7) {
                        if (this.origin.x < e.x || this.origin.x > t.x)
                            return !1
                    } else if (r = 1 / this.direction.x,
                    i = (e.x - this.origin.x) * r,
                    (n = (t.x - this.origin.x) * r) === -1 / 0 && (n = 1 / 0),
                    i > n && (o = i,
                    i = n,
                    n = o),
                    (a = Math.max(i, a)) > (s = Math.min(n, s)))
                        return !1;
                    if (Math.abs(this.direction.y) < 1e-7) {
                        if (this.origin.y < e.y || this.origin.y > t.y)
                            return !1
                    } else if (r = 1 / this.direction.y,
                    i = (e.y - this.origin.y) * r,
                    (n = (t.y - this.origin.y) * r) === -1 / 0 && (n = 1 / 0),
                    i > n && (o = i,
                    i = n,
                    n = o),
                    (a = Math.max(i, a)) > (s = Math.min(n, s)))
                        return !1;
                    if (Math.abs(this.direction.z) < 1e-7) {
                        if (this.origin.z < e.z || this.origin.z > t.z)
                            return !1
                    } else if (r = 1 / this.direction.z,
                    i = (e.z - this.origin.z) * r,
                    (n = (t.z - this.origin.z) * r) === -1 / 0 && (n = 1 / 0),
                    i > n && (o = i,
                    i = n,
                    n = o),
                    (a = Math.max(i, a)) > (s = Math.min(n, s)))
                        return !1;
                    return !0
                }
                ,
                t.prototype.intersectsBox = function(e) {
                    return this.intersectsBoxMinMax(e.minimum, e.maximum)
                }
                ,
                t.prototype.intersectsSphere = function(e) {
                    var t = e.center.x - this.origin.x
                      , r = e.center.y - this.origin.y
                      , i = e.center.z - this.origin.z
                      , n = t * t + r * r + i * i
                      , o = e.radius * e.radius;
                    if (n <= o)
                        return !0;
                    var a = t * this.direction.x + r * this.direction.y + i * this.direction.z;
                    return !(a < 0) && n - a * a <= o
                }
                ,
                t.prototype.intersectsTriangle = function(t, r, i) {
                    this._edge1 || (this._edge1 = e.Vector3.Zero(),
                    this._edge2 = e.Vector3.Zero(),
                    this._pvec = e.Vector3.Zero(),
                    this._tvec = e.Vector3.Zero(),
                    this._qvec = e.Vector3.Zero()),
                    r.subtractToRef(t, this._edge1),
                    i.subtractToRef(t, this._edge2),
                    e.Vector3.CrossToRef(this.direction, this._edge2, this._pvec);
                    var n = e.Vector3.Dot(this._edge1, this._pvec);
                    if (0 === n)
                        return null;
                    var o = 1 / n;
                    this.origin.subtractToRef(t, this._tvec);
                    var a = e.Vector3.Dot(this._tvec, this._pvec) * o;
                    if (a < 0 || a > 1)
                        return null;
                    e.Vector3.CrossToRef(this._tvec, this._edge1, this._qvec);
                    var s = e.Vector3.Dot(this.direction, this._qvec) * o;
                    if (s < 0 || a + s > 1)
                        return null;
                    var y = e.Vector3.Dot(this._edge2, this._qvec) * o;
                    return y > this.length ? null : new e.IntersectionInfo(a,s,y)
                }
                ,
                t.prototype.intersectsPlane = function(t) {
                    var r, i = e.Vector3.Dot(t.normal, this.direction);
                    if (Math.abs(i) < 9.99999997475243e-7)
                        return null;
                    var n = e.Vector3.Dot(t.normal, this.origin);
                    return (r = (-t.d - n) / i) < 0 ? r < -9.99999997475243e-7 ? null : 0 : r
                }
                ,
                t.prototype.intersectsMesh = function(r, i) {
                    var n = e.Tmp.Matrix[0];
                    return r.getWorldMatrix().invertToRef(n),
                    this._tmpRay ? t.TransformToRef(this, n, this._tmpRay) : this._tmpRay = t.Transform(this, n),
                    r.intersects(this._tmpRay, i)
                }
                ,
                t.prototype.intersectsMeshes = function(e, t, r) {
                    r ? r.length = 0 : r = [];
                    for (var i = 0; i < e.length; i++) {
                        var n = this.intersectsMesh(e[i], t);
                        n.hit && r.push(n)
                    }
                    return r.sort(this._comparePickingInfo),
                    r
                }
                ,
                t.prototype._comparePickingInfo = function(e, t) {
                    return e.distance < t.distance ? -1 : e.distance > t.distance ? 1 : 0
                }
                ,
                t.prototype.intersectionSegment = function(r, i, n) {
                    var o, a, s, y, l = this.origin.add(this.direction.multiplyByFloats(t.rayl, t.rayl, t.rayl)), c = i.subtract(r), h = l.subtract(this.origin), u = r.subtract(this.origin), d = e.Vector3.Dot(c, c), x = e.Vector3.Dot(c, h), p = e.Vector3.Dot(h, h), f = e.Vector3.Dot(c, u), m = e.Vector3.Dot(h, u), z = d * p - x * x, _ = z, g = z;
                    z < t.smallnum ? (a = 0,
                    _ = 1,
                    y = m,
                    g = p) : (y = d * m - x * f,
                    (a = x * m - p * f) < 0 ? (a = 0,
                    y = m,
                    g = p) : a > _ && (a = _,
                    y = m + x,
                    g = p)),
                    y < 0 ? (y = 0,
                    -f < 0 ? a = 0 : -f > d ? a = _ : (a = -f,
                    _ = d)) : y > g && (y = g,
                    -f + x < 0 ? a = 0 : -f + x > d ? a = _ : (a = -f + x,
                    _ = d)),
                    o = Math.abs(a) < t.smallnum ? 0 : a / _,
                    s = Math.abs(y) < t.smallnum ? 0 : y / g;
                    var v = h.multiplyByFloats(s, s, s)
                      , b = u.add(c.multiplyByFloats(o, o, o)).subtract(v);
                    return s > 0 && s <= this.length && b.lengthSquared() < n * n ? v.length() : -1
                }
                ,
                t.prototype.update = function(t, r, i, n, o, a, s) {
                    return e.Vector3.UnprojectFloatsToRef(t, r, 0, i, n, o, a, s, this.origin),
                    e.Vector3.UnprojectFloatsToRef(t, r, 1, i, n, o, a, s, e.Tmp.Vector3[0]),
                    e.Tmp.Vector3[0].subtractToRef(this.origin, this.direction),
                    this.direction.normalize(),
                    this
                }
                ,
                t.Zero = function() {
                    return new t(e.Vector3.Zero(),e.Vector3.Zero())
                }
                ,
                t.CreateNew = function(e, r, i, n, o, a, s) {
                    return t.Zero().update(e, r, i, n, o, a, s)
                }
                ,
                t.CreateNewFromTo = function(r, i, n) {
                    void 0 === n && (n = e.Matrix.Identity());
                    var o = i.subtract(r)
                      , a = Math.sqrt(o.x * o.x + o.y * o.y + o.z * o.z);
                    return o.normalize(),
                    t.Transform(new t(r,o,a), n)
                }
                ,
                t.Transform = function(r, i) {
                    var n = new t(new e.Vector3(0,0,0),new e.Vector3(0,0,0));
                    return t.TransformToRef(r, i, n),
                    n
                }
                ,
                t.TransformToRef = function(t, r, i) {
                    e.Vector3.TransformCoordinatesToRef(t.origin, r, i.origin),
                    e.Vector3.TransformNormalToRef(t.direction, r, i.direction),
                    i.length = t.length;
                    var n = i.direction
                      , o = n.length();
                    if (0 !== o && 1 !== o) {
                        var a = 1 / o;
                        n.x *= a,
                        n.y *= a,
                        n.z *= a,
                        i.length *= o
                    }
                }
                ,
                t.smallnum = 1e-8,
                t.rayl = 1e9,
                t
            }();
            e.Ray = t
        }(s || (s = {})),
        function(e) {
            var t, r = (t = {
                root: 0,
                found: !1
            },
            function(e, r, i, n) {
                t.root = 0,
                t.found = !1;
                var o = r * r - 4 * e * i;
                if (o < 0)
                    return t;
                var a = Math.sqrt(o)
                  , s = (-r - a) / (2 * e)
                  , y = (-r + a) / (2 * e);
                if (s > y) {
                    var l = y;
                    y = s,
                    s = l
                }
                return s > 0 && s < n ? (t.root = s,
                t.found = !0,
                t) : y > 0 && y < n ? (t.root = y,
                t.found = !0,
                t) : t
            }
            ), i = function() {
                function t() {
                    this._collisionPoint = e.Vector3.Zero(),
                    this._planeIntersectionPoint = e.Vector3.Zero(),
                    this._tempVector = e.Vector3.Zero(),
                    this._tempVector2 = e.Vector3.Zero(),
                    this._tempVector3 = e.Vector3.Zero(),
                    this._tempVector4 = e.Vector3.Zero(),
                    this._edge = e.Vector3.Zero(),
                    this._baseToVertex = e.Vector3.Zero(),
                    this._destinationPoint = e.Vector3.Zero(),
                    this._slidePlaneNormal = e.Vector3.Zero(),
                    this._displacementVector = e.Vector3.Zero(),
                    this._radius = e.Vector3.One(),
                    this._retry = 0,
                    this._basePointWorld = e.Vector3.Zero(),
                    this._velocityWorld = e.Vector3.Zero(),
                    this._normalizedVelocity = e.Vector3.Zero(),
                    this._collisionMask = -1
                }
                return Object.defineProperty(t.prototype, "collisionMask", {
                    get: function() {
                        return this._collisionMask
                    },
                    set: function(e) {
                        this._collisionMask = isNaN(e) ? -1 : e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "slidePlaneNormal", {
                    get: function() {
                        return this._slidePlaneNormal
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._initialize = function(t, r, i) {
                    this._velocity = r,
                    e.Vector3.NormalizeToRef(r, this._normalizedVelocity),
                    this._basePoint = t,
                    t.multiplyToRef(this._radius, this._basePointWorld),
                    r.multiplyToRef(this._radius, this._velocityWorld),
                    this._velocityWorldLength = this._velocityWorld.length(),
                    this._epsilon = i,
                    this.collisionFound = !1
                }
                ,
                t.prototype._checkPointInTriangle = function(t, r, i, n, o) {
                    r.subtractToRef(t, this._tempVector),
                    i.subtractToRef(t, this._tempVector2),
                    e.Vector3.CrossToRef(this._tempVector, this._tempVector2, this._tempVector4);
                    var a = e.Vector3.Dot(this._tempVector4, o);
                    return !(a < 0) && (n.subtractToRef(t, this._tempVector3),
                    e.Vector3.CrossToRef(this._tempVector2, this._tempVector3, this._tempVector4),
                    !((a = e.Vector3.Dot(this._tempVector4, o)) < 0) && (e.Vector3.CrossToRef(this._tempVector3, this._tempVector, this._tempVector4),
                    (a = e.Vector3.Dot(this._tempVector4, o)) >= 0))
                }
                ,
                t.prototype._canDoCollision = function(t, r, i, n) {
                    var o = e.Vector3.Distance(this._basePointWorld, t)
                      , a = Math.max(this._radius.x, this._radius.y, this._radius.z);
                    return !(o > this._velocityWorldLength + a + r) && !!function(e, t, r, i) {
                        return !(e.x > r.x + i) && (!(r.x - i > t.x) && (!(e.y > r.y + i) && (!(r.y - i > t.y) && (!(e.z > r.z + i) && !(r.z - i > t.z)))))
                    }(i, n, this._basePointWorld, this._velocityWorldLength + a)
                }
                ,
                t.prototype._testTriangle = function(t, i, n, o, a, s) {
                    var y, l = !1;
                    i || (i = []),
                    i[t] || (i[t] = new e.Plane(0,0,0,0),
                    i[t].copyFromPoints(n, o, a));
                    var c = i[t];
                    if (s || c.isFrontFacingTo(this._normalizedVelocity, 0)) {
                        var h = c.signedDistanceTo(this._basePoint)
                          , u = e.Vector3.Dot(c.normal, this._velocity);
                        if (0 == u) {
                            if (Math.abs(h) >= 1)
                                return;
                            l = !0,
                            y = 0
                        } else {
                            var d = (1 - h) / u;
                            if ((y = (-1 - h) / u) > d) {
                                var x = d;
                                d = y,
                                y = x
                            }
                            if (y > 1 || d < 0)
                                return;
                            y < 0 && (y = 0),
                            y > 1 && (y = 1)
                        }
                        this._collisionPoint.copyFromFloats(0, 0, 0);
                        var p = !1
                          , f = 1;
                        if (l || (this._basePoint.subtractToRef(c.normal, this._planeIntersectionPoint),
                        this._velocity.scaleToRef(y, this._tempVector),
                        this._planeIntersectionPoint.addInPlace(this._tempVector),
                        this._checkPointInTriangle(this._planeIntersectionPoint, n, o, a, c.normal) && (p = !0,
                        f = y,
                        this._collisionPoint.copyFrom(this._planeIntersectionPoint))),
                        !p) {
                            var m = this._velocity.lengthSquared()
                              , z = m;
                            this._basePoint.subtractToRef(n, this._tempVector);
                            var _ = 2 * e.Vector3.Dot(this._velocity, this._tempVector)
                              , g = this._tempVector.lengthSquared() - 1
                              , v = r(z, _, g, f);
                            v.found && (f = v.root,
                            p = !0,
                            this._collisionPoint.copyFrom(n)),
                            this._basePoint.subtractToRef(o, this._tempVector),
                            _ = 2 * e.Vector3.Dot(this._velocity, this._tempVector),
                            g = this._tempVector.lengthSquared() - 1,
                            (v = r(z, _, g, f)).found && (f = v.root,
                            p = !0,
                            this._collisionPoint.copyFrom(o)),
                            this._basePoint.subtractToRef(a, this._tempVector),
                            _ = 2 * e.Vector3.Dot(this._velocity, this._tempVector),
                            g = this._tempVector.lengthSquared() - 1,
                            (v = r(z, _, g, f)).found && (f = v.root,
                            p = !0,
                            this._collisionPoint.copyFrom(a)),
                            o.subtractToRef(n, this._edge),
                            n.subtractToRef(this._basePoint, this._baseToVertex);
                            var b = this._edge.lengthSquared()
                              , T = e.Vector3.Dot(this._edge, this._velocity)
                              , E = e.Vector3.Dot(this._edge, this._baseToVertex);
                            if (z = b * -m + T * T,
                            _ = b * (2 * e.Vector3.Dot(this._velocity, this._baseToVertex)) - 2 * T * E,
                            g = b * (1 - this._baseToVertex.lengthSquared()) + E * E,
                            (v = r(z, _, g, f)).found) {
                                var P = (T * v.root - E) / b;
                                P >= 0 && P <= 1 && (f = v.root,
                                p = !0,
                                this._edge.scaleInPlace(P),
                                n.addToRef(this._edge, this._collisionPoint))
                            }
                            a.subtractToRef(o, this._edge),
                            o.subtractToRef(this._basePoint, this._baseToVertex),
                            b = this._edge.lengthSquared(),
                            T = e.Vector3.Dot(this._edge, this._velocity),
                            E = e.Vector3.Dot(this._edge, this._baseToVertex),
                            z = b * -m + T * T,
                            _ = b * (2 * e.Vector3.Dot(this._velocity, this._baseToVertex)) - 2 * T * E,
                            g = b * (1 - this._baseToVertex.lengthSquared()) + E * E,
                            (v = r(z, _, g, f)).found && (P = (T * v.root - E) / b) >= 0 && P <= 1 && (f = v.root,
                            p = !0,
                            this._edge.scaleInPlace(P),
                            o.addToRef(this._edge, this._collisionPoint)),
                            n.subtractToRef(a, this._edge),
                            a.subtractToRef(this._basePoint, this._baseToVertex),
                            b = this._edge.lengthSquared(),
                            T = e.Vector3.Dot(this._edge, this._velocity),
                            E = e.Vector3.Dot(this._edge, this._baseToVertex),
                            z = b * -m + T * T,
                            _ = b * (2 * e.Vector3.Dot(this._velocity, this._baseToVertex)) - 2 * T * E,
                            g = b * (1 - this._baseToVertex.lengthSquared()) + E * E,
                            (v = r(z, _, g, f)).found && (P = (T * v.root - E) / b) >= 0 && P <= 1 && (f = v.root,
                            p = !0,
                            this._edge.scaleInPlace(P),
                            a.addToRef(this._edge, this._collisionPoint))
                        }
                        if (p) {
                            var A = f * this._velocity.length();
                            (!this.collisionFound || A < this._nearestDistance) && (this.intersectionPoint ? this.intersectionPoint.copyFrom(this._collisionPoint) : this.intersectionPoint = this._collisionPoint.clone(),
                            this._nearestDistance = A,
                            this.collisionFound = !0)
                        }
                    }
                }
                ,
                t.prototype._collide = function(e, t, r, i, n, o, a) {
                    for (var s = i; s < n; s += 3) {
                        var y = t[r[s] - o]
                          , l = t[r[s + 1] - o]
                          , c = t[r[s + 2] - o];
                        this._testTriangle(s, e, c, l, y, a)
                    }
                }
                ,
                t.prototype._getResponse = function(t, r) {
                    t.addToRef(r, this._destinationPoint),
                    r.scaleInPlace(this._nearestDistance / r.length()),
                    this._basePoint.addToRef(r, t),
                    t.subtractToRef(this.intersectionPoint, this._slidePlaneNormal),
                    this._slidePlaneNormal.normalize(),
                    this._slidePlaneNormal.scaleToRef(this._epsilon, this._displacementVector),
                    t.addInPlace(this._displacementVector),
                    this.intersectionPoint.addInPlace(this._displacementVector),
                    this._slidePlaneNormal.scaleInPlace(e.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint, this._slidePlaneNormal, this._destinationPoint)),
                    this._destinationPoint.subtractInPlace(this._slidePlaneNormal),
                    this._destinationPoint.subtractToRef(this.intersectionPoint, r)
                }
                ,
                t
            }();
            e.Collider = i
        }(s || (s = {})),
        function(e) {
            var t, r;
            e.CollisionWorker = "",
            function(e) {
                e[e.INIT = 0] = "INIT",
                e[e.UPDATE = 1] = "UPDATE",
                e[e.COLLIDE = 2] = "COLLIDE"
            }(t = e.WorkerTaskType || (e.WorkerTaskType = {})),
            function(e) {
                e[e.SUCCESS = 0] = "SUCCESS",
                e[e.UNKNOWN_ERROR = 1] = "UNKNOWN_ERROR"
            }(r = e.WorkerReplyType || (e.WorkerReplyType = {}));
            var i = function() {
                function i() {
                    var n = this;
                    this._scaledPosition = e.Vector3.Zero(),
                    this._scaledVelocity = e.Vector3.Zero(),
                    this.onMeshUpdated = function(e) {
                        n._addUpdateMeshesList[e.uniqueId] = i.SerializeMesh(e)
                    }
                    ,
                    this.onGeometryUpdated = function(e) {
                        n._addUpdateGeometriesList[e.id] = i.SerializeGeometry(e)
                    }
                    ,
                    this._afterRender = function() {
                        if (n._init && !(0 == n._toRemoveGeometryArray.length && 0 == n._toRemoveMeshesArray.length && 0 == Object.keys(n._addUpdateGeometriesList).length && 0 == Object.keys(n._addUpdateMeshesList).length || n._runningUpdated > 4)) {
                            ++n._runningUpdated;
                            var e = {
                                updatedMeshes: n._addUpdateMeshesList,
                                updatedGeometries: n._addUpdateGeometriesList,
                                removedGeometries: n._toRemoveGeometryArray,
                                removedMeshes: n._toRemoveMeshesArray
                            }
                              , r = {
                                payload: e,
                                taskType: t.UPDATE
                            }
                              , i = [];
                            for (var o in e.updatedGeometries)
                                e.updatedGeometries.hasOwnProperty(o) && (i.push(r.payload.updatedGeometries[o].indices.buffer),
                                i.push(r.payload.updatedGeometries[o].normals.buffer),
                                i.push(r.payload.updatedGeometries[o].positions.buffer));
                            n._worker.postMessage(r, i),
                            n._addUpdateMeshesList = {},
                            n._addUpdateGeometriesList = {},
                            n._toRemoveGeometryArray = [],
                            n._toRemoveMeshesArray = []
                        }
                    }
                    ,
                    this._onMessageFromWorker = function(i) {
                        var o = i.data;
                        if (o.error == r.SUCCESS)
                            switch (o.taskType) {
                            case t.INIT:
                                n._init = !0,
                                n._scene.meshes.forEach((function(e) {
                                    n.onMeshAdded(e)
                                }
                                )),
                                n._scene.getGeometries().forEach((function(e) {
                                    n.onGeometryAdded(e)
                                }
                                ));
                                break;
                            case t.UPDATE:
                                n._runningUpdated--;
                                break;
                            case t.COLLIDE:
                                var a = o.payload;
                                if (!n._collisionsCallbackArray[a.collisionId])
                                    return;
                                var s = n._collisionsCallbackArray[a.collisionId];
                                if (s) {
                                    var y = n._scene.getMeshByUniqueID(a.collidedMeshUniqueId);
                                    y && s(a.collisionId, e.Vector3.FromArray(a.newPosition), y)
                                }
                                n._collisionsCallbackArray[a.collisionId] = null
                            }
                        else
                            e.Tools.Warn("error returned from worker!")
                    }
                    ,
                    this._collisionsCallbackArray = [],
                    this._init = !1,
                    this._runningUpdated = 0,
                    this._addUpdateMeshesList = {},
                    this._addUpdateGeometriesList = {},
                    this._toRemoveGeometryArray = [],
                    this._toRemoveMeshesArray = []
                }
                return i.prototype.getNewPosition = function(e, r, i, n, o, a, s) {
                    if (this._init && !this._collisionsCallbackArray[s] && !this._collisionsCallbackArray[s + 1e5]) {
                        e.divideToRef(i._radius, this._scaledPosition),
                        r.divideToRef(i._radius, this._scaledVelocity),
                        this._collisionsCallbackArray[s] = a;
                        var y = {
                            payload: {
                                collider: {
                                    position: this._scaledPosition.asArray(),
                                    velocity: this._scaledVelocity.asArray(),
                                    radius: i._radius.asArray()
                                },
                                collisionId: s,
                                excludedMeshUniqueId: o ? o.uniqueId : null,
                                maximumRetry: n
                            },
                            taskType: t.COLLIDE
                        };
                        this._worker.postMessage(y)
                    }
                }
                ,
                i.prototype.init = function(r) {
                    this._scene = r,
                    this._scene.registerAfterRender(this._afterRender);
                    var i = e.WorkerIncluded ? e.Engine.CodeRepository + "Collisions/babylon.collisionWorker.js" : URL.createObjectURL(new Blob([e.CollisionWorker],{
                        type: "application/javascript"
                    }));
                    this._worker = new Worker(i),
                    this._worker.onmessage = this._onMessageFromWorker;
                    var n = {
                        payload: {},
                        taskType: t.INIT
                    };
                    this._worker.postMessage(n)
                }
                ,
                i.prototype.destroy = function() {
                    this._scene.unregisterAfterRender(this._afterRender),
                    this._worker.terminate()
                }
                ,
                i.prototype.onMeshAdded = function(e) {
                    e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),
                    this.onMeshUpdated(e)
                }
                ,
                i.prototype.onMeshRemoved = function(e) {
                    this._toRemoveMeshesArray.push(e.uniqueId)
                }
                ,
                i.prototype.onGeometryAdded = function(e) {
                    e.onGeometryUpdated = this.onGeometryUpdated,
                    this.onGeometryUpdated(e)
                }
                ,
                i.prototype.onGeometryDeleted = function(e) {
                    this._toRemoveGeometryArray.push(e.id)
                }
                ,
                i.SerializeMesh = function(t) {
                    var r = [];
                    t.subMeshes && (r = t.subMeshes.map((function(e, t) {
                        var r = e.getBoundingInfo();
                        return {
                            position: t,
                            verticesStart: e.verticesStart,
                            verticesCount: e.verticesCount,
                            indexStart: e.indexStart,
                            indexCount: e.indexCount,
                            hasMaterial: !!e.getMaterial(),
                            sphereCenter: r.boundingSphere.centerWorld.asArray(),
                            sphereRadius: r.boundingSphere.radiusWorld,
                            boxMinimum: r.boundingBox.minimumWorld.asArray(),
                            boxMaximum: r.boundingBox.maximumWorld.asArray()
                        }
                    }
                    )));
                    var i = null;
                    if (t instanceof e.Mesh)
                        i = (n = t.geometry) ? n.id : null;
                    else if (t instanceof e.InstancedMesh) {
                        var n;
                        i = (n = t.sourceMesh && t.sourceMesh.geometry) ? n.id : null
                    }
                    var o = t.getBoundingInfo();
                    return {
                        uniqueId: t.uniqueId,
                        id: t.id,
                        name: t.name,
                        geometryId: i,
                        sphereCenter: o.boundingSphere.centerWorld.asArray(),
                        sphereRadius: o.boundingSphere.radiusWorld,
                        boxMinimum: o.boundingBox.minimumWorld.asArray(),
                        boxMaximum: o.boundingBox.maximumWorld.asArray(),
                        worldMatrixFromCache: t.worldMatrixFromCache.asArray(),
                        subMeshes: r,
                        checkCollisions: t.checkCollisions
                    }
                }
                ,
                i.SerializeGeometry = function(t) {
                    return {
                        id: t.id,
                        positions: new Float32Array(t.getVerticesData(e.VertexBuffer.PositionKind) || []),
                        normals: new Float32Array(t.getVerticesData(e.VertexBuffer.NormalKind) || []),
                        indices: new Uint32Array(t.getIndices() || [])
                    }
                }
                ,
                i
            }();
            e.CollisionCoordinatorWorker = i;
            var n = function() {
                function t() {
                    this._scaledPosition = e.Vector3.Zero(),
                    this._scaledVelocity = e.Vector3.Zero(),
                    this._finalPosition = e.Vector3.Zero()
                }
                return t.prototype.getNewPosition = function(e, t, r, i, n, o, a) {
                    e.divideToRef(r._radius, this._scaledPosition),
                    t.divideToRef(r._radius, this._scaledVelocity),
                    r.collidedMesh = null,
                    r._retry = 0,
                    r._initialVelocity = this._scaledVelocity,
                    r._initialPosition = this._scaledPosition,
                    this._collideWithWorld(this._scaledPosition, this._scaledVelocity, r, i, this._finalPosition, n),
                    this._finalPosition.multiplyInPlace(r._radius),
                    o(a, this._finalPosition, r.collidedMesh)
                }
                ,
                t.prototype.init = function(e) {
                    this._scene = e
                }
                ,
                t.prototype.destroy = function() {}
                ,
                t.prototype.onMeshAdded = function(e) {}
                ,
                t.prototype.onMeshUpdated = function(e) {}
                ,
                t.prototype.onMeshRemoved = function(e) {}
                ,
                t.prototype.onGeometryAdded = function(e) {}
                ,
                t.prototype.onGeometryUpdated = function(e) {}
                ,
                t.prototype.onGeometryDeleted = function(e) {}
                ,
                t.prototype._collideWithWorld = function(t, r, i, n, o, a) {
                    void 0 === a && (a = null);
                    var s = 10 * e.Engine.CollisionsEpsilon;
                    if (i._retry >= n)
                        o.copyFrom(t);
                    else {
                        var y = a ? a.collisionMask : i.collisionMask;
                        i._initialize(t, r, s);
                        for (var l = 0; l < this._scene.meshes.length; l++) {
                            var c = this._scene.meshes[l];
                            c.isEnabled() && c.checkCollisions && c.subMeshes && c !== a && 0 != (y & c.collisionGroup) && c._checkCollision(i)
                        }
                        i.collisionFound ? (0 === r.x && 0 === r.y && 0 === r.z || i._getResponse(t, r),
                        r.length() <= s ? o.copyFrom(t) : (i._retry++,
                        this._collideWithWorld(t, r, i, n, o, a))) : t.addToRef(r, o)
                    }
                }
                ,
                t
            }();
            e.CollisionCoordinatorLegacy = n
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(r) {
                    this.particleSystem = r,
                    this.position = e.Vector3.Zero(),
                    this.direction = e.Vector3.Zero(),
                    this.color = new e.Color4(0,0,0,0),
                    this.colorStep = new e.Color4(0,0,0,0),
                    this.lifeTime = 1,
                    this.age = 0,
                    this.size = 0,
                    this.scale = new e.Vector2(1,1),
                    this.angle = 0,
                    this.angularSpeed = 0,
                    this.cellIndex = 0,
                    this._attachedSubEmitters = null,
                    this._currentColor1 = new e.Color4(0,0,0,0),
                    this._currentColor2 = new e.Color4(0,0,0,0),
                    this._currentSize1 = 0,
                    this._currentSize2 = 0,
                    this._currentAngularSpeed1 = 0,
                    this._currentAngularSpeed2 = 0,
                    this._currentVelocity1 = 0,
                    this._currentVelocity2 = 0,
                    this._currentLimitVelocity1 = 0,
                    this._currentLimitVelocity2 = 0,
                    this._currentDrag1 = 0,
                    this._currentDrag2 = 0,
                    this.id = t._Count++,
                    this.particleSystem.isAnimationSheetEnabled && this.updateCellInfoFromSystem()
                }
                return t.prototype.updateCellInfoFromSystem = function() {
                    this.cellIndex = this.particleSystem.startSpriteCellID
                }
                ,
                t.prototype.updateCellIndex = function() {
                    var t = this.age
                      , r = this.particleSystem.spriteCellChangeSpeed;
                    this.particleSystem.spriteRandomStartCell && (void 0 === this._randomCellOffset && (this._randomCellOffset = Math.random() * this.lifeTime),
                    0 === r ? (r = 1,
                    t = this._randomCellOffset) : t += this._randomCellOffset);
                    var i = this._initialEndSpriteCellID - this._initialStartSpriteCellID
                      , n = e.Scalar.Clamp(t * r % this.lifeTime / this.lifeTime);
                    this.cellIndex = this._initialStartSpriteCellID + n * i | 0
                }
                ,
                t.prototype._inheritParticleInfoToSubEmitter = function(t) {
                    if (t.particleSystem.emitter.position) {
                        var r = t.particleSystem.emitter;
                        r.position.copyFrom(this.position),
                        t.inheritDirection && (r.position.subtractToRef(this.direction, e.Tmp.Vector3[0]),
                        r.lookAt(e.Tmp.Vector3[0], 0, Math.PI / 2))
                    } else {
                        t.particleSystem.emitter.copyFrom(this.position)
                    }
                    this.direction.scaleToRef(t.inheritedVelocityAmount / 2, e.Tmp.Vector3[0]),
                    t.particleSystem._inheritedVelocityOffset.copyFrom(e.Tmp.Vector3[0])
                }
                ,
                t.prototype._inheritParticleInfoToSubEmitters = function() {
                    var e = this;
                    this._attachedSubEmitters && this._attachedSubEmitters.length > 0 && this._attachedSubEmitters.forEach((function(t) {
                        e._inheritParticleInfoToSubEmitter(t)
                    }
                    ))
                }
                ,
                t.prototype._reset = function() {
                    this.age = 0,
                    this._currentColorGradient = null,
                    this._currentSizeGradient = null,
                    this._currentAngularSpeedGradient = null,
                    this._currentVelocityGradient = null,
                    this._currentLimitVelocityGradient = null,
                    this._currentDragGradient = null,
                    this.cellIndex = this.particleSystem.startSpriteCellID,
                    this._randomCellOffset = void 0
                }
                ,
                t.prototype.copyTo = function(e) {
                    e.position.copyFrom(this.position),
                    this._initialDirection ? e._initialDirection ? e._initialDirection.copyFrom(this._initialDirection) : e._initialDirection = this._initialDirection.clone() : e._initialDirection = null,
                    e.direction.copyFrom(this.direction),
                    e.color.copyFrom(this.color),
                    e.colorStep.copyFrom(this.colorStep),
                    e.lifeTime = this.lifeTime,
                    e.age = this.age,
                    e._randomCellOffset = this._randomCellOffset,
                    e.size = this.size,
                    e.scale.copyFrom(this.scale),
                    e.angle = this.angle,
                    e.angularSpeed = this.angularSpeed,
                    e.particleSystem = this.particleSystem,
                    e.cellIndex = this.cellIndex,
                    e.id = this.id,
                    e._attachedSubEmitters = this._attachedSubEmitters,
                    this._currentColorGradient && (e._currentColorGradient = this._currentColorGradient,
                    e._currentColor1.copyFrom(this._currentColor1),
                    e._currentColor2.copyFrom(this._currentColor2)),
                    this._currentSizeGradient && (e._currentSizeGradient = this._currentSizeGradient,
                    e._currentSize1 = this._currentSize1,
                    e._currentSize2 = this._currentSize2),
                    this._currentAngularSpeedGradient && (e._currentAngularSpeedGradient = this._currentAngularSpeedGradient,
                    e._currentAngularSpeed1 = this._currentAngularSpeed1,
                    e._currentAngularSpeed2 = this._currentAngularSpeed2),
                    this._currentVelocityGradient && (e._currentVelocityGradient = this._currentVelocityGradient,
                    e._currentVelocity1 = this._currentVelocity1,
                    e._currentVelocity2 = this._currentVelocity2),
                    this._currentLimitVelocityGradient && (e._currentLimitVelocityGradient = this._currentLimitVelocityGradient,
                    e._currentLimitVelocity1 = this._currentLimitVelocity1,
                    e._currentLimitVelocity2 = this._currentLimitVelocity2),
                    this._currentDragGradient && (e._currentDragGradient = this._currentDragGradient,
                    e._currentDrag1 = this._currentDrag1,
                    e._currentDrag2 = this._currentDrag2),
                    this.particleSystem.isAnimationSheetEnabled && (e._initialStartSpriteCellID = this._initialStartSpriteCellID,
                    e._initialEndSpriteCellID = this._initialEndSpriteCellID),
                    this.particleSystem.useRampGradients && e.remapData.copyFrom(this.remapData),
                    this._randomNoiseCoordinates1 && (e._randomNoiseCoordinates1 ? (e._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),
                    e._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)) : (e._randomNoiseCoordinates1 = this._randomNoiseCoordinates1.clone(),
                    e._randomNoiseCoordinates2 = this._randomNoiseCoordinates2.clone()))
                }
                ,
                t._Count = 0,
                t
            }();
            e.Particle = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    this.animations = [],
                    this.renderingGroupId = 0,
                    this.emitter = null,
                    this.emitRate = 10,
                    this.manualEmitCount = -1,
                    this.updateSpeed = .01,
                    this.targetStopDuration = 0,
                    this.disposeOnStop = !1,
                    this.minEmitPower = 1,
                    this.maxEmitPower = 1,
                    this.minLifeTime = 1,
                    this.maxLifeTime = 1,
                    this.minSize = 1,
                    this.maxSize = 1,
                    this.minScaleX = 1,
                    this.maxScaleX = 1,
                    this.minScaleY = 1,
                    this.maxScaleY = 1,
                    this.minInitialRotation = 0,
                    this.maxInitialRotation = 0,
                    this.minAngularSpeed = 0,
                    this.maxAngularSpeed = 0,
                    this.layerMask = 268435455,
                    this.customShader = null,
                    this.preventAutoStart = !1,
                    this.noiseStrength = new e.Vector3(10,10,10),
                    this.onAnimationEnd = null,
                    this.blendMode = e.ParticleSystem.BLENDMODE_ONEONE,
                    this.forceDepthWrite = !1,
                    this.preWarmCycles = 0,
                    this.preWarmStepOffset = 1,
                    this.spriteCellChangeSpeed = 1,
                    this.startSpriteCellID = 0,
                    this.endSpriteCellID = 0,
                    this.spriteCellWidth = 0,
                    this.spriteCellHeight = 0,
                    this.spriteRandomStartCell = !1,
                    this.translationPivot = new e.Vector2(0,0),
                    this.beginAnimationOnStart = !1,
                    this.beginAnimationFrom = 0,
                    this.beginAnimationTo = 60,
                    this.beginAnimationLoop = !1,
                    this.gravity = e.Vector3.Zero(),
                    this._colorGradients = null,
                    this._sizeGradients = null,
                    this._lifeTimeGradients = null,
                    this._angularSpeedGradients = null,
                    this._velocityGradients = null,
                    this._limitVelocityGradients = null,
                    this._dragGradients = null,
                    this._emitRateGradients = null,
                    this._startSizeGradients = null,
                    this._rampGradients = null,
                    this._colorRemapGradients = null,
                    this._alphaRemapGradients = null,
                    this.startDelay = 0,
                    this.limitVelocityDamping = .4,
                    this.color1 = new e.Color4(1,1,1,1),
                    this.color2 = new e.Color4(1,1,1,1),
                    this.colorDead = new e.Color4(0,0,0,1),
                    this.textureMask = new e.Color4(1,1,1,1),
                    this._isSubEmitter = !1,
                    this.billboardMode = e.ParticleSystem.BILLBOARDMODE_ALL,
                    this._isBillboardBased = !0,
                    this._imageProcessingConfigurationDefines = new e.ImageProcessingConfigurationDefines,
                    this.id = t,
                    this.name = t
                }
                return Object.defineProperty(t.prototype, "isAnimationSheetEnabled", {
                    get: function() {
                        return this._isAnimationSheetEnabled
                    },
                    set: function(e) {
                        this._isAnimationSheetEnabled != e && (this._isAnimationSheetEnabled = e,
                        this._reset())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getScene = function() {
                    return this._scene
                }
                ,
                t.prototype._hasTargetStopDurationDependantGradient = function() {
                    return this._startSizeGradients && this._startSizeGradients.length > 0 || this._emitRateGradients && this._emitRateGradients.length > 0 || this._lifeTimeGradients && this._lifeTimeGradients.length > 0
                }
                ,
                t.prototype.getDragGradients = function() {
                    return this._dragGradients
                }
                ,
                t.prototype.getLimitVelocityGradients = function() {
                    return this._limitVelocityGradients
                }
                ,
                t.prototype.getColorGradients = function() {
                    return this._colorGradients
                }
                ,
                t.prototype.getSizeGradients = function() {
                    return this._sizeGradients
                }
                ,
                t.prototype.getColorRemapGradients = function() {
                    return this._colorRemapGradients
                }
                ,
                t.prototype.getAlphaRemapGradients = function() {
                    return this._alphaRemapGradients
                }
                ,
                t.prototype.getLifeTimeGradients = function() {
                    return this._lifeTimeGradients
                }
                ,
                t.prototype.getAngularSpeedGradients = function() {
                    return this._angularSpeedGradients
                }
                ,
                t.prototype.getVelocityGradients = function() {
                    return this._velocityGradients
                }
                ,
                t.prototype.getStartSizeGradients = function() {
                    return this._startSizeGradients
                }
                ,
                t.prototype.getEmitRateGradients = function() {
                    return this._emitRateGradients
                }
                ,
                Object.defineProperty(t.prototype, "direction1", {
                    get: function() {
                        return this.particleEmitterType.direction1 ? this.particleEmitterType.direction1 : e.Vector3.Zero()
                    },
                    set: function(e) {
                        this.particleEmitterType.direction1 && (this.particleEmitterType.direction1 = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "direction2", {
                    get: function() {
                        return this.particleEmitterType.direction2 ? this.particleEmitterType.direction2 : e.Vector3.Zero()
                    },
                    set: function(e) {
                        this.particleEmitterType.direction2 && (this.particleEmitterType.direction2 = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "minEmitBox", {
                    get: function() {
                        return this.particleEmitterType.minEmitBox ? this.particleEmitterType.minEmitBox : e.Vector3.Zero()
                    },
                    set: function(e) {
                        this.particleEmitterType.minEmitBox && (this.particleEmitterType.minEmitBox = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "maxEmitBox", {
                    get: function() {
                        return this.particleEmitterType.maxEmitBox ? this.particleEmitterType.maxEmitBox : e.Vector3.Zero()
                    },
                    set: function(e) {
                        this.particleEmitterType.maxEmitBox && (this.particleEmitterType.maxEmitBox = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "isBillboardBased", {
                    get: function() {
                        return this._isBillboardBased
                    },
                    set: function(e) {
                        this._isBillboardBased !== e && (this._isBillboardBased = e,
                        this._reset())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "imageProcessingConfiguration", {
                    get: function() {
                        return this._imageProcessingConfiguration
                    },
                    set: function(e) {
                        this._attachImageProcessingConfiguration(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._attachImageProcessingConfiguration = function(e) {
                    e !== this._imageProcessingConfiguration && (this._imageProcessingConfiguration = e || this._scene.imageProcessingConfiguration)
                }
                ,
                t.prototype._reset = function() {}
                ,
                t.prototype._removeGradientAndTexture = function(e, t, r) {
                    if (!t)
                        return this;
                    for (var i = 0, n = 0, o = t; n < o.length; n++) {
                        if (o[n].gradient === e) {
                            t.splice(i, 1);
                            break
                        }
                        i++
                    }
                    return r && r.dispose(),
                    this
                }
                ,
                t.prototype.createPointEmitter = function(t, r) {
                    var i = new e.PointParticleEmitter;
                    return i.direction1 = t,
                    i.direction2 = r,
                    this.particleEmitterType = i,
                    i
                }
                ,
                t.prototype.createHemisphericEmitter = function(t, r) {
                    void 0 === t && (t = 1),
                    void 0 === r && (r = 1);
                    var i = new e.HemisphericParticleEmitter(t,r);
                    return this.particleEmitterType = i,
                    i
                }
                ,
                t.prototype.createSphereEmitter = function(t, r) {
                    void 0 === t && (t = 1),
                    void 0 === r && (r = 1);
                    var i = new e.SphereParticleEmitter(t,r);
                    return this.particleEmitterType = i,
                    i
                }
                ,
                t.prototype.createDirectedSphereEmitter = function(t, r, i) {
                    void 0 === t && (t = 1),
                    void 0 === r && (r = new e.Vector3(0,1,0)),
                    void 0 === i && (i = new e.Vector3(0,1,0));
                    var n = new e.SphereDirectedParticleEmitter(t,r,i);
                    return this.particleEmitterType = n,
                    n
                }
                ,
                t.prototype.createCylinderEmitter = function(t, r, i, n) {
                    void 0 === t && (t = 1),
                    void 0 === r && (r = 1),
                    void 0 === i && (i = 1),
                    void 0 === n && (n = 0);
                    var o = new e.CylinderParticleEmitter(t,r,i,n);
                    return this.particleEmitterType = o,
                    o
                }
                ,
                t.prototype.createDirectedCylinderEmitter = function(t, r, i, n, o) {
                    void 0 === t && (t = 1),
                    void 0 === r && (r = 1),
                    void 0 === i && (i = 1),
                    void 0 === n && (n = new e.Vector3(0,1,0)),
                    void 0 === o && (o = new e.Vector3(0,1,0));
                    var a = new e.CylinderDirectedParticleEmitter(t,r,i,n,o);
                    return this.particleEmitterType = a,
                    a
                }
                ,
                t.prototype.createConeEmitter = function(t, r) {
                    void 0 === t && (t = 1),
                    void 0 === r && (r = Math.PI / 4);
                    var i = new e.ConeParticleEmitter(t,r);
                    return this.particleEmitterType = i,
                    i
                }
                ,
                t.prototype.createBoxEmitter = function(t, r, i, n) {
                    var o = new e.BoxParticleEmitter;
                    return this.particleEmitterType = o,
                    this.direction1 = t,
                    this.direction2 = r,
                    this.minEmitBox = i,
                    this.maxEmitBox = n,
                    o
                }
                ,
                t.BLENDMODE_ONEONE = 0,
                t.BLENDMODE_STANDARD = 1,
                t.BLENDMODE_ADD = 2,
                t.BLENDMODE_MULTIPLY = 3,
                t.BLENDMODE_MULTIPLYADD = 4,
                t
            }();
            e.BaseParticleSystem = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s) {
                    void 0 === o && (o = null),
                    void 0 === a && (a = !1),
                    void 0 === s && (s = .01);
                    var y = t.call(this, r) || this;
                    return y._inheritedVelocityOffset = new e.Vector3,
                    y.onDisposeObservable = new e.Observable,
                    y._particles = new Array,
                    y._stockParticles = new Array,
                    y._newPartsExcess = 0,
                    y._vertexBuffers = {},
                    y._scaledColorStep = new e.Color4(0,0,0,0),
                    y._colorDiff = new e.Color4(0,0,0,0),
                    y._scaledDirection = e.Vector3.Zero(),
                    y._scaledGravity = e.Vector3.Zero(),
                    y._currentRenderId = -1,
                    y._useInstancing = !1,
                    y._started = !1,
                    y._stopped = !1,
                    y._actualFrame = 0,
                    y._currentEmitRate1 = 0,
                    y._currentEmitRate2 = 0,
                    y._currentStartSize1 = 0,
                    y._currentStartSize2 = 0,
                    y._rawTextureWidth = 256,
                    y._useRampGradients = !1,
                    y._disposeEmitterOnDispose = !1,
                    y.recycleParticle = function(e) {
                        var t = y._particles.pop();
                        t !== e && t.copyTo(e),
                        y._stockParticles.push(t)
                    }
                    ,
                    y._createParticle = function() {
                        var t;
                        if (0 !== y._stockParticles.length ? (t = y._stockParticles.pop())._reset() : t = new e.Particle(y),
                        y._subEmitters && y._subEmitters.length > 0) {
                            var r = y._subEmitters[Math.floor(Math.random() * y._subEmitters.length)];
                            t._attachedSubEmitters = [],
                            r.forEach((function(r) {
                                if (r.type === e.SubEmitterType.ATTACHED) {
                                    var i = r.clone();
                                    t._attachedSubEmitters.push(i),
                                    i.particleSystem.start()
                                }
                            }
                            ))
                        }
                        return t
                    }
                    ,
                    y._emitFromParticle = function(t) {
                        if (y._subEmitters && 0 !== y._subEmitters.length) {
                            var r = Math.floor(Math.random() * y._subEmitters.length);
                            y._subEmitters[r].forEach((function(r) {
                                if (r.type === e.SubEmitterType.END) {
                                    var i = r.clone();
                                    t._inheritParticleInfoToSubEmitter(i),
                                    i.particleSystem._rootParticleSystem = y,
                                    y.activeSubSystems.push(i.particleSystem),
                                    i.particleSystem.start()
                                }
                            }
                            ))
                        }
                    }
                    ,
                    y._capacity = i,
                    y._epsilon = s,
                    y._isAnimationSheetEnabled = a,
                    y._scene = n || e.Engine.LastCreatedScene,
                    y._attachImageProcessingConfiguration(null),
                    y._customEffect = o,
                    y._scene.particleSystems.push(y),
                    y._useInstancing = y._scene.getEngine().getCaps().instancedArrays,
                    y._createIndexBuffer(),
                    y._createVertexBuffers(),
                    y.particleEmitterType = new e.BoxParticleEmitter,
                    y.updateFunction = function(t) {
                        var r = null
                          , i = null;
                        y.noiseTexture && (r = y.noiseTexture.getSize(),
                        i = y.noiseTexture.getContent());
                        for (var n, o = function() {
                            n = t[a];
                            var o = y._scaledUpdateSpeed
                              , s = n.age;
                            if (n.age += o,
                            n.age > n.lifeTime) {
                                var l = n.age - s;
                                o = (n.lifeTime - s) * o / l,
                                n.age = n.lifeTime
                            }
                            var c = n.age / n.lifeTime;
                            y._colorGradients && y._colorGradients.length > 0 ? e.Tools.GetCurrentGradient(c, y._colorGradients, (function(t, r, i) {
                                t !== n._currentColorGradient && (n._currentColor1.copyFrom(n._currentColor2),
                                r.getColorToRef(n._currentColor2),
                                n._currentColorGradient = t),
                                e.Color4.LerpToRef(n._currentColor1, n._currentColor2, i, n.color)
                            }
                            )) : (n.colorStep.scaleToRef(o, y._scaledColorStep),
                            n.color.addInPlace(y._scaledColorStep),
                            n.color.a < 0 && (n.color.a = 0)),
                            y._angularSpeedGradients && y._angularSpeedGradients.length > 0 && e.Tools.GetCurrentGradient(c, y._angularSpeedGradients, (function(t, r, i) {
                                t !== n._currentAngularSpeedGradient && (n._currentAngularSpeed1 = n._currentAngularSpeed2,
                                n._currentAngularSpeed2 = r.getFactor(),
                                n._currentAngularSpeedGradient = t),
                                n.angularSpeed = e.Scalar.Lerp(n._currentAngularSpeed1, n._currentAngularSpeed2, i)
                            }
                            )),
                            n.angle += n.angularSpeed * o;
                            var h = o;
                            if (y._velocityGradients && y._velocityGradients.length > 0 && e.Tools.GetCurrentGradient(c, y._velocityGradients, (function(t, r, i) {
                                t !== n._currentVelocityGradient && (n._currentVelocity1 = n._currentVelocity2,
                                n._currentVelocity2 = r.getFactor(),
                                n._currentVelocityGradient = t),
                                h *= e.Scalar.Lerp(n._currentVelocity1, n._currentVelocity2, i)
                            }
                            )),
                            n.direction.scaleToRef(h, y._scaledDirection),
                            y._limitVelocityGradients && y._limitVelocityGradients.length > 0 && e.Tools.GetCurrentGradient(c, y._limitVelocityGradients, (function(t, r, i) {
                                t !== n._currentLimitVelocityGradient && (n._currentLimitVelocity1 = n._currentLimitVelocity2,
                                n._currentLimitVelocity2 = r.getFactor(),
                                n._currentLimitVelocityGradient = t);
                                var o = e.Scalar.Lerp(n._currentLimitVelocity1, n._currentLimitVelocity2, i);
                                n.direction.length() > o && n.direction.scaleInPlace(y.limitVelocityDamping)
                            }
                            )),
                            y._dragGradients && y._dragGradients.length > 0 && e.Tools.GetCurrentGradient(c, y._dragGradients, (function(t, r, i) {
                                t !== n._currentDragGradient && (n._currentDrag1 = n._currentDrag2,
                                n._currentDrag2 = r.getFactor(),
                                n._currentDragGradient = t);
                                var o = e.Scalar.Lerp(n._currentDrag1, n._currentDrag2, i);
                                y._scaledDirection.scaleInPlace(1 - o)
                            }
                            )),
                            n.position.addInPlace(y._scaledDirection),
                            i && r) {
                                var u = y._fetchR(n._randomNoiseCoordinates1.x, n._randomNoiseCoordinates1.y, r.width, r.height, i)
                                  , d = y._fetchR(n._randomNoiseCoordinates1.z, n._randomNoiseCoordinates2.x, r.width, r.height, i)
                                  , x = y._fetchR(n._randomNoiseCoordinates2.y, n._randomNoiseCoordinates2.z, r.width, r.height, i)
                                  , p = e.Tmp.Vector3[0]
                                  , f = e.Tmp.Vector3[1];
                                p.copyFromFloats((2 * u - 1) * y.noiseStrength.x, (2 * d - 1) * y.noiseStrength.y, (2 * x - 1) * y.noiseStrength.z),
                                p.scaleToRef(o, f),
                                n.direction.addInPlace(f)
                            }
                            if (y.gravity.scaleToRef(o, y._scaledGravity),
                            n.direction.addInPlace(y._scaledGravity),
                            y._sizeGradients && y._sizeGradients.length > 0 && e.Tools.GetCurrentGradient(c, y._sizeGradients, (function(t, r, i) {
                                t !== n._currentSizeGradient && (n._currentSize1 = n._currentSize2,
                                n._currentSize2 = r.getFactor(),
                                n._currentSizeGradient = t),
                                n.size = e.Scalar.Lerp(n._currentSize1, n._currentSize2, i)
                            }
                            )),
                            y._useRampGradients && (y._colorRemapGradients && y._colorRemapGradients.length > 0 && e.Tools.GetCurrentGradient(c, y._colorRemapGradients, (function(t, r, i) {
                                var o = e.Scalar.Lerp(t.factor1, r.factor1, i)
                                  , a = e.Scalar.Lerp(t.factor2, r.factor2, i);
                                n.remapData.x = o,
                                n.remapData.y = a - o
                            }
                            )),
                            y._alphaRemapGradients && y._alphaRemapGradients.length > 0 && e.Tools.GetCurrentGradient(c, y._alphaRemapGradients, (function(t, r, i) {
                                var o = e.Scalar.Lerp(t.factor1, r.factor1, i)
                                  , a = e.Scalar.Lerp(t.factor2, r.factor2, i);
                                n.remapData.z = o,
                                n.remapData.w = a - o
                            }
                            ))),
                            y._isAnimationSheetEnabled && n.updateCellIndex(),
                            n._inheritParticleInfoToSubEmitters(),
                            n.age >= n.lifeTime)
                                return y._emitFromParticle(n),
                                n._attachedSubEmitters && (n._attachedSubEmitters.forEach((function(e) {
                                    e.particleSystem.disposeOnStop = !0,
                                    e.particleSystem.stop()
                                }
                                )),
                                n._attachedSubEmitters = null),
                                y.recycleParticle(n),
                                a--,
                                "continue"
                        }, a = 0; a < t.length; a++)
                            o()
                    }
                    ,
                    y
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "onDispose", {
                    set: function(e) {
                        this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver),
                        this._onDisposeObserver = this.onDisposeObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "useRampGradients", {
                    get: function() {
                        return this._useRampGradients
                    },
                    set: function(e) {
                        this._useRampGradients !== e && (this._useRampGradients = e,
                        this._resetEffect())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "particles", {
                    get: function() {
                        return this._particles
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getClassName = function() {
                    return "ParticleSystem"
                }
                ,
                r.prototype._addFactorGradient = function(t, r, i, n) {
                    var o = new e.FactorGradient;
                    o.gradient = r,
                    o.factor1 = i,
                    o.factor2 = n,
                    t.push(o),
                    t.sort((function(e, t) {
                        return e.gradient < t.gradient ? -1 : e.gradient > t.gradient ? 1 : 0
                    }
                    ))
                }
                ,
                r.prototype._removeFactorGradient = function(e, t) {
                    if (e)
                        for (var r = 0, i = 0, n = e; i < n.length; i++) {
                            if (n[i].gradient === t) {
                                e.splice(r, 1);
                                break
                            }
                            r++
                        }
                }
                ,
                r.prototype.addLifeTimeGradient = function(e, t, r) {
                    return this._lifeTimeGradients || (this._lifeTimeGradients = []),
                    this._addFactorGradient(this._lifeTimeGradients, e, t, r),
                    this
                }
                ,
                r.prototype.removeLifeTimeGradient = function(e) {
                    return this._removeFactorGradient(this._lifeTimeGradients, e),
                    this
                }
                ,
                r.prototype.addSizeGradient = function(e, t, r) {
                    return this._sizeGradients || (this._sizeGradients = []),
                    this._addFactorGradient(this._sizeGradients, e, t, r),
                    this
                }
                ,
                r.prototype.removeSizeGradient = function(e) {
                    return this._removeFactorGradient(this._sizeGradients, e),
                    this
                }
                ,
                r.prototype.addColorRemapGradient = function(e, t, r) {
                    return this._colorRemapGradients || (this._colorRemapGradients = []),
                    this._addFactorGradient(this._colorRemapGradients, e, t, r),
                    this
                }
                ,
                r.prototype.removeColorRemapGradient = function(e) {
                    return this._removeFactorGradient(this._colorRemapGradients, e),
                    this
                }
                ,
                r.prototype.addAlphaRemapGradient = function(e, t, r) {
                    return this._alphaRemapGradients || (this._alphaRemapGradients = []),
                    this._addFactorGradient(this._alphaRemapGradients, e, t, r),
                    this
                }
                ,
                r.prototype.removeAlphaRemapGradient = function(e) {
                    return this._removeFactorGradient(this._alphaRemapGradients, e),
                    this
                }
                ,
                r.prototype.addAngularSpeedGradient = function(e, t, r) {
                    return this._angularSpeedGradients || (this._angularSpeedGradients = []),
                    this._addFactorGradient(this._angularSpeedGradients, e, t, r),
                    this
                }
                ,
                r.prototype.removeAngularSpeedGradient = function(e) {
                    return this._removeFactorGradient(this._angularSpeedGradients, e),
                    this
                }
                ,
                r.prototype.addVelocityGradient = function(e, t, r) {
                    return this._velocityGradients || (this._velocityGradients = []),
                    this._addFactorGradient(this._velocityGradients, e, t, r),
                    this
                }
                ,
                r.prototype.removeVelocityGradient = function(e) {
                    return this._removeFactorGradient(this._velocityGradients, e),
                    this
                }
                ,
                r.prototype.addLimitVelocityGradient = function(e, t, r) {
                    return this._limitVelocityGradients || (this._limitVelocityGradients = []),
                    this._addFactorGradient(this._limitVelocityGradients, e, t, r),
                    this
                }
                ,
                r.prototype.removeLimitVelocityGradient = function(e) {
                    return this._removeFactorGradient(this._limitVelocityGradients, e),
                    this
                }
                ,
                r.prototype.addDragGradient = function(e, t, r) {
                    return this._dragGradients || (this._dragGradients = []),
                    this._addFactorGradient(this._dragGradients, e, t, r),
                    this
                }
                ,
                r.prototype.removeDragGradient = function(e) {
                    return this._removeFactorGradient(this._dragGradients, e),
                    this
                }
                ,
                r.prototype.addEmitRateGradient = function(e, t, r) {
                    return this._emitRateGradients || (this._emitRateGradients = []),
                    this._addFactorGradient(this._emitRateGradients, e, t, r),
                    this
                }
                ,
                r.prototype.removeEmitRateGradient = function(e) {
                    return this._removeFactorGradient(this._emitRateGradients, e),
                    this
                }
                ,
                r.prototype.addStartSizeGradient = function(e, t, r) {
                    return this._startSizeGradients || (this._startSizeGradients = []),
                    this._addFactorGradient(this._startSizeGradients, e, t, r),
                    this
                }
                ,
                r.prototype.removeStartSizeGradient = function(e) {
                    return this._removeFactorGradient(this._emitRateGradients, e),
                    this
                }
                ,
                r.prototype._createRampGradientTexture = function() {
                    if (this._rampGradients && this._rampGradients.length && !this._rampGradientsTexture) {
                        for (var t = new Uint8Array(4 * this._rawTextureWidth), r = e.Tmp.Color3[0], i = 0; i < this._rawTextureWidth; i++) {
                            var n = i / this._rawTextureWidth;
                            e.Tools.GetCurrentGradient(n, this._rampGradients, (function(n, o, a) {
                                e.Color3.LerpToRef(n.color, o.color, a, r),
                                t[4 * i] = 255 * r.r,
                                t[4 * i + 1] = 255 * r.g,
                                t[4 * i + 2] = 255 * r.b,
                                t[4 * i + 3] = 255
                            }
                            ))
                        }
                        this._rampGradientsTexture = e.RawTexture.CreateRGBATexture(t, this._rawTextureWidth, 1, this._scene, !1, !1, e.Texture.NEAREST_SAMPLINGMODE)
                    }
                }
                ,
                r.prototype.getRampGradients = function() {
                    return this._rampGradients
                }
                ,
                r.prototype.addRampGradient = function(t, r) {
                    this._rampGradients || (this._rampGradients = []);
                    var i = new e.Color3Gradient;
                    return i.gradient = t,
                    i.color = r,
                    this._rampGradients.push(i),
                    this._rampGradients.sort((function(e, t) {
                        return e.gradient < t.gradient ? -1 : e.gradient > t.gradient ? 1 : 0
                    }
                    )),
                    this._rampGradientsTexture && (this._rampGradientsTexture.dispose(),
                    this._rampGradientsTexture = null),
                    this._createRampGradientTexture(),
                    this
                }
                ,
                r.prototype.removeRampGradient = function(e) {
                    return this._removeGradientAndTexture(e, this._rampGradients, this._rampGradientsTexture),
                    this._rampGradientsTexture = null,
                    this._rampGradients && this._rampGradients.length > 0 && this._createRampGradientTexture(),
                    this
                }
                ,
                r.prototype.addColorGradient = function(t, r, i) {
                    this._colorGradients || (this._colorGradients = []);
                    var n = new e.ColorGradient;
                    return n.gradient = t,
                    n.color1 = r,
                    n.color2 = i,
                    this._colorGradients.push(n),
                    this._colorGradients.sort((function(e, t) {
                        return e.gradient < t.gradient ? -1 : e.gradient > t.gradient ? 1 : 0
                    }
                    )),
                    this
                }
                ,
                r.prototype.removeColorGradient = function(e) {
                    if (!this._colorGradients)
                        return this;
                    for (var t = 0, r = 0, i = this._colorGradients; r < i.length; r++) {
                        if (i[r].gradient === e) {
                            this._colorGradients.splice(t, 1);
                            break
                        }
                        t++
                    }
                    return this
                }
                ,
                r.prototype._fetchR = function(e, t, r, i, n) {
                    return n[4 * (((e = .5 * Math.abs(e) + .5) * r % r | 0) + ((t = .5 * Math.abs(t) + .5) * i % i | 0) * r)] / 255
                }
                ,
                r.prototype._reset = function() {
                    this._resetEffect()
                }
                ,
                r.prototype._resetEffect = function() {
                    this._vertexBuffer && (this._vertexBuffer.dispose(),
                    this._vertexBuffer = null),
                    this._spriteBuffer && (this._spriteBuffer.dispose(),
                    this._spriteBuffer = null),
                    this._createVertexBuffers()
                }
                ,
                r.prototype._createVertexBuffers = function() {
                    this._vertexBufferSize = this._useInstancing ? 10 : 12,
                    this._isAnimationSheetEnabled && (this._vertexBufferSize += 1),
                    this._isBillboardBased && this.billboardMode !== r.BILLBOARDMODE_STRETCHED || (this._vertexBufferSize += 3),
                    this._useRampGradients && (this._vertexBufferSize += 4);
                    var t = this._scene.getEngine();
                    this._vertexData = new Float32Array(this._capacity * this._vertexBufferSize * (this._useInstancing ? 1 : 4)),
                    this._vertexBuffer = new e.Buffer(t,this._vertexData,!0,this._vertexBufferSize);
                    var i = 0
                      , n = this._vertexBuffer.createVertexBuffer(e.VertexBuffer.PositionKind, i, 3, this._vertexBufferSize, this._useInstancing);
                    this._vertexBuffers[e.VertexBuffer.PositionKind] = n,
                    i += 3;
                    var o = this._vertexBuffer.createVertexBuffer(e.VertexBuffer.ColorKind, i, 4, this._vertexBufferSize, this._useInstancing);
                    this._vertexBuffers[e.VertexBuffer.ColorKind] = o,
                    i += 4;
                    var a = this._vertexBuffer.createVertexBuffer("angle", i, 1, this._vertexBufferSize, this._useInstancing);
                    this._vertexBuffers.angle = a,
                    i += 1;
                    var s, y = this._vertexBuffer.createVertexBuffer("size", i, 2, this._vertexBufferSize, this._useInstancing);
                    if (this._vertexBuffers.size = y,
                    i += 2,
                    this._isAnimationSheetEnabled) {
                        var l = this._vertexBuffer.createVertexBuffer("cellIndex", i, 1, this._vertexBufferSize, this._useInstancing);
                        this._vertexBuffers.cellIndex = l,
                        i += 1
                    }
                    if (!this._isBillboardBased || this.billboardMode === r.BILLBOARDMODE_STRETCHED) {
                        var c = this._vertexBuffer.createVertexBuffer("direction", i, 3, this._vertexBufferSize, this._useInstancing);
                        this._vertexBuffers.direction = c,
                        i += 3
                    }
                    if (this._useRampGradients) {
                        var h = this._vertexBuffer.createVertexBuffer("remapData", i, 4, this._vertexBufferSize, this._useInstancing);
                        this._vertexBuffers.remapData = h,
                        i += 4
                    }
                    if (this._useInstancing) {
                        var u = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]);
                        this._spriteBuffer = new e.Buffer(t,u,!1,2),
                        s = this._spriteBuffer.createVertexBuffer("offset", 0, 2)
                    } else
                        s = this._vertexBuffer.createVertexBuffer("offset", i, 2, this._vertexBufferSize, this._useInstancing),
                        i += 2;
                    this._vertexBuffers.offset = s
                }
                ,
                r.prototype._createIndexBuffer = function() {
                    if (!this._useInstancing) {
                        for (var e = [], t = 0, r = 0; r < this._capacity; r++)
                            e.push(t),
                            e.push(t + 1),
                            e.push(t + 2),
                            e.push(t),
                            e.push(t + 2),
                            e.push(t + 3),
                            t += 4;
                        this._indexBuffer = this._scene.getEngine().createIndexBuffer(e)
                    }
                }
                ,
                r.prototype.getCapacity = function() {
                    return this._capacity
                }
                ,
                r.prototype.isAlive = function() {
                    return this._alive
                }
                ,
                r.prototype.isStarted = function() {
                    return this._started
                }
                ,
                r.prototype._prepareSubEmitterInternalArray = function() {
                    var t = this;
                    this._subEmitters = new Array,
                    this.subEmitters && this.subEmitters.forEach((function(i) {
                        i instanceof r ? t._subEmitters.push([new e.SubEmitter(i)]) : i instanceof e.SubEmitter ? t._subEmitters.push([i]) : i instanceof Array && t._subEmitters.push(i)
                    }
                    ))
                }
                ,
                r.prototype.start = function(t) {
                    var r = this;
                    if (void 0 === t && (t = this.startDelay),
                    !this.targetStopDuration && this._hasTargetStopDurationDependantGradient())
                        throw "Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";
                    if (t)
                        setTimeout((function() {
                            r.start(0)
                        }
                        ), t);
                    else {
                        if (this._prepareSubEmitterInternalArray(),
                        this._started = !0,
                        this._stopped = !1,
                        this._actualFrame = 0,
                        this._subEmitters && 0 != this._subEmitters.length && (this.activeSubSystems = new Array),
                        this._emitRateGradients && (this._emitRateGradients.length > 0 && (this._currentEmitRateGradient = this._emitRateGradients[0],
                        this._currentEmitRate1 = this._currentEmitRateGradient.getFactor(),
                        this._currentEmitRate2 = this._currentEmitRate1),
                        this._emitRateGradients.length > 1 && (this._currentEmitRate2 = this._emitRateGradients[1].getFactor())),
                        this._startSizeGradients && (this._startSizeGradients.length > 0 && (this._currentStartSizeGradient = this._startSizeGradients[0],
                        this._currentStartSize1 = this._currentStartSizeGradient.getFactor(),
                        this._currentStartSize2 = this._currentStartSize1),
                        this._startSizeGradients.length > 1 && (this._currentStartSize2 = this._startSizeGradients[1].getFactor())),
                        this.preWarmCycles) {
                            this.emitter instanceof e.AbstractMesh && this.emitter.computeWorldMatrix(!0);
                            var i = this.noiseTexture;
                            if (i && i.onGeneratedObservable)
                                i.onGeneratedObservable.addOnce((function() {
                                    setTimeout((function() {
                                        for (var e = 0; e < r.preWarmCycles; e++)
                                            r.animate(!0),
                                            i.render()
                                    }
                                    ))
                                }
                                ));
                            else
                                for (var n = 0; n < this.preWarmCycles; n++)
                                    this.animate(!0)
                        }
                        this.beginAnimationOnStart && this.animations && this.animations.length > 0 && this.getScene().beginAnimation(this, this.beginAnimationFrom, this.beginAnimationTo, this.beginAnimationLoop)
                    }
                }
                ,
                r.prototype.stop = function(e) {
                    void 0 === e && (e = !0),
                    this._stopped = !0,
                    e && this._stopSubEmitters()
                }
                ,
                r.prototype.reset = function() {
                    this._stockParticles = [],
                    this._particles = []
                }
                ,
                r.prototype._appendParticleVertex = function(e, t, i, n) {
                    var o = e * this._vertexBufferSize;
                    this._vertexData[o++] = t.position.x,
                    this._vertexData[o++] = t.position.y,
                    this._vertexData[o++] = t.position.z,
                    this._vertexData[o++] = t.color.r,
                    this._vertexData[o++] = t.color.g,
                    this._vertexData[o++] = t.color.b,
                    this._vertexData[o++] = t.color.a,
                    this._vertexData[o++] = t.angle,
                    this._vertexData[o++] = t.scale.x * t.size,
                    this._vertexData[o++] = t.scale.y * t.size,
                    this._isAnimationSheetEnabled && (this._vertexData[o++] = t.cellIndex),
                    this._isBillboardBased ? this.billboardMode === r.BILLBOARDMODE_STRETCHED && (this._vertexData[o++] = t.direction.x,
                    this._vertexData[o++] = t.direction.y,
                    this._vertexData[o++] = t.direction.z) : t._initialDirection ? (this._vertexData[o++] = t._initialDirection.x,
                    this._vertexData[o++] = t._initialDirection.y,
                    this._vertexData[o++] = t._initialDirection.z) : (this._vertexData[o++] = t.direction.x,
                    this._vertexData[o++] = t.direction.y,
                    this._vertexData[o++] = t.direction.z),
                    this._useRampGradients && (this._vertexData[o++] = t.remapData.x,
                    this._vertexData[o++] = t.remapData.y,
                    this._vertexData[o++] = t.remapData.z,
                    this._vertexData[o++] = t.remapData.w),
                    this._useInstancing || (this._isAnimationSheetEnabled && (0 === i ? i = this._epsilon : 1 === i && (i = 1 - this._epsilon),
                    0 === n ? n = this._epsilon : 1 === n && (n = 1 - this._epsilon)),
                    this._vertexData[o++] = i,
                    this._vertexData[o++] = n)
                }
                ,
                r.prototype._stopSubEmitters = function() {
                    this.activeSubSystems && (this.activeSubSystems.forEach((function(e) {
                        e.stop(!0)
                    }
                    )),
                    this.activeSubSystems = new Array)
                }
                ,
                r.prototype._removeFromRoot = function() {
                    if (this._rootParticleSystem) {
                        var e = this._rootParticleSystem.activeSubSystems.indexOf(this);
                        -1 !== e && this._rootParticleSystem.activeSubSystems.splice(e, 1),
                        this._rootParticleSystem = null
                    }
                }
                ,
                r.prototype._update = function(t) {
                    var r, i = this;
                    if (this._alive = this._particles.length > 0,
                    this.emitter.position) {
                        var n = this.emitter;
                        this._emitterWorldMatrix = n.getWorldMatrix()
                    } else {
                        var o = this.emitter;
                        this._emitterWorldMatrix = e.Matrix.Translation(o.x, o.y, o.z)
                    }
                    this.updateFunction(this._particles);
                    for (var a, s = function() {
                        if (y._particles.length === y._capacity)
                            return "break";
                        r = y._createParticle(),
                        y._particles.push(r);
                        var t = e.Scalar.RandomRange(y.minEmitPower, y.maxEmitPower);
                        if (y.startPositionFunction ? y.startPositionFunction(y._emitterWorldMatrix, r.position, r) : y.particleEmitterType.startPositionFunction(y._emitterWorldMatrix, r.position, r),
                        y.startDirectionFunction ? y.startDirectionFunction(y._emitterWorldMatrix, r.direction, r) : y.particleEmitterType.startDirectionFunction(y._emitterWorldMatrix, r.direction, r),
                        0 === t ? r._initialDirection ? r._initialDirection.copyFrom(r.direction) : r._initialDirection = r.direction.clone() : r._initialDirection = null,
                        r.direction.scaleInPlace(t),
                        y.targetStopDuration && y._lifeTimeGradients && y._lifeTimeGradients.length > 0) {
                            var n = e.Scalar.Clamp(y._actualFrame / y.targetStopDuration);
                            e.Tools.GetCurrentGradient(n, y._lifeTimeGradients, (function(t, i, o) {
                                var a = t
                                  , s = i
                                  , y = a.getFactor()
                                  , l = s.getFactor()
                                  , c = (n - a.gradient) / (s.gradient - a.gradient);
                                r.lifeTime = e.Scalar.Lerp(y, l, c)
                            }
                            ))
                        } else
                            r.lifeTime = e.Scalar.RandomRange(y.minLifeTime, y.maxLifeTime);
                        if (y._sizeGradients && 0 !== y._sizeGradients.length ? (r._currentSizeGradient = y._sizeGradients[0],
                        r._currentSize1 = r._currentSizeGradient.getFactor(),
                        r.size = r._currentSize1,
                        y._sizeGradients.length > 1 ? r._currentSize2 = y._sizeGradients[1].getFactor() : r._currentSize2 = r._currentSize1) : r.size = e.Scalar.RandomRange(y.minSize, y.maxSize),
                        r.scale.copyFromFloats(e.Scalar.RandomRange(y.minScaleX, y.maxScaleX), e.Scalar.RandomRange(y.minScaleY, y.maxScaleY)),
                        y._startSizeGradients && y._startSizeGradients[0] && y.targetStopDuration) {
                            var o = y._actualFrame / y.targetStopDuration;
                            e.Tools.GetCurrentGradient(o, y._startSizeGradients, (function(t, n, o) {
                                t !== i._currentStartSizeGradient && (i._currentStartSize1 = i._currentStartSize2,
                                i._currentStartSize2 = n.getFactor(),
                                i._currentStartSizeGradient = t);
                                var a = e.Scalar.Lerp(i._currentStartSize1, i._currentStartSize2, o);
                                r.scale.scaleInPlace(a)
                            }
                            ))
                        }
                        y._angularSpeedGradients && 0 !== y._angularSpeedGradients.length ? (r._currentAngularSpeedGradient = y._angularSpeedGradients[0],
                        r.angularSpeed = r._currentAngularSpeedGradient.getFactor(),
                        r._currentAngularSpeed1 = r.angularSpeed,
                        y._angularSpeedGradients.length > 1 ? r._currentAngularSpeed2 = y._angularSpeedGradients[1].getFactor() : r._currentAngularSpeed2 = r._currentAngularSpeed1) : r.angularSpeed = e.Scalar.RandomRange(y.minAngularSpeed, y.maxAngularSpeed),
                        r.angle = e.Scalar.RandomRange(y.minInitialRotation, y.maxInitialRotation),
                        y._velocityGradients && y._velocityGradients.length > 0 && (r._currentVelocityGradient = y._velocityGradients[0],
                        r._currentVelocity1 = r._currentVelocityGradient.getFactor(),
                        y._velocityGradients.length > 1 ? r._currentVelocity2 = y._velocityGradients[1].getFactor() : r._currentVelocity2 = r._currentVelocity1),
                        y._limitVelocityGradients && y._limitVelocityGradients.length > 0 && (r._currentLimitVelocityGradient = y._limitVelocityGradients[0],
                        r._currentLimitVelocity1 = r._currentLimitVelocityGradient.getFactor(),
                        y._limitVelocityGradients.length > 1 ? r._currentLimitVelocity2 = y._limitVelocityGradients[1].getFactor() : r._currentLimitVelocity2 = r._currentLimitVelocity1),
                        y._dragGradients && y._dragGradients.length > 0 && (r._currentDragGradient = y._dragGradients[0],
                        r._currentDrag1 = r._currentDragGradient.getFactor(),
                        y._dragGradients.length > 1 ? r._currentDrag2 = y._dragGradients[1].getFactor() : r._currentDrag2 = r._currentDrag1),
                        y._colorGradients && 0 !== y._colorGradients.length ? (r._currentColorGradient = y._colorGradients[0],
                        r._currentColorGradient.getColorToRef(r.color),
                        r._currentColor1.copyFrom(r.color),
                        y._colorGradients.length > 1 ? y._colorGradients[1].getColorToRef(r._currentColor2) : r._currentColor2.copyFrom(r.color)) : (a = e.Scalar.RandomRange(0, 1),
                        e.Color4.LerpToRef(y.color1, y.color2, a, r.color),
                        y.colorDead.subtractToRef(r.color, y._colorDiff),
                        y._colorDiff.scaleToRef(1 / r.lifeTime, r.colorStep)),
                        y._isAnimationSheetEnabled && (r._initialStartSpriteCellID = y.startSpriteCellID,
                        r._initialEndSpriteCellID = y.endSpriteCellID),
                        r.direction.addInPlace(y._inheritedVelocityOffset),
                        y._useRampGradients && (r.remapData = new e.Vector4(0,1,0,1)),
                        y.noiseTexture && (r._randomNoiseCoordinates1 ? (r._randomNoiseCoordinates1.copyFromFloats(Math.random(), Math.random(), Math.random()),
                        r._randomNoiseCoordinates2.copyFromFloats(Math.random(), Math.random(), Math.random())) : (r._randomNoiseCoordinates1 = new e.Vector3(Math.random(),Math.random(),Math.random()),
                        r._randomNoiseCoordinates2 = new e.Vector3(Math.random(),Math.random(),Math.random()))),
                        r._inheritParticleInfoToSubEmitters()
                    }, y = this, l = 0; l < t; l++) {
                        if ("break" === s())
                            break
                    }
                }
                ,
                r._GetAttributeNamesOrOptions = function(t, r, i) {
                    void 0 === t && (t = !1),
                    void 0 === r && (r = !1),
                    void 0 === i && (i = !1);
                    var n = [e.VertexBuffer.PositionKind, e.VertexBuffer.ColorKind, "angle", "offset", "size"];
                    return t && n.push("cellIndex"),
                    r || n.push("direction"),
                    i && n.push("remapData"),
                    n
                }
                ,
                r._GetEffectCreationOptions = function(e) {
                    void 0 === e && (e = !1);
                    var t = ["invView", "view", "projection", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "textureMask", "translationPivot", "eyePosition"];
                    return e && t.push("particlesInfos"),
                    t
                }
                ,
                r.prototype._getEffect = function(t) {
                    if (this._customEffect)
                        return this._customEffect;
                    var i = [];
                    if (this._scene.clipPlane && i.push("#define CLIPPLANE"),
                    this._scene.clipPlane2 && i.push("#define CLIPPLANE2"),
                    this._scene.clipPlane3 && i.push("#define CLIPPLANE3"),
                    this._scene.clipPlane4 && i.push("#define CLIPPLANE4"),
                    this._isAnimationSheetEnabled && i.push("#define ANIMATESHEET"),
                    t === r.BLENDMODE_MULTIPLY && i.push("#define BLENDMULTIPLYMODE"),
                    this._useRampGradients && i.push("#define RAMPGRADIENT"),
                    this._isBillboardBased)
                        switch (i.push("#define BILLBOARD"),
                        this.billboardMode) {
                        case r.BILLBOARDMODE_Y:
                            i.push("#define BILLBOARDY");
                            break;
                        case r.BILLBOARDMODE_STRETCHED:
                            i.push("#define BILLBOARDSTRETCHED");
                            break;
                        case r.BILLBOARDMODE_ALL:
                        }
                    this._imageProcessingConfiguration && (this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),
                    i.push(this._imageProcessingConfigurationDefines.toString()));
                    var n = i.join("\n");
                    if (this._cachedDefines !== n) {
                        this._cachedDefines = n;
                        var o = r._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled, this._isBillboardBased && this.billboardMode !== r.BILLBOARDMODE_STRETCHED, this._useRampGradients)
                          , a = r._GetEffectCreationOptions(this._isAnimationSheetEnabled)
                          , s = ["diffuseSampler", "rampSampler"];
                        e.ImageProcessingConfiguration && (e.ImageProcessingConfiguration.PrepareUniforms(a, this._imageProcessingConfigurationDefines),
                        e.ImageProcessingConfiguration.PrepareSamplers(s, this._imageProcessingConfigurationDefines)),
                        this._effect = this._scene.getEngine().createEffect("particles", o, a, s, n)
                    }
                    return this._effect
                }
                ,
                r.prototype.animate = function(t) {
                    var r = this;
                    if (void 0 === t && (t = !1),
                    this._started) {
                        if (!t) {
                            if (!this.isReady())
                                return;
                            if (this._currentRenderId === this._scene.getRenderId())
                                return;
                            this._currentRenderId = this._scene.getRenderId()
                        }
                        var i;
                        if (this._scaledUpdateSpeed = this.updateSpeed * (t ? this.preWarmStepOffset : this._scene.getAnimationRatio()),
                        this.manualEmitCount > -1)
                            i = this.manualEmitCount,
                            this._newPartsExcess = 0,
                            this.manualEmitCount = 0;
                        else {
                            var n = this.emitRate;
                            if (this._emitRateGradients && this._emitRateGradients.length > 0 && this.targetStopDuration) {
                                var o = this._actualFrame / this.targetStopDuration;
                                e.Tools.GetCurrentGradient(o, this._emitRateGradients, (function(t, i, o) {
                                    t !== r._currentEmitRateGradient && (r._currentEmitRate1 = r._currentEmitRate2,
                                    r._currentEmitRate2 = i.getFactor(),
                                    r._currentEmitRateGradient = t),
                                    n = e.Scalar.Lerp(r._currentEmitRate1, r._currentEmitRate2, o)
                                }
                                ))
                            }
                            i = n * this._scaledUpdateSpeed >> 0,
                            this._newPartsExcess += n * this._scaledUpdateSpeed - i
                        }
                        if (this._newPartsExcess > 1 && (i += this._newPartsExcess >> 0,
                        this._newPartsExcess -= this._newPartsExcess >> 0),
                        this._alive = !1,
                        this._stopped ? i = 0 : (this._actualFrame += this._scaledUpdateSpeed,
                        this.targetStopDuration && this._actualFrame >= this.targetStopDuration && this.stop()),
                        this._update(i),
                        this._stopped && (this._alive || (this._started = !1,
                        this.onAnimationEnd && this.onAnimationEnd(),
                        this.disposeOnStop && this._scene._toBeDisposed.push(this))),
                        !t) {
                            for (var a = 0, s = 0; s < this._particles.length; s++) {
                                var y = this._particles[s];
                                this._appendParticleVertices(a, y),
                                a += this._useInstancing ? 1 : 4
                            }
                            this._vertexBuffer && this._vertexBuffer.update(this._vertexData)
                        }
                        0 === this.manualEmitCount && this.disposeOnStop && this.stop()
                    }
                }
                ,
                r.prototype._appendParticleVertices = function(e, t) {
                    this._appendParticleVertex(e++, t, 0, 0),
                    this._useInstancing || (this._appendParticleVertex(e++, t, 1, 0),
                    this._appendParticleVertex(e++, t, 1, 1),
                    this._appendParticleVertex(e++, t, 0, 1))
                }
                ,
                r.prototype.rebuild = function() {
                    this._createIndexBuffer(),
                    this._vertexBuffer && this._vertexBuffer._rebuild()
                }
                ,
                r.prototype.isReady = function() {
                    if (!(this.emitter && this._imageProcessingConfiguration.isReady() && this.particleTexture && this.particleTexture.isReady()))
                        return !1;
                    if (this.blendMode !== r.BLENDMODE_MULTIPLYADD) {
                        if (!this._getEffect(this.blendMode).isReady())
                            return !1
                    } else {
                        if (!this._getEffect(r.BLENDMODE_MULTIPLY).isReady())
                            return !1;
                        if (!this._getEffect(r.BLENDMODE_ADD).isReady())
                            return !1
                    }
                    return !0
                }
                ,
                r.prototype._render = function(t) {
                    var i = this._getEffect(t)
                      , n = this._scene.getEngine();
                    n.enableEffect(i);
                    var o = this._scene.getViewMatrix();
                    if (i.setTexture("diffuseSampler", this.particleTexture),
                    i.setMatrix("view", o),
                    i.setMatrix("projection", this._scene.getProjectionMatrix()),
                    this._isAnimationSheetEnabled && this.particleTexture) {
                        var a = this.particleTexture.getBaseSize();
                        i.setFloat3("particlesInfos", this.spriteCellWidth / a.width, this.spriteCellHeight / a.height, a.width / this.spriteCellWidth)
                    }
                    if (i.setVector2("translationPivot", this.translationPivot),
                    i.setFloat4("textureMask", this.textureMask.r, this.textureMask.g, this.textureMask.b, this.textureMask.a),
                    this._isBillboardBased) {
                        var s = this._scene.activeCamera;
                        i.setVector3("eyePosition", s.globalPosition)
                    }
                    if (this._rampGradientsTexture && i.setTexture("rampSampler", this._rampGradientsTexture),
                    this._scene.clipPlane || this._scene.clipPlane2 || this._scene.clipPlane3 || this._scene.clipPlane4) {
                        var y = o.clone();
                        y.invert(),
                        i.setMatrix("invView", y),
                        e.MaterialHelper.BindClipPlane(i, this._scene)
                    }
                    switch (n.bindBuffers(this._vertexBuffers, this._indexBuffer, i),
                    this._imageProcessingConfiguration && !this._imageProcessingConfiguration.applyByPostProcess && this._imageProcessingConfiguration.bind(i),
                    t) {
                    case r.BLENDMODE_ADD:
                        n.setAlphaMode(e.Engine.ALPHA_ADD);
                        break;
                    case r.BLENDMODE_ONEONE:
                        n.setAlphaMode(e.Engine.ALPHA_ONEONE);
                        break;
                    case r.BLENDMODE_STANDARD:
                        n.setAlphaMode(e.Engine.ALPHA_COMBINE);
                        break;
                    case r.BLENDMODE_MULTIPLY:
                        n.setAlphaMode(e.Engine.ALPHA_MULTIPLY)
                    }
                    return this._useInstancing ? n.drawArraysType(e.Material.TriangleFanDrawMode, 0, 4, this._particles.length) : n.drawElementsType(e.Material.TriangleFillMode, 0, 6 * this._particles.length),
                    this._particles.length
                }
                ,
                r.prototype.render = function() {
                    if (!this.isReady() || !this._particles.length)
                        return 0;
                    var t = this._scene.getEngine();
                    t.setState(!1),
                    this.forceDepthWrite && t.setDepthWrite(!0);
                    var i = 0;
                    return this.blendMode === r.BLENDMODE_MULTIPLYADD && (i = this._render(r.BLENDMODE_MULTIPLY) + this._render(r.BLENDMODE_ADD)),
                    i = this._render(this.blendMode),
                    t.unbindInstanceAttributes(),
                    t.setAlphaMode(e.Engine.ALPHA_DISABLE),
                    i
                }
                ,
                r.prototype.dispose = function(e) {
                    if (void 0 === e && (e = !0),
                    this._vertexBuffer && (this._vertexBuffer.dispose(),
                    this._vertexBuffer = null),
                    this._spriteBuffer && (this._spriteBuffer.dispose(),
                    this._spriteBuffer = null),
                    this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer),
                    this._indexBuffer = null),
                    e && this.particleTexture && (this.particleTexture.dispose(),
                    this.particleTexture = null),
                    e && this.noiseTexture && (this.noiseTexture.dispose(),
                    this.noiseTexture = null),
                    this._rampGradientsTexture && (this._rampGradientsTexture.dispose(),
                    this._rampGradientsTexture = null),
                    this._removeFromRoot(),
                    this._subEmitters && this._subEmitters.length) {
                        for (var t = 0; t < this._subEmitters.length; t++)
                            for (var r = 0, i = this._subEmitters[t]; r < i.length; r++) {
                                i[r].dispose()
                            }
                        this._subEmitters = [],
                        this.subEmitters = []
                    }
                    this._disposeEmitterOnDispose && this.emitter && this.emitter.dispose && this.emitter.dispose(!0),
                    (t = this._scene.particleSystems.indexOf(this)) > -1 && this._scene.particleSystems.splice(t, 1),
                    this._scene._activeParticleSystems.dispose(),
                    this.onDisposeObservable.notifyObservers(this),
                    this.onDisposeObservable.clear(),
                    this.reset()
                }
                ,
                r.prototype.clone = function(t, i) {
                    var n = null
                      , o = null;
                    if (null != this.customShader) {
                        var a = (o = this.customShader).shaderOptions.defines.length > 0 ? o.shaderOptions.defines.join("\n") : "";
                        n = this._scene.getEngine().createEffectForParticles(o.shaderPath.fragmentElement, o.shaderOptions.uniforms, o.shaderOptions.samplers, a)
                    } else
                        this._customEffect && (n = this._customEffect);
                    var s = new r(t,this._capacity,this._scene,n);
                    return s.customShader = o,
                    e.Tools.DeepCopy(this, s, ["particles", "customShader", "noiseTexture"]),
                    void 0 === i && (i = this.emitter),
                    s.noiseTexture = this.noiseTexture,
                    s.emitter = i,
                    this.particleTexture && (s.particleTexture = new e.Texture(this.particleTexture.url,this._scene)),
                    this._colorGradients && this._colorGradients.forEach((function(e) {
                        s.addColorGradient(e.gradient, e.color1, e.color2)
                    }
                    )),
                    this._dragGradients && this._dragGradients.forEach((function(e) {
                        s.addDragGradient(e.gradient, e.factor1, e.factor2)
                    }
                    )),
                    this._angularSpeedGradients && this._angularSpeedGradients.forEach((function(e) {
                        s.addAngularSpeedGradient(e.gradient, e.factor1, e.factor2)
                    }
                    )),
                    this._emitRateGradients && this._emitRateGradients.forEach((function(e) {
                        s.addEmitRateGradient(e.gradient, e.factor1, e.factor2)
                    }
                    )),
                    this._lifeTimeGradients && this._lifeTimeGradients.forEach((function(e) {
                        s.addLifeTimeGradient(e.gradient, e.factor1, e.factor2)
                    }
                    )),
                    this._limitVelocityGradients && this._limitVelocityGradients.forEach((function(e) {
                        s.addLimitVelocityGradient(e.gradient, e.factor1, e.factor2)
                    }
                    )),
                    this._sizeGradients && this._sizeGradients.forEach((function(e) {
                        s.addSizeGradient(e.gradient, e.factor1, e.factor2)
                    }
                    )),
                    this._startSizeGradients && this._startSizeGradients.forEach((function(e) {
                        s.addStartSizeGradient(e.gradient, e.factor1, e.factor2)
                    }
                    )),
                    this._velocityGradients && this._velocityGradients.forEach((function(e) {
                        s.addVelocityGradient(e.gradient, e.factor1, e.factor2)
                    }
                    )),
                    this._rampGradients && this._rampGradients.forEach((function(e) {
                        s.addRampGradient(e.gradient, e.color)
                    }
                    )),
                    this._colorRemapGradients && this._colorRemapGradients.forEach((function(e) {
                        s.addColorRemapGradient(e.gradient, e.factor1, e.factor2)
                    }
                    )),
                    this._alphaRemapGradients && this._alphaRemapGradients.forEach((function(e) {
                        s.addAlphaRemapGradient(e.gradient, e.factor1, e.factor2)
                    }
                    )),
                    this.preventAutoStart || s.start(),
                    s
                }
                ,
                r.prototype.serialize = function() {
                    var e = {};
                    if (r._Serialize(e, this),
                    e.textureMask = this.textureMask.asArray(),
                    e.customShader = this.customShader,
                    e.preventAutoStart = this.preventAutoStart,
                    this.subEmitters) {
                        e.subEmitters = [],
                        this._subEmitters || this._prepareSubEmitterInternalArray();
                        for (var t = 0, i = this._subEmitters; t < i.length; t++) {
                            for (var n = [], o = 0, a = i[t]; o < a.length; o++) {
                                var s = a[o];
                                n.push(s.serialize())
                            }
                            e.subEmitters.push(n)
                        }
                    }
                    return e
                }
                ,
                r._Serialize = function(t, r) {
                    if (t.name = r.name,
                    t.id = r.id,
                    t.capacity = r.getCapacity(),
                    r.emitter.position) {
                        var i = r.emitter;
                        t.emitterId = i.id
                    } else {
                        var n = r.emitter;
                        t.emitter = n.asArray()
                    }
                    r.particleEmitterType && (t.particleEmitterType = r.particleEmitterType.serialize()),
                    r.particleTexture && (t.textureName = r.particleTexture.name,
                    t.invertY = r.particleTexture._invertY),
                    e.Animation.AppendSerializedAnimations(r, t),
                    t.beginAnimationOnStart = r.beginAnimationOnStart,
                    t.beginAnimationFrom = r.beginAnimationFrom,
                    t.beginAnimationTo = r.beginAnimationTo,
                    t.beginAnimationLoop = r.beginAnimationLoop,
                    t.startDelay = r.startDelay,
                    t.renderingGroupId = r.renderingGroupId,
                    t.isBillboardBased = r.isBillboardBased,
                    t.billboardMode = r.billboardMode,
                    t.minAngularSpeed = r.minAngularSpeed,
                    t.maxAngularSpeed = r.maxAngularSpeed,
                    t.minSize = r.minSize,
                    t.maxSize = r.maxSize,
                    t.minScaleX = r.minScaleX,
                    t.maxScaleX = r.maxScaleX,
                    t.minScaleY = r.minScaleY,
                    t.maxScaleY = r.maxScaleY,
                    t.minEmitPower = r.minEmitPower,
                    t.maxEmitPower = r.maxEmitPower,
                    t.minLifeTime = r.minLifeTime,
                    t.maxLifeTime = r.maxLifeTime,
                    t.emitRate = r.emitRate,
                    t.gravity = r.gravity.asArray(),
                    t.noiseStrength = r.noiseStrength.asArray(),
                    t.color1 = r.color1.asArray(),
                    t.color2 = r.color2.asArray(),
                    t.colorDead = r.colorDead.asArray(),
                    t.updateSpeed = r.updateSpeed,
                    t.targetStopDuration = r.targetStopDuration,
                    t.blendMode = r.blendMode,
                    t.preWarmCycles = r.preWarmCycles,
                    t.preWarmStepOffset = r.preWarmStepOffset,
                    t.minInitialRotation = r.minInitialRotation,
                    t.maxInitialRotation = r.maxInitialRotation,
                    t.startSpriteCellID = r.startSpriteCellID,
                    t.endSpriteCellID = r.endSpriteCellID,
                    t.spriteCellChangeSpeed = r.spriteCellChangeSpeed,
                    t.spriteCellWidth = r.spriteCellWidth,
                    t.spriteCellHeight = r.spriteCellHeight,
                    t.spriteRandomStartCell = r.spriteRandomStartCell,
                    t.isAnimationSheetEnabled = r.isAnimationSheetEnabled;
                    var o = r.getColorGradients();
                    if (o) {
                        t.colorGradients = [];
                        for (var a = 0, s = o; a < s.length; a++) {
                            var y = s[a]
                              , l = {
                                gradient: y.gradient,
                                color1: y.color1.asArray()
                            };
                            y.color2 && (l.color2 = y.color2.asArray()),
                            t.colorGradients.push(l)
                        }
                    }
                    var c = r.getRampGradients();
                    if (c) {
                        t.rampGradients = [];
                        for (var h = 0, u = c; h < u.length; h++) {
                            var d = u[h];
                            l = {
                                gradient: d.gradient,
                                color: d.color.asArray()
                            };
                            t.rampGradients.push(l)
                        }
                        t.useRampGradients = r.useRampGradients
                    }
                    var x = r.getColorRemapGradients();
                    if (x) {
                        t.colorRemapGradients = [];
                        for (var p = 0, f = x; p < f.length; p++) {
                            var m = f[p];
                            l = {
                                gradient: m.gradient,
                                factor1: m.factor1
                            };
                            void 0 !== m.factor2 && (l.factor2 = m.factor2),
                            t.colorRemapGradients.push(l)
                        }
                    }
                    var z = r.getAlphaRemapGradients();
                    if (z) {
                        t.alphaRemapGradients = [];
                        for (var _ = 0, g = z; _ < g.length; _++) {
                            var v = g[_];
                            l = {
                                gradient: v.gradient,
                                factor1: v.factor1
                            };
                            void 0 !== v.factor2 && (l.factor2 = v.factor2),
                            t.alphaRemapGradients.push(l)
                        }
                    }
                    var b = r.getSizeGradients();
                    if (b) {
                        t.sizeGradients = [];
                        for (var T = 0, E = b; T < E.length; T++) {
                            var P = E[T];
                            l = {
                                gradient: P.gradient,
                                factor1: P.factor1
                            };
                            void 0 !== P.factor2 && (l.factor2 = P.factor2),
                            t.sizeGradients.push(l)
                        }
                    }
                    var A = r.getAngularSpeedGradients();
                    if (A) {
                        t.angularSpeedGradients = [];
                        for (var S = 0, M = A; S < M.length; S++) {
                            var C = M[S];
                            l = {
                                gradient: C.gradient,
                                factor1: C.factor1
                            };
                            void 0 !== C.factor2 && (l.factor2 = C.factor2),
                            t.angularSpeedGradients.push(l)
                        }
                    }
                    var R = r.getVelocityGradients();
                    if (R) {
                        t.velocityGradients = [];
                        for (var O = 0, I = R; O < I.length; O++) {
                            var w = I[O];
                            l = {
                                gradient: w.gradient,
                                factor1: w.factor1
                            };
                            void 0 !== w.factor2 && (l.factor2 = w.factor2),
                            t.velocityGradients.push(l)
                        }
                    }
                    var D = r.getDragGradients();
                    if (D) {
                        t.dragyGradients = [];
                        for (var L = 0, B = D; L < B.length; L++) {
                            var F = B[L];
                            l = {
                                gradient: F.gradient,
                                factor1: F.factor1
                            };
                            void 0 !== F.factor2 && (l.factor2 = F.factor2),
                            t.dragGradients.push(l)
                        }
                    }
                    var N = r.getEmitRateGradients();
                    if (N) {
                        t.emitRateGradients = [];
                        for (var V = 0, k = N; V < k.length; V++) {
                            var U = k[V];
                            l = {
                                gradient: U.gradient,
                                factor1: U.factor1
                            };
                            void 0 !== U.factor2 && (l.factor2 = U.factor2),
                            t.emitRateGradients.push(l)
                        }
                    }
                    var G = r.getStartSizeGradients();
                    if (G) {
                        t.startSizeGradients = [];
                        for (var H = 0, W = G; H < W.length; H++) {
                            var j = W[H];
                            l = {
                                gradient: j.gradient,
                                factor1: j.factor1
                            };
                            void 0 !== j.factor2 && (l.factor2 = j.factor2),
                            t.startSizeGradients.push(l)
                        }
                    }
                    var X = r.getLifeTimeGradients();
                    if (X) {
                        t.lifeTimeGradients = [];
                        for (var Y = 0, K = X; Y < K.length; Y++) {
                            var Q = K[Y];
                            l = {
                                gradient: Q.gradient,
                                factor1: Q.factor1
                            };
                            void 0 !== Q.factor2 && (l.factor2 = Q.factor2),
                            t.lifeTimeGradients.push(l)
                        }
                    }
                    var Z = r.getLimitVelocityGradients();
                    if (Z) {
                        t.limitVelocityGradients = [];
                        for (var q = 0, J = Z; q < J.length; q++) {
                            var $ = J[q];
                            l = {
                                gradient: $.gradient,
                                factor1: $.factor1
                            };
                            void 0 !== $.factor2 && (l.factor2 = $.factor2),
                            t.limitVelocityGradients.push(l)
                        }
                        t.limitVelocityDamping = r.limitVelocityDamping
                    }
                    r.noiseTexture && (t.noiseTexture = r.noiseTexture.serialize())
                }
                ,
                r._Parse = function(t, r, i, n) {
                    if (t.textureName && (r.particleTexture = new e.Texture(n + t.textureName,i,!1,void 0 === t.invertY || t.invertY),
                    r.particleTexture.name = t.textureName),
                    t.emitterId || 0 === t.emitterId || void 0 !== t.emitter ? t.emitterId ? r.emitter = i.getLastMeshByID(t.emitterId) : r.emitter = e.Vector3.FromArray(t.emitter) : r.emitter = e.Vector3.Zero(),
                    void 0 !== t.renderingGroupId && (r.renderingGroupId = t.renderingGroupId),
                    void 0 !== t.isBillboardBased && (r.isBillboardBased = t.isBillboardBased),
                    void 0 !== t.billboardMode && (r.billboardMode = t.billboardMode),
                    t.animations) {
                        for (var o = 0; o < t.animations.length; o++) {
                            var a = t.animations[o];
                            r.animations.push(e.Animation.Parse(a))
                        }
                        r.beginAnimationOnStart = t.beginAnimationOnStart,
                        r.beginAnimationFrom = t.beginAnimationFrom,
                        r.beginAnimationTo = t.beginAnimationTo,
                        r.beginAnimationLoop = t.beginAnimationLoop
                    }
                    if (t.autoAnimate && i.beginAnimation(r, t.autoAnimateFrom, t.autoAnimateTo, t.autoAnimateLoop, t.autoAnimateSpeed || 1),
                    r.startDelay = 0 | t.startDelay,
                    r.minAngularSpeed = t.minAngularSpeed,
                    r.maxAngularSpeed = t.maxAngularSpeed,
                    r.minSize = t.minSize,
                    r.maxSize = t.maxSize,
                    t.minScaleX && (r.minScaleX = t.minScaleX,
                    r.maxScaleX = t.maxScaleX,
                    r.minScaleY = t.minScaleY,
                    r.maxScaleY = t.maxScaleY),
                    void 0 !== t.preWarmCycles && (r.preWarmCycles = t.preWarmCycles,
                    r.preWarmStepOffset = t.preWarmStepOffset),
                    void 0 !== t.minInitialRotation && (r.minInitialRotation = t.minInitialRotation,
                    r.maxInitialRotation = t.maxInitialRotation),
                    r.minLifeTime = t.minLifeTime,
                    r.maxLifeTime = t.maxLifeTime,
                    r.minEmitPower = t.minEmitPower,
                    r.maxEmitPower = t.maxEmitPower,
                    r.emitRate = t.emitRate,
                    r.gravity = e.Vector3.FromArray(t.gravity),
                    t.noiseStrength && (r.noiseStrength = e.Vector3.FromArray(t.noiseStrength)),
                    r.color1 = e.Color4.FromArray(t.color1),
                    r.color2 = e.Color4.FromArray(t.color2),
                    r.colorDead = e.Color4.FromArray(t.colorDead),
                    r.updateSpeed = t.updateSpeed,
                    r.targetStopDuration = t.targetStopDuration,
                    r.blendMode = t.blendMode,
                    t.colorGradients)
                        for (var s = 0, y = t.colorGradients; s < y.length; s++) {
                            var l = y[s];
                            r.addColorGradient(l.gradient, e.Color4.FromArray(l.color1), l.color2 ? e.Color4.FromArray(l.color2) : void 0)
                        }
                    if (t.rampGradients) {
                        for (var c = 0, h = t.rampGradients; c < h.length; c++) {
                            var u = h[c];
                            r.addRampGradient(u.gradient, e.Color3.FromArray(u.color))
                        }
                        r.useRampGradients = t.useRampGradients
                    }
                    if (t.colorRemapGradients)
                        for (var d = 0, x = t.colorRemapGradients; d < x.length; d++) {
                            var p = x[d];
                            r.addColorRemapGradient(p.gradient, void 0 !== p.factor1 ? p.factor1 : p.factor, p.factor2)
                        }
                    if (t.alphaRemapGradients)
                        for (var f = 0, m = t.alphaRemapGradients; f < m.length; f++) {
                            var z = m[f];
                            r.addAlphaRemapGradient(z.gradient, void 0 !== z.factor1 ? z.factor1 : z.factor, z.factor2)
                        }
                    if (t.sizeGradients)
                        for (var _ = 0, g = t.sizeGradients; _ < g.length; _++) {
                            var v = g[_];
                            r.addSizeGradient(v.gradient, void 0 !== v.factor1 ? v.factor1 : v.factor, v.factor2)
                        }
                    if (t.sizeGradients)
                        for (var b = 0, T = t.sizeGradients; b < T.length; b++) {
                            v = T[b];
                            r.addSizeGradient(v.gradient, void 0 !== v.factor1 ? v.factor1 : v.factor, v.factor2)
                        }
                    if (t.angularSpeedGradients)
                        for (var E = 0, P = t.angularSpeedGradients; E < P.length; E++) {
                            var A = P[E];
                            r.addAngularSpeedGradient(A.gradient, void 0 !== A.factor1 ? A.factor1 : A.factor, A.factor2)
                        }
                    if (t.velocityGradients)
                        for (var S = 0, M = t.velocityGradients; S < M.length; S++) {
                            var C = M[S];
                            r.addVelocityGradient(C.gradient, void 0 !== C.factor1 ? C.factor1 : C.factor, C.factor2)
                        }
                    if (t.dragGradients)
                        for (var R = 0, O = t.dragGradients; R < O.length; R++) {
                            var I = O[R];
                            r.addDragGradient(I.gradient, void 0 !== I.factor1 ? I.factor1 : I.factor, I.factor2)
                        }
                    if (t.emitRateGradients)
                        for (var w = 0, D = t.emitRateGradients; w < D.length; w++) {
                            var L = D[w];
                            r.addEmitRateGradient(L.gradient, void 0 !== L.factor1 ? L.factor1 : L.factor, L.factor2)
                        }
                    if (t.startSizeGradients)
                        for (var B = 0, F = t.startSizeGradients; B < F.length; B++) {
                            var N = F[B];
                            r.addStartSizeGradient(N.gradient, void 0 !== N.factor1 ? N.factor1 : N.factor, N.factor2)
                        }
                    if (t.lifeTimeGradients)
                        for (var V = 0, k = t.lifeTimeGradients; V < k.length; V++) {
                            var U = k[V];
                            r.addLifeTimeGradient(U.gradient, void 0 !== U.factor1 ? U.factor1 : U.factor, U.factor2)
                        }
                    if (t.limitVelocityGradients) {
                        for (var G = 0, H = t.limitVelocityGradients; G < H.length; G++) {
                            var W = H[G];
                            r.addLimitVelocityGradient(W.gradient, void 0 !== W.factor1 ? W.factor1 : W.factor, W.factor2)
                        }
                        r.limitVelocityDamping = t.limitVelocityDamping
                    }
                    var j;
                    if (t.noiseTexture && (r.noiseTexture = e.ProceduralTexture.Parse(t.noiseTexture, i, n)),
                    t.particleEmitterType) {
                        switch (t.particleEmitterType.type) {
                        case "SphereParticleEmitter":
                            j = new e.SphereParticleEmitter;
                            break;
                        case "SphereDirectedParticleEmitter":
                            j = new e.SphereDirectedParticleEmitter;
                            break;
                        case "ConeEmitter":
                        case "ConeParticleEmitter":
                            j = new e.ConeParticleEmitter;
                            break;
                        case "CylinderParticleEmitter":
                            j = new e.CylinderParticleEmitter;
                            break;
                        case "HemisphericParticleEmitter":
                            j = new e.HemisphericParticleEmitter;
                            break;
                        case "BoxEmitter":
                        case "BoxParticleEmitter":
                        default:
                            j = new e.BoxParticleEmitter
                        }
                        j.parse(t.particleEmitterType)
                    } else
                        (j = new e.BoxParticleEmitter).parse(t);
                    r.particleEmitterType = j,
                    r.startSpriteCellID = t.startSpriteCellID,
                    r.endSpriteCellID = t.endSpriteCellID,
                    r.spriteCellWidth = t.spriteCellWidth,
                    r.spriteCellHeight = t.spriteCellHeight,
                    r.spriteCellChangeSpeed = t.spriteCellChangeSpeed,
                    r.spriteRandomStartCell = t.spriteRandomStartCell
                }
                ,
                r.Parse = function(t, i, n, o) {
                    void 0 === o && (o = !1);
                    var a = t.name
                      , s = null
                      , y = null;
                    if (t.customShader) {
                        var l = (y = t.customShader).shaderOptions.defines.length > 0 ? y.shaderOptions.defines.join("\n") : "";
                        s = i.getEngine().createEffectForParticles(y.shaderPath.fragmentElement, y.shaderOptions.uniforms, y.shaderOptions.samplers, l)
                    }
                    var c = new r(a,t.capacity,i,s,t.isAnimationSheetEnabled);
                    if (c.customShader = y,
                    t.id && (c.id = t.id),
                    t.subEmitters) {
                        c.subEmitters = [];
                        for (var h = 0, u = t.subEmitters; h < u.length; h++) {
                            for (var d = [], x = 0, p = u[h]; x < p.length; x++) {
                                var f = p[x];
                                d.push(e.SubEmitter.Parse(f, i, n))
                            }
                            c.subEmitters.push(d)
                        }
                    }
                    return r._Parse(t, c, i, n),
                    c.textureMask = e.Color4.FromArray(t.textureMask),
                    t.preventAutoStart && (c.preventAutoStart = t.preventAutoStart),
                    o || c.preventAutoStart || c.start(),
                    c
                }
                ,
                r.BILLBOARDMODE_Y = 2,
                r.BILLBOARDMODE_ALL = 7,
                r.BILLBOARDMODE_STRETCHED = 8,
                r
            }(e.BaseParticleSystem);
            e.ParticleSystem = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.direction1 = new e.Vector3(0,1,0),
                    this.direction2 = new e.Vector3(0,1,0),
                    this.minEmitBox = new e.Vector3(-.5,-.5,-.5),
                    this.maxEmitBox = new e.Vector3(.5,.5,.5)
                }
                return t.prototype.startDirectionFunction = function(t, r, i) {
                    var n = e.Scalar.RandomRange(this.direction1.x, this.direction2.x)
                      , o = e.Scalar.RandomRange(this.direction1.y, this.direction2.y)
                      , a = e.Scalar.RandomRange(this.direction1.z, this.direction2.z);
                    e.Vector3.TransformNormalFromFloatsToRef(n, o, a, t, r)
                }
                ,
                t.prototype.startPositionFunction = function(t, r, i) {
                    var n = e.Scalar.RandomRange(this.minEmitBox.x, this.maxEmitBox.x)
                      , o = e.Scalar.RandomRange(this.minEmitBox.y, this.maxEmitBox.y)
                      , a = e.Scalar.RandomRange(this.minEmitBox.z, this.maxEmitBox.z);
                    e.Vector3.TransformCoordinatesFromFloatsToRef(n, o, a, t, r)
                }
                ,
                t.prototype.clone = function() {
                    var r = new t;
                    return e.Tools.DeepCopy(this, r),
                    r
                }
                ,
                t.prototype.applyToShader = function(e) {
                    e.setVector3("direction1", this.direction1),
                    e.setVector3("direction2", this.direction2),
                    e.setVector3("minEmitBox", this.minEmitBox),
                    e.setVector3("maxEmitBox", this.maxEmitBox)
                }
                ,
                t.prototype.getEffectDefines = function() {
                    return "#define BOXEMITTER"
                }
                ,
                t.prototype.getClassName = function() {
                    return "BoxParticleEmitter"
                }
                ,
                t.prototype.serialize = function() {
                    var e = {};
                    return e.type = this.getClassName(),
                    e.direction1 = this.direction1.asArray(),
                    e.direction2 = this.direction2.asArray(),
                    e.minEmitBox = this.minEmitBox.asArray(),
                    e.maxEmitBox = this.maxEmitBox.asArray(),
                    e
                }
                ,
                t.prototype.parse = function(t) {
                    e.Vector3.FromArrayToRef(t.direction1, 0, this.direction1),
                    e.Vector3.FromArrayToRef(t.direction2, 0, this.direction2),
                    e.Vector3.FromArrayToRef(t.minEmitBox, 0, this.minEmitBox),
                    e.Vector3.FromArrayToRef(t.maxEmitBox, 0, this.maxEmitBox)
                }
                ,
                t
            }();
            e.BoxParticleEmitter = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t, r, i) {
                    void 0 === e && (e = 1),
                    void 0 === t && (t = 1),
                    void 0 === r && (r = 1),
                    void 0 === i && (i = 0),
                    this.radius = e,
                    this.height = t,
                    this.radiusRange = r,
                    this.directionRandomizer = i
                }
                return t.prototype.startDirectionFunction = function(t, r, i) {
                    var n = i.position.subtract(t.getTranslation()).normalize()
                      , o = e.Scalar.RandomRange(-this.directionRandomizer / 2, this.directionRandomizer / 2)
                      , a = Math.atan2(n.x, n.z);
                    a += e.Scalar.RandomRange(-Math.PI / 2, Math.PI / 2) * this.directionRandomizer,
                    n.y = o,
                    n.x = Math.sin(a),
                    n.z = Math.cos(a),
                    n.normalize(),
                    e.Vector3.TransformNormalFromFloatsToRef(n.x, n.y, n.z, t, r)
                }
                ,
                t.prototype.startPositionFunction = function(t, r, i) {
                    var n = e.Scalar.RandomRange(-this.height / 2, this.height / 2)
                      , o = e.Scalar.RandomRange(0, 2 * Math.PI)
                      , a = e.Scalar.RandomRange((1 - this.radiusRange) * (1 - this.radiusRange), 1)
                      , s = Math.sqrt(a) * this.radius
                      , y = s * Math.cos(o)
                      , l = s * Math.sin(o);
                    e.Vector3.TransformCoordinatesFromFloatsToRef(y, n, l, t, r)
                }
                ,
                t.prototype.clone = function() {
                    var r = new t(this.radius,this.directionRandomizer);
                    return e.Tools.DeepCopy(this, r),
                    r
                }
                ,
                t.prototype.applyToShader = function(e) {
                    e.setFloat("radius", this.radius),
                    e.setFloat("height", this.height),
                    e.setFloat("radiusRange", this.radiusRange),
                    e.setFloat("directionRandomizer", this.directionRandomizer)
                }
                ,
                t.prototype.getEffectDefines = function() {
                    return "#define CYLINDEREMITTER"
                }
                ,
                t.prototype.getClassName = function() {
                    return "CylinderParticleEmitter"
                }
                ,
                t.prototype.serialize = function() {
                    var e = {};
                    return e.type = this.getClassName(),
                    e.radius = this.radius,
                    e.height = this.height,
                    e.radiusRange = this.radiusRange,
                    e.directionRandomizer = this.directionRandomizer,
                    e
                }
                ,
                t.prototype.parse = function(e) {
                    this.radius = e.radius,
                    this.height = e.height,
                    this.radiusRange = e.radiusRange,
                    this.directionRandomizer = e.directionRandomizer
                }
                ,
                t
            }();
            e.CylinderParticleEmitter = t;
            var r = function(t) {
                function r(r, i, n, o, a) {
                    void 0 === r && (r = 1),
                    void 0 === i && (i = 1),
                    void 0 === n && (n = 1),
                    void 0 === o && (o = new e.Vector3(0,1,0)),
                    void 0 === a && (a = new e.Vector3(0,1,0));
                    var s = t.call(this, r, i, n) || this;
                    return s.direction1 = o,
                    s.direction2 = a,
                    s
                }
                return o(r, t),
                r.prototype.startDirectionFunction = function(t, r, i) {
                    var n = e.Scalar.RandomRange(this.direction1.x, this.direction2.x)
                      , o = e.Scalar.RandomRange(this.direction1.y, this.direction2.y)
                      , a = e.Scalar.RandomRange(this.direction1.z, this.direction2.z);
                    e.Vector3.TransformNormalFromFloatsToRef(n, o, a, t, r)
                }
                ,
                r.prototype.clone = function() {
                    var t = new r(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);
                    return e.Tools.DeepCopy(this, t),
                    t
                }
                ,
                r.prototype.applyToShader = function(e) {
                    e.setFloat("radius", this.radius),
                    e.setFloat("height", this.height),
                    e.setFloat("radiusRange", this.radiusRange),
                    e.setVector3("direction1", this.direction1),
                    e.setVector3("direction2", this.direction2)
                }
                ,
                r.prototype.getEffectDefines = function() {
                    return "#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"
                }
                ,
                r.prototype.getClassName = function() {
                    return "CylinderDirectedParticleEmitter"
                }
                ,
                r.prototype.serialize = function() {
                    var e = t.prototype.serialize.call(this);
                    return e.direction1 = this.direction1.asArray(),
                    e.direction2 = this.direction2.asArray(),
                    e
                }
                ,
                r.prototype.parse = function(e) {
                    t.prototype.parse.call(this, e),
                    this.direction1.copyFrom(e.direction1),
                    this.direction2.copyFrom(e.direction2)
                }
                ,
                r
            }(t);
            e.CylinderDirectedParticleEmitter = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t, r) {
                    void 0 === e && (e = 1),
                    void 0 === t && (t = Math.PI),
                    void 0 === r && (r = 0),
                    this.directionRandomizer = r,
                    this.radiusRange = 1,
                    this.heightRange = 1,
                    this.emitFromSpawnPointOnly = !1,
                    this.angle = t,
                    this.radius = e
                }
                return Object.defineProperty(t.prototype, "radius", {
                    get: function() {
                        return this._radius
                    },
                    set: function(e) {
                        this._radius = e,
                        this._buildHeight()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "angle", {
                    get: function() {
                        return this._angle
                    },
                    set: function(e) {
                        this._angle = e,
                        this._buildHeight()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._buildHeight = function() {
                    0 !== this._angle ? this._height = this._radius / Math.tan(this._angle / 2) : this._height = 1
                }
                ,
                t.prototype.startDirectionFunction = function(t, r, i) {
                    if (1 === Math.abs(Math.cos(this._angle)))
                        e.Vector3.TransformNormalFromFloatsToRef(0, 1, 0, t, r);
                    else {
                        var n = i.position.subtract(t.getTranslation()).normalize()
                          , o = e.Scalar.RandomRange(0, this.directionRandomizer)
                          , a = e.Scalar.RandomRange(0, this.directionRandomizer)
                          , s = e.Scalar.RandomRange(0, this.directionRandomizer);
                        n.x += o,
                        n.y += a,
                        n.z += s,
                        n.normalize(),
                        e.Vector3.TransformNormalFromFloatsToRef(n.x, n.y, n.z, t, r)
                    }
                }
                ,
                t.prototype.startPositionFunction = function(t, r, i) {
                    var n, o = e.Scalar.RandomRange(0, 2 * Math.PI);
                    n = this.emitFromSpawnPointOnly ? 1e-4 : 1 - (n = e.Scalar.RandomRange(0, this.heightRange)) * n;
                    var a = this._radius - e.Scalar.RandomRange(0, this._radius * this.radiusRange)
                      , s = (a *= n) * Math.sin(o)
                      , y = a * Math.cos(o)
                      , l = n * this._height;
                    e.Vector3.TransformCoordinatesFromFloatsToRef(s, l, y, t, r)
                }
                ,
                t.prototype.clone = function() {
                    var r = new t(this._radius,this._angle,this.directionRandomizer);
                    return e.Tools.DeepCopy(this, r),
                    r
                }
                ,
                t.prototype.applyToShader = function(e) {
                    e.setFloat2("radius", this._radius, this.radiusRange),
                    e.setFloat("coneAngle", this._angle),
                    e.setFloat2("height", this._height, this.heightRange),
                    e.setFloat("directionRandomizer", this.directionRandomizer)
                }
                ,
                t.prototype.getEffectDefines = function() {
                    var e = "#define CONEEMITTER";
                    return this.emitFromSpawnPointOnly && (e += "\n#define CONEEMITTERSPAWNPOINT"),
                    e
                }
                ,
                t.prototype.getClassName = function() {
                    return "ConeParticleEmitter"
                }
                ,
                t.prototype.serialize = function() {
                    var e = {};
                    return e.type = this.getClassName(),
                    e.radius = this._radius,
                    e.angle = this._angle,
                    e.directionRandomizer = this.directionRandomizer,
                    e
                }
                ,
                t.prototype.parse = function(e) {
                    this.radius = e.radius,
                    this.angle = e.angle,
                    this.directionRandomizer = e.directionRandomizer
                }
                ,
                t
            }();
            e.ConeParticleEmitter = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t, r) {
                    void 0 === e && (e = 1),
                    void 0 === t && (t = 1),
                    void 0 === r && (r = 0),
                    this.radius = e,
                    this.radiusRange = t,
                    this.directionRandomizer = r
                }
                return t.prototype.startDirectionFunction = function(t, r, i) {
                    var n = i.position.subtract(t.getTranslation()).normalize()
                      , o = e.Scalar.RandomRange(0, this.directionRandomizer)
                      , a = e.Scalar.RandomRange(0, this.directionRandomizer)
                      , s = e.Scalar.RandomRange(0, this.directionRandomizer);
                    n.x += o,
                    n.y += a,
                    n.z += s,
                    n.normalize(),
                    e.Vector3.TransformNormalFromFloatsToRef(n.x, n.y, n.z, t, r)
                }
                ,
                t.prototype.startPositionFunction = function(t, r, i) {
                    var n = this.radius - e.Scalar.RandomRange(0, this.radius * this.radiusRange)
                      , o = e.Scalar.RandomRange(0, 1)
                      , a = e.Scalar.RandomRange(0, 2 * Math.PI)
                      , s = Math.acos(2 * o - 1)
                      , y = n * Math.cos(a) * Math.sin(s)
                      , l = n * Math.cos(s)
                      , c = n * Math.sin(a) * Math.sin(s);
                    e.Vector3.TransformCoordinatesFromFloatsToRef(y, l, c, t, r)
                }
                ,
                t.prototype.clone = function() {
                    var r = new t(this.radius,this.directionRandomizer);
                    return e.Tools.DeepCopy(this, r),
                    r
                }
                ,
                t.prototype.applyToShader = function(e) {
                    e.setFloat("radius", this.radius),
                    e.setFloat("radiusRange", this.radiusRange),
                    e.setFloat("directionRandomizer", this.directionRandomizer)
                }
                ,
                t.prototype.getEffectDefines = function() {
                    return "#define SPHEREEMITTER"
                }
                ,
                t.prototype.getClassName = function() {
                    return "SphereParticleEmitter"
                }
                ,
                t.prototype.serialize = function() {
                    var e = {};
                    return e.type = this.getClassName(),
                    e.radius = this.radius,
                    e.radiusRange = this.radiusRange,
                    e.directionRandomizer = this.directionRandomizer,
                    e
                }
                ,
                t.prototype.parse = function(e) {
                    this.radius = e.radius,
                    this.radiusRange = e.radiusRange,
                    this.directionRandomizer = e.directionRandomizer
                }
                ,
                t
            }();
            e.SphereParticleEmitter = t;
            var r = function(t) {
                function r(r, i, n) {
                    void 0 === r && (r = 1),
                    void 0 === i && (i = new e.Vector3(0,1,0)),
                    void 0 === n && (n = new e.Vector3(0,1,0));
                    var o = t.call(this, r) || this;
                    return o.direction1 = i,
                    o.direction2 = n,
                    o
                }
                return o(r, t),
                r.prototype.startDirectionFunction = function(t, r, i) {
                    var n = e.Scalar.RandomRange(this.direction1.x, this.direction2.x)
                      , o = e.Scalar.RandomRange(this.direction1.y, this.direction2.y)
                      , a = e.Scalar.RandomRange(this.direction1.z, this.direction2.z);
                    e.Vector3.TransformNormalFromFloatsToRef(n, o, a, t, r)
                }
                ,
                r.prototype.clone = function() {
                    var t = new r(this.radius,this.direction1,this.direction2);
                    return e.Tools.DeepCopy(this, t),
                    t
                }
                ,
                r.prototype.applyToShader = function(e) {
                    e.setFloat("radius", this.radius),
                    e.setFloat("radiusRange", this.radiusRange),
                    e.setVector3("direction1", this.direction1),
                    e.setVector3("direction2", this.direction2)
                }
                ,
                r.prototype.getEffectDefines = function() {
                    return "#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"
                }
                ,
                r.prototype.getClassName = function() {
                    return "SphereDirectedParticleEmitter"
                }
                ,
                r.prototype.serialize = function() {
                    var e = t.prototype.serialize.call(this);
                    return e.direction1 = this.direction1.asArray(),
                    e.direction2 = this.direction2.asArray(),
                    e
                }
                ,
                r.prototype.parse = function(e) {
                    t.prototype.parse.call(this, e),
                    this.direction1.copyFrom(e.direction1),
                    this.direction2.copyFrom(e.direction2)
                }
                ,
                r
            }(t);
            e.SphereDirectedParticleEmitter = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t, r) {
                    void 0 === e && (e = 1),
                    void 0 === t && (t = 1),
                    void 0 === r && (r = 0),
                    this.radius = e,
                    this.radiusRange = t,
                    this.directionRandomizer = r
                }
                return t.prototype.startDirectionFunction = function(t, r, i) {
                    var n = i.position.subtract(t.getTranslation()).normalize()
                      , o = e.Scalar.RandomRange(0, this.directionRandomizer)
                      , a = e.Scalar.RandomRange(0, this.directionRandomizer)
                      , s = e.Scalar.RandomRange(0, this.directionRandomizer);
                    n.x += o,
                    n.y += a,
                    n.z += s,
                    n.normalize(),
                    e.Vector3.TransformNormalFromFloatsToRef(n.x, n.y, n.z, t, r)
                }
                ,
                t.prototype.startPositionFunction = function(t, r, i) {
                    var n = this.radius - e.Scalar.RandomRange(0, this.radius * this.radiusRange)
                      , o = e.Scalar.RandomRange(0, 1)
                      , a = e.Scalar.RandomRange(0, 2 * Math.PI)
                      , s = Math.acos(2 * o - 1)
                      , y = n * Math.cos(a) * Math.sin(s)
                      , l = n * Math.cos(s)
                      , c = n * Math.sin(a) * Math.sin(s);
                    e.Vector3.TransformCoordinatesFromFloatsToRef(y, Math.abs(l), c, t, r)
                }
                ,
                t.prototype.clone = function() {
                    var r = new t(this.radius,this.directionRandomizer);
                    return e.Tools.DeepCopy(this, r),
                    r
                }
                ,
                t.prototype.applyToShader = function(e) {
                    e.setFloat("radius", this.radius),
                    e.setFloat("radiusRange", this.radiusRange),
                    e.setFloat("directionRandomizer", this.directionRandomizer)
                }
                ,
                t.prototype.getEffectDefines = function() {
                    return "#define HEMISPHERICEMITTER"
                }
                ,
                t.prototype.getClassName = function() {
                    return "HemisphericParticleEmitter"
                }
                ,
                t.prototype.serialize = function() {
                    var e = {};
                    return e.type = this.getClassName(),
                    e.radius = this.radius,
                    e.radiusRange = this.radiusRange,
                    e.directionRandomizer = this.directionRandomizer,
                    e
                }
                ,
                t.prototype.parse = function(e) {
                    this.radius = e.radius,
                    this.radiusRange = e.radiusRange,
                    this.directionRandomizer = e.directionRandomizer
                }
                ,
                t
            }();
            e.HemisphericParticleEmitter = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.direction1 = new e.Vector3(0,1,0),
                    this.direction2 = new e.Vector3(0,1,0)
                }
                return t.prototype.startDirectionFunction = function(t, r, i) {
                    var n = e.Scalar.RandomRange(this.direction1.x, this.direction2.x)
                      , o = e.Scalar.RandomRange(this.direction1.y, this.direction2.y)
                      , a = e.Scalar.RandomRange(this.direction1.z, this.direction2.z);
                    e.Vector3.TransformNormalFromFloatsToRef(n, o, a, t, r)
                }
                ,
                t.prototype.startPositionFunction = function(t, r, i) {
                    e.Vector3.TransformCoordinatesFromFloatsToRef(0, 0, 0, t, r)
                }
                ,
                t.prototype.clone = function() {
                    var r = new t;
                    return e.Tools.DeepCopy(this, r),
                    r
                }
                ,
                t.prototype.applyToShader = function(e) {
                    e.setVector3("direction1", this.direction1),
                    e.setVector3("direction2", this.direction2)
                }
                ,
                t.prototype.getEffectDefines = function() {
                    return "#define POINTEMITTER"
                }
                ,
                t.prototype.getClassName = function() {
                    return "PointParticleEmitter"
                }
                ,
                t.prototype.serialize = function() {
                    var e = {};
                    return e.type = this.getClassName(),
                    e.direction1 = this.direction1.asArray(),
                    e.direction2 = this.direction2.asArray(),
                    e
                }
                ,
                t.prototype.parse = function(t) {
                    e.Vector3.FromArrayToRef(t.direction1, 0, this.direction1),
                    e.Vector3.FromArrayToRef(t.direction2, 0, this.direction2)
                }
                ,
                t
            }();
            e.PointParticleEmitter = t
        }(s || (s = {})),
        function(e) {
            e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_PARTICLESYSTEM, (function(t, r, i, n) {
                var o = e.AbstractScene.GetIndividualParser(e.SceneComponentConstants.NAME_PARTICLESYSTEM);
                if (o && void 0 !== t.particleSystems && null !== t.particleSystems)
                    for (var a = 0, s = t.particleSystems.length; a < s; a++) {
                        var y = t.particleSystems[a];
                        i.particleSystems.push(o(y, r, n))
                    }
            }
            )),
            e.AbstractScene.AddIndividualParser(e.SceneComponentConstants.NAME_PARTICLESYSTEM, (function(t, r, i) {
                return t.activeParticleCount ? e.GPUParticleSystem.Parse(t, r, i) : e.ParticleSystem.Parse(t, r, i)
            }
            )),
            e.Engine.prototype.createEffectForParticles = function(t, r, i, n, o, a, s) {
                void 0 === r && (r = []),
                void 0 === i && (i = []),
                void 0 === n && (n = "");
                var y = e.ParticleSystem._GetAttributeNamesOrOptions()
                  , l = e.ParticleSystem._GetEffectCreationOptions();
                return -1 === n.indexOf(" BILLBOARD") && (n += "\n#define BILLBOARD\n"),
                -1 === i.indexOf("diffuseSampler") && i.push("diffuseSampler"),
                this.createEffect({
                    vertex: "particles",
                    fragmentElement: t
                }, y, l.concat(r), i, n, o, a, s)
            }
            ,
            e.Mesh.prototype.getEmittedParticleSystems = function() {
                for (var e = new Array, t = 0; t < this.getScene().particleSystems.length; t++) {
                    var r = this.getScene().particleSystems[t];
                    r.emitter === this && e.push(r)
                }
                return e
            }
            ,
            e.Mesh.prototype.getHierarchyEmittedParticleSystems = function() {
                var e = new Array
                  , t = this.getDescendants();
                t.push(this);
                for (var r = 0; r < this.getScene().particleSystems.length; r++) {
                    var i = this.getScene().particleSystems[r]
                      , n = i.emitter;
                    n.position && -1 !== t.indexOf(n) && e.push(i)
                }
                return e
            }
        }(s || (s = {})),
        function(e) {
            var t;
            !function(e) {
                e[e.ATTACHED = 0] = "ATTACHED",
                e[e.END = 1] = "END"
            }(t = e.SubEmitterType || (e.SubEmitterType = {}));
            var r = function() {
                function r(r) {
                    this.particleSystem = r,
                    this.type = t.END,
                    this.inheritDirection = !1,
                    this.inheritedVelocityAmount = 0,
                    r.emitter && r.emitter.dispose || (r.emitter = new e.AbstractMesh("SubemitterSystemEmitter",r.getScene())),
                    r.onDisposeObservable.add((function() {
                        r.emitter && r.emitter.dispose && r.emitter.dispose()
                    }
                    ))
                }
                return r.prototype.clone = function() {
                    var t = this.particleSystem.emitter;
                    t ? t instanceof e.Vector3 ? t = t.clone() : t instanceof e.AbstractMesh && ((t = new e.Mesh("",t.getScene())).isVisible = !1) : t = new e.Vector3;
                    var i = new r(this.particleSystem.clone("", t));
                    return i.type = this.type,
                    i.inheritDirection = this.inheritDirection,
                    i.inheritedVelocityAmount = this.inheritedVelocityAmount,
                    i.particleSystem._disposeEmitterOnDispose = !0,
                    i.particleSystem.disposeOnStop = !0,
                    i
                }
                ,
                r.prototype.serialize = function() {
                    var e = {};
                    return e.type = this.type,
                    e.inheritDirection = this.inheritDirection,
                    e.inheritedVelocityAmount = this.inheritedVelocityAmount,
                    e.particleSystem = this.particleSystem.serialize(),
                    e
                }
                ,
                r.Parse = function(t, i, n) {
                    var o = t.particleSystem
                      , a = new r(e.ParticleSystem.Parse(o, i, n));
                    return a.type = t.type,
                    a.inheritDirection = t.inheritDirection,
                    a.inheritedVelocityAmount = t.inheritedVelocityAmount,
                    a.particleSystem._isSubEmitter = !0,
                    a
                }
                ,
                r.prototype.dispose = function() {
                    this.particleSystem.dispose()
                }
                ,
                r
            }();
            e.SubEmitter = r
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o) {
                    void 0 === o && (o = {});
                    var s = t.call(this, r, i) || this;
                    return s._textures = {},
                    s._textureArrays = {},
                    s._floats = {},
                    s._ints = {},
                    s._floatsArrays = {},
                    s._colors3 = {},
                    s._colors3Arrays = {},
                    s._colors4 = {},
                    s._vectors2 = {},
                    s._vectors3 = {},
                    s._vectors4 = {},
                    s._matrices = {},
                    s._matrices3x3 = {},
                    s._matrices2x2 = {},
                    s._vectors2Arrays = {},
                    s._vectors3Arrays = {},
                    s._cachedWorldViewMatrix = new e.Matrix,
                    s._shaderPath = n,
                    s._options = a({
                        needAlphaBlending: !1,
                        needAlphaTesting: !1,
                        attributes: ["position", "normal", "uv"],
                        uniforms: ["worldViewProjection"],
                        uniformBuffers: [],
                        samplers: [],
                        defines: []
                    }, o),
                    s
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "ShaderMaterial"
                }
                ,
                r.prototype.needAlphaBlending = function() {
                    return this.alpha < 1 || this._options.needAlphaBlending
                }
                ,
                r.prototype.needAlphaTesting = function() {
                    return this._options.needAlphaTesting
                }
                ,
                r.prototype._checkUniform = function(e) {
                    -1 === this._options.uniforms.indexOf(e) && this._options.uniforms.push(e)
                }
                ,
                r.prototype.setTexture = function(e, t) {
                    return -1 === this._options.samplers.indexOf(e) && this._options.samplers.push(e),
                    this._textures[e] = t,
                    this
                }
                ,
                r.prototype.setTextureArray = function(e, t) {
                    return -1 === this._options.samplers.indexOf(e) && this._options.samplers.push(e),
                    this._checkUniform(e),
                    this._textureArrays[e] = t,
                    this
                }
                ,
                r.prototype.setFloat = function(e, t) {
                    return this._checkUniform(e),
                    this._floats[e] = t,
                    this
                }
                ,
                r.prototype.setInt = function(e, t) {
                    return this._checkUniform(e),
                    this._ints[e] = t,
                    this
                }
                ,
                r.prototype.setFloats = function(e, t) {
                    return this._checkUniform(e),
                    this._floatsArrays[e] = t,
                    this
                }
                ,
                r.prototype.setColor3 = function(e, t) {
                    return this._checkUniform(e),
                    this._colors3[e] = t,
                    this
                }
                ,
                r.prototype.setColor3Array = function(e, t) {
                    return this._checkUniform(e),
                    this._colors3Arrays[e] = t.reduce((function(e, t) {
                        return t.toArray(e, e.length),
                        e
                    }
                    ), []),
                    this
                }
                ,
                r.prototype.setColor4 = function(e, t) {
                    return this._checkUniform(e),
                    this._colors4[e] = t,
                    this
                }
                ,
                r.prototype.setVector2 = function(e, t) {
                    return this._checkUniform(e),
                    this._vectors2[e] = t,
                    this
                }
                ,
                r.prototype.setVector3 = function(e, t) {
                    return this._checkUniform(e),
                    this._vectors3[e] = t,
                    this
                }
                ,
                r.prototype.setVector4 = function(e, t) {
                    return this._checkUniform(e),
                    this._vectors4[e] = t,
                    this
                }
                ,
                r.prototype.setMatrix = function(e, t) {
                    return this._checkUniform(e),
                    this._matrices[e] = t,
                    this
                }
                ,
                r.prototype.setMatrix3x3 = function(e, t) {
                    return this._checkUniform(e),
                    this._matrices3x3[e] = t,
                    this
                }
                ,
                r.prototype.setMatrix2x2 = function(e, t) {
                    return this._checkUniform(e),
                    this._matrices2x2[e] = t,
                    this
                }
                ,
                r.prototype.setArray2 = function(e, t) {
                    return this._checkUniform(e),
                    this._vectors2Arrays[e] = t,
                    this
                }
                ,
                r.prototype.setArray3 = function(e, t) {
                    return this._checkUniform(e),
                    this._vectors3Arrays[e] = t,
                    this
                }
                ,
                r.prototype._checkCache = function(e, t, r) {
                    return !t || (this._effect && this._effect.defines.indexOf("#define INSTANCES"),
                    !1)
                }
                ,
                r.prototype.isReady = function(t, r) {
                    var i = this.getScene()
                      , n = i.getEngine();
                    if (!this.checkReadyOnEveryCall && this._renderId === i.getRenderId() && this._checkCache(i, t, r))
                        return !0;
                    for (var o = [], a = [], s = new e.EffectFallbacks, y = 0; y < this._options.defines.length; y++)
                        o.push(this._options.defines[y]);
                    for (y = 0; y < this._options.attributes.length; y++)
                        a.push(this._options.attributes[y]);
                    for (var l in t && t.isVerticesDataPresent(e.VertexBuffer.ColorKind) && (a.push(e.VertexBuffer.ColorKind),
                    o.push("#define VERTEXCOLOR")),
                    r && (o.push("#define INSTANCES"),
                    e.MaterialHelper.PrepareAttributesForInstances(a, o)),
                    t && t.useBones && t.computeBonesUsingShaders && t.skeleton ? (a.push(e.VertexBuffer.MatricesIndicesKind),
                    a.push(e.VertexBuffer.MatricesWeightsKind),
                    t.numBoneInfluencers > 4 && (a.push(e.VertexBuffer.MatricesIndicesExtraKind),
                    a.push(e.VertexBuffer.MatricesWeightsExtraKind)),
                    o.push("#define NUM_BONE_INFLUENCERS " + t.numBoneInfluencers),
                    o.push("#define BonesPerMesh " + (t.skeleton.bones.length + 1)),
                    s.addCPUSkinningFallback(0, t),
                    -1 === this._options.uniforms.indexOf("mBones") && this._options.uniforms.push("mBones")) : o.push("#define NUM_BONE_INFLUENCERS 0"),
                    this._textures)
                        if (!this._textures[l].isReady())
                            return !1;
                    t && this._shouldTurnAlphaTestOn(t) && o.push("#define ALPHATEST");
                    var c = this._effect
                      , h = o.join("\n");
                    return this._effect = n.createEffect(this._shaderPath, {
                        attributes: a,
                        uniformsNames: this._options.uniforms,
                        uniformBuffersNames: this._options.uniformBuffers,
                        samplers: this._options.samplers,
                        defines: h,
                        fallbacks: s,
                        onCompiled: this.onCompiled,
                        onError: this.onError
                    }, n),
                    !!this._effect.isReady() && (c !== this._effect && i.resetCachedMaterial(),
                    this._renderId = i.getRenderId(),
                    !0)
                }
                ,
                r.prototype.bindOnlyWorldMatrix = function(e) {
                    var t = this.getScene();
                    this._effect && (-1 !== this._options.uniforms.indexOf("world") && this._effect.setMatrix("world", e),
                    -1 !== this._options.uniforms.indexOf("worldView") && (e.multiplyToRef(t.getViewMatrix(), this._cachedWorldViewMatrix),
                    this._effect.setMatrix("worldView", this._cachedWorldViewMatrix)),
                    -1 !== this._options.uniforms.indexOf("worldViewProjection") && this._effect.setMatrix("worldViewProjection", e.multiply(t.getTransformMatrix())))
                }
                ,
                r.prototype.bind = function(t, r) {
                    if (this.bindOnlyWorldMatrix(t),
                    this._effect && this.getScene().getCachedMaterial() !== this) {
                        var i;
                        for (i in -1 !== this._options.uniforms.indexOf("view") && this._effect.setMatrix("view", this.getScene().getViewMatrix()),
                        -1 !== this._options.uniforms.indexOf("projection") && this._effect.setMatrix("projection", this.getScene().getProjectionMatrix()),
                        -1 !== this._options.uniforms.indexOf("viewProjection") && this._effect.setMatrix("viewProjection", this.getScene().getTransformMatrix()),
                        e.MaterialHelper.BindBonesParameters(r, this._effect),
                        this._textures)
                            this._effect.setTexture(i, this._textures[i]);
                        for (i in this._textureArrays)
                            this._effect.setTextureArray(i, this._textureArrays[i]);
                        for (i in this._ints)
                            this._effect.setInt(i, this._ints[i]);
                        for (i in this._floats)
                            this._effect.setFloat(i, this._floats[i]);
                        for (i in this._floatsArrays)
                            this._effect.setArray(i, this._floatsArrays[i]);
                        for (i in this._colors3)
                            this._effect.setColor3(i, this._colors3[i]);
                        for (i in this._colors3Arrays)
                            this._effect.setArray3(i, this._colors3Arrays[i]);
                        for (i in this._colors4) {
                            var n = this._colors4[i];
                            this._effect.setFloat4(i, n.r, n.g, n.b, n.a)
                        }
                        for (i in this._vectors2)
                            this._effect.setVector2(i, this._vectors2[i]);
                        for (i in this._vectors3)
                            this._effect.setVector3(i, this._vectors3[i]);
                        for (i in this._vectors4)
                            this._effect.setVector4(i, this._vectors4[i]);
                        for (i in this._matrices)
                            this._effect.setMatrix(i, this._matrices[i]);
                        for (i in this._matrices3x3)
                            this._effect.setMatrix3x3(i, this._matrices3x3[i]);
                        for (i in this._matrices2x2)
                            this._effect.setMatrix2x2(i, this._matrices2x2[i]);
                        for (i in this._vectors2Arrays)
                            this._effect.setArray2(i, this._vectors2Arrays[i]);
                        for (i in this._vectors3Arrays)
                            this._effect.setArray3(i, this._vectors3Arrays[i])
                    }
                    this._afterBind(r)
                }
                ,
                r.prototype.getActiveTextures = function() {
                    var e = t.prototype.getActiveTextures.call(this);
                    for (var r in this._textures)
                        e.push(this._textures[r]);
                    for (var r in this._textureArrays)
                        for (var i = this._textureArrays[r], n = 0; n < i.length; n++)
                            e.push(i[n]);
                    return e
                }
                ,
                r.prototype.hasTexture = function(e) {
                    if (t.prototype.hasTexture.call(this, e))
                        return !0;
                    for (var r in this._textures)
                        if (this._textures[r] === e)
                            return !0;
                    for (var r in this._textureArrays)
                        for (var i = this._textureArrays[r], n = 0; n < i.length; n++)
                            if (i[n] === e)
                                return !0;
                    return !1
                }
                ,
                r.prototype.clone = function(e) {
                    return new r(e,this.getScene(),this._shaderPath,this._options)
                }
                ,
                r.prototype.dispose = function(e, r) {
                    if (r) {
                        var i;
                        for (i in this._textures)
                            this._textures[i].dispose();
                        for (i in this._textureArrays)
                            for (var n = this._textureArrays[i], o = 0; o < n.length; o++)
                                n[o].dispose()
                    }
                    this._textures = {},
                    t.prototype.dispose.call(this, e, r)
                }
                ,
                r.prototype.serialize = function() {
                    var t, r = e.SerializationHelper.Serialize(this);
                    for (t in r.customType = "BABYLON.ShaderMaterial",
                    r.options = this._options,
                    r.shaderPath = this._shaderPath,
                    r.textures = {},
                    this._textures)
                        r.textures[t] = this._textures[t].serialize();
                    for (t in r.textureArrays = {},
                    this._textureArrays) {
                        r.textureArrays[t] = [];
                        for (var i = this._textureArrays[t], n = 0; n < i.length; n++)
                            r.textureArrays[t].push(i[n].serialize())
                    }
                    for (t in r.floats = {},
                    this._floats)
                        r.floats[t] = this._floats[t];
                    for (t in r.FloatArrays = {},
                    this._floatsArrays)
                        r.FloatArrays[t] = this._floatsArrays[t];
                    for (t in r.colors3 = {},
                    this._colors3)
                        r.colors3[t] = this._colors3[t].asArray();
                    for (t in r.colors3Arrays = {},
                    this._colors3Arrays)
                        r.colors3Arrays[t] = this._colors3Arrays[t];
                    for (t in r.colors4 = {},
                    this._colors4)
                        r.colors4[t] = this._colors4[t].asArray();
                    for (t in r.vectors2 = {},
                    this._vectors2)
                        r.vectors2[t] = this._vectors2[t].asArray();
                    for (t in r.vectors3 = {},
                    this._vectors3)
                        r.vectors3[t] = this._vectors3[t].asArray();
                    for (t in r.vectors4 = {},
                    this._vectors4)
                        r.vectors4[t] = this._vectors4[t].asArray();
                    for (t in r.matrices = {},
                    this._matrices)
                        r.matrices[t] = this._matrices[t].asArray();
                    for (t in r.matrices3x3 = {},
                    this._matrices3x3)
                        r.matrices3x3[t] = this._matrices3x3[t];
                    for (t in r.matrices2x2 = {},
                    this._matrices2x2)
                        r.matrices2x2[t] = this._matrices2x2[t];
                    for (t in r.vectors2Arrays = {},
                    this._vectors2Arrays)
                        r.vectors2Arrays[t] = this._vectors2Arrays[t];
                    for (t in r.vectors3Arrays = {},
                    this._vectors3Arrays)
                        r.vectors3Arrays[t] = this._vectors3Arrays[t];
                    return r
                }
                ,
                r.Parse = function(t, i, n) {
                    var o, a = e.SerializationHelper.Parse((function() {
                        return new r(t.name,i,t.shaderPath,t.options)
                    }
                    ), t, i, n);
                    for (o in t.textures)
                        a.setTexture(o, e.Texture.Parse(t.textures[o], i, n));
                    for (o in t.textureArrays) {
                        for (var s = t.textureArrays[o], y = new Array, l = 0; l < s.length; l++)
                            y.push(e.Texture.Parse(s[l], i, n));
                        a.setTextureArray(o, y)
                    }
                    for (o in t.floats)
                        a.setFloat(o, t.floats[o]);
                    for (o in t.floatsArrays)
                        a.setFloats(o, t.floatsArrays[o]);
                    for (o in t.colors3)
                        a.setColor3(o, e.Color3.FromArray(t.colors3[o]));
                    for (o in t.colors3Arrays) {
                        var c = t.colors3Arrays[o].reduce((function(e, t, r) {
                            return r % 3 == 0 ? e.push([t]) : e[e.length - 1].push(t),
                            e
                        }
                        ), []).map((function(t) {
                            return e.Color3.FromArray(t)
                        }
                        ));
                        a.setColor3Array(o, c)
                    }
                    for (o in t.colors4)
                        a.setColor4(o, e.Color4.FromArray(t.colors4[o]));
                    for (o in t.vectors2)
                        a.setVector2(o, e.Vector2.FromArray(t.vectors2[o]));
                    for (o in t.vectors3)
                        a.setVector3(o, e.Vector3.FromArray(t.vectors3[o]));
                    for (o in t.vectors4)
                        a.setVector4(o, e.Vector4.FromArray(t.vectors4[o]));
                    for (o in t.matrices)
                        a.setMatrix(o, e.Matrix.FromArray(t.matrices[o]));
                    for (o in t.matrices3x3)
                        a.setMatrix3x3(o, t.matrices3x3[o]);
                    for (o in t.matrices2x2)
                        a.setMatrix2x2(o, t.matrices2x2[o]);
                    for (o in t.vectors2Arrays)
                        a.setArray2(o, t.vectors2Arrays[o]);
                    for (o in t.vectors3Arrays)
                        a.setArray3(o, t.vectors3Arrays[o]);
                    return a
                }
                ,
                r
            }(e.Material);
            e.ShaderMaterial = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(e, r) {
                    var i = t.call(this, e, r) || this;
                    return i.generateOctree = !1,
                    i
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "GroundMesh"
                }
                ,
                Object.defineProperty(r.prototype, "subdivisions", {
                    get: function() {
                        return Math.min(this._subdivisionsX, this._subdivisionsY)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "subdivisionsX", {
                    get: function() {
                        return this._subdivisionsX
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "subdivisionsY", {
                    get: function() {
                        return this._subdivisionsY
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.optimize = function(e, t) {
                    void 0 === t && (t = 32),
                    this._subdivisionsX = e,
                    this._subdivisionsY = e,
                    this.subdivide(e);
                    this.createOrUpdateSubmeshesOctree && this.createOrUpdateSubmeshesOctree(t)
                }
                ,
                r.prototype.getHeightAtCoordinates = function(t, r) {
                    var i = this.getWorldMatrix()
                      , n = e.Tmp.Matrix[5];
                    i.invertToRef(n);
                    var o = e.Tmp.Vector3[8];
                    if (e.Vector3.TransformCoordinatesFromFloatsToRef(t, 0, r, n, o),
                    t = o.x,
                    r = o.z,
                    t < this._minX || t > this._maxX || r < this._minZ || r > this._maxZ)
                        return this.position.y;
                    this._heightQuads && 0 != this._heightQuads.length || (this._initHeightQuads(),
                    this._computeHeightQuads());
                    var a = this._getFacetAt(t, r)
                      , s = -(a.x * t + a.z * r + a.w) / a.y;
                    return e.Vector3.TransformCoordinatesFromFloatsToRef(0, s, 0, i, o),
                    o.y
                }
                ,
                r.prototype.getNormalAtCoordinates = function(t, r) {
                    var i = new e.Vector3(0,1,0);
                    return this.getNormalAtCoordinatesToRef(t, r, i),
                    i
                }
                ,
                r.prototype.getNormalAtCoordinatesToRef = function(t, r, i) {
                    var n = this.getWorldMatrix()
                      , o = e.Tmp.Matrix[5];
                    n.invertToRef(o);
                    var a = e.Tmp.Vector3[8];
                    if (e.Vector3.TransformCoordinatesFromFloatsToRef(t, 0, r, o, a),
                    t = a.x,
                    r = a.z,
                    t < this._minX || t > this._maxX || r < this._minZ || r > this._maxZ)
                        return this;
                    this._heightQuads && 0 != this._heightQuads.length || (this._initHeightQuads(),
                    this._computeHeightQuads());
                    var s = this._getFacetAt(t, r);
                    return e.Vector3.TransformNormalFromFloatsToRef(s.x, s.y, s.z, n, i),
                    this
                }
                ,
                r.prototype.updateCoordinateHeights = function() {
                    return this._heightQuads && 0 != this._heightQuads.length || this._initHeightQuads(),
                    this._computeHeightQuads(),
                    this
                }
                ,
                r.prototype._getFacetAt = function(e, t) {
                    var r = Math.floor((e + this._maxX) * this._subdivisionsX / this._width)
                      , i = Math.floor(-(t + this._maxZ) * this._subdivisionsY / this._height + this._subdivisionsY)
                      , n = this._heightQuads[i * this._subdivisionsX + r];
                    return t < n.slope.x * e + n.slope.y ? n.facet1 : n.facet2
                }
                ,
                r.prototype._initHeightQuads = function() {
                    var t = this._subdivisionsX
                      , r = this._subdivisionsY;
                    this._heightQuads = new Array;
                    for (var i = 0; i < r; i++)
                        for (var n = 0; n < t; n++) {
                            var o = {
                                slope: e.Vector2.Zero(),
                                facet1: new e.Vector4(0,0,0,0),
                                facet2: new e.Vector4(0,0,0,0)
                            };
                            this._heightQuads[i * t + n] = o
                        }
                    return this
                }
                ,
                r.prototype._computeHeightQuads = function() {
                    var t = this.getVerticesData(e.VertexBuffer.PositionKind);
                    if (!t)
                        return this;
                    for (var r = e.Tmp.Vector3[3], i = e.Tmp.Vector3[2], n = e.Tmp.Vector3[1], o = e.Tmp.Vector3[0], a = e.Tmp.Vector3[4], s = e.Tmp.Vector3[5], y = e.Tmp.Vector3[6], l = e.Tmp.Vector3[7], c = e.Tmp.Vector3[8], h = 0, u = 0, d = 0, x = 0, p = 0, f = 0, m = 0, z = this._subdivisionsX, _ = this._subdivisionsY, g = 0; g < _; g++)
                        for (var v = 0; v < z; v++) {
                            h = 3 * v,
                            u = g * (z + 1) * 3,
                            d = (g + 1) * (z + 1) * 3,
                            r.x = t[u + h],
                            r.y = t[u + h + 1],
                            r.z = t[u + h + 2],
                            i.x = t[u + h + 3],
                            i.y = t[u + h + 4],
                            i.z = t[u + h + 5],
                            n.x = t[d + h],
                            n.y = t[d + h + 1],
                            n.z = t[d + h + 2],
                            o.x = t[d + h + 3],
                            o.y = t[d + h + 4],
                            o.z = t[d + h + 5],
                            x = (o.z - r.z) / (o.x - r.x),
                            p = r.z - x * r.x,
                            i.subtractToRef(r, a),
                            n.subtractToRef(r, s),
                            o.subtractToRef(r, y),
                            e.Vector3.CrossToRef(y, s, l),
                            e.Vector3.CrossToRef(a, y, c),
                            l.normalize(),
                            c.normalize(),
                            f = -(l.x * r.x + l.y * r.y + l.z * r.z),
                            m = -(c.x * i.x + c.y * i.y + c.z * i.z);
                            var b = this._heightQuads[g * z + v];
                            b.slope.copyFromFloats(x, p),
                            b.facet1.copyFromFloats(l.x, l.y, l.z, f),
                            b.facet2.copyFromFloats(c.x, c.y, c.z, m)
                        }
                    return this
                }
                ,
                r.prototype.serialize = function(e) {
                    t.prototype.serialize.call(this, e),
                    e.subdivisionsX = this._subdivisionsX,
                    e.subdivisionsY = this._subdivisionsY,
                    e.minX = this._minX,
                    e.maxX = this._maxX,
                    e.minZ = this._minZ,
                    e.maxZ = this._maxZ,
                    e.width = this._width,
                    e.height = this._height
                }
                ,
                r.Parse = function(e, t) {
                    var i = new r(e.name,t);
                    return i._subdivisionsX = e.subdivisionsX || 1,
                    i._subdivisionsY = e.subdivisionsY || 1,
                    i._minX = e.minX,
                    i._maxX = e.maxX,
                    i._minZ = e.minZ,
                    i._maxZ = e.maxZ,
                    i._width = e.width,
                    i._height = e.height,
                    i
                }
                ,
                r
            }(e.Mesh);
            e.GroundMesh = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(e, r) {
                    var i = t.call(this, e, r.getScene()) || this;
                    return r.instances.push(i),
                    i._sourceMesh = r,
                    i.position.copyFrom(r.position),
                    i.rotation.copyFrom(r.rotation),
                    i.scaling.copyFrom(r.scaling),
                    r.rotationQuaternion && (i.rotationQuaternion = r.rotationQuaternion.clone()),
                    i.infiniteDistance = r.infiniteDistance,
                    i.setPivotMatrix(r.getPivotMatrix()),
                    i.refreshBoundingInfo(),
                    i._syncSubMeshes(),
                    i
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "InstancedMesh"
                }
                ,
                Object.defineProperty(r.prototype, "receiveShadows", {
                    get: function() {
                        return this._sourceMesh.receiveShadows
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "material", {
                    get: function() {
                        return this._sourceMesh.material
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "visibility", {
                    get: function() {
                        return this._sourceMesh.visibility
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "skeleton", {
                    get: function() {
                        return this._sourceMesh.skeleton
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "renderingGroupId", {
                    get: function() {
                        return this._sourceMesh.renderingGroupId
                    },
                    set: function(t) {
                        this._sourceMesh && t !== this._sourceMesh.renderingGroupId && e.Tools.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getTotalVertices = function() {
                    return this._sourceMesh.getTotalVertices()
                }
                ,
                Object.defineProperty(r.prototype, "sourceMesh", {
                    get: function() {
                        return this._sourceMesh
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.isReady = function(e) {
                    return void 0 === e && (e = !1),
                    this._sourceMesh.isReady(e, !0)
                }
                ,
                r.prototype.getVerticesData = function(e, t) {
                    return this._sourceMesh.getVerticesData(e, t)
                }
                ,
                r.prototype.setVerticesData = function(e, t, r, i) {
                    return this.sourceMesh && this.sourceMesh.setVerticesData(e, t, r, i),
                    this.sourceMesh
                }
                ,
                r.prototype.updateVerticesData = function(e, t, r, i) {
                    return this.sourceMesh && this.sourceMesh.updateVerticesData(e, t, r, i),
                    this.sourceMesh
                }
                ,
                r.prototype.setIndices = function(e, t) {
                    return void 0 === t && (t = null),
                    this.sourceMesh && this.sourceMesh.setIndices(e, t),
                    this.sourceMesh
                }
                ,
                r.prototype.isVerticesDataPresent = function(e) {
                    return this._sourceMesh.isVerticesDataPresent(e)
                }
                ,
                r.prototype.getIndices = function() {
                    return this._sourceMesh.getIndices()
                }
                ,
                Object.defineProperty(r.prototype, "_positions", {
                    get: function() {
                        return this._sourceMesh._positions
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.refreshBoundingInfo = function() {
                    var t = this._sourceMesh.getBoundingInfo();
                    return this._boundingInfo = new e.BoundingInfo(t.minimum.clone(),t.maximum.clone()),
                    this._updateBoundingInfo(),
                    this
                }
                ,
                r.prototype._preActivate = function() {
                    return this._currentLOD && this._currentLOD._preActivate(),
                    this
                }
                ,
                r.prototype._activate = function(e) {
                    return this._currentLOD && this._currentLOD._registerInstanceForRenderId(this, e),
                    this
                }
                ,
                r.prototype.getLOD = function(e) {
                    if (!e)
                        return this;
                    var t = this.getBoundingInfo();
                    return this._currentLOD = this.sourceMesh.getLOD(e, t.boundingSphere),
                    this._currentLOD === this.sourceMesh ? this : this._currentLOD
                }
                ,
                r.prototype._syncSubMeshes = function() {
                    if (this.releaseSubMeshes(),
                    this._sourceMesh.subMeshes)
                        for (var e = 0; e < this._sourceMesh.subMeshes.length; e++)
                            this._sourceMesh.subMeshes[e].clone(this, this._sourceMesh);
                    return this
                }
                ,
                r.prototype._generatePointsArray = function() {
                    return this._sourceMesh._generatePointsArray()
                }
                ,
                r.prototype.clone = function(t, r, i) {
                    var n = this._sourceMesh.createInstance(t);
                    if (e.Tools.DeepCopy(this, n, ["name", "subMeshes", "uniqueId"], []),
                    this.refreshBoundingInfo(),
                    r && (n.parent = r),
                    !i)
                        for (var o = 0; o < this.getScene().meshes.length; o++) {
                            var a = this.getScene().meshes[o];
                            a.parent === this && a.clone(a.name, n)
                        }
                    return n.computeWorldMatrix(!0),
                    n
                }
                ,
                r.prototype.dispose = function(e, r) {
                    void 0 === r && (r = !1);
                    var i = this._sourceMesh.instances.indexOf(this);
                    this._sourceMesh.instances.splice(i, 1),
                    t.prototype.dispose.call(this, e, r)
                }
                ,
                r
            }(e.AbstractMesh);
            e.InstancedMesh = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y) {
                    void 0 === i && (i = null),
                    void 0 === n && (n = null);
                    var l = t.call(this, r, i, n, o, a) || this;
                    l.useVertexColor = s,
                    l.useVertexAlpha = y,
                    l.color = new e.Color3(1,1,1),
                    l.alpha = 1,
                    o && (l.color = o.color.clone(),
                    l.alpha = o.alpha,
                    l.useVertexColor = o.useVertexColor,
                    l.useVertexAlpha = o.useVertexAlpha),
                    l._intersectionThreshold = .1;
                    var c = {
                        attributes: [e.VertexBuffer.PositionKind, "world0", "world1", "world2", "world3"],
                        uniforms: ["world", "viewProjection"],
                        needAlphaBlending: !0,
                        defines: []
                    };
                    return !1 === y && (c.needAlphaBlending = !1),
                    s ? (c.defines.push("#define VERTEXCOLOR"),
                    c.attributes.push(e.VertexBuffer.ColorKind)) : c.uniforms.push("color"),
                    l._colorShader = new e.ShaderMaterial("colorShader",l.getScene(),"color",c),
                    l
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "intersectionThreshold", {
                    get: function() {
                        return this._intersectionThreshold
                    },
                    set: function(t) {
                        this._intersectionThreshold !== t && (this._intersectionThreshold = t,
                        this.geometry && (this.geometry.boundingBias = new e.Vector2(0,t)))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getClassName = function() {
                    return "LinesMesh"
                }
                ,
                Object.defineProperty(r.prototype, "material", {
                    get: function() {
                        return this._colorShader
                    },
                    set: function(e) {},
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "checkCollisions", {
                    get: function() {
                        return !1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._bind = function(e, t, r) {
                    return this._geometry ? (this._geometry._bind(this._colorShader.getEffect()),
                    this.useVertexColor || this._colorShader.setColor4("color", this.color.toColor4(this.alpha)),
                    this) : this
                }
                ,
                r.prototype._draw = function(t, r, i) {
                    return this._geometry && this._geometry.getVertexBuffers() && (this._unIndexed || this._geometry.getIndexBuffer()) ? (this.getScene().getEngine().drawElementsType(e.Material.LineListDrawMode, t.indexStart, t.indexCount, i),
                    this) : this
                }
                ,
                r.prototype.dispose = function(e) {
                    this._colorShader.dispose(),
                    t.prototype.dispose.call(this, e)
                }
                ,
                r.prototype.clone = function(e, t, i) {
                    return new r(e,this.getScene(),t,this,i)
                }
                ,
                r
            }(e.Mesh);
            e.LinesMesh = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {
                    this._count = 0,
                    this._data = {}
                }
                return e.prototype.copyFrom = function(e) {
                    var t = this;
                    this.clear(),
                    e.forEach((function(e, r) {
                        return t.add(e, r)
                    }
                    ))
                }
                ,
                e.prototype.get = function(e) {
                    var t = this._data[e];
                    if (void 0 !== t)
                        return t
                }
                ,
                e.prototype.getOrAddWithFactory = function(e, t) {
                    var r = this.get(e);
                    return void 0 !== r ? r : ((r = t(e)) && this.add(e, r),
                    r)
                }
                ,
                e.prototype.getOrAdd = function(e, t) {
                    var r = this.get(e);
                    return void 0 !== r ? r : (this.add(e, t),
                    t)
                }
                ,
                e.prototype.contains = function(e) {
                    return void 0 !== this._data[e]
                }
                ,
                e.prototype.add = function(e, t) {
                    return void 0 === this._data[e] && (this._data[e] = t,
                    ++this._count,
                    !0)
                }
                ,
                e.prototype.set = function(e, t) {
                    return void 0 !== this._data[e] && (this._data[e] = t,
                    !0)
                }
                ,
                e.prototype.getAndRemove = function(e) {
                    var t = this.get(e);
                    return void 0 !== t ? (delete this._data[e],
                    --this._count,
                    t) : null
                }
                ,
                e.prototype.remove = function(e) {
                    return !!this.contains(e) && (delete this._data[e],
                    --this._count,
                    !0)
                }
                ,
                e.prototype.clear = function() {
                    this._data = {},
                    this._count = 0
                }
                ,
                Object.defineProperty(e.prototype, "count", {
                    get: function() {
                        return this._count
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype.forEach = function(e) {
                    for (var t in this._data) {
                        e(t, this._data[t])
                    }
                }
                ,
                e.prototype.first = function(e) {
                    for (var t in this._data) {
                        var r = e(t, this._data[t]);
                        if (r)
                            return r
                    }
                    return null
                }
                ,
                e
            }();
            e.StringDictionary = t
        }(s || (s = {})),
        function(e) {
            !function(t) {
                var r = function() {
                    function t(t, r, i, n, o) {
                        void 0 === n && (n = !0),
                        void 0 === o && (o = 1),
                        this.skeleton = t,
                        this.mesh = r,
                        this.autoUpdateBonesMatrices = n,
                        this.renderingGroupId = o,
                        this.color = e.Color3.White(),
                        this._debugLines = new Array,
                        this._isEnabled = !1,
                        this._scene = i,
                        this.update(),
                        this._renderFunction = this.update.bind(this)
                    }
                    return Object.defineProperty(t.prototype, "isEnabled", {
                        get: function() {
                            return this._isEnabled
                        },
                        set: function(e) {
                            this._isEnabled !== e && (this._isEnabled = e,
                            e ? this._scene.registerBeforeRender(this._renderFunction) : this._scene.unregisterBeforeRender(this._renderFunction))
                        },
                        enumerable: !0,
                        configurable: !0
                    }),
                    t.prototype._getBonePosition = function(t, r, i, n, o, a) {
                        void 0 === n && (n = 0),
                        void 0 === o && (o = 0),
                        void 0 === a && (a = 0);
                        var s = e.Tmp.Matrix[0]
                          , y = r.getParent();
                        if (s.copyFrom(r.getLocalMatrix()),
                        0 !== n || 0 !== o || 0 !== a) {
                            var l = e.Tmp.Matrix[1];
                            e.Matrix.IdentityToRef(l),
                            l.m[12] = n,
                            l.m[13] = o,
                            l.m[14] = a,
                            l.multiplyToRef(s, s)
                        }
                        y && s.multiplyToRef(y.getAbsoluteTransform(), s),
                        s.multiplyToRef(i, s),
                        t.x = s.m[12],
                        t.y = s.m[13],
                        t.z = s.m[14]
                    }
                    ,
                    t.prototype._getLinesForBonesWithLength = function(t, r) {
                        for (var i = t.length, n = this.mesh.position, o = 0; o < i; o++) {
                            var a = t[o]
                              , s = this._debugLines[o];
                            s || (s = [e.Vector3.Zero(), e.Vector3.Zero()],
                            this._debugLines[o] = s),
                            this._getBonePosition(s[0], a, r),
                            this._getBonePosition(s[1], a, r, 0, a.length, 0),
                            s[0].subtractInPlace(n),
                            s[1].subtractInPlace(n)
                        }
                    }
                    ,
                    t.prototype._getLinesForBonesNoLength = function(t, r) {
                        for (var i = t.length, n = 0, o = this.mesh.position, a = i - 1; a >= 0; a--) {
                            var s = t[a]
                              , y = s.getParent();
                            if (y) {
                                var l = this._debugLines[n];
                                l || (l = [e.Vector3.Zero(), e.Vector3.Zero()],
                                this._debugLines[n] = l),
                                s.getAbsolutePositionToRef(this.mesh, l[0]),
                                y.getAbsolutePositionToRef(this.mesh, l[1]),
                                l[0].subtractInPlace(o),
                                l[1].subtractInPlace(o),
                                n++
                            }
                        }
                    }
                    ,
                    t.prototype.update = function() {
                        this.autoUpdateBonesMatrices && this.skeleton.computeAbsoluteTransforms(),
                        void 0 === this.skeleton.bones[0].length ? this._getLinesForBonesNoLength(this.skeleton.bones, this.mesh.getWorldMatrix()) : this._getLinesForBonesWithLength(this.skeleton.bones, this.mesh.getWorldMatrix()),
                        this._debugMesh ? e.MeshBuilder.CreateLineSystem("", {
                            lines: this._debugLines,
                            updatable: !0,
                            instance: this._debugMesh
                        }, this._scene) : (this._debugMesh = e.MeshBuilder.CreateLineSystem("", {
                            lines: this._debugLines,
                            updatable: !0,
                            instance: null
                        }, this._scene),
                        this._debugMesh.renderingGroupId = this.renderingGroupId),
                        this._debugMesh.position.copyFrom(this.mesh.position),
                        this._debugMesh.color = this.color
                    }
                    ,
                    t.prototype.dispose = function() {
                        this._debugMesh && (this.isEnabled = !1,
                        this._debugMesh.dispose(),
                        this._debugMesh = null)
                    }
                    ,
                    t
                }();
                t.SkeletonViewer = r
            }(e.Debug || (e.Debug = {}))
        }(s || (s = {})),
        function(e) {
            !function(t) {
                var r = function() {
                    function t(t, r) {
                        void 0 === r && (r = 1),
                        this._xline = [e.Vector3.Zero(), e.Vector3.Zero()],
                        this._yline = [e.Vector3.Zero(), e.Vector3.Zero()],
                        this._zline = [e.Vector3.Zero(), e.Vector3.Zero()],
                        this.scaleLines = 1,
                        this.scaleLines = r,
                        this._xmesh = e.Mesh.CreateLines("xline", this._xline, t, !0),
                        this._ymesh = e.Mesh.CreateLines("yline", this._yline, t, !0),
                        this._zmesh = e.Mesh.CreateLines("zline", this._zline, t, !0),
                        this._xmesh.renderingGroupId = 2,
                        this._ymesh.renderingGroupId = 2,
                        this._zmesh.renderingGroupId = 2,
                        this._xmesh.material.checkReadyOnlyOnce = !0,
                        this._xmesh.color = new e.Color3(1,0,0),
                        this._ymesh.material.checkReadyOnlyOnce = !0,
                        this._ymesh.color = new e.Color3(0,1,0),
                        this._zmesh.material.checkReadyOnlyOnce = !0,
                        this._zmesh.color = new e.Color3(0,0,1),
                        this.scene = t
                    }
                    return t.prototype.update = function(t, r, i, n) {
                        var o = this.scaleLines;
                        this._xmesh && this._xmesh.position.copyFrom(t),
                        this._ymesh && this._ymesh.position.copyFrom(t),
                        this._zmesh && this._zmesh.position.copyFrom(t);
                        var a = this._xline[1];
                        a.x = r.x * o,
                        a.y = r.y * o,
                        a.z = r.z * o,
                        e.Mesh.CreateLines("", this._xline, null, !1, this._xmesh),
                        (a = this._yline[1]).x = i.x * o,
                        a.y = i.y * o,
                        a.z = i.z * o,
                        e.Mesh.CreateLines("", this._yline, null, !1, this._ymesh),
                        (a = this._zline[1]).x = n.x * o,
                        a.y = n.y * o,
                        a.z = n.z * o,
                        e.Mesh.CreateLines("", this._zline, null, !1, this._zmesh)
                    }
                    ,
                    t.prototype.dispose = function() {
                        this._xmesh && this._xmesh.dispose(),
                        this._ymesh && this._ymesh.dispose(),
                        this._zmesh && this._zmesh.dispose(),
                        this._xmesh = null,
                        this._ymesh = null,
                        this._zmesh = null,
                        this.scene = null
                    }
                    ,
                    t
                }();
                t.AxesViewer = r
            }(e.Debug || (e.Debug = {}))
        }(s || (s = {})),
        function(e) {
            !function(t) {
                var r = function(t) {
                    function r(r, i, n, o) {
                        void 0 === o && (o = 1);
                        var a = t.call(this, r, o) || this;
                        return a.pos = e.Vector3.Zero(),
                        a.xaxis = e.Vector3.Zero(),
                        a.yaxis = e.Vector3.Zero(),
                        a.zaxis = e.Vector3.Zero(),
                        a.mesh = n,
                        a.bone = i,
                        a
                    }
                    return o(r, t),
                    r.prototype.update = function() {
                        if (this.mesh && this.bone) {
                            var r = this.bone;
                            r.getAbsolutePositionToRef(this.mesh, this.pos),
                            r.getDirectionToRef(e.Axis.X, this.mesh, this.xaxis),
                            r.getDirectionToRef(e.Axis.Y, this.mesh, this.yaxis),
                            r.getDirectionToRef(e.Axis.Z, this.mesh, this.zaxis),
                            t.prototype.update.call(this, this.pos, this.xaxis, this.yaxis, this.zaxis)
                        }
                    }
                    ,
                    r.prototype.dispose = function() {
                        this.mesh && (this.mesh = null,
                        this.bone = null,
                        t.prototype.dispose.call(this))
                    }
                    ,
                    r
                }(t.AxesViewer);
                t.BoneAxesViewer = r
            }(e.Debug || (e.Debug = {}))
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e) {
                    this.ray = e
                }
                return t.CreateAndShow = function(e, r, i) {
                    var n = new t(e);
                    return n.show(r, i),
                    n
                }
                ,
                t.prototype.show = function(t, r) {
                    if (!this._renderFunction && this.ray) {
                        var i = this.ray;
                        this._renderFunction = this._render.bind(this),
                        this._scene = t,
                        this._renderPoints = [i.origin, i.origin.add(i.direction.scale(i.length))],
                        this._renderLine = e.Mesh.CreateLines("ray", this._renderPoints, t, !0),
                        this._renderFunction && this._scene.registerBeforeRender(this._renderFunction)
                    }
                    r && this._renderLine && this._renderLine.color.copyFrom(r)
                }
                ,
                t.prototype.hide = function() {
                    this._renderFunction && this._scene && (this._scene.unregisterBeforeRender(this._renderFunction),
                    this._scene = null,
                    this._renderFunction = null,
                    this._renderLine && (this._renderLine.dispose(),
                    this._renderLine = null),
                    this._renderPoints = [])
                }
                ,
                t.prototype._render = function() {
                    var t = this.ray;
                    if (t) {
                        var r = this._renderPoints[1]
                          , i = Math.min(t.length, 1e6);
                        r.copyFrom(t.direction),
                        r.scaleInPlace(i),
                        r.addInPlace(t.origin),
                        e.Mesh.CreateLines("ray", this._renderPoints, this._scene, !0, this._renderLine)
                    }
                }
                ,
                t.prototype.attachToMesh = function(t, r, i, n) {
                    this._attachedToMesh = t;
                    var o = this.ray;
                    o && (o.direction || (o.direction = e.Vector3.Zero()),
                    o.origin || (o.origin = e.Vector3.Zero()),
                    n && (o.length = n),
                    i || (i = e.Vector3.Zero()),
                    r || (r = new e.Vector3(0,0,-1)),
                    this._meshSpaceDirection ? (this._meshSpaceDirection.copyFrom(r),
                    this._meshSpaceOrigin.copyFrom(i)) : (this._meshSpaceDirection = r.clone(),
                    this._meshSpaceOrigin = i.clone()),
                    this._updateToMeshFunction || (this._updateToMeshFunction = this._updateToMesh.bind(this),
                    this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)),
                    this._updateToMesh())
                }
                ,
                t.prototype.detachFromMesh = function() {
                    this._attachedToMesh && (this._updateToMeshFunction && this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction),
                    this._attachedToMesh = null,
                    this._updateToMeshFunction = null)
                }
                ,
                t.prototype._updateToMesh = function() {
                    var t = this.ray;
                    this._attachedToMesh && t && (this._attachedToMesh._isDisposed ? this.detachFromMesh() : (this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection, t.direction),
                    e.Vector3.TransformCoordinatesToRef(this._meshSpaceOrigin, this._attachedToMesh.getWorldMatrix(), t.origin)))
                }
                ,
                t.prototype.dispose = function() {
                    this.hide(),
                    this.detachFromMesh(),
                    this.ray = null
                }
                ,
                t
            }();
            e.RayHelper = t
        }(s || (s = {})),
        function(e) {
            Object.defineProperty(e.Scene.prototype, "debugLayer", {
                get: function() {
                    return this._debugLayer || (this._debugLayer = new t(this)),
                    this._debugLayer
                },
                enumerable: !0,
                configurable: !0
            });
            var t = function() {
                function t(t) {
                    var r = this;
                    this.BJSINSPECTOR = "undefined" != typeof INSPECTOR ? INSPECTOR : void 0,
                    this.onPropertyChangedObservable = new e.Observable,
                    this._scene = t,
                    this._scene.onDisposeObservable.add((function() {
                        r._scene._debugLayer && r._scene._debugLayer.hide()
                    }
                    ))
                }
                return t.prototype._createInspector = function(e) {
                    void 0 === e && (e = {});
                    var t = e.popup || !1
                      , r = e.initialTab || 0
                      , i = e.parentElement || null;
                    this._inspector || (this.BJSINSPECTOR = this.BJSINSPECTOR || "undefined" != typeof INSPECTOR ? INSPECTOR : void 0,
                    this._inspector = new this.BJSINSPECTOR.Inspector(this._scene,t,r,i,e.newColors))
                }
                ,
                t.prototype.isVisible = function() {
                    return !!this._inspector
                }
                ,
                t.prototype.hide = function() {
                    if (this._inspector) {
                        try {
                            this._inspector.dispose()
                        } catch (e) {}
                        this.onPropertyChangedObservable.clear(),
                        this._inspector = null
                    }
                }
                ,
                t.prototype.show = function(r) {
                    void 0 === r && (r = {}),
                    void 0 === this.BJSINSPECTOR ? e.Tools.LoadScript(t.InspectorURL, this._createInspector.bind(this, r)) : this._createInspector(r)
                }
                ,
                t.prototype.getActiveTab = function() {
                    return this._inspector ? this._inspector.getActiveTabIndex() : -1
                }
                ,
                t.InspectorURL = "https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js",
                t
            }();
            e.DebugLayer = t
        }(s || (s = {})),
        function(e) {
            !function(t) {
                var r = function() {
                    function t(t) {
                        this._impostors = [],
                        this._meshes = [],
                        this._numMeshes = 0,
                        this._scene = t || e.Engine.LastCreatedScene;
                        var r = this._scene.getPhysicsEngine();
                        r && (this._physicsEnginePlugin = r.getPhysicsPlugin())
                    }
                    return t.prototype._updateDebugMeshes = function() {
                        for (var e = this._physicsEnginePlugin, t = 0; t < this._numMeshes; t++) {
                            var r = this._impostors[t];
                            if (r)
                                if (r.isDisposed)
                                    this.hideImpostor(this._impostors[t--]);
                                else {
                                    var i = this._meshes[t];
                                    i && e && e.syncMeshWithImpostor(i, r)
                                }
                        }
                    }
                    ,
                    t.prototype.showImpostor = function(e) {
                        if (this._scene) {
                            for (var t = 0; t < this._numMeshes; t++)
                                if (this._impostors[t] == e)
                                    return;
                            var r = this._getDebugMesh(e, this._scene);
                            r && (this._impostors[this._numMeshes] = e,
                            this._meshes[this._numMeshes] = r,
                            0 === this._numMeshes && (this._renderFunction = this._updateDebugMeshes.bind(this),
                            this._scene.registerBeforeRender(this._renderFunction)),
                            this._numMeshes++)
                        }
                    }
                    ,
                    t.prototype.hideImpostor = function(e) {
                        if (e && this._scene) {
                            for (var t = !1, r = 0; r < this._numMeshes; r++)
                                if (this._impostors[r] == e) {
                                    var i = this._meshes[r];
                                    if (!i)
                                        continue;
                                    this._scene.removeMesh(i),
                                    i.dispose(),
                                    this._numMeshes--,
                                    this._numMeshes > 0 ? (this._meshes[r] = this._meshes[this._numMeshes],
                                    this._impostors[r] = this._impostors[this._numMeshes],
                                    this._meshes[this._numMeshes] = null,
                                    this._impostors[this._numMeshes] = null) : (this._meshes[0] = null,
                                    this._impostors[0] = null),
                                    t = !0;
                                    break
                                }
                            t && 0 === this._numMeshes && this._scene.unregisterBeforeRender(this._renderFunction)
                        }
                    }
                    ,
                    t.prototype._getDebugMaterial = function(t) {
                        return this._debugMaterial || (this._debugMaterial = new e.StandardMaterial("",t),
                        this._debugMaterial.wireframe = !0),
                        this._debugMaterial
                    }
                    ,
                    t.prototype._getDebugBoxMesh = function(t) {
                        return this._debugBoxMesh || (this._debugBoxMesh = e.MeshBuilder.CreateBox("physicsBodyBoxViewMesh", {
                            size: 1
                        }, t),
                        this._debugBoxMesh.renderingGroupId = 1,
                        this._debugBoxMesh.rotationQuaternion = e.Quaternion.Identity(),
                        this._debugBoxMesh.material = this._getDebugMaterial(t),
                        t.removeMesh(this._debugBoxMesh)),
                        this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")
                    }
                    ,
                    t.prototype._getDebugSphereMesh = function(t) {
                        return this._debugSphereMesh || (this._debugSphereMesh = e.MeshBuilder.CreateSphere("physicsBodySphereViewMesh", {
                            diameter: 1
                        }, t),
                        this._debugSphereMesh.renderingGroupId = 1,
                        this._debugSphereMesh.rotationQuaternion = e.Quaternion.Identity(),
                        this._debugSphereMesh.material = this._getDebugMaterial(t),
                        t.removeMesh(this._debugSphereMesh)),
                        this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")
                    }
                    ,
                    t.prototype._getDebugMesh = function(t, r) {
                        var i = null;
                        if (t.type == e.PhysicsImpostor.BoxImpostor)
                            i = this._getDebugBoxMesh(r),
                            t.getBoxSizeToRef(i.scaling);
                        else if (t.type == e.PhysicsImpostor.SphereImpostor) {
                            i = this._getDebugSphereMesh(r);
                            var n = t.getRadius();
                            i.scaling.x = 2 * n,
                            i.scaling.y = 2 * n,
                            i.scaling.z = 2 * n
                        }
                        return i
                    }
                    ,
                    t.prototype.dispose = function() {
                        for (var e = 0; e < this._numMeshes; e++)
                            this.hideImpostor(this._impostors[e]);
                        this._debugBoxMesh && this._debugBoxMesh.dispose(),
                        this._debugSphereMesh && this._debugSphereMesh.dispose(),
                        this._debugMaterial && this._debugMaterial.dispose(),
                        this._impostors.length = 0,
                        this._scene = null,
                        this._physicsEnginePlugin = null
                    }
                    ,
                    t
                }();
                t.PhysicsViewer = r
            }(e.Debug || (e.Debug = {}))
        }(s || (s = {})),
        function(e) {
            Object.defineProperty(e.Scene.prototype, "forceShowBoundingBoxes", {
                get: function() {
                    return this._forceShowBoundingBoxes || !1
                },
                set: function(e) {
                    this._forceShowBoundingBoxes = e,
                    e && this.getBoundingBoxRenderer()
                },
                enumerable: !0,
                configurable: !0
            }),
            e.Scene.prototype.getBoundingBoxRenderer = function() {
                return this._boundingBoxRenderer || (this._boundingBoxRenderer = new t(this)),
                this._boundingBoxRenderer
            }
            ,
            Object.defineProperty(e.AbstractMesh.prototype, "showBoundingBox", {
                get: function() {
                    return this._showBoundingBox || !1
                },
                set: function(e) {
                    this._showBoundingBox = e,
                    e && this.getScene().getBoundingBoxRenderer()
                },
                enumerable: !0,
                configurable: !0
            });
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_BOUNDINGBOXRENDERER,
                    this.frontColor = new e.Color3(1,1,1),
                    this.backColor = new e.Color3(.1,.1,.1),
                    this.showBackLines = !0,
                    this.renderList = new e.SmartArray(32),
                    this._vertexBuffers = {},
                    this.scene = t,
                    t._addComponent(this)
                }
                return t.prototype.register = function() {
                    this.scene._beforeEvaluateActiveMeshStage.registerStep(e.SceneComponentConstants.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER, this, this.reset),
                    this.scene._activeMeshStage.registerStep(e.SceneComponentConstants.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER, this, this._activeMesh),
                    this.scene._evaluateSubMeshStage.registerStep(e.SceneComponentConstants.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER, this, this._evaluateSubMesh),
                    this.scene._afterRenderingGroupDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER, this, this.render)
                }
                ,
                t.prototype._evaluateSubMesh = function(e, t) {
                    if (e.showSubMeshesBoundingBox) {
                        var r = t.getBoundingInfo();
                        null != r && (r.boundingBox._tag = e.renderingGroupId,
                        this.renderList.push(r.boundingBox))
                    }
                }
                ,
                t.prototype._activeMesh = function(e, t) {
                    if (e.showBoundingBox || this.scene.forceShowBoundingBoxes) {
                        var r = e.getBoundingInfo();
                        r.boundingBox._tag = t.renderingGroupId,
                        this.renderList.push(r.boundingBox)
                    }
                }
                ,
                t.prototype._prepareRessources = function() {
                    if (!this._colorShader) {
                        this._colorShader = new e.ShaderMaterial("colorShader",this.scene,"color",{
                            attributes: [e.VertexBuffer.PositionKind],
                            uniforms: ["world", "viewProjection", "color"]
                        });
                        var t = this.scene.getEngine()
                          , r = e.VertexData.CreateBox({
                            size: 1
                        });
                        this._vertexBuffers[e.VertexBuffer.PositionKind] = new e.VertexBuffer(t,r.positions,e.VertexBuffer.PositionKind,!1),
                        this._createIndexBuffer()
                    }
                }
                ,
                t.prototype._createIndexBuffer = function() {
                    var e = this.scene.getEngine();
                    this._indexBuffer = e.createIndexBuffer([0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 7, 1, 6, 2, 5, 3, 4])
                }
                ,
                t.prototype.rebuild = function() {
                    var t = this._vertexBuffers[e.VertexBuffer.PositionKind];
                    t && t._rebuild(),
                    this._createIndexBuffer()
                }
                ,
                t.prototype.reset = function() {
                    this.renderList.reset()
                }
                ,
                t.prototype.render = function(t) {
                    if (0 !== this.renderList.length && (this._prepareRessources(),
                    this._colorShader.isReady())) {
                        var r = this.scene.getEngine();
                        r.setDepthWrite(!1),
                        this._colorShader._preBind();
                        for (var i = 0; i < this.renderList.length; i++) {
                            var n = this.renderList.data[i];
                            if (n._tag === t) {
                                var o = n.minimum
                                  , a = n.maximum.subtract(o)
                                  , s = o.add(a.scale(.5))
                                  , y = e.Matrix.Scaling(a.x, a.y, a.z).multiply(e.Matrix.Translation(s.x, s.y, s.z)).multiply(n.getWorldMatrix());
                                r.bindBuffers(this._vertexBuffers, this._indexBuffer, this._colorShader.getEffect()),
                                this.showBackLines && (r.setDepthFunctionToGreaterOrEqual(),
                                this.scene.resetCachedMaterial(),
                                this._colorShader.setColor4("color", this.backColor.toColor4()),
                                this._colorShader.bind(y),
                                r.drawElementsType(e.Material.LineListDrawMode, 0, 24)),
                                r.setDepthFunctionToLess(),
                                this.scene.resetCachedMaterial(),
                                this._colorShader.setColor4("color", this.frontColor.toColor4()),
                                this._colorShader.bind(y),
                                r.drawElementsType(e.Material.LineListDrawMode, 0, 24)
                            }
                        }
                        this._colorShader.unbind(),
                        r.setDepthFunctionToLessOrEqual(),
                        r.setDepthWrite(!0)
                    }
                }
                ,
                t.prototype.renderOcclusionBoundingBox = function(t) {
                    if (this._prepareRessources(),
                    this._colorShader.isReady() && t._boundingInfo) {
                        var r = this.scene.getEngine();
                        r.setDepthWrite(!1),
                        r.setColorWrite(!1),
                        this._colorShader._preBind();
                        var i = t._boundingInfo.boundingBox
                          , n = i.minimum
                          , o = i.maximum.subtract(n)
                          , a = n.add(o.scale(.5))
                          , s = e.Matrix.Scaling(o.x, o.y, o.z).multiply(e.Matrix.Translation(a.x, a.y, a.z)).multiply(i.getWorldMatrix());
                        r.bindBuffers(this._vertexBuffers, this._indexBuffer, this._colorShader.getEffect()),
                        r.setDepthFunctionToLess(),
                        this.scene.resetCachedMaterial(),
                        this._colorShader.bind(s),
                        r.drawElementsType(e.Material.LineListDrawMode, 0, 24),
                        this._colorShader.unbind(),
                        r.setDepthFunctionToLessOrEqual(),
                        r.setDepthWrite(!0),
                        r.setColorWrite(!0)
                    }
                }
                ,
                t.prototype.dispose = function() {
                    if (this._colorShader) {
                        this.renderList.dispose(),
                        this._colorShader.dispose();
                        var t = this._vertexBuffers[e.VertexBuffer.PositionKind];
                        t && (t.dispose(),
                        this._vertexBuffers[e.VertexBuffer.PositionKind] = null),
                        this.scene.getEngine()._releaseBuffer(this._indexBuffer)
                    }
                }
                ,
                t
            }();
            e.BoundingBoxRenderer = t
        }(s || (s = {})),
        function(e) {
            e.Engine.prototype.createTransformFeedback = function() {
                return this._gl.createTransformFeedback()
            }
            ,
            e.Engine.prototype.deleteTransformFeedback = function(e) {
                this._gl.deleteTransformFeedback(e)
            }
            ,
            e.Engine.prototype.bindTransformFeedback = function(e) {
                this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK, e)
            }
            ,
            e.Engine.prototype.beginTransformFeedback = function(e) {
                void 0 === e && (e = !0),
                this._gl.beginTransformFeedback(e ? this._gl.POINTS : this._gl.TRIANGLES)
            }
            ,
            e.Engine.prototype.endTransformFeedback = function() {
                this._gl.endTransformFeedback()
            }
            ,
            e.Engine.prototype.setTranformFeedbackVaryings = function(e, t) {
                this._gl.transformFeedbackVaryings(e, t, this._gl.INTERLEAVED_ATTRIBS)
            }
            ,
            e.Engine.prototype.bindTransformFeedbackBuffer = function(e) {
                this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER, 0, e)
            }
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o) {
                    void 0 === o && (o = !1);
                    var s = t.call(this, r) || this;
                    s.layerMask = 268435455,
                    s._accumulatedCount = 0,
                    s._targetIndex = 0,
                    s._currentRenderId = -1,
                    s._started = !1,
                    s._stopped = !1,
                    s._timeDelta = 0,
                    s._attributesStrideSize = 21,
                    s._actualFrame = 0,
                    s._rawTextureWidth = 256,
                    s.onDisposeObservable = new e.Observable,
                    s.forceDepthWrite = !1,
                    s._preWarmDone = !1,
                    s._scene = n || e.Engine.LastCreatedScene,
                    s._attachImageProcessingConfiguration(null),
                    s._engine = s._scene.getEngine(),
                    i.randomTextureSize || delete i.randomTextureSize;
                    var y = a({
                        capacity: 5e4,
                        randomTextureSize: s._engine.getCaps().maxTextureSize
                    }, i)
                      , l = i;
                    isFinite(l) && (y.capacity = l),
                    s._capacity = y.capacity,
                    s._activeCount = y.capacity,
                    s._currentActiveCount = 0,
                    s._isAnimationSheetEnabled = o,
                    s._scene.particleSystems.push(s),
                    s._updateEffectOptions = {
                        attributes: ["position", "age", "life", "seed", "size", "color", "direction", "initialDirection", "angle", "cellIndex", "cellStartOffset", "noiseCoordinates1", "noiseCoordinates2"],
                        uniformsNames: ["currentCount", "timeDelta", "emitterWM", "lifeTime", "color1", "color2", "sizeRange", "scaleRange", "gravity", "emitPower", "direction1", "direction2", "minEmitBox", "maxEmitBox", "radius", "directionRandomizer", "height", "coneAngle", "stopFactor", "angleRange", "radiusRange", "cellInfos", "noiseStrength", "limitVelocityDamping"],
                        uniformBuffersNames: [],
                        samplers: ["randomSampler", "randomSampler2", "sizeGradientSampler", "angularSpeedGradientSampler", "velocityGradientSampler", "limitVelocityGradientSampler", "noiseSampler", "dragGradientSampler"],
                        defines: "",
                        fallbacks: null,
                        onCompiled: null,
                        onError: null,
                        indexParameters: null,
                        maxSimultaneousLights: 0,
                        transformFeedbackVaryings: []
                    },
                    s.particleEmitterType = new e.BoxParticleEmitter;
                    for (var c = Math.min(s._engine.getCaps().maxTextureSize, y.randomTextureSize), h = [], u = 0; u < c; ++u)
                        h.push(Math.random()),
                        h.push(Math.random()),
                        h.push(Math.random()),
                        h.push(Math.random());
                    s._randomTexture = new e.RawTexture(new Float32Array(h),c,1,e.Engine.TEXTUREFORMAT_RGBA,s._scene,!1,!1,e.Texture.NEAREST_SAMPLINGMODE,e.Engine.TEXTURETYPE_FLOAT),
                    s._randomTexture.wrapU = e.Texture.WRAP_ADDRESSMODE,
                    s._randomTexture.wrapV = e.Texture.WRAP_ADDRESSMODE,
                    h = [];
                    for (u = 0; u < c; ++u)
                        h.push(Math.random()),
                        h.push(Math.random()),
                        h.push(Math.random()),
                        h.push(Math.random());
                    return s._randomTexture2 = new e.RawTexture(new Float32Array(h),c,1,e.Engine.TEXTUREFORMAT_RGBA,s._scene,!1,!1,e.Texture.NEAREST_SAMPLINGMODE,e.Engine.TEXTURETYPE_FLOAT),
                    s._randomTexture2.wrapU = e.Texture.WRAP_ADDRESSMODE,
                    s._randomTexture2.wrapV = e.Texture.WRAP_ADDRESSMODE,
                    s._randomTextureSize = c,
                    s
                }
                return o(r, t),
                Object.defineProperty(r, "IsSupported", {
                    get: function() {
                        return !!e.Engine.LastCreatedEngine && e.Engine.LastCreatedEngine.webGLVersion > 1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getCapacity = function() {
                    return this._capacity
                }
                ,
                Object.defineProperty(r.prototype, "activeParticleCount", {
                    get: function() {
                        return this._activeCount
                    },
                    set: function(e) {
                        this._activeCount = Math.min(e, this._capacity)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.isReady = function() {
                    return this._updateEffect ? !!(this.emitter && this._updateEffect.isReady() && this._imageProcessingConfiguration.isReady() && this._renderEffect.isReady() && this.particleTexture && this.particleTexture.isReady()) : (this._recreateUpdateEffect(),
                    this._recreateRenderEffect(),
                    !1)
                }
                ,
                r.prototype.isStarted = function() {
                    return this._started
                }
                ,
                r.prototype.start = function(e) {
                    var t = this;
                    if (void 0 === e && (e = this.startDelay),
                    !this.targetStopDuration && this._hasTargetStopDurationDependantGradient())
                        throw "Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";
                    e ? setTimeout((function() {
                        t.start(0)
                    }
                    ), e) : (this._started = !0,
                    this._stopped = !1,
                    this._preWarmDone = !1,
                    this.beginAnimationOnStart && this.animations && this.animations.length > 0 && this.getScene().beginAnimation(this, this.beginAnimationFrom, this.beginAnimationTo, this.beginAnimationLoop))
                }
                ,
                r.prototype.stop = function() {
                    this._stopped = !0
                }
                ,
                r.prototype.reset = function() {
                    this._releaseBuffers(),
                    this._releaseVAOs(),
                    this._currentActiveCount = 0,
                    this._targetIndex = 0
                }
                ,
                r.prototype.getClassName = function() {
                    return "GPUParticleSystem"
                }
                ,
                r.prototype._removeGradientAndTexture = function(e, r, i) {
                    return t.prototype._removeGradientAndTexture.call(this, e, r, i),
                    this._releaseBuffers(),
                    this
                }
                ,
                r.prototype.addColorGradient = function(t, r, i) {
                    this._colorGradients || (this._colorGradients = []);
                    var n = new e.ColorGradient;
                    return n.gradient = t,
                    n.color1 = r,
                    this._colorGradients.push(n),
                    this._colorGradients.sort((function(e, t) {
                        return e.gradient < t.gradient ? -1 : e.gradient > t.gradient ? 1 : 0
                    }
                    )),
                    this._colorGradientsTexture && (this._colorGradientsTexture.dispose(),
                    this._colorGradientsTexture = null),
                    this._releaseBuffers(),
                    this
                }
                ,
                r.prototype.removeColorGradient = function(e) {
                    return this._removeGradientAndTexture(e, this._colorGradients, this._colorGradientsTexture),
                    this._colorGradientsTexture = null,
                    this
                }
                ,
                r.prototype._addFactorGradient = function(t, r, i) {
                    var n = new e.FactorGradient;
                    n.gradient = r,
                    n.factor1 = i,
                    t.push(n),
                    t.sort((function(e, t) {
                        return e.gradient < t.gradient ? -1 : e.gradient > t.gradient ? 1 : 0
                    }
                    )),
                    this._releaseBuffers()
                }
                ,
                r.prototype.addSizeGradient = function(e, t) {
                    return this._sizeGradients || (this._sizeGradients = []),
                    this._addFactorGradient(this._sizeGradients, e, t),
                    this._sizeGradientsTexture && (this._sizeGradientsTexture.dispose(),
                    this._sizeGradientsTexture = null),
                    this._releaseBuffers(),
                    this
                }
                ,
                r.prototype.removeSizeGradient = function(e) {
                    return this._removeGradientAndTexture(e, this._sizeGradients, this._sizeGradientsTexture),
                    this._sizeGradientsTexture = null,
                    this
                }
                ,
                r.prototype.addAngularSpeedGradient = function(e, t) {
                    return this._angularSpeedGradients || (this._angularSpeedGradients = []),
                    this._addFactorGradient(this._angularSpeedGradients, e, t),
                    this._angularSpeedGradientsTexture && (this._angularSpeedGradientsTexture.dispose(),
                    this._angularSpeedGradientsTexture = null),
                    this._releaseBuffers(),
                    this
                }
                ,
                r.prototype.removeAngularSpeedGradient = function(e) {
                    return this._removeGradientAndTexture(e, this._angularSpeedGradients, this._angularSpeedGradientsTexture),
                    this._angularSpeedGradientsTexture = null,
                    this
                }
                ,
                r.prototype.addVelocityGradient = function(e, t) {
                    return this._velocityGradients || (this._velocityGradients = []),
                    this._addFactorGradient(this._velocityGradients, e, t),
                    this._velocityGradientsTexture && (this._velocityGradientsTexture.dispose(),
                    this._velocityGradientsTexture = null),
                    this._releaseBuffers(),
                    this
                }
                ,
                r.prototype.removeVelocityGradient = function(e) {
                    return this._removeGradientAndTexture(e, this._velocityGradients, this._velocityGradientsTexture),
                    this._velocityGradientsTexture = null,
                    this
                }
                ,
                r.prototype.addLimitVelocityGradient = function(e, t) {
                    return this._limitVelocityGradients || (this._limitVelocityGradients = []),
                    this._addFactorGradient(this._limitVelocityGradients, e, t),
                    this._limitVelocityGradientsTexture && (this._limitVelocityGradientsTexture.dispose(),
                    this._limitVelocityGradientsTexture = null),
                    this._releaseBuffers(),
                    this
                }
                ,
                r.prototype.removeLimitVelocityGradient = function(e) {
                    return this._removeGradientAndTexture(e, this._limitVelocityGradients, this._limitVelocityGradientsTexture),
                    this._limitVelocityGradientsTexture = null,
                    this
                }
                ,
                r.prototype.addDragGradient = function(e, t) {
                    return this._dragGradients || (this._dragGradients = []),
                    this._addFactorGradient(this._dragGradients, e, t),
                    this._dragGradientsTexture && (this._dragGradientsTexture.dispose(),
                    this._dragGradientsTexture = null),
                    this._releaseBuffers(),
                    this
                }
                ,
                r.prototype.removeDragGradient = function(e) {
                    return this._removeGradientAndTexture(e, this._dragGradients, this._dragGradientsTexture),
                    this._dragGradientsTexture = null,
                    this
                }
                ,
                r.prototype.addEmitRateGradient = function(e, t, r) {
                    return this
                }
                ,
                r.prototype.removeEmitRateGradient = function(e) {
                    return this
                }
                ,
                r.prototype.addStartSizeGradient = function(e, t, r) {
                    return this
                }
                ,
                r.prototype.removeStartSizeGradient = function(e) {
                    return this
                }
                ,
                r.prototype.addColorRemapGradient = function(e, t, r) {
                    return this
                }
                ,
                r.prototype.removeColorRemapGradient = function(e) {
                    return this
                }
                ,
                r.prototype.addAlphaRemapGradient = function(e, t, r) {
                    return this
                }
                ,
                r.prototype.removeAlphaRemapGradient = function(e) {
                    return this
                }
                ,
                r.prototype.addRampGradient = function(e, t) {
                    return this
                }
                ,
                r.prototype.removeRampGradient = function(e) {
                    return this
                }
                ,
                r.prototype.getRampGradients = function() {
                    return null
                }
                ,
                Object.defineProperty(r.prototype, "useRampGradients", {
                    get: function() {
                        return !1
                    },
                    set: function(e) {},
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.addLifeTimeGradient = function(e, t, r) {
                    return this
                }
                ,
                r.prototype.removeLifeTimeGradient = function(e) {
                    return this
                }
                ,
                r.prototype._reset = function() {
                    this._releaseBuffers()
                }
                ,
                r.prototype._createUpdateVAO = function(e) {
                    var t = {};
                    t.position = e.createVertexBuffer("position", 0, 3),
                    t.age = e.createVertexBuffer("age", 3, 1),
                    t.life = e.createVertexBuffer("life", 4, 1),
                    t.seed = e.createVertexBuffer("seed", 5, 4),
                    t.size = e.createVertexBuffer("size", 9, 3);
                    var r = 12;
                    this._colorGradientsTexture || (t.color = e.createVertexBuffer("color", r, 4),
                    r += 4),
                    t.direction = e.createVertexBuffer("direction", r, 3),
                    r += 3,
                    this._isBillboardBased || (t.initialDirection = e.createVertexBuffer("initialDirection", r, 3),
                    r += 3),
                    this._angularSpeedGradientsTexture ? (t.angle = e.createVertexBuffer("angle", r, 1),
                    r += 1) : (t.angle = e.createVertexBuffer("angle", r, 2),
                    r += 2),
                    this._isAnimationSheetEnabled && (t.cellIndex = e.createVertexBuffer("cellIndex", r, 1),
                    r += 1,
                    this.spriteRandomStartCell && (t.cellStartOffset = e.createVertexBuffer("cellStartOffset", r, 1),
                    r += 1)),
                    this.noiseTexture && (t.noiseCoordinates1 = e.createVertexBuffer("noiseCoordinates1", r, 3),
                    r += 3,
                    t.noiseCoordinates2 = e.createVertexBuffer("noiseCoordinates2", r, 3),
                    r += 3);
                    var i = this._engine.recordVertexArrayObject(t, null, this._updateEffect);
                    return this._engine.bindArrayBuffer(null),
                    i
                }
                ,
                r.prototype._createRenderVAO = function(t, r) {
                    var i = {};
                    i.position = t.createVertexBuffer("position", 0, 3, this._attributesStrideSize, !0),
                    i.age = t.createVertexBuffer("age", 3, 1, this._attributesStrideSize, !0),
                    i.life = t.createVertexBuffer("life", 4, 1, this._attributesStrideSize, !0),
                    i.size = t.createVertexBuffer("size", 9, 3, this._attributesStrideSize, !0);
                    var n = 12;
                    this._colorGradientsTexture || (i.color = t.createVertexBuffer("color", n, 4, this._attributesStrideSize, !0),
                    n += 4),
                    this.billboardMode === e.ParticleSystem.BILLBOARDMODE_STRETCHED && (i.direction = t.createVertexBuffer("direction", n, 3, this._attributesStrideSize, !0)),
                    n += 3,
                    this._isBillboardBased || (i.initialDirection = t.createVertexBuffer("initialDirection", n, 3, this._attributesStrideSize, !0),
                    n += 3),
                    i.angle = t.createVertexBuffer("angle", n, 1, this._attributesStrideSize, !0),
                    this._angularSpeedGradientsTexture ? n++ : n += 2,
                    this._isAnimationSheetEnabled && (i.cellIndex = t.createVertexBuffer("cellIndex", n, 1, this._attributesStrideSize, !0),
                    n += 1,
                    this.spriteRandomStartCell && (i.cellStartOffset = t.createVertexBuffer("cellStartOffset", n, 1, this._attributesStrideSize, !0),
                    n += 1)),
                    this.noiseTexture && (i.noiseCoordinates1 = t.createVertexBuffer("noiseCoordinates1", n, 3, this._attributesStrideSize, !0),
                    n += 3,
                    i.noiseCoordinates2 = t.createVertexBuffer("noiseCoordinates2", n, 3, this._attributesStrideSize, !0),
                    n += 3),
                    i.offset = r.createVertexBuffer("offset", 0, 2),
                    i.uv = r.createVertexBuffer("uv", 2, 2);
                    var o = this._engine.recordVertexArrayObject(i, null, this._renderEffect);
                    return this._engine.bindArrayBuffer(null),
                    o
                }
                ,
                r.prototype._initialize = function(t) {
                    if (void 0 === t && (t = !1),
                    !this._buffer0 || t) {
                        var r = this._scene.getEngine()
                          , i = new Array;
                        this.isBillboardBased || (this._attributesStrideSize += 3),
                        this._colorGradientsTexture && (this._attributesStrideSize -= 4),
                        this._angularSpeedGradientsTexture && (this._attributesStrideSize -= 1),
                        this._isAnimationSheetEnabled && (this._attributesStrideSize += 1,
                        this.spriteRandomStartCell && (this._attributesStrideSize += 1)),
                        this.noiseTexture && (this._attributesStrideSize += 6);
                        for (var n = 0; n < this._capacity; n++)
                            i.push(0),
                            i.push(0),
                            i.push(0),
                            i.push(0),
                            i.push(0),
                            i.push(Math.random()),
                            i.push(Math.random()),
                            i.push(Math.random()),
                            i.push(Math.random()),
                            i.push(0),
                            i.push(0),
                            i.push(0),
                            this._colorGradientsTexture || (i.push(0),
                            i.push(0),
                            i.push(0),
                            i.push(0)),
                            i.push(0),
                            i.push(0),
                            i.push(0),
                            this.isBillboardBased || (i.push(0),
                            i.push(0),
                            i.push(0)),
                            i.push(0),
                            this._angularSpeedGradientsTexture || i.push(0),
                            this._isAnimationSheetEnabled && (i.push(0),
                            this.spriteRandomStartCell && i.push(0)),
                            this.noiseTexture && (i.push(Math.random()),
                            i.push(Math.random()),
                            i.push(Math.random()),
                            i.push(Math.random()),
                            i.push(Math.random()),
                            i.push(Math.random()));
                        var o = new Float32Array([.5, .5, 1, 1, -.5, .5, 0, 1, -.5, -.5, 0, 0, .5, -.5, 1, 0]);
                        this._buffer0 = new e.Buffer(r,i,!1,this._attributesStrideSize),
                        this._buffer1 = new e.Buffer(r,i,!1,this._attributesStrideSize),
                        this._spriteBuffer = new e.Buffer(r,o,!1,4),
                        this._updateVAO = [],
                        this._updateVAO.push(this._createUpdateVAO(this._buffer0)),
                        this._updateVAO.push(this._createUpdateVAO(this._buffer1)),
                        this._renderVAO = [],
                        this._renderVAO.push(this._createRenderVAO(this._buffer1, this._spriteBuffer)),
                        this._renderVAO.push(this._createRenderVAO(this._buffer0, this._spriteBuffer)),
                        this._sourceBuffer = this._buffer0,
                        this._targetBuffer = this._buffer1
                    }
                }
                ,
                r.prototype._recreateUpdateEffect = function() {
                    var t = this.particleEmitterType ? this.particleEmitterType.getEffectDefines() : "";
                    this._isBillboardBased && (t += "\n#define BILLBOARD"),
                    this._colorGradientsTexture && (t += "\n#define COLORGRADIENTS"),
                    this._sizeGradientsTexture && (t += "\n#define SIZEGRADIENTS"),
                    this._angularSpeedGradientsTexture && (t += "\n#define ANGULARSPEEDGRADIENTS"),
                    this._velocityGradientsTexture && (t += "\n#define VELOCITYGRADIENTS"),
                    this._limitVelocityGradientsTexture && (t += "\n#define LIMITVELOCITYGRADIENTS"),
                    this._dragGradientsTexture && (t += "\n#define DRAGGRADIENTS"),
                    this.isAnimationSheetEnabled && (t += "\n#define ANIMATESHEET",
                    this.spriteRandomStartCell && (t += "\n#define ANIMATESHEETRANDOMSTART")),
                    this.noiseTexture && (t += "\n#define NOISE"),
                    this._updateEffect && this._updateEffectOptions.defines === t || (this._updateEffectOptions.transformFeedbackVaryings = ["outPosition", "outAge", "outLife", "outSeed", "outSize"],
                    this._colorGradientsTexture || this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),
                    this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),
                    this._isBillboardBased || this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),
                    this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),
                    this.isAnimationSheetEnabled && (this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),
                    this.spriteRandomStartCell && this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),
                    this.noiseTexture && (this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),
                    this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),
                    this._updateEffectOptions.defines = t,
                    this._updateEffect = new e.Effect("gpuUpdateParticles",this._updateEffectOptions,this._scene.getEngine()))
                }
                ,
                r.prototype._recreateRenderEffect = function() {
                    var t = "";
                    if (this._scene.clipPlane && (t = "\n#define CLIPPLANE"),
                    this._scene.clipPlane2 && (t = "\n#define CLIPPLANE2"),
                    this._scene.clipPlane3 && (t = "\n#define CLIPPLANE3"),
                    this._scene.clipPlane4 && (t = "\n#define CLIPPLANE4"),
                    this.blendMode === e.ParticleSystem.BLENDMODE_MULTIPLY && (t = "\n#define BLENDMULTIPLYMODE"),
                    this._isBillboardBased)
                        switch (t += "\n#define BILLBOARD",
                        this.billboardMode) {
                        case e.ParticleSystem.BILLBOARDMODE_Y:
                            t += "\n#define BILLBOARDY";
                            break;
                        case e.ParticleSystem.BILLBOARDMODE_STRETCHED:
                            t += "\n#define BILLBOARDSTRETCHED";
                            break;
                        case e.ParticleSystem.BILLBOARDMODE_ALL:
                        }
                    if (this._colorGradientsTexture && (t += "\n#define COLORGRADIENTS"),
                    this.isAnimationSheetEnabled && (t += "\n#define ANIMATESHEET"),
                    this._imageProcessingConfiguration && (this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),
                    t += "\n" + this._imageProcessingConfigurationDefines.toString()),
                    !this._renderEffect || this._renderEffect.defines !== t) {
                        var r = ["view", "projection", "colorDead", "invView", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "sheetInfos", "translationPivot", "eyePosition"]
                          , i = ["textureSampler", "colorGradientSampler"];
                        e.ImageProcessingConfiguration && (e.ImageProcessingConfiguration.PrepareUniforms(r, this._imageProcessingConfigurationDefines),
                        e.ImageProcessingConfiguration.PrepareSamplers(i, this._imageProcessingConfigurationDefines)),
                        this._renderEffect = new e.Effect("gpuRenderParticles",["position", "age", "life", "size", "color", "offset", "uv", "direction", "initialDirection", "angle", "cellIndex"],r,i,this._scene.getEngine(),t)
                    }
                }
                ,
                r.prototype.animate = function(e) {
                    void 0 === e && (e = !1),
                    this._timeDelta = this.updateSpeed * (e ? this.preWarmStepOffset : this._scene.getAnimationRatio()),
                    this._actualFrame += this._timeDelta,
                    this._stopped || this.targetStopDuration && this._actualFrame >= this.targetStopDuration && this.stop()
                }
                ,
                r.prototype._createFactorGradientTexture = function(t, r) {
                    var i = this[r];
                    if (t && t.length && !i) {
                        for (var n = new Float32Array(this._rawTextureWidth), o = 0; o < this._rawTextureWidth; o++) {
                            var a = o / this._rawTextureWidth;
                            e.Tools.GetCurrentGradient(a, t, (function(t, r, i) {
                                n[o] = e.Scalar.Lerp(t.factor1, r.factor1, i)
                            }
                            ))
                        }
                        this[r] = e.RawTexture.CreateRTexture(n, this._rawTextureWidth, 1, this._scene, !1, !1, e.Texture.NEAREST_SAMPLINGMODE)
                    }
                }
                ,
                r.prototype._createSizeGradientTexture = function() {
                    this._createFactorGradientTexture(this._sizeGradients, "_sizeGradientsTexture")
                }
                ,
                r.prototype._createAngularSpeedGradientTexture = function() {
                    this._createFactorGradientTexture(this._angularSpeedGradients, "_angularSpeedGradientsTexture")
                }
                ,
                r.prototype._createVelocityGradientTexture = function() {
                    this._createFactorGradientTexture(this._velocityGradients, "_velocityGradientsTexture")
                }
                ,
                r.prototype._createLimitVelocityGradientTexture = function() {
                    this._createFactorGradientTexture(this._limitVelocityGradients, "_limitVelocityGradientsTexture")
                }
                ,
                r.prototype._createDragGradientTexture = function() {
                    this._createFactorGradientTexture(this._dragGradients, "_dragGradientsTexture")
                }
                ,
                r.prototype._createColorGradientTexture = function() {
                    if (this._colorGradients && this._colorGradients.length && !this._colorGradientsTexture) {
                        for (var t = new Uint8Array(4 * this._rawTextureWidth), r = e.Tmp.Color4[0], i = 0; i < this._rawTextureWidth; i++) {
                            var n = i / this._rawTextureWidth;
                            e.Tools.GetCurrentGradient(n, this._colorGradients, (function(n, o, a) {
                                e.Color4.LerpToRef(n.color1, o.color1, a, r),
                                t[4 * i] = 255 * r.r,
                                t[4 * i + 1] = 255 * r.g,
                                t[4 * i + 2] = 255 * r.b,
                                t[4 * i + 3] = 255 * r.a
                            }
                            ))
                        }
                        this._colorGradientsTexture = e.RawTexture.CreateRGBATexture(t, this._rawTextureWidth, 1, this._scene, !1, !1, e.Texture.NEAREST_SAMPLINGMODE)
                    }
                }
                ,
                r.prototype.render = function(t) {
                    if (void 0 === t && (t = !1),
                    !this._started)
                        return 0;
                    if (this._createColorGradientTexture(),
                    this._createSizeGradientTexture(),
                    this._createAngularSpeedGradientTexture(),
                    this._createVelocityGradientTexture(),
                    this._createLimitVelocityGradientTexture(),
                    this._createDragGradientTexture(),
                    this._recreateUpdateEffect(),
                    this._recreateRenderEffect(),
                    !this.isReady())
                        return 0;
                    if (!t) {
                        if (!this._preWarmDone && this.preWarmCycles) {
                            for (var r = 0; r < this.preWarmCycles; r++)
                                this.animate(!0),
                                this.render(!0);
                            this._preWarmDone = !0
                        }
                        if (this._currentRenderId === this._scene.getRenderId())
                            return 0;
                        this._currentRenderId = this._scene.getRenderId()
                    }
                    if (this._initialize(),
                    this._accumulatedCount += this.emitRate * this._timeDelta,
                    this._accumulatedCount > 1) {
                        var i = 0 | this._accumulatedCount;
                        this._accumulatedCount -= i,
                        this._currentActiveCount = Math.min(this._activeCount, this._currentActiveCount + i)
                    }
                    if (!this._currentActiveCount)
                        return 0;
                    var n;
                    if (this._engine.enableEffect(this._updateEffect),
                    this._engine.setState(!1),
                    this._updateEffect.setFloat("currentCount", this._currentActiveCount),
                    this._updateEffect.setFloat("timeDelta", this._timeDelta),
                    this._updateEffect.setFloat("stopFactor", this._stopped ? 0 : 1),
                    this._updateEffect.setTexture("randomSampler", this._randomTexture),
                    this._updateEffect.setTexture("randomSampler2", this._randomTexture2),
                    this._updateEffect.setFloat2("lifeTime", this.minLifeTime, this.maxLifeTime),
                    this._updateEffect.setFloat2("emitPower", this.minEmitPower, this.maxEmitPower),
                    this._colorGradientsTexture || (this._updateEffect.setDirectColor4("color1", this.color1),
                    this._updateEffect.setDirectColor4("color2", this.color2)),
                    this._updateEffect.setFloat2("sizeRange", this.minSize, this.maxSize),
                    this._updateEffect.setFloat4("scaleRange", this.minScaleX, this.maxScaleX, this.minScaleY, this.maxScaleY),
                    this._updateEffect.setFloat4("angleRange", this.minAngularSpeed, this.maxAngularSpeed, this.minInitialRotation, this.maxInitialRotation),
                    this._updateEffect.setVector3("gravity", this.gravity),
                    this._sizeGradientsTexture && this._updateEffect.setTexture("sizeGradientSampler", this._sizeGradientsTexture),
                    this._angularSpeedGradientsTexture && this._updateEffect.setTexture("angularSpeedGradientSampler", this._angularSpeedGradientsTexture),
                    this._velocityGradientsTexture && this._updateEffect.setTexture("velocityGradientSampler", this._velocityGradientsTexture),
                    this._limitVelocityGradientsTexture && (this._updateEffect.setTexture("limitVelocityGradientSampler", this._limitVelocityGradientsTexture),
                    this._updateEffect.setFloat("limitVelocityDamping", this.limitVelocityDamping)),
                    this._dragGradientsTexture && this._updateEffect.setTexture("dragGradientSampler", this._dragGradientsTexture),
                    this.particleEmitterType && this.particleEmitterType.applyToShader(this._updateEffect),
                    this._isAnimationSheetEnabled && this._updateEffect.setFloat3("cellInfos", this.startSpriteCellID, this.endSpriteCellID, this.spriteCellChangeSpeed),
                    this.noiseTexture && (this._updateEffect.setTexture("noiseSampler", this.noiseTexture),
                    this._updateEffect.setVector3("noiseStrength", this.noiseStrength)),
                    this.emitter.position) {
                        n = this.emitter.getWorldMatrix()
                    } else {
                        var o = this.emitter;
                        n = e.Matrix.Translation(o.x, o.y, o.z)
                    }
                    if (this._updateEffect.setMatrix("emitterWM", n),
                    this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex], null),
                    this._engine.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),
                    this._engine.setRasterizerState(!1),
                    this._engine.beginTransformFeedback(!0),
                    this._engine.drawArraysType(e.Material.PointListDrawMode, 0, this._currentActiveCount),
                    this._engine.endTransformFeedback(),
                    this._engine.setRasterizerState(!0),
                    this._engine.bindTransformFeedbackBuffer(null),
                    !t) {
                        this._engine.enableEffect(this._renderEffect);
                        var a = this._scene.getViewMatrix();
                        if (this._renderEffect.setMatrix("view", a),
                        this._renderEffect.setMatrix("projection", this._scene.getProjectionMatrix()),
                        this._renderEffect.setTexture("textureSampler", this.particleTexture),
                        this._renderEffect.setVector2("translationPivot", this.translationPivot),
                        this._colorGradientsTexture ? this._renderEffect.setTexture("colorGradientSampler", this._colorGradientsTexture) : this._renderEffect.setDirectColor4("colorDead", this.colorDead),
                        this._isAnimationSheetEnabled && this.particleTexture) {
                            var s = this.particleTexture.getBaseSize();
                            this._renderEffect.setFloat3("sheetInfos", this.spriteCellWidth / s.width, this.spriteCellHeight / s.height, s.width / this.spriteCellWidth)
                        }
                        if (this._isBillboardBased) {
                            var y = this._scene.activeCamera;
                            this._renderEffect.setVector3("eyePosition", y.globalPosition)
                        }
                        if (this._scene.clipPlane || this._scene.clipPlane2 || this._scene.clipPlane3 || this._scene.clipPlane4) {
                            var l = a.clone();
                            l.invert(),
                            this._renderEffect.setMatrix("invView", l),
                            e.MaterialHelper.BindClipPlane(this._renderEffect, this._scene)
                        }
                        switch (this._imageProcessingConfiguration && !this._imageProcessingConfiguration.applyByPostProcess && this._imageProcessingConfiguration.bind(this._renderEffect),
                        this.blendMode) {
                        case e.ParticleSystem.BLENDMODE_ADD:
                            this._engine.setAlphaMode(e.Engine.ALPHA_ADD);
                            break;
                        case e.ParticleSystem.BLENDMODE_ONEONE:
                            this._engine.setAlphaMode(e.Engine.ALPHA_ONEONE);
                            break;
                        case e.ParticleSystem.BLENDMODE_STANDARD:
                            this._engine.setAlphaMode(e.Engine.ALPHA_COMBINE);
                            break;
                        case e.ParticleSystem.BLENDMODE_MULTIPLY:
                            this._engine.setAlphaMode(e.Engine.ALPHA_MULTIPLY)
                        }
                        this.forceDepthWrite && this._engine.setDepthWrite(!0),
                        this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex], null),
                        this._engine.drawArraysType(e.Material.TriangleFanDrawMode, 0, 4, this._currentActiveCount),
                        this._engine.setAlphaMode(e.Engine.ALPHA_DISABLE)
                    }
                    this._targetIndex++,
                    2 === this._targetIndex && (this._targetIndex = 0);
                    var c = this._sourceBuffer;
                    return this._sourceBuffer = this._targetBuffer,
                    this._targetBuffer = c,
                    this._currentActiveCount
                }
                ,
                r.prototype.rebuild = function() {
                    this._initialize(!0)
                }
                ,
                r.prototype._releaseBuffers = function() {
                    this._buffer0 && (this._buffer0.dispose(),
                    this._buffer0 = null),
                    this._buffer1 && (this._buffer1.dispose(),
                    this._buffer1 = null),
                    this._spriteBuffer && (this._spriteBuffer.dispose(),
                    this._spriteBuffer = null)
                }
                ,
                r.prototype._releaseVAOs = function() {
                    if (this._updateVAO) {
                        for (var e = 0; e < this._updateVAO.length; e++)
                            this._engine.releaseVertexArrayObject(this._updateVAO[e]);
                        this._updateVAO = [];
                        for (e = 0; e < this._renderVAO.length; e++)
                            this._engine.releaseVertexArrayObject(this._renderVAO[e]);
                        this._renderVAO = []
                    }
                }
                ,
                r.prototype.dispose = function(e) {
                    void 0 === e && (e = !0);
                    var t = this._scene.particleSystems.indexOf(this);
                    t > -1 && this._scene.particleSystems.splice(t, 1),
                    this._releaseBuffers(),
                    this._releaseVAOs(),
                    this._colorGradientsTexture && (this._colorGradientsTexture.dispose(),
                    this._colorGradientsTexture = null),
                    this._sizeGradientsTexture && (this._sizeGradientsTexture.dispose(),
                    this._sizeGradientsTexture = null),
                    this._angularSpeedGradientsTexture && (this._angularSpeedGradientsTexture.dispose(),
                    this._angularSpeedGradientsTexture = null),
                    this._velocityGradientsTexture && (this._velocityGradientsTexture.dispose(),
                    this._velocityGradientsTexture = null),
                    this._limitVelocityGradientsTexture && (this._limitVelocityGradientsTexture.dispose(),
                    this._limitVelocityGradientsTexture = null),
                    this._dragGradientsTexture && (this._dragGradientsTexture.dispose(),
                    this._dragGradientsTexture = null),
                    this._randomTexture && (this._randomTexture.dispose(),
                    this._randomTexture = null),
                    this._randomTexture2 && (this._randomTexture2.dispose(),
                    this._randomTexture2 = null),
                    e && this.particleTexture && (this.particleTexture.dispose(),
                    this.particleTexture = null),
                    e && this.noiseTexture && (this.noiseTexture.dispose(),
                    this.noiseTexture = null),
                    this.onDisposeObservable.notifyObservers(this),
                    this.onDisposeObservable.clear()
                }
                ,
                r.prototype.clone = function(t, i) {
                    var n = new r(t,{
                        capacity: this._capacity,
                        randomTextureSize: this._randomTextureSize
                    },this._scene);
                    return e.Tools.DeepCopy(this, n),
                    void 0 === i && (i = this.emitter),
                    n.emitter = i,
                    this.particleTexture && (n.particleTexture = new e.Texture(this.particleTexture.url,this._scene)),
                    n
                }
                ,
                r.prototype.serialize = function() {
                    var t = {};
                    return e.ParticleSystem._Serialize(t, this),
                    t.activeParticleCount = this.activeParticleCount,
                    t
                }
                ,
                r.Parse = function(t, i, n, o) {
                    void 0 === o && (o = !1);
                    var a = new r(t.name,{
                        capacity: t.capacity,
                        randomTextureSize: t.randomTextureSize
                    },i);
                    return t.activeParticleCount && (a.activeParticleCount = t.activeParticleCount),
                    e.ParticleSystem._Parse(t, a, i, n),
                    t.preventAutoStart && (a.preventAutoStart = t.preventAutoStart),
                    o || a.preventAutoStart || a.start(),
                    a
                }
                ,
                r
            }(e.BaseParticleSystem);
            e.GPUParticleSystem = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n, o, a, s, y) {
                    void 0 === y && (y = null),
                    this.idx = 0,
                    this.color = new e.Color4(1,1,1,1),
                    this.position = e.Vector3.Zero(),
                    this.rotation = e.Vector3.Zero(),
                    this.scaling = e.Vector3.One(),
                    this.uvs = new e.Vector4(0,0,1,1),
                    this.velocity = e.Vector3.Zero(),
                    this.pivot = e.Vector3.Zero(),
                    this.translateFromPivot = !1,
                    this.alive = !0,
                    this.isVisible = !0,
                    this._pos = 0,
                    this._ind = 0,
                    this.shapeId = 0,
                    this.idxInShape = 0,
                    this._stillInvisible = !1,
                    this._rotationMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1],
                    this.parentId = null,
                    this._globalPosition = e.Vector3.Zero(),
                    this.idx = t,
                    this._pos = r,
                    this._ind = i,
                    this._model = n,
                    this.shapeId = o,
                    this.idxInShape = a,
                    this._sps = s,
                    y && (this._modelBoundingInfo = y,
                    this._boundingInfo = new e.BoundingInfo(y.minimum,y.maximum))
                }
                return Object.defineProperty(t.prototype, "scale", {
                    get: function() {
                        return this.scaling
                    },
                    set: function(e) {
                        this.scaling = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "quaternion", {
                    get: function() {
                        return this.rotationQuaternion
                    },
                    set: function(e) {
                        this.rotationQuaternion = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.intersectsMesh = function(t) {
                    return !(!this._boundingInfo || !t._boundingInfo) && (this._sps._bSphereOnly ? e.BoundingSphere.Intersects(this._boundingInfo.boundingSphere, t._boundingInfo.boundingSphere) : this._boundingInfo.intersects(t._boundingInfo, !1))
                }
                ,
                t
            }();
            e.SolidParticle = t;
            var r = function(e, t, r, i, n, o) {
                this._indicesLength = 0,
                this.shapeID = e,
                this._shape = t,
                this._indicesLength = r,
                this._shapeUV = i,
                this._positionFunction = n,
                this._vertexFunction = o
            };
            e.ModelShape = r;
            var i = function() {
                this.ind = 0,
                this.indicesLength = 0,
                this.sqDistance = 0
            };
            e.DepthSortedParticle = i
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i) {
                    this.particles = new Array,
                    this.nbParticles = 0,
                    this.billboard = !1,
                    this.recomputeNormals = !0,
                    this.counter = 0,
                    this.vars = {},
                    this._bSphereOnly = !1,
                    this._bSphereRadiusFactor = 1,
                    this._positions = new Array,
                    this._indices = new Array,
                    this._normals = new Array,
                    this._colors = new Array,
                    this._uvs = new Array,
                    this._index = 0,
                    this._updatable = !0,
                    this._pickable = !1,
                    this._isVisibilityBoxLocked = !1,
                    this._alwaysVisible = !1,
                    this._depthSort = !1,
                    this._shapeCounter = 0,
                    this._copy = new e.SolidParticle(0,0,0,null,0,0,this),
                    this._color = new e.Color4(0,0,0,0),
                    this._computeParticleColor = !0,
                    this._computeParticleTexture = !0,
                    this._computeParticleRotation = !0,
                    this._computeParticleVertex = !1,
                    this._computeBoundingBox = !1,
                    this._depthSortParticles = !0,
                    this._cam_axisZ = e.Vector3.Zero(),
                    this._cam_axisY = e.Vector3.Zero(),
                    this._cam_axisX = e.Vector3.Zero(),
                    this._axisZ = e.Axis.Z,
                    this._camDir = e.Vector3.Zero(),
                    this._camInvertedPosition = e.Vector3.Zero(),
                    this._rotMatrix = new e.Matrix,
                    this._invertMatrix = new e.Matrix,
                    this._rotated = e.Vector3.Zero(),
                    this._quaternion = new e.Quaternion,
                    this._vertex = e.Vector3.Zero(),
                    this._normal = e.Vector3.Zero(),
                    this._yaw = 0,
                    this._pitch = 0,
                    this._roll = 0,
                    this._halfroll = 0,
                    this._halfpitch = 0,
                    this._halfyaw = 0,
                    this._sinRoll = 0,
                    this._cosRoll = 0,
                    this._sinPitch = 0,
                    this._cosPitch = 0,
                    this._sinYaw = 0,
                    this._cosYaw = 0,
                    this._mustUnrotateFixedNormals = !1,
                    this._minimum = e.Vector3.Zero(),
                    this._maximum = e.Vector3.Zero(),
                    this._minBbox = e.Vector3.Zero(),
                    this._maxBbox = e.Vector3.Zero(),
                    this._particlesIntersect = !1,
                    this._depthSortFunction = function(e, t) {
                        return t.sqDistance - e.sqDistance
                    }
                    ,
                    this._needs32Bits = !1,
                    this._pivotBackTranslation = e.Vector3.Zero(),
                    this._scaledPivot = e.Vector3.Zero(),
                    this._particleHasParent = !1,
                    this.name = t,
                    this._scene = r || e.Engine.LastCreatedScene,
                    this._camera = r.activeCamera,
                    this._pickable = !!i && i.isPickable,
                    this._depthSort = !!i && i.enableDepthSort,
                    this._particlesIntersect = !!i && i.particleIntersection,
                    this._bSphereOnly = !!i && i.boundingSphereOnly,
                    this._bSphereRadiusFactor = i && i.bSphereRadiusFactor ? i.bSphereRadiusFactor : 1,
                    i && void 0 !== i.updatable ? this._updatable = i.updatable : this._updatable = !0,
                    this._pickable && (this.pickedParticles = []),
                    this._depthSort && (this.depthSortedParticles = [])
                }
                return t.prototype.buildMesh = function() {
                    if (0 === this.nbParticles) {
                        var t = e.MeshBuilder.CreateDisc("", {
                            radius: 1,
                            tessellation: 3
                        }, this._scene);
                        this.addShape(t, 1),
                        t.dispose()
                    }
                    this._indices32 = this._needs32Bits ? new Uint32Array(this._indices) : new Uint16Array(this._indices),
                    this._positions32 = new Float32Array(this._positions),
                    this._uvs32 = new Float32Array(this._uvs),
                    this._colors32 = new Float32Array(this._colors),
                    this.recomputeNormals && e.VertexData.ComputeNormals(this._positions32, this._indices32, this._normals),
                    this._normals32 = new Float32Array(this._normals),
                    this._fixedNormal32 = new Float32Array(this._normals),
                    this._mustUnrotateFixedNormals && this._unrotateFixedNormals();
                    var r = new e.VertexData;
                    r.indices = this._depthSort ? this._indices : this._indices32,
                    r.set(this._positions32, e.VertexBuffer.PositionKind),
                    r.set(this._normals32, e.VertexBuffer.NormalKind),
                    this._uvs32.length > 0 && r.set(this._uvs32, e.VertexBuffer.UVKind),
                    this._colors32.length > 0 && r.set(this._colors32, e.VertexBuffer.ColorKind);
                    var i = new e.Mesh(this.name,this._scene);
                    return r.applyToMesh(i, this._updatable),
                    this.mesh = i,
                    this.mesh.isPickable = this._pickable,
                    this._depthSort || (this._indices = null),
                    this._positions = null,
                    this._normals = null,
                    this._uvs = null,
                    this._colors = null,
                    this._updatable || (this.particles.length = 0),
                    i
                }
                ,
                t.prototype.digest = function(t, r) {
                    var i = r && r.facetNb || 1
                      , n = r && r.number || 0
                      , o = r && r.delta || 0
                      , a = t.getVerticesData(e.VertexBuffer.PositionKind)
                      , s = t.getIndices()
                      , y = t.getVerticesData(e.VertexBuffer.UVKind)
                      , l = t.getVerticesData(e.VertexBuffer.ColorKind)
                      , c = t.getVerticesData(e.VertexBuffer.NormalKind)
                      , h = 0
                      , u = s.length / 3;
                    n ? (n = n > u ? u : n,
                    i = Math.round(u / n),
                    o = 0) : i = i > u ? u : i;
                    for (var d = [], x = [], p = [], f = [], m = e.Vector3.Zero(), z = i; h < u; ) {
                        h > u - (i = z + Math.floor((1 + o) * Math.random())) && (i = u - h),
                        d.length = 0,
                        x.length = 0,
                        p.length = 0,
                        f.length = 0;
                        for (var _ = 0, g = 3 * h; g < 3 * (h + i); g++) {
                            x.push(_);
                            var v = s[g];
                            d.push(a[3 * v], a[3 * v + 1], a[3 * v + 2]),
                            y && p.push(y[2 * v], y[2 * v + 1]),
                            l && f.push(l[4 * v], l[4 * v + 1], l[4 * v + 2], l[4 * v + 3]),
                            _++
                        }
                        var b, T, E = this.nbParticles, P = this._posToShape(d), A = this._uvsToShapeUV(p);
                        for (b = 0; b < P.length; b++)
                            m.addInPlace(P[b]);
                        for (m.scaleInPlace(1 / P.length),
                        b = 0; b < P.length; b++)
                            P[b].subtractInPlace(m);
                        this._particlesIntersect && (T = new e.BoundingInfo(m,m));
                        var S = new e.ModelShape(this._shapeCounter,P,3 * i,A,null,null)
                          , M = this._positions.length
                          , C = this._indices.length;
                        this._meshBuilder(this._index, P, this._positions, x, this._indices, p, this._uvs, f, this._colors, c, this._normals, E, 0, null),
                        this._addParticle(E, M, C, S, this._shapeCounter, 0, T),
                        this.particles[this.nbParticles].position.addInPlace(m),
                        this._index += P.length,
                        E++,
                        this.nbParticles++,
                        this._shapeCounter++,
                        h += i
                    }
                    return this
                }
                ,
                t.prototype._unrotateFixedNormals = function() {
                    for (var t = 0, r = 0, i = 0; i < this.particles.length; i++) {
                        this._particle = this.particles[i],
                        this._shape = this._particle._model._shape,
                        this._particle.rotationQuaternion ? this._quaternion.copyFrom(this._particle.rotationQuaternion) : (this._yaw = this._particle.rotation.y,
                        this._pitch = this._particle.rotation.x,
                        this._roll = this._particle.rotation.z,
                        this._quaternionRotationYPR()),
                        this._quaternionToRotationMatrix(),
                        this._rotMatrix.invertToRef(this._invertMatrix);
                        for (var n = 0; n < this._shape.length; n++)
                            r = t + 3 * n,
                            e.Vector3.TransformNormalFromFloatsToRef(this._normals32[r], this._normals32[r + 1], this._normals32[r + 2], this._invertMatrix, this._normal),
                            this._fixedNormal32[r] = this._normal.x,
                            this._fixedNormal32[r + 1] = this._normal.y,
                            this._fixedNormal32[r + 2] = this._normal.z;
                        t = r + 3
                    }
                }
                ,
                t.prototype._resetCopy = function() {
                    this._copy.position.x = 0,
                    this._copy.position.y = 0,
                    this._copy.position.z = 0,
                    this._copy.rotation.x = 0,
                    this._copy.rotation.y = 0,
                    this._copy.rotation.z = 0,
                    this._copy.rotationQuaternion = null,
                    this._copy.scaling.x = 1,
                    this._copy.scaling.y = 1,
                    this._copy.scaling.z = 1,
                    this._copy.uvs.x = 0,
                    this._copy.uvs.y = 0,
                    this._copy.uvs.z = 1,
                    this._copy.uvs.w = 1,
                    this._copy.color = null,
                    this._copy.translateFromPivot = !1
                }
                ,
                t.prototype._meshBuilder = function(t, r, i, n, o, a, s, y, l, c, h, u, d, x) {
                    var p, f = 0, m = 0, z = 0;
                    for (this._resetCopy(),
                    x && x.positionFunction && (x.positionFunction(this._copy, u, d),
                    this._mustUnrotateFixedNormals = !0),
                    this._copy.rotationQuaternion ? this._quaternion.copyFrom(this._copy.rotationQuaternion) : (this._yaw = this._copy.rotation.y,
                    this._pitch = this._copy.rotation.x,
                    this._roll = this._copy.rotation.z,
                    this._quaternionRotationYPR()),
                    this._quaternionToRotationMatrix(),
                    this._scaledPivot.x = this._copy.pivot.x * this._copy.scaling.x,
                    this._scaledPivot.y = this._copy.pivot.y * this._copy.scaling.y,
                    this._scaledPivot.z = this._copy.pivot.z * this._copy.scaling.z,
                    this._copy.translateFromPivot ? this._pivotBackTranslation.copyFromFloats(0, 0, 0) : this._pivotBackTranslation.copyFrom(this._scaledPivot),
                    p = 0; p < r.length; p++)
                        this._vertex.x = r[p].x,
                        this._vertex.y = r[p].y,
                        this._vertex.z = r[p].z,
                        x && x.vertexFunction && x.vertexFunction(this._copy, this._vertex, p),
                        this._vertex.x *= this._copy.scaling.x,
                        this._vertex.y *= this._copy.scaling.y,
                        this._vertex.z *= this._copy.scaling.z,
                        this._vertex.x -= this._scaledPivot.x,
                        this._vertex.y -= this._scaledPivot.y,
                        this._vertex.z -= this._scaledPivot.z,
                        e.Vector3.TransformCoordinatesToRef(this._vertex, this._rotMatrix, this._rotated),
                        this._rotated.addInPlace(this._pivotBackTranslation),
                        i.push(this._copy.position.x + this._rotated.x, this._copy.position.y + this._rotated.y, this._copy.position.z + this._rotated.z),
                        a && (s.push((this._copy.uvs.z - this._copy.uvs.x) * a[f] + this._copy.uvs.x, (this._copy.uvs.w - this._copy.uvs.y) * a[f + 1] + this._copy.uvs.y),
                        f += 2),
                        this._copy.color ? this._color = this._copy.color : y && void 0 !== y[m] ? (this._color.r = y[m],
                        this._color.g = y[m + 1],
                        this._color.b = y[m + 2],
                        this._color.a = y[m + 3]) : (this._color.r = 1,
                        this._color.g = 1,
                        this._color.b = 1,
                        this._color.a = 1),
                        l.push(this._color.r, this._color.g, this._color.b, this._color.a),
                        m += 4,
                        !this.recomputeNormals && c && (this._normal.x = c[z],
                        this._normal.y = c[z + 1],
                        this._normal.z = c[z + 2],
                        e.Vector3.TransformNormalToRef(this._normal, this._rotMatrix, this._normal),
                        h.push(this._normal.x, this._normal.y, this._normal.z),
                        z += 3);
                    for (p = 0; p < n.length; p++) {
                        var _ = t + n[p];
                        o.push(_),
                        _ > 65535 && (this._needs32Bits = !0)
                    }
                    if (this._pickable) {
                        var g = n.length / 3;
                        for (p = 0; p < g; p++)
                            this.pickedParticles.push({
                                idx: u,
                                faceId: p
                            })
                    }
                    return this._depthSort && this.depthSortedParticles.push(new e.DepthSortedParticle),
                    this._copy
                }
                ,
                t.prototype._posToShape = function(t) {
                    for (var r = [], i = 0; i < t.length; i += 3)
                        r.push(new e.Vector3(t[i],t[i + 1],t[i + 2]));
                    return r
                }
                ,
                t.prototype._uvsToShapeUV = function(e) {
                    var t = [];
                    if (e)
                        for (var r = 0; r < e.length; r++)
                            t.push(e[r]);
                    return t
                }
                ,
                t.prototype._addParticle = function(t, r, i, n, o, a, s) {
                    void 0 === s && (s = null);
                    var y = new e.SolidParticle(t,r,i,n,o,a,this,s);
                    return this.particles.push(y),
                    y
                }
                ,
                t.prototype.addShape = function(t, r, i) {
                    var n, o = t.getVerticesData(e.VertexBuffer.PositionKind), a = t.getIndices(), s = t.getVerticesData(e.VertexBuffer.UVKind), y = t.getVerticesData(e.VertexBuffer.ColorKind), l = t.getVerticesData(e.VertexBuffer.NormalKind);
                    this._particlesIntersect && (n = t.getBoundingInfo());
                    for (var c, h, u = this._posToShape(o), d = this._uvsToShapeUV(s), x = i ? i.positionFunction : null, p = i ? i.vertexFunction : null, f = new e.ModelShape(this._shapeCounter,u,a.length,d,x,p), m = this.nbParticles, z = 0; z < r; z++) {
                        var _ = this._positions.length
                          , g = this._indices.length;
                        h = this._meshBuilder(this._index, u, this._positions, a, this._indices, s, this._uvs, y, this._colors, l, this._normals, m, z, i),
                        this._updatable && ((c = this._addParticle(m, _, g, f, this._shapeCounter, z, n)).position.copyFrom(h.position),
                        c.rotation.copyFrom(h.rotation),
                        h.rotationQuaternion && c.rotationQuaternion && c.rotationQuaternion.copyFrom(h.rotationQuaternion),
                        h.color && c.color && c.color.copyFrom(h.color),
                        c.scaling.copyFrom(h.scaling),
                        c.uvs.copyFrom(h.uvs)),
                        this._index += u.length,
                        m++
                    }
                    return this.nbParticles += r,
                    this._shapeCounter++,
                    this._shapeCounter - 1
                }
                ,
                t.prototype._rebuildParticle = function(t) {
                    this._resetCopy(),
                    t._model._positionFunction && t._model._positionFunction(this._copy, t.idx, t.idxInShape),
                    this._copy.rotationQuaternion ? this._quaternion.copyFrom(this._copy.rotationQuaternion) : (this._yaw = this._copy.rotation.y,
                    this._pitch = this._copy.rotation.x,
                    this._roll = this._copy.rotation.z,
                    this._quaternionRotationYPR()),
                    this._quaternionToRotationMatrix(),
                    this._scaledPivot.x = this._particle.pivot.x * this._particle.scaling.x,
                    this._scaledPivot.y = this._particle.pivot.y * this._particle.scaling.y,
                    this._scaledPivot.z = this._particle.pivot.z * this._particle.scaling.z,
                    this._copy.translateFromPivot ? this._pivotBackTranslation.copyFromFloats(0, 0, 0) : this._pivotBackTranslation.copyFrom(this._scaledPivot),
                    this._shape = t._model._shape;
                    for (var r = 0; r < this._shape.length; r++)
                        this._vertex.x = this._shape[r].x,
                        this._vertex.y = this._shape[r].y,
                        this._vertex.z = this._shape[r].z,
                        t._model._vertexFunction && t._model._vertexFunction(this._copy, this._vertex, r),
                        this._vertex.x *= this._copy.scaling.x,
                        this._vertex.y *= this._copy.scaling.y,
                        this._vertex.z *= this._copy.scaling.z,
                        this._vertex.x -= this._scaledPivot.x,
                        this._vertex.y -= this._scaledPivot.y,
                        this._vertex.z -= this._scaledPivot.z,
                        e.Vector3.TransformCoordinatesToRef(this._vertex, this._rotMatrix, this._rotated),
                        this._rotated.addInPlace(this._pivotBackTranslation),
                        this._positions32[t._pos + 3 * r] = this._copy.position.x + this._rotated.x,
                        this._positions32[t._pos + 3 * r + 1] = this._copy.position.y + this._rotated.y,
                        this._positions32[t._pos + 3 * r + 2] = this._copy.position.z + this._rotated.z;
                    t.position.x = 0,
                    t.position.y = 0,
                    t.position.z = 0,
                    t.rotation.x = 0,
                    t.rotation.y = 0,
                    t.rotation.z = 0,
                    t.rotationQuaternion = null,
                    t.scaling.x = 1,
                    t.scaling.y = 1,
                    t.scaling.z = 1,
                    t.uvs.x = 0,
                    t.uvs.y = 0,
                    t.uvs.z = 1,
                    t.uvs.w = 1,
                    t.pivot.x = 0,
                    t.pivot.y = 0,
                    t.pivot.z = 0,
                    t.translateFromPivot = !1,
                    t.parentId = null
                }
                ,
                t.prototype.rebuildMesh = function() {
                    for (var t = 0; t < this.particles.length; t++)
                        this._rebuildParticle(this.particles[t]);
                    return this.mesh.updateVerticesData(e.VertexBuffer.PositionKind, this._positions32, !1, !1),
                    this
                }
                ,
                t.prototype.setParticles = function(t, r, i) {
                    if (void 0 === t && (t = 0),
                    void 0 === r && (r = this.nbParticles - 1),
                    void 0 === i && (i = !0),
                    !this._updatable)
                        return this;
                    if (this.beforeUpdateParticles(t, r, i),
                    this._cam_axisX.x = 1,
                    this._cam_axisX.y = 0,
                    this._cam_axisX.z = 0,
                    this._cam_axisY.x = 0,
                    this._cam_axisY.y = 1,
                    this._cam_axisY.z = 0,
                    this._cam_axisZ.x = 0,
                    this._cam_axisZ.y = 0,
                    this._cam_axisZ.z = 1,
                    (this.billboard || this._depthSort) && (this.mesh.computeWorldMatrix(!0),
                    this.mesh._worldMatrix.invertToRef(this._invertMatrix)),
                    this.billboard) {
                        this._camera.getDirectionToRef(this._axisZ, this._camDir),
                        e.Vector3.TransformNormalToRef(this._camDir, this._invertMatrix, this._cam_axisZ),
                        this._cam_axisZ.normalize();
                        var n = this._camera.getViewMatrix(!0);
                        e.Vector3.TransformNormalFromFloatsToRef(n.m[1], n.m[5], n.m[9], this._invertMatrix, this._cam_axisY),
                        e.Vector3.CrossToRef(this._cam_axisY, this._cam_axisZ, this._cam_axisX),
                        this._cam_axisY.normalize(),
                        this._cam_axisX.normalize()
                    }
                    this._depthSort && e.Vector3.TransformCoordinatesToRef(this._camera.globalPosition, this._invertMatrix, this._camInvertedPosition),
                    e.Matrix.IdentityToRef(this._rotMatrix);
                    var o = 0
                      , a = 0
                      , s = 0
                      , y = 0
                      , l = 0
                      , c = 0
                      , h = 0;
                    this.mesh.isFacetDataEnabled && (this._computeBoundingBox = !0),
                    r = r >= this.nbParticles ? this.nbParticles - 1 : r,
                    this._computeBoundingBox && (0 == t && r == this.nbParticles - 1 ? (e.Vector3.FromFloatsToRef(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE, this._minimum),
                    e.Vector3.FromFloatsToRef(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE, this._maximum)) : this.mesh._boundingInfo && (this._minimum.copyFrom(this.mesh._boundingInfo.boundingBox.minimum),
                    this._maximum.copyFrom(this.mesh._boundingInfo.boundingBox.maximum)));
                    var u = (a = this.particles[t]._pos) / 3 | 0;
                    y = 4 * u,
                    c = 2 * u;
                    for (var d = t; d <= r; d++) {
                        if (this._particle = this.particles[d],
                        this._shape = this._particle._model._shape,
                        this._shapeUV = this._particle._model._shapeUV,
                        this.updateParticle(this._particle),
                        this._depthSort && this._depthSortParticles) {
                            var x = this.depthSortedParticles[d];
                            x.ind = this._particle._ind,
                            x.indicesLength = this._particle._model._indicesLength,
                            x.sqDistance = e.Vector3.DistanceSquared(this._particle.position, this._camInvertedPosition)
                        }
                        if (!this._particle.alive || this._particle._stillInvisible && !this._particle.isVisible)
                            a += 3 * (h = this._shape.length),
                            y += 4 * h,
                            c += 2 * h;
                        else {
                            if (this._particle.isVisible)
                                for (this._particle._stillInvisible = !1,
                                this._particleHasParent = null !== this._particle.parentId,
                                this._scaledPivot.x = this._particle.pivot.x * this._particle.scaling.x,
                                this._scaledPivot.y = this._particle.pivot.y * this._particle.scaling.y,
                                this._scaledPivot.z = this._particle.pivot.z * this._particle.scaling.z,
                                this.billboard && (this._particle.rotation.x = 0,
                                this._particle.rotation.y = 0),
                                (this._computeParticleRotation || this.billboard) && (this._particle.rotationQuaternion ? this._quaternion.copyFrom(this._particle.rotationQuaternion) : (this._yaw = this._particle.rotation.y,
                                this._pitch = this._particle.rotation.x,
                                this._roll = this._particle.rotation.z,
                                this._quaternionRotationYPR()),
                                this._quaternionToRotationMatrix()),
                                this._particleHasParent ? (this._parent = this.particles[this._particle.parentId],
                                this._rotated.x = this._particle.position.x * this._parent._rotationMatrix[0] + this._particle.position.y * this._parent._rotationMatrix[3] + this._particle.position.z * this._parent._rotationMatrix[6],
                                this._rotated.y = this._particle.position.x * this._parent._rotationMatrix[1] + this._particle.position.y * this._parent._rotationMatrix[4] + this._particle.position.z * this._parent._rotationMatrix[7],
                                this._rotated.z = this._particle.position.x * this._parent._rotationMatrix[2] + this._particle.position.y * this._parent._rotationMatrix[5] + this._particle.position.z * this._parent._rotationMatrix[8],
                                this._particle._globalPosition.x = this._parent._globalPosition.x + this._rotated.x,
                                this._particle._globalPosition.y = this._parent._globalPosition.y + this._rotated.y,
                                this._particle._globalPosition.z = this._parent._globalPosition.z + this._rotated.z,
                                (this._computeParticleRotation || this.billboard) && (this._particle._rotationMatrix[0] = this._rotMatrix.m[0] * this._parent._rotationMatrix[0] + this._rotMatrix.m[1] * this._parent._rotationMatrix[3] + this._rotMatrix.m[2] * this._parent._rotationMatrix[6],
                                this._particle._rotationMatrix[1] = this._rotMatrix.m[0] * this._parent._rotationMatrix[1] + this._rotMatrix.m[1] * this._parent._rotationMatrix[4] + this._rotMatrix.m[2] * this._parent._rotationMatrix[7],
                                this._particle._rotationMatrix[2] = this._rotMatrix.m[0] * this._parent._rotationMatrix[2] + this._rotMatrix.m[1] * this._parent._rotationMatrix[5] + this._rotMatrix.m[2] * this._parent._rotationMatrix[8],
                                this._particle._rotationMatrix[3] = this._rotMatrix.m[4] * this._parent._rotationMatrix[0] + this._rotMatrix.m[5] * this._parent._rotationMatrix[3] + this._rotMatrix.m[6] * this._parent._rotationMatrix[6],
                                this._particle._rotationMatrix[4] = this._rotMatrix.m[4] * this._parent._rotationMatrix[1] + this._rotMatrix.m[5] * this._parent._rotationMatrix[4] + this._rotMatrix.m[6] * this._parent._rotationMatrix[7],
                                this._particle._rotationMatrix[5] = this._rotMatrix.m[4] * this._parent._rotationMatrix[2] + this._rotMatrix.m[5] * this._parent._rotationMatrix[5] + this._rotMatrix.m[6] * this._parent._rotationMatrix[8],
                                this._particle._rotationMatrix[6] = this._rotMatrix.m[8] * this._parent._rotationMatrix[0] + this._rotMatrix.m[9] * this._parent._rotationMatrix[3] + this._rotMatrix.m[10] * this._parent._rotationMatrix[6],
                                this._particle._rotationMatrix[7] = this._rotMatrix.m[8] * this._parent._rotationMatrix[1] + this._rotMatrix.m[9] * this._parent._rotationMatrix[4] + this._rotMatrix.m[10] * this._parent._rotationMatrix[7],
                                this._particle._rotationMatrix[8] = this._rotMatrix.m[8] * this._parent._rotationMatrix[2] + this._rotMatrix.m[9] * this._parent._rotationMatrix[5] + this._rotMatrix.m[10] * this._parent._rotationMatrix[8])) : (this._particle._globalPosition.x = this._particle.position.x,
                                this._particle._globalPosition.y = this._particle.position.y,
                                this._particle._globalPosition.z = this._particle.position.z,
                                (this._computeParticleRotation || this.billboard) && (this._particle._rotationMatrix[0] = this._rotMatrix.m[0],
                                this._particle._rotationMatrix[1] = this._rotMatrix.m[1],
                                this._particle._rotationMatrix[2] = this._rotMatrix.m[2],
                                this._particle._rotationMatrix[3] = this._rotMatrix.m[4],
                                this._particle._rotationMatrix[4] = this._rotMatrix.m[5],
                                this._particle._rotationMatrix[5] = this._rotMatrix.m[6],
                                this._particle._rotationMatrix[6] = this._rotMatrix.m[8],
                                this._particle._rotationMatrix[7] = this._rotMatrix.m[9],
                                this._particle._rotationMatrix[8] = this._rotMatrix.m[10])),
                                this._particle.translateFromPivot ? (this._pivotBackTranslation.x = 0,
                                this._pivotBackTranslation.y = 0,
                                this._pivotBackTranslation.z = 0) : (this._pivotBackTranslation.x = this._scaledPivot.x,
                                this._pivotBackTranslation.y = this._scaledPivot.y,
                                this._pivotBackTranslation.z = this._scaledPivot.z),
                                h = 0; h < this._shape.length; h++)
                                    o = a + 3 * h,
                                    s = y + 4 * h,
                                    l = c + 2 * h,
                                    this._vertex.x = this._shape[h].x,
                                    this._vertex.y = this._shape[h].y,
                                    this._vertex.z = this._shape[h].z,
                                    this._computeParticleVertex && this.updateParticleVertex(this._particle, this._vertex, h),
                                    this._vertex.x *= this._particle.scaling.x,
                                    this._vertex.y *= this._particle.scaling.y,
                                    this._vertex.z *= this._particle.scaling.z,
                                    this._vertex.x -= this._scaledPivot.x,
                                    this._vertex.y -= this._scaledPivot.y,
                                    this._vertex.z -= this._scaledPivot.z,
                                    this._rotated.x = this._vertex.x * this._particle._rotationMatrix[0] + this._vertex.y * this._particle._rotationMatrix[3] + this._vertex.z * this._particle._rotationMatrix[6],
                                    this._rotated.y = this._vertex.x * this._particle._rotationMatrix[1] + this._vertex.y * this._particle._rotationMatrix[4] + this._vertex.z * this._particle._rotationMatrix[7],
                                    this._rotated.z = this._vertex.x * this._particle._rotationMatrix[2] + this._vertex.y * this._particle._rotationMatrix[5] + this._vertex.z * this._particle._rotationMatrix[8],
                                    this._rotated.x += this._pivotBackTranslation.x,
                                    this._rotated.y += this._pivotBackTranslation.y,
                                    this._rotated.z += this._pivotBackTranslation.z,
                                    this._positions32[o] = this._particle._globalPosition.x + this._cam_axisX.x * this._rotated.x + this._cam_axisY.x * this._rotated.y + this._cam_axisZ.x * this._rotated.z,
                                    this._positions32[o + 1] = this._particle._globalPosition.y + this._cam_axisX.y * this._rotated.x + this._cam_axisY.y * this._rotated.y + this._cam_axisZ.y * this._rotated.z,
                                    this._positions32[o + 2] = this._particle._globalPosition.z + this._cam_axisX.z * this._rotated.x + this._cam_axisY.z * this._rotated.y + this._cam_axisZ.z * this._rotated.z,
                                    this._computeBoundingBox && (this._positions32[o] < this._minimum.x && (this._minimum.x = this._positions32[o]),
                                    this._positions32[o] > this._maximum.x && (this._maximum.x = this._positions32[o]),
                                    this._positions32[o + 1] < this._minimum.y && (this._minimum.y = this._positions32[o + 1]),
                                    this._positions32[o + 1] > this._maximum.y && (this._maximum.y = this._positions32[o + 1]),
                                    this._positions32[o + 2] < this._minimum.z && (this._minimum.z = this._positions32[o + 2]),
                                    this._positions32[o + 2] > this._maximum.z && (this._maximum.z = this._positions32[o + 2])),
                                    this._computeParticleVertex || (this._normal.x = this._fixedNormal32[o],
                                    this._normal.y = this._fixedNormal32[o + 1],
                                    this._normal.z = this._fixedNormal32[o + 2],
                                    this._rotated.x = this._normal.x * this._particle._rotationMatrix[0] + this._normal.y * this._particle._rotationMatrix[3] + this._normal.z * this._particle._rotationMatrix[6],
                                    this._rotated.y = this._normal.x * this._particle._rotationMatrix[1] + this._normal.y * this._particle._rotationMatrix[4] + this._normal.z * this._particle._rotationMatrix[7],
                                    this._rotated.z = this._normal.x * this._particle._rotationMatrix[2] + this._normal.y * this._particle._rotationMatrix[5] + this._normal.z * this._particle._rotationMatrix[8],
                                    this._normals32[o] = this._cam_axisX.x * this._rotated.x + this._cam_axisY.x * this._rotated.y + this._cam_axisZ.x * this._rotated.z,
                                    this._normals32[o + 1] = this._cam_axisX.y * this._rotated.x + this._cam_axisY.y * this._rotated.y + this._cam_axisZ.y * this._rotated.z,
                                    this._normals32[o + 2] = this._cam_axisX.z * this._rotated.x + this._cam_axisY.z * this._rotated.y + this._cam_axisZ.z * this._rotated.z),
                                    this._computeParticleColor && this._particle.color && (this._colors32[s] = this._particle.color.r,
                                    this._colors32[s + 1] = this._particle.color.g,
                                    this._colors32[s + 2] = this._particle.color.b,
                                    this._colors32[s + 3] = this._particle.color.a),
                                    this._computeParticleTexture && (this._uvs32[l] = this._shapeUV[2 * h] * (this._particle.uvs.z - this._particle.uvs.x) + this._particle.uvs.x,
                                    this._uvs32[l + 1] = this._shapeUV[2 * h + 1] * (this._particle.uvs.w - this._particle.uvs.y) + this._particle.uvs.y);
                            else
                                for (this._particle._stillInvisible = !0,
                                h = 0; h < this._shape.length; h++)
                                    o = a + 3 * h,
                                    s = y + 4 * h,
                                    l = c + 2 * h,
                                    this._positions32[o] = 0,
                                    this._positions32[o + 1] = 0,
                                    this._positions32[o + 2] = 0,
                                    this._normals32[o] = 0,
                                    this._normals32[o + 1] = 0,
                                    this._normals32[o + 2] = 0,
                                    this._computeParticleColor && this._particle.color && (this._colors32[s] = this._particle.color.r,
                                    this._colors32[s + 1] = this._particle.color.g,
                                    this._colors32[s + 2] = this._particle.color.b,
                                    this._colors32[s + 3] = this._particle.color.a),
                                    this._computeParticleTexture && (this._uvs32[l] = this._shapeUV[2 * h] * (this._particle.uvs.z - this._particle.uvs.x) + this._particle.uvs.x,
                                    this._uvs32[l + 1] = this._shapeUV[2 * h + 1] * (this._particle.uvs.w - this._particle.uvs.y) + this._particle.uvs.y);
                            if (this._particlesIntersect) {
                                var p = this._particle._boundingInfo
                                  , f = p.boundingBox
                                  , m = p.boundingSphere;
                                if (!this._bSphereOnly) {
                                    for (var z = 0; z < f.vectors.length; z++)
                                        this._vertex.x = this._particle._modelBoundingInfo.boundingBox.vectors[z].x * this._particle.scaling.x,
                                        this._vertex.y = this._particle._modelBoundingInfo.boundingBox.vectors[z].y * this._particle.scaling.y,
                                        this._vertex.z = this._particle._modelBoundingInfo.boundingBox.vectors[z].z * this._particle.scaling.z,
                                        this._rotated.x = this._vertex.x * this._particle._rotationMatrix[0] + this._vertex.y * this._particle._rotationMatrix[3] + this._vertex.z * this._particle._rotationMatrix[6],
                                        this._rotated.y = this._vertex.x * this._particle._rotationMatrix[1] + this._vertex.y * this._particle._rotationMatrix[4] + this._vertex.z * this._particle._rotationMatrix[7],
                                        this._rotated.z = this._vertex.x * this._particle._rotationMatrix[2] + this._vertex.y * this._particle._rotationMatrix[5] + this._vertex.z * this._particle._rotationMatrix[8],
                                        f.vectors[z].x = this._particle.position.x + this._cam_axisX.x * this._rotated.x + this._cam_axisY.x * this._rotated.y + this._cam_axisZ.x * this._rotated.z,
                                        f.vectors[z].y = this._particle.position.y + this._cam_axisX.y * this._rotated.x + this._cam_axisY.y * this._rotated.y + this._cam_axisZ.y * this._rotated.z,
                                        f.vectors[z].z = this._particle.position.z + this._cam_axisX.z * this._rotated.x + this._cam_axisY.z * this._rotated.y + this._cam_axisZ.z * this._rotated.z;
                                    f._update(this.mesh._worldMatrix)
                                }
                                this._minBbox.x = this._particle._modelBoundingInfo.minimum.x * this._particle.scaling.x,
                                this._minBbox.y = this._particle._modelBoundingInfo.minimum.y * this._particle.scaling.y,
                                this._minBbox.z = this._particle._modelBoundingInfo.minimum.z * this._particle.scaling.z,
                                this._maxBbox.x = this._particle._modelBoundingInfo.maximum.x * this._particle.scaling.x,
                                this._maxBbox.y = this._particle._modelBoundingInfo.maximum.y * this._particle.scaling.y,
                                this._maxBbox.z = this._particle._modelBoundingInfo.maximum.z * this._particle.scaling.z,
                                m.center.x = this._particle._globalPosition.x + .5 * (this._minBbox.x + this._maxBbox.x),
                                m.center.y = this._particle._globalPosition.y + .5 * (this._minBbox.y + this._maxBbox.y),
                                m.center.z = this._particle._globalPosition.z + .5 * (this._minBbox.z + this._maxBbox.z),
                                m.radius = .5 * this._bSphereRadiusFactor * Math.sqrt((this._maxBbox.x - this._minBbox.x) * (this._maxBbox.x - this._minBbox.x) + (this._maxBbox.y - this._minBbox.y) * (this._maxBbox.y - this._minBbox.y) + (this._maxBbox.z - this._minBbox.z) * (this._maxBbox.z - this._minBbox.z)),
                                m._update(this.mesh._worldMatrix)
                            }
                            a = o + 3,
                            y = s + 4,
                            c = l + 2
                        }
                    }
                    if (i) {
                        if (this._computeParticleColor && this.mesh.updateVerticesData(e.VertexBuffer.ColorKind, this._colors32, !1, !1),
                        this._computeParticleTexture && this.mesh.updateVerticesData(e.VertexBuffer.UVKind, this._uvs32, !1, !1),
                        this.mesh.updateVerticesData(e.VertexBuffer.PositionKind, this._positions32, !1, !1),
                        !this.mesh.areNormalsFrozen || this.mesh.isFacetDataEnabled) {
                            if (this._computeParticleVertex || this.mesh.isFacetDataEnabled) {
                                var _ = this.mesh.isFacetDataEnabled ? this.mesh.getFacetDataParameters() : null;
                                e.VertexData.ComputeNormals(this._positions32, this._indices32, this._normals32, _);
                                for (var g = 0; g < this._normals32.length; g++)
                                    this._fixedNormal32[g] = this._normals32[g]
                            }
                            this.mesh.areNormalsFrozen || this.mesh.updateVerticesData(e.VertexBuffer.NormalKind, this._normals32, !1, !1)
                        }
                        if (this._depthSort && this._depthSortParticles) {
                            this.depthSortedParticles.sort(this._depthSortFunction);
                            var v = this.depthSortedParticles.length
                              , b = 0
                              , T = 0
                              , E = 0
                              , P = 0;
                            for (b = 0; b < v; b++) {
                                T = this.depthSortedParticles[b].indicesLength,
                                E = this.depthSortedParticles[b].ind;
                                for (g = 0; g < T; g++)
                                    this._indices32[P] = this._indices[E + g],
                                    P++
                            }
                            this.mesh.updateIndices(this._indices32)
                        }
                    }
                    return this._computeBoundingBox && (this.mesh._boundingInfo = new e.BoundingInfo(this._minimum,this._maximum),
                    this.mesh._boundingInfo.update(this.mesh._worldMatrix)),
                    this.afterUpdateParticles(t, r, i),
                    this
                }
                ,
                t.prototype._quaternionRotationYPR = function() {
                    this._halfroll = .5 * this._roll,
                    this._halfpitch = .5 * this._pitch,
                    this._halfyaw = .5 * this._yaw,
                    this._sinRoll = Math.sin(this._halfroll),
                    this._cosRoll = Math.cos(this._halfroll),
                    this._sinPitch = Math.sin(this._halfpitch),
                    this._cosPitch = Math.cos(this._halfpitch),
                    this._sinYaw = Math.sin(this._halfyaw),
                    this._cosYaw = Math.cos(this._halfyaw),
                    this._quaternion.x = this._cosYaw * this._sinPitch * this._cosRoll + this._sinYaw * this._cosPitch * this._sinRoll,
                    this._quaternion.y = this._sinYaw * this._cosPitch * this._cosRoll - this._cosYaw * this._sinPitch * this._sinRoll,
                    this._quaternion.z = this._cosYaw * this._cosPitch * this._sinRoll - this._sinYaw * this._sinPitch * this._cosRoll,
                    this._quaternion.w = this._cosYaw * this._cosPitch * this._cosRoll + this._sinYaw * this._sinPitch * this._sinRoll
                }
                ,
                t.prototype._quaternionToRotationMatrix = function() {
                    this._rotMatrix.m[0] = 1 - 2 * (this._quaternion.y * this._quaternion.y + this._quaternion.z * this._quaternion.z),
                    this._rotMatrix.m[1] = 2 * (this._quaternion.x * this._quaternion.y + this._quaternion.z * this._quaternion.w),
                    this._rotMatrix.m[2] = 2 * (this._quaternion.z * this._quaternion.x - this._quaternion.y * this._quaternion.w),
                    this._rotMatrix.m[3] = 0,
                    this._rotMatrix.m[4] = 2 * (this._quaternion.x * this._quaternion.y - this._quaternion.z * this._quaternion.w),
                    this._rotMatrix.m[5] = 1 - 2 * (this._quaternion.z * this._quaternion.z + this._quaternion.x * this._quaternion.x),
                    this._rotMatrix.m[6] = 2 * (this._quaternion.y * this._quaternion.z + this._quaternion.x * this._quaternion.w),
                    this._rotMatrix.m[7] = 0,
                    this._rotMatrix.m[8] = 2 * (this._quaternion.z * this._quaternion.x + this._quaternion.y * this._quaternion.w),
                    this._rotMatrix.m[9] = 2 * (this._quaternion.y * this._quaternion.z - this._quaternion.x * this._quaternion.w),
                    this._rotMatrix.m[10] = 1 - 2 * (this._quaternion.y * this._quaternion.y + this._quaternion.x * this._quaternion.x),
                    this._rotMatrix.m[11] = 0,
                    this._rotMatrix.m[12] = 0,
                    this._rotMatrix.m[13] = 0,
                    this._rotMatrix.m[14] = 0,
                    this._rotMatrix.m[15] = 1
                }
                ,
                t.prototype.dispose = function() {
                    this.mesh.dispose(),
                    this.vars = null,
                    this._positions = null,
                    this._indices = null,
                    this._normals = null,
                    this._uvs = null,
                    this._colors = null,
                    this._indices32 = null,
                    this._positions32 = null,
                    this._normals32 = null,
                    this._fixedNormal32 = null,
                    this._uvs32 = null,
                    this._colors32 = null,
                    this.pickedParticles = null
                }
                ,
                t.prototype.refreshVisibleSize = function() {
                    return this._isVisibilityBoxLocked || this.mesh.refreshBoundingInfo(),
                    this
                }
                ,
                t.prototype.setVisibilityBox = function(t) {
                    var r = t / 2;
                    this.mesh._boundingInfo = new e.BoundingInfo(new e.Vector3(-r,-r,-r),new e.Vector3(r,r,r))
                }
                ,
                Object.defineProperty(t.prototype, "isAlwaysVisible", {
                    get: function() {
                        return this._alwaysVisible
                    },
                    set: function(e) {
                        this._alwaysVisible = e,
                        this.mesh.alwaysSelectAsActiveMesh = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "isVisibilityBoxLocked", {
                    get: function() {
                        return this._isVisibilityBoxLocked
                    },
                    set: function(e) {
                        this._isVisibilityBoxLocked = e,
                        this.mesh.getBoundingInfo().isLocked = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "computeParticleRotation", {
                    get: function() {
                        return this._computeParticleRotation
                    },
                    set: function(e) {
                        this._computeParticleRotation = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "computeParticleColor", {
                    get: function() {
                        return this._computeParticleColor
                    },
                    set: function(e) {
                        this._computeParticleColor = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "computeParticleTexture", {
                    get: function() {
                        return this._computeParticleTexture
                    },
                    set: function(e) {
                        this._computeParticleTexture = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "computeParticleVertex", {
                    get: function() {
                        return this._computeParticleVertex
                    },
                    set: function(e) {
                        this._computeParticleVertex = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "computeBoundingBox", {
                    get: function() {
                        return this._computeBoundingBox
                    },
                    set: function(e) {
                        this._computeBoundingBox = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "depthSortParticles", {
                    get: function() {
                        return this._depthSortParticles
                    },
                    set: function(e) {
                        this._depthSortParticles = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.initParticles = function() {}
                ,
                t.prototype.recycleParticle = function(e) {
                    return e
                }
                ,
                t.prototype.updateParticle = function(e) {
                    return e
                }
                ,
                t.prototype.updateParticleVertex = function(e, t, r) {
                    return t
                }
                ,
                t.prototype.beforeUpdateParticles = function(e, t, r) {}
                ,
                t.prototype.afterUpdateParticles = function(e, t, r) {}
                ,
                t
            }();
            e.SolidParticleSystem = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.updateSideOrientation = function(t) {
                    return t == e.Mesh.DOUBLESIDE ? e.Mesh.DOUBLESIDE : null == t ? e.Mesh.FRONTSIDE : t
                }
                ,
                t.CreateBox = function(r, i, n) {
                    void 0 === n && (n = null);
                    var o = new e.Mesh(r,n);
                    return i.sideOrientation = t.updateSideOrientation(i.sideOrientation),
                    o._originalBuilderSideOrientation = i.sideOrientation,
                    e.VertexData.CreateBox(i).applyToMesh(o, i.updatable),
                    o
                }
                ,
                t.CreateSphere = function(r, i, n) {
                    var o = new e.Mesh(r,n);
                    return i.sideOrientation = t.updateSideOrientation(i.sideOrientation),
                    o._originalBuilderSideOrientation = i.sideOrientation,
                    e.VertexData.CreateSphere(i).applyToMesh(o, i.updatable),
                    o
                }
                ,
                t.CreateDisc = function(r, i, n) {
                    void 0 === n && (n = null);
                    var o = new e.Mesh(r,n);
                    return i.sideOrientation = t.updateSideOrientation(i.sideOrientation),
                    o._originalBuilderSideOrientation = i.sideOrientation,
                    e.VertexData.CreateDisc(i).applyToMesh(o, i.updatable),
                    o
                }
                ,
                t.CreateIcoSphere = function(r, i, n) {
                    var o = new e.Mesh(r,n);
                    return i.sideOrientation = t.updateSideOrientation(i.sideOrientation),
                    o._originalBuilderSideOrientation = i.sideOrientation,
                    e.VertexData.CreateIcoSphere(i).applyToMesh(o, i.updatable),
                    o
                }
                ,
                t.CreateRibbon = function(r, i, n) {
                    void 0 === n && (n = null);
                    var o = i.pathArray
                      , a = i.closeArray
                      , s = i.closePath
                      , y = t.updateSideOrientation(i.sideOrientation)
                      , l = i.instance
                      , c = i.updatable;
                    if (l) {
                        e.Vector3.FromFloatsToRef(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE, e.Tmp.Vector3[0]),
                        e.Vector3.FromFloatsToRef(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE, e.Tmp.Vector3[1]);
                        var h = l.getVerticesData(e.VertexBuffer.PositionKind);
                        if (function(t) {
                            for (var r = o[0].length, i = l, n = 0, a = i._originalBuilderSideOrientation === e.Mesh.DOUBLESIDE ? 2 : 1, s = 1; s <= a; s++)
                                for (var y = 0; y < o.length; y++) {
                                    var c = o[y]
                                      , h = c.length;
                                    r = r < h ? r : h;
                                    for (var u = 0; u < r; )
                                        t[n] = c[u].x,
                                        t[n + 1] = c[u].y,
                                        t[n + 2] = c[u].z,
                                        c[u].x < e.Tmp.Vector3[0].x && (e.Tmp.Vector3[0].x = c[u].x),
                                        c[u].x > e.Tmp.Vector3[1].x && (e.Tmp.Vector3[1].x = c[u].x),
                                        c[u].y < e.Tmp.Vector3[0].y && (e.Tmp.Vector3[0].y = c[u].y),
                                        c[u].y > e.Tmp.Vector3[1].y && (e.Tmp.Vector3[1].y = c[u].y),
                                        c[u].z < e.Tmp.Vector3[0].z && (e.Tmp.Vector3[0].z = c[u].z),
                                        c[u].z > e.Tmp.Vector3[1].z && (e.Tmp.Vector3[1].z = c[u].z),
                                        u++,
                                        n += 3;
                                    i._creationDataStorage && i._creationDataStorage.closePath && (t[n] = c[0].x,
                                    t[n + 1] = c[0].y,
                                    t[n + 2] = c[0].z,
                                    n += 3)
                                }
                        }(h),
                        l._boundingInfo = new e.BoundingInfo(e.Tmp.Vector3[2],e.Tmp.Vector3[3]),
                        l._boundingInfo.update(l._worldMatrix),
                        l.updateVerticesData(e.VertexBuffer.PositionKind, h, !1, !1),
                        i.colors) {
                            for (var u = l.getVerticesData(e.VertexBuffer.ColorKind), d = 0; d < i.colors.length; d++)
                                u[4 * d] = i.colors[d].r,
                                u[4 * d + 1] = i.colors[d].g,
                                u[4 * d + 2] = i.colors[d].b,
                                u[4 * d + 3] = i.colors[d].a;
                            l.updateVerticesData(e.VertexBuffer.ColorKind, u, !1, !1)
                        }
                        if (i.uvs) {
                            for (var x = l.getVerticesData(e.VertexBuffer.UVKind), p = 0; p < i.uvs.length; p++)
                                x[2 * p] = i.uvs[p].x,
                                x[2 * p + 1] = i.uvs[p].y;
                            l.updateVerticesData(e.VertexBuffer.UVKind, x, !1, !1)
                        }
                        if (!l.areNormalsFrozen || l.isFacetDataEnabled) {
                            var f = l.getIndices()
                              , m = l.getVerticesData(e.VertexBuffer.NormalKind)
                              , z = l.isFacetDataEnabled ? l.getFacetDataParameters() : null;
                            if (e.VertexData.ComputeNormals(h, f, m, z),
                            l._creationDataStorage && l._creationDataStorage.closePath)
                                for (var _ = 0, g = 0, v = 0; v < o.length; v++)
                                    _ = 3 * l._creationDataStorage.idx[v],
                                    g = v + 1 < o.length ? 3 * (l._creationDataStorage.idx[v + 1] - 1) : m.length - 3,
                                    m[_] = .5 * (m[_] + m[g]),
                                    m[_ + 1] = .5 * (m[_ + 1] + m[g + 1]),
                                    m[_ + 2] = .5 * (m[_ + 2] + m[g + 2]),
                                    m[g] = m[_],
                                    m[g + 1] = m[_ + 1],
                                    m[g + 2] = m[_ + 2];
                            l.areNormalsFrozen || l.updateVerticesData(e.VertexBuffer.NormalKind, m, !1, !1)
                        }
                        return l
                    }
                    var b = new e.Mesh(r,n);
                    b._originalBuilderSideOrientation = y,
                    b._creationDataStorage = new e._CreationDataStorage;
                    var T = e.VertexData.CreateRibbon(i);
                    return s && (b._creationDataStorage.idx = T._idx),
                    b._creationDataStorage.closePath = s,
                    b._creationDataStorage.closeArray = a,
                    T.applyToMesh(b, c),
                    b
                }
                ,
                t.CreateCylinder = function(r, i, n) {
                    var o = new e.Mesh(r,n);
                    return i.sideOrientation = t.updateSideOrientation(i.sideOrientation),
                    o._originalBuilderSideOrientation = i.sideOrientation,
                    e.VertexData.CreateCylinder(i).applyToMesh(o, i.updatable),
                    o
                }
                ,
                t.CreateTorus = function(r, i, n) {
                    var o = new e.Mesh(r,n);
                    return i.sideOrientation = t.updateSideOrientation(i.sideOrientation),
                    o._originalBuilderSideOrientation = i.sideOrientation,
                    e.VertexData.CreateTorus(i).applyToMesh(o, i.updatable),
                    o
                }
                ,
                t.CreateTorusKnot = function(r, i, n) {
                    var o = new e.Mesh(r,n);
                    return i.sideOrientation = t.updateSideOrientation(i.sideOrientation),
                    o._originalBuilderSideOrientation = i.sideOrientation,
                    e.VertexData.CreateTorusKnot(i).applyToMesh(o, i.updatable),
                    o
                }
                ,
                t.CreateLineSystem = function(t, r, i) {
                    var n = r.instance
                      , o = r.lines
                      , a = r.colors;
                    if (n) {
                        var s, y, l = n.getVerticesData(e.VertexBuffer.PositionKind);
                        a && (s = n.getVerticesData(e.VertexBuffer.ColorKind));
                        for (var c = 0, h = 0, u = 0; u < o.length; u++)
                            for (var d = o[u], x = 0; x < d.length; x++)
                                l[c] = d[x].x,
                                l[c + 1] = d[x].y,
                                l[c + 2] = d[x].z,
                                a && s && (y = a[u],
                                s[h] = y[x].r,
                                s[h + 1] = y[x].g,
                                s[h + 2] = y[x].b,
                                s[h + 3] = y[x].a,
                                h += 4),
                                c += 3;
                        return n.updateVerticesData(e.VertexBuffer.PositionKind, l, !1, !1),
                        a && s && n.updateVerticesData(e.VertexBuffer.ColorKind, s, !1, !1),
                        n
                    }
                    var p = !!a
                      , f = new e.LinesMesh(t,i,null,void 0,void 0,p,r.useVertexAlpha);
                    return e.VertexData.CreateLineSystem(r).applyToMesh(f, r.updatable),
                    f
                }
                ,
                t.CreateLines = function(e, r, i) {
                    void 0 === i && (i = null);
                    var n = r.colors ? [r.colors] : null;
                    return t.CreateLineSystem(e, {
                        lines: [r.points],
                        updatable: r.updatable,
                        instance: r.instance,
                        colors: n,
                        useVertexAlpha: r.useVertexAlpha
                    }, i)
                }
                ,
                t.CreateDashedLines = function(t, r, i) {
                    void 0 === i && (i = null);
                    var n = r.points
                      , o = r.instance
                      , a = r.gapSize || 1
                      , s = r.dashSize || 3;
                    if (o) {
                        return o.updateMeshPositions((function(t) {
                            var r, i, a = e.Vector3.Zero(), s = t.length / 6, y = 0, l = 0, c = 0, h = 0, u = 0, d = 0;
                            for (u = 0; u < n.length - 1; u++)
                                n[u + 1].subtractToRef(n[u], a),
                                y += a.length();
                            r = y / s;
                            var x = o._creationDataStorage.dashSize;
                            for (i = x * r / (x + o._creationDataStorage.gapSize),
                            u = 0; u < n.length - 1; u++)
                                for (n[u + 1].subtractToRef(n[u], a),
                                l = Math.floor(a.length() / r),
                                a.normalize(),
                                d = 0; d < l && h < t.length; )
                                    c = r * d,
                                    t[h] = n[u].x + c * a.x,
                                    t[h + 1] = n[u].y + c * a.y,
                                    t[h + 2] = n[u].z + c * a.z,
                                    t[h + 3] = n[u].x + (c + i) * a.x,
                                    t[h + 4] = n[u].y + (c + i) * a.y,
                                    t[h + 5] = n[u].z + (c + i) * a.z,
                                    h += 6,
                                    d++;
                            for (; h < t.length; )
                                t[h] = n[u].x,
                                t[h + 1] = n[u].y,
                                t[h + 2] = n[u].z,
                                h += 3
                        }
                        ), !1),
                        o
                    }
                    var y = new e.LinesMesh(t,i);
                    return e.VertexData.CreateDashedLines(r).applyToMesh(y, r.updatable),
                    y._creationDataStorage = new e._CreationDataStorage,
                    y._creationDataStorage.dashSize = s,
                    y._creationDataStorage.gapSize = a,
                    y
                }
                ,
                t.ExtrudeShape = function(r, i, n) {
                    void 0 === n && (n = null);
                    var o = i.path
                      , a = i.shape
                      , s = i.scale || 1
                      , y = i.rotation || 0
                      , l = 0 === i.cap ? 0 : i.cap || e.Mesh.NO_CAP
                      , c = i.updatable
                      , h = t.updateSideOrientation(i.sideOrientation)
                      , u = i.instance || null
                      , d = i.invertUV || !1;
                    return t._ExtrudeShapeGeneric(r, a, o, s, y, null, null, !1, !1, l, !1, n, !!c, h, u, d, i.frontUVs || null, i.backUVs || null)
                }
                ,
                t.ExtrudeShapeCustom = function(r, i, n) {
                    var o = i.path
                      , a = i.shape
                      , s = i.scaleFunction || function() {
                        return 1
                    }
                      , y = i.rotationFunction || function() {
                        return 0
                    }
                      , l = i.ribbonCloseArray || !1
                      , c = i.ribbonClosePath || !1
                      , h = 0 === i.cap ? 0 : i.cap || e.Mesh.NO_CAP
                      , u = i.updatable
                      , d = t.updateSideOrientation(i.sideOrientation)
                      , x = i.instance
                      , p = i.invertUV || !1;
                    return t._ExtrudeShapeGeneric(r, a, o, null, null, s, y, l, c, h, !0, n, !!u, d, x || null, p, i.frontUVs || null, i.backUVs || null)
                }
                ,
                t.CreateLathe = function(r, i, n) {
                    var o, a = i.arc ? i.arc <= 0 || i.arc > 1 ? 1 : i.arc : 1, s = void 0 === i.closed || i.closed, y = i.shape, l = i.radius || 1, c = i.tessellation || 64, h = i.clip || 0, u = i.updatable, d = t.updateSideOrientation(i.sideOrientation), x = i.cap || e.Mesh.NO_CAP, p = 2 * Math.PI, f = new Array, m = i.invertUV || !1, z = 0, _ = 0, g = p / c * a, v = new Array;
                    for (z = 0; z <= c - h; z++) {
                        v = [];
                        for (x != e.Mesh.CAP_START && x != e.Mesh.CAP_ALL || (v.push(new e.Vector3(0,y[0].y,0)),
                        v.push(new e.Vector3(Math.cos(z * g) * y[0].x * l,y[0].y,Math.sin(z * g) * y[0].x * l))),
                        _ = 0; _ < y.length; _++)
                            o = new e.Vector3(Math.cos(z * g) * y[_].x * l,y[_].y,Math.sin(z * g) * y[_].x * l),
                            v.push(o);
                        x != e.Mesh.CAP_END && x != e.Mesh.CAP_ALL || (v.push(new e.Vector3(Math.cos(z * g) * y[y.length - 1].x * l,y[y.length - 1].y,Math.sin(z * g) * y[y.length - 1].x * l)),
                        v.push(new e.Vector3(0,y[y.length - 1].y,0))),
                        f.push(v)
                    }
                    return t.CreateRibbon(r, {
                        pathArray: f,
                        closeArray: s,
                        sideOrientation: d,
                        updatable: u,
                        invertUV: m,
                        frontUVs: i.frontUVs,
                        backUVs: i.backUVs
                    }, n)
                }
                ,
                t.CreatePlane = function(r, i, n) {
                    var o = new e.Mesh(r,n);
                    if (i.sideOrientation = t.updateSideOrientation(i.sideOrientation),
                    o._originalBuilderSideOrientation = i.sideOrientation,
                    e.VertexData.CreatePlane(i).applyToMesh(o, i.updatable),
                    i.sourcePlane) {
                        o.translate(i.sourcePlane.normal, i.sourcePlane.d);
                        var a = Math.acos(e.Vector3.Dot(i.sourcePlane.normal, e.Axis.Z))
                          , s = e.Vector3.Cross(e.Axis.Z, i.sourcePlane.normal);
                        s.lengthSquared() > e.Epsilon && o.rotate(s, a)
                    }
                    return o
                }
                ,
                t.CreateGround = function(t, r, i) {
                    var n = new e.GroundMesh(t,i);
                    return n._setReady(!1),
                    n._subdivisionsX = r.subdivisionsX || r.subdivisions || 1,
                    n._subdivisionsY = r.subdivisionsY || r.subdivisions || 1,
                    n._width = r.width || 1,
                    n._height = r.height || 1,
                    n._maxX = n._width / 2,
                    n._maxZ = n._height / 2,
                    n._minX = -n._maxX,
                    n._minZ = -n._maxZ,
                    e.VertexData.CreateGround(r).applyToMesh(n, r.updatable),
                    n._setReady(!0),
                    n
                }
                ,
                t.CreateTiledGround = function(t, r, i) {
                    var n = new e.Mesh(t,i);
                    return e.VertexData.CreateTiledGround(r).applyToMesh(n, r.updatable),
                    n
                }
                ,
                t.CreateGroundFromHeightMap = function(t, r, i, n) {
                    var o = i.width || 10
                      , a = i.height || 10
                      , s = i.subdivisions || 1
                      , y = i.minHeight || 0
                      , l = i.maxHeight || 1
                      , c = i.colorFilter || new e.Color3(.3,.59,.11)
                      , h = i.alphaFilter || 0
                      , u = i.updatable
                      , d = i.onReady
                      , x = new e.GroundMesh(t,n);
                    x._subdivisionsX = s,
                    x._subdivisionsY = s,
                    x._width = o,
                    x._height = a,
                    x._maxX = x._width / 2,
                    x._maxZ = x._height / 2,
                    x._minX = -x._maxX,
                    x._minZ = -x._maxZ,
                    x._setReady(!1);
                    return e.Tools.LoadImage(r, (function(t) {
                        var r = document.createElement("canvas")
                          , i = r.getContext("2d");
                        if (!i)
                            throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");
                        if (!n.isDisposed) {
                            var p = t.width
                              , f = t.height;
                            r.width = p,
                            r.height = f,
                            i.drawImage(t, 0, 0);
                            var m = i.getImageData(0, 0, p, f).data;
                            e.VertexData.CreateGroundFromHeightMap({
                                width: o,
                                height: a,
                                subdivisions: s,
                                minHeight: y,
                                maxHeight: l,
                                colorFilter: c,
                                buffer: m,
                                bufferWidth: p,
                                bufferHeight: f,
                                alphaFilter: h
                            }).applyToMesh(x, u),
                            d && d(x),
                            x._setReady(!0)
                        }
                    }
                    ), (function() {}
                    ), n.database),
                    x
                }
                ,
                t.CreatePolygon = function(r, i, n) {
                    i.sideOrientation = t.updateSideOrientation(i.sideOrientation);
                    for (var o = i.shape, a = i.holes || [], s = i.depth || 0, y = [], l = [], c = 0; c < o.length; c++)
                        y[c] = new e.Vector2(o[c].x,o[c].z);
                    y[0].equalsWithEpsilon(y[y.length - 1], 1e-8) && y.pop();
                    for (var h = new e.PolygonMeshBuilder(r,y,n), u = 0; u < a.length; u++) {
                        l = [];
                        for (var d = 0; d < a[u].length; d++)
                            l.push(new e.Vector2(a[u][d].x,a[u][d].z));
                        h.addHole(l)
                    }
                    var x = h.build(i.updatable, s);
                    return x._originalBuilderSideOrientation = i.sideOrientation,
                    e.VertexData.CreatePolygon(x, i.sideOrientation, i.faceUV, i.faceColors, i.frontUVs, i.backUVs).applyToMesh(x, i.updatable),
                    x
                }
                ,
                t.ExtrudePolygon = function(e, r, i) {
                    return t.CreatePolygon(e, r, i)
                }
                ,
                t.CreateTube = function(r, i, n) {
                    var o = i.path
                      , a = i.instance
                      , s = 1;
                    void 0 !== i.radius ? s = i.radius : a && (s = a._creationDataStorage.radius);
                    var y = i.tessellation || 64
                      , l = i.radiusFunction || null
                      , c = i.cap || e.Mesh.NO_CAP
                      , h = i.invertUV || !1
                      , u = i.updatable
                      , d = t.updateSideOrientation(i.sideOrientation);
                    i.arc = i.arc && (i.arc <= 0 || i.arc > 1) ? 1 : i.arc || 1;
                    var x, p, f = function(t, r, i, n, o, a, s, y) {
                        for (var l, c, h, u, d = r.getTangents(), x = r.getNormals(), p = r.getDistances(), f = 2 * Math.PI / o * y, m = a || function() {
                            return n
                        }
                        , z = e.Tmp.Matrix[0], _ = s === e.Mesh.NO_CAP || s === e.Mesh.CAP_END ? 0 : 2, g = 0; g < t.length; g++) {
                            c = m(g, p[g]),
                            l = Array(),
                            h = x[g];
                            for (var v = 0; v < o; v++)
                                e.Matrix.RotationAxisToRef(d[g], f * v, z),
                                u = l[v] ? l[v] : e.Vector3.Zero(),
                                e.Vector3.TransformCoordinatesToRef(h, z, u),
                                u.scaleInPlace(c).addInPlace(t[g]),
                                l[v] = u;
                            i[_] = l,
                            _++
                        }
                        var b = function(e, r) {
                            for (var i = Array(), n = 0; n < e; n++)
                                i.push(t[r]);
                            return i
                        };
                        switch (s) {
                        case e.Mesh.NO_CAP:
                            break;
                        case e.Mesh.CAP_START:
                            i[0] = b(o, 0),
                            i[1] = i[2].slice(0);
                            break;
                        case e.Mesh.CAP_END:
                            i[_] = i[_ - 1].slice(0),
                            i[_ + 1] = b(o, t.length - 1);
                            break;
                        case e.Mesh.CAP_ALL:
                            i[0] = b(o, 0),
                            i[1] = i[2].slice(0),
                            i[_] = i[_ - 1].slice(0),
                            i[_ + 1] = b(o, t.length - 1)
                        }
                        return i
                    };
                    if (a) {
                        var m = a._creationDataStorage
                          , z = i.arc || m.arc;
                        return p = f(o, x = m.path3D.update(o), m.pathArray, s, m.tessellation, l, m.cap, z),
                        a = t.CreateRibbon("", {
                            pathArray: p,
                            instance: a
                        }),
                        m.path3D = x,
                        m.pathArray = p,
                        m.arc = z,
                        m.radius = s,
                        a
                    }
                    p = f(o, x = new e.Path3D(o), new Array, s, y, l, c = c < 0 || c > 3 ? 0 : c, i.arc);
                    var _ = t.CreateRibbon(r, {
                        pathArray: p,
                        closePath: !0,
                        closeArray: !1,
                        updatable: u,
                        sideOrientation: d,
                        invertUV: h,
                        frontUVs: i.frontUVs,
                        backUVs: i.backUVs
                    }, n);
                    return _._creationDataStorage.pathArray = p,
                    _._creationDataStorage.path3D = x,
                    _._creationDataStorage.tessellation = y,
                    _._creationDataStorage.cap = c,
                    _._creationDataStorage.arc = i.arc,
                    _._creationDataStorage.radius = s,
                    _
                }
                ,
                t.CreatePolyhedron = function(r, i, n) {
                    var o = new e.Mesh(r,n);
                    return i.sideOrientation = t.updateSideOrientation(i.sideOrientation),
                    o._originalBuilderSideOrientation = i.sideOrientation,
                    e.VertexData.CreatePolyhedron(i).applyToMesh(o, i.updatable),
                    o
                }
                ,
                t.CreateDecal = function(t, r, i) {
                    var n = r.getIndices()
                      , o = r.getVerticesData(e.VertexBuffer.PositionKind)
                      , a = r.getVerticesData(e.VertexBuffer.NormalKind)
                      , s = i.position || e.Vector3.Zero()
                      , y = i.normal || e.Vector3.Up()
                      , l = i.size || e.Vector3.One()
                      , c = i.angle || 0;
                    if (!y) {
                        var h = new e.Vector3(0,0,1)
                          , u = r.getScene().activeCamera
                          , d = e.Vector3.TransformCoordinates(h, u.getWorldMatrix());
                        y = u.globalPosition.subtract(d)
                    }
                    var x = -Math.atan2(y.z, y.x) - Math.PI / 2
                      , p = Math.sqrt(y.x * y.x + y.z * y.z)
                      , f = Math.atan2(y.y, p)
                      , m = e.Matrix.RotationYawPitchRoll(x, f, c).multiply(e.Matrix.Translation(s.x, s.y, s.z))
                      , z = e.Matrix.Invert(m)
                      , _ = r.getWorldMatrix().multiply(z)
                      , g = new e.VertexData;
                    g.indices = [],
                    g.positions = [],
                    g.normals = [],
                    g.uvs = [];
                    for (var v = 0, b = function(t) {
                        var r = new e.PositionNormalVertex;
                        if (!n || !o || !a)
                            return r;
                        var i = n[t];
                        return r.position = new e.Vector3(o[3 * i],o[3 * i + 1],o[3 * i + 2]),
                        r.position = e.Vector3.TransformCoordinates(r.position, _),
                        r.normal = new e.Vector3(a[3 * i],a[3 * i + 1],a[3 * i + 2]),
                        r.normal = e.Vector3.TransformNormal(r.normal, _),
                        r
                    }, T = function(t, r) {
                        if (0 === t.length)
                            return t;
                        for (var i = .5 * Math.abs(e.Vector3.Dot(l, r)), n = function(t, n) {
                            var o = e.Vector3.GetClipFactor(t.position, n.position, r, i);
                            return new e.PositionNormalVertex(e.Vector3.Lerp(t.position, n.position, o),e.Vector3.Lerp(t.normal, n.normal, o))
                        }, o = new Array, a = 0; a < t.length; a += 3) {
                            var s, y, c, h = null, u = null, d = null, x = null;
                            switch (((s = e.Vector3.Dot(t[a].position, r) - i > 0) ? 1 : 0) + ((y = e.Vector3.Dot(t[a + 1].position, r) - i > 0) ? 1 : 0) + ((c = e.Vector3.Dot(t[a + 2].position, r) - i > 0) ? 1 : 0)) {
                            case 0:
                                o.push(t[a]),
                                o.push(t[a + 1]),
                                o.push(t[a + 2]);
                                break;
                            case 1:
                                if (s && (h = t[a + 1],
                                u = t[a + 2],
                                d = n(t[a], h),
                                x = n(t[a], u)),
                                y) {
                                    h = t[a],
                                    u = t[a + 2],
                                    d = n(t[a + 1], h),
                                    x = n(t[a + 1], u),
                                    o.push(d),
                                    o.push(u.clone()),
                                    o.push(h.clone()),
                                    o.push(u.clone()),
                                    o.push(d.clone()),
                                    o.push(x);
                                    break
                                }
                                c && (h = t[a],
                                u = t[a + 1],
                                d = n(t[a + 2], h),
                                x = n(t[a + 2], u)),
                                h && u && d && x && (o.push(h.clone()),
                                o.push(u.clone()),
                                o.push(d),
                                o.push(x),
                                o.push(d.clone()),
                                o.push(u.clone()));
                                break;
                            case 2:
                                s || (u = n(h = t[a].clone(), t[a + 1]),
                                d = n(h, t[a + 2]),
                                o.push(h),
                                o.push(u),
                                o.push(d)),
                                y || (u = n(h = t[a + 1].clone(), t[a + 2]),
                                d = n(h, t[a]),
                                o.push(h),
                                o.push(u),
                                o.push(d)),
                                c || (u = n(h = t[a + 2].clone(), t[a]),
                                d = n(h, t[a + 1]),
                                o.push(h),
                                o.push(u),
                                o.push(d))
                            }
                        }
                        return o
                    }, E = 0; E < n.length; E += 3) {
                        var P = new Array;
                        if (P.push(b(E)),
                        P.push(b(E + 1)),
                        P.push(b(E + 2)),
                        P = T(P, new e.Vector3(1,0,0)),
                        P = T(P, new e.Vector3(-1,0,0)),
                        P = T(P, new e.Vector3(0,1,0)),
                        P = T(P, new e.Vector3(0,-1,0)),
                        P = T(P, new e.Vector3(0,0,1)),
                        0 !== (P = T(P, new e.Vector3(0,0,-1))).length)
                            for (var A = 0; A < P.length; A++) {
                                var S = P[A];
                                g.indices.push(v),
                                S.position.toArray(g.positions, 3 * v),
                                S.normal.toArray(g.normals, 3 * v),
                                g.uvs.push(.5 + S.position.x / l.x),
                                g.uvs.push(.5 + S.position.y / l.y),
                                v++
                            }
                    }
                    var M = new e.Mesh(t,r.getScene());
                    return g.applyToMesh(M),
                    M.position = s.clone(),
                    M.rotation = new e.Vector3(f,x,c),
                    M
                }
                ,
                t._ExtrudeShapeGeneric = function(r, i, n, o, a, s, y, l, c, h, u, d, x, p, f, m, z, _) {
                    var g, v, b = function(t, r, i, n, o, a, s, y, l, c) {
                        for (var h = i.getTangents(), u = i.getNormals(), d = i.getBinormals(), x = i.getDistances(), p = 0, f = c && y ? y : function() {
                            return null !== a ? a : 0
                        }
                        , m = c && s ? s : function() {
                            return null !== o ? o : 1
                        }
                        , z = l === e.Mesh.NO_CAP || l === e.Mesh.CAP_END ? 0 : 2, _ = e.Tmp.Matrix[0], g = 0; g < r.length; g++) {
                            for (var v = new Array, b = f(g, x[g]), T = m(g, x[g]), E = 0; E < t.length; E++) {
                                e.Matrix.RotationAxisToRef(h[g], p, _);
                                var P = h[g].scale(t[E].z).add(u[g].scale(t[E].x)).add(d[g].scale(t[E].y))
                                  , A = v[E] ? v[E] : e.Vector3.Zero();
                                e.Vector3.TransformCoordinatesToRef(P, _, A),
                                A.scaleInPlace(T).addInPlace(r[g]),
                                v[E] = A
                            }
                            n[z] = v,
                            p += b,
                            z++
                        }
                        var S = function(t) {
                            var r, i = Array(), n = e.Vector3.Zero();
                            for (r = 0; r < t.length; r++)
                                n.addInPlace(t[r]);
                            for (n.scaleInPlace(1 / t.length),
                            r = 0; r < t.length; r++)
                                i.push(n);
                            return i
                        };
                        switch (l) {
                        case e.Mesh.NO_CAP:
                            break;
                        case e.Mesh.CAP_START:
                            n[0] = S(n[2]),
                            n[1] = n[2];
                            break;
                        case e.Mesh.CAP_END:
                            n[z] = n[z - 1],
                            n[z + 1] = S(n[z - 1]);
                            break;
                        case e.Mesh.CAP_ALL:
                            n[0] = S(n[2]),
                            n[1] = n[2],
                            n[z] = n[z - 1],
                            n[z + 1] = S(n[z - 1])
                        }
                        return n
                    };
                    if (f) {
                        var T = f._creationDataStorage;
                        return g = T.path3D.update(n),
                        v = b(i, n, T.path3D, T.pathArray, o, a, s, y, T.cap, u),
                        f = e.Mesh.CreateRibbon("", v, !1, !1, 0, d || void 0, !1, 0, f)
                    }
                    v = b(i, n, g = new e.Path3D(n), new Array, o, a, s, y, h = h < 0 || h > 3 ? 0 : h, u);
                    var E = t.CreateRibbon(r, {
                        pathArray: v,
                        closeArray: l,
                        closePath: c,
                        updatable: x,
                        sideOrientation: p,
                        invertUV: m,
                        frontUVs: z || void 0,
                        backUVs: _ || void 0
                    }, d);
                    return E._creationDataStorage.pathArray = v,
                    E._creationDataStorage.path3D = g,
                    E._creationDataStorage.cap = h,
                    E
                }
                ,
                t
            }();
            e.MeshBuilder = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return Object.defineProperty(t, "DecoderAvailable", {
                    get: function() {
                        if ("undefined" != typeof DracoDecoderModule)
                            return !0;
                        var e = t.Configuration.decoder;
                        if (e) {
                            if (e.wasmUrl && e.wasmBinaryUrl && "object" == typeof WebAssembly)
                                return !0;
                            if (e.fallbackUrl)
                                return !0
                        }
                        return !1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.dispose = function() {}
                ,
                t.prototype.decodeMeshAsync = function(r, i) {
                    var n = r instanceof ArrayBuffer ? new Uint8Array(r) : r;
                    return t._GetDecoderModule().then((function(t) {
                        var r = t.module
                          , o = new e.VertexData
                          , a = new r.DecoderBuffer;
                        a.Init(n, n.byteLength);
                        var s, y, l = new r.Decoder;
                        try {
                            var c = l.GetEncodedGeometryType(a);
                            switch (c) {
                            case r.TRIANGULAR_MESH:
                                s = new r.Mesh,
                                y = l.DecodeBufferToMesh(a, s);
                                break;
                            case r.POINT_CLOUD:
                                s = new r.PointCloud,
                                y = l.DecodeBufferToPointCloud(a, s);
                                break;
                            default:
                                throw new Error("Invalid geometry type " + c)
                            }
                            if (!y.ok() || !s.ptr)
                                throw new Error(y.error_msg());
                            var h = s.num_points();
                            if (c === r.TRIANGULAR_MESH) {
                                var u = s.num_faces()
                                  , d = new r.DracoInt32Array;
                                try {
                                    for (var x = new Uint32Array(3 * u), p = 0; p < u; p++) {
                                        l.GetFaceFromMesh(s, p, d);
                                        var f = 3 * p;
                                        x[f + 0] = d.GetValue(0),
                                        x[f + 1] = d.GetValue(1),
                                        x[f + 2] = d.GetValue(2)
                                    }
                                    o.indices = x
                                } finally {
                                    r.destroy(d)
                                }
                            }
                            for (var m in i) {
                                var z = i[m]
                                  , _ = l.GetAttributeByUniqueId(s, z)
                                  , g = new r.DracoFloat32Array;
                                try {
                                    l.GetAttributeFloatForAllPoints(s, _, g);
                                    var v = new Float32Array(h * _.num_components());
                                    for (p = 0; p < v.length; p++)
                                        v[p] = g.GetValue(p);
                                    o.set(v, m)
                                } finally {
                                    r.destroy(g)
                                }
                            }
                        } finally {
                            s && r.destroy(s),
                            r.destroy(l),
                            r.destroy(a)
                        }
                        return o
                    }
                    ))
                }
                ,
                t._GetDecoderModule = function() {
                    if (!t._DecoderModulePromise) {
                        var e = null
                          , r = {};
                        if ("undefined" != typeof DracoDecoderModule)
                            e = Promise.resolve();
                        else {
                            var i = t.Configuration.decoder;
                            i && (i.wasmUrl && i.wasmBinaryUrl && "object" == typeof WebAssembly ? e = Promise.all([t._LoadScriptAsync(i.wasmUrl), t._LoadFileAsync(i.wasmBinaryUrl).then((function(e) {
                                r.wasmBinary = e
                            }
                            ))]) : i.fallbackUrl && (e = t._LoadScriptAsync(i.fallbackUrl)))
                        }
                        if (!e)
                            throw new Error("Draco decoder module is not available");
                        t._DecoderModulePromise = e.then((function() {
                            return new Promise((function(e) {
                                r.onModuleLoaded = function(t) {
                                    e({
                                        module: t
                                    })
                                }
                                ,
                                DracoDecoderModule(r)
                            }
                            ))
                        }
                        ))
                    }
                    return t._DecoderModulePromise
                }
                ,
                t._LoadScriptAsync = function(t) {
                    return new Promise((function(r, i) {
                        e.Tools.LoadScript(t, (function() {
                            r()
                        }
                        ), (function(e) {
                            i(new Error(e))
                        }
                        ))
                    }
                    ))
                }
                ,
                t._LoadFileAsync = function(t) {
                    return new Promise((function(r, i) {
                        e.Tools.LoadFile(t, (function(e) {
                            r(e)
                        }
                        ), void 0, void 0, !0, (function(e, t) {
                            i(t)
                        }
                        ))
                    }
                    ))
                }
                ,
                t.Configuration = {
                    decoder: {
                        wasmUrl: "https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",
                        wasmBinaryUrl: "https://preview.babylonjs.com/draco_decoder_gltf.wasm",
                        fallbackUrl: "https://preview.babylonjs.com/draco_decoder_gltf.js"
                    }
                },
                t
            }();
            e.DracoCompression = t
        }(s || (s = {})),
        function(e) {
            e.Engine.AudioEngineFactory = function(e) {
                return new t(e)
            }
            ;
            var t = function() {
                function t(t) {
                    void 0 === t && (t = null);
                    var r = this;
                    this._audioContext = null,
                    this._audioContextInitialized = !1,
                    this._muteButton = null,
                    this.canUseWebAudio = !1,
                    this.WarnedWebAudioUnsupported = !1,
                    this.isMP3supported = !1,
                    this.isOGGsupported = !1,
                    this.unlocked = !0,
                    this.useCustomUnlockedButton = !1,
                    this.onAudioUnlockedObservable = new e.Observable,
                    this.onAudioLockedObservable = new e.Observable,
                    this._tryToRun = !1,
                    this._onResize = function() {
                        r._moveButtonToTopLeft()
                    }
                    ,
                    void 0 === window.AudioContext && void 0 === window.webkitAudioContext || (window.AudioContext = window.AudioContext || window.webkitAudioContext,
                    this.canUseWebAudio = !0);
                    var i = document.createElement("audio");
                    this._hostElement = t;
                    try {
                        i && i.canPlayType && i.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/, "") && (this.isMP3supported = !0)
                    } catch (e) {}
                    try {
                        i && i.canPlayType && i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, "") && (this.isOGGsupported = !0)
                    } catch (e) {}
                }
                return Object.defineProperty(t.prototype, "audioContext", {
                    get: function() {
                        return this._audioContextInitialized ? this.unlocked || this._muteButton || this._displayMuteButton() : this._initializeAudioContext(),
                        this._audioContext
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.lock = function() {
                    this._triggerSuspendedState()
                }
                ,
                t.prototype.unlock = function() {
                    this._triggerRunningState()
                }
                ,
                t.prototype._resumeAudioContext = function() {
                    var e;
                    return this._audioContext.resume && (e = this._audioContext.resume()),
                    e || Promise.resolve()
                }
                ,
                t.prototype._initializeAudioContext = function() {
                    try {
                        this.canUseWebAudio && (this._audioContext = new AudioContext,
                        this.masterGain = this._audioContext.createGain(),
                        this.masterGain.gain.value = 1,
                        this.masterGain.connect(this._audioContext.destination),
                        this._audioContextInitialized = !0,
                        "running" === this._audioContext.state && this._triggerRunningState())
                    } catch (t) {
                        this.canUseWebAudio = !1,
                        e.Tools.Error("Web Audio: " + t.message)
                    }
                }
                ,
                t.prototype._triggerRunningState = function() {
                    var e = this;
                    this._tryToRun || (this._tryToRun = !0,
                    this._resumeAudioContext().then((function() {
                        e._tryToRun = !1,
                        e._muteButton && e._hideMuteButton()
                    }
                    )).catch((function() {
                        e._tryToRun = !1,
                        e.unlocked = !1
                    }
                    )),
                    this.unlocked = !0,
                    this.onAudioUnlockedObservable.notifyObservers(this))
                }
                ,
                t.prototype._triggerSuspendedState = function() {
                    this.unlocked = !1,
                    this.onAudioLockedObservable.notifyObservers(this),
                    this._displayMuteButton()
                }
                ,
                t.prototype._displayMuteButton = function() {
                    var e = this;
                    if (!this.useCustomUnlockedButton) {
                        this._muteButton = document.createElement("BUTTON"),
                        this._muteButton.className = "babylonUnmuteIcon",
                        this._muteButton.id = "babylonUnmuteIconBtn",
                        this._muteButton.title = "Unmute";
                        var t = document.createElement("style");
                        t.appendChild(document.createTextNode(".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E);  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }")),
                        document.getElementsByTagName("head")[0].appendChild(t),
                        document.body.appendChild(this._muteButton),
                        this._moveButtonToTopLeft(),
                        this._muteButton.addEventListener("touchend", (function() {
                            e._triggerRunningState()
                        }
                        ), !0),
                        this._muteButton.addEventListener("click", (function() {
                            e._triggerRunningState()
                        }
                        ), !0),
                        window.addEventListener("resize", this._onResize)
                    }
                }
                ,
                t.prototype._moveButtonToTopLeft = function() {
                    this._hostElement && this._muteButton && (this._muteButton.style.top = this._hostElement.offsetTop + 20 + "px",
                    this._muteButton.style.left = this._hostElement.offsetLeft + 20 + "px")
                }
                ,
                t.prototype._hideMuteButton = function() {
                    this._muteButton && (document.body.removeChild(this._muteButton),
                    this._muteButton = null)
                }
                ,
                t.prototype.dispose = function() {
                    this.canUseWebAudio && this._audioContextInitialized && (this._connectedAnalyser && this._audioContext && (this._connectedAnalyser.stopDebugCanvas(),
                    this._connectedAnalyser.dispose(),
                    this.masterGain.disconnect(),
                    this.masterGain.connect(this._audioContext.destination),
                    this._connectedAnalyser = null),
                    this.masterGain.gain.value = 1),
                    this.WarnedWebAudioUnsupported = !1,
                    this._hideMuteButton(),
                    window.removeEventListener("resize", this._onResize),
                    this.onAudioUnlockedObservable.clear(),
                    this.onAudioLockedObservable.clear()
                }
                ,
                t.prototype.getGlobalVolume = function() {
                    return this.canUseWebAudio && this._audioContextInitialized ? this.masterGain.gain.value : -1
                }
                ,
                t.prototype.setGlobalVolume = function(e) {
                    this.canUseWebAudio && this._audioContextInitialized && (this.masterGain.gain.value = e)
                }
                ,
                t.prototype.connectToAnalyser = function(e) {
                    this._connectedAnalyser && this._connectedAnalyser.stopDebugCanvas(),
                    this.canUseWebAudio && this._audioContextInitialized && this._audioContext && (this._connectedAnalyser = e,
                    this.masterGain.disconnect(),
                    this._connectedAnalyser.connectAudioNodes(this.masterGain, this._audioContext.destination))
                }
                ,
                t
            }();
            e.AudioEngine = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n, o) {
                    void 0 === n && (n = null);
                    var a = this;
                    this.autoplay = !1,
                    this.loop = !1,
                    this.useCustomAttenuation = !1,
                    this.isPlaying = !1,
                    this.isPaused = !1,
                    this.spatialSound = !1,
                    this.refDistance = 1,
                    this.rolloffFactor = 1,
                    this.maxDistance = 100,
                    this.distanceModel = "linear",
                    this.onEndedObservable = new e.Observable,
                    this._panningModel = "equalpower",
                    this._playbackRate = 1,
                    this._streaming = !1,
                    this._startTime = 0,
                    this._startOffset = 0,
                    this._position = e.Vector3.Zero(),
                    this._positionInEmitterSpace = !1,
                    this._localDirection = new e.Vector3(1,0,0),
                    this._volume = 1,
                    this._isReadyToPlay = !1,
                    this._isDirectional = !1,
                    this._coneInnerAngle = 360,
                    this._coneOuterAngle = 360,
                    this._coneOuterGain = 0,
                    this._isOutputConnected = !1,
                    this._urlType = "Unknown",
                    this.name = t,
                    this._scene = i;
                    var s = i._getComponent(e.SceneComponentConstants.NAME_AUDIO);
                    if (s || (s = new e.AudioSceneComponent(i),
                    i._addComponent(s)),
                    this._readyToPlayCallback = n,
                    this._customAttenuationFunction = function(e, t, r, i, n) {
                        return t < r ? e * (1 - t / r) : 0
                    }
                    ,
                    o && (this.autoplay = o.autoplay || !1,
                    this.loop = o.loop || !1,
                    void 0 !== o.volume && (this._volume = o.volume),
                    this.spatialSound = o.spatialSound || !1,
                    this.maxDistance = o.maxDistance || 100,
                    this.useCustomAttenuation = o.useCustomAttenuation || !1,
                    this.rolloffFactor = o.rolloffFactor || 1,
                    this.refDistance = o.refDistance || 1,
                    this.distanceModel = o.distanceModel || "linear",
                    this._playbackRate = o.playbackRate || 1,
                    this._streaming = o.streaming || !1),
                    e.Engine.audioEngine.canUseWebAudio && e.Engine.audioEngine.audioContext) {
                        this._soundGain = e.Engine.audioEngine.audioContext.createGain(),
                        this._soundGain.gain.value = this._volume,
                        this._inputAudioNode = this._soundGain,
                        this._outputAudioNode = this._soundGain,
                        this.spatialSound && this._createSpatialParameters(),
                        this._scene.mainSoundTrack.AddSound(this);
                        var y = !0;
                        if (r)
                            try {
                                "string" == typeof r ? this._urlType = "String" : r instanceof ArrayBuffer ? this._urlType = "ArrayBuffer" : r instanceof MediaStream ? this._urlType = "MediaStream" : Array.isArray(r) && (this._urlType = "Array");
                                var l = []
                                  , c = !1;
                                switch (this._urlType) {
                                case "MediaStream":
                                    this._streaming = !0,
                                    this._isReadyToPlay = !0,
                                    this._streamingSource = e.Engine.audioEngine.audioContext.createMediaElementSource(r),
                                    this.autoplay && this.play(),
                                    this._readyToPlayCallback && this._readyToPlayCallback();
                                    break;
                                case "ArrayBuffer":
                                    r.byteLength > 0 && (c = !0,
                                    this._soundLoaded(r));
                                    break;
                                case "String":
                                    l.push(r);
                                case "Array":
                                    0 === l.length && (l = r);
                                    for (var h = 0; h < l.length; h++) {
                                        var u = l[h];
                                        if (-1 !== u.indexOf(".mp3", u.length - 4) && e.Engine.audioEngine.isMP3supported && (c = !0),
                                        -1 !== u.indexOf(".ogg", u.length - 4) && e.Engine.audioEngine.isOGGsupported && (c = !0),
                                        -1 !== u.indexOf(".wav", u.length - 4) && (c = !0),
                                        -1 !== u.indexOf("blob:") && (c = !0),
                                        c) {
                                            this._streaming ? (this._htmlAudioElement = new Audio(u),
                                            this._htmlAudioElement.controls = !1,
                                            this._htmlAudioElement.loop = this.loop,
                                            e.Tools.SetCorsBehavior(u, this._htmlAudioElement),
                                            this._htmlAudioElement.preload = "auto",
                                            this._htmlAudioElement.addEventListener("canplaythrough", (function() {
                                                a._isReadyToPlay = !0,
                                                a.autoplay && a.play(),
                                                a._readyToPlayCallback && a._readyToPlayCallback()
                                            }
                                            )),
                                            document.body.appendChild(this._htmlAudioElement),
                                            this._htmlAudioElement.load()) : this._scene._loadFile(u, (function(e) {
                                                a._soundLoaded(e)
                                            }
                                            ), void 0, !0, !0, (function(t) {
                                                t && e.Tools.Error("XHR " + t.status + " error on: " + u + "."),
                                                e.Tools.Error("Sound creation aborted."),
                                                a._scene.mainSoundTrack.RemoveSound(a)
                                            }
                                            ));
                                            break
                                        }
                                    }
                                    break;
                                default:
                                    y = !1
                                }
                                y ? c || (this._isReadyToPlay = !0,
                                this._readyToPlayCallback && window.setTimeout((function() {
                                    a._readyToPlayCallback && a._readyToPlayCallback()
                                }
                                ), 1e3)) : e.Tools.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")
                            } catch (t) {
                                e.Tools.Error("Unexpected error. Sound creation aborted."),
                                this._scene.mainSoundTrack.RemoveSound(this)
                            }
                    } else
                        this._scene.mainSoundTrack.AddSound(this),
                        e.Engine.audioEngine.WarnedWebAudioUnsupported || (e.Tools.Error("Web Audio is not supported by your browser."),
                        e.Engine.audioEngine.WarnedWebAudioUnsupported = !0),
                        this._readyToPlayCallback && window.setTimeout((function() {
                            a._readyToPlayCallback && a._readyToPlayCallback()
                        }
                        ), 1e3)
                }
                return t.prototype.dispose = function() {
                    e.Engine.audioEngine.canUseWebAudio && (this.isPlaying && this.stop(),
                    this._isReadyToPlay = !1,
                    -1 === this.soundTrackId ? this._scene.mainSoundTrack.RemoveSound(this) : this._scene.soundTracks && this._scene.soundTracks[this.soundTrackId].RemoveSound(this),
                    this._soundGain && (this._soundGain.disconnect(),
                    this._soundGain = null),
                    this._soundPanner && (this._soundPanner.disconnect(),
                    this._soundPanner = null),
                    this._soundSource && (this._soundSource.disconnect(),
                    this._soundSource = null),
                    this._audioBuffer = null,
                    this._htmlAudioElement && (this._htmlAudioElement.pause(),
                    this._htmlAudioElement.src = "",
                    document.body.removeChild(this._htmlAudioElement)),
                    this._streamingSource && this._streamingSource.disconnect(),
                    this._connectedMesh && this._registerFunc && (this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),
                    this._connectedMesh = null))
                }
                ,
                t.prototype.isReady = function() {
                    return this._isReadyToPlay
                }
                ,
                t.prototype._soundLoaded = function(t) {
                    var r = this;
                    e.Engine.audioEngine.audioContext && e.Engine.audioEngine.audioContext.decodeAudioData(t, (function(e) {
                        r._audioBuffer = e,
                        r._isReadyToPlay = !0,
                        r.autoplay && r.play(),
                        r._readyToPlayCallback && r._readyToPlayCallback()
                    }
                    ), (function(t) {
                        e.Tools.Error("Error while decoding audio data for: " + r.name + " / Error: " + t)
                    }
                    ))
                }
                ,
                t.prototype.setAudioBuffer = function(t) {
                    e.Engine.audioEngine.canUseWebAudio && (this._audioBuffer = t,
                    this._isReadyToPlay = !0)
                }
                ,
                t.prototype.updateOptions = function(e) {
                    e && (this.loop = e.loop || this.loop,
                    this.maxDistance = e.maxDistance || this.maxDistance,
                    this.useCustomAttenuation = e.useCustomAttenuation || this.useCustomAttenuation,
                    this.rolloffFactor = e.rolloffFactor || this.rolloffFactor,
                    this.refDistance = e.refDistance || this.refDistance,
                    this.distanceModel = e.distanceModel || this.distanceModel,
                    this._playbackRate = e.playbackRate || this._playbackRate,
                    this._updateSpatialParameters(),
                    this.isPlaying && (this._streaming && this._htmlAudioElement ? this._htmlAudioElement.playbackRate = this._playbackRate : this._soundSource && (this._soundSource.playbackRate.value = this._playbackRate)))
                }
                ,
                t.prototype._createSpatialParameters = function() {
                    e.Engine.audioEngine.canUseWebAudio && e.Engine.audioEngine.audioContext && (this._scene.headphone && (this._panningModel = "HRTF"),
                    this._soundPanner = e.Engine.audioEngine.audioContext.createPanner(),
                    this._updateSpatialParameters(),
                    this._soundPanner.connect(this._outputAudioNode),
                    this._inputAudioNode = this._soundPanner)
                }
                ,
                t.prototype._updateSpatialParameters = function() {
                    this.spatialSound && this._soundPanner && (this.useCustomAttenuation ? (this._soundPanner.distanceModel = "linear",
                    this._soundPanner.maxDistance = Number.MAX_VALUE,
                    this._soundPanner.refDistance = 1,
                    this._soundPanner.rolloffFactor = 1,
                    this._soundPanner.panningModel = this._panningModel) : (this._soundPanner.distanceModel = this.distanceModel,
                    this._soundPanner.maxDistance = this.maxDistance,
                    this._soundPanner.refDistance = this.refDistance,
                    this._soundPanner.rolloffFactor = this.rolloffFactor,
                    this._soundPanner.panningModel = this._panningModel))
                }
                ,
                t.prototype.switchPanningModelToHRTF = function() {
                    this._panningModel = "HRTF",
                    this._switchPanningModel()
                }
                ,
                t.prototype.switchPanningModelToEqualPower = function() {
                    this._panningModel = "equalpower",
                    this._switchPanningModel()
                }
                ,
                t.prototype._switchPanningModel = function() {
                    e.Engine.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && (this._soundPanner.panningModel = this._panningModel)
                }
                ,
                t.prototype.connectToSoundTrackAudioNode = function(t) {
                    e.Engine.audioEngine.canUseWebAudio && (this._isOutputConnected && this._outputAudioNode.disconnect(),
                    this._outputAudioNode.connect(t),
                    this._isOutputConnected = !0)
                }
                ,
                t.prototype.setDirectionalCone = function(t, r, i) {
                    r < t ? e.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.") : (this._coneInnerAngle = t,
                    this._coneOuterAngle = r,
                    this._coneOuterGain = i,
                    this._isDirectional = !0,
                    this.isPlaying && this.loop && (this.stop(),
                    this.play()))
                }
                ,
                Object.defineProperty(t.prototype, "directionalConeInnerAngle", {
                    get: function() {
                        return this._coneInnerAngle
                    },
                    set: function(t) {
                        if (t != this._coneInnerAngle) {
                            if (this._coneOuterAngle < t)
                                return void e.Tools.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");
                            this._coneInnerAngle = t,
                            e.Engine.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && (this._soundPanner.coneInnerAngle = this._coneInnerAngle)
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "directionalConeOuterAngle", {
                    get: function() {
                        return this._coneOuterAngle
                    },
                    set: function(t) {
                        if (t != this._coneOuterAngle) {
                            if (t < this._coneInnerAngle)
                                return void e.Tools.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");
                            this._coneOuterAngle = t,
                            e.Engine.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && (this._soundPanner.coneOuterAngle = this._coneOuterAngle)
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.setPosition = function(t) {
                    this._position = t,
                    e.Engine.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && !isNaN(this._position.x) && !isNaN(this._position.y) && !isNaN(this._position.z) && this._soundPanner.setPosition(this._position.x, this._position.y, this._position.z)
                }
                ,
                t.prototype.setLocalDirectionToMesh = function(t) {
                    this._localDirection = t,
                    e.Engine.audioEngine.canUseWebAudio && this._connectedMesh && this.isPlaying && this._updateDirection()
                }
                ,
                t.prototype._updateDirection = function() {
                    if (this._connectedMesh && this._soundPanner) {
                        var t = this._connectedMesh.getWorldMatrix()
                          , r = e.Vector3.TransformNormal(this._localDirection, t);
                        r.normalize(),
                        this._soundPanner.setOrientation(r.x, r.y, r.z)
                    }
                }
                ,
                t.prototype.updateDistanceFromListener = function() {
                    if (e.Engine.audioEngine.canUseWebAudio && this._connectedMesh && this.useCustomAttenuation && this._soundGain && this._scene.activeCamera) {
                        var t = this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);
                        this._soundGain.gain.value = this._customAttenuationFunction(this._volume, t, this.maxDistance, this.refDistance, this.rolloffFactor)
                    }
                }
                ,
                t.prototype.setAttenuationFunction = function(e) {
                    this._customAttenuationFunction = e
                }
                ,
                t.prototype.play = function(t, r) {
                    var i = this;
                    if (this._isReadyToPlay && this._scene.audioEnabled && e.Engine.audioEngine.audioContext)
                        try {
                            this._startOffset < 0 && (t = -this._startOffset,
                            this._startOffset = 0);
                            var n = t ? e.Engine.audioEngine.audioContext.currentTime + t : e.Engine.audioEngine.audioContext.currentTime;
                            if (this._soundSource && this._streamingSource || this.spatialSound && this._soundPanner && (isNaN(this._position.x) || isNaN(this._position.y) || isNaN(this._position.z) || this._soundPanner.setPosition(this._position.x, this._position.y, this._position.z),
                            this._isDirectional && (this._soundPanner.coneInnerAngle = this._coneInnerAngle,
                            this._soundPanner.coneOuterAngle = this._coneOuterAngle,
                            this._soundPanner.coneOuterGain = this._coneOuterGain,
                            this._connectedMesh ? this._updateDirection() : this._soundPanner.setOrientation(this._localDirection.x, this._localDirection.y, this._localDirection.z))),
                            this._streaming) {
                                if (this._streamingSource || (this._streamingSource = e.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),
                                this._htmlAudioElement.onended = function() {
                                    i._onended()
                                }
                                ,
                                this._htmlAudioElement.playbackRate = this._playbackRate),
                                this._streamingSource.disconnect(),
                                this._streamingSource.connect(this._inputAudioNode),
                                this._htmlAudioElement) {
                                    var o = function() {
                                        if (e.Engine.audioEngine.unlocked) {
                                            var t = i._htmlAudioElement.play();
                                            void 0 !== t && t.catch((function(t) {
                                                e.Engine.audioEngine.lock(),
                                                e.Engine.audioEngine.onAudioUnlockedObservable.addOnce((function() {
                                                    o()
                                                }
                                                ))
                                            }
                                            ))
                                        } else
                                            e.Engine.audioEngine.onAudioUnlockedObservable.addOnce((function() {
                                                o()
                                            }
                                            ))
                                    };
                                    o()
                                }
                            } else
                                this._soundSource = e.Engine.audioEngine.audioContext.createBufferSource(),
                                this._soundSource.buffer = this._audioBuffer,
                                this._soundSource.connect(this._inputAudioNode),
                                this._soundSource.loop = this.loop,
                                this._soundSource.playbackRate.value = this._playbackRate,
                                this._soundSource.onended = function() {
                                    i._onended()
                                }
                                ,
                                this._soundSource.buffer && this._soundSource.start(n, this.isPaused ? this._startOffset % this._soundSource.buffer.duration : r || 0);
                            this._startTime = n,
                            this.isPlaying = !0,
                            this.isPaused = !1
                        } catch (t) {
                            e.Tools.Error("Error while trying to play audio: " + this.name + ", " + t.message)
                        }
                }
                ,
                t.prototype._onended = function() {
                    this.isPlaying = !1,
                    this.onended && this.onended(),
                    this.onEndedObservable.notifyObservers(this)
                }
                ,
                t.prototype.stop = function(t) {
                    if (this.isPlaying) {
                        if (this._streaming)
                            this._htmlAudioElement ? (this._htmlAudioElement.pause(),
                            this._htmlAudioElement.currentTime > 0 && (this._htmlAudioElement.currentTime = 0)) : this._streamingSource.disconnect();
                        else if (e.Engine.audioEngine.audioContext && this._soundSource) {
                            var r = t ? e.Engine.audioEngine.audioContext.currentTime + t : e.Engine.audioEngine.audioContext.currentTime;
                            this._soundSource.stop(r),
                            this._soundSource.onended = function() {}
                            ,
                            this.isPaused || (this._startOffset = 0)
                        }
                        this.isPlaying = !1
                    }
                }
                ,
                t.prototype.pause = function() {
                    this.isPlaying && (this.isPaused = !0,
                    this._streaming ? this._htmlAudioElement ? this._htmlAudioElement.pause() : this._streamingSource.disconnect() : e.Engine.audioEngine.audioContext && (this.stop(0),
                    this._startOffset += e.Engine.audioEngine.audioContext.currentTime - this._startTime))
                }
                ,
                t.prototype.setVolume = function(t, r) {
                    e.Engine.audioEngine.canUseWebAudio && this._soundGain && (r && e.Engine.audioEngine.audioContext ? (this._soundGain.gain.cancelScheduledValues(e.Engine.audioEngine.audioContext.currentTime),
                    this._soundGain.gain.setValueAtTime(this._soundGain.gain.value, e.Engine.audioEngine.audioContext.currentTime),
                    this._soundGain.gain.linearRampToValueAtTime(t, e.Engine.audioEngine.audioContext.currentTime + r)) : this._soundGain.gain.value = t),
                    this._volume = t
                }
                ,
                t.prototype.setPlaybackRate = function(e) {
                    this._playbackRate = e,
                    this.isPlaying && (this._streaming && this._htmlAudioElement ? this._htmlAudioElement.playbackRate = this._playbackRate : this._soundSource && (this._soundSource.playbackRate.value = this._playbackRate))
                }
                ,
                t.prototype.getVolume = function() {
                    return this._volume
                }
                ,
                t.prototype.attachToMesh = function(e) {
                    var t = this;
                    this._connectedMesh && this._registerFunc && (this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),
                    this._registerFunc = null),
                    this._connectedMesh = e,
                    this.spatialSound || (this.spatialSound = !0,
                    this._createSpatialParameters(),
                    this.isPlaying && this.loop && (this.stop(),
                    this.play())),
                    this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),
                    this._registerFunc = function(e) {
                        return t._onRegisterAfterWorldMatrixUpdate(e)
                    }
                    ,
                    e.registerAfterWorldMatrixUpdate(this._registerFunc)
                }
                ,
                t.prototype.detachFromMesh = function() {
                    this._connectedMesh && this._registerFunc && (this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),
                    this._registerFunc = null,
                    this._connectedMesh = null)
                }
                ,
                t.prototype._onRegisterAfterWorldMatrixUpdate = function(t) {
                    if (t.getBoundingInfo) {
                        var r = t;
                        if (this._positionInEmitterSpace)
                            r.worldMatrixFromCache.invertToRef(e.Tmp.Matrix[0]),
                            this.setPosition(e.Tmp.Matrix[0].getTranslation());
                        else {
                            var i = r.getBoundingInfo();
                            this.setPosition(i.boundingSphere.centerWorld)
                        }
                        e.Engine.audioEngine.canUseWebAudio && this._isDirectional && this.isPlaying && this._updateDirection()
                    }
                }
                ,
                t.prototype.clone = function() {
                    var e = this;
                    if (this._streaming)
                        return null;
                    var r = function() {
                        e._isReadyToPlay ? (n._audioBuffer = e.getAudioBuffer(),
                        n._isReadyToPlay = !0,
                        n.autoplay && n.play()) : window.setTimeout(r, 300)
                    }
                      , i = {
                        autoplay: this.autoplay,
                        loop: this.loop,
                        volume: this._volume,
                        spatialSound: this.spatialSound,
                        maxDistance: this.maxDistance,
                        useCustomAttenuation: this.useCustomAttenuation,
                        rolloffFactor: this.rolloffFactor,
                        refDistance: this.refDistance,
                        distanceModel: this.distanceModel
                    }
                      , n = new t(this.name + "_cloned",new ArrayBuffer(0),this._scene,null,i);
                    return this.useCustomAttenuation && n.setAttenuationFunction(this._customAttenuationFunction),
                    n.setPosition(this._position),
                    n.setPlaybackRate(this._playbackRate),
                    r(),
                    n
                }
                ,
                t.prototype.getAudioBuffer = function() {
                    return this._audioBuffer
                }
                ,
                t.prototype.serialize = function() {
                    var e = {
                        name: this.name,
                        url: this.name,
                        autoplay: this.autoplay,
                        loop: this.loop,
                        volume: this._volume,
                        spatialSound: this.spatialSound,
                        maxDistance: this.maxDistance,
                        rolloffFactor: this.rolloffFactor,
                        refDistance: this.refDistance,
                        distanceModel: this.distanceModel,
                        playbackRate: this._playbackRate,
                        panningModel: this._panningModel,
                        soundTrackId: this.soundTrackId
                    };
                    return this.spatialSound && (this._connectedMesh && (e.connectedMeshId = this._connectedMesh.id),
                    e.position = this._position.asArray(),
                    e.refDistance = this.refDistance,
                    e.distanceModel = this.distanceModel,
                    e.isDirectional = this._isDirectional,
                    e.localDirectionToMesh = this._localDirection.asArray(),
                    e.coneInnerAngle = this._coneInnerAngle,
                    e.coneOuterAngle = this._coneOuterAngle,
                    e.coneOuterGain = this._coneOuterGain),
                    e
                }
                ,
                t.Parse = function(r, i, n, o) {
                    var a, s = r.name;
                    a = r.url ? n + r.url : n + s;
                    var y, l = {
                        autoplay: r.autoplay,
                        loop: r.loop,
                        volume: r.volume,
                        spatialSound: r.spatialSound,
                        maxDistance: r.maxDistance,
                        rolloffFactor: r.rolloffFactor,
                        refDistance: r.refDistance,
                        distanceModel: r.distanceModel,
                        playbackRate: r.playbackRate
                    };
                    if (o) {
                        var c = function() {
                            o._isReadyToPlay ? (y._audioBuffer = o.getAudioBuffer(),
                            y._isReadyToPlay = !0,
                            y.autoplay && y.play()) : window.setTimeout(c, 300)
                        };
                        y = new t(s,new ArrayBuffer(0),i,null,l),
                        c()
                    } else
                        y = new t(s,a,i,(function() {
                            i._removePendingData(y)
                        }
                        ),l),
                        i._addPendingData(y);
                    if (r.position) {
                        var h = e.Vector3.FromArray(r.position);
                        y.setPosition(h)
                    }
                    if (r.isDirectional && (y.setDirectionalCone(r.coneInnerAngle || 360, r.coneOuterAngle || 360, r.coneOuterGain || 0),
                    r.localDirectionToMesh)) {
                        var u = e.Vector3.FromArray(r.localDirectionToMesh);
                        y.setLocalDirectionToMesh(u)
                    }
                    if (r.connectedMeshId) {
                        var d = i.getMeshByID(r.connectedMeshId);
                        d && y.attachToMesh(d)
                    }
                    return y
                }
                ,
                t
            }();
            e.Sound = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t) {
                    void 0 === t && (t = {}),
                    this.id = -1,
                    this._isMainTrack = !1,
                    this._isInitialized = !1,
                    this._scene = e,
                    this.soundCollection = new Array,
                    this._options = t,
                    !this._isMainTrack && this._scene.soundTracks && (this._scene.soundTracks.push(this),
                    this.id = this._scene.soundTracks.length - 1)
                }
                return t.prototype._initializeSoundTrackAudioGraph = function() {
                    e.Engine.audioEngine.canUseWebAudio && e.Engine.audioEngine.audioContext && (this._outputAudioNode = e.Engine.audioEngine.audioContext.createGain(),
                    this._outputAudioNode.connect(e.Engine.audioEngine.masterGain),
                    this._options && (this._options.volume && (this._outputAudioNode.gain.value = this._options.volume),
                    this._options.mainTrack && (this._isMainTrack = this._options.mainTrack)),
                    this._isInitialized = !0)
                }
                ,
                t.prototype.dispose = function() {
                    if (e.Engine.audioEngine && e.Engine.audioEngine.canUseWebAudio) {
                        for (this._connectedAnalyser && this._connectedAnalyser.stopDebugCanvas(); this.soundCollection.length; )
                            this.soundCollection[0].dispose();
                        this._outputAudioNode && this._outputAudioNode.disconnect(),
                        this._outputAudioNode = null
                    }
                }
                ,
                t.prototype.AddSound = function(t) {
                    this._isInitialized || this._initializeSoundTrackAudioGraph(),
                    e.Engine.audioEngine.canUseWebAudio && this._outputAudioNode && t.connectToSoundTrackAudioNode(this._outputAudioNode),
                    t.soundTrackId && (-1 === t.soundTrackId ? this._scene.mainSoundTrack.RemoveSound(t) : this._scene.soundTracks && this._scene.soundTracks[t.soundTrackId].RemoveSound(t)),
                    this.soundCollection.push(t),
                    t.soundTrackId = this.id
                }
                ,
                t.prototype.RemoveSound = function(e) {
                    var t = this.soundCollection.indexOf(e);
                    -1 !== t && this.soundCollection.splice(t, 1)
                }
                ,
                t.prototype.setVolume = function(t) {
                    e.Engine.audioEngine.canUseWebAudio && this._outputAudioNode && (this._outputAudioNode.gain.value = t)
                }
                ,
                t.prototype.switchPanningModelToHRTF = function() {
                    if (e.Engine.audioEngine.canUseWebAudio)
                        for (var t = 0; t < this.soundCollection.length; t++)
                            this.soundCollection[t].switchPanningModelToHRTF()
                }
                ,
                t.prototype.switchPanningModelToEqualPower = function() {
                    if (e.Engine.audioEngine.canUseWebAudio)
                        for (var t = 0; t < this.soundCollection.length; t++)
                            this.soundCollection[t].switchPanningModelToEqualPower()
                }
                ,
                t.prototype.connectToAnalyser = function(t) {
                    this._connectedAnalyser && this._connectedAnalyser.stopDebugCanvas(),
                    this._connectedAnalyser = t,
                    e.Engine.audioEngine.canUseWebAudio && this._outputAudioNode && (this._outputAudioNode.disconnect(),
                    this._connectedAnalyser.connectAudioNodes(this._outputAudioNode, e.Engine.audioEngine.masterGain))
                }
                ,
                t
            }();
            e.SoundTrack = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    this.SMOOTHING = .75,
                    this.FFT_SIZE = 512,
                    this.BARGRAPHAMPLITUDE = 256,
                    this.DEBUGCANVASPOS = {
                        x: 20,
                        y: 20
                    },
                    this.DEBUGCANVASSIZE = {
                        width: 320,
                        height: 200
                    },
                    this._scene = t,
                    this._audioEngine = e.Engine.audioEngine,
                    this._audioEngine.canUseWebAudio && this._audioEngine.audioContext && (this._webAudioAnalyser = this._audioEngine.audioContext.createAnalyser(),
                    this._webAudioAnalyser.minDecibels = -140,
                    this._webAudioAnalyser.maxDecibels = 0,
                    this._byteFreqs = new Uint8Array(this._webAudioAnalyser.frequencyBinCount),
                    this._byteTime = new Uint8Array(this._webAudioAnalyser.frequencyBinCount),
                    this._floatFreqs = new Float32Array(this._webAudioAnalyser.frequencyBinCount))
                }
                return t.prototype.getFrequencyBinCount = function() {
                    return this._audioEngine.canUseWebAudio ? this._webAudioAnalyser.frequencyBinCount : 0
                }
                ,
                t.prototype.getByteFrequencyData = function() {
                    return this._audioEngine.canUseWebAudio && (this._webAudioAnalyser.smoothingTimeConstant = this.SMOOTHING,
                    this._webAudioAnalyser.fftSize = this.FFT_SIZE,
                    this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),
                    this._byteFreqs
                }
                ,
                t.prototype.getByteTimeDomainData = function() {
                    return this._audioEngine.canUseWebAudio && (this._webAudioAnalyser.smoothingTimeConstant = this.SMOOTHING,
                    this._webAudioAnalyser.fftSize = this.FFT_SIZE,
                    this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),
                    this._byteTime
                }
                ,
                t.prototype.getFloatFrequencyData = function() {
                    return this._audioEngine.canUseWebAudio && (this._webAudioAnalyser.smoothingTimeConstant = this.SMOOTHING,
                    this._webAudioAnalyser.fftSize = this.FFT_SIZE,
                    this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),
                    this._floatFreqs
                }
                ,
                t.prototype.drawDebugCanvas = function() {
                    var e = this;
                    if (this._audioEngine.canUseWebAudio && (this._debugCanvas || (this._debugCanvas = document.createElement("canvas"),
                    this._debugCanvas.width = this.DEBUGCANVASSIZE.width,
                    this._debugCanvas.height = this.DEBUGCANVASSIZE.height,
                    this._debugCanvas.style.position = "absolute",
                    this._debugCanvas.style.top = this.DEBUGCANVASPOS.y + "px",
                    this._debugCanvas.style.left = this.DEBUGCANVASPOS.x + "px",
                    this._debugCanvasContext = this._debugCanvas.getContext("2d"),
                    document.body.appendChild(this._debugCanvas),
                    this._registerFunc = function() {
                        e.drawDebugCanvas()
                    }
                    ,
                    this._scene.registerBeforeRender(this._registerFunc)),
                    this._registerFunc && this._debugCanvasContext)) {
                        var t = this.getByteFrequencyData();
                        this._debugCanvasContext.fillStyle = "rgb(0, 0, 0)",
                        this._debugCanvasContext.fillRect(0, 0, this.DEBUGCANVASSIZE.width, this.DEBUGCANVASSIZE.height);
                        for (var r = 0; r < this.getFrequencyBinCount(); r++) {
                            var i = t[r] / this.BARGRAPHAMPLITUDE
                              , n = this.DEBUGCANVASSIZE.height * i
                              , o = this.DEBUGCANVASSIZE.height - n - 1
                              , a = this.DEBUGCANVASSIZE.width / this.getFrequencyBinCount()
                              , s = r / this.getFrequencyBinCount() * 360;
                            this._debugCanvasContext.fillStyle = "hsl(" + s + ", 100%, 50%)",
                            this._debugCanvasContext.fillRect(r * a, o, a, n)
                        }
                    }
                }
                ,
                t.prototype.stopDebugCanvas = function() {
                    this._debugCanvas && (this._registerFunc && (this._scene.unregisterBeforeRender(this._registerFunc),
                    this._registerFunc = null),
                    document.body.removeChild(this._debugCanvas),
                    this._debugCanvas = null,
                    this._debugCanvasContext = null)
                }
                ,
                t.prototype.connectAudioNodes = function(e, t) {
                    this._audioEngine.canUseWebAudio && (e.connect(this._webAudioAnalyser),
                    this._webAudioAnalyser.connect(t))
                }
                ,
                t.prototype.dispose = function() {
                    this._audioEngine.canUseWebAudio && this._webAudioAnalyser.disconnect()
                }
                ,
                t
            }();
            e.Analyser = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t, r) {
                    var i = this;
                    if (this.loop = !1,
                    this._coneInnerAngle = 360,
                    this._coneOuterAngle = 360,
                    this._volume = 1,
                    this.isPlaying = !1,
                    this.isPaused = !1,
                    this._sounds = [],
                    this._weights = [],
                    t.length !== r.length)
                        throw new Error("Sounds length does not equal weights length");
                    this.loop = e,
                    this._weights = r;
                    for (var n = 0, o = 0, a = r; o < a.length; o++) {
                        n += a[o]
                    }
                    for (var s = n > 0 ? 1 / n : 0, y = 0; y < this._weights.length; y++)
                        this._weights[y] *= s;
                    this._sounds = t;
                    for (var l = 0, c = this._sounds; l < c.length; l++) {
                        c[l].onEndedObservable.add((function() {
                            i._onended()
                        }
                        ))
                    }
                }
                return Object.defineProperty(t.prototype, "directionalConeInnerAngle", {
                    get: function() {
                        return this._coneInnerAngle
                    },
                    set: function(t) {
                        if (t !== this._coneInnerAngle) {
                            if (this._coneOuterAngle < t)
                                return void e.Tools.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");
                            this._coneInnerAngle = t;
                            for (var r = 0, i = this._sounds; r < i.length; r++) {
                                i[r].directionalConeInnerAngle = t
                            }
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "directionalConeOuterAngle", {
                    get: function() {
                        return this._coneOuterAngle
                    },
                    set: function(t) {
                        if (t !== this._coneOuterAngle) {
                            if (t < this._coneInnerAngle)
                                return void e.Tools.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");
                            this._coneOuterAngle = t;
                            for (var r = 0, i = this._sounds; r < i.length; r++) {
                                i[r].directionalConeOuterAngle = t
                            }
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "volume", {
                    get: function() {
                        return this._volume
                    },
                    set: function(e) {
                        if (e !== this._volume)
                            for (var t = 0, r = this._sounds; t < r.length; t++) {
                                r[t].setVolume(e)
                            }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._onended = function() {
                    void 0 !== this._currentIndex && (this._sounds[this._currentIndex].autoplay = !1),
                    this.loop && this.isPlaying ? this.play() : this.isPlaying = !1
                }
                ,
                t.prototype.pause = function() {
                    this.isPaused = !0,
                    void 0 !== this._currentIndex && this._sounds[this._currentIndex].pause()
                }
                ,
                t.prototype.stop = function() {
                    this.isPlaying = !1,
                    void 0 !== this._currentIndex && this._sounds[this._currentIndex].stop()
                }
                ,
                t.prototype.play = function(e) {
                    if (!this.isPaused) {
                        this.stop();
                        for (var t = Math.random(), r = 0, i = 0; i < this._weights.length; i++)
                            if (t <= (r += this._weights[i])) {
                                this._currentIndex = i;
                                break
                            }
                    }
                    var n = this._sounds[this._currentIndex];
                    n.isReady() ? n.play(0, this.isPaused ? void 0 : e) : n.autoplay = !0,
                    this.isPlaying = !0,
                    this.isPaused = !1
                }
                ,
                t
            }();
            e.WeightedSound = t
        }(s || (s = {})),
        function(e) {
            e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_AUDIO, (function(t, r, i, n) {
                var o, a = [];
                if (i.sounds = i.sounds || [],
                void 0 !== t.sounds && null !== t.sounds)
                    for (var s = 0, y = t.sounds.length; s < y; s++) {
                        var l = t.sounds[s];
                        e.Engine.audioEngine.canUseWebAudio ? (l.url || (l.url = l.name),
                        a[l.url] ? i.sounds.push(e.Sound.Parse(l, r, n, a[l.url])) : (o = e.Sound.Parse(l, r, n),
                        a[l.url] = o,
                        i.sounds.push(o))) : i.sounds.push(new e.Sound(l.name,null,r))
                    }
                a = []
            }
            )),
            Object.defineProperty(e.Scene.prototype, "mainSoundTrack", {
                get: function() {
                    var r = this._getComponent(e.SceneComponentConstants.NAME_AUDIO);
                    return r || (r = new t(this),
                    this._addComponent(r)),
                    this._mainSoundTrack || (this._mainSoundTrack = new e.SoundTrack(this,{
                        mainTrack: !0
                    })),
                    this._mainSoundTrack
                },
                enumerable: !0,
                configurable: !0
            }),
            e.Scene.prototype.getSoundByName = function(e) {
                var t;
                for (t = 0; t < this.mainSoundTrack.soundCollection.length; t++)
                    if (this.mainSoundTrack.soundCollection[t].name === e)
                        return this.mainSoundTrack.soundCollection[t];
                if (this.soundTracks)
                    for (var r = 0; r < this.soundTracks.length; r++)
                        for (t = 0; t < this.soundTracks[r].soundCollection.length; t++)
                            if (this.soundTracks[r].soundCollection[t].name === e)
                                return this.soundTracks[r].soundCollection[t];
                return null
            }
            ,
            Object.defineProperty(e.Scene.prototype, "audioEnabled", {
                get: function() {
                    var r = this._getComponent(e.SceneComponentConstants.NAME_AUDIO);
                    return r || (r = new t(this),
                    this._addComponent(r)),
                    r.audioEnabled
                },
                set: function(r) {
                    var i = this._getComponent(e.SceneComponentConstants.NAME_AUDIO);
                    i || (i = new t(this),
                    this._addComponent(i)),
                    r ? i.enableAudio() : i.disableAudio()
                },
                enumerable: !0,
                configurable: !0
            }),
            Object.defineProperty(e.Scene.prototype, "headphone", {
                get: function() {
                    var r = this._getComponent(e.SceneComponentConstants.NAME_AUDIO);
                    return r || (r = new t(this),
                    this._addComponent(r)),
                    r.headphone
                },
                set: function(r) {
                    var i = this._getComponent(e.SceneComponentConstants.NAME_AUDIO);
                    i || (i = new t(this),
                    this._addComponent(i)),
                    r ? i.switchAudioModeForHeadphones() : i.switchAudioModeForNormalSpeakers()
                },
                enumerable: !0,
                configurable: !0
            });
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_AUDIO,
                    this._audioEnabled = !0,
                    this._headphone = !1,
                    this.scene = t,
                    t.soundTracks = new Array,
                    t.sounds = new Array
                }
                return Object.defineProperty(t.prototype, "audioEnabled", {
                    get: function() {
                        return this._audioEnabled
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "headphone", {
                    get: function() {
                        return this._headphone
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.register = function() {
                    this.scene._afterRenderStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDER_AUDIO, this, this._afterRender)
                }
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.serialize = function(e) {
                    if (e.sounds = [],
                    this.scene.soundTracks)
                        for (var t = 0; t < this.scene.soundTracks.length; t++)
                            for (var r = this.scene.soundTracks[t], i = 0; i < r.soundCollection.length; i++)
                                e.sounds.push(r.soundCollection[i].serialize())
                }
                ,
                t.prototype.addFromContainer = function(e) {
                    var t = this;
                    e.sounds && e.sounds.forEach((function(e) {
                        e.play(),
                        e.autoplay = !0,
                        t.scene.mainSoundTrack.AddSound(e)
                    }
                    ))
                }
                ,
                t.prototype.removeFromContainer = function(e) {
                    var t = this;
                    e.sounds && e.sounds.forEach((function(e) {
                        e.stop(),
                        e.autoplay = !1,
                        t.scene.mainSoundTrack.RemoveSound(e)
                    }
                    ))
                }
                ,
                t.prototype.dispose = function() {
                    var e = this.scene;
                    if (e._mainSoundTrack && e.mainSoundTrack.dispose(),
                    e.soundTracks)
                        for (var t = 0; t < e.soundTracks.length; t++)
                            e.soundTracks[t].dispose()
                }
                ,
                t.prototype.disableAudio = function() {
                    var e, t = this.scene;
                    for (this._audioEnabled = !1,
                    e = 0; e < t.mainSoundTrack.soundCollection.length; e++)
                        t.mainSoundTrack.soundCollection[e].pause();
                    if (t.soundTracks)
                        for (e = 0; e < t.soundTracks.length; e++)
                            for (var r = 0; r < t.soundTracks[e].soundCollection.length; r++)
                                t.soundTracks[e].soundCollection[r].pause()
                }
                ,
                t.prototype.enableAudio = function() {
                    var e, t = this.scene;
                    for (this._audioEnabled = !0,
                    e = 0; e < t.mainSoundTrack.soundCollection.length; e++)
                        t.mainSoundTrack.soundCollection[e].isPaused && t.mainSoundTrack.soundCollection[e].play();
                    if (t.soundTracks)
                        for (e = 0; e < t.soundTracks.length; e++)
                            for (var r = 0; r < t.soundTracks[e].soundCollection.length; r++)
                                t.soundTracks[e].soundCollection[r].isPaused && t.soundTracks[e].soundCollection[r].play()
                }
                ,
                t.prototype.switchAudioModeForHeadphones = function() {
                    var e = this.scene;
                    if (this._headphone = !0,
                    e.mainSoundTrack.switchPanningModelToHRTF(),
                    e.soundTracks)
                        for (var t = 0; t < e.soundTracks.length; t++)
                            e.soundTracks[t].switchPanningModelToHRTF()
                }
                ,
                t.prototype.switchAudioModeForNormalSpeakers = function() {
                    var e = this.scene;
                    if (this._headphone = !1,
                    e.mainSoundTrack.switchPanningModelToEqualPower(),
                    e.soundTracks)
                        for (var t = 0; t < e.soundTracks.length; t++)
                            e.soundTracks[t].switchPanningModelToEqualPower()
                }
                ,
                t.prototype._afterRender = function() {
                    var t = this.scene;
                    if (this._audioEnabled && t._mainSoundTrack && t.soundTracks && (0 !== t._mainSoundTrack.soundCollection.length || 1 !== t.soundTracks.length)) {
                        var r, i = e.Engine.audioEngine;
                        if ((r = t.activeCameras.length > 0 ? t.activeCameras[0] : t.activeCamera) && i.audioContext) {
                            var n = null != i.audioContext.listener.positionX;
                            n ? (i.audioContext.listener.positionX.value = r.globalPosition.x,
                            i.audioContext.listener.positionY.value = r.globalPosition.y,
                            i.audioContext.listener.positionZ.value = r.globalPosition.z) : i.audioContext.listener.setPosition(r.globalPosition.x, r.globalPosition.y, r.globalPosition.z),
                            r.rigCameras && r.rigCameras.length > 0 && (r = r.rigCameras[0]);
                            var o, a = e.Matrix.Invert(r.getViewMatrix()), s = e.Vector3.TransformNormal(new e.Vector3(0,0,-1), a);
                            for (s.normalize(),
                            isNaN(s.x) || isNaN(s.y) || isNaN(s.z) || (n ? (i.audioContext.listener.forwardX.value = s.x,
                            i.audioContext.listener.forwardY.value = s.y,
                            i.audioContext.listener.forwardZ.value = s.z) : i.audioContext.listener.setOrientation(s.x, s.y, s.z, 0, 1, 0)),
                            o = 0; o < t.mainSoundTrack.soundCollection.length; o++) {
                                var y = t.mainSoundTrack.soundCollection[o];
                                y.useCustomAttenuation && y.updateDistanceFromListener()
                            }
                            if (t.soundTracks)
                                for (o = 0; o < t.soundTracks.length; o++)
                                    for (var l = 0; l < t.soundTracks[o].soundCollection.length; l++)
                                        (y = t.soundTracks[o].soundCollection[l]).useCustomAttenuation && y.updateDistanceFromListener()
                        }
                    }
                }
                ,
                t
            }();
            e.AudioSceneComponent = t
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t(t, r, i) {
                    var n = e.call(this, t, i) || this;
                    return n._sound = r,
                    n
                }
                return o(t, e),
                t.prototype._prepare = function() {}
                ,
                t.prototype.execute = function() {
                    void 0 !== this._sound && this._sound.play()
                }
                ,
                t.prototype.serialize = function(t) {
                    return e.prototype._serialize.call(this, {
                        name: "PlaySoundAction",
                        properties: [{
                            name: "sound",
                            value: this._sound.name
                        }]
                    }, t)
                }
                ,
                t
            }(e.Action);
            e.PlaySoundAction = t;
            var r = function(e) {
                function t(t, r, i) {
                    var n = e.call(this, t, i) || this;
                    return n._sound = r,
                    n
                }
                return o(t, e),
                t.prototype._prepare = function() {}
                ,
                t.prototype.execute = function() {
                    void 0 !== this._sound && this._sound.stop()
                }
                ,
                t.prototype.serialize = function(t) {
                    return e.prototype._serialize.call(this, {
                        name: "StopSoundAction",
                        properties: [{
                            name: "sound",
                            value: this._sound.name
                        }]
                    }, t)
                }
                ,
                t
            }(e.Action);
            e.StopSoundAction = r
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c, h, u, d, x) {
                    void 0 === n && (n = null),
                    void 0 === o && (o = !1),
                    void 0 === a && (a = null),
                    void 0 === s && (s = null),
                    void 0 === y && (y = null),
                    void 0 === l && (l = e.Engine.TEXTUREFORMAT_RGBA),
                    void 0 === c && (c = !1),
                    void 0 === h && (h = null),
                    void 0 === u && (u = !1),
                    void 0 === d && (d = .8),
                    void 0 === x && (x = 0);
                    var p = t.call(this, i) || this;
                    if (p.boundingBoxPosition = e.Vector3.Zero(),
                    p._rotationY = 0,
                    p._prefiltered = !1,
                    p.name = r,
                    p.url = r,
                    p._noMipmap = o,
                    p.hasAlpha = !1,
                    p._format = l,
                    p.isCube = !0,
                    p._textureMatrix = e.Matrix.Identity(),
                    p._createPolynomials = u,
                    p.coordinatesMode = e.Texture.CUBIC_MODE,
                    !r && !a)
                        return p;
                    var f = r.lastIndexOf(".")
                      , m = h || (f > -1 ? r.substring(f).toLowerCase() : "")
                      , z = ".dds" === m
                      , _ = ".env" === m;
                    if (_ ? (p.gammaSpace = !1,
                    p._prefiltered = !1) : (p._prefiltered = c,
                    c && (p.gammaSpace = !1)),
                    p._texture = p._getFromCache(r, o),
                    !a && (_ || z || n || (n = ["_px.jpg", "_py.jpg", "_pz.jpg", "_nx.jpg", "_ny.jpg", "_nz.jpg"]),
                    a = [],
                    n))
                        for (var g = 0; g < n.length; g++)
                            a.push(r + n[g]);
                    return p._files = a,
                    p._texture ? s && (p._texture.isReady ? e.Tools.SetImmediate((function() {
                        return s()
                    }
                    )) : p._texture.onLoadedObservable.add(s)) : i.useDelayedTextureLoading ? p.delayLoadState = e.Engine.DELAYLOADSTATE_NOTLOADED : p._texture = c ? i.getEngine().createPrefilteredCubeTexture(r, i, d, x, s, y, l, h, p._createPolynomials) : i.getEngine().createCubeTexture(r, i, a, o, s, y, p._format, h, !1, d, x),
                    p
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "boundingBoxSize", {
                    get: function() {
                        return this._boundingBoxSize
                    },
                    set: function(t) {
                        if (!this._boundingBoxSize || !this._boundingBoxSize.equals(t)) {
                            this._boundingBoxSize = t;
                            var r = this.getScene();
                            r && r.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag)
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "rotationY", {
                    get: function() {
                        return this._rotationY
                    },
                    set: function(t) {
                        this._rotationY = t,
                        this.setReflectionTextureMatrix(e.Matrix.RotationY(this._rotationY))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.CreateFromImages = function(e, t, i) {
                    var n = "";
                    return e.forEach((function(e) {
                        return n += e
                    }
                    )),
                    new r(n,t,null,i,e)
                }
                ,
                r.CreateFromPrefilteredData = function(e, t, i, n) {
                    return void 0 === i && (i = null),
                    void 0 === n && (n = !0),
                    new r(e,t,null,!1,null,null,null,void 0,!0,i,n)
                }
                ,
                r.prototype.delayLoad = function() {
                    if (this.delayLoadState === e.Engine.DELAYLOADSTATE_NOTLOADED) {
                        var t = this.getScene();
                        t && (this.delayLoadState = e.Engine.DELAYLOADSTATE_LOADED,
                        this._texture = this._getFromCache(this.url, this._noMipmap),
                        this._texture || (this._prefiltered ? this._texture = t.getEngine().createPrefilteredCubeTexture(this.url, t, this.lodGenerationScale, this.lodGenerationOffset, void 0, void 0, this._format, void 0, this._createPolynomials) : this._texture = t.getEngine().createCubeTexture(this.url, t, this._files, this._noMipmap, void 0, void 0, this._format)))
                    }
                }
                ,
                r.prototype.getReflectionTextureMatrix = function() {
                    return this._textureMatrix
                }
                ,
                r.prototype.setReflectionTextureMatrix = function(e) {
                    this._textureMatrix = e
                }
                ,
                r.Parse = function(t, i, n) {
                    var o = e.SerializationHelper.Parse((function() {
                        var e = !1;
                        return t.prefiltered && (e = t.prefiltered),
                        new r(n + t.name,i,t.extensions,!1,null,null,null,void 0,e)
                    }
                    ), t, i);
                    if (t.boundingBoxPosition && (o.boundingBoxPosition = e.Vector3.FromArray(t.boundingBoxPosition)),
                    t.boundingBoxSize && (o.boundingBoxSize = e.Vector3.FromArray(t.boundingBoxSize)),
                    t.animations)
                        for (var a = 0; a < t.animations.length; a++) {
                            var s = t.animations[a];
                            o.animations.push(e.Animation.Parse(s))
                        }
                    return o
                }
                ,
                r.prototype.clone = function() {
                    var t = this;
                    return e.SerializationHelper.Clone((function() {
                        var e = t.getScene();
                        return e ? new r(t.url,e,t._extensions,t._noMipmap,t._files) : t
                    }
                    ), this)
                }
                ,
                n([e.serialize("rotationY")], r.prototype, "rotationY", null),
                r
            }(e.BaseTexture);
            e.CubeTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c) {
                    void 0 === o && (o = e.Engine.TEXTUREFORMAT_RGBA),
                    void 0 === a && (a = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === s && (s = !1),
                    void 0 === y && (y = !1),
                    void 0 === l && (l = e.Texture.TRILINEAR_SAMPLINGMODE),
                    void 0 === c && (c = null);
                    var h = t.call(this, "", r) || this;
                    return h._texture = r.getEngine().createRawCubeTexture(i, n, o, a, s, y, l, c),
                    h
                }
                return o(r, t),
                r.prototype.update = function(e, t, r, i, n, o) {
                    void 0 === n && (n = null),
                    void 0 === o && (o = 0),
                    this._texture.getEngine().updateRawCubeTexture(this._texture, e, t, r, i, n)
                }
                ,
                r.prototype.updateRGBDAsync = function(e, t, i, n) {
                    return void 0 === t && (t = null),
                    void 0 === i && (i = .8),
                    void 0 === n && (n = 0),
                    r._UpdateRGBDAsync(this._texture, e, t, i, n)
                }
                ,
                r.prototype.clone = function() {
                    var t = this;
                    return e.SerializationHelper.Clone((function() {
                        var i = t.getScene()
                          , n = t._texture
                          , o = new r(i,n._bufferViewArray,n.width,n.format,n.type,n.generateMipMaps,n.invertY,n.samplingMode,n._compression);
                        return n.dataSource === e.InternalTexture.DATASOURCE_CUBERAW_RGBD && o.updateRGBDAsync(n._bufferViewArrayArray, n._sphericalPolynomial, n._lodGenerationScale, n._lodGenerationOffset),
                        o
                    }
                    ), this)
                }
                ,
                r._UpdateRGBDAsync = function(t, r, i, n, o) {
                    return t._dataSource = e.InternalTexture.DATASOURCE_CUBERAW_RGBD,
                    t._bufferViewArrayArray = r,
                    t._lodGenerationScale = n,
                    t._lodGenerationOffset = o,
                    t._sphericalPolynomial = i,
                    e.EnvironmentTextureTools.UploadLevelsAsync(t, r).then((function() {
                        t.isReady = !0
                    }
                    ))
                }
                ,
                r
            }(e.CubeTexture);
            e.RawCubeTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c, h, u, d) {
                    void 0 === a && (a = !0),
                    void 0 === s && (s = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === y && (y = !1),
                    void 0 === l && (l = e.Texture.TRILINEAR_SAMPLINGMODE),
                    void 0 === c && (c = !0),
                    void 0 === h && (h = !1),
                    void 0 === u && (u = !1),
                    void 0 === d && (d = e.Engine.TEXTUREFORMAT_RGBA);
                    var x = t.call(this, null, n, !o) || this;
                    return x.isCube = y,
                    x.renderParticles = !0,
                    x.renderSprites = !1,
                    x.coordinatesMode = e.Texture.PROJECTION_MODE,
                    x.ignoreCameraViewport = !1,
                    x.onBeforeBindObservable = new e.Observable,
                    x.onAfterUnbindObservable = new e.Observable,
                    x.onBeforeRenderObservable = new e.Observable,
                    x.onAfterRenderObservable = new e.Observable,
                    x.onClearObservable = new e.Observable,
                    x._currentRefreshId = -1,
                    x._refreshRate = 1,
                    x._samples = 1,
                    x.boundingBoxPosition = e.Vector3.Zero(),
                    (n = x.getScene()) ? (x.renderList = new Array,
                    x._engine = n.getEngine(),
                    x.name = r,
                    x.isRenderTarget = !0,
                    x._initialSizeParameter = i,
                    x._processSizeParameter(i),
                    x._resizeObserver = x.getScene().getEngine().onResizeObservable.add((function() {}
                    )),
                    x._generateMipMaps = !!o,
                    x._doNotChangeAspectRatio = a,
                    x._renderingManager = new e.RenderingManager(n),
                    x._renderingManager._useSceneAutoClearSetup = !0,
                    u ? x : (x._renderTargetOptions = {
                        generateMipMaps: o,
                        type: s,
                        format: d,
                        samplingMode: l,
                        generateDepthBuffer: c,
                        generateStencilBuffer: h
                    },
                    l === e.Texture.NEAREST_SAMPLINGMODE && (x.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    x.wrapV = e.Texture.CLAMP_ADDRESSMODE),
                    y ? (x._texture = n.getEngine().createRenderTargetCubeTexture(x.getRenderSize(), x._renderTargetOptions),
                    x.coordinatesMode = e.Texture.INVCUBIC_MODE,
                    x._textureMatrix = e.Matrix.Identity()) : x._texture = n.getEngine().createRenderTargetTexture(x._size, x._renderTargetOptions),
                    x)) : x
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "renderList", {
                    get: function() {
                        return this._renderList
                    },
                    set: function(e) {
                        this._renderList = e,
                        this._renderList && this._hookArray(this._renderList)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._hookArray = function(e) {
                    var t = this
                      , r = e.push;
                    e.push = function() {
                        for (var i = [], n = 0; n < arguments.length; n++)
                            i[n] = arguments[n];
                        var o = 0 === e.length
                          , a = r.apply(e, i);
                        return o && t.getScene().meshes.forEach((function(e) {
                            e._markSubMeshesAsLightDirty()
                        }
                        )),
                        a
                    }
                    ;
                    var i = e.splice;
                    e.splice = function(r, n) {
                        var o = i.apply(e, [r, n]);
                        return 0 === e.length && t.getScene().meshes.forEach((function(e) {
                            e._markSubMeshesAsLightDirty()
                        }
                        )),
                        o
                    }
                }
                ,
                Object.defineProperty(r.prototype, "onAfterUnbind", {
                    set: function(e) {
                        this._onAfterUnbindObserver && this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),
                        this._onAfterUnbindObserver = this.onAfterUnbindObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "onBeforeRender", {
                    set: function(e) {
                        this._onBeforeRenderObserver && this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),
                        this._onBeforeRenderObserver = this.onBeforeRenderObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "onAfterRender", {
                    set: function(e) {
                        this._onAfterRenderObserver && this.onAfterRenderObservable.remove(this._onAfterRenderObserver),
                        this._onAfterRenderObserver = this.onAfterRenderObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "onClear", {
                    set: function(e) {
                        this._onClearObserver && this.onClearObservable.remove(this._onClearObserver),
                        this._onClearObserver = this.onClearObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "renderTargetOptions", {
                    get: function() {
                        return this._renderTargetOptions
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._onRatioRescale = function() {
                    this._sizeRatio && this.resize(this._initialSizeParameter)
                }
                ,
                Object.defineProperty(r.prototype, "boundingBoxSize", {
                    get: function() {
                        return this._boundingBoxSize
                    },
                    set: function(t) {
                        if (!this._boundingBoxSize || !this._boundingBoxSize.equals(t)) {
                            this._boundingBoxSize = t;
                            var r = this.getScene();
                            r && r.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag)
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.createDepthStencilTexture = function(e, t, r) {
                    if (void 0 === e && (e = 0),
                    void 0 === t && (t = !0),
                    void 0 === r && (r = !1),
                    this.getScene()) {
                        var i = this.getScene().getEngine();
                        this.depthStencilTexture = i.createDepthStencilTexture(this._size, {
                            bilinearFiltering: t,
                            comparisonFunction: e,
                            generateStencil: r,
                            isCube: this.isCube
                        }),
                        i.setFrameBufferDepthStencilTexture(this)
                    }
                }
                ,
                r.prototype._processSizeParameter = function(e) {
                    e.ratio ? (this._sizeRatio = e.ratio,
                    this._size = {
                        width: this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(), this._sizeRatio),
                        height: this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(), this._sizeRatio)
                    }) : this._size = e
                }
                ,
                Object.defineProperty(r.prototype, "samples", {
                    get: function() {
                        return this._samples
                    },
                    set: function(e) {
                        if (this._samples !== e) {
                            var t = this.getScene();
                            t && (this._samples = t.getEngine().updateRenderTargetTextureSampleCount(this._texture, e))
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.resetRefreshCounter = function() {
                    this._currentRefreshId = -1
                }
                ,
                Object.defineProperty(r.prototype, "refreshRate", {
                    get: function() {
                        return this._refreshRate
                    },
                    set: function(e) {
                        this._refreshRate = e,
                        this.resetRefreshCounter()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.addPostProcess = function(t) {
                    if (!this._postProcessManager) {
                        var r = this.getScene();
                        if (!r)
                            return;
                        this._postProcessManager = new e.PostProcessManager(r),
                        this._postProcesses = new Array
                    }
                    this._postProcesses.push(t),
                    this._postProcesses[0].autoClear = !1
                }
                ,
                r.prototype.clearPostProcesses = function(e) {
                    if (void 0 === e && (e = !1),
                    this._postProcesses) {
                        if (e)
                            for (var t = 0, r = this._postProcesses; t < r.length; t++) {
                                r[t].dispose()
                            }
                        this._postProcesses = []
                    }
                }
                ,
                r.prototype.removePostProcess = function(e) {
                    if (this._postProcesses) {
                        var t = this._postProcesses.indexOf(e);
                        -1 !== t && (this._postProcesses.splice(t, 1),
                        this._postProcesses.length > 0 && (this._postProcesses[0].autoClear = !1))
                    }
                }
                ,
                r.prototype._shouldRender = function() {
                    return -1 === this._currentRefreshId ? (this._currentRefreshId = 1,
                    !0) : this.refreshRate === this._currentRefreshId ? (this._currentRefreshId = 1,
                    !0) : (this._currentRefreshId++,
                    !1)
                }
                ,
                r.prototype.getRenderSize = function() {
                    return this.getRenderWidth()
                }
                ,
                r.prototype.getRenderWidth = function() {
                    return this._size.width ? this._size.width : this._size
                }
                ,
                r.prototype.getRenderHeight = function() {
                    return this._size.width ? this._size.height : this._size
                }
                ,
                Object.defineProperty(r.prototype, "canRescale", {
                    get: function() {
                        return !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.scale = function(e) {
                    var t = this.getRenderSize() * e;
                    this.resize(t)
                }
                ,
                r.prototype.getReflectionTextureMatrix = function() {
                    return this.isCube ? this._textureMatrix : t.prototype.getReflectionTextureMatrix.call(this)
                }
                ,
                r.prototype.resize = function(e) {
                    this.releaseInternalTexture();
                    var t = this.getScene();
                    t && (this._processSizeParameter(e),
                    this.isCube ? this._texture = t.getEngine().createRenderTargetCubeTexture(this.getRenderSize(), this._renderTargetOptions) : this._texture = t.getEngine().createRenderTargetTexture(this._size, this._renderTargetOptions))
                }
                ,
                r.prototype.render = function(e, t) {
                    if (void 0 === e && (e = !1),
                    void 0 === t && (t = !1),
                    s = this.getScene()) {
                        var r, i = s.getEngine();
                        if (void 0 !== this.useCameraPostProcesses && (e = this.useCameraPostProcesses),
                        this._waitingRenderList) {
                            this.renderList = [];
                            for (var n = 0; n < this._waitingRenderList.length; n++) {
                                var o = this._waitingRenderList[n]
                                  , a = s.getMeshByID(o);
                                a && this.renderList.push(a)
                            }
                            delete this._waitingRenderList
                        }
                        if (this.renderListPredicate) {
                            var s;
                            if (this.renderList ? this.renderList.splice(0) : this.renderList = [],
                            !(s = this.getScene()))
                                return;
                            var y = s.meshes;
                            for (n = 0; n < y.length; n++) {
                                var l = y[n];
                                this.renderListPredicate(l) && this.renderList.push(l)
                            }
                        }
                        this.onBeforeBindObservable.notifyObservers(this),
                        this.activeCamera ? (r = this.activeCamera,
                        i.setViewport(this.activeCamera.viewport, this.getRenderWidth(), this.getRenderHeight()),
                        this.activeCamera !== s.activeCamera && s.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix(!0))) : (r = s.activeCamera) && i.setViewport(r.viewport, this.getRenderWidth(), this.getRenderHeight()),
                        this._renderingManager.reset();
                        for (var c = this.renderList ? this.renderList : s.getActiveMeshes().data, h = this.renderList ? this.renderList.length : s.getActiveMeshes().length, u = s.getRenderId(), d = 0; d < h; d++) {
                            if (l = c[d]) {
                                if (!l.isReady(0 === this.refreshRate)) {
                                    this.resetRefreshCounter();
                                    continue
                                }
                                l._preActivateForIntermediateRendering(u);
                                var x = void 0;
                                if (x = !(this.renderList || !r) && 0 == (l.layerMask & r.layerMask),
                                l.isEnabled() && l.isVisible && l.subMeshes && !x) {
                                    l._activate(u);
                                    for (var p = 0; p < l.subMeshes.length; p++) {
                                        var f = l.subMeshes[p];
                                        s._activeIndices.addCount(f.indexCount, !1),
                                        this._renderingManager.dispatch(f, l)
                                    }
                                }
                            }
                        }
                        for (var m = 0; m < s.particleSystems.length; m++) {
                            var z = s.particleSystems[m]
                              , _ = z.emitter;
                            z.isStarted() && _ && _.position && _.isEnabled() && (c.indexOf(_) >= 0 && this._renderingManager.dispatchParticles(z))
                        }
                        if (this.isCube)
                            for (var g = 0; g < 6; g++)
                                this.renderToTarget(g, c, h, e, t),
                                s.incrementRenderId(),
                                s.resetCachedMaterial();
                        else
                            this.renderToTarget(0, c, h, e, t);
                        this.onAfterUnbindObservable.notifyObservers(this),
                        s.activeCamera && (this.activeCamera && this.activeCamera !== s.activeCamera && s.setTransformMatrix(s.activeCamera.getViewMatrix(), s.activeCamera.getProjectionMatrix(!0)),
                        i.setViewport(s.activeCamera.viewport)),
                        s.resetCachedMaterial()
                    }
                }
                ,
                r.prototype._bestReflectionRenderTargetDimension = function(t, r) {
                    var i = t * r
                      , n = e.Tools.NearestPOT(i + 16384 / (128 + i));
                    return Math.min(e.Tools.FloorPOT(t), n)
                }
                ,
                r.prototype.unbindFrameBuffer = function(e, t) {
                    var r = this;
                    this._texture && e.unBindFramebuffer(this._texture, this.isCube, (function() {
                        r.onAfterRenderObservable.notifyObservers(t)
                    }
                    ))
                }
                ,
                r.prototype.renderToTarget = function(t, r, i, n, o) {
                    var a = this.getScene();
                    if (a) {
                        var s = a.getEngine();
                        this._texture && (this._postProcessManager ? this._postProcessManager._prepareFrame(this._texture, this._postProcesses) : n && a.postProcessManager._prepareFrame(this._texture) || this._texture && s.bindFramebuffer(this._texture, this.isCube ? t : void 0, void 0, void 0, this.ignoreCameraViewport, this.depthStencilTexture ? this.depthStencilTexture : void 0),
                        this.onBeforeRenderObservable.notifyObservers(t),
                        this.onClearObservable.hasObservers() ? this.onClearObservable.notifyObservers(s) : s.clear(this.clearColor || a.clearColor, !0, !0, !0),
                        this._doNotChangeAspectRatio || a.updateTransformMatrix(!0),
                        this._renderingManager.render(this.customRenderFunction, r, this.renderParticles, this.renderSprites),
                        this._postProcessManager ? this._postProcessManager._finalizeFrame(!1, this._texture, t, this._postProcesses, this.ignoreCameraViewport) : n && a.postProcessManager._finalizeFrame(!1, this._texture, t),
                        this._doNotChangeAspectRatio || a.updateTransformMatrix(!0),
                        o && e.Tools.DumpFramebuffer(this.getRenderWidth(), this.getRenderHeight(), s),
                        this.isCube && 5 !== t ? this.onAfterRenderObservable.notifyObservers(t) : (this.isCube && 5 === t && s.generateMipMapsForCubemap(this._texture),
                        this.unbindFrameBuffer(s, t)))
                    }
                }
                ,
                r.prototype.setRenderingOrder = function(e, t, r, i) {
                    void 0 === t && (t = null),
                    void 0 === r && (r = null),
                    void 0 === i && (i = null),
                    this._renderingManager.setRenderingOrder(e, t, r, i)
                }
                ,
                r.prototype.setRenderingAutoClearDepthStencil = function(e, t) {
                    this._renderingManager.setRenderingAutoClearDepthStencil(e, t),
                    this._renderingManager._useSceneAutoClearSetup = !1
                }
                ,
                r.prototype.clone = function() {
                    var e = this.getSize()
                      , t = new r(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);
                    return t.hasAlpha = this.hasAlpha,
                    t.level = this.level,
                    t.coordinatesMode = this.coordinatesMode,
                    this.renderList && (t.renderList = this.renderList.slice(0)),
                    t
                }
                ,
                r.prototype.serialize = function() {
                    if (!this.name)
                        return null;
                    var e = t.prototype.serialize.call(this);
                    if (e.renderTargetSize = this.getRenderSize(),
                    e.renderList = [],
                    this.renderList)
                        for (var r = 0; r < this.renderList.length; r++)
                            e.renderList.push(this.renderList[r].id);
                    return e
                }
                ,
                r.prototype.disposeFramebufferObjects = function() {
                    var e = this.getInternalTexture()
                      , t = this.getScene();
                    e && t && t.getEngine()._releaseFramebufferObjects(e)
                }
                ,
                r.prototype.dispose = function() {
                    this._postProcessManager && (this._postProcessManager.dispose(),
                    this._postProcessManager = null),
                    this.clearPostProcesses(!0),
                    this._resizeObserver && (this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),
                    this._resizeObserver = null),
                    this.renderList = null;
                    var e = this.getScene();
                    if (e) {
                        var r = e.customRenderTargets.indexOf(this);
                        r >= 0 && e.customRenderTargets.splice(r, 1);
                        for (var i = 0, n = e.cameras; i < n.length; i++) {
                            var o = n[i];
                            (r = o.customRenderTargets.indexOf(this)) >= 0 && o.customRenderTargets.splice(r, 1)
                        }
                        t.prototype.dispose.call(this)
                    }
                }
                ,
                r.prototype._rebuild = function() {
                    this.refreshRate === r.REFRESHRATE_RENDER_ONCE && (this.refreshRate = r.REFRESHRATE_RENDER_ONCE),
                    this._postProcessManager && this._postProcessManager._rebuild()
                }
                ,
                r.prototype.freeRenderingGroups = function() {
                    this._renderingManager && this._renderingManager.freeRenderingGroups()
                }
                ,
                r.REFRESHRATE_RENDER_ONCE = 0,
                r.REFRESHRATE_RENDER_ONEVERYFRAME = 1,
                r.REFRESHRATE_RENDER_ONEVERYTWOFRAMES = 2,
                r
            }(e.Texture);
            e.RenderTargetTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a) {
                    var s = this
                      , y = !(!a || !a.generateMipMaps) && a.generateMipMaps
                      , l = !(!a || !a.generateDepthTexture) && a.generateDepthTexture
                      , c = !a || void 0 === a.doNotChangeAspectRatio || a.doNotChangeAspectRatio;
                    if ((s = t.call(this, r, i, o, y, c) || this)._engine = o.getEngine(),
                    s.isSupported) {
                        for (var h = [], u = [], d = 0; d < n; d++)
                            a && a.types && void 0 !== a.types[d] ? h.push(a.types[d]) : h.push(a && a.defaultType ? a.defaultType : e.Engine.TEXTURETYPE_UNSIGNED_INT),
                            a && a.samplingModes && void 0 !== a.samplingModes[d] ? u.push(a.samplingModes[d]) : u.push(e.Texture.BILINEAR_SAMPLINGMODE);
                        var x = !a || void 0 === a.generateDepthBuffer || a.generateDepthBuffer
                          , p = !(!a || void 0 === a.generateStencilBuffer) && a.generateStencilBuffer;
                        return s._size = i,
                        s._multiRenderTargetOptions = {
                            samplingModes: u,
                            generateMipMaps: y,
                            generateDepthBuffer: x,
                            generateStencilBuffer: p,
                            generateDepthTexture: l,
                            types: h,
                            textureCount: n
                        },
                        s._createInternalTextures(),
                        s._createTextures(),
                        s
                    }
                    s.dispose()
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "isSupported", {
                    get: function() {
                        return this._engine.webGLVersion > 1 || this._engine.getCaps().drawBuffersExtension
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "textures", {
                    get: function() {
                        return this._textures
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "depthTexture", {
                    get: function() {
                        return this._textures[this._textures.length - 1]
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "wrapU", {
                    set: function(e) {
                        if (this._textures)
                            for (var t = 0; t < this._textures.length; t++)
                                this._textures[t].wrapU = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "wrapV", {
                    set: function(e) {
                        if (this._textures)
                            for (var t = 0; t < this._textures.length; t++)
                                this._textures[t].wrapV = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._rebuild = function() {
                    this.releaseInternalTextures(),
                    this._createInternalTextures();
                    for (var e = 0; e < this._internalTextures.length; e++) {
                        this._textures[e]._texture = this._internalTextures[e]
                    }
                    this._texture = this._internalTextures[0]
                }
                ,
                r.prototype._createInternalTextures = function() {
                    this._internalTextures = this._engine.createMultipleRenderTarget(this._size, this._multiRenderTargetOptions)
                }
                ,
                r.prototype._createTextures = function() {
                    this._textures = [];
                    for (var t = 0; t < this._internalTextures.length; t++) {
                        var r = new e.Texture(null,this.getScene());
                        r._texture = this._internalTextures[t],
                        this._textures.push(r)
                    }
                    this._texture = this._internalTextures[0]
                }
                ,
                Object.defineProperty(r.prototype, "samples", {
                    get: function() {
                        return this._samples
                    },
                    set: function(e) {
                        this._samples !== e && (this._samples = this._engine.updateMultipleRenderTargetTextureSampleCount(this._internalTextures, e))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.resize = function(e) {
                    this.releaseInternalTextures(),
                    this._internalTextures = this._engine.createMultipleRenderTarget(e, this._multiRenderTargetOptions),
                    this._createInternalTextures()
                }
                ,
                r.prototype.unbindFrameBuffer = function(e, t) {
                    var r = this;
                    e.unBindMultiColorAttachmentFramebuffer(this._internalTextures, this.isCube, (function() {
                        r.onAfterRenderObservable.notifyObservers(t)
                    }
                    ))
                }
                ,
                r.prototype.dispose = function() {
                    this.releaseInternalTextures(),
                    t.prototype.dispose.call(this)
                }
                ,
                r.prototype.releaseInternalTextures = function() {
                    if (this._internalTextures)
                        for (var e = this._internalTextures.length - 1; e >= 0; e--)
                            void 0 !== this._internalTextures[e] && (this._internalTextures[e].dispose(),
                            this._internalTextures.splice(e, 1))
                }
                ,
                r
            }(e.RenderTargetTexture);
            e.MultiRenderTarget = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y) {
                    void 0 === a && (a = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === s && (s = e.Texture.BILINEAR_SAMPLINGMODE),
                    void 0 === y && (y = !0);
                    var l = t.call(this, r, i, n, o, !0, a, !1, s, y) || this;
                    return l.scene = n,
                    l.mirrorPlane = new e.Plane(0,1,0,1),
                    l._transformMatrix = e.Matrix.Zero(),
                    l._mirrorMatrix = e.Matrix.Zero(),
                    l._adaptiveBlurKernel = 0,
                    l._blurKernelX = 0,
                    l._blurKernelY = 0,
                    l._blurRatio = 1,
                    l.ignoreCameraViewport = !0,
                    l._updateGammaSpace(),
                    l._imageProcessingConfigChangeObserver = n.imageProcessingConfiguration.onUpdateParameters.add((function() {
                        l._updateGammaSpace
                    }
                    )),
                    l.onBeforeRenderObservable.add((function() {
                        e.Matrix.ReflectionToRef(l.mirrorPlane, l._mirrorMatrix),
                        l._savedViewMatrix = n.getViewMatrix(),
                        l._mirrorMatrix.multiplyToRef(l._savedViewMatrix, l._transformMatrix),
                        n.setTransformMatrix(l._transformMatrix, n.getProjectionMatrix()),
                        n.clipPlane = l.mirrorPlane,
                        n.getEngine().cullBackFaces = !1,
                        n._mirroredCameraPosition = e.Vector3.TransformCoordinates(n.activeCamera.globalPosition, l._mirrorMatrix)
                    }
                    )),
                    l.onAfterRenderObservable.add((function() {
                        n.setTransformMatrix(l._savedViewMatrix, n.getProjectionMatrix()),
                        n.getEngine().cullBackFaces = !0,
                        n._mirroredCameraPosition = null,
                        delete n.clipPlane
                    }
                    )),
                    l
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "blurRatio", {
                    get: function() {
                        return this._blurRatio
                    },
                    set: function(e) {
                        this._blurRatio !== e && (this._blurRatio = e,
                        this._preparePostProcesses())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "adaptiveBlurKernel", {
                    set: function(e) {
                        this._adaptiveBlurKernel = e,
                        this._autoComputeBlurKernel()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "blurKernel", {
                    set: function(e) {
                        this.blurKernelX = e,
                        this.blurKernelY = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "blurKernelX", {
                    get: function() {
                        return this._blurKernelX
                    },
                    set: function(e) {
                        this._blurKernelX !== e && (this._blurKernelX = e,
                        this._preparePostProcesses())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "blurKernelY", {
                    get: function() {
                        return this._blurKernelY
                    },
                    set: function(e) {
                        this._blurKernelY !== e && (this._blurKernelY = e,
                        this._preparePostProcesses())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._autoComputeBlurKernel = function() {
                    var e = this.getScene().getEngine()
                      , t = this.getRenderWidth() / e.getRenderWidth()
                      , r = this.getRenderHeight() / e.getRenderHeight();
                    this.blurKernelX = this._adaptiveBlurKernel * t,
                    this.blurKernelY = this._adaptiveBlurKernel * r
                }
                ,
                r.prototype._onRatioRescale = function() {
                    this._sizeRatio && (this.resize(this._initialSizeParameter),
                    this._adaptiveBlurKernel || this._preparePostProcesses()),
                    this._adaptiveBlurKernel && this._autoComputeBlurKernel()
                }
                ,
                r.prototype._updateGammaSpace = function() {
                    this.gammaSpace = !this.scene.imageProcessingConfiguration.isEnabled || !this.scene.imageProcessingConfiguration.applyByPostProcess
                }
                ,
                r.prototype._preparePostProcesses = function() {
                    if (this.clearPostProcesses(!0),
                    this._blurKernelX && this._blurKernelY) {
                        var t = this.getScene().getEngine()
                          , r = t.getCaps().textureFloatRender ? e.Engine.TEXTURETYPE_FLOAT : e.Engine.TEXTURETYPE_HALF_FLOAT;
                        this._blurX = new e.BlurPostProcess("horizontal blur",new e.Vector2(1,0),this._blurKernelX,this._blurRatio,null,e.Texture.BILINEAR_SAMPLINGMODE,t,!1,r),
                        this._blurX.autoClear = !1,
                        1 === this._blurRatio && this.samples < 2 && this._texture ? this._blurX.inputTexture = this._texture : this._blurX.alwaysForcePOT = !0,
                        this._blurY = new e.BlurPostProcess("vertical blur",new e.Vector2(0,1),this._blurKernelY,this._blurRatio,null,e.Texture.BILINEAR_SAMPLINGMODE,t,!1,r),
                        this._blurY.autoClear = !1,
                        this._blurY.alwaysForcePOT = 1 !== this._blurRatio,
                        this.addPostProcess(this._blurX),
                        this.addPostProcess(this._blurY)
                    } else
                        this._blurY && (this.removePostProcess(this._blurY),
                        this._blurY.dispose(),
                        this._blurY = null),
                        this._blurX && (this.removePostProcess(this._blurX),
                        this._blurX.dispose(),
                        this._blurX = null)
                }
                ,
                r.prototype.clone = function() {
                    var e = this.getScene();
                    if (!e)
                        return this;
                    var t = this.getSize()
                      , i = new r(this.name,t.width,e,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);
                    return i.hasAlpha = this.hasAlpha,
                    i.level = this.level,
                    i.mirrorPlane = this.mirrorPlane.clone(),
                    this.renderList && (i.renderList = this.renderList.slice(0)),
                    i
                }
                ,
                r.prototype.serialize = function() {
                    if (!this.name)
                        return null;
                    var e = t.prototype.serialize.call(this);
                    return e.mirrorPlane = this.mirrorPlane.asArray(),
                    e
                }
                ,
                r.prototype.dispose = function() {
                    t.prototype.dispose.call(this),
                    this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver)
                }
                ,
                r
            }(e.RenderTargetTexture);
            e.MirrorTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o) {
                    var a = t.call(this, r, i, n, o, !0) || this;
                    return a.refractionPlane = new e.Plane(0,1,0,1),
                    a.depth = 2,
                    a.onBeforeRenderObservable.add((function() {
                        n.clipPlane = a.refractionPlane
                    }
                    )),
                    a.onAfterRenderObservable.add((function() {
                        delete n.clipPlane
                    }
                    )),
                    a
                }
                return o(r, t),
                r.prototype.clone = function() {
                    var e = this.getScene();
                    if (!e)
                        return this;
                    var t = this.getSize()
                      , i = new r(this.name,t.width,e,this._generateMipMaps);
                    return i.hasAlpha = this.hasAlpha,
                    i.level = this.level,
                    i.refractionPlane = this.refractionPlane.clone(),
                    this.renderList && (i.renderList = this.renderList.slice(0)),
                    i.depth = this.depth,
                    i
                }
                ,
                r.prototype.serialize = function() {
                    if (!this.name)
                        return null;
                    var e = t.prototype.serialize.call(this);
                    return e.mirrorPlane = this.refractionPlane.asArray(),
                    e.depth = this.depth,
                    e
                }
                ,
                r
            }(e.RenderTargetTexture);
            e.RefractionTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s) {
                    void 0 === n && (n = null),
                    void 0 === a && (a = e.Texture.TRILINEAR_SAMPLINGMODE),
                    void 0 === s && (s = e.Engine.TEXTUREFORMAT_RGBA);
                    var y = t.call(this, null, n, !o, void 0, a, void 0, void 0, void 0, void 0, s) || this;
                    y.name = r,
                    y._engine = y.getScene().getEngine(),
                    y.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    y.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    y._generateMipMaps = o,
                    i.getContext ? (y._canvas = i,
                    y._texture = y._engine.createDynamicTexture(i.width, i.height, o, a)) : (y._canvas = document.createElement("canvas"),
                    i.width || 0 === i.width ? y._texture = y._engine.createDynamicTexture(i.width, i.height, o, a) : y._texture = y._engine.createDynamicTexture(i, i, o, a));
                    var l = y.getSize();
                    return y._canvas.width = l.width,
                    y._canvas.height = l.height,
                    y._context = y._canvas.getContext("2d"),
                    y
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "canRescale", {
                    get: function() {
                        return !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._recreate = function(e) {
                    this._canvas.width = e.width,
                    this._canvas.height = e.height,
                    this.releaseInternalTexture(),
                    this._texture = this._engine.createDynamicTexture(e.width, e.height, this._generateMipMaps, this._samplingMode)
                }
                ,
                r.prototype.scale = function(e) {
                    var t = this.getSize();
                    t.width *= e,
                    t.height *= e,
                    this._recreate(t)
                }
                ,
                r.prototype.scaleTo = function(e, t) {
                    var r = this.getSize();
                    r.width = e,
                    r.height = t,
                    this._recreate(r)
                }
                ,
                r.prototype.getContext = function() {
                    return this._context
                }
                ,
                r.prototype.clear = function() {
                    var e = this.getSize();
                    this._context.fillRect(0, 0, e.width, e.height)
                }
                ,
                r.prototype.update = function(e, t) {
                    void 0 === t && (t = !1),
                    this._engine.updateDynamicTexture(this._texture, this._canvas, void 0 === e || e, t, this._format || void 0)
                }
                ,
                r.prototype.drawText = function(e, t, r, i, n, o, a, s) {
                    void 0 === s && (s = !0);
                    var y = this.getSize();
                    if (o && (this._context.fillStyle = o,
                    this._context.fillRect(0, 0, y.width, y.height)),
                    this._context.font = i,
                    null == t) {
                        var l = this._context.measureText(e);
                        t = (y.width - l.width) / 2
                    }
                    if (null == r) {
                        var c = parseInt(i.replace(/\D/g, ""));
                        r = y.height / 2 + c / 3.65
                    }
                    this._context.fillStyle = n,
                    this._context.fillText(e, t, r),
                    s && this.update(a)
                }
                ,
                r.prototype.clone = function() {
                    var e = this.getScene();
                    if (!e)
                        return this;
                    var t = this.getSize()
                      , i = new r(this.name,t,e,this._generateMipMaps);
                    return i.hasAlpha = this.hasAlpha,
                    i.level = this.level,
                    i.wrapU = this.wrapU,
                    i.wrapV = this.wrapV,
                    i
                }
                ,
                r.prototype.serialize = function() {
                    var r = this.getScene();
                    r && !r.isReady() && e.Tools.Warn("The scene must be ready before serializing the dynamic texture");
                    var i = t.prototype.serialize.call(this);
                    return i.base64String = this._canvas.toDataURL(),
                    i.invertY = this._invertY,
                    i.samplingMode = this.samplingMode,
                    i
                }
                ,
                r.prototype._rebuild = function() {
                    this.update()
                }
                ,
                r
            }(e.Texture);
            e.DynamicTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y) {
                    void 0 === o && (o = !1),
                    void 0 === a && (a = !1),
                    void 0 === s && (s = e.Texture.TRILINEAR_SAMPLINGMODE),
                    void 0 === y && (y = {
                        autoPlay: !0,
                        loop: !0,
                        autoUpdateTexture: !0
                    });
                    var l = t.call(this, null, n, !o, a) || this;
                    return l._onUserActionRequestedObservable = null,
                    l._stillImageCaptured = !1,
                    l._poster = !1,
                    l._createInternalTexture = function() {
                        if (null != l._texture) {
                            if (!l._poster)
                                return;
                            l._texture.dispose(),
                            l._poster = !1
                        }
                        if (!l._engine.needPOTTextures || e.Tools.IsExponentOfTwo(l.video.videoWidth) && e.Tools.IsExponentOfTwo(l.video.videoHeight) ? (l.wrapU = e.Texture.WRAP_ADDRESSMODE,
                        l.wrapV = e.Texture.WRAP_ADDRESSMODE) : (l.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                        l.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                        l._generateMipMaps = !1),
                        l._texture = l._engine.createDynamicTexture(l.video.videoWidth, l.video.videoHeight, l._generateMipMaps, l._samplingMode),
                        l.video.autoplay)
                            l._texture.isReady = !0,
                            l._updateInternalTexture(),
                            l.onLoadObservable.hasObservers() && l.onLoadObservable.notifyObservers(l);
                        else {
                            var t = l.video.onplaying
                              , r = !1;
                            l.video.onplaying = function() {
                                l.video.onplaying = t,
                                l._texture.isReady = !0,
                                l._updateInternalTexture(),
                                r || l.video.pause(),
                                l.onLoadObservable.hasObservers() && l.onLoadObservable.notifyObservers(l)
                            }
                            ;
                            var i = l.video.play();
                            i ? i.then((function() {}
                            )).catch((function() {
                                r = !0,
                                l._onUserActionRequestedObservable && l._onUserActionRequestedObservable.hasObservers() && l._onUserActionRequestedObservable.notifyObservers(l)
                            }
                            )) : (l.video.onplaying = t,
                            l._texture.isReady = !0,
                            l._updateInternalTexture(),
                            l.onLoadObservable.hasObservers() && l.onLoadObservable.notifyObservers(l))
                        }
                    }
                    ,
                    l.reset = function() {
                        null != l._texture && (l._poster || (l._texture.dispose(),
                        l._texture = null))
                    }
                    ,
                    l._updateInternalTexture = function(e) {
                        null != l._texture && l._texture.isReady && (l.video.readyState < l.video.HAVE_CURRENT_DATA || l._engine.updateVideoTexture(l._texture, l.video, l._invertY))
                    }
                    ,
                    l._engine = l.getScene().getEngine(),
                    l._generateMipMaps = o,
                    l._samplingMode = s,
                    l.autoUpdateTexture = y.autoUpdateTexture,
                    l.name = r || l._getName(i),
                    l.video = l._getVideo(i),
                    y.poster && (l.video.poster = y.poster),
                    void 0 !== y.autoPlay && (l.video.autoplay = y.autoPlay),
                    void 0 !== y.loop && (l.video.loop = y.loop),
                    l.video.setAttribute("playsinline", ""),
                    l.video.addEventListener("canplay", l._createInternalTexture),
                    l.video.addEventListener("paused", l._updateInternalTexture),
                    l.video.addEventListener("seeked", l._updateInternalTexture),
                    l.video.addEventListener("emptied", l.reset),
                    l.video.readyState >= l.video.HAVE_CURRENT_DATA && l._createInternalTexture(),
                    y.poster && (l._texture = l._engine.createTexture(y.poster, !1, !0, n),
                    l._poster = !0),
                    l
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "onUserActionRequestedObservable", {
                    get: function() {
                        return this._onUserActionRequestedObservable || (this._onUserActionRequestedObservable = new e.Observable),
                        this._onUserActionRequestedObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._getName = function(e) {
                    return e instanceof HTMLVideoElement ? e.currentSrc : "object" == typeof e ? e.toString() : e
                }
                ,
                r.prototype._getVideo = function(t) {
                    if (t instanceof HTMLVideoElement)
                        return e.Tools.SetCorsBehavior(t.currentSrc, t),
                        t;
                    var r = document.createElement("video");
                    return "string" == typeof t ? (e.Tools.SetCorsBehavior(t, r),
                    r.src = t) : (e.Tools.SetCorsBehavior(t[0], r),
                    t.forEach((function(e) {
                        var t = document.createElement("source");
                        t.src = e,
                        r.appendChild(t)
                    }
                    ))),
                    r
                }
                ,
                r.prototype._rebuild = function() {
                    this.update()
                }
                ,
                r.prototype.update = function() {
                    this.autoUpdateTexture && this.updateTexture(!0)
                }
                ,
                r.prototype.updateTexture = function(e) {
                    e && (this.video.paused && this._stillImageCaptured || (this._stillImageCaptured = !0,
                    this._updateInternalTexture()))
                }
                ,
                r.prototype.updateURL = function(e) {
                    this.video.src = e
                }
                ,
                r.prototype.dispose = function() {
                    t.prototype.dispose.call(this),
                    this._onUserActionRequestedObservable && (this._onUserActionRequestedObservable.clear(),
                    this._onUserActionRequestedObservable = null),
                    this.video.removeEventListener("canplay", this._createInternalTexture),
                    this.video.removeEventListener("paused", this._updateInternalTexture),
                    this.video.removeEventListener("seeked", this._updateInternalTexture),
                    this.video.removeEventListener("emptied", this.reset),
                    this.video.pause()
                }
                ,
                r.CreateFromWebCam = function(t, i, n) {
                    var o, a = document.createElement("video");
                    a.setAttribute("autoplay", ""),
                    a.setAttribute("muted", ""),
                    a.setAttribute("playsinline", ""),
                    n && n.deviceId && (o = {
                        exact: n.deviceId
                    }),
                    window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL,
                    navigator.mediaDevices ? navigator.mediaDevices.getUserMedia({
                        video: n
                    }).then((function(e) {
                        void 0 !== a.mozSrcObject ? a.mozSrcObject = e : a.srcObject = e;
                        var n = function() {
                            i && i(new r("video",a,t,!0,!0)),
                            a.removeEventListener("playing", n)
                        };
                        a.addEventListener("playing", n),
                        a.play()
                    }
                    )).catch((function(t) {
                        e.Tools.Error(t.name)
                    }
                    )) : (navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia,
                    navigator.getUserMedia && navigator.getUserMedia({
                        video: {
                            deviceId: o,
                            width: {
                                min: n && n.minWidth || 256,
                                max: n && n.maxWidth || 640
                            },
                            height: {
                                min: n && n.minHeight || 256,
                                max: n && n.maxHeight || 480
                            }
                        }
                    }, (function(e) {
                        void 0 !== a.mozSrcObject ? a.mozSrcObject = e : a.src = window.URL && window.URL.createObjectURL(e) || e,
                        a.play(),
                        i && i(new r("video",a,t,!0,!0))
                    }
                    ), (function(t) {
                        e.Tools.Error(t.name)
                    }
                    )))
                }
                ,
                r
            }(e.Texture);
            e.VideoTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c) {
                    void 0 === s && (s = !0),
                    void 0 === y && (y = !1),
                    void 0 === l && (l = e.Texture.TRILINEAR_SAMPLINGMODE),
                    void 0 === c && (c = e.Engine.TEXTURETYPE_UNSIGNED_INT);
                    var h = t.call(this, null, a, !s, y) || this;
                    return h.format = o,
                    h._engine = a.getEngine(),
                    h._texture = a.getEngine().createRawTexture(r, i, n, o, s, y, l, null, c),
                    h.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    h.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    h
                }
                return o(r, t),
                r.prototype.update = function(e) {
                    this._engine.updateRawTexture(this._texture, e, this._texture.format, this._texture.invertY, void 0, this._texture.type)
                }
                ,
                r.CreateLuminanceTexture = function(t, i, n, o, a, s, y) {
                    return void 0 === a && (a = !0),
                    void 0 === s && (s = !1),
                    void 0 === y && (y = e.Texture.TRILINEAR_SAMPLINGMODE),
                    new r(t,i,n,e.Engine.TEXTUREFORMAT_LUMINANCE,o,a,s,y)
                }
                ,
                r.CreateLuminanceAlphaTexture = function(t, i, n, o, a, s, y) {
                    return void 0 === a && (a = !0),
                    void 0 === s && (s = !1),
                    void 0 === y && (y = e.Texture.TRILINEAR_SAMPLINGMODE),
                    new r(t,i,n,e.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,o,a,s,y)
                }
                ,
                r.CreateAlphaTexture = function(t, i, n, o, a, s, y) {
                    return void 0 === a && (a = !0),
                    void 0 === s && (s = !1),
                    void 0 === y && (y = e.Texture.TRILINEAR_SAMPLINGMODE),
                    new r(t,i,n,e.Engine.TEXTUREFORMAT_ALPHA,o,a,s,y)
                }
                ,
                r.CreateRGBTexture = function(t, i, n, o, a, s, y, l) {
                    return void 0 === a && (a = !0),
                    void 0 === s && (s = !1),
                    void 0 === y && (y = e.Texture.TRILINEAR_SAMPLINGMODE),
                    void 0 === l && (l = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    new r(t,i,n,e.Engine.TEXTUREFORMAT_RGB,o,a,s,y,l)
                }
                ,
                r.CreateRGBATexture = function(t, i, n, o, a, s, y, l) {
                    return void 0 === a && (a = !0),
                    void 0 === s && (s = !1),
                    void 0 === y && (y = e.Texture.TRILINEAR_SAMPLINGMODE),
                    void 0 === l && (l = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    new r(t,i,n,e.Engine.TEXTUREFORMAT_RGBA,o,a,s,y,l)
                }
                ,
                r.CreateRTexture = function(t, i, n, o, a, s, y, l) {
                    return void 0 === a && (a = !0),
                    void 0 === s && (s = !1),
                    void 0 === y && (y = e.Texture.TRILINEAR_SAMPLINGMODE),
                    void 0 === l && (l = e.Engine.TEXTURETYPE_FLOAT),
                    new r(t,i,n,e.Engine.TEXTUREFORMAT_R,o,a,s,y,l)
                }
                ,
                r
            }(e.Texture);
            e.RawTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c, h) {
                    void 0 === y && (y = !0),
                    void 0 === l && (l = !1),
                    void 0 === c && (c = e.Texture.TRILINEAR_SAMPLINGMODE),
                    void 0 === h && (h = e.Engine.TEXTURETYPE_UNSIGNED_INT);
                    var u = t.call(this, null, s, !y, l) || this;
                    return u.format = a,
                    u._engine = s.getEngine(),
                    u._texture = s.getEngine().createRawTexture3D(r, i, n, o, a, y, l, c, void 0, h),
                    u.is3D = !0,
                    u
                }
                return o(r, t),
                r.prototype.update = function(e) {
                    this._texture && this._engine.updateRawTexture3D(this._texture, e, this._texture.format, this._texture.invertY, void 0, this._texture.type)
                }
                ,
                r
            }(e.Texture);
            e.RawTexture3D = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e) {
                    this._vertexBuffers = {},
                    this._scene = e
                }
                return t.prototype._prepareBuffers = function() {
                    if (!this._vertexBuffers[e.VertexBuffer.PositionKind]) {
                        var t = [];
                        t.push(1, 1),
                        t.push(-1, 1),
                        t.push(-1, -1),
                        t.push(1, -1),
                        this._vertexBuffers[e.VertexBuffer.PositionKind] = new e.VertexBuffer(this._scene.getEngine(),t,e.VertexBuffer.PositionKind,!1,!1,2),
                        this._buildIndexBuffer()
                    }
                }
                ,
                t.prototype._buildIndexBuffer = function() {
                    var e = [];
                    e.push(0),
                    e.push(1),
                    e.push(2),
                    e.push(0),
                    e.push(2),
                    e.push(3),
                    this._indexBuffer = this._scene.getEngine().createIndexBuffer(e)
                }
                ,
                t.prototype._rebuild = function() {
                    var t = this._vertexBuffers[e.VertexBuffer.PositionKind];
                    t && (t._rebuild(),
                    this._buildIndexBuffer())
                }
                ,
                t.prototype._prepareFrame = function(e, t) {
                    void 0 === e && (e = null),
                    void 0 === t && (t = null);
                    var r = this._scene.activeCamera;
                    return !!r && (!(!(t = t || r._postProcesses.filter((function(e) {
                        return null != e
                    }
                    ))) || 0 === t.length || !this._scene.postProcessesEnabled) && (t[0].activate(r, e, null != t),
                    !0))
                }
                ,
                t.prototype.directRender = function(t, r, i, n, o) {
                    void 0 === r && (r = null),
                    void 0 === i && (i = !1),
                    void 0 === n && (n = 0),
                    void 0 === o && (o = 0);
                    for (var a = this._scene.getEngine(), s = 0; s < t.length; s++) {
                        s < t.length - 1 ? t[s + 1].activate(this._scene.activeCamera, r) : r ? a.bindFramebuffer(r, n, void 0, void 0, i, void 0, o) : a.restoreDefaultFramebuffer();
                        var y = t[s]
                          , l = y.apply();
                        l && (y.onBeforeRenderObservable.notifyObservers(l),
                        this._prepareBuffers(),
                        a.bindBuffers(this._vertexBuffers, this._indexBuffer, l),
                        a.drawElementsType(e.Material.TriangleFillMode, 0, 6),
                        y.onAfterRenderObservable.notifyObservers(l))
                    }
                    a.setDepthBuffer(!0),
                    a.setDepthWrite(!0)
                }
                ,
                t.prototype._finalizeFrame = function(t, r, i, n, o) {
                    void 0 === o && (o = !1);
                    var a = this._scene.activeCamera;
                    if (a && 0 !== (n = n || a._postProcesses.filter((function(e) {
                        return null != e
                    }
                    ))).length && this._scene.postProcessesEnabled) {
                        for (var s = this._scene.getEngine(), y = 0, l = n.length; y < l; y++) {
                            var c = n[y];
                            if (y < l - 1 ? c._outputTexture = n[y + 1].activate(a, r) : r ? (s.bindFramebuffer(r, i, void 0, void 0, o),
                            c._outputTexture = r) : (s.restoreDefaultFramebuffer(),
                            c._outputTexture = null),
                            t)
                                break;
                            var h = c.apply();
                            h && (c.onBeforeRenderObservable.notifyObservers(h),
                            this._prepareBuffers(),
                            s.bindBuffers(this._vertexBuffers, this._indexBuffer, h),
                            s.drawElementsType(e.Material.TriangleFillMode, 0, 6),
                            c.onAfterRenderObservable.notifyObservers(h))
                        }
                        s.setDepthBuffer(!0),
                        s.setDepthWrite(!0),
                        s.setAlphaMode(e.Engine.ALPHA_DISABLE)
                    }
                }
                ,
                t.prototype.dispose = function() {
                    var t = this._vertexBuffers[e.VertexBuffer.PositionKind];
                    t && (t.dispose(),
                    this._vertexBuffers[e.VertexBuffer.PositionKind] = null),
                    this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer),
                    this._indexBuffer = null)
                }
                ,
                t
            }();
            e.PostProcessManager = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n, o, a, s, y, l, c, h, u, d, x) {
                    void 0 === s && (s = e.Texture.NEAREST_SAMPLINGMODE),
                    void 0 === c && (c = null),
                    void 0 === h && (h = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === u && (u = "postprocess"),
                    void 0 === x && (x = !1),
                    this.name = t,
                    this.width = -1,
                    this.height = -1,
                    this._outputTexture = null,
                    this.autoClear = !0,
                    this.alphaMode = e.Engine.ALPHA_DISABLE,
                    this.animations = new Array,
                    this.enablePixelPerfectMode = !1,
                    this.forceFullscreenViewport = !0,
                    this.scaleMode = e.Engine.SCALEMODE_FLOOR,
                    this.alwaysForcePOT = !1,
                    this._samples = 1,
                    this.adaptScaleToCurrentViewport = !1,
                    this._reusable = !1,
                    this._textures = new e.SmartArray(2),
                    this._currentRenderTextureInd = 0,
                    this._scaleRatio = new e.Vector2(1,1),
                    this._texelSize = e.Vector2.Zero(),
                    this.onActivateObservable = new e.Observable,
                    this.onSizeChangedObservable = new e.Observable,
                    this.onApplyObservable = new e.Observable,
                    this.onBeforeRenderObservable = new e.Observable,
                    this.onAfterRenderObservable = new e.Observable,
                    null != a ? (this._camera = a,
                    this._scene = a.getScene(),
                    a.attachPostProcess(this),
                    this._engine = this._scene.getEngine(),
                    this._scene.postProcesses.push(this)) : y && (this._engine = y,
                    this._engine.postProcesses.push(this)),
                    this._options = o,
                    this.renderTargetSamplingMode = s || e.Texture.NEAREST_SAMPLINGMODE,
                    this._reusable = l || !1,
                    this._textureType = h,
                    this._samplers = n || [],
                    this._samplers.push("textureSampler"),
                    this._fragmentUrl = r,
                    this._vertexUrl = u,
                    this._parameters = i || [],
                    this._parameters.push("scale"),
                    this._indexParameters = d,
                    x || this.updateEffect(c)
                }
                return Object.defineProperty(t.prototype, "samples", {
                    get: function() {
                        return this._samples
                    },
                    set: function(e) {
                        var t = this;
                        this._samples = e,
                        this._textures.forEach((function(e) {
                            e.samples !== t._samples && t._engine.updateRenderTargetTextureSampleCount(e, t._samples)
                        }
                        ))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onActivate", {
                    set: function(e) {
                        this._onActivateObserver && this.onActivateObservable.remove(this._onActivateObserver),
                        e && (this._onActivateObserver = this.onActivateObservable.add(e))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onSizeChanged", {
                    set: function(e) {
                        this._onSizeChangedObserver && this.onSizeChangedObservable.remove(this._onSizeChangedObserver),
                        this._onSizeChangedObserver = this.onSizeChangedObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onApply", {
                    set: function(e) {
                        this._onApplyObserver && this.onApplyObservable.remove(this._onApplyObserver),
                        this._onApplyObserver = this.onApplyObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onBeforeRender", {
                    set: function(e) {
                        this._onBeforeRenderObserver && this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),
                        this._onBeforeRenderObserver = this.onBeforeRenderObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onAfterRender", {
                    set: function(e) {
                        this._onAfterRenderObserver && this.onAfterRenderObservable.remove(this._onAfterRenderObserver),
                        this._onAfterRenderObserver = this.onAfterRenderObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "inputTexture", {
                    get: function() {
                        return this._textures.data[this._currentRenderTextureInd]
                    },
                    set: function(e) {
                        this._forcedOutputTexture = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getCamera = function() {
                    return this._camera
                }
                ,
                Object.defineProperty(t.prototype, "texelSize", {
                    get: function() {
                        return this._shareOutputWithPostProcess ? this._shareOutputWithPostProcess.texelSize : (this._forcedOutputTexture && this._texelSize.copyFromFloats(1 / this._forcedOutputTexture.width, 1 / this._forcedOutputTexture.height),
                        this._texelSize)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getEngine = function() {
                    return this._engine
                }
                ,
                t.prototype.getEffect = function() {
                    return this._effect
                }
                ,
                t.prototype.shareOutputWith = function(e) {
                    return this._disposeTextures(),
                    this._shareOutputWithPostProcess = e,
                    this
                }
                ,
                t.prototype.useOwnOutput = function() {
                    0 == this._textures.length && (this._textures = new e.SmartArray(2)),
                    this._shareOutputWithPostProcess = null
                }
                ,
                t.prototype.updateEffect = function(e, t, r, i, n, o) {
                    void 0 === e && (e = null),
                    void 0 === t && (t = null),
                    void 0 === r && (r = null),
                    this._effect = this._engine.createEffect({
                        vertex: this._vertexUrl,
                        fragment: this._fragmentUrl
                    }, ["position"], t || this._parameters, r || this._samplers, null !== e ? e : "", void 0, n, o, i || this._indexParameters)
                }
                ,
                t.prototype.isReusable = function() {
                    return this._reusable
                }
                ,
                t.prototype.markTextureDirty = function() {
                    this.width = -1
                }
                ,
                t.prototype.activate = function(t, r, i) {
                    var n = this;
                    void 0 === r && (r = null);
                    var o = (t = t || this._camera).getScene()
                      , a = o.getEngine()
                      , s = a.getCaps().maxTextureSize
                      , y = (r ? r.width : this._engine.getRenderWidth(!0)) * this._options | 0
                      , l = (r ? r.height : this._engine.getRenderHeight(!0)) * this._options | 0
                      , c = t.parent;
                    !c || c.leftCamera != t && c.rightCamera != t || (y /= 2);
                    var h, u = this._options.width || y, d = this._options.height || l;
                    if (!this._shareOutputWithPostProcess && !this._forcedOutputTexture) {
                        if (this.adaptScaleToCurrentViewport) {
                            var x = a.currentViewport;
                            x && (u *= x.width,
                            d *= x.height)
                        }
                        if ((this.renderTargetSamplingMode === e.Texture.TRILINEAR_SAMPLINGMODE || this.alwaysForcePOT) && (this._options.width || (u = a.needPOTTextures ? e.Tools.GetExponentOfTwo(u, s, this.scaleMode) : u),
                        this._options.height || (d = a.needPOTTextures ? e.Tools.GetExponentOfTwo(d, s, this.scaleMode) : d)),
                        this.width !== u || this.height !== d) {
                            if (this._textures.length > 0) {
                                for (var p = 0; p < this._textures.length; p++)
                                    this._engine._releaseTexture(this._textures.data[p]);
                                this._textures.reset()
                            }
                            this.width = u,
                            this.height = d;
                            var f = {
                                width: this.width,
                                height: this.height
                            }
                              , m = {
                                generateMipMaps: !1,
                                generateDepthBuffer: i || 0 === t._postProcesses.indexOf(this),
                                generateStencilBuffer: (i || 0 === t._postProcesses.indexOf(this)) && this._engine.isStencilEnable,
                                samplingMode: this.renderTargetSamplingMode,
                                type: this._textureType
                            };
                            this._textures.push(this._engine.createRenderTargetTexture(f, m)),
                            this._reusable && this._textures.push(this._engine.createRenderTargetTexture(f, m)),
                            this._texelSize.copyFromFloats(1 / this.width, 1 / this.height),
                            this.onSizeChangedObservable.notifyObservers(this)
                        }
                        this._textures.forEach((function(e) {
                            e.samples !== n.samples && n._engine.updateRenderTargetTextureSampleCount(e, n.samples)
                        }
                        ))
                    }
                    return this._shareOutputWithPostProcess ? h = this._shareOutputWithPostProcess.inputTexture : this._forcedOutputTexture ? (h = this._forcedOutputTexture,
                    this.width = this._forcedOutputTexture.width,
                    this.height = this._forcedOutputTexture.height) : h = this.inputTexture,
                    this.enablePixelPerfectMode ? (this._scaleRatio.copyFromFloats(y / u, l / d),
                    this._engine.bindFramebuffer(h, 0, y, l, this.forceFullscreenViewport)) : (this._scaleRatio.copyFromFloats(1, 1),
                    this._engine.bindFramebuffer(h, 0, void 0, void 0, this.forceFullscreenViewport)),
                    this.onActivateObservable.notifyObservers(t),
                    this.autoClear && this.alphaMode === e.Engine.ALPHA_DISABLE && this._engine.clear(this.clearColor ? this.clearColor : o.clearColor, o._allowPostProcessClearColor, !0, !0),
                    this._reusable && (this._currentRenderTextureInd = (this._currentRenderTextureInd + 1) % 2),
                    h
                }
                ,
                Object.defineProperty(t.prototype, "isSupported", {
                    get: function() {
                        return this._effect.isSupported
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "aspectRatio", {
                    get: function() {
                        return this._shareOutputWithPostProcess ? this._shareOutputWithPostProcess.aspectRatio : this._forcedOutputTexture ? this._forcedOutputTexture.width / this._forcedOutputTexture.height : this.width / this.height
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.isReady = function() {
                    return this._effect && this._effect.isReady()
                }
                ,
                t.prototype.apply = function() {
                    return this._effect && this._effect.isReady() ? (this._engine.enableEffect(this._effect),
                    this._engine.setState(!1),
                    this._engine.setDepthBuffer(!1),
                    this._engine.setDepthWrite(!1),
                    this._engine.setAlphaMode(this.alphaMode),
                    this.alphaConstants && this.getEngine().setAlphaConstants(this.alphaConstants.r, this.alphaConstants.g, this.alphaConstants.b, this.alphaConstants.a),
                    e = this._shareOutputWithPostProcess ? this._shareOutputWithPostProcess.inputTexture : this._forcedOutputTexture ? this._forcedOutputTexture : this.inputTexture,
                    this._effect._bindTexture("textureSampler", e),
                    this._effect.setVector2("scale", this._scaleRatio),
                    this.onApplyObservable.notifyObservers(this._effect),
                    this._effect) : null;
                    var e
                }
                ,
                t.prototype._disposeTextures = function() {
                    if (!this._shareOutputWithPostProcess && !this._forcedOutputTexture) {
                        if (this._textures.length > 0)
                            for (var e = 0; e < this._textures.length; e++)
                                this._engine._releaseTexture(this._textures.data[e]);
                        this._textures.dispose()
                    }
                }
                ,
                t.prototype.dispose = function(e) {
                    if (e = e || this._camera,
                    this._disposeTextures(),
                    this._scene) {
                        var t = this._scene.postProcesses.indexOf(this);
                        -1 !== t && this._scene.postProcesses.splice(t, 1)
                    } else {
                        var r = this._engine.postProcesses.indexOf(this);
                        -1 !== r && this._engine.postProcesses.splice(r, 1)
                    }
                    if (e) {
                        if (e.detachPostProcess(this),
                        0 === e._postProcesses.indexOf(this) && e._postProcesses.length > 0) {
                            var i = this._camera._getFirstPostProcess();
                            i && i.markTextureDirty()
                        }
                        this.onActivateObservable.clear(),
                        this.onAfterRenderObservable.clear(),
                        this.onApplyObservable.clear(),
                        this.onBeforeRenderObservable.clear(),
                        this.onSizeChangedObservable.clear()
                    }
                }
                ,
                t
            }();
            e.PostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l) {
                    return void 0 === n && (n = null),
                    void 0 === y && (y = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === l && (l = !1),
                    t.call(this, r, "pass", null, null, i, n, o, a, s, void 0, y, void 0, null, l) || this
                }
                return o(r, t),
                r
            }(e.PostProcess);
            e.PassPostProcess = t
        }(s || (s = {}));
        a = this && this.__assign || function() {
            return (a = Object.assign || function(e) {
                for (var t, r = 1, i = arguments.length; r < i; r++)
                    for (var n in t = arguments[r])
                        Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]);
                return e
            }
            ).apply(this, arguments)
        }
        ;
        !function(e) {
            var t = function() {
                function t(r, i, n) {
                    this._bias = 5e-5,
                    this._normalBias = 0,
                    this._blurBoxOffset = 1,
                    this._blurScale = 2,
                    this._blurKernel = 1,
                    this._useKernelBlur = !1,
                    this._filter = t.FILTER_NONE,
                    this._filteringQuality = t.QUALITY_HIGH,
                    this._contactHardeningLightSizeUVRatio = .1,
                    this._darkness = 0,
                    this._transparencyShadow = !1,
                    this.frustumEdgeFalloff = 0,
                    this.forceBackFacesOnly = !1,
                    this._lightDirection = e.Vector3.Zero(),
                    this._viewMatrix = e.Matrix.Zero(),
                    this._projectionMatrix = e.Matrix.Zero(),
                    this._transformMatrix = e.Matrix.Zero(),
                    this._cachedPosition = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),
                    this._cachedDirection = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),
                    this._currentFaceIndex = 0,
                    this._currentFaceIndexCache = 0,
                    this._defaultTextureMatrix = e.Matrix.Identity(),
                    this._mapSize = r,
                    this._light = i,
                    this._scene = i.getScene(),
                    i._shadowGenerator = this;
                    var o = this._scene._getComponent(e.SceneComponentConstants.NAME_SHADOWGENERATOR);
                    o || (o = new e.ShadowGeneratorSceneComponent(this._scene),
                    this._scene._addComponent(o));
                    var a = this._scene.getEngine().getCaps();
                    n ? a.textureFloatRender && a.textureFloatLinearFiltering ? this._textureType = e.Engine.TEXTURETYPE_FLOAT : a.textureHalfFloatRender && a.textureHalfFloatLinearFiltering ? this._textureType = e.Engine.TEXTURETYPE_HALF_FLOAT : this._textureType = e.Engine.TEXTURETYPE_UNSIGNED_INT : a.textureHalfFloatRender && a.textureHalfFloatLinearFiltering ? this._textureType = e.Engine.TEXTURETYPE_HALF_FLOAT : a.textureFloatRender && a.textureFloatLinearFiltering ? this._textureType = e.Engine.TEXTURETYPE_FLOAT : this._textureType = e.Engine.TEXTURETYPE_UNSIGNED_INT,
                    this._initializeGenerator(),
                    this._applyFilterValues()
                }
                return Object.defineProperty(t.prototype, "bias", {
                    get: function() {
                        return this._bias
                    },
                    set: function(e) {
                        this._bias = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "normalBias", {
                    get: function() {
                        return this._normalBias
                    },
                    set: function(e) {
                        this._normalBias = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "blurBoxOffset", {
                    get: function() {
                        return this._blurBoxOffset
                    },
                    set: function(e) {
                        this._blurBoxOffset !== e && (this._blurBoxOffset = e,
                        this._disposeBlurPostProcesses())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "blurScale", {
                    get: function() {
                        return this._blurScale
                    },
                    set: function(e) {
                        this._blurScale !== e && (this._blurScale = e,
                        this._disposeBlurPostProcesses())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "blurKernel", {
                    get: function() {
                        return this._blurKernel
                    },
                    set: function(e) {
                        this._blurKernel !== e && (this._blurKernel = e,
                        this._disposeBlurPostProcesses())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "useKernelBlur", {
                    get: function() {
                        return this._useKernelBlur
                    },
                    set: function(e) {
                        this._useKernelBlur !== e && (this._useKernelBlur = e,
                        this._disposeBlurPostProcesses())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "depthScale", {
                    get: function() {
                        return void 0 !== this._depthScale ? this._depthScale : this._light.getDepthScale()
                    },
                    set: function(e) {
                        this._depthScale = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "filter", {
                    get: function() {
                        return this._filter
                    },
                    set: function(e) {
                        if (this._light.needCube()) {
                            if (e === t.FILTER_BLUREXPONENTIALSHADOWMAP)
                                return void (this.useExponentialShadowMap = !0);
                            if (e === t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)
                                return void (this.useCloseExponentialShadowMap = !0);
                            if (e === t.FILTER_PCF || e === t.FILTER_PCSS)
                                return void (this.usePoissonSampling = !0)
                        }
                        e !== t.FILTER_PCF && e !== t.FILTER_PCSS || 1 !== this._scene.getEngine().webGLVersion ? this._filter !== e && (this._filter = e,
                        this._disposeBlurPostProcesses(),
                        this._applyFilterValues(),
                        this._light._markMeshesAsLightDirty()) : this.usePoissonSampling = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "usePoissonSampling", {
                    get: function() {
                        return this.filter === t.FILTER_POISSONSAMPLING
                    },
                    set: function(e) {
                        (e || this.filter === t.FILTER_POISSONSAMPLING) && (this.filter = e ? t.FILTER_POISSONSAMPLING : t.FILTER_NONE)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "useVarianceShadowMap", {
                    get: function() {
                        return e.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."),
                        this.useExponentialShadowMap
                    },
                    set: function(t) {
                        e.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."),
                        this.useExponentialShadowMap = t
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "useBlurVarianceShadowMap", {
                    get: function() {
                        return e.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."),
                        this.useBlurExponentialShadowMap
                    },
                    set: function(t) {
                        e.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."),
                        this.useBlurExponentialShadowMap = t
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "useExponentialShadowMap", {
                    get: function() {
                        return this.filter === t.FILTER_EXPONENTIALSHADOWMAP
                    },
                    set: function(e) {
                        (e || this.filter === t.FILTER_EXPONENTIALSHADOWMAP) && (this.filter = e ? t.FILTER_EXPONENTIALSHADOWMAP : t.FILTER_NONE)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "useBlurExponentialShadowMap", {
                    get: function() {
                        return this.filter === t.FILTER_BLUREXPONENTIALSHADOWMAP
                    },
                    set: function(e) {
                        (e || this.filter === t.FILTER_BLUREXPONENTIALSHADOWMAP) && (this.filter = e ? t.FILTER_BLUREXPONENTIALSHADOWMAP : t.FILTER_NONE)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "useCloseExponentialShadowMap", {
                    get: function() {
                        return this.filter === t.FILTER_CLOSEEXPONENTIALSHADOWMAP
                    },
                    set: function(e) {
                        (e || this.filter === t.FILTER_CLOSEEXPONENTIALSHADOWMAP) && (this.filter = e ? t.FILTER_CLOSEEXPONENTIALSHADOWMAP : t.FILTER_NONE)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "useBlurCloseExponentialShadowMap", {
                    get: function() {
                        return this.filter === t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP
                    },
                    set: function(e) {
                        (e || this.filter === t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP) && (this.filter = e ? t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP : t.FILTER_NONE)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "usePercentageCloserFiltering", {
                    get: function() {
                        return this.filter === t.FILTER_PCF
                    },
                    set: function(e) {
                        (e || this.filter === t.FILTER_PCF) && (this.filter = e ? t.FILTER_PCF : t.FILTER_NONE)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "filteringQuality", {
                    get: function() {
                        return this._filteringQuality
                    },
                    set: function(e) {
                        this._filteringQuality = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "useContactHardeningShadow", {
                    get: function() {
                        return this.filter === t.FILTER_PCSS
                    },
                    set: function(e) {
                        (e || this.filter === t.FILTER_PCSS) && (this.filter = e ? t.FILTER_PCSS : t.FILTER_NONE)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "contactHardeningLightSizeUVRatio", {
                    get: function() {
                        return this._contactHardeningLightSizeUVRatio
                    },
                    set: function(e) {
                        this._contactHardeningLightSizeUVRatio = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getDarkness = function() {
                    return this._darkness
                }
                ,
                t.prototype.setDarkness = function(e) {
                    return this._darkness = e >= 1 ? 1 : e <= 0 ? 0 : e,
                    this
                }
                ,
                t.prototype.setTransparencyShadow = function(e) {
                    return this._transparencyShadow = e,
                    this
                }
                ,
                t.prototype.getShadowMap = function() {
                    return this._shadowMap
                }
                ,
                t.prototype.getShadowMapForRendering = function() {
                    return this._shadowMap2 ? this._shadowMap2 : this._shadowMap
                }
                ,
                t.prototype.addShadowCaster = function(e, t) {
                    var r;
                    return void 0 === t && (t = !0),
                    this._shadowMap ? (this._shadowMap.renderList || (this._shadowMap.renderList = []),
                    this._shadowMap.renderList.push(e),
                    t && (r = this._shadowMap.renderList).push.apply(r, e.getChildMeshes()),
                    this) : this
                }
                ,
                t.prototype.removeShadowCaster = function(e, t) {
                    if (void 0 === t && (t = !0),
                    !this._shadowMap || !this._shadowMap.renderList)
                        return this;
                    var r = this._shadowMap.renderList.indexOf(e);
                    if (-1 !== r && this._shadowMap.renderList.splice(r, 1),
                    t)
                        for (var i = 0, n = e.getChildren(); i < n.length; i++) {
                            var o = n[i];
                            this.removeShadowCaster(o)
                        }
                    return this
                }
                ,
                t.prototype.getLight = function() {
                    return this._light
                }
                ,
                t.prototype._initializeGenerator = function() {
                    this._light._markMeshesAsLightDirty(),
                    this._initializeShadowMap()
                }
                ,
                t.prototype._initializeShadowMap = function() {
                    var r = this
                      , i = this._scene.getEngine();
                    i.webGLVersion > 1 ? (this._shadowMap = new e.RenderTargetTexture(this._light.name + "_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),
                    this._shadowMap.createDepthStencilTexture(e.Engine.LESS, !0)) : this._shadowMap = new e.RenderTargetTexture(this._light.name + "_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),
                    this._shadowMap.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    this._shadowMap.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    this._shadowMap.anisotropicFilteringLevel = 1,
                    this._shadowMap.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE),
                    this._shadowMap.renderParticles = !1,
                    this._shadowMap.ignoreCameraViewport = !0,
                    this._shadowMap.onBeforeRenderObservable.add((function(e) {
                        r._currentFaceIndex = e,
                        r._filter === t.FILTER_PCF && i.setColorWrite(!1)
                    }
                    )),
                    this._shadowMap.customRenderFunction = this._renderForShadowMap.bind(this),
                    this._shadowMap.onAfterUnbindObservable.add((function() {
                        if (r._filter === t.FILTER_PCF && i.setColorWrite(!0),
                        r.useBlurExponentialShadowMap || r.useBlurCloseExponentialShadowMap) {
                            var e = r.getShadowMapForRendering();
                            e && r._scene.postProcessManager.directRender(r._blurPostProcesses, e.getInternalTexture(), !0)
                        }
                    }
                    ));
                    var n = new e.Color4(0,0,0,0)
                      , o = new e.Color4(1,1,1,1);
                    this._shadowMap.onClearObservable.add((function(e) {
                        r._filter === t.FILTER_PCF ? e.clear(o, !1, !0, !1) : r.useExponentialShadowMap || r.useBlurExponentialShadowMap ? e.clear(n, !0, !0, !1) : e.clear(o, !0, !0, !1)
                    }
                    ))
                }
                ,
                t.prototype._initializeBlurRTTAndPostProcesses = function() {
                    var t = this
                      , r = this._scene.getEngine()
                      , i = this._mapSize / this.blurScale;
                    this.useKernelBlur && 1 === this.blurScale || (this._shadowMap2 = new e.RenderTargetTexture(this._light.name + "_shadowMap2",i,this._scene,!1,!0,this._textureType),
                    this._shadowMap2.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    this._shadowMap2.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    this._shadowMap2.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE)),
                    this.useKernelBlur ? (this._kernelBlurXPostprocess = new e.BlurPostProcess(this._light.name + "KernelBlurX",new e.Vector2(1,0),this.blurKernel,1,null,e.Texture.BILINEAR_SAMPLINGMODE,r,!1,this._textureType),
                    this._kernelBlurXPostprocess.width = i,
                    this._kernelBlurXPostprocess.height = i,
                    this._kernelBlurXPostprocess.onApplyObservable.add((function(e) {
                        e.setTexture("textureSampler", t._shadowMap)
                    }
                    )),
                    this._kernelBlurYPostprocess = new e.BlurPostProcess(this._light.name + "KernelBlurY",new e.Vector2(0,1),this.blurKernel,1,null,e.Texture.BILINEAR_SAMPLINGMODE,r,!1,this._textureType),
                    this._kernelBlurXPostprocess.autoClear = !1,
                    this._kernelBlurYPostprocess.autoClear = !1,
                    this._textureType === e.Engine.TEXTURETYPE_UNSIGNED_INT && (this._kernelBlurXPostprocess.packedFloat = !0,
                    this._kernelBlurYPostprocess.packedFloat = !0),
                    this._blurPostProcesses = [this._kernelBlurXPostprocess, this._kernelBlurYPostprocess]) : (this._boxBlurPostprocess = new e.PostProcess(this._light.name + "DepthBoxBlur","depthBoxBlur",["screenSize", "boxOffset"],[],1,null,e.Texture.BILINEAR_SAMPLINGMODE,r,!1,"#define OFFSET " + this._blurBoxOffset,this._textureType),
                    this._boxBlurPostprocess.onApplyObservable.add((function(e) {
                        e.setFloat2("screenSize", i, i),
                        e.setTexture("textureSampler", t._shadowMap)
                    }
                    )),
                    this._boxBlurPostprocess.autoClear = !1,
                    this._blurPostProcesses = [this._boxBlurPostprocess])
                }
                ,
                t.prototype._renderForShadowMap = function(e, t, r, i) {
                    var n, o = this._scene.getEngine();
                    if (i.length) {
                        for (o.setColorWrite(!1),
                        n = 0; n < i.length; n++)
                            this._renderSubMeshForShadowMap(i.data[n]);
                        o.setColorWrite(!0)
                    }
                    for (n = 0; n < e.length; n++)
                        this._renderSubMeshForShadowMap(e.data[n]);
                    for (n = 0; n < t.length; n++)
                        this._renderSubMeshForShadowMap(t.data[n]);
                    if (this._transparencyShadow)
                        for (n = 0; n < r.length; n++)
                            this._renderSubMeshForShadowMap(r.data[n])
                }
                ,
                t.prototype._renderSubMeshForShadowMap = function(t) {
                    var r = this
                      , i = t.getRenderingMesh()
                      , n = this._scene
                      , o = n.getEngine()
                      , a = t.getMaterial();
                    if (a) {
                        o.setState(a.backFaceCulling);
                        var s = i._getInstancesRenderList(t._id);
                        if (!s.mustReturn) {
                            var y = o.getCaps().instancedArrays && null !== s.visibleInstances[t._id] && void 0 !== s.visibleInstances[t._id];
                            if (this.isReady(t, y)) {
                                if (o.enableEffect(this._effect),
                                i._bind(t, this._effect, e.Material.TriangleFillMode),
                                this._effect.setFloat3("biasAndScale", this.bias, this.normalBias, this.depthScale),
                                this._effect.setMatrix("viewProjection", this.getTransformMatrix()),
                                this.getLight().getTypeID() === e.Light.LIGHTTYPEID_DIRECTIONALLIGHT ? this._effect.setVector3("lightData", this._cachedDirection) : this._effect.setVector3("lightData", this._cachedPosition),
                                n.activeCamera && this._effect.setFloat2("depthValues", this.getLight().getDepthMinZ(n.activeCamera), this.getLight().getDepthMinZ(n.activeCamera) + this.getLight().getDepthMaxZ(n.activeCamera)),
                                a && a.needAlphaTesting()) {
                                    var l = a.getAlphaTestTexture();
                                    l && (this._effect.setTexture("diffuseSampler", l),
                                    this._effect.setMatrix("diffuseMatrix", l.getTextureMatrix() || this._defaultTextureMatrix))
                                }
                                i.useBones && i.computeBonesUsingShaders && this._effect.setMatrices("mBones", i.skeleton.getTransformMatrices(i)),
                                e.MaterialHelper.BindMorphTargetParameters(i, this._effect),
                                this.forceBackFacesOnly && o.setState(!0, 0, !1, !0),
                                i._processRendering(t, this._effect, e.Material.TriangleFillMode, s, y, (function(e, t) {
                                    return r._effect.setMatrix("world", t)
                                }
                                )),
                                this.forceBackFacesOnly && o.setState(!0, 0, !1, !1)
                            } else
                                this._shadowMap && this._shadowMap.resetRefreshCounter()
                        }
                    }
                }
                ,
                t.prototype._applyFilterValues = function() {
                    this._shadowMap && (this.filter === t.FILTER_NONE || this.filter === t.FILTER_PCSS ? this._shadowMap.updateSamplingMode(e.Texture.NEAREST_SAMPLINGMODE) : this._shadowMap.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE))
                }
                ,
                t.prototype.forceCompilation = function(e, t) {
                    var r = this
                      , i = a({
                        useInstances: !1
                    }, t)
                      , n = this.getShadowMap();
                    if (n) {
                        var o = n.renderList;
                        if (o) {
                            for (var s = new Array, y = 0, l = o; y < l.length; y++) {
                                var c = l[y];
                                s.push.apply(s, c.subMeshes)
                            }
                            if (0 !== s.length) {
                                var h = 0
                                  , u = function() {
                                    if (r._scene && r._scene.getEngine()) {
                                        for (; r.isReady(s[h], i.useInstances); )
                                            if (++h >= s.length)
                                                return void (e && e(r));
                                        setTimeout(u, 16)
                                    }
                                };
                                u()
                            } else
                                e && e(this)
                        } else
                            e && e(this)
                    } else
                        e && e(this)
                }
                ,
                t.prototype.forceCompilationAsync = function(e) {
                    var t = this;
                    return new Promise((function(r) {
                        t.forceCompilation((function() {
                            r()
                        }
                        ), e)
                    }
                    ))
                }
                ,
                t.prototype.isReady = function(t, r) {
                    var i = [];
                    this._textureType !== e.Engine.TEXTURETYPE_UNSIGNED_INT && i.push("#define FLOAT"),
                    this.useExponentialShadowMap || this.useBlurExponentialShadowMap ? i.push("#define ESM") : (this.usePercentageCloserFiltering || this.useContactHardeningShadow) && i.push("#define DEPTHTEXTURE");
                    var n = [e.VertexBuffer.PositionKind]
                      , o = t.getMesh()
                      , a = t.getMaterial();
                    if (this.normalBias && o.isVerticesDataPresent(e.VertexBuffer.NormalKind) && (n.push(e.VertexBuffer.NormalKind),
                    i.push("#define NORMAL"),
                    o.nonUniformScaling && i.push("#define NONUNIFORMSCALING"),
                    this.getLight().getTypeID() === e.Light.LIGHTTYPEID_DIRECTIONALLIGHT && i.push("#define DIRECTIONINLIGHTDATA")),
                    a && a.needAlphaTesting()) {
                        var s = a.getAlphaTestTexture();
                        s && (i.push("#define ALPHATEST"),
                        o.isVerticesDataPresent(e.VertexBuffer.UVKind) && (n.push(e.VertexBuffer.UVKind),
                        i.push("#define UV1")),
                        o.isVerticesDataPresent(e.VertexBuffer.UV2Kind) && 1 === s.coordinatesIndex && (n.push(e.VertexBuffer.UV2Kind),
                        i.push("#define UV2")))
                    }
                    o.useBones && o.computeBonesUsingShaders ? (n.push(e.VertexBuffer.MatricesIndicesKind),
                    n.push(e.VertexBuffer.MatricesWeightsKind),
                    o.numBoneInfluencers > 4 && (n.push(e.VertexBuffer.MatricesIndicesExtraKind),
                    n.push(e.VertexBuffer.MatricesWeightsExtraKind)),
                    i.push("#define NUM_BONE_INFLUENCERS " + o.numBoneInfluencers),
                    i.push("#define BonesPerMesh " + (o.skeleton.bones.length + 1))) : i.push("#define NUM_BONE_INFLUENCERS 0");
                    var y = o.morphTargetManager
                      , l = 0;
                    y && y.numInfluencers > 0 && (i.push("#define MORPHTARGETS"),
                    l = y.numInfluencers,
                    i.push("#define NUM_MORPH_INFLUENCERS " + l),
                    e.MaterialHelper.PrepareAttributesForMorphTargets(n, o, {
                        NUM_MORPH_INFLUENCERS: l
                    })),
                    r && (i.push("#define INSTANCES"),
                    n.push("world0"),
                    n.push("world1"),
                    n.push("world2"),
                    n.push("world3"));
                    var c = i.join("\n");
                    return this._cachedDefines !== c && (this._cachedDefines = c,
                    this._effect = this._scene.getEngine().createEffect("shadowMap", n, ["world", "mBones", "viewProjection", "diffuseMatrix", "lightData", "depthValues", "biasAndScale", "morphTargetInfluences"], ["diffuseSampler"], c, void 0, void 0, void 0, {
                        maxSimultaneousMorphTargets: l
                    })),
                    !!this._effect.isReady() && ((this.useBlurExponentialShadowMap || this.useBlurCloseExponentialShadowMap) && (this._blurPostProcesses && this._blurPostProcesses.length || this._initializeBlurRTTAndPostProcesses()),
                    !(this._kernelBlurXPostprocess && !this._kernelBlurXPostprocess.isReady()) && (!(this._kernelBlurYPostprocess && !this._kernelBlurYPostprocess.isReady()) && !(this._boxBlurPostprocess && !this._boxBlurPostprocess.isReady())))
                }
                ,
                t.prototype.prepareDefines = function(e, r) {
                    var i = this._scene
                      , n = this._light;
                    i.shadowsEnabled && n.shadowEnabled && (e["SHADOW" + r] = !0,
                    this.useContactHardeningShadow && (e["SHADOWPCSS" + r] = !0,
                    this._filteringQuality === t.QUALITY_LOW ? e["SHADOWLOWQUALITY" + r] = !0 : this._filteringQuality === t.QUALITY_MEDIUM && (e["SHADOWMEDIUMQUALITY" + r] = !0)),
                    this.usePercentageCloserFiltering ? (e["SHADOWPCF" + r] = !0,
                    this._filteringQuality === t.QUALITY_LOW ? e["SHADOWLOWQUALITY" + r] = !0 : this._filteringQuality === t.QUALITY_MEDIUM && (e["SHADOWMEDIUMQUALITY" + r] = !0)) : this.usePoissonSampling ? e["SHADOWPOISSON" + r] = !0 : this.useExponentialShadowMap || this.useBlurExponentialShadowMap ? e["SHADOWESM" + r] = !0 : (this.useCloseExponentialShadowMap || this.useBlurCloseExponentialShadowMap) && (e["SHADOWCLOSEESM" + r] = !0),
                    n.needCube() && (e["SHADOWCUBE" + r] = !0))
                }
                ,
                t.prototype.bindShadowLight = function(e, r) {
                    var i = this._light
                      , n = this._scene;
                    if (n.shadowsEnabled && i.shadowEnabled) {
                        var o = n.activeCamera;
                        if (o) {
                            var a = this.getShadowMap();
                            a && (i.needCube() || r.setMatrix("lightMatrix" + e, this.getTransformMatrix()),
                            this._filter === t.FILTER_PCF ? (r.setDepthStencilTexture("shadowSampler" + e, this.getShadowMapForRendering()),
                            i._uniformBuffer.updateFloat4("shadowsInfo", this.getDarkness(), a.getSize().width, 1 / a.getSize().width, this.frustumEdgeFalloff, e)) : this._filter === t.FILTER_PCSS ? (r.setDepthStencilTexture("shadowSampler" + e, this.getShadowMapForRendering()),
                            r.setTexture("depthSampler" + e, this.getShadowMapForRendering()),
                            i._uniformBuffer.updateFloat4("shadowsInfo", this.getDarkness(), 1 / a.getSize().width, this._contactHardeningLightSizeUVRatio * a.getSize().width, this.frustumEdgeFalloff, e)) : (r.setTexture("shadowSampler" + e, this.getShadowMapForRendering()),
                            i._uniformBuffer.updateFloat4("shadowsInfo", this.getDarkness(), this.blurScale / a.getSize().width, this.depthScale, this.frustumEdgeFalloff, e)),
                            i._uniformBuffer.updateFloat2("depthValues", this.getLight().getDepthMinZ(o), this.getLight().getDepthMinZ(o) + this.getLight().getDepthMaxZ(o), e))
                        }
                    }
                }
                ,
                t.prototype.getTransformMatrix = function() {
                    var t = this._scene;
                    if (this._currentRenderID === t.getRenderId() && this._currentFaceIndexCache === this._currentFaceIndex)
                        return this._transformMatrix;
                    this._currentRenderID = t.getRenderId(),
                    this._currentFaceIndexCache = this._currentFaceIndex;
                    var r = this._light.position;
                    if (this._light.computeTransformedInformation() && (r = this._light.transformedPosition),
                    e.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex), this._lightDirection),
                    1 === Math.abs(e.Vector3.Dot(this._lightDirection, e.Vector3.Up())) && (this._lightDirection.z = 1e-13),
                    this._light.needProjectionMatrixCompute() || !this._cachedPosition || !this._cachedDirection || !r.equals(this._cachedPosition) || !this._lightDirection.equals(this._cachedDirection)) {
                        this._cachedPosition.copyFrom(r),
                        this._cachedDirection.copyFrom(this._lightDirection),
                        e.Matrix.LookAtLHToRef(r, r.add(this._lightDirection), e.Vector3.Up(), this._viewMatrix);
                        var i = this.getShadowMap();
                        if (i) {
                            var n = i.renderList;
                            n && this._light.setShadowProjectionMatrix(this._projectionMatrix, this._viewMatrix, n)
                        }
                        this._viewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix)
                    }
                    return this._transformMatrix
                }
                ,
                t.prototype.recreateShadowMap = function() {
                    var e = this._shadowMap;
                    if (e) {
                        var t = e.renderList;
                        this._disposeRTTandPostProcesses(),
                        this._initializeGenerator(),
                        this.filter = this.filter,
                        this._applyFilterValues(),
                        this._shadowMap.renderList = t
                    }
                }
                ,
                t.prototype._disposeBlurPostProcesses = function() {
                    this._shadowMap2 && (this._shadowMap2.dispose(),
                    this._shadowMap2 = null),
                    this._boxBlurPostprocess && (this._boxBlurPostprocess.dispose(),
                    this._boxBlurPostprocess = null),
                    this._kernelBlurXPostprocess && (this._kernelBlurXPostprocess.dispose(),
                    this._kernelBlurXPostprocess = null),
                    this._kernelBlurYPostprocess && (this._kernelBlurYPostprocess.dispose(),
                    this._kernelBlurYPostprocess = null),
                    this._blurPostProcesses = []
                }
                ,
                t.prototype._disposeRTTandPostProcesses = function() {
                    this._shadowMap && (this._shadowMap.dispose(),
                    this._shadowMap = null),
                    this._disposeBlurPostProcesses()
                }
                ,
                t.prototype.dispose = function() {
                    this._disposeRTTandPostProcesses(),
                    this._light && (this._light._shadowGenerator = null,
                    this._light._markMeshesAsLightDirty())
                }
                ,
                t.prototype.serialize = function() {
                    var e = {}
                      , t = this.getShadowMap();
                    if (!t)
                        return e;
                    if (e.lightId = this._light.id,
                    e.mapSize = t.getRenderSize(),
                    e.useExponentialShadowMap = this.useExponentialShadowMap,
                    e.useBlurExponentialShadowMap = this.useBlurExponentialShadowMap,
                    e.useCloseExponentialShadowMap = this.useBlurExponentialShadowMap,
                    e.useBlurCloseExponentialShadowMap = this.useBlurExponentialShadowMap,
                    e.usePoissonSampling = this.usePoissonSampling,
                    e.forceBackFacesOnly = this.forceBackFacesOnly,
                    e.depthScale = this.depthScale,
                    e.darkness = this.getDarkness(),
                    e.blurBoxOffset = this.blurBoxOffset,
                    e.blurKernel = this.blurKernel,
                    e.blurScale = this.blurScale,
                    e.useKernelBlur = this.useKernelBlur,
                    e.transparencyShadow = this._transparencyShadow,
                    e.frustumEdgeFalloff = this.frustumEdgeFalloff,
                    e.bias = this.bias,
                    e.normalBias = this.normalBias,
                    e.usePercentageCloserFiltering = this.usePercentageCloserFiltering,
                    e.useContactHardeningShadow = this.useContactHardeningShadow,
                    e.filteringQuality = this.filteringQuality,
                    e.contactHardeningLightSizeUVRatio = this.contactHardeningLightSizeUVRatio,
                    e.renderList = [],
                    t.renderList)
                        for (var r = 0; r < t.renderList.length; r++) {
                            var i = t.renderList[r];
                            e.renderList.push(i.id)
                        }
                    return e
                }
                ,
                t.Parse = function(e, r) {
                    for (var i = r.getLightByID(e.lightId), n = new t(e.mapSize,i), o = n.getShadowMap(), a = 0; a < e.renderList.length; a++) {
                        r.getMeshesByID(e.renderList[a]).forEach((function(e) {
                            o && (o.renderList || (o.renderList = []),
                            o.renderList.push(e))
                        }
                        ))
                    }
                    return e.usePoissonSampling ? n.usePoissonSampling = !0 : e.useExponentialShadowMap ? n.useExponentialShadowMap = !0 : e.useBlurExponentialShadowMap ? n.useBlurExponentialShadowMap = !0 : e.useCloseExponentialShadowMap ? n.useCloseExponentialShadowMap = !0 : e.useBlurCloseExponentialShadowMap ? n.useBlurCloseExponentialShadowMap = !0 : e.usePercentageCloserFiltering ? n.usePercentageCloserFiltering = !0 : e.useContactHardeningShadow && (n.useContactHardeningShadow = !0),
                    e.filteringQuality && (n.filteringQuality = e.filteringQuality),
                    e.contactHardeningLightSizeUVRatio ? n.contactHardeningLightSizeUVRatio = e.contactHardeningLightSizeUVRatio : e.useVarianceShadowMap ? n.useExponentialShadowMap = !0 : e.useBlurVarianceShadowMap && (n.useBlurExponentialShadowMap = !0),
                    e.depthScale && (n.depthScale = e.depthScale),
                    e.blurScale && (n.blurScale = e.blurScale),
                    e.blurBoxOffset && (n.blurBoxOffset = e.blurBoxOffset),
                    e.useKernelBlur && (n.useKernelBlur = e.useKernelBlur),
                    e.blurKernel && (n.blurKernel = e.blurKernel),
                    void 0 !== e.bias && (n.bias = e.bias),
                    void 0 !== e.normalBias && (n.normalBias = e.normalBias),
                    void 0 !== e.frustumEdgeFalloff && (n.frustumEdgeFalloff = e.frustumEdgeFalloff),
                    e.darkness && n.setDarkness(e.darkness),
                    e.transparencyShadow && n.setTransparencyShadow(!0),
                    n.forceBackFacesOnly = e.forceBackFacesOnly,
                    n
                }
                ,
                t.FILTER_NONE = 0,
                t.FILTER_EXPONENTIALSHADOWMAP = 1,
                t.FILTER_POISSONSAMPLING = 2,
                t.FILTER_BLUREXPONENTIALSHADOWMAP = 3,
                t.FILTER_CLOSEEXPONENTIALSHADOWMAP = 4,
                t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP = 5,
                t.FILTER_PCF = 6,
                t.FILTER_PCSS = 7,
                t.QUALITY_HIGH = 0,
                t.QUALITY_MEDIUM = 1,
                t.QUALITY_LOW = 2,
                t
            }();
            e.ShadowGenerator = t
        }(s || (s = {})),
        function(e) {
            e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_SHADOWGENERATOR, (function(t, r, i, n) {
                if (void 0 !== t.shadowGenerators && null !== t.shadowGenerators)
                    for (var o = 0, a = t.shadowGenerators.length; o < a; o++) {
                        var s = t.shadowGenerators[o];
                        e.ShadowGenerator.Parse(s, r)
                    }
            }
            ));
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_SHADOWGENERATOR,
                    this.scene = t
                }
                return t.prototype.register = function() {
                    this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR, this, this._gatherRenderTargets)
                }
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.serialize = function(e) {
                    e.shadowGenerators = [];
                    for (var t = 0, r = this.scene.lights; t < r.length; t++) {
                        var i = r[t].getShadowGenerator();
                        i && e.shadowGenerators.push(i.serialize())
                    }
                }
                ,
                t.prototype.addFromContainer = function(e) {}
                ,
                t.prototype.removeFromContainer = function(e) {}
                ,
                t.prototype.dispose = function() {}
                ,
                t.prototype._gatherRenderTargets = function(e) {
                    var t = this.scene;
                    if (this.scene.shadowsEnabled)
                        for (var r = 0; r < t.lights.length; r++) {
                            var i = t.lights[r]
                              , n = i.getShadowGenerator();
                            if (i.isEnabled() && i.shadowEnabled && n) {
                                var o = n.getShadowMap();
                                -1 !== t.textures.indexOf(o) && e.push(o)
                            }
                        }
                }
                ,
                t
            }();
            e.ShadowGeneratorSceneComponent = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e(e, t, r) {
                    void 0 === t && (t = ""),
                    void 0 === r && (r = "black");
                    var i = this;
                    this._renderingCanvas = e,
                    this._loadingText = t,
                    this._loadingDivBackgroundColor = r,
                    this._resizeLoadingUI = function() {
                        var e = i._renderingCanvas.getBoundingClientRect()
                          , t = window.getComputedStyle(i._renderingCanvas).position;
                        i._loadingDiv && (i._loadingDiv.style.position = "fixed" === t ? "fixed" : "absolute",
                        i._loadingDiv.style.left = e.left + "px",
                        i._loadingDiv.style.top = e.top + "px",
                        i._loadingDiv.style.width = e.width + "px",
                        i._loadingDiv.style.height = e.height + "px")
                    }
                }
                return e.prototype.displayLoadingUI = function() {
                    if (!this._loadingDiv) {
                        this._loadingDiv = document.createElement("div"),
                        this._loadingDiv.id = "babylonjsLoadingDiv",
                        this._loadingDiv.style.opacity = "0",
                        this._loadingDiv.style.transition = "opacity 1.5s ease",
                        this._loadingDiv.style.pointerEvents = "none",
                        this._loadingTextDiv = document.createElement("div"),
                        this._loadingTextDiv.style.position = "absolute",
                        this._loadingTextDiv.style.left = "0",
                        this._loadingTextDiv.style.top = "50%",
                        this._loadingTextDiv.style.marginTop = "80px",
                        this._loadingTextDiv.style.width = "100%",
                        this._loadingTextDiv.style.height = "20px",
                        this._loadingTextDiv.style.fontFamily = "Arial",
                        this._loadingTextDiv.style.fontSize = "14px",
                        this._loadingTextDiv.style.color = "white",
                        this._loadingTextDiv.style.textAlign = "center",
                        this._loadingTextDiv.innerHTML = "Loading",
                        this._loadingDiv.appendChild(this._loadingTextDiv),
                        this._loadingTextDiv.innerHTML = this._loadingText;
                        var e = document.createElement("style");
                        e.type = "text/css";
                        e.innerHTML = "@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }",
                        document.getElementsByTagName("head")[0].appendChild(e);
                        var t = new Image;
                        t.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAYq0lEQVR4Xu2dCZRcVZnHScAJUZSwjSOIbAJmEAZwQCCMoAInYRGIg8AwegQx7AFzUBBmzAFlE4EAwxz2GRk2w7AnAURZBiEOZgyEQDAQAjmEJqTpNd3V1V3Vmd+/6utKV7/1vnpVXd2p/zn3vOV+27vfu/fd/W3QQAPrBZqbm7fJZrN79vf3T+/r67uf4wO9vb37WXQDIwWtra0Tenp6voQTv5XP56/BkfcR3iLk1g6B7hEeI+zP5V+ZiAbqBZ2dnZ8lV+6Gg87CobfhpOc4byf0FjwYE9DneBkWcXrM2tmzNzTxDdQKJPyETCazI46YgiMuI9zJuXJltuChFIHsP/PSfIfTjU19A2mira1tcxy3ey6XO5vEnkV4kes11XBmENDVj97XOT2O03FmWgMuoNLzGRJva8IUnPkzjjcT/kLoKCZzfQB7XiX8M2G8md7AUJgzJ+Z6e88gZ1xGuj3HsY17PcVkrG9gp7CUF/F8PUvxqdZDrFq1ahNVfKjwTCYxZuDE2wjKlc2WViMePM+HPNsFPOdf22OPblD5OZQHvphnV65cjTMzxaQY3eA5V9OO/hmnm1lSjE7woFsQbiXki4++foHnXkW4mLC1JUl947333tsMY3emqfB9jtPJlXN5U0+bOXPmWCPxgOccSy4+AfqPio+9/oFnbyatbqVE28GSZfjQ1NT0KQzaHMcdyPfyaNoE12HcvdxT29K3Fkv8A2vWrPmcifAFZNtD91yRY+SBZ+9UsMtEgD+jTpeenp6JXI6xpKkuUDqRcA6Kr0Wpens+InQTnIpV6Fdi+BQT64ulS5eOIzefD62na7CeoGcnLCM8ykt5OWlzcPv772/BS/w3nP+K+xU11+DvQe5dcrQlTfWAwbNMb8XA8AyGX80xtLlA6TAJuteMbVhhia1v5VMcr+LWMeoZ4xiYw7q6urbhHbgG+paCkIRQehHu4pO3O5fVydEomF5Ulx548JfVD2wqfKE2I3R3ob/f2GoC1DWhdz7HG3i5j2pvb9+Z24m6HvVZQtYsZFWcowlzePEP4jJdR/OQhxTVpAs9NMXxmZxuZKo8IG4s+v8R2tUFphSBTBWzH+OAFwn/gS3TuN55xYoVqfc6dXd3fwHZ1xFaTX0iyGbwjJqXXAammxP00EXx6UMGEx7ram7+vKnzBZ/87Xiwp40tEdDTgYwlHG/CmadSjO7L+XiialOZAej7POFG2VK0Khngl6Pn8/LL0YEtlFh4n8oDAqvaAYH8tzH2iNDm1IIFn8Ax50G7xtgCAU07CfAG4RHOz+vLZL7e0dGxlYlKHaj8BHo25xgrsfV5wrYH4KmouxV+ZZDnCUdwmXxMGgFvFUVWD+jQuOot6rI0tb4gcfaG9v+MrcAn+wj38gL8C7cObmlp2ZRjOkWYD6ypuAf6zjFHLSJ0c/6YQ813DM/yZXgehreiVgP8cvSfsOeExYsXuzs6n8v9j8mqBRZQmdjXVPuira1NHSpn8UDf4Xu0vd2uCtDzacJOlDDf5ng94X8JTWarB8R1EK7ju7udiYgEz/v3pLFKm4oHUHhh3iZdfshpaEYpA4pvKLLXBujLYKRq71XLhUHg27z12rW9B6L/QhLrWWxRH7nzeDK8awi/5HRTEx0K6MZQ694LHk0DqrgfADkreIYz1q5c+UlTEQzesIuMryrggYQWjNL3RGO7p2tuFMeqjaOidgzyCz1yJMTJ6L6d66WEVCcHIO/dQkI75Chs2g97Hoc3jRz9Lge1ED5l4r0gckqRPB0gTw34t1B+h3IqxZkmrn2SULUa7ezZszdE5xfR9130Xsm5ilrnHrmkQOcKvrkncxqrIiY6wlewbw7BOUfDo/b84zzvj9C7J7eCS0NrUiRKCPjUE7ScMBdlF/B2HqBi0ERXBcuXL99YnQz9fX2ah3Up4UnsWGEmDRuUhoTn+Z5PfvbZZ2N/fuCZRJgnfhNVBu73EZoIKt7l0L2UBsYeDZg016nb5EUCWuXQewinUtTuyq2aTStF14a8SD+VDQVj6hDYxjuXf4Hjl83sSMCmTp8j4FtoMuRQ5dAZcii3kk/0s2bBhxIcBxjxUlib1hWInEDO/6qKV+y4geO5HAMntEE/pq+nZyo0ywsG1SmwL4Orf+0yqGCfmvR73LAn9lAeBjQTEhkA+1h49a08iRflcq4H5iuXFU9cz4lqihC/LXS/NZa6Bc+pz5gql5ub6VXD2tZWTSPeyS7XgeLhXrMnEhj6MSHSwaIhFGZH8oA/JzzFeexvJbRN2HW03moT6cEChx6w4QY2rurn85JWrxsiCy0FwjcIqos8w7GZNPulkawDEbFHlaBtjzODEDrVztuKXMmADPWA3RaljyJeNdKq98ilAez8iJdyGqfO31V4NoV/EvyaCqR54V2EshE5Lqcb+TrkstkTLD4WKB4PNNZQ8P05HAelMXNSPWChC8JsYvwthJo0jSoF6fIqjjqe08Aat+LIkd+AVjn09zxbZFqK3tjXAUbXUaWDjTUSyN4J45YZX2Igo4cEOVfFson2ALIxSjR0jog5YNgpfNHM90BxIjDyWIB8Z2NfB01HISJ20wPaw4w1FlavXq1v8aPGXhFw9JNRFTDItifU/RwwpfmKxYsDK180kU4x0lhAXvOSJUs+bezlIDL2N4xi4GpjK4MGCuzUA+SPxzn3m4iKgKyV2DCV08DeMWg0B+zHHOt2DpjS3Mz1BfFOM25C5ZH4LxldJBB0g7GVARkaXgv8VsKqZtIMPpN9RUnJgRzU5Wfp22vifcG3+2vQvmdsdQXsX2pm+oKX+GYjjQXkPWqsXshpRhcJ0RpbGShSHiSuheP37ZYHsGusVHOrU1lMxkO9od4eE+8LlSzQqfetpnPAooBN/2Um+gISp89MkF8K4G3RrMJYoOhbYGxlQEGhSOGogfoLwipExGtUZVVBYIVAluaAaUpuWA+YujlPF22Ra/iBLYEOsV6tV4w0FiitfmLsXiBMU0NiAVrfsp77Zd8MHPgbDoHtva6uLs1jiv1piAKy5tCG+4KJ9wVO/p6RDzvy+b5rzSwP9Okh/WKPERiCWzfk4K8bUSTiOljAyCdx5DZG4gE8W5Dov+NYUfsV/j50fUC4dmXIQDh0qQ6PVgJsOcLM8oA410Ggvo6Ojr81di+g2TKuQOiyJOKWxlpCJpM5zUjKAL3awTsamQfEbYhjtDGKa5tPsyn/wAuiURftlBO56h6aunEwCMxxvV1d+2Fr7Jce2vAu5LUtLeoGi/19gtbToCaR97BoD6BvUs+WkXqgbw6OuhC6wH5l4rRGaCFOvYnjYbyxnpcsCvDVhYOxo6+zszNwSNHVTtJEmSiwzlMAQmNPwIPW42Dds2hfEK/5WJo0Fth+5VNxFHSlkoTzFRh/N3wnq0OGWxXtdoO8enFwaI4jsyidYgNZTxhrMEjEJ4w+En65ESWRXZ7Q4K/COqDAPlhka87WedB8KawmngTIHREOJs5pMiRp+p/GGgxL1FiA9hxjK6G1tVVdhJGAV15+cPXq1f7dahVC20Wg4miCp0uTe3Xh4Hwu93rY1B7SR/t7xQbP5R1FGgpy8IlKe+MJhZ9Aa7u5jPm+pGLX2BMDOZ+hDXgQiXIJ5xoXHZg96anEEFcvOTi0SMUXS4w0FijSTzTWYEA3hkTSEtDI2qw6RoytDLA6jctCvzKqJ8oPFOO7kAhnYe9cZGiWiZ/N9ezguWaSL4h3TUfvKJIfoN0I4sjigYSdZyxlcDVMgEczEY41ER6oZFBOh2Yqegf2zYoziFC3DuZZrjSTPLDtMlxaNPmPP/54W2OPxksrVozP5fLPGr8vEOpbxJCr3jQSJyDvGRNRhv7iHh8vE5LMpKznHBz4zSTOaXwe+mXGGh9tbWvVQf+iyfCAON/ZlTj4v43ECfB94Le4CuMrWVpTtw7O9fZOM5M8oD7xVSOLBdLuNWN1g7bgJUF8+4qpBjf7Te9M6hD4tBDc0289Wh2MHbuaSR7gsHOMLBaQ9W/G6o5MJrNDPu9dcYdQ33Yc95I6OFV5hnp2cGCliDingX5KU+9MShd0dmqta/k8J4zwnV2JsuuNxAnI83VwNpO52kiSoC4djA255cuXBzYPycGzjTQWkPdNY00OfRcQVLafRnd39ySLLsG1i20AyPZ3cDb7AyNJgnp1cOhUHUhcFiL045v9jTUa8Gjlm29fsQQhb3DzJLUEhC+oiK7EISPOwapoEh+7JQJti5YfGXs0YNC62ouC1h9lsrlToClsjc/RM7uSe0kd3EmlzTO/Kqk8Q106mM/Yw2aOB9jnOg6sWTHxJ9FraSJMy6nGz7RbZUDYmN7e3BnQ5Gisez7u3J9c0JwA6Pb0aCFvNObgwKk6NoU59uJwaJ8y1viAT4vCtEFXYO8SFQGtCZpllyXQtNqL+4lmZ/BN/5qJKQFZozEHe9JtAGSaw4wsFnie4JmUQcjleh8yZq0Fnmq3y0D02IzPMgnonYqYIfA4pC+TcXrgIahLB+PEb5s5HrjaR0b7kbHGB0pK7TDO1/T39x1lUZGAPlUH0xTbz+KSoC4dDDx2DQCHzTCaWOB5zjbW+KCSpW0IS0BIJmy6zWCk7WDuxZ4r5oO6dHB7e/sBZo4H2OfUsYOv9jHW+ECJdkAtA/c6MpmMd+XaEKj7km9M4F5TEfBzSKovDLKG1cHobw+b6EDa3WOksYBPAhevBUJMxl8GJTRhFyMLBKSJFn5ls9nvmogS0DfaHOzb3h8AcUuNNBLQNiWa0gRv4MwMMyBwCqxAfCIH82JdYSJKQN+ocjA5NHD2I/e1aj/23iPyhbG6A+bAgXsZoUEII/UAkkQORu71JqIE7o22HBw4VaelpWU74mPPDc/39d1trO5Qb4vJ8QXxbwat06WofcTInMCzeToAtN4VXUn/l1AXDkan9tDSfmL6C81BZooHxDkN9CMveLFZFFAWWZtDwVta3G0sJcAbe3bmYEiniShBXabcL+wflQDD5mD0yKlvk0b/Tk33AG5F7idG+/ibRe54oEl1nLG6A+ZYe1jyAIuG/u2LB3MazxwAfL5vJFGJinxQUwcju6c/n3+FNPm5JhJyy2k/sQTp5nm+2HBJCGi1X1WpwzuBoQXAN+IcjDz8mdePKi/WhH1uxd7GcCjIVBcWpUYDfZ0VbclEJSr2akMBhVrdX6j+Jx3DpSh7vKB8CIiqKwcrcXGqdr05k3RKbU9ryTQVkUB3aHMrEshw7kGCXiv8xxG0h6Uzent6Fpn6MhA17A6GT/3yTxNO1coJbgWur3JFf1fXNuTes5AZe18xXobFHJKv04JZc3O7CtIcgGL9KW03u3QCfL4D4b292dhrpoYgsYOhEz4kaOuHqXKqiagYiN9QnUlyKgX84JUYsQFP9GKzMFRSe8XJb9upE9Dn62CK/KQT75wdTLz+NXgPNdrDuYzeUd0ByN4Wp07n+EdCRZuTY1/ymZQDwIjQye9pA32xdw6IiUgHc639mN8kzCLRjkxzQRzitUpkZ8LZBP1CILUd55EVvdgsCrzJl5i8mgCja+Zgjst4Pq3DUnMmtSWqyNIuQruRU3+CbO08n+pvBAZAjf1IU5kcGJc0YRMBfVV3MPd2RN4+YbvYukI/3sSpe+LUmbw0ryG/6ts1oSLeYrMw6C0xeaFAGc+Wq3hbfeRk582b55lrzf3UHJwWkD0Wp+6BQ3+BfXEXw6UCdHX4TVB0BoJi9Y1Cp59XbUWN8HW7lRjLli3zbINE+1hNiCRI1cGakIhT99ani/A6z1z1nDoUqNQfbO40kyqDfrCBwMg3E5rsCy+8sFlHR8dEnFzRTq/I8hQ9NFFOtGhXVOxgFeUqfknUK7Ctpjl1ANKJ/vmUkvrdwRZmWjpA4J9MTyja2toKY8TQa/ufxP/Whdd5c5cQJHIwfBsTvkKiaqd6/fRyOHKqavdL0H+V2sxmWvrQCAeKItfmQlNyDG/8SVwnetMHyxmA7lm0K2I7GFrlVBW/V6FPP9GqeU4V0Kt2+O2yhctUN6AJBEWD9ngMnessJxh5AfCoQe+8q+xQOYLuWbQrQh2MXP1XYh8S9DKC2sI1z6kCatW3/RCZ6Vj9fNPMqx2wQVNJQlcNEl/mGG5pv48bi7HxMVSOoHsW7QqPg5GlvnJtk6/B9+HMqYUfaXE6rampqWy4dVhgi8FfLprnBXEex+i/wCSkNiSNDSpUxxt7Ccj2nQQYAwUHc9yE3HEotuifDklnfFYMdGNC/lWCxotDf4PvB/jHZTs71c+f2n+ryqCPPcb5/pKdGrTvbH2MUjH4ByOLBDpON9YSFi5cuI1FOwFbbyTox5T6y+iwFL8CqvWvwVtolWgSv/N4sXbl5ZP3r8hRLT50d56KgYJDCYXVhYOhtqqReKDdZuGJtSQSOk8f67x581SspvH3lpoBe9Vefbg/lzveaXmnAf6tEDMNGRp3LnV3ch29o10lQIf+bOKZc+XnmMGARF2EK4vUwQiSw33n7ZlqDWwcaK9Ob29vd26vwj+OT8m3kKFxdd9tlILSJ1Wo8Y8RZT/YiKOY4le5P3SGZJAc7telg7FroL16Jc/n/a1cBBCxsSblwT8LOfofcCh4AQ4x1uoCXZtgVKnYDXLMUECnPSQD29VBcrhfVw7GHrVXb6WylGg0SvUZcrr+YPYuwWVfaE9ltmpA2Q6EQq2UY+yigzf2oqCH4v4MIysD94fdwdig9uqDnB4T5/d+gwHPGNVFcOopyJiPLOfmGTwa0Ek8qS8RKDKORLFWH95utwbDd94SRqqN/Cv4PDXbTFfXfUZWBvRUPJCRBJiIqfnnccy0Dz74wHkWoypY2D4ZGU8gK+kKjQKQ8RcTW1uQI2fmc7nH7LIMFEW+sw6xdyN4CgvNByNIDjp+ZyRVhzlV7dVLaZc7t1cRoW0w9of/No6ptbuRdZupqC3QPZY33HchMkbJiRPssgyaHkN82XaJXPtOJuN+JRuixQI6Cu1VXiZtJehcFGpeNPyXI6cqPWTIvsxU1R7o912akevre4OHfTHot3fEfRbD3y8+Qu0djO5Ce5UXNGl7dTt4z0RGqnOuhgLZgmcPk2FHrrd3jgwkAVQ58e1ioxjcHeMLPWQcq+5gZKm9+hJHjXo5z4xQBQsxxyDjEfir+nNq5GfQo/nYh6f9e4NUgGEFx3DEzvw1nPrOhSJ+kh6GUBUHw6//Kmls96dJ2qv6FxNF9z8g405kVLVXDfkaiFAd4JIkttYUGFpyDOf91Ch/YVEe8DA/gORpuywDfLNMjBOQt4qEupbTPTX4YeJig+/qrnoxkfMeIdH2UHGBfP0H6kFepElc1rY5lBQYXZbzuO7BWYH7b3V3d/+TX1FEG/JSExEJdOi7qsnrx3DuNM8Zdg2NqnN/BjK0EXlVhxORr56wP6Lv/DT+X1FzYLynaOWe2s1TjCQW4An9t6Jk4hBVdH6YpB9YNXoS+SRk/JaQZHd5J2CnesLuyGaze3KZ2hTemoNcpO+uB3pAQuzvC7SeJSfc0258Wo97aX9PT+TmMEMB73jsO0wJzXnVx4llL7pe5kWaFtSqGHHgu6rpPr5jsdx+hyI59G+hA4C25GDO1V69mbf/77h0+lZpzZX44B+Ye1X1cWKz92pKrYlcjtzc6gfN+ufhApd/ErcwTvuTRNI0m4c4Tg77u6gfbCHdTuQcrRFaRKiFU7Xl1O/RqX9RObevRxR43gmEBYUn9wEJIMeF/jk0yVKTta2tE0jg43kx1OatWifEYKDrHYKGDnfkMrU1xHUPaoh7k8i+030EvoV3c6i4aTCoc/9+9NVkFgh6BmZFaig08he3oxYkwBEkQGCzg7gfG6kzaDvuSyLfgIyqt1cF6SAspoS4iJf3c9xaf3JrGEgUzZcOGgvO4agzjTQUkI9V5z4851MuLhBvUUp1gR7tjXEHL+shXFZnduNIBomi6T73FVLLByQePu4N3CxMbVxyzfeQUTYZrdpA3yvoPVf/1jdTGggC6aXx0ieLSecFcWoj72vkhU4IcswU7gVORksb6FHnufbouJ4Xbv+gf1g0EADav9uSeO9YenpA3IfURFVZ0gqEms1rRg0qCzM4TuYy1T061jt0dXXpX0xJ96FMDXIqQXtJ3tSfze6OaY0KU1ogfTUgUJMK0lBIL06dS/F/LJeRe0k2kAAk7BgSWN2GVW/aCOjRuPCbBHVGBG6J3ECKIN3VlfjroguqA+RrMsFvCNqisf5mRox2qPlB4s8vuiMdIE/fVjVvLlRnhKlqYLig7QIpOiva40PAqR2E22neJFrN10AVgWMOIDgPuMOjmRFa+HVaR0fHliaugXoEOe80nBWrZg2dZkZoYffuaW5u1kCVkadmbT70AGdqJodWOhxHqP2eFg1UDvsLatnSFq41M+KKnp6eXbhsdB2OdGiCeX8+/2ecqgnmk/VXNYtqYLSAnNposzpjgw3+H/belpVa8J7TAAAAAElFTkSuQmCC",
                        t.style.position = "absolute",
                        t.style.left = "50%",
                        t.style.top = "50%",
                        t.style.marginLeft = "-60px",
                        t.style.marginTop = "-60px",
                        t.style.animation = "spin1 2s infinite ease-in-out",
                        t.style.webkitAnimation = "spin1 2s infinite ease-in-out",
                        t.style.transformOrigin = "50% 50%",
                        t.style.webkitTransformOrigin = "50% 50%",
                        this._loadingDiv.appendChild(t),
                        this._resizeLoadingUI(),
                        window.addEventListener("resize", this._resizeLoadingUI),
                        this._loadingDiv.style.backgroundColor = this._loadingDivBackgroundColor,
                        document.body.appendChild(this._loadingDiv),
                        this._loadingDiv.style.opacity = "1"
                    }
                }
                ,
                e.prototype.hideLoadingUI = function() {
                    var e = this;
                    if (this._loadingDiv) {
                        this._loadingDiv.style.opacity = "0",
                        this._loadingDiv.addEventListener("transitionend", (function() {
                            e._loadingDiv && (document.body.removeChild(e._loadingDiv),
                            window.removeEventListener("resize", e._resizeLoadingUI),
                            e._loadingDiv = null)
                        }
                        ))
                    }
                }
                ,
                Object.defineProperty(e.prototype, "loadingUIText", {
                    get: function() {
                        return this._loadingText
                    },
                    set: function(e) {
                        this._loadingText = e,
                        this._loadingTextDiv && (this._loadingTextDiv.innerHTML = this._loadingText)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "loadingUIBackgroundColor", {
                    get: function() {
                        return this._loadingDivBackgroundColor
                    },
                    set: function(e) {
                        this._loadingDivBackgroundColor = e,
                        this._loadingDiv && (this._loadingDiv.style.backgroundColor = this._loadingDivBackgroundColor)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e
            }();
            e.DefaultLoadingScreen = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e(e, t, r) {
                    this.lengthComputable = e,
                    this.loaded = t,
                    this.total = r
                }
                return e.FromProgressEvent = function(t) {
                    return new e(t.lengthComputable,t.loaded,t.total)
                }
                ,
                e
            }();
            e.SceneLoaderProgressEvent = t;
            var r = function() {
                function r() {}
                return Object.defineProperty(r, "ForceFullSceneLoadingForIncremental", {
                    get: function() {
                        return r._ForceFullSceneLoadingForIncremental
                    },
                    set: function(e) {
                        r._ForceFullSceneLoadingForIncremental = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "ShowLoadingScreen", {
                    get: function() {
                        return r._ShowLoadingScreen
                    },
                    set: function(e) {
                        r._ShowLoadingScreen = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "loggingLevel", {
                    get: function() {
                        return r._loggingLevel
                    },
                    set: function(e) {
                        r._loggingLevel = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "CleanBoneMatrixWeights", {
                    get: function() {
                        return r._CleanBoneMatrixWeights
                    },
                    set: function(e) {
                        r._CleanBoneMatrixWeights = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r._getDefaultPlugin = function() {
                    return r._registeredPlugins[".babylon"]
                }
                ,
                r._getPluginForExtension = function(t) {
                    var i = r._registeredPlugins[t];
                    return i || (e.Tools.Warn("Unable to find a plugin to load " + t + " files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: http://doc.babylonjs.com/how_to/load_from_any_file_type"),
                    r._getDefaultPlugin())
                }
                ,
                r._getPluginForDirectLoad = function(e) {
                    for (var t in r._registeredPlugins) {
                        var i = r._registeredPlugins[t].plugin;
                        if (i.canDirectLoad && i.canDirectLoad(e))
                            return r._registeredPlugins[t]
                    }
                    return r._getDefaultPlugin()
                }
                ,
                r._getPluginForFilename = function(e) {
                    var t = e.indexOf("?");
                    -1 !== t && (e = e.substring(0, t));
                    var i = e.lastIndexOf(".")
                      , n = e.substring(i, e.length).toLowerCase();
                    return r._getPluginForExtension(n)
                }
                ,
                r._getDirectLoad = function(e) {
                    return "data:" === e.substr(0, 5) ? e.substr(5) : null
                }
                ,
                r._loadData = function(i, n, o, a, s, y, l) {
                    var c, h = r._getDirectLoad(i.name), u = l ? r._getPluginForExtension(l) : h ? r._getPluginForDirectLoad(i.name) : r._getPluginForFilename(i.name);
                    c = u.plugin.createPlugin ? u.plugin.createPlugin() : u.plugin;
                    var d, x = u.isBinary;
                    r.OnPluginActivatedObservable.notifyObservers(c);
                    var p = function(e, t) {
                        n.isDisposed ? s("Scene has been disposed") : (n.database = d,
                        o(c, e, t))
                    }
                      , f = null
                      , m = !1
                      , z = c.onDisposeObservable;
                    z && z.add((function() {
                        m = !0,
                        f && (f.abort(),
                        f = null),
                        y()
                    }
                    ));
                    var _ = function() {
                        m || (f = e.Tools.LoadFile(i.url, p, a ? function(e) {
                            a(t.FromProgressEvent(e))
                        }
                        : void 0, d, x, (function(e, t) {
                            s("Failed to load scene." + (t ? " " + t.message : ""), t)
                        }
                        )))
                    };
                    if (h)
                        return p(h),
                        c;
                    if (-1 === i.rootUrl.indexOf("file:")) {
                        var g = n.getEngine()
                          , v = g.enableOfflineSupport;
                        if (v) {
                            for (var b = !1, T = 0, E = n.disableOfflineSupportExceptionRules; T < E.length; T++) {
                                if (E[T].test(i.url)) {
                                    b = !0;
                                    break
                                }
                            }
                            v = !b
                        }
                        v ? d = new e.Database(i.url,_,g.disableManifestCheck) : _()
                    } else {
                        var P = e.FilesInput.FilesToLoad[i.name.toLowerCase()];
                        P ? f = e.Tools.ReadFile(P, p, a, x) : s("Unable to find file named " + i.name)
                    }
                    return c
                }
                ,
                r._getFileInfo = function(t, r) {
                    var i, n;
                    if (r) {
                        if ("/" === r.substr(0, 1))
                            return e.Tools.Error("Wrong sceneFilename parameter"),
                            null;
                        i = t + r,
                        n = r
                    } else
                        i = t,
                        n = e.Tools.GetFilename(t),
                        t = e.Tools.GetFolderPath(t);
                    return {
                        url: i,
                        rootUrl: t,
                        name: n
                    }
                }
                ,
                r.GetPluginForExtension = function(e) {
                    return r._getPluginForExtension(e).plugin
                }
                ,
                r.IsPluginForExtensionAvailable = function(e) {
                    return !!r._registeredPlugins[e]
                }
                ,
                r.RegisterPlugin = function(e) {
                    if ("string" == typeof e.extensions) {
                        var t = e.extensions;
                        r._registeredPlugins[t.toLowerCase()] = {
                            plugin: e,
                            isBinary: !1
                        }
                    } else {
                        var i = e.extensions;
                        Object.keys(i).forEach((function(t) {
                            r._registeredPlugins[t.toLowerCase()] = {
                                plugin: e,
                                isBinary: i[t].isBinary
                            }
                        }
                        ))
                    }
                }
                ,
                r.ImportMesh = function(t, i, n, o, a, s, y, l) {
                    if (void 0 === n && (n = ""),
                    void 0 === o && (o = e.Engine.LastCreatedScene),
                    void 0 === a && (a = null),
                    void 0 === s && (s = null),
                    void 0 === y && (y = null),
                    void 0 === l && (l = null),
                    !o)
                        return e.Tools.Error("No scene available to import mesh to"),
                        null;
                    var c = r._getFileInfo(i, n);
                    if (!c)
                        return null;
                    var h = {};
                    o._addPendingData(h);
                    var u = function() {
                        o._removePendingData(h)
                    }
                      , d = function(t, r) {
                        var i = "Unable to import meshes from " + c.url + ": " + t;
                        y ? y(o, i, r) : e.Tools.Error(i),
                        u()
                    }
                      , x = s ? function(e) {
                        try {
                            s(e)
                        } catch (e) {
                            d("Error in onProgress callback", e)
                        }
                    }
                    : void 0
                      , p = function(e, t, r, i) {
                        if (o.importedMeshesFiles.push(c.url),
                        a)
                            try {
                                a(e, t, r, i)
                            } catch (e) {
                                d("Error in onSuccess callback", e)
                            }
                        o._removePendingData(h)
                    };
                    return r._loadData(c, o, (function(e, r, i) {
                        if (e.rewriteRootURL && (c.rootUrl = e.rewriteRootURL(c.rootUrl, i)),
                        e.importMesh) {
                            var n = e
                              , a = new Array
                              , s = new Array
                              , y = new Array;
                            if (!n.importMesh(t, o, r, c.rootUrl, a, s, y, d))
                                return;
                            o.loadingPluginName = e.name,
                            p(a, s, y, [])
                        } else {
                            e.importMeshAsync(t, o, r, c.rootUrl, x, c.name).then((function(t) {
                                o.loadingPluginName = e.name,
                                p(t.meshes, t.particleSystems, t.skeletons, t.animationGroups)
                            }
                            )).catch((function(e) {
                                d(e.message, e)
                            }
                            ))
                        }
                    }
                    ), x, d, u, l)
                }
                ,
                r.ImportMeshAsync = function(t, i, n, o, a, s) {
                    return void 0 === n && (n = ""),
                    void 0 === o && (o = e.Engine.LastCreatedScene),
                    void 0 === a && (a = null),
                    void 0 === s && (s = null),
                    new Promise((function(e, y) {
                        r.ImportMesh(t, i, n, o, (function(t, r, i, n) {
                            e({
                                meshes: t,
                                particleSystems: r,
                                skeletons: i,
                                animationGroups: n
                            })
                        }
                        ), a, (function(e, t, r) {
                            y(r || new Error(t))
                        }
                        ), s)
                    }
                    ))
                }
                ,
                r.Load = function(t, i, n, o, a, s, y) {
                    return void 0 === o && (o = null),
                    void 0 === a && (a = null),
                    void 0 === s && (s = null),
                    void 0 === y && (y = null),
                    r.Append(t, i, new e.Scene(n), o, a, s, y)
                }
                ,
                r.LoadAsync = function(e, t, i, n, o) {
                    return void 0 === n && (n = null),
                    void 0 === o && (o = null),
                    new Promise((function(a, s) {
                        r.Load(e, t, i, (function(e) {
                            a(e)
                        }
                        ), n, (function(e, t, r) {
                            s(r || new Error(t))
                        }
                        ), o)
                    }
                    ))
                }
                ,
                r.Append = function(t, i, n, o, a, s, y) {
                    if (void 0 === i && (i = ""),
                    void 0 === n && (n = e.Engine.LastCreatedScene),
                    void 0 === o && (o = null),
                    void 0 === a && (a = null),
                    void 0 === s && (s = null),
                    void 0 === y && (y = null),
                    !n)
                        return e.Tools.Error("No scene available to append to"),
                        null;
                    var l = r._getFileInfo(t, i);
                    if (!l)
                        return null;
                    r.ShowLoadingScreen && n.getEngine().displayLoadingUI();
                    var c = {};
                    n._addPendingData(c);
                    var h = function() {
                        n._removePendingData(c),
                        n.getEngine().hideLoadingUI()
                    }
                      , u = function(t, r) {
                        var i = "Unable to load from " + l.url + (t ? ": " + t : "");
                        s ? s(n, i, r) : e.Tools.Error(i),
                        h()
                    }
                      , d = a ? function(e) {
                        try {
                            a(e)
                        } catch (e) {
                            u("Error in onProgress callback", e)
                        }
                    }
                    : void 0
                      , x = function() {
                        if (o)
                            try {
                                o(n)
                            } catch (e) {
                                u("Error in onSuccess callback", e)
                            }
                        n._removePendingData(c)
                    };
                    return r._loadData(l, n, (function(e, t, i) {
                        if (e.load) {
                            if (!e.load(n, t, l.rootUrl, u))
                                return;
                            n.loadingPluginName = e.name,
                            x()
                        } else {
                            e.loadAsync(n, t, l.rootUrl, d, l.name).then((function() {
                                n.loadingPluginName = e.name,
                                x()
                            }
                            )).catch((function(e) {
                                u(e.message, e)
                            }
                            ))
                        }
                        r.ShowLoadingScreen && n.executeWhenReady((function() {
                            n.getEngine().hideLoadingUI()
                        }
                        ))
                    }
                    ), d, u, h, y)
                }
                ,
                r.AppendAsync = function(t, i, n, o, a) {
                    return void 0 === i && (i = ""),
                    void 0 === n && (n = e.Engine.LastCreatedScene),
                    void 0 === o && (o = null),
                    void 0 === a && (a = null),
                    new Promise((function(e, s) {
                        r.Append(t, i, n, (function(t) {
                            e(t)
                        }
                        ), o, (function(e, t, r) {
                            s(r || new Error(t))
                        }
                        ), a)
                    }
                    ))
                }
                ,
                r.LoadAssetContainer = function(t, i, n, o, a, s, y) {
                    if (void 0 === i && (i = ""),
                    void 0 === n && (n = e.Engine.LastCreatedScene),
                    void 0 === o && (o = null),
                    void 0 === a && (a = null),
                    void 0 === s && (s = null),
                    void 0 === y && (y = null),
                    !n)
                        return e.Tools.Error("No scene available to load asset container to"),
                        null;
                    var l = r._getFileInfo(t, i);
                    if (!l)
                        return null;
                    var c = {};
                    n._addPendingData(c);
                    var h = function() {
                        n._removePendingData(c)
                    }
                      , u = function(t, r) {
                        var i = "Unable to load assets from " + l.url + (t ? ": " + t : "");
                        s ? s(n, i, r) : e.Tools.Error(i),
                        h()
                    }
                      , d = a ? function(e) {
                        try {
                            a(e)
                        } catch (e) {
                            u("Error in onProgress callback", e)
                        }
                    }
                    : void 0
                      , x = function(e) {
                        if (o)
                            try {
                                o(e)
                            } catch (e) {
                                u("Error in onSuccess callback", e)
                            }
                        n._removePendingData(c)
                    };
                    return r._loadData(l, n, (function(e, t, i) {
                        if (e.loadAssetContainer) {
                            var o = e.loadAssetContainer(n, t, l.rootUrl, u);
                            if (!o)
                                return;
                            n.loadingPluginName = e.name,
                            x(o)
                        } else if (e.loadAssetContainerAsync) {
                            e.loadAssetContainerAsync(n, t, l.rootUrl, d, l.name).then((function(t) {
                                n.loadingPluginName = e.name,
                                x(t)
                            }
                            )).catch((function(e) {
                                u(e.message, e)
                            }
                            ))
                        } else
                            u("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.");
                        r.ShowLoadingScreen && n.executeWhenReady((function() {
                            n.getEngine().hideLoadingUI()
                        }
                        ))
                    }
                    ), d, u, h, y)
                }
                ,
                r.LoadAssetContainerAsync = function(t, i, n, o, a) {
                    return void 0 === i && (i = ""),
                    void 0 === n && (n = e.Engine.LastCreatedScene),
                    void 0 === o && (o = null),
                    void 0 === a && (a = null),
                    new Promise((function(e, s) {
                        r.LoadAssetContainer(t, i, n, (function(t) {
                            e(t)
                        }
                        ), o, (function(e, t, r) {
                            s(r || new Error(t))
                        }
                        ), a)
                    }
                    ))
                }
                ,
                r._ForceFullSceneLoadingForIncremental = !1,
                r._ShowLoadingScreen = !0,
                r._CleanBoneMatrixWeights = !1,
                r.NO_LOGGING = 0,
                r.MINIMAL_LOGGING = 1,
                r.SUMMARY_LOGGING = 2,
                r.DETAILED_LOGGING = 3,
                r._loggingLevel = r.NO_LOGGING,
                r.OnPluginActivatedObservable = new e.Observable,
                r._registeredPlugins = {},
                r
            }();
            e.SceneLoader = r
        }(s || (s = {})),
        function(e) {
            var t = function(t, r, i, n) {
                for (var o = 0, a = r.materials.length; o < a; o++) {
                    var s = r.materials[o];
                    if (s.id === t)
                        return e.Material.Parse(s, i, n)
                }
                return null
            }
              , r = function(e, t, r) {
                for (var i in t)
                    if (e.name === t[i])
                        return r.push(e.id),
                        !0;
                return !(!e.parentId || -1 === r.indexOf(e.parentId)) && (r.push(e.id),
                !0)
            }
              , i = function(e, t) {
                return e + " of " + (t ? t.file + " from " + t.name + " version: " + t.version + ", exporter version: " + t.exporter_version : "unknown")
            }
              , n = function(t, r, n, o, a) {
                void 0 === a && (a = !1);
                var s = new e.AssetContainer(t)
                  , y = "importScene has failed JSON parse";
                try {
                    var l = JSON.parse(r);
                    y = "";
                    var c, h, u = e.SceneLoader.loggingLevel === e.SceneLoader.DETAILED_LOGGING;
                    if (void 0 !== l.lights && null !== l.lights)
                        for (c = 0,
                        h = l.lights.length; c < h; c++) {
                            var d = l.lights[c]
                              , x = e.Light.Parse(d, t);
                            x && (s.lights.push(x),
                            y += 0 === c ? "\n\tLights:" : "",
                            y += "\n\t\t" + x.toString(u))
                        }
                    if (void 0 !== l.animations && null !== l.animations)
                        for (c = 0,
                        h = l.animations.length; c < h; c++) {
                            var p = l.animations[c]
                              , f = e.Animation.Parse(p);
                            t.animations.push(f),
                            s.animations.push(f),
                            y += 0 === c ? "\n\tAnimations:" : "",
                            y += "\n\t\t" + f.toString(u)
                        }
                    if (void 0 !== l.materials && null !== l.materials)
                        for (c = 0,
                        h = l.materials.length; c < h; c++) {
                            var m = l.materials[c]
                              , z = e.Material.Parse(m, t, n);
                            s.materials.push(z),
                            y += 0 === c ? "\n\tMaterials:" : "",
                            y += "\n\t\t" + z.toString(u)
                        }
                    if (void 0 !== l.multiMaterials && null !== l.multiMaterials)
                        for (c = 0,
                        h = l.multiMaterials.length; c < h; c++) {
                            var _ = l.multiMaterials[c]
                              , g = e.Material.ParseMultiMaterial(_, t);
                            s.multiMaterials.push(g),
                            y += 0 === c ? "\n\tMultiMaterials:" : "",
                            y += "\n\t\t" + g.toString(u)
                        }
                    if (void 0 !== l.morphTargetManagers && null !== l.morphTargetManagers)
                        for (var v = 0, b = l.morphTargetManagers; v < b.length; v++) {
                            var T = b[v];
                            s.morphTargetManagers.push(e.MorphTargetManager.Parse(T, t))
                        }
                    if (void 0 !== l.skeletons && null !== l.skeletons)
                        for (c = 0,
                        h = l.skeletons.length; c < h; c++) {
                            var E = l.skeletons[c]
                              , P = e.Skeleton.Parse(E, t);
                            s.skeletons.push(P),
                            y += 0 === c ? "\n\tSkeletons:" : "",
                            y += "\n\t\t" + P.toString(u)
                        }
                    var A = l.geometries;
                    if (null != A) {
                        var S = new Array
                          , M = A.boxes;
                        if (null != M)
                            for (c = 0,
                            h = M.length; c < h; c++) {
                                var C = M[c];
                                S.push(e.BoxGeometry.Parse(C, t))
                            }
                        var R = A.spheres;
                        if (null != R)
                            for (c = 0,
                            h = R.length; c < h; c++) {
                                var O = R[c];
                                S.push(e.SphereGeometry.Parse(O, t))
                            }
                        var I = A.cylinders;
                        if (null != I)
                            for (c = 0,
                            h = I.length; c < h; c++) {
                                var w = I[c];
                                S.push(e.CylinderGeometry.Parse(w, t))
                            }
                        var D = A.toruses;
                        if (null != D)
                            for (c = 0,
                            h = D.length; c < h; c++) {
                                var L = D[c];
                                S.push(e.TorusGeometry.Parse(L, t))
                            }
                        var B = A.grounds;
                        if (null != B)
                            for (c = 0,
                            h = B.length; c < h; c++) {
                                var F = B[c];
                                S.push(e.GroundGeometry.Parse(F, t))
                            }
                        var N = A.planes;
                        if (null != N)
                            for (c = 0,
                            h = N.length; c < h; c++) {
                                var V = N[c];
                                S.push(e.PlaneGeometry.Parse(V, t))
                            }
                        var k = A.torusKnots;
                        if (null != k)
                            for (c = 0,
                            h = k.length; c < h; c++) {
                                var U = k[c];
                                S.push(e.TorusKnotGeometry.Parse(U, t))
                            }
                        var G = A.vertexData;
                        if (null != G)
                            for (c = 0,
                            h = G.length; c < h; c++) {
                                var H = G[c];
                                S.push(e.Geometry.Parse(H, t, n))
                            }
                        S.forEach((function(e) {
                            e && s.geometries.push(e)
                        }
                        ))
                    }
                    if (void 0 !== l.transformNodes && null !== l.transformNodes)
                        for (c = 0,
                        h = l.transformNodes.length; c < h; c++) {
                            var W = l.transformNodes[c]
                              , j = e.TransformNode.Parse(W, t, n);
                            s.transformNodes.push(j)
                        }
                    if (void 0 !== l.meshes && null !== l.meshes)
                        for (c = 0,
                        h = l.meshes.length; c < h; c++) {
                            var X = l.meshes[c]
                              , Y = e.Mesh.Parse(X, t, n);
                            s.meshes.push(Y),
                            y += 0 === c ? "\n\tMeshes:" : "",
                            y += "\n\t\t" + Y.toString(u)
                        }
                    if (void 0 !== l.cameras && null !== l.cameras)
                        for (c = 0,
                        h = l.cameras.length; c < h; c++) {
                            var K = l.cameras[c]
                              , Q = e.Camera.Parse(K, t);
                            s.cameras.push(Q),
                            y += 0 === c ? "\n\tCameras:" : "",
                            y += "\n\t\t" + Q.toString(u)
                        }
                    if (void 0 !== l.animationGroups && null !== l.animationGroups)
                        for (c = 0,
                        h = l.animationGroups.length; c < h; c++) {
                            var Z = l.animationGroups[c]
                              , q = e.AnimationGroup.Parse(Z, t);
                            s.animationGroups.push(q),
                            y += 0 === c ? "\n\tAnimationGroups:" : "",
                            y += "\n\t\t" + q.toString(u)
                        }
                    for (c = 0,
                    h = t.cameras.length; c < h; c++) {
                        (Q = t.cameras[c])._waitingParentId && (Q.parent = t.getLastEntryByID(Q._waitingParentId),
                        Q._waitingParentId = null)
                    }
                    for (c = 0,
                    h = t.lights.length; c < h; c++) {
                        var J = t.lights[c];
                        J && J._waitingParentId && (J.parent = t.getLastEntryByID(J._waitingParentId),
                        J._waitingParentId = null)
                    }
                    for (c = 0,
                    h = t.transformNodes.length; c < h; c++) {
                        var $ = t.transformNodes[c];
                        $._waitingParentId && ($.parent = t.getLastEntryByID($._waitingParentId),
                        $._waitingParentId = null)
                    }
                    for (c = 0,
                    h = t.meshes.length; c < h; c++) {
                        (Y = t.meshes[c])._waitingParentId && (Y.parent = t.getLastEntryByID(Y._waitingParentId),
                        Y._waitingParentId = null)
                    }
                    for (c = 0,
                    h = t.meshes.length; c < h; c++) {
                        var ee = t.meshes[c];
                        ee._waitingFreezeWorldMatrix ? (ee.freezeWorldMatrix(),
                        ee._waitingFreezeWorldMatrix = null) : ee.computeWorldMatrix(!0)
                    }
                    for (c = 0,
                    h = t.lights.length; c < h; c++) {
                        var te = t.lights[c];
                        if (te._excludedMeshesIds.length > 0) {
                            for (var re = 0; re < te._excludedMeshesIds.length; re++) {
                                var ie = t.getMeshByID(te._excludedMeshesIds[re]);
                                ie && te.excludedMeshes.push(ie)
                            }
                            te._excludedMeshesIds = []
                        }
                        if (te._includedOnlyMeshesIds.length > 0) {
                            for (var ne = 0; ne < te._includedOnlyMeshesIds.length; ne++) {
                                var oe = t.getMeshByID(te._includedOnlyMeshesIds[ne]);
                                oe && te.includedOnlyMeshes.push(oe)
                            }
                            te._includedOnlyMeshesIds = []
                        }
                    }
                    for (e.AbstractScene.Parse(l, t, s, n),
                    c = 0,
                    h = t.meshes.length; c < h; c++) {
                        (Y = t.meshes[c])._waitingActions && (e.ActionManager.Parse(Y._waitingActions, Y, t),
                        Y._waitingActions = null)
                    }
                    void 0 !== l.actions && null !== l.actions && e.ActionManager.Parse(l.actions, null, t),
                    a || s.removeAllFromScene()
                } catch (t) {
                    var ae = i("loadAssets", l ? l.producer : "Unknown") + y;
                    if (!o)
                        throw e.Tools.Log(ae),
                        t;
                    o(ae, t)
                } finally {
                    null !== y && e.SceneLoader.loggingLevel !== e.SceneLoader.NO_LOGGING && e.Tools.Log(i("loadAssets", l ? l.producer : "Unknown") + (e.SceneLoader.loggingLevel !== e.SceneLoader.MINIMAL_LOGGING ? y : ""))
                }
                return s
            };
            e.SceneLoader.RegisterPlugin({
                name: "babylon.js",
                extensions: ".babylon",
                canDirectLoad: function(e) {
                    return -1 !== e.indexOf("babylon")
                },
                importMesh: function(n, o, a, s, y, l, c, h) {
                    var u = "importMesh has failed JSON parse";
                    try {
                        var d = JSON.parse(a);
                        u = "";
                        var x = e.SceneLoader.loggingLevel === e.SceneLoader.DETAILED_LOGGING;
                        n ? Array.isArray(n) || (n = [n]) : n = null;
                        var p = new Array;
                        if (void 0 !== d.meshes && null !== d.meshes) {
                            var f, m, z, _ = [], g = [];
                            for (f = 0,
                            m = d.meshes.length; f < m; f++) {
                                var v = d.meshes[f];
                                if (null === n || r(v, n, p)) {
                                    if (null !== n && delete n[n.indexOf(v.name)],
                                    void 0 !== v.geometryId && null !== v.geometryId && void 0 !== d.geometries && null !== d.geometries) {
                                        var b = !1;
                                        ["boxes", "spheres", "cylinders", "toruses", "grounds", "planes", "torusKnots", "vertexData"].forEach((function(t) {
                                            !0 !== b && d.geometries[t] && Array.isArray(d.geometries[t]) && d.geometries[t].forEach((function(r) {
                                                if (r.id === v.geometryId) {
                                                    switch (t) {
                                                    case "boxes":
                                                        e.BoxGeometry.Parse(r, o);
                                                        break;
                                                    case "spheres":
                                                        e.SphereGeometry.Parse(r, o);
                                                        break;
                                                    case "cylinders":
                                                        e.CylinderGeometry.Parse(r, o);
                                                        break;
                                                    case "toruses":
                                                        e.TorusGeometry.Parse(r, o);
                                                        break;
                                                    case "grounds":
                                                        e.GroundGeometry.Parse(r, o);
                                                        break;
                                                    case "planes":
                                                        e.PlaneGeometry.Parse(r, o);
                                                        break;
                                                    case "torusKnots":
                                                        e.TorusKnotGeometry.Parse(r, o);
                                                        break;
                                                    case "vertexData":
                                                        e.Geometry.Parse(r, o, s)
                                                    }
                                                    b = !0
                                                }
                                            }
                                            ))
                                        }
                                        )),
                                        !1 === b && e.Tools.Warn("Geometry not found for mesh " + v.id)
                                    }
                                    if (v.materialId) {
                                        var T = -1 !== g.indexOf(v.materialId);
                                        if (!1 === T && void 0 !== d.multiMaterials && null !== d.multiMaterials)
                                            for (var E = 0, P = d.multiMaterials.length; E < P; E++) {
                                                var A = d.multiMaterials[E];
                                                if (A.id === v.materialId) {
                                                    for (var S = 0, M = A.materials.length; S < M; S++) {
                                                        var C, R = A.materials[S];
                                                        g.push(R),
                                                        (C = t(R, d, o, s)) && (u += "\n\tMaterial " + C.toString(x))
                                                    }
                                                    g.push(A.id);
                                                    var O = e.Material.ParseMultiMaterial(A, o);
                                                    O && (T = !0,
                                                    u += "\n\tMulti-Material " + O.toString(x));
                                                    break
                                                }
                                            }
                                        if (!1 === T)
                                            g.push(v.materialId),
                                            (C = t(v.materialId, d, o, s)) ? u += "\n\tMaterial " + C.toString(x) : e.Tools.Warn("Material not found for mesh " + v.id)
                                    }
                                    if (v.skeletonId > -1 && void 0 !== d.skeletons && null !== d.skeletons)
                                        if (!1 === _.indexOf(v.skeletonId) > -1)
                                            for (var I = 0, w = d.skeletons.length; I < w; I++) {
                                                var D = d.skeletons[I];
                                                if (D.id === v.skeletonId) {
                                                    var L = e.Skeleton.Parse(D, o);
                                                    c.push(L),
                                                    _.push(D.id),
                                                    u += "\n\tSkeleton " + L.toString(x)
                                                }
                                            }
                                    if (void 0 !== d.morphTargetManagers && null !== d.morphTargetManagers)
                                        for (var B = 0, F = d.morphTargetManagers; B < F.length; B++) {
                                            var N = F[B];
                                            e.MorphTargetManager.Parse(N, o)
                                        }
                                    var V = e.Mesh.Parse(v, o, s);
                                    y.push(V),
                                    u += "\n\tMesh " + V.toString(x)
                                }
                            }
                            for (f = 0,
                            m = o.meshes.length; f < m; f++)
                                (z = o.meshes[f])._waitingParentId && (z.parent = o.getLastEntryByID(z._waitingParentId),
                                z._waitingParentId = null);
                            for (f = 0,
                            m = o.meshes.length; f < m; f++)
                                (z = o.meshes[f])._waitingFreezeWorldMatrix ? (z.freezeWorldMatrix(),
                                z._waitingFreezeWorldMatrix = null) : z.computeWorldMatrix(!0)
                        }
                        if (void 0 !== d.particleSystems && null !== d.particleSystems) {
                            var k = e.AbstractScene.GetIndividualParser(e.SceneComponentConstants.NAME_PARTICLESYSTEM);
                            if (k)
                                for (f = 0,
                                m = d.particleSystems.length; f < m; f++) {
                                    var U = d.particleSystems[f];
                                    -1 !== p.indexOf(U.emitterId) && l.push(k(U, o, s))
                                }
                        }
                        return !0
                    } catch (t) {
                        var G = i("importMesh", d ? d.producer : "Unknown") + u;
                        if (!h)
                            throw e.Tools.Log(G),
                            t;
                        h(G, t)
                    } finally {
                        null !== u && e.SceneLoader.loggingLevel !== e.SceneLoader.NO_LOGGING && e.Tools.Log(i("importMesh", d ? d.producer : "Unknown") + (e.SceneLoader.loggingLevel !== e.SceneLoader.MINIMAL_LOGGING ? u : ""))
                    }
                    return !1
                },
                load: function(t, r, o, a) {
                    var s = "importScene has failed JSON parse";
                    try {
                        var y = JSON.parse(r);
                        if (s = "",
                        void 0 !== y.useDelayedTextureLoading && null !== y.useDelayedTextureLoading && (t.useDelayedTextureLoading = y.useDelayedTextureLoading && !e.SceneLoader.ForceFullSceneLoadingForIncremental),
                        void 0 !== y.autoClear && null !== y.autoClear && (t.autoClear = y.autoClear),
                        void 0 !== y.clearColor && null !== y.clearColor && (t.clearColor = e.Color4.FromArray(y.clearColor)),
                        void 0 !== y.ambientColor && null !== y.ambientColor && (t.ambientColor = e.Color3.FromArray(y.ambientColor)),
                        void 0 !== y.gravity && null !== y.gravity && (t.gravity = e.Vector3.FromArray(y.gravity)),
                        y.fogMode && 0 !== y.fogMode)
                            switch (t.fogMode = y.fogMode,
                            t.fogColor = e.Color3.FromArray(y.fogColor),
                            t.fogStart = y.fogStart,
                            t.fogEnd = y.fogEnd,
                            t.fogDensity = y.fogDensity,
                            s += "\tFog mode for scene:  ",
                            t.fogMode) {
                            case 1:
                                s += "exp\n";
                                break;
                            case 2:
                                s += "exp2\n";
                                break;
                            case 3:
                                s += "linear\n"
                            }
                        if (y.physicsEnabled) {
                            var l;
                            "cannon" === y.physicsEngine ? l = new e.CannonJSPlugin : "oimo" === y.physicsEngine && (l = new e.OimoJSPlugin),
                            s = "\tPhysics engine " + (y.physicsEngine ? y.physicsEngine : "oimo") + " enabled\n";
                            var c = y.physicsGravity ? e.Vector3.FromArray(y.physicsGravity) : null;
                            t.enablePhysics(c, l)
                        }
                        if (void 0 !== y.metadata && null !== y.metadata && (t.metadata = y.metadata),
                        void 0 !== y.collisionsEnabled && null !== y.collisionsEnabled && (t.collisionsEnabled = y.collisionsEnabled),
                        t.workerCollisions = !!y.workerCollisions,
                        !n(t, r, o, a, !0))
                            return !1;
                        if (y.autoAnimate && t.beginAnimation(t, y.autoAnimateFrom, y.autoAnimateTo, y.autoAnimateLoop, y.autoAnimateSpeed || 1),
                        void 0 !== y.activeCameraID && null !== y.activeCameraID && t.setActiveCameraByID(y.activeCameraID),
                        void 0 !== y.environmentTexture && null !== y.environmentTexture) {
                            if (y.environmentTextureType && "BABYLON.HDRCubeTexture" === y.environmentTextureType) {
                                var h = y.environmentTextureSize ? y.environmentTextureSize : 128
                                  , u = new e.HDRCubeTexture(o + y.environmentTexture,t,h);
                                y.environmentTextureRotationY && (u.rotationY = y.environmentTextureRotationY),
                                t.environmentTexture = u
                            } else {
                                var d = e.CubeTexture.CreateFromPrefilteredData(o + y.environmentTexture, t);
                                y.environmentTextureRotationY && (d.rotationY = y.environmentTextureRotationY),
                                t.environmentTexture = d
                            }
                            if (!0 === y.createDefaultSkybox) {
                                var x = void 0 !== t.activeCamera && null !== t.activeCamera ? (t.activeCamera.maxZ - t.activeCamera.minZ) / 2 : 1e3
                                  , p = y.skyboxBlurLevel || 0;
                                t.createDefaultSkybox(void 0, !0, x, p)
                            }
                        }
                        return !0
                    } catch (t) {
                        var f = i("importScene", y ? y.producer : "Unknown") + s;
                        if (!a)
                            throw e.Tools.Log(f),
                            t;
                        a(f, t)
                    } finally {
                        null !== s && e.SceneLoader.loggingLevel !== e.SceneLoader.NO_LOGGING && e.Tools.Log(i("importScene", y ? y.producer : "Unknown") + (e.SceneLoader.loggingLevel !== e.SceneLoader.MINIMAL_LOGGING ? s : ""))
                    }
                    return !1
                },
                loadAssetContainer: function(e, t, r, i) {
                    return n(e, t, r, i)
                }
            })
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t, r, i, n, o, a, s, y) {
                    this.onProcessFileCallback = function() {
                        return !0
                    }
                    ,
                    this._engine = e,
                    this._currentScene = t,
                    this._sceneLoadedCallback = r,
                    this._progressCallback = i,
                    this._additionalRenderLoopLogicCallback = n,
                    this._textureLoadingCallback = o,
                    this._startingProcessingFilesCallback = a,
                    this._onReloadCallback = s,
                    this._errorCallback = y
                }
                return t.prototype.monitorElementForDragNDrop = function(e) {
                    var t = this;
                    e && (this._elementToMonitor = e,
                    this._dragEnterHandler = function(e) {
                        t.drag(e)
                    }
                    ,
                    this._dragOverHandler = function(e) {
                        t.drag(e)
                    }
                    ,
                    this._dropHandler = function(e) {
                        t.drop(e)
                    }
                    ,
                    this._elementToMonitor.addEventListener("dragenter", this._dragEnterHandler, !1),
                    this._elementToMonitor.addEventListener("dragover", this._dragOverHandler, !1),
                    this._elementToMonitor.addEventListener("drop", this._dropHandler, !1))
                }
                ,
                t.prototype.dispose = function() {
                    this._elementToMonitor && (this._elementToMonitor.removeEventListener("dragenter", this._dragEnterHandler),
                    this._elementToMonitor.removeEventListener("dragover", this._dragOverHandler),
                    this._elementToMonitor.removeEventListener("drop", this._dropHandler))
                }
                ,
                t.prototype.renderFunction = function() {
                    if (this._additionalRenderLoopLogicCallback && this._additionalRenderLoopLogicCallback(),
                    this._currentScene) {
                        if (this._textureLoadingCallback) {
                            var e = this._currentScene.getWaitingItemsCount();
                            e > 0 && this._textureLoadingCallback(e)
                        }
                        this._currentScene.render()
                    }
                }
                ,
                t.prototype.drag = function(e) {
                    e.stopPropagation(),
                    e.preventDefault()
                }
                ,
                t.prototype.drop = function(e) {
                    e.stopPropagation(),
                    e.preventDefault(),
                    this.loadFiles(e)
                }
                ,
                t.prototype._traverseFolder = function(e, t, r, i) {
                    var n = this
                      , o = e.createReader()
                      , a = e.fullPath.replace(/^\//, "").replace(/(.+?)\/?$/, "$1/");
                    o.readEntries((function(e) {
                        r.count += e.length;
                        for (var o = 0, s = e; o < s.length; o++) {
                            var y = s[o];
                            y.isFile ? y.file((function(e) {
                                e.correctName = a + e.name,
                                t.push(e),
                                0 == --r.count && i()
                            }
                            )) : y.isDirectory && n._traverseFolder(y, t, r, i)
                        }
                        --r.count && i()
                    }
                    ))
                }
                ,
                t.prototype._processFiles = function(e) {
                    for (var r = 0; r < e.length; r++) {
                        var i = e[r].correctName.toLowerCase()
                          , n = i.split(".").pop();
                        this.onProcessFileCallback(e[r], i, n) && ("babylon" !== n && "stl" !== n && "obj" !== n && "gltf" !== n && "glb" !== n || -1 !== i.indexOf(".binary.babylon") || -1 !== i.indexOf(".incremental.babylon") || (this._sceneFileToLoad = e[r]),
                        t.FilesToLoad[i] = e[r])
                    }
                }
                ,
                t.prototype.loadFiles = function(e) {
                    var t = this;
                    if (e && e.dataTransfer && e.dataTransfer.files && (this._filesToLoad = e.dataTransfer.files),
                    e && e.target && e.target.files && (this._filesToLoad = e.target.files),
                    this._filesToLoad && 0 !== this._filesToLoad.length && (this._startingProcessingFilesCallback && this._startingProcessingFilesCallback(this._filesToLoad),
                    this._filesToLoad && this._filesToLoad.length > 0)) {
                        for (var r = new Array, i = [], n = e.dataTransfer ? e.dataTransfer.items : null, o = 0; o < this._filesToLoad.length; o++) {
                            var a = this._filesToLoad[o]
                              , s = a.name.toLowerCase()
                              , y = void 0;
                            if (a.correctName = s,
                            n) {
                                var l = n[o];
                                l.getAsEntry ? y = l.getAsEntry() : l.webkitGetAsEntry && (y = l.webkitGetAsEntry())
                            }
                            y && y.isDirectory ? i.push(y) : r.push(a)
                        }
                        if (0 === i.length)
                            this._processFiles(r),
                            this._processReload();
                        else
                            for (var c = {
                                count: i.length
                            }, h = 0, u = i; h < u.length; h++) {
                                var d = u[h];
                                this._traverseFolder(d, r, c, (function() {
                                    t._processFiles(r),
                                    0 === c.count && t._processReload()
                                }
                                ))
                            }
                    }
                }
                ,
                t.prototype._processReload = function() {
                    this._onReloadCallback ? this._onReloadCallback(this._sceneFileToLoad) : this.reload()
                }
                ,
                t.prototype.reload = function() {
                    var t = this;
                    this._sceneFileToLoad ? (this._currentScene && (e.Tools.errorsCount > 0 && e.Tools.ClearLogCache(),
                    this._engine.stopRenderLoop()),
                    e.SceneLoader.LoadAsync("file:", this._sceneFileToLoad.name, this._engine, (function(e) {
                        t._progressCallback && t._progressCallback(e)
                    }
                    )).then((function(e) {
                        t._currentScene && t._currentScene.dispose(),
                        t._currentScene = e,
                        t._sceneLoadedCallback && t._sceneLoadedCallback(t._sceneFileToLoad, t._currentScene),
                        t._currentScene.executeWhenReady((function() {
                            t._engine.runRenderLoop((function() {
                                t.renderFunction()
                            }
                            ))
                        }
                        ))
                    }
                    )).catch((function(e) {
                        t._errorCallback && t._errorCallback(t._sceneFileToLoad, t._currentScene, e.message)
                    }
                    ))) : e.Tools.Error("Please provide a valid .babylon file.")
                }
                ,
                t.FilesToLoad = {},
                t
            }();
            e.FilesInput = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.EnableFor = function(e) {
                    e._tags = e._tags || {},
                    e.hasTags = function() {
                        return t.HasTags(e)
                    }
                    ,
                    e.addTags = function(r) {
                        return t.AddTagsTo(e, r)
                    }
                    ,
                    e.removeTags = function(r) {
                        return t.RemoveTagsFrom(e, r)
                    }
                    ,
                    e.matchesTagsQuery = function(r) {
                        return t.MatchesQuery(e, r)
                    }
                }
                ,
                t.DisableFor = function(e) {
                    delete e._tags,
                    delete e.hasTags,
                    delete e.addTags,
                    delete e.removeTags,
                    delete e.matchesTagsQuery
                }
                ,
                t.HasTags = function(t) {
                    return !!t._tags && !e.Tools.IsEmpty(t._tags)
                }
                ,
                t.GetTags = function(e, t) {
                    if (void 0 === t && (t = !0),
                    !e._tags)
                        return null;
                    if (t) {
                        var r = [];
                        for (var i in e._tags)
                            e._tags.hasOwnProperty(i) && !0 === e._tags[i] && r.push(i);
                        return r.join(" ")
                    }
                    return e._tags
                }
                ,
                t.AddTagsTo = function(e, r) {
                    r && ("string" == typeof r && r.split(" ").forEach((function(r, i, n) {
                        t._AddTagTo(e, r)
                    }
                    )))
                }
                ,
                t._AddTagTo = function(e, r) {
                    "" !== (r = r.trim()) && "true" !== r && "false" !== r && (r.match(/[\s]/) || r.match(/^([!]|([|]|[&]){2})/) || (t.EnableFor(e),
                    e._tags[r] = !0))
                }
                ,
                t.RemoveTagsFrom = function(e, r) {
                    if (t.HasTags(e)) {
                        var i = r.split(" ");
                        for (var n in i)
                            t._RemoveTagFrom(e, i[n])
                    }
                }
                ,
                t._RemoveTagFrom = function(e, t) {
                    delete e._tags[t]
                }
                ,
                t.MatchesQuery = function(r, i) {
                    return void 0 === i || ("" === i ? t.HasTags(r) : e.AndOrNotEvaluator.Eval(i, (function(e) {
                        return t.HasTags(r) && r._tags[e]
                    }
                    )))
                }
                ,
                t
            }();
            e.Tags = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {}
                return e.Eval = function(t, r) {
                    return "true" === (t = t.match(/\([^\(\)]*\)/g) ? t.replace(/\([^\(\)]*\)/g, (function(t) {
                        return t = t.slice(1, t.length - 1),
                        e._HandleParenthesisContent(t, r)
                    }
                    )) : e._HandleParenthesisContent(t, r)) || "false" !== t && e.Eval(t, r)
                }
                ,
                e._HandleParenthesisContent = function(t, r) {
                    var i;
                    r = r || function(e) {
                        return "true" === e
                    }
                    ;
                    var n = t.split("||");
                    for (var o in n)
                        if (n.hasOwnProperty(o)) {
                            var a = e._SimplifyNegation(n[o].trim())
                              , s = a.split("&&");
                            if (s.length > 1)
                                for (var y = 0; y < s.length; ++y) {
                                    var l = e._SimplifyNegation(s[y].trim());
                                    if (!(i = "true" !== l && "false" !== l ? "!" === l[0] ? !r(l.substring(1)) : r(l) : "true" === l)) {
                                        a = "false";
                                        break
                                    }
                                }
                            if (i || "true" === a) {
                                i = !0;
                                break
                            }
                            i = "true" !== a && "false" !== a ? "!" === a[0] ? !r(a.substring(1)) : r(a) : "true" === a
                        }
                    return i ? "true" : "false"
                }
                ,
                e._SimplifyNegation = function(e) {
                    return "!true" === (e = (e = e.replace(/^[\s!]+/, (function(e) {
                        return (e = e.replace(/[\s]/g, (function() {
                            return ""
                        }
                        ))).length % 2 ? "!" : ""
                    }
                    ))).trim()) ? e = "false" : "!false" === e && (e = "true"),
                    e
                }
                ,
                e
            }();
            e.AndOrNotEvaluator = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(r, i, n) {
                    void 0 === n && (n = !1);
                    var o = this;
                    this.idbFactory = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB,
                    this.callbackManifestChecked = i,
                    this.currentSceneUrl = t._ReturnFullUrlLocation(r),
                    this.db = null,
                    this._enableSceneOffline = !1,
                    this._enableTexturesOffline = !1,
                    this.manifestVersionFound = 0,
                    this.mustUpdateRessources = !1,
                    this.hasReachedQuota = !1,
                    t.IDBStorageEnabled ? n ? (this._enableSceneOffline = !0,
                    this._enableTexturesOffline = !0,
                    this.manifestVersionFound = 1,
                    e.Tools.SetImmediate((function() {
                        o.callbackManifestChecked(!0)
                    }
                    ))) : this._checkManifestFile() : this.callbackManifestChecked(!0)
                }
                return Object.defineProperty(t.prototype, "enableSceneOffline", {
                    get: function() {
                        return this._enableSceneOffline
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "enableTexturesOffline", {
                    get: function() {
                        return this._enableTexturesOffline
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._checkManifestFile = function() {
                    var t = this
                      , r = function() {
                        t._enableSceneOffline = !1,
                        t._enableTexturesOffline = !1,
                        t.callbackManifestChecked(!1)
                    }
                      , i = !1
                      , n = this.currentSceneUrl + ".manifest"
                      , o = new XMLHttpRequest;
                    navigator.onLine && (i = !0,
                    n = n + (null == n.match(/\?/) ? "?" : "&") + Date.now()),
                    o.open("GET", n, !0),
                    o.addEventListener("load", (function() {
                        if (200 === o.status || e.Tools.ValidateXHRData(o, 1))
                            try {
                                var i = JSON.parse(o.response);
                                t._enableSceneOffline = i.enableSceneOffline,
                                t._enableTexturesOffline = i.enableTexturesOffline,
                                i.version && !isNaN(parseInt(i.version)) && (t.manifestVersionFound = i.version),
                                t.callbackManifestChecked && t.callbackManifestChecked(!0)
                            } catch (e) {
                                r()
                            }
                        else
                            r()
                    }
                    ), !1),
                    o.addEventListener("error", (function(e) {
                        if (i) {
                            i = !1;
                            var n = t.currentSceneUrl + ".manifest";
                            o.open("GET", n, !0),
                            o.send()
                        } else
                            r()
                    }
                    ), !1);
                    try {
                        o.send()
                    } catch (t) {
                        e.Tools.Error("Error on XHR send request."),
                        this.callbackManifestChecked(!1)
                    }
                }
                ,
                t.prototype.openAsync = function(t, r) {
                    var i = this
                      , n = function() {
                        i.isSupported = !1,
                        r && r()
                    };
                    if (this.idbFactory && (this._enableSceneOffline || this._enableTexturesOffline))
                        if (this.db)
                            t && t();
                        else {
                            this.hasReachedQuota = !1,
                            this.isSupported = !0;
                            var o = this.idbFactory.open("babylonjs", 1);
                            o.onerror = function(e) {
                                n()
                            }
                            ,
                            o.onblocked = function(t) {
                                e.Tools.Error("IDB request blocked. Please reload the page."),
                                n()
                            }
                            ,
                            o.onsuccess = function(e) {
                                i.db = o.result,
                                t()
                            }
                            ,
                            o.onupgradeneeded = function(t) {
                                if (i.db = t.target.result,
                                i.db)
                                    try {
                                        i.db.createObjectStore("scenes", {
                                            keyPath: "sceneUrl"
                                        }),
                                        i.db.createObjectStore("versions", {
                                            keyPath: "sceneUrl"
                                        }),
                                        i.db.createObjectStore("textures", {
                                            keyPath: "textureUrl"
                                        })
                                    } catch (t) {
                                        e.Tools.Error("Error while creating object stores. Exception: " + t.message),
                                        n()
                                    }
                            }
                        }
                    else
                        this.isSupported = !1,
                        r && r()
                }
                ,
                t.prototype.loadImageFromDB = function(e, r) {
                    var i = this
                      , n = t._ReturnFullUrlLocation(e)
                      , o = function() {
                        i.hasReachedQuota || null === i.db ? r.src = e : i._saveImageIntoDBAsync(n, r)
                    };
                    this.mustUpdateRessources ? o() : this._loadImageFromDBAsync(n, r, o)
                }
                ,
                t.prototype._loadImageFromDBAsync = function(t, r, i) {
                    if (this.isSupported && null !== this.db) {
                        var n, o = this.db.transaction(["textures"]);
                        o.onabort = function(e) {
                            r.src = t
                        }
                        ,
                        o.oncomplete = function(o) {
                            var a;
                            if (n) {
                                var s = window.URL || window.webkitURL;
                                a = s.createObjectURL(n.data),
                                r.onerror = function() {
                                    e.Tools.Error("Error loading image from blob URL: " + a + " switching back to web url: " + t),
                                    r.src = t
                                }
                                ,
                                r.src = a
                            } else
                                i()
                        }
                        ;
                        var a = o.objectStore("textures").get(t);
                        a.onsuccess = function(e) {
                            n = e.target.result
                        }
                        ,
                        a.onerror = function(i) {
                            e.Tools.Error("Error loading texture " + t + " from DB."),
                            r.src = t
                        }
                    } else
                        e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),
                        r.src = t
                }
                ,
                t.prototype._saveImageIntoDBAsync = function(r, i) {
                    var n = this;
                    if (this.isSupported) {
                        var o = function() {
                            var e;
                            if (a) {
                                var t = window.URL || window.webkitURL;
                                try {
                                    e = t.createObjectURL(a)
                                } catch (r) {
                                    e = t.createObjectURL(a)
                                }
                            }
                            e && (i.src = e)
                        };
                        if (t.IsUASupportingBlobStorage) {
                            var a, s = new XMLHttpRequest;
                            s.open("GET", r, !0),
                            s.responseType = "blob",
                            s.addEventListener("load", (function() {
                                if (200 === s.status && n.db) {
                                    a = s.response;
                                    var e = n.db.transaction(["textures"], "readwrite");
                                    e.onabort = function(e) {
                                        try {
                                            var t = (e.srcElement || e.target).error;
                                            t && "QuotaExceededError" === t.name && (n.hasReachedQuota = !0)
                                        } catch (e) {}
                                        o()
                                    }
                                    ,
                                    e.oncomplete = function(e) {
                                        o()
                                    }
                                    ;
                                    var y = {
                                        textureUrl: r,
                                        data: a
                                    };
                                    try {
                                        var l = e.objectStore("textures").put(y);
                                        l.onsuccess = function(e) {}
                                        ,
                                        l.onerror = function(e) {
                                            o()
                                        }
                                    } catch (e) {
                                        25 === e.code && (t.IsUASupportingBlobStorage = !1),
                                        i.src = r
                                    }
                                } else
                                    i.src = r
                            }
                            ), !1),
                            s.addEventListener("error", (function(t) {
                                e.Tools.Error("Error in XHR request in BABYLON.Database."),
                                i.src = r
                            }
                            ), !1),
                            s.send()
                        } else
                            i.src = r
                    } else
                        e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),
                        i.src = r
                }
                ,
                t.prototype._checkVersionFromDB = function(e, t) {
                    var r = this;
                    this._loadVersionFromDBAsync(e, t, (function() {
                        r._saveVersionIntoDBAsync(e, t)
                    }
                    ))
                }
                ,
                t.prototype._loadVersionFromDBAsync = function(t, r, i) {
                    var n, o = this;
                    if (this.isSupported && this.db)
                        try {
                            var a = this.db.transaction(["versions"]);
                            a.oncomplete = function(e) {
                                n ? o.manifestVersionFound !== n.data ? (o.mustUpdateRessources = !0,
                                i()) : r(n.data) : (o.mustUpdateRessources = !0,
                                i())
                            }
                            ,
                            a.onabort = function(e) {
                                r(-1)
                            }
                            ;
                            var s = a.objectStore("versions").get(t);
                            s.onsuccess = function(e) {
                                n = e.target.result
                            }
                            ,
                            s.onerror = function(i) {
                                e.Tools.Error("Error loading version for scene " + t + " from DB."),
                                r(-1)
                            }
                        } catch (t) {
                            e.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: " + t.message),
                            r(-1)
                        }
                    else
                        e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),
                        r(-1)
                }
                ,
                t.prototype._saveVersionIntoDBAsync = function(t, r) {
                    var i = this;
                    if (this.isSupported && !this.hasReachedQuota && this.db)
                        try {
                            var n = this.db.transaction(["versions"], "readwrite");
                            n.onabort = function(e) {
                                try {
                                    var t = e.srcElement.error;
                                    t && "QuotaExceededError" === t.name && (i.hasReachedQuota = !0)
                                } catch (e) {}
                                r(-1)
                            }
                            ,
                            n.oncomplete = function(e) {
                                r(i.manifestVersionFound)
                            }
                            ;
                            var o = {
                                sceneUrl: t,
                                data: this.manifestVersionFound
                            }
                              , a = n.objectStore("versions").put(o);
                            a.onsuccess = function(e) {}
                            ,
                            a.onerror = function(t) {
                                e.Tools.Error("Error in DB add version request in BABYLON.Database.")
                            }
                        } catch (t) {
                            e.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: " + t.message),
                            r(-1)
                        }
                    else
                        r(-1)
                }
                ,
                t.prototype.loadFileFromDB = function(e, r, i, n, o) {
                    var a = this
                      , s = t._ReturnFullUrlLocation(e)
                      , y = function() {
                        a._saveFileIntoDBAsync(s, r, i, o, n)
                    };
                    this._checkVersionFromDB(s, (function(e) {
                        -1 !== e ? a.mustUpdateRessources ? a._saveFileIntoDBAsync(s, r, i, o, n) : a._loadFileFromDBAsync(s, r, y, o) : n && n()
                    }
                    ))
                }
                ,
                t.prototype._loadFileFromDBAsync = function(t, r, i, n) {
                    if (this.isSupported && this.db) {
                        var o, a;
                        o = -1 !== t.indexOf(".babylon") ? "scenes" : "textures";
                        var s = this.db.transaction([o]);
                        s.oncomplete = function(e) {
                            a ? r(a.data) : i()
                        }
                        ,
                        s.onabort = function(e) {
                            i()
                        }
                        ;
                        var y = s.objectStore(o).get(t);
                        y.onsuccess = function(e) {
                            a = e.target.result
                        }
                        ,
                        y.onerror = function(r) {
                            e.Tools.Error("Error loading file " + t + " from DB."),
                            i()
                        }
                    } else
                        e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),
                        r()
                }
                ,
                t.prototype._saveFileIntoDBAsync = function(t, r, i, n, o) {
                    var a = this;
                    if (this.isSupported) {
                        var s;
                        s = -1 !== t.indexOf(".babylon") ? "scenes" : "textures";
                        var y, l = new XMLHttpRequest;
                        l.open("GET", t + "?" + Date.now(), !0),
                        n && (l.responseType = "arraybuffer"),
                        i && (l.onprogress = i),
                        l.addEventListener("load", (function() {
                            if (200 === l.status || l.status < 400 && e.Tools.ValidateXHRData(l, n ? 6 : 1))
                                if (y = n ? l.response : l.responseText,
                                !a.hasReachedQuota && a.db) {
                                    var i, c = a.db.transaction([s], "readwrite");
                                    c.onabort = function(e) {
                                        try {
                                            var t = e.srcElement.error;
                                            t && "QuotaExceededError" === t.name && (a.hasReachedQuota = !0)
                                        } catch (e) {}
                                        r(y)
                                    }
                                    ,
                                    c.oncomplete = function(e) {
                                        r(y)
                                    }
                                    ,
                                    i = "scenes" === s ? {
                                        sceneUrl: t,
                                        data: y,
                                        version: a.manifestVersionFound
                                    } : {
                                        textureUrl: t,
                                        data: y
                                    };
                                    try {
                                        var h = c.objectStore(s).put(i);
                                        h.onsuccess = function(e) {}
                                        ,
                                        h.onerror = function(t) {
                                            e.Tools.Error("Error in DB add file request in BABYLON.Database.")
                                        }
                                    } catch (e) {
                                        r(y)
                                    }
                                } else
                                    r(y);
                            else
                                l.status >= 400 && o ? o(l) : r()
                        }
                        ), !1),
                        l.addEventListener("error", (function(t) {
                            e.Tools.Error("error on XHR request."),
                            r()
                        }
                        ), !1),
                        l.send()
                    } else
                        e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),
                        r()
                }
                ,
                t.IsUASupportingBlobStorage = !0,
                t.IDBStorageEnabled = !0,
                t._ParseURL = function(e) {
                    document.createElement("a").href = e;
                    var t = e.substring(0, e.lastIndexOf("#"))
                      , r = e.substring(t.lastIndexOf("/") + 1, e.length);
                    return e.substring(0, e.indexOf(r, 0))
                }
                ,
                t._ReturnFullUrlLocation = function(e) {
                    return -1 === e.indexOf("http:/") && -1 === e.indexOf("https:/") ? t._ParseURL(window.location.href) + e : e
                }
                ,
                t
            }();
            e.Database = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this._isEnabled = !0,
                    this.leftColor = e.Color3.White(),
                    this.rightColor = e.Color3.Black(),
                    this.bias = 0,
                    this.power = 1
                }
                return Object.defineProperty(t.prototype, "isEnabled", {
                    get: function() {
                        return this._isEnabled
                    },
                    set: function(t) {
                        this._isEnabled !== t && (this._isEnabled = t,
                        e.Engine.MarkAllMaterialsAsDirty(e.Material.FresnelDirtyFlag | e.Material.MiscDirtyFlag))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.clone = function() {
                    var r = new t;
                    return e.Tools.DeepCopy(this, r),
                    r
                }
                ,
                t.prototype.serialize = function() {
                    var e = {};
                    return e.isEnabled = this.isEnabled,
                    e.leftColor = this.leftColor.asArray(),
                    e.rightColor = this.rightColor.asArray(),
                    e.bias = this.bias,
                    e.power = this.power,
                    e
                }
                ,
                t.Parse = function(r) {
                    var i = new t;
                    return i.isEnabled = r.isEnabled,
                    i.leftColor = e.Color3.FromArray(r.leftColor),
                    i.rightColor = e.Color3.FromArray(r.rightColor),
                    i.bias = r.bias,
                    i.power = r.power || 1,
                    i
                }
                ,
                t
            }();
            e.FresnelParameters = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(e, r) {
                    var i = t.call(this, e, r, !0) || this;
                    return r.multiMaterials.push(i),
                    i.subMaterials = new Array,
                    i.storeEffectOnSubMeshes = !0,
                    i
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "subMaterials", {
                    get: function() {
                        return this._subMaterials
                    },
                    set: function(e) {
                        this._subMaterials = e,
                        this._hookArray(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._hookArray = function(e) {
                    var t = this
                      , r = e.push;
                    e.push = function() {
                        for (var i = [], n = 0; n < arguments.length; n++)
                            i[n] = arguments[n];
                        var o = r.apply(e, i);
                        return t._markAllSubMeshesAsTexturesDirty(),
                        o
                    }
                    ;
                    var i = e.splice;
                    e.splice = function(r, n) {
                        var o = i.apply(e, [r, n]);
                        return t._markAllSubMeshesAsTexturesDirty(),
                        o
                    }
                }
                ,
                r.prototype.getSubMaterial = function(e) {
                    return e < 0 || e >= this.subMaterials.length ? this.getScene().defaultMaterial : this.subMaterials[e]
                }
                ,
                r.prototype.getActiveTextures = function() {
                    var e;
                    return (e = t.prototype.getActiveTextures.call(this)).concat.apply(e, this.subMaterials.map((function(e) {
                        return e ? e.getActiveTextures() : []
                    }
                    )))
                }
                ,
                r.prototype.getClassName = function() {
                    return "MultiMaterial"
                }
                ,
                r.prototype.isReadyForSubMesh = function(e, t, r) {
                    for (var i = 0; i < this.subMaterials.length; i++) {
                        var n = this.subMaterials[i];
                        if (n) {
                            if (n.storeEffectOnSubMeshes) {
                                if (!n.isReadyForSubMesh(e, t, r))
                                    return !1;
                                continue
                            }
                            if (!n.isReady(e))
                                return !1
                        }
                    }
                    return !0
                }
                ,
                r.prototype.clone = function(e, t) {
                    for (var i = new r(e,this.getScene()), n = 0; n < this.subMaterials.length; n++) {
                        var o = null
                          , a = this.subMaterials[n];
                        o = t && a ? a.clone(e + "-" + a.name) : this.subMaterials[n],
                        i.subMaterials.push(o)
                    }
                    return i
                }
                ,
                r.prototype.serialize = function() {
                    var t = {};
                    t.name = this.name,
                    t.id = this.id,
                    e.Tags && (t.tags = e.Tags.GetTags(this)),
                    t.materials = [];
                    for (var r = 0; r < this.subMaterials.length; r++) {
                        var i = this.subMaterials[r];
                        i ? t.materials.push(i.id) : t.materials.push(null)
                    }
                    return t
                }
                ,
                r.prototype.dispose = function(e, r) {
                    var i = this.getScene();
                    if (i) {
                        var n = i.multiMaterials.indexOf(this);
                        n >= 0 && i.multiMaterials.splice(n, 1),
                        t.prototype.dispose.call(this, e, r)
                    }
                }
                ,
                r
            }(e.Material);
            e.MultiMaterial = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.touchAngularSensibility = 2e5,
                    this.touchMoveSensibility = 250,
                    this._offsetX = null,
                    this._offsetY = null,
                    this._pointerPressed = new Array
                }
                return t.prototype.attachControl = function(t, r) {
                    var i = this
                      , n = null;
                    void 0 === this._pointerInput && (this._onLostFocus = function(e) {
                        i._offsetX = null,
                        i._offsetY = null
                    }
                    ,
                    this._pointerInput = function(t, o) {
                        var a = t.event;
                        if ("mouse" !== a.pointerType)
                            if (t.type === e.PointerEventTypes.POINTERDOWN) {
                                if (r || a.preventDefault(),
                                i._pointerPressed.push(a.pointerId),
                                1 !== i._pointerPressed.length)
                                    return;
                                n = {
                                    x: a.clientX,
                                    y: a.clientY
                                }
                            } else if (t.type === e.PointerEventTypes.POINTERUP) {
                                if (r || a.preventDefault(),
                                -1 === (s = i._pointerPressed.indexOf(a.pointerId)))
                                    return;
                                if (i._pointerPressed.splice(s, 1),
                                0 != s)
                                    return;
                                n = null,
                                i._offsetX = null,
                                i._offsetY = null
                            } else if (t.type === e.PointerEventTypes.POINTERMOVE) {
                                if (r || a.preventDefault(),
                                !n)
                                    return;
                                var s;
                                if (0 != (s = i._pointerPressed.indexOf(a.pointerId)))
                                    return;
                                i._offsetX = a.clientX - n.x,
                                i._offsetY = -(a.clientY - n.y)
                            }
                    }
                    ),
                    this._observer = this.camera.getScene().onPointerObservable.add(this._pointerInput, e.PointerEventTypes.POINTERDOWN | e.PointerEventTypes.POINTERUP | e.PointerEventTypes.POINTERMOVE),
                    this._onLostFocus && t.addEventListener("blur", this._onLostFocus)
                }
                ,
                t.prototype.detachControl = function(e) {
                    this._pointerInput && e && (this._observer && (this.camera.getScene().onPointerObservable.remove(this._observer),
                    this._observer = null),
                    this._onLostFocus && (e.removeEventListener("blur", this._onLostFocus),
                    this._onLostFocus = null),
                    this._pointerPressed = [],
                    this._offsetX = null,
                    this._offsetY = null)
                }
                ,
                t.prototype.checkInputs = function() {
                    if (this._offsetX && this._offsetY) {
                        var t = this.camera;
                        if (t.cameraRotation.y += this._offsetX / this.touchAngularSensibility,
                        this._pointerPressed.length > 1)
                            t.cameraRotation.x += -this._offsetY / this.touchAngularSensibility;
                        else {
                            var r = t._computeLocalCameraSpeed()
                              , i = new e.Vector3(0,0,r * this._offsetY / this.touchMoveSensibility);
                            e.Matrix.RotationYawPitchRollToRef(t.rotation.y, t.rotation.x, 0, t._cameraRotationMatrix),
                            t.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(i, t._cameraRotationMatrix))
                        }
                    }
                }
                ,
                t.prototype.getClassName = function() {
                    return "FreeCameraTouchInput"
                }
                ,
                t.prototype.getSimpleName = function() {
                    return "touch"
                }
                ,
                n([e.serialize()], t.prototype, "touchAngularSensibility", void 0),
                n([e.serialize()], t.prototype, "touchMoveSensibility", void 0),
                t
            }();
            e.FreeCameraTouchInput = t,
            e.CameraInputTypes.FreeCameraTouchInput = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("TouchCamera", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(e) {
                function t(t, r, i) {
                    var n = e.call(this, t, r, i) || this;
                    return n.inputs.addTouch(),
                    n._setupInputs(),
                    n
                }
                return o(t, e),
                Object.defineProperty(t.prototype, "touchAngularSensibility", {
                    get: function() {
                        var e = this.inputs.attached.touch;
                        return e ? e.touchAngularSensibility : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.touch;
                        t && (t.touchAngularSensibility = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "touchMoveSensibility", {
                    get: function() {
                        var e = this.inputs.attached.touch;
                        return e ? e.touchMoveSensibility : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.touch;
                        t && (t.touchMoveSensibility = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getClassName = function() {
                    return "TouchCamera"
                }
                ,
                t.prototype._setupInputs = function() {
                    var e = this.inputs.attached.mouse;
                    e && (e.touchEnabled = !1)
                }
                ,
                t
            }(e.FreeCamera);
            e.TouchCamera = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y) {
                    void 0 === a && (a = null),
                    void 0 === s && (s = !0),
                    void 0 === y && (y = !1);
                    var l = t.call(this, null, o, !s) || this;
                    l.isCube = y,
                    l.isEnabled = !0,
                    l.autoClear = !0,
                    l.onGeneratedObservable = new e.Observable,
                    l._textures = {},
                    l._currentRefreshId = -1,
                    l._refreshRate = 1,
                    l._vertexBuffers = {},
                    l._uniforms = new Array,
                    l._samplers = new Array,
                    l._floats = {},
                    l._ints = {},
                    l._floatsArrays = {},
                    l._colors3 = {},
                    l._colors4 = {},
                    l._vectors2 = {},
                    l._vectors3 = {},
                    l._matrices = {},
                    l._fallbackTextureUsed = !1,
                    l._cachedDefines = "",
                    l._contentUpdateId = -1;
                    var c = (o = l.getScene())._getComponent(e.SceneComponentConstants.NAME_PROCEDURALTEXTURE);
                    c || (c = new e.ProceduralTextureSceneComponent(o),
                    o._addComponent(c)),
                    o.proceduralTextures.push(l),
                    l._engine = o.getEngine(),
                    l.name = r,
                    l.isRenderTarget = !0,
                    l._size = i,
                    l._generateMipMaps = s,
                    l.setFragment(n),
                    l._fallbackTexture = a,
                    y ? (l._texture = l._engine.createRenderTargetCubeTexture(i, {
                        generateMipMaps: s,
                        generateDepthBuffer: !1,
                        generateStencilBuffer: !1
                    }),
                    l.setFloat("face", 0)) : l._texture = l._engine.createRenderTargetTexture(i, {
                        generateMipMaps: s,
                        generateDepthBuffer: !1,
                        generateStencilBuffer: !1
                    });
                    var h = [];
                    return h.push(1, 1),
                    h.push(-1, 1),
                    h.push(-1, -1),
                    h.push(1, -1),
                    l._vertexBuffers[e.VertexBuffer.PositionKind] = new e.VertexBuffer(l._engine,h,e.VertexBuffer.PositionKind,!1,!1,2),
                    l._createIndexBuffer(),
                    l
                }
                return o(r, t),
                r.prototype.getContent = function() {
                    return this._contentData && this._currentRefreshId == this._contentUpdateId ? this._contentData : (this._contentData = this.readPixels(0, 0, this._contentData),
                    this._contentUpdateId = this._currentRefreshId,
                    this._contentData)
                }
                ,
                r.prototype._createIndexBuffer = function() {
                    var e = this._engine
                      , t = [];
                    t.push(0),
                    t.push(1),
                    t.push(2),
                    t.push(0),
                    t.push(2),
                    t.push(3),
                    this._indexBuffer = e.createIndexBuffer(t)
                }
                ,
                r.prototype._rebuild = function() {
                    var t = this._vertexBuffers[e.VertexBuffer.PositionKind];
                    t && t._rebuild(),
                    this._createIndexBuffer(),
                    this.refreshRate === e.RenderTargetTexture.REFRESHRATE_RENDER_ONCE && (this.refreshRate = e.RenderTargetTexture.REFRESHRATE_RENDER_ONCE)
                }
                ,
                r.prototype.reset = function() {
                    void 0 !== this._effect && this._engine._releaseEffect(this._effect)
                }
                ,
                r.prototype._getDefines = function() {
                    return ""
                }
                ,
                r.prototype.isReady = function() {
                    var t, r = this, i = this._engine;
                    if (!this._fragment)
                        return !1;
                    if (this._fallbackTextureUsed)
                        return !0;
                    var n = this._getDefines();
                    return !(!this._effect || n !== this._cachedDefines || !this._effect.isReady()) || (t = void 0 !== this._fragment.fragmentElement ? {
                        vertex: "procedural",
                        fragmentElement: this._fragment.fragmentElement
                    } : {
                        vertex: "procedural",
                        fragment: this._fragment
                    },
                    this._cachedDefines = n,
                    this._effect = i.createEffect(t, [e.VertexBuffer.PositionKind], this._uniforms, this._samplers, n, void 0, void 0, (function() {
                        r.releaseInternalTexture(),
                        r._fallbackTexture && (r._texture = r._fallbackTexture._texture,
                        r._texture && r._texture.incrementReferences()),
                        r._fallbackTextureUsed = !0
                    }
                    )),
                    this._effect.isReady())
                }
                ,
                r.prototype.resetRefreshCounter = function() {
                    this._currentRefreshId = -1
                }
                ,
                r.prototype.setFragment = function(e) {
                    this._fragment = e
                }
                ,
                Object.defineProperty(r.prototype, "refreshRate", {
                    get: function() {
                        return this._refreshRate
                    },
                    set: function(e) {
                        this._refreshRate = e,
                        this.resetRefreshCounter()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._shouldRender = function() {
                    return this.isEnabled && this.isReady() && this._texture ? !this._fallbackTextureUsed && (-1 === this._currentRefreshId ? (this._currentRefreshId = 1,
                    !0) : this.refreshRate === this._currentRefreshId ? (this._currentRefreshId = 1,
                    !0) : (this._currentRefreshId++,
                    !1)) : (this._texture && (this._texture.isReady = !1),
                    !1)
                }
                ,
                r.prototype.getRenderSize = function() {
                    return this._size
                }
                ,
                r.prototype.resize = function(e, t) {
                    this._fallbackTextureUsed || (this.releaseInternalTexture(),
                    this._texture = this._engine.createRenderTargetTexture(e, t),
                    this._size = e,
                    this._generateMipMaps = t)
                }
                ,
                r.prototype._checkUniform = function(e) {
                    -1 === this._uniforms.indexOf(e) && this._uniforms.push(e)
                }
                ,
                r.prototype.setTexture = function(e, t) {
                    return -1 === this._samplers.indexOf(e) && this._samplers.push(e),
                    this._textures[e] = t,
                    this
                }
                ,
                r.prototype.setFloat = function(e, t) {
                    return this._checkUniform(e),
                    this._floats[e] = t,
                    this
                }
                ,
                r.prototype.setInt = function(e, t) {
                    return this._checkUniform(e),
                    this._ints[e] = t,
                    this
                }
                ,
                r.prototype.setFloats = function(e, t) {
                    return this._checkUniform(e),
                    this._floatsArrays[e] = t,
                    this
                }
                ,
                r.prototype.setColor3 = function(e, t) {
                    return this._checkUniform(e),
                    this._colors3[e] = t,
                    this
                }
                ,
                r.prototype.setColor4 = function(e, t) {
                    return this._checkUniform(e),
                    this._colors4[e] = t,
                    this
                }
                ,
                r.prototype.setVector2 = function(e, t) {
                    return this._checkUniform(e),
                    this._vectors2[e] = t,
                    this
                }
                ,
                r.prototype.setVector3 = function(e, t) {
                    return this._checkUniform(e),
                    this._vectors3[e] = t,
                    this
                }
                ,
                r.prototype.setMatrix = function(e, t) {
                    return this._checkUniform(e),
                    this._matrices[e] = t,
                    this
                }
                ,
                r.prototype.render = function(t) {
                    var r = this.getScene();
                    if (r) {
                        var i = this._engine;
                        for (var n in i.enableEffect(this._effect),
                        i.setState(!1),
                        this._textures)
                            this._effect.setTexture(n, this._textures[n]);
                        for (n in this._ints)
                            this._effect.setInt(n, this._ints[n]);
                        for (n in this._floats)
                            this._effect.setFloat(n, this._floats[n]);
                        for (n in this._floatsArrays)
                            this._effect.setArray(n, this._floatsArrays[n]);
                        for (n in this._colors3)
                            this._effect.setColor3(n, this._colors3[n]);
                        for (n in this._colors4) {
                            var o = this._colors4[n];
                            this._effect.setFloat4(n, o.r, o.g, o.b, o.a)
                        }
                        for (n in this._vectors2)
                            this._effect.setVector2(n, this._vectors2[n]);
                        for (n in this._vectors3)
                            this._effect.setVector3(n, this._vectors3[n]);
                        for (n in this._matrices)
                            this._effect.setMatrix(n, this._matrices[n]);
                        if (this._texture) {
                            if (this.isCube)
                                for (var a = 0; a < 6; a++)
                                    i.bindFramebuffer(this._texture, a, void 0, void 0, !0),
                                    i.bindBuffers(this._vertexBuffers, this._indexBuffer, this._effect),
                                    this._effect.setFloat("face", a),
                                    this.autoClear && i.clear(r.clearColor, !0, !1, !1),
                                    i.drawElementsType(e.Material.TriangleFillMode, 0, 6),
                                    5 === a && i.generateMipMapsForCubemap(this._texture);
                            else
                                i.bindFramebuffer(this._texture, 0, void 0, void 0, !0),
                                i.bindBuffers(this._vertexBuffers, this._indexBuffer, this._effect),
                                this.autoClear && i.clear(r.clearColor, !0, !1, !1),
                                i.drawElementsType(e.Material.TriangleFillMode, 0, 6);
                            i.unBindFramebuffer(this._texture, this.isCube),
                            this.onGenerated && this.onGenerated(),
                            this.onGeneratedObservable.notifyObservers(this)
                        }
                    }
                }
                ,
                r.prototype.clone = function() {
                    var e = this.getSize()
                      , t = new r(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);
                    return t.hasAlpha = this.hasAlpha,
                    t.level = this.level,
                    t.coordinatesMode = this.coordinatesMode,
                    t
                }
                ,
                r.prototype.dispose = function() {
                    var r = this.getScene();
                    if (r) {
                        var i = r.proceduralTextures.indexOf(this);
                        i >= 0 && r.proceduralTextures.splice(i, 1);
                        var n = this._vertexBuffers[e.VertexBuffer.PositionKind];
                        n && (n.dispose(),
                        this._vertexBuffers[e.VertexBuffer.PositionKind] = null),
                        this._indexBuffer && this._engine._releaseBuffer(this._indexBuffer) && (this._indexBuffer = null),
                        t.prototype.dispose.call(this)
                    }
                }
                ,
                n([e.serialize()], r.prototype, "isEnabled", void 0),
                n([e.serialize()], r.prototype, "autoClear", void 0),
                n([e.serialize()], r.prototype, "_generateMipMaps", void 0),
                n([e.serialize()], r.prototype, "_size", void 0),
                n([e.serialize()], r.prototype, "refreshRate", null),
                r
            }(e.Texture);
            e.ProceduralTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_PROCEDURALTEXTURE,
                    this.scene = t,
                    this.scene.proceduralTextures = new Array,
                    t.layers = new Array
                }
                return t.prototype.register = function() {
                    this.scene._beforeClearStage.registerStep(e.SceneComponentConstants.STEP_BEFORECLEAR_PROCEDURALTEXTURE, this, this._beforeClear)
                }
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.dispose = function() {}
                ,
                t.prototype._beforeClear = function() {
                    if (this.scene.proceduralTexturesEnabled) {
                        e.Tools.StartPerformanceCounter("Procedural textures", this.scene.proceduralTextures.length > 0);
                        for (var t = 0; t < this.scene.proceduralTextures.length; t++) {
                            var r = this.scene.proceduralTextures[t];
                            r._shouldRender() && r.render()
                        }
                        e.Tools.EndPerformanceCounter("Procedural textures", this.scene.proceduralTextures.length > 0)
                    }
                }
                ,
                t
            }();
            e.ProceduralTextureSceneComponent = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(e, r, i, n, o, a) {
                    var s = t.call(this, e, i, null, n, o, a) || this;
                    return s._animate = !0,
                    s._time = 0,
                    s._texturePath = r,
                    s._loadJson(r),
                    s.refreshRate = 1,
                    s
                }
                return o(r, t),
                r.prototype._loadJson = function(t) {
                    var r = this
                      , i = function() {
                        e.Tools.Log("No config file found in " + t + " trying to use ShadersStore or DOM element");
                        try {
                            r.setFragment(r._texturePath)
                        } catch (t) {
                            e.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")
                        }
                    }
                      , n = t + "/config.json"
                      , o = new XMLHttpRequest;
                    o.open("GET", n, !0),
                    o.addEventListener("load", (function() {
                        if (200 === o.status || e.Tools.ValidateXHRData(o, 1))
                            try {
                                r._config = JSON.parse(o.response),
                                r.updateShaderUniforms(),
                                r.updateTextures(),
                                r.setFragment(r._texturePath + "/custom"),
                                r._animate = r._config.animate,
                                r.refreshRate = r._config.refreshrate
                            } catch (e) {
                                i()
                            }
                        else
                            i()
                    }
                    ), !1),
                    o.addEventListener("error", (function() {
                        i()
                    }
                    ), !1);
                    try {
                        o.send()
                    } catch (t) {
                        e.Tools.Error("CustomProceduralTexture: Error on XHR send request.")
                    }
                }
                ,
                r.prototype.isReady = function() {
                    if (!t.prototype.isReady.call(this))
                        return !1;
                    for (var e in this._textures) {
                        if (!this._textures[e].isReady())
                            return !1
                    }
                    return !0
                }
                ,
                r.prototype.render = function(e) {
                    var r = this.getScene();
                    this._animate && r && (this._time += .03 * r.getAnimationRatio(),
                    this.updateShaderUniforms()),
                    t.prototype.render.call(this, e)
                }
                ,
                r.prototype.updateTextures = function() {
                    for (var t = 0; t < this._config.sampler2Ds.length; t++)
                        this.setTexture(this._config.sampler2Ds[t].sample2Dname, new e.Texture(this._texturePath + "/" + this._config.sampler2Ds[t].textureRelativeUrl,this.getScene()))
                }
                ,
                r.prototype.updateShaderUniforms = function() {
                    if (this._config)
                        for (var t = 0; t < this._config.uniforms.length; t++) {
                            var r = this._config.uniforms[t];
                            switch (r.type) {
                            case "float":
                                this.setFloat(r.name, r.value);
                                break;
                            case "color3":
                                this.setColor3(r.name, new e.Color3(r.r,r.g,r.b));
                                break;
                            case "color4":
                                this.setColor4(r.name, new e.Color4(r.r,r.g,r.b,r.a));
                                break;
                            case "vector2":
                                this.setVector2(r.name, new e.Vector2(r.x,r.y));
                                break;
                            case "vector3":
                                this.setVector3(r.name, new e.Vector3(r.x,r.y,r.z))
                            }
                        }
                    this.setFloat("time", this._time)
                }
                ,
                Object.defineProperty(r.prototype, "animate", {
                    get: function() {
                        return this._animate
                    },
                    set: function(e) {
                        this._animate = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r
            }(e.ProceduralTexture);
            e.CustomProceduralTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.gamepadAngularSensibility = 200,
                    this.gamepadMoveSensibility = 40,
                    this._cameraTransform = e.Matrix.Identity(),
                    this._deltaTransform = e.Vector3.Zero(),
                    this._vector3 = e.Vector3.Zero(),
                    this._vector2 = e.Vector2.Zero()
                }
                return t.prototype.attachControl = function(t, r) {
                    var i = this
                      , n = this.camera.getScene().gamepadManager;
                    this._onGamepadConnectedObserver = n.onGamepadConnectedObservable.add((function(t) {
                        t.type !== e.Gamepad.POSE_ENABLED && (i.gamepad && t.type !== e.Gamepad.XBOX || (i.gamepad = t))
                    }
                    )),
                    this._onGamepadDisconnectedObserver = n.onGamepadDisconnectedObservable.add((function(e) {
                        i.gamepad === e && (i.gamepad = null)
                    }
                    )),
                    this.gamepad = n.getGamepadByType(e.Gamepad.XBOX)
                }
                ,
                t.prototype.detachControl = function(e) {
                    this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),
                    this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),
                    this.gamepad = null
                }
                ,
                t.prototype.checkInputs = function() {
                    if (this.gamepad && this.gamepad.leftStick) {
                        var t = this.camera
                          , r = this.gamepad.leftStick
                          , i = r.x / this.gamepadMoveSensibility
                          , n = r.y / this.gamepadMoveSensibility;
                        r.x = Math.abs(i) > .005 ? 0 + i : 0,
                        r.y = Math.abs(n) > .005 ? 0 + n : 0;
                        var o = this.gamepad.rightStick;
                        if (o) {
                            var a = o.x / this.gamepadAngularSensibility
                              , s = o.y / this.gamepadAngularSensibility;
                            o.x = Math.abs(a) > .001 ? 0 + a : 0,
                            o.y = Math.abs(s) > .001 ? 0 + s : 0
                        } else
                            o = {
                                x: 0,
                                y: 0
                            };
                        t.rotationQuaternion ? t.rotationQuaternion.toRotationMatrix(this._cameraTransform) : e.Matrix.RotationYawPitchRollToRef(t.rotation.y, t.rotation.x, 0, this._cameraTransform);
                        var y = 50 * t._computeLocalCameraSpeed();
                        this._vector3.copyFromFloats(r.x * y, 0, -r.y * y),
                        e.Vector3.TransformCoordinatesToRef(this._vector3, this._cameraTransform, this._deltaTransform),
                        t.cameraDirection.addInPlace(this._deltaTransform),
                        this._vector2.copyFromFloats(o.y, o.x),
                        t.cameraRotation.addInPlace(this._vector2)
                    }
                }
                ,
                t.prototype.getClassName = function() {
                    return "FreeCameraGamepadInput"
                }
                ,
                t.prototype.getSimpleName = function() {
                    return "gamepad"
                }
                ,
                n([e.serialize()], t.prototype, "gamepadAngularSensibility", void 0),
                n([e.serialize()], t.prototype, "gamepadMoveSensibility", void 0),
                t
            }();
            e.FreeCameraGamepadInput = t,
            e.CameraInputTypes.FreeCameraGamepadInput = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.gamepadRotationSensibility = 80,
                    this.gamepadMoveSensibility = 40
                }
                return t.prototype.attachControl = function(t, r) {
                    var i = this
                      , n = this.camera.getScene().gamepadManager;
                    this._onGamepadConnectedObserver = n.onGamepadConnectedObservable.add((function(t) {
                        t.type !== e.Gamepad.POSE_ENABLED && (i.gamepad && t.type !== e.Gamepad.XBOX || (i.gamepad = t))
                    }
                    )),
                    this._onGamepadDisconnectedObserver = n.onGamepadDisconnectedObservable.add((function(e) {
                        i.gamepad === e && (i.gamepad = null)
                    }
                    )),
                    this.gamepad = n.getGamepadByType(e.Gamepad.XBOX)
                }
                ,
                t.prototype.detachControl = function(e) {
                    this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),
                    this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),
                    this.gamepad = null
                }
                ,
                t.prototype.checkInputs = function() {
                    if (this.gamepad) {
                        var e = this.camera
                          , t = this.gamepad.rightStick;
                        if (t) {
                            if (0 != t.x) {
                                var r = t.x / this.gamepadRotationSensibility;
                                0 != r && Math.abs(r) > .005 && (e.inertialAlphaOffset += r)
                            }
                            if (0 != t.y) {
                                var i = t.y / this.gamepadRotationSensibility;
                                0 != i && Math.abs(i) > .005 && (e.inertialBetaOffset += i)
                            }
                        }
                        var n = this.gamepad.leftStick;
                        if (n && 0 != n.y) {
                            var o = n.y / this.gamepadMoveSensibility;
                            0 != o && Math.abs(o) > .005 && (this.camera.inertialRadiusOffset -= o)
                        }
                    }
                }
                ,
                t.prototype.getClassName = function() {
                    return "ArcRotateCameraGamepadInput"
                }
                ,
                t.prototype.getSimpleName = function() {
                    return "gamepad"
                }
                ,
                n([e.serialize()], t.prototype, "gamepadRotationSensibility", void 0),
                n([e.serialize()], t.prototype, "gamepadMoveSensibility", void 0),
                t
            }();
            e.ArcRotateCameraGamepadInput = t,
            e.CameraInputTypes.ArcRotateCameraGamepadInput = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    var r = this;
                    this._scene = t,
                    this._babylonGamepads = [],
                    this._oneGamepadConnected = !1,
                    this._isMonitoring = !1,
                    this.onGamepadDisconnectedObservable = new e.Observable,
                    e.Tools.IsWindowObjectExist() ? (this._gamepadEventSupported = "GamepadEvent"in window,
                    this._gamepadSupport = navigator.getGamepads || navigator.webkitGetGamepads || navigator.msGetGamepads || navigator.webkitGamepads) : this._gamepadEventSupported = !1,
                    this.onGamepadConnectedObservable = new e.Observable((function(e) {
                        for (var t in r._babylonGamepads) {
                            var i = r._babylonGamepads[t];
                            i && i._isConnected && r.onGamepadConnectedObservable.notifyObserver(e, i)
                        }
                    }
                    )),
                    this._onGamepadConnectedEvent = function(e) {
                        var t, i = e.gamepad;
                        i.index in r._babylonGamepads && r._babylonGamepads[i.index].isConnected || (r._babylonGamepads[i.index] ? ((t = r._babylonGamepads[i.index]).browserGamepad = i,
                        t._isConnected = !0) : t = r._addNewGamepad(i),
                        r.onGamepadConnectedObservable.notifyObservers(t),
                        r._startMonitoringGamepads())
                    }
                    ,
                    this._onGamepadDisconnectedEvent = function(e) {
                        var t = e.gamepad;
                        for (var i in r._babylonGamepads)
                            if (r._babylonGamepads[i].index === t.index) {
                                var n = r._babylonGamepads[i];
                                n._isConnected = !1,
                                r.onGamepadDisconnectedObservable.notifyObservers(n);
                                break
                            }
                    }
                    ,
                    this._gamepadSupport && (this._updateGamepadObjects(),
                    this._babylonGamepads.length && this._startMonitoringGamepads(),
                    this._gamepadEventSupported ? (window.addEventListener("gamepadconnected", this._onGamepadConnectedEvent, !1),
                    window.addEventListener("gamepaddisconnected", this._onGamepadDisconnectedEvent, !1)) : this._startMonitoringGamepads())
                }
                return Object.defineProperty(t.prototype, "gamepads", {
                    get: function() {
                        return this._babylonGamepads
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getGamepadByType = function(t) {
                    void 0 === t && (t = e.Gamepad.XBOX);
                    for (var r = 0, i = this._babylonGamepads; r < i.length; r++) {
                        var n = i[r];
                        if (n && n.type === t)
                            return n
                    }
                    return null
                }
                ,
                t.prototype.dispose = function() {
                    this._gamepadEventSupported && (this._onGamepadConnectedEvent && window.removeEventListener("gamepadconnected", this._onGamepadConnectedEvent),
                    this._onGamepadDisconnectedEvent && window.removeEventListener("gamepaddisconnected", this._onGamepadDisconnectedEvent),
                    this._onGamepadConnectedEvent = null,
                    this._onGamepadDisconnectedEvent = null),
                    this._babylonGamepads.forEach((function(e) {
                        e.dispose()
                    }
                    )),
                    this.onGamepadConnectedObservable.clear(),
                    this.onGamepadDisconnectedObservable.clear(),
                    this._oneGamepadConnected = !1,
                    this._stopMonitoringGamepads(),
                    this._babylonGamepads = []
                }
                ,
                t.prototype._addNewGamepad = function(t) {
                    var r;
                    this._oneGamepadConnected || (this._oneGamepadConnected = !0);
                    var i = -1 !== t.id.search("Xbox One");
                    return r = i || -1 !== t.id.search("Xbox 360") || -1 !== t.id.search("xinput") ? new e.Xbox360Pad(t.id,t.index,t,i) : t.pose ? e.PoseEnabledControllerHelper.InitiateController(t) : new e.GenericPad(t.id,t.index,t),
                    this._babylonGamepads[r.index] = r,
                    r
                }
                ,
                t.prototype._startMonitoringGamepads = function() {
                    this._isMonitoring || (this._isMonitoring = !0,
                    this._scene || this._checkGamepadsStatus())
                }
                ,
                t.prototype._stopMonitoringGamepads = function() {
                    this._isMonitoring = !1
                }
                ,
                t.prototype._checkGamepadsStatus = function() {
                    var t = this;
                    for (var r in this._updateGamepadObjects(),
                    this._babylonGamepads) {
                        var i = this._babylonGamepads[r];
                        i && i.isConnected && i.update()
                    }
                    this._isMonitoring && !this._scene && e.Tools.QueueNewFrame((function() {
                        t._checkGamepadsStatus()
                    }
                    ))
                }
                ,
                t.prototype._updateGamepadObjects = function() {
                    for (var e = navigator.getGamepads ? navigator.getGamepads() : navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : [], t = 0; t < e.length; t++) {
                        var r = e[t];
                        if (r)
                            if (this._babylonGamepads[r.index])
                                this._babylonGamepads[t].browserGamepad = r,
                                this._babylonGamepads[t].isConnected || (this._babylonGamepads[t]._isConnected = !0,
                                this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[t]));
                            else {
                                var i = this._addNewGamepad(r);
                                this.onGamepadConnectedObservable.notifyObservers(i)
                            }
                    }
                }
                ,
                t
            }();
            e.GamepadManager = t
        }(s || (s = {})),
        function(e) {
            var t = function(e, t) {
                this.x = e,
                this.y = t
            };
            e.StickValues = t;
            var r = function() {
                function e(t, r, i, n, o, a, s) {
                    void 0 === n && (n = 0),
                    void 0 === o && (o = 1),
                    void 0 === a && (a = 2),
                    void 0 === s && (s = 3),
                    this.id = t,
                    this.index = r,
                    this.browserGamepad = i,
                    this._leftStick = {
                        x: 0,
                        y: 0
                    },
                    this._rightStick = {
                        x: 0,
                        y: 0
                    },
                    this._isConnected = !0,
                    this._invertLeftStickY = !1,
                    this.type = e.GAMEPAD,
                    this._leftStickAxisX = n,
                    this._leftStickAxisY = o,
                    this._rightStickAxisX = a,
                    this._rightStickAxisY = s,
                    this.browserGamepad.axes.length >= 2 && (this._leftStick = {
                        x: this.browserGamepad.axes[this._leftStickAxisX],
                        y: this.browserGamepad.axes[this._leftStickAxisY]
                    }),
                    this.browserGamepad.axes.length >= 4 && (this._rightStick = {
                        x: this.browserGamepad.axes[this._rightStickAxisX],
                        y: this.browserGamepad.axes[this._rightStickAxisY]
                    })
                }
                return Object.defineProperty(e.prototype, "isConnected", {
                    get: function() {
                        return this._isConnected
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype.onleftstickchanged = function(e) {
                    this._onleftstickchanged = e
                }
                ,
                e.prototype.onrightstickchanged = function(e) {
                    this._onrightstickchanged = e
                }
                ,
                Object.defineProperty(e.prototype, "leftStick", {
                    get: function() {
                        return this._leftStick
                    },
                    set: function(e) {
                        !this._onleftstickchanged || this._leftStick.x === e.x && this._leftStick.y === e.y || this._onleftstickchanged(e),
                        this._leftStick = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "rightStick", {
                    get: function() {
                        return this._rightStick
                    },
                    set: function(e) {
                        !this._onrightstickchanged || this._rightStick.x === e.x && this._rightStick.y === e.y || this._onrightstickchanged(e),
                        this._rightStick = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype.update = function() {
                    this._leftStick && (this.leftStick = {
                        x: this.browserGamepad.axes[this._leftStickAxisX],
                        y: this.browserGamepad.axes[this._leftStickAxisY]
                    },
                    this._invertLeftStickY && (this.leftStick.y *= -1)),
                    this._rightStick && (this.rightStick = {
                        x: this.browserGamepad.axes[this._rightStickAxisX],
                        y: this.browserGamepad.axes[this._rightStickAxisY]
                    })
                }
                ,
                e.prototype.dispose = function() {}
                ,
                e.GAMEPAD = 0,
                e.GENERIC = 1,
                e.XBOX = 2,
                e.POSE_ENABLED = 3,
                e
            }();
            e.Gamepad = r;
            var i = function(t) {
                function i(i, n, o) {
                    var a = t.call(this, i, n, o) || this;
                    return a.onButtonDownObservable = new e.Observable,
                    a.onButtonUpObservable = new e.Observable,
                    a.type = r.GENERIC,
                    a._buttons = new Array(o.buttons.length),
                    a
                }
                return o(i, t),
                i.prototype.onbuttondown = function(e) {
                    this._onbuttondown = e
                }
                ,
                i.prototype.onbuttonup = function(e) {
                    this._onbuttonup = e
                }
                ,
                i.prototype._setButtonValue = function(e, t, r) {
                    return e !== t && (1 === e && (this._onbuttondown && this._onbuttondown(r),
                    this.onButtonDownObservable.notifyObservers(r)),
                    0 === e && (this._onbuttonup && this._onbuttonup(r),
                    this.onButtonUpObservable.notifyObservers(r))),
                    e
                }
                ,
                i.prototype.update = function() {
                    t.prototype.update.call(this);
                    for (var e = 0; e < this._buttons.length; e++)
                        this._buttons[e] = this._setButtonValue(this.browserGamepad.buttons[e].value, this._buttons[e], e)
                }
                ,
                i.prototype.dispose = function() {
                    t.prototype.dispose.call(this),
                    this.onButtonDownObservable.clear(),
                    this.onButtonUpObservable.clear()
                }
                ,
                i
            }(r);
            e.GenericPad = i
        }(s || (s = {})),
        function(e) {
            var t, r;
            !function(e) {
                e[e.A = 0] = "A",
                e[e.B = 1] = "B",
                e[e.X = 2] = "X",
                e[e.Y = 3] = "Y",
                e[e.Start = 4] = "Start",
                e[e.Back = 5] = "Back",
                e[e.LB = 6] = "LB",
                e[e.RB = 7] = "RB",
                e[e.LeftStick = 8] = "LeftStick",
                e[e.RightStick = 9] = "RightStick"
            }(t = e.Xbox360Button || (e.Xbox360Button = {})),
            function(e) {
                e[e.Up = 0] = "Up",
                e[e.Down = 1] = "Down",
                e[e.Left = 2] = "Left",
                e[e.Right = 3] = "Right"
            }(r = e.Xbox360Dpad || (e.Xbox360Dpad = {}));
            var i = function(i) {
                function n(t, r, n, o) {
                    void 0 === o && (o = !1);
                    var a = i.call(this, t, r, n, 0, 1, 2, 3) || this;
                    return a._leftTrigger = 0,
                    a._rightTrigger = 0,
                    a.onButtonDownObservable = new e.Observable,
                    a.onButtonUpObservable = new e.Observable,
                    a.onPadDownObservable = new e.Observable,
                    a.onPadUpObservable = new e.Observable,
                    a._buttonA = 0,
                    a._buttonB = 0,
                    a._buttonX = 0,
                    a._buttonY = 0,
                    a._buttonBack = 0,
                    a._buttonStart = 0,
                    a._buttonLB = 0,
                    a._buttonRB = 0,
                    a._buttonLeftStick = 0,
                    a._buttonRightStick = 0,
                    a._dPadUp = 0,
                    a._dPadDown = 0,
                    a._dPadLeft = 0,
                    a._dPadRight = 0,
                    a._isXboxOnePad = !1,
                    a.type = e.Gamepad.XBOX,
                    a._isXboxOnePad = o,
                    a
                }
                return o(n, i),
                n.prototype.onlefttriggerchanged = function(e) {
                    this._onlefttriggerchanged = e
                }
                ,
                n.prototype.onrighttriggerchanged = function(e) {
                    this._onrighttriggerchanged = e
                }
                ,
                Object.defineProperty(n.prototype, "leftTrigger", {
                    get: function() {
                        return this._leftTrigger
                    },
                    set: function(e) {
                        this._onlefttriggerchanged && this._leftTrigger !== e && this._onlefttriggerchanged(e),
                        this._leftTrigger = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "rightTrigger", {
                    get: function() {
                        return this._rightTrigger
                    },
                    set: function(e) {
                        this._onrighttriggerchanged && this._rightTrigger !== e && this._onrighttriggerchanged(e),
                        this._rightTrigger = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                n.prototype.onbuttondown = function(e) {
                    this._onbuttondown = e
                }
                ,
                n.prototype.onbuttonup = function(e) {
                    this._onbuttonup = e
                }
                ,
                n.prototype.ondpaddown = function(e) {
                    this._ondpaddown = e
                }
                ,
                n.prototype.ondpadup = function(e) {
                    this._ondpadup = e
                }
                ,
                n.prototype._setButtonValue = function(e, t, r) {
                    return e !== t && (1 === e && (this._onbuttondown && this._onbuttondown(r),
                    this.onButtonDownObservable.notifyObservers(r)),
                    0 === e && (this._onbuttonup && this._onbuttonup(r),
                    this.onButtonUpObservable.notifyObservers(r))),
                    e
                }
                ,
                n.prototype._setDPadValue = function(e, t, r) {
                    return e !== t && (1 === e && (this._ondpaddown && this._ondpaddown(r),
                    this.onPadDownObservable.notifyObservers(r)),
                    0 === e && (this._ondpadup && this._ondpadup(r),
                    this.onPadUpObservable.notifyObservers(r))),
                    e
                }
                ,
                Object.defineProperty(n.prototype, "buttonA", {
                    get: function() {
                        return this._buttonA
                    },
                    set: function(e) {
                        this._buttonA = this._setButtonValue(e, this._buttonA, t.A)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "buttonB", {
                    get: function() {
                        return this._buttonB
                    },
                    set: function(e) {
                        this._buttonB = this._setButtonValue(e, this._buttonB, t.B)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "buttonX", {
                    get: function() {
                        return this._buttonX
                    },
                    set: function(e) {
                        this._buttonX = this._setButtonValue(e, this._buttonX, t.X)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "buttonY", {
                    get: function() {
                        return this._buttonY
                    },
                    set: function(e) {
                        this._buttonY = this._setButtonValue(e, this._buttonY, t.Y)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "buttonStart", {
                    get: function() {
                        return this._buttonStart
                    },
                    set: function(e) {
                        this._buttonStart = this._setButtonValue(e, this._buttonStart, t.Start)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "buttonBack", {
                    get: function() {
                        return this._buttonBack
                    },
                    set: function(e) {
                        this._buttonBack = this._setButtonValue(e, this._buttonBack, t.Back)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "buttonLB", {
                    get: function() {
                        return this._buttonLB
                    },
                    set: function(e) {
                        this._buttonLB = this._setButtonValue(e, this._buttonLB, t.LB)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "buttonRB", {
                    get: function() {
                        return this._buttonRB
                    },
                    set: function(e) {
                        this._buttonRB = this._setButtonValue(e, this._buttonRB, t.RB)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "buttonLeftStick", {
                    get: function() {
                        return this._buttonLeftStick
                    },
                    set: function(e) {
                        this._buttonLeftStick = this._setButtonValue(e, this._buttonLeftStick, t.LeftStick)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "buttonRightStick", {
                    get: function() {
                        return this._buttonRightStick
                    },
                    set: function(e) {
                        this._buttonRightStick = this._setButtonValue(e, this._buttonRightStick, t.RightStick)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "dPadUp", {
                    get: function() {
                        return this._dPadUp
                    },
                    set: function(e) {
                        this._dPadUp = this._setDPadValue(e, this._dPadUp, r.Up)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "dPadDown", {
                    get: function() {
                        return this._dPadDown
                    },
                    set: function(e) {
                        this._dPadDown = this._setDPadValue(e, this._dPadDown, r.Down)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "dPadLeft", {
                    get: function() {
                        return this._dPadLeft
                    },
                    set: function(e) {
                        this._dPadLeft = this._setDPadValue(e, this._dPadLeft, r.Left)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(n.prototype, "dPadRight", {
                    get: function() {
                        return this._dPadRight
                    },
                    set: function(e) {
                        this._dPadRight = this._setDPadValue(e, this._dPadRight, r.Right)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                n.prototype.update = function() {
                    i.prototype.update.call(this),
                    this._isXboxOnePad ? (this.buttonA = this.browserGamepad.buttons[0].value,
                    this.buttonB = this.browserGamepad.buttons[1].value,
                    this.buttonX = this.browserGamepad.buttons[2].value,
                    this.buttonY = this.browserGamepad.buttons[3].value,
                    this.buttonLB = this.browserGamepad.buttons[4].value,
                    this.buttonRB = this.browserGamepad.buttons[5].value,
                    this.leftTrigger = this.browserGamepad.axes[2],
                    this.rightTrigger = this.browserGamepad.axes[5],
                    this.buttonBack = this.browserGamepad.buttons[9].value,
                    this.buttonStart = this.browserGamepad.buttons[8].value,
                    this.buttonLeftStick = this.browserGamepad.buttons[6].value,
                    this.buttonRightStick = this.browserGamepad.buttons[7].value,
                    this.dPadUp = this.browserGamepad.buttons[11].value,
                    this.dPadDown = this.browserGamepad.buttons[12].value,
                    this.dPadLeft = this.browserGamepad.buttons[13].value,
                    this.dPadRight = this.browserGamepad.buttons[14].value) : (this.buttonA = this.browserGamepad.buttons[0].value,
                    this.buttonB = this.browserGamepad.buttons[1].value,
                    this.buttonX = this.browserGamepad.buttons[2].value,
                    this.buttonY = this.browserGamepad.buttons[3].value,
                    this.buttonLB = this.browserGamepad.buttons[4].value,
                    this.buttonRB = this.browserGamepad.buttons[5].value,
                    this.leftTrigger = this.browserGamepad.buttons[6].value,
                    this.rightTrigger = this.browserGamepad.buttons[7].value,
                    this.buttonBack = this.browserGamepad.buttons[8].value,
                    this.buttonStart = this.browserGamepad.buttons[9].value,
                    this.buttonLeftStick = this.browserGamepad.buttons[10].value,
                    this.buttonRightStick = this.browserGamepad.buttons[11].value,
                    this.dPadUp = this.browserGamepad.buttons[12].value,
                    this.dPadDown = this.browserGamepad.buttons[13].value,
                    this.dPadLeft = this.browserGamepad.buttons[14].value,
                    this.dPadRight = this.browserGamepad.buttons[15].value)
                }
                ,
                n.prototype.dispose = function() {
                    i.prototype.dispose.call(this),
                    this.onButtonDownObservable.clear(),
                    this.onButtonUpObservable.clear(),
                    this.onPadDownObservable.clear(),
                    this.onPadUpObservable.clear()
                }
                ,
                n
            }(e.Gamepad);
            e.Xbox360Pad = i
        }(s || (s = {})),
        function(e) {
            var t;
            !function(e) {
                e[e.VIVE = 0] = "VIVE",
                e[e.OCULUS = 1] = "OCULUS",
                e[e.WINDOWS = 2] = "WINDOWS",
                e[e.GEAR_VR = 3] = "GEAR_VR",
                e[e.DAYDREAM = 4] = "DAYDREAM",
                e[e.GENERIC = 5] = "GENERIC"
            }(t = e.PoseEnabledControllerType || (e.PoseEnabledControllerType = {}));
            var r = function() {
                function t() {}
                return t.InitiateController = function(t) {
                    return -1 !== t.id.indexOf("Oculus Touch") ? new e.OculusTouchController(t) : 0 === t.id.indexOf(e.WindowsMotionController.GAMEPAD_ID_PREFIX) ? new e.WindowsMotionController(t) : -1 !== t.id.toLowerCase().indexOf("openvr") ? new e.ViveController(t) : 0 === t.id.indexOf(e.GearVRController.GAMEPAD_ID_PREFIX) || -1 !== t.id.indexOf("Oculus Go") ? new e.GearVRController(t) : 0 === t.id.indexOf(e.DaydreamController.GAMEPAD_ID_PREFIX) ? new e.DaydreamController(t) : new e.GenericController(t)
                }
                ,
                t
            }();
            e.PoseEnabledControllerHelper = r;
            var i = function(r) {
                function i(i) {
                    var n = r.call(this, i.id, i.index, i) || this;
                    return n._deviceRoomPosition = e.Vector3.Zero(),
                    n._deviceRoomRotationQuaternion = new e.Quaternion,
                    n.devicePosition = e.Vector3.Zero(),
                    n.deviceRotationQuaternion = new e.Quaternion,
                    n.deviceScaleFactor = 1,
                    n._trackPosition = !0,
                    n._maxRotationDistFromHeadset = Math.PI / 5,
                    n._draggedRoomRotation = 0,
                    n._leftHandSystemQuaternion = new e.Quaternion,
                    n._deviceToWorld = e.Matrix.Identity(),
                    n._pointingPoseNode = null,
                    n._workingMatrix = e.Matrix.Identity(),
                    n._meshAttachedObservable = new e.Observable,
                    n.type = e.Gamepad.POSE_ENABLED,
                    n.controllerType = t.GENERIC,
                    n.position = e.Vector3.Zero(),
                    n.rotationQuaternion = new e.Quaternion,
                    n._calculatedPosition = e.Vector3.Zero(),
                    n._calculatedRotation = new e.Quaternion,
                    e.Quaternion.RotationYawPitchRollToRef(Math.PI, 0, 0, n._leftHandSystemQuaternion),
                    n
                }
                return o(i, r),
                i.prototype._disableTrackPosition = function(e) {
                    this._trackPosition && (this._calculatedPosition.copyFrom(e),
                    this._trackPosition = !1)
                }
                ,
                i.prototype.update = function() {
                    r.prototype.update.call(this),
                    this._updatePoseAndMesh()
                }
                ,
                i.prototype._updatePoseAndMesh = function() {
                    var t = this.browserGamepad.pose;
                    if ((this.updateFromDevice(t),
                    !this._trackPosition && e.Engine.LastCreatedScene && e.Engine.LastCreatedScene.activeCamera && e.Engine.LastCreatedScene.activeCamera.devicePosition) && ((r = e.Engine.LastCreatedScene.activeCamera)._computeDevicePosition(),
                    this._deviceToWorld.setTranslation(r.devicePosition),
                    r.deviceRotationQuaternion)) {
                        var r;
                        (r = r)._deviceRoomRotationQuaternion.toEulerAnglesToRef(e.Tmp.Vector3[0]);
                        var i = Math.atan2(Math.sin(e.Tmp.Vector3[0].y - this._draggedRoomRotation), Math.cos(e.Tmp.Vector3[0].y - this._draggedRoomRotation));
                        if (Math.abs(i) > this._maxRotationDistFromHeadset) {
                            var n = i - (i < 0 ? -this._maxRotationDistFromHeadset : this._maxRotationDistFromHeadset);
                            this._draggedRoomRotation += n;
                            var o = Math.sin(-n)
                              , a = Math.cos(-n);
                            this._calculatedPosition.x = this._calculatedPosition.x * a - this._calculatedPosition.z * o,
                            this._calculatedPosition.z = this._calculatedPosition.x * o + this._calculatedPosition.z * a
                        }
                    }
                    e.Vector3.TransformCoordinatesToRef(this._calculatedPosition, this._deviceToWorld, this.devicePosition),
                    this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),
                    e.Quaternion.FromRotationMatrixToRef(this._workingMatrix, this.deviceRotationQuaternion),
                    this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),
                    this._mesh && (this._mesh.position.copyFrom(this.devicePosition),
                    this._mesh.rotationQuaternion && this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))
                }
                ,
                i.prototype.updateFromDevice = function(e) {
                    if (e) {
                        this.rawPose = e,
                        e.position && (this._deviceRoomPosition.copyFromFloats(e.position[0], e.position[1], -e.position[2]),
                        this._mesh && this._mesh.getScene().useRightHandedSystem && (this._deviceRoomPosition.z *= -1),
                        this._trackPosition && this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor, this._calculatedPosition),
                        this._calculatedPosition.addInPlace(this.position));
                        var t = this.rawPose;
                        e.orientation && t.orientation && (this._deviceRoomRotationQuaternion.copyFromFloats(t.orientation[0], t.orientation[1], -t.orientation[2], -t.orientation[3]),
                        this._mesh && (this._mesh.getScene().useRightHandedSystem ? (this._deviceRoomRotationQuaternion.z *= -1,
                        this._deviceRoomRotationQuaternion.w *= -1) : this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion, this._deviceRoomRotationQuaternion)),
                        this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion, this._calculatedRotation))
                    }
                }
                ,
                i.prototype.attachToMesh = function(t) {
                    if (this._mesh && (this._mesh.parent = null),
                    this._mesh = t,
                    this._poseControlledCamera && (this._mesh.parent = this._poseControlledCamera),
                    this._mesh.rotationQuaternion || (this._mesh.rotationQuaternion = new e.Quaternion),
                    this._updatePoseAndMesh(),
                    this._pointingPoseNode) {
                        for (var r = [], i = this._pointingPoseNode; i.parent; )
                            r.push(i.parent),
                            i = i.parent;
                        r.reverse().forEach((function(e) {
                            e.computeWorldMatrix(!0)
                        }
                        ))
                    }
                    this._meshAttachedObservable.notifyObservers(t)
                }
                ,
                i.prototype.attachToPoseControlledCamera = function(e) {
                    this._poseControlledCamera = e,
                    this._mesh && (this._mesh.parent = this._poseControlledCamera)
                }
                ,
                i.prototype.dispose = function() {
                    this._mesh && this._mesh.dispose(),
                    this._mesh = null,
                    r.prototype.dispose.call(this)
                }
                ,
                Object.defineProperty(i.prototype, "mesh", {
                    get: function() {
                        return this._mesh
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getForwardRay = function(t) {
                    if (void 0 === t && (t = 100),
                    !this.mesh)
                        return new e.Ray(e.Vector3.Zero(),new e.Vector3(0,0,1),t);
                    var r = this._pointingPoseNode ? this._pointingPoseNode.getWorldMatrix() : this.mesh.getWorldMatrix()
                      , i = r.getTranslation()
                      , n = new e.Vector3(0,0,-1)
                      , o = e.Vector3.TransformNormal(n, r)
                      , a = e.Vector3.Normalize(o);
                    return new e.Ray(i,a,t)
                }
                ,
                i.POINTING_POSE = "POINTING_POSE",
                i
            }(e.Gamepad);
            e.PoseEnabledController = i
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r) {
                    var i = t.call(this, r) || this;
                    return i.onTriggerStateChangedObservable = new e.Observable,
                    i.onMainButtonStateChangedObservable = new e.Observable,
                    i.onSecondaryButtonStateChangedObservable = new e.Observable,
                    i.onPadStateChangedObservable = new e.Observable,
                    i.onPadValuesChangedObservable = new e.Observable,
                    i.pad = {
                        x: 0,
                        y: 0
                    },
                    i._changes = {
                        pressChanged: !1,
                        touchChanged: !1,
                        valueChanged: !1,
                        changed: !1
                    },
                    i._buttons = new Array(r.buttons.length),
                    i.hand = r.hand,
                    i
                }
                return o(r, t),
                r.prototype.onButtonStateChange = function(e) {
                    this._onButtonStateChange = e
                }
                ,
                Object.defineProperty(r.prototype, "defaultModel", {
                    get: function() {
                        return this._defaultModel
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.update = function() {
                    t.prototype.update.call(this);
                    for (var e = 0; e < this._buttons.length; e++)
                        this._setButtonValue(this.browserGamepad.buttons[e], this._buttons[e], e);
                    this.leftStick.x === this.pad.x && this.leftStick.y === this.pad.y || (this.pad.x = this.leftStick.x,
                    this.pad.y = this.leftStick.y,
                    this.onPadValuesChangedObservable.notifyObservers(this.pad))
                }
                ,
                r.prototype._setButtonValue = function(e, t, r) {
                    e || (e = {
                        pressed: !1,
                        touched: !1,
                        value: 0
                    }),
                    t ? (this._checkChanges(e, t),
                    this._changes.changed && (this._onButtonStateChange && this._onButtonStateChange(this.index, r, e),
                    this._handleButtonChange(r, e, this._changes)),
                    this._buttons[r].pressed = e.pressed,
                    this._buttons[r].touched = e.touched,
                    this._buttons[r].value = e.value < 1e-8 ? 0 : e.value) : this._buttons[r] = {
                        pressed: e.pressed,
                        touched: e.touched,
                        value: e.value
                    }
                }
                ,
                r.prototype._checkChanges = function(e, t) {
                    return this._changes.pressChanged = e.pressed !== t.pressed,
                    this._changes.touchChanged = e.touched !== t.touched,
                    this._changes.valueChanged = e.value !== t.value,
                    this._changes.changed = this._changes.pressChanged || this._changes.touchChanged || this._changes.valueChanged,
                    this._changes
                }
                ,
                r.prototype.dispose = function() {
                    t.prototype.dispose.call(this),
                    this.onTriggerStateChangedObservable.clear(),
                    this.onMainButtonStateChangedObservable.clear(),
                    this.onSecondaryButtonStateChangedObservable.clear(),
                    this.onPadStateChangedObservable.clear(),
                    this.onPadValuesChangedObservable.clear()
                }
                ,
                r
            }(e.PoseEnabledController);
            e.WebVRController = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r) {
                    var i = t.call(this, r) || this;
                    return i.onSecondaryTriggerStateChangedObservable = new e.Observable,
                    i.onThumbRestChangedObservable = new e.Observable,
                    i.controllerType = e.PoseEnabledControllerType.OCULUS,
                    i
                }
                return o(r, t),
                r.prototype.initControllerMesh = function(t, i) {
                    var n, o = this;
                    n = "left" === this.hand ? r.MODEL_LEFT_FILENAME : r.MODEL_RIGHT_FILENAME,
                    e.SceneLoader.ImportMesh("", r.MODEL_BASE_URL, n, t, (function(e) {
                        o._defaultModel = e[1],
                        o.attachToMesh(o._defaultModel),
                        i && i(o._defaultModel)
                    }
                    ))
                }
                ,
                Object.defineProperty(r.prototype, "onAButtonStateChangedObservable", {
                    get: function() {
                        if ("right" === this.hand)
                            return this.onMainButtonStateChangedObservable;
                        throw new Error("No A button on left hand")
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "onBButtonStateChangedObservable", {
                    get: function() {
                        if ("right" === this.hand)
                            return this.onSecondaryButtonStateChangedObservable;
                        throw new Error("No B button on left hand")
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "onXButtonStateChangedObservable", {
                    get: function() {
                        if ("left" === this.hand)
                            return this.onMainButtonStateChangedObservable;
                        throw new Error("No X button on right hand")
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "onYButtonStateChangedObservable", {
                    get: function() {
                        if ("left" === this.hand)
                            return this.onSecondaryButtonStateChangedObservable;
                        throw new Error("No Y button on right hand")
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._handleButtonChange = function(e, t, r) {
                    var i = t
                      , n = "right" === this.hand ? -1 : 1;
                    switch (e) {
                    case 0:
                        return void this.onPadStateChangedObservable.notifyObservers(i);
                    case 1:
                        return this._defaultModel && (this._defaultModel.getChildren()[3].rotation.x = .2 * -i.value,
                        this._defaultModel.getChildren()[3].position.y = .005 * -i.value,
                        this._defaultModel.getChildren()[3].position.z = .005 * -i.value),
                        void this.onTriggerStateChangedObservable.notifyObservers(i);
                    case 2:
                        return this._defaultModel && (this._defaultModel.getChildren()[4].position.x = n * i.value * .0035),
                        void this.onSecondaryTriggerStateChangedObservable.notifyObservers(i);
                    case 3:
                        return this._defaultModel && (i.pressed ? this._defaultModel.getChildren()[1].position.y = -.001 : this._defaultModel.getChildren()[1].position.y = 0),
                        void this.onMainButtonStateChangedObservable.notifyObservers(i);
                    case 4:
                        return this._defaultModel && (i.pressed ? this._defaultModel.getChildren()[2].position.y = -.001 : this._defaultModel.getChildren()[2].position.y = 0),
                        void this.onSecondaryButtonStateChangedObservable.notifyObservers(i);
                    case 5:
                        return void this.onThumbRestChangedObservable.notifyObservers(i)
                    }
                }
                ,
                r.MODEL_BASE_URL = "https://controllers.babylonjs.com/oculus/",
                r.MODEL_LEFT_FILENAME = "left.babylon",
                r.MODEL_RIGHT_FILENAME = "right.babylon",
                r
            }(e.WebVRController);
            e.OculusTouchController = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r) {
                    var i = t.call(this, r) || this;
                    return i.controllerType = e.PoseEnabledControllerType.VIVE,
                    i._invertLeftStickY = !0,
                    i
                }
                return o(r, t),
                r.prototype.initControllerMesh = function(t, i) {
                    var n = this;
                    e.SceneLoader.ImportMesh("", r.MODEL_BASE_URL, r.MODEL_FILENAME, t, (function(e) {
                        n._defaultModel = e[1],
                        n.attachToMesh(n._defaultModel),
                        i && i(n._defaultModel)
                    }
                    ))
                }
                ,
                Object.defineProperty(r.prototype, "onLeftButtonStateChangedObservable", {
                    get: function() {
                        return this.onMainButtonStateChangedObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "onRightButtonStateChangedObservable", {
                    get: function() {
                        return this.onMainButtonStateChangedObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "onMenuButtonStateChangedObservable", {
                    get: function() {
                        return this.onSecondaryButtonStateChangedObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._handleButtonChange = function(e, t, r) {
                    var i = t;
                    switch (e) {
                    case 0:
                        return void this.onPadStateChangedObservable.notifyObservers(i);
                    case 1:
                        return this._defaultModel && (this._defaultModel.getChildren()[6].rotation.x = .15 * -i.value),
                        void this.onTriggerStateChangedObservable.notifyObservers(i);
                    case 2:
                        return void this.onMainButtonStateChangedObservable.notifyObservers(i);
                    case 3:
                        return this._defaultModel && (i.pressed ? this._defaultModel.getChildren()[2].position.y = -.001 : this._defaultModel.getChildren()[2].position.y = 0),
                        void this.onSecondaryButtonStateChangedObservable.notifyObservers(i)
                    }
                }
                ,
                r.MODEL_BASE_URL = "https://controllers.babylonjs.com/vive/",
                r.MODEL_FILENAME = "wand.babylon",
                r
            }(e.WebVRController);
            e.ViveController = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(e) {
                    return t.call(this, e) || this
                }
                return o(r, t),
                r.prototype.initControllerMesh = function(t, i) {
                    var n = this;
                    e.SceneLoader.ImportMesh("", r.MODEL_BASE_URL, r.MODEL_FILENAME, t, (function(e) {
                        n._defaultModel = e[1],
                        n.attachToMesh(n._defaultModel),
                        i && i(n._defaultModel)
                    }
                    ))
                }
                ,
                r.prototype._handleButtonChange = function(e, t, r) {
                    console.log("Button id: " + e + "state: "),
                    console.dir(t)
                }
                ,
                r.MODEL_BASE_URL = "https://controllers.babylonjs.com/generic/",
                r.MODEL_FILENAME = "generic.babylon",
                r
            }(e.WebVRController);
            e.GenericController = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                this.buttonMeshes = {},
                this.axisMeshes = {}
            }
              , r = function(r) {
                function i(t) {
                    var i = r.call(this, t) || this;
                    return i._mapping = {
                        buttons: ["thumbstick", "trigger", "grip", "menu", "trackpad"],
                        buttonMeshNames: {
                            trigger: "SELECT",
                            menu: "MENU",
                            grip: "GRASP",
                            thumbstick: "THUMBSTICK_PRESS",
                            trackpad: "TOUCHPAD_PRESS"
                        },
                        buttonObservableNames: {
                            trigger: "onTriggerStateChangedObservable",
                            menu: "onSecondaryButtonStateChangedObservable",
                            grip: "onMainButtonStateChangedObservable",
                            thumbstick: "onPadStateChangedObservable",
                            trackpad: "onTrackpadChangedObservable"
                        },
                        axisMeshNames: ["THUMBSTICK_X", "THUMBSTICK_Y", "TOUCHPAD_TOUCH_X", "TOUCHPAD_TOUCH_Y"],
                        pointingPoseMeshName: e.PoseEnabledController.POINTING_POSE
                    },
                    i.onTrackpadChangedObservable = new e.Observable,
                    i.onTrackpadValuesChangedObservable = new e.Observable,
                    i.trackpad = {
                        x: 0,
                        y: 0
                    },
                    i.controllerType = e.PoseEnabledControllerType.WINDOWS,
                    i._loadedMeshInfo = null,
                    i
                }
                return o(i, r),
                Object.defineProperty(i.prototype, "onTriggerButtonStateChangedObservable", {
                    get: function() {
                        return this.onTriggerStateChangedObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "onMenuButtonStateChangedObservable", {
                    get: function() {
                        return this.onSecondaryButtonStateChangedObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "onGripButtonStateChangedObservable", {
                    get: function() {
                        return this.onMainButtonStateChangedObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "onThumbstickButtonStateChangedObservable", {
                    get: function() {
                        return this.onPadStateChangedObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "onTouchpadButtonStateChangedObservable", {
                    get: function() {
                        return this.onTrackpadChangedObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "onTouchpadValuesChangedObservable", {
                    get: function() {
                        return this.onTrackpadValuesChangedObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype._updateTrackpad = function() {
                    !this.browserGamepad.axes || this.browserGamepad.axes[2] == this.trackpad.x && this.browserGamepad.axes[3] == this.trackpad.y || (this.trackpad.x = this.browserGamepad.axes[2],
                    this.trackpad.y = this.browserGamepad.axes[3],
                    this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))
                }
                ,
                i.prototype.update = function() {
                    if (r.prototype.update.call(this),
                    this.browserGamepad.axes && (this._updateTrackpad(),
                    this._loadedMeshInfo))
                        for (var e = 0; e < this._mapping.axisMeshNames.length; e++)
                            this._lerpAxisTransform(e, this.browserGamepad.axes[e])
                }
                ,
                i.prototype._handleButtonChange = function(e, t, r) {
                    var i = this._mapping.buttons[e];
                    if (i) {
                        this._updateTrackpad();
                        var n = this[this._mapping.buttonObservableNames[i]];
                        n && n.notifyObservers(t),
                        this._lerpButtonTransform(i, t.value)
                    }
                }
                ,
                i.prototype._lerpButtonTransform = function(t, r) {
                    if (this._loadedMeshInfo) {
                        var i = this._loadedMeshInfo.buttonMeshes[t];
                        i.unpressed.rotationQuaternion && i.pressed.rotationQuaternion && i.value.rotationQuaternion && (e.Quaternion.SlerpToRef(i.unpressed.rotationQuaternion, i.pressed.rotationQuaternion, r, i.value.rotationQuaternion),
                        e.Vector3.LerpToRef(i.unpressed.position, i.pressed.position, r, i.value.position))
                    }
                }
                ,
                i.prototype._lerpAxisTransform = function(t, r) {
                    if (this._loadedMeshInfo) {
                        var i = this._loadedMeshInfo.axisMeshes[t];
                        if (i && i.min.rotationQuaternion && i.max.rotationQuaternion && i.value.rotationQuaternion) {
                            var n = .5 * r + .5;
                            e.Quaternion.SlerpToRef(i.min.rotationQuaternion, i.max.rotationQuaternion, n, i.value.rotationQuaternion),
                            e.Vector3.LerpToRef(i.min.position, i.max.position, n, i.value.position)
                        }
                    }
                }
                ,
                i.prototype.initControllerMesh = function(t, r, n) {
                    var o, a, s = this;
                    if (void 0 === n && (n = !1),
                    e.SceneLoader.IsPluginForExtensionAvailable(".glb")) {
                        var y = "default";
                        if (this.id && !n) {
                            var l = this.id.match(i.GAMEPAD_ID_PATTERN);
                            y = l && l[0] || y
                        }
                        a = "left" === this.hand ? i.MODEL_LEFT_FILENAME : i.MODEL_RIGHT_FILENAME,
                        o = i.MODEL_BASE_URL + y + "/"
                    } else
                        e.Tools.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),
                        o = e.GenericController.MODEL_BASE_URL,
                        a = e.GenericController.MODEL_FILENAME;
                    e.SceneLoader.ImportMesh("", o, a, t, (function(e) {
                        s._loadedMeshInfo = s.processModel(t, e),
                        s._loadedMeshInfo && (s._defaultModel = s._loadedMeshInfo.rootNode,
                        s.attachToMesh(s._defaultModel),
                        r && r(s._defaultModel))
                    }
                    ), null, (function(t, i) {
                        e.Tools.Log(i),
                        e.Tools.Warn("Failed to retrieve controller model from the remote server: " + o + a),
                        n || s.initControllerMesh(t, r, !0)
                    }
                    ))
                }
                ,
                i.prototype.processModel = function(t, r) {
                    for (var i = null, n = new e.Mesh(this.id + " " + this.hand,t), o = null, a = 0; a < r.length; a++) {
                        var s = r[a];
                        if (!s.parent) {
                            s.isPickable = !1,
                            o = s;
                            break
                        }
                    }
                    return o ? (o.setParent(n),
                    i = this.createMeshInfo(n)) : e.Tools.Warn("Could not find root node in model file."),
                    i
                }
                ,
                i.prototype.createMeshInfo = function(r) {
                    var i, n = new t;
                    for (n.rootNode = r,
                    n.buttonMeshes = {},
                    n.axisMeshes = {},
                    i = 0; i < this._mapping.buttons.length; i++) {
                        var o = this._mapping.buttonMeshNames[this._mapping.buttons[i]];
                        if (o) {
                            var a = h(r, o);
                            if (a) {
                                var s = {
                                    index: i,
                                    value: u(a, "VALUE"),
                                    pressed: u(a, "PRESSED"),
                                    unpressed: u(a, "UNPRESSED")
                                };
                                s.value && s.pressed && s.unpressed ? n.buttonMeshes[this._mapping.buttons[i]] = s : e.Tools.Warn("Missing button submesh under mesh with name: " + o + "(VALUE: " + !!s.value + ", PRESSED: " + !!s.pressed + ", UNPRESSED:" + !!s.unpressed + ")")
                            } else
                                e.Tools.Warn("Missing button mesh with name: " + o)
                        } else
                            e.Tools.Log("Skipping unknown button at index: " + i + " with mapped name: " + this._mapping.buttons[i])
                    }
                    for (i = 0; i < this._mapping.axisMeshNames.length; i++) {
                        var y = this._mapping.axisMeshNames[i];
                        if (y) {
                            var l = h(r, y);
                            if (l) {
                                var c = {
                                    index: i,
                                    value: u(l, "VALUE"),
                                    min: u(l, "MIN"),
                                    max: u(l, "MAX")
                                };
                                c.value && c.min && c.max ? n.axisMeshes[i] = c : e.Tools.Warn("Missing axis submesh under mesh with name: " + y + "(VALUE: " + !!c.value + ", MIN: " + !!c.min + ", MAX:" + !!c.max + ")")
                            } else
                                e.Tools.Warn("Missing axis mesh with name: " + y)
                        } else
                            e.Tools.Log("Skipping unknown axis at index: " + i)
                    }
                    return n.pointingPoseNode = h(r, this._mapping.pointingPoseMeshName),
                    n.pointingPoseNode ? this._pointingPoseNode = n.pointingPoseNode : e.Tools.Warn("Missing pointing pose mesh with name: " + this._mapping.pointingPoseMeshName),
                    n;
                    function h(e, t) {
                        return e.getChildMeshes(!1, (function(e) {
                            return e.name === t
                        }
                        ))[0]
                    }
                    function u(e, t) {
                        return e.getChildMeshes(!0, (function(e) {
                            return e.name == t
                        }
                        ))[0]
                    }
                }
                ,
                i.prototype.getForwardRay = function(t) {
                    if (void 0 === t && (t = 100),
                    !this._loadedMeshInfo || !this._loadedMeshInfo.pointingPoseNode)
                        return r.prototype.getForwardRay.call(this, t);
                    var i = this._loadedMeshInfo.pointingPoseNode.getWorldMatrix()
                      , n = i.getTranslation()
                      , o = new e.Vector3(0,0,-1)
                      , a = e.Vector3.TransformNormal(o, i)
                      , s = e.Vector3.Normalize(a);
                    return new e.Ray(n,s,t)
                }
                ,
                i.prototype.dispose = function() {
                    r.prototype.dispose.call(this),
                    this.onTrackpadChangedObservable.clear()
                }
                ,
                i.MODEL_BASE_URL = "https://controllers.babylonjs.com/microsoft/",
                i.MODEL_LEFT_FILENAME = "left.glb",
                i.MODEL_RIGHT_FILENAME = "right.glb",
                i.GAMEPAD_ID_PREFIX = "Spatial Controller (Spatial Interaction Source) ",
                i.GAMEPAD_ID_PATTERN = /([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,
                i
            }(e.WebVRController);
            e.WindowsMotionController = r
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r) {
                    var i = t.call(this, r) || this;
                    return i._buttonIndexToObservableNameMap = ["onTrackpadChangedObservable", "onTriggerStateChangedObservable"],
                    i.controllerType = e.PoseEnabledControllerType.GEAR_VR,
                    i._calculatedPosition = new e.Vector3("left" == i.hand ? -.15 : .15,-.5,.25),
                    i._disableTrackPosition(i._calculatedPosition),
                    i
                }
                return o(r, t),
                r.prototype.initControllerMesh = function(t, i) {
                    var n = this;
                    e.SceneLoader.ImportMesh("", r.MODEL_BASE_URL, r.MODEL_FILENAME, t, (function(r) {
                        var o = new e.Mesh("",t);
                        r[1].parent = o,
                        r[1].position.z = -.15,
                        n._defaultModel = o,
                        n.attachToMesh(n._defaultModel),
                        i && i(n._defaultModel)
                    }
                    ))
                }
                ,
                r.prototype._handleButtonChange = function(e, t, r) {
                    if (e < this._buttonIndexToObservableNameMap.length) {
                        var i = this[this._buttonIndexToObservableNameMap[e]];
                        i && i.notifyObservers(t)
                    }
                }
                ,
                r.MODEL_BASE_URL = "https://controllers.babylonjs.com/generic/",
                r.MODEL_FILENAME = "generic.babylon",
                r.GAMEPAD_ID_PREFIX = "Gear VR",
                r
            }(e.WebVRController);
            e.GearVRController = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r) {
                    var i = t.call(this, r) || this;
                    return i.controllerType = e.PoseEnabledControllerType.DAYDREAM,
                    i
                }
                return o(r, t),
                r.prototype.initControllerMesh = function(t, i) {
                    var n = this;
                    e.SceneLoader.ImportMesh("", r.MODEL_BASE_URL, r.MODEL_FILENAME, t, (function(e) {
                        n._defaultModel = e[1],
                        n.attachToMesh(n._defaultModel),
                        i && i(n._defaultModel)
                    }
                    ))
                }
                ,
                r.prototype._handleButtonChange = function(t, r, i) {
                    if (0 === t) {
                        var n = this.onTriggerStateChangedObservable;
                        n && n.notifyObservers(r)
                    } else
                        e.Tools.Warn("Unrecognized Daydream button index: " + t)
                }
                ,
                r.MODEL_BASE_URL = "https://controllers.babylonjs.com/generic/",
                r.MODEL_FILENAME = "generic.babylon",
                r.GAMEPAD_ID_PREFIX = "Daydream",
                r
            }(e.WebVRController);
            e.DaydreamController = t
        }(s || (s = {})),
        function(e) {
            Object.defineProperty(e.Scene.prototype, "gamepadManager", {
                get: function() {
                    if (!this._gamepadManager) {
                        this._gamepadManager = new e.GamepadManager(this);
                        var r = this._getComponent(e.SceneComponentConstants.NAME_GAMEPAD);
                        r || (r = new t(this),
                        this._addComponent(r))
                    }
                    return this._gamepadManager
                },
                enumerable: !0,
                configurable: !0
            }),
            e.FreeCameraInputsManager.prototype.addGamepad = function() {
                return this.add(new e.FreeCameraGamepadInput),
                this
            }
            ,
            e.ArcRotateCameraInputsManager.prototype.addGamepad = function() {
                return this.add(new e.ArcRotateCameraGamepadInput),
                this
            }
            ;
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_GAMEPAD,
                    this.scene = t
                }
                return t.prototype.register = function() {
                    this.scene._beforeCameraUpdateStage.registerStep(e.SceneComponentConstants.STEP_BEFORECAMERAUPDATE_GAMEPAD, this, this._beforeCameraUpdate)
                }
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.dispose = function() {
                    var e = this.scene._gamepadManager;
                    e && (e.dispose(),
                    this.scene._gamepadManager = null)
                }
                ,
                t.prototype._beforeCameraUpdate = function() {
                    var e = this.scene._gamepadManager;
                    e && e._isMonitoring && e._checkGamepadsStatus()
                }
                ,
                t
            }();
            e.GamepadSystemSceneComponent = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("FollowCamera", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            )),
            e.Node.AddNodeConstructor("ArcFollowCamera", (function(e, t) {
                return function() {
                    return new r(e,0,0,1,null,t)
                }
            }
            ));
            var t = function(t) {
                function r(e, r, i, n) {
                    void 0 === n && (n = null);
                    var o = t.call(this, e, r, i) || this;
                    return o.radius = 12,
                    o.rotationOffset = 0,
                    o.heightOffset = 4,
                    o.cameraAcceleration = .05,
                    o.maxCameraSpeed = 20,
                    o.lockedTarget = n,
                    o
                }
                return o(r, t),
                r.prototype._follow = function(t) {
                    if (t) {
                        var r;
                        if (t.rotationQuaternion) {
                            var i = new e.Matrix;
                            t.rotationQuaternion.toRotationMatrix(i),
                            r = Math.atan2(i.m[8], i.m[10])
                        } else
                            r = t.rotation.y;
                        var n = e.Tools.ToRadians(this.rotationOffset) + r
                          , o = t.getAbsolutePosition()
                          , a = o.x + Math.sin(n) * this.radius
                          , s = o.z + Math.cos(n) * this.radius
                          , y = a - this.position.x
                          , l = o.y + this.heightOffset - this.position.y
                          , c = s - this.position.z
                          , h = y * this.cameraAcceleration * 2
                          , u = l * this.cameraAcceleration
                          , d = c * this.cameraAcceleration * 2;
                        (h > this.maxCameraSpeed || h < -this.maxCameraSpeed) && (h = h < 1 ? -this.maxCameraSpeed : this.maxCameraSpeed),
                        (u > this.maxCameraSpeed || u < -this.maxCameraSpeed) && (u = u < 1 ? -this.maxCameraSpeed : this.maxCameraSpeed),
                        (d > this.maxCameraSpeed || d < -this.maxCameraSpeed) && (d = d < 1 ? -this.maxCameraSpeed : this.maxCameraSpeed),
                        this.position = new e.Vector3(this.position.x + h,this.position.y + u,this.position.z + d),
                        this.setTarget(o)
                    }
                }
                ,
                r.prototype._checkInputs = function() {
                    t.prototype._checkInputs.call(this),
                    this.lockedTarget && this._follow(this.lockedTarget)
                }
                ,
                r.prototype.getClassName = function() {
                    return "FollowCamera"
                }
                ,
                n([e.serialize()], r.prototype, "radius", void 0),
                n([e.serialize()], r.prototype, "rotationOffset", void 0),
                n([e.serialize()], r.prototype, "heightOffset", void 0),
                n([e.serialize()], r.prototype, "cameraAcceleration", void 0),
                n([e.serialize()], r.prototype, "maxCameraSpeed", void 0),
                n([e.serializeAsMeshReference("lockedTargetId")], r.prototype, "lockedTarget", void 0),
                r
            }(e.TargetCamera);
            e.FollowCamera = t;
            var r = function(t) {
                function r(r, i, n, o, a, s) {
                    var y = t.call(this, r, e.Vector3.Zero(), s) || this;
                    return y.alpha = i,
                    y.beta = n,
                    y.radius = o,
                    y.target = a,
                    y._cartesianCoordinates = e.Vector3.Zero(),
                    y._follow(),
                    y
                }
                return o(r, t),
                r.prototype._follow = function() {
                    if (this.target) {
                        this._cartesianCoordinates.x = this.radius * Math.cos(this.alpha) * Math.cos(this.beta),
                        this._cartesianCoordinates.y = this.radius * Math.sin(this.beta),
                        this._cartesianCoordinates.z = this.radius * Math.sin(this.alpha) * Math.cos(this.beta);
                        var e = this.target.getAbsolutePosition();
                        this.position = e.add(this._cartesianCoordinates),
                        this.setTarget(e)
                    }
                }
                ,
                r.prototype._checkInputs = function() {
                    t.prototype._checkInputs.call(this),
                    this._follow()
                }
                ,
                r.prototype.getClassName = function() {
                    return "ArcFollowCamera"
                }
                ,
                r
            }(e.TargetCamera);
            e.ArcFollowCamera = r
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t(t, r, i) {
                    var n = e.call(this, t, r, i) || this;
                    return n.inputs.addGamepad(),
                    n
                }
                return o(t, e),
                Object.defineProperty(t.prototype, "gamepadAngularSensibility", {
                    get: function() {
                        var e = this.inputs.attached.gamepad;
                        return e ? e.gamepadAngularSensibility : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.gamepad;
                        t && (t.gamepadAngularSensibility = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "gamepadMoveSensibility", {
                    get: function() {
                        var e = this.inputs.attached.gamepad;
                        return e ? e.gamepadMoveSensibility : 0
                    },
                    set: function(e) {
                        var t = this.inputs.attached.gamepad;
                        t && (t.gamepadMoveSensibility = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getClassName = function() {
                    return "UniversalCamera"
                }
                ,
                t
            }(e.TouchCamera);
            e.UniversalCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("GamepadCamera", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(e) {
                function t(t, r, i) {
                    return e.call(this, t, r, i) || this
                }
                return o(t, e),
                t.prototype.getClassName = function() {
                    return "GamepadCamera"
                }
                ,
                t
            }(e.UniversalCamera);
            e.GamepadCamera = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {
                    this._renderPipelines = {}
                }
                return e.prototype.addPipeline = function(e) {
                    this._renderPipelines[e._name] = e
                }
                ,
                e.prototype.attachCamerasToRenderPipeline = function(e, t, r) {
                    void 0 === r && (r = !1);
                    var i = this._renderPipelines[e];
                    i && i._attachCameras(t, r)
                }
                ,
                e.prototype.detachCamerasFromRenderPipeline = function(e, t) {
                    var r = this._renderPipelines[e];
                    r && r._detachCameras(t)
                }
                ,
                e.prototype.enableEffectInPipeline = function(e, t, r) {
                    var i = this._renderPipelines[e];
                    i && i._enableEffect(t, r)
                }
                ,
                e.prototype.disableEffectInPipeline = function(e, t, r) {
                    var i = this._renderPipelines[e];
                    i && i._disableEffect(t, r)
                }
                ,
                e.prototype.update = function() {
                    for (var e in this._renderPipelines)
                        if (this._renderPipelines.hasOwnProperty(e)) {
                            var t = this._renderPipelines[e];
                            t.isSupported ? t._update() : (t.dispose(),
                            delete this._renderPipelines[e])
                        }
                }
                ,
                e.prototype._rebuild = function() {
                    for (var e in this._renderPipelines) {
                        if (this._renderPipelines.hasOwnProperty(e))
                            this._renderPipelines[e]._rebuild()
                    }
                }
                ,
                e.prototype.dispose = function() {
                    for (var e in this._renderPipelines) {
                        if (this._renderPipelines.hasOwnProperty(e))
                            this._renderPipelines[e].dispose()
                    }
                }
                ,
                e
            }();
            e.PostProcessRenderPipelineManager = t
        }(s || (s = {})),
        function(e) {
            Object.defineProperty(e.Scene.prototype, "postProcessRenderPipelineManager", {
                get: function() {
                    if (!this._postProcessRenderPipelineManager) {
                        var r = this._getComponent(e.SceneComponentConstants.NAME_POSTPROCESSRENDERPIPELINEMANAGER);
                        r || (r = new t(this),
                        this._addComponent(r)),
                        this._postProcessRenderPipelineManager = new e.PostProcessRenderPipelineManager
                    }
                    return this._postProcessRenderPipelineManager
                },
                enumerable: !0,
                configurable: !0
            });
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_POSTPROCESSRENDERPIPELINEMANAGER,
                    this.scene = t
                }
                return t.prototype.register = function() {
                    this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER, this, this._gatherRenderTargets)
                }
                ,
                t.prototype.rebuild = function() {
                    this.scene._postProcessRenderPipelineManager && this.scene._postProcessRenderPipelineManager._rebuild()
                }
                ,
                t.prototype.dispose = function() {
                    this.scene._postProcessRenderPipelineManager && this.scene._postProcessRenderPipelineManager.dispose()
                }
                ,
                t.prototype._gatherRenderTargets = function(e) {
                    this.scene._postProcessRenderPipelineManager && this.scene._postProcessRenderPipelineManager.update()
                }
                ,
                t
            }();
            e.PostProcessRenderPipelineManagerSceneComponent = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t, r, i) {
                    this._name = t,
                    this._singleInstance = i || !0,
                    this._getPostProcesses = r,
                    this._cameras = {},
                    this._indicesForCamera = {},
                    this._postProcesses = {}
                }
                return Object.defineProperty(t.prototype, "isSupported", {
                    get: function() {
                        for (var e in this._postProcesses)
                            if (this._postProcesses.hasOwnProperty(e))
                                for (var t = this._postProcesses[e], r = 0; r < t.length; r++)
                                    if (!t[r].isSupported)
                                        return !1;
                        return !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._update = function() {}
                ,
                t.prototype._attachCameras = function(t) {
                    var r, i = this, n = e.Tools.MakeArray(t || this._cameras);
                    if (n)
                        for (var o = 0; o < n.length; o++) {
                            var a = n[o]
                              , s = a.name;
                            if (r = this._singleInstance ? 0 : s,
                            !this._postProcesses[r]) {
                                var y = this._getPostProcesses();
                                y && (this._postProcesses[r] = Array.isArray(y) ? y : [y])
                            }
                            this._indicesForCamera[s] || (this._indicesForCamera[s] = []),
                            this._postProcesses[r].forEach((function(e) {
                                var t = a.attachPostProcess(e);
                                i._indicesForCamera[s].push(t)
                            }
                            )),
                            this._cameras[s] || (this._cameras[s] = a)
                        }
                }
                ,
                t.prototype._detachCameras = function(t) {
                    var r = e.Tools.MakeArray(t || this._cameras);
                    if (r)
                        for (var i = 0; i < r.length; i++) {
                            var n = r[i]
                              , o = n.name;
                            this._postProcesses[this._singleInstance ? 0 : o].forEach((function(e) {
                                n.detachPostProcess(e)
                            }
                            )),
                            this._cameras[o] && (this._cameras[o] = null)
                        }
                }
                ,
                t.prototype._enable = function(t) {
                    var r = this
                      , i = e.Tools.MakeArray(t || this._cameras);
                    if (i)
                        for (var n = 0; n < i.length; n++)
                            for (var o = i[n], a = o.name, s = 0; s < this._indicesForCamera[a].length; s++)
                                void 0 !== o._postProcesses[this._indicesForCamera[a][s]] && null !== o._postProcesses[this._indicesForCamera[a][s]] || this._postProcesses[this._singleInstance ? 0 : a].forEach((function(e) {
                                    i[n].attachPostProcess(e, r._indicesForCamera[a][s])
                                }
                                ))
                }
                ,
                t.prototype._disable = function(t) {
                    var r = e.Tools.MakeArray(t || this._cameras);
                    if (r)
                        for (var i = 0; i < r.length; i++) {
                            var n = r[i]
                              , o = n.name;
                            this._postProcesses[this._singleInstance ? 0 : o].forEach((function(e) {
                                n.detachPostProcess(e)
                            }
                            ))
                        }
                }
                ,
                t.prototype.getPostProcesses = function(e) {
                    return this._singleInstance ? this._postProcesses[0] : e ? this._postProcesses[e.name] : null
                }
                ,
                t
            }();
            e.PostProcessRenderEffect = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t) {
                    this.engine = e,
                    this._name = t,
                    this._renderEffects = {},
                    this._renderEffectsForIsolatedPass = new Array,
                    this._cameras = []
                }
                return t.prototype.getClassName = function() {
                    return "PostProcessRenderPipeline"
                }
                ,
                Object.defineProperty(t.prototype, "isSupported", {
                    get: function() {
                        for (var e in this._renderEffects)
                            if (this._renderEffects.hasOwnProperty(e) && !this._renderEffects[e].isSupported)
                                return !1;
                        return !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.addEffect = function(e) {
                    this._renderEffects[e._name] = e
                }
                ,
                t.prototype._rebuild = function() {}
                ,
                t.prototype._enableEffect = function(t, r) {
                    var i = this._renderEffects[t];
                    i && i._enable(e.Tools.MakeArray(r || this._cameras))
                }
                ,
                t.prototype._disableEffect = function(t, r) {
                    var i = this._renderEffects[t];
                    i && i._disable(e.Tools.MakeArray(r || this._cameras))
                }
                ,
                t.prototype._attachCameras = function(t, r) {
                    var i = e.Tools.MakeArray(t || this._cameras);
                    if (i) {
                        var n, o = [];
                        for (n = 0; n < i.length; n++) {
                            var a = i[n]
                              , s = a.name;
                            -1 === this._cameras.indexOf(a) ? this._cameras[s] = a : r && o.push(n)
                        }
                        for (n = 0; n < o.length; n++)
                            t.splice(o[n], 1);
                        for (var y in this._renderEffects)
                            this._renderEffects.hasOwnProperty(y) && this._renderEffects[y]._attachCameras(i)
                    }
                }
                ,
                t.prototype._detachCameras = function(t) {
                    var r = e.Tools.MakeArray(t || this._cameras);
                    if (r) {
                        for (var i in this._renderEffects)
                            this._renderEffects.hasOwnProperty(i) && this._renderEffects[i]._detachCameras(r);
                        for (var n = 0; n < r.length; n++)
                            this._cameras.splice(this._cameras.indexOf(r[n]), 1)
                    }
                }
                ,
                t.prototype._update = function() {
                    for (var e in this._renderEffects)
                        this._renderEffects.hasOwnProperty(e) && this._renderEffects[e]._update();
                    for (var t = 0; t < this._cameras.length; t++) {
                        var r = this._cameras[t].name;
                        this._renderEffectsForIsolatedPass[r] && this._renderEffectsForIsolatedPass[r]._update()
                    }
                }
                ,
                t.prototype._reset = function() {
                    this._renderEffects = {},
                    this._renderEffectsForIsolatedPass = new Array
                }
                ,
                t.prototype._enableMSAAOnFirstPostProcess = function(e) {
                    var t = Object.keys(this._renderEffects);
                    if (this.engine.webGLVersion >= 2 && t.length > 0) {
                        var r = this._renderEffects[t[0]].getPostProcesses();
                        if (r)
                            return r[0].samples = e,
                            !0
                    }
                    return !1
                }
                ,
                t.prototype.dispose = function() {}
                ,
                n([e.serialize()], t.prototype, "_name", void 0),
                t
            }();
            e.PostProcessRenderPipeline = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i) {
                    void 0 === r && (r = e.Engine.TEXTURETYPE_FLOAT),
                    void 0 === i && (i = null);
                    var n = this;
                    this.useOnlyInActiveCamera = !1,
                    this._scene = t;
                    var o = t._getComponent(e.SceneComponentConstants.NAME_DEPTHRENDERER);
                    o || (o = new e.DepthRendererSceneComponent(t),
                    t._addComponent(o)),
                    this._camera = i;
                    var a = t.getEngine();
                    this._depthMap = new e.RenderTargetTexture("depthMap",{
                        width: a.getRenderWidth(),
                        height: a.getRenderHeight()
                    },this._scene,!1,!0,r),
                    this._depthMap.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    this._depthMap.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    this._depthMap.refreshRate = 1,
                    this._depthMap.renderParticles = !1,
                    this._depthMap.renderList = null,
                    this._depthMap.activeCamera = this._camera,
                    this._depthMap.ignoreCameraViewport = !0,
                    this._depthMap.useCameraPostProcesses = !1,
                    this._depthMap.onClearObservable.add((function(t) {
                        t.clear(new e.Color4(1,1,1,1), !0, !0, !0)
                    }
                    ));
                    var s = function(t) {
                        var r = t.getRenderingMesh()
                          , i = n._scene
                          , o = i.getEngine()
                          , a = t.getMaterial();
                        if (a) {
                            o.setState(a.backFaceCulling, 0, !1, i.useRightHandedSystem);
                            var s = r._getInstancesRenderList(t._id);
                            if (!s.mustReturn) {
                                var y = o.getCaps().instancedArrays && null !== s.visibleInstances[t._id]
                                  , l = n._camera || i.activeCamera;
                                if (n.isReady(t, y) && l) {
                                    if (o.enableEffect(n._effect),
                                    r._bind(t, n._effect, e.Material.TriangleFillMode),
                                    n._effect.setMatrix("viewProjection", i.getTransformMatrix()),
                                    n._effect.setFloat2("depthValues", l.minZ, l.minZ + l.maxZ),
                                    a && a.needAlphaTesting()) {
                                        var c = a.getAlphaTestTexture();
                                        c && (n._effect.setTexture("diffuseSampler", c),
                                        n._effect.setMatrix("diffuseMatrix", c.getTextureMatrix()))
                                    }
                                    r.useBones && r.computeBonesUsingShaders && r.skeleton && n._effect.setMatrices("mBones", r.skeleton.getTransformMatrices(r)),
                                    r._processRendering(t, n._effect, e.Material.TriangleFillMode, s, y, (function(e, t) {
                                        return n._effect.setMatrix("world", t)
                                    }
                                    ))
                                }
                            }
                        }
                    };
                    this._depthMap.customRenderFunction = function(e, t, r, i) {
                        var n;
                        if (i.length) {
                            for (a.setColorWrite(!1),
                            n = 0; n < i.length; n++)
                                s(i.data[n]);
                            a.setColorWrite(!0)
                        }
                        for (n = 0; n < e.length; n++)
                            s(e.data[n]);
                        for (n = 0; n < t.length; n++)
                            s(t.data[n])
                    }
                }
                return t.prototype.isReady = function(t, r) {
                    var i = t.getMaterial();
                    if (i.disableDepthWrite)
                        return !1;
                    var n = []
                      , o = [e.VertexBuffer.PositionKind]
                      , a = t.getMesh();
                    i && i.needAlphaTesting() && i.getAlphaTestTexture() && (n.push("#define ALPHATEST"),
                    a.isVerticesDataPresent(e.VertexBuffer.UVKind) && (o.push(e.VertexBuffer.UVKind),
                    n.push("#define UV1")),
                    a.isVerticesDataPresent(e.VertexBuffer.UV2Kind) && (o.push(e.VertexBuffer.UV2Kind),
                    n.push("#define UV2"))),
                    a.useBones && a.computeBonesUsingShaders ? (o.push(e.VertexBuffer.MatricesIndicesKind),
                    o.push(e.VertexBuffer.MatricesWeightsKind),
                    a.numBoneInfluencers > 4 && (o.push(e.VertexBuffer.MatricesIndicesExtraKind),
                    o.push(e.VertexBuffer.MatricesWeightsExtraKind)),
                    n.push("#define NUM_BONE_INFLUENCERS " + a.numBoneInfluencers),
                    n.push("#define BonesPerMesh " + (a.skeleton ? a.skeleton.bones.length + 1 : 0))) : n.push("#define NUM_BONE_INFLUENCERS 0"),
                    r && (n.push("#define INSTANCES"),
                    o.push("world0"),
                    o.push("world1"),
                    o.push("world2"),
                    o.push("world3"));
                    var s = n.join("\n");
                    return this._cachedDefines !== s && (this._cachedDefines = s,
                    this._effect = this._scene.getEngine().createEffect("depth", o, ["world", "mBones", "viewProjection", "diffuseMatrix", "depthValues"], ["diffuseSampler"], s)),
                    this._effect.isReady()
                }
                ,
                t.prototype.getDepthMap = function() {
                    return this._depthMap
                }
                ,
                t.prototype.dispose = function() {
                    this._depthMap.dispose()
                }
                ,
                t
            }();
            e.DepthRenderer = t
        }(s || (s = {})),
        function(e) {
            e.Scene.prototype.enableDepthRenderer = function(t) {
                if (!(t = t || this.activeCamera))
                    throw "No camera available to enable depth renderer";
                if (this._depthRenderer || (this._depthRenderer = {}),
                !this._depthRenderer[t.id]) {
                    var r = 0;
                    if (this.getEngine().getCaps().textureHalfFloatRender)
                        r = e.Engine.TEXTURETYPE_HALF_FLOAT;
                    else {
                        if (!this.getEngine().getCaps().textureFloatRender)
                            throw "Depth renderer does not support int texture type";
                        r = e.Engine.TEXTURETYPE_FLOAT
                    }
                    this._depthRenderer[t.id] = new e.DepthRenderer(this,r,t)
                }
                return this._depthRenderer[t.id]
            }
            ,
            e.Scene.prototype.disableDepthRenderer = function(e) {
                (e = e || this.activeCamera) && this._depthRenderer && this._depthRenderer[e.id] && (this._depthRenderer[e.id].dispose(),
                delete this._depthRenderer[e.id])
            }
            ;
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_DEPTHRENDERER,
                    this.scene = t
                }
                return t.prototype.register = function() {
                    this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_DEPTHRENDERER, this, this._gatherRenderTargets),
                    this.scene._gatherActiveCameraRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER, this, this._gatherActiveCameraRenderTargets)
                }
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.dispose = function() {
                    for (var e in this.scene._depthRenderer)
                        this.scene._depthRenderer[e].dispose()
                }
                ,
                t.prototype._gatherRenderTargets = function(e) {
                    if (this.scene._depthRenderer)
                        for (var t in this.scene._depthRenderer) {
                            var r = this.scene._depthRenderer[t];
                            r.useOnlyInActiveCamera || e.push(r.getDepthMap())
                        }
                }
                ,
                t.prototype._gatherActiveCameraRenderTargets = function(e) {
                    if (this.scene._depthRenderer)
                        for (var t in this.scene._depthRenderer) {
                            var r = this.scene._depthRenderer[t];
                            r.useOnlyInActiveCamera && this.scene.activeCamera.id === t && e.push(r.getDepthMap())
                        }
                }
                ,
                t
            }();
            e.DepthRendererSceneComponent = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r) {
                    void 0 === r && (r = 1),
                    this._enablePosition = !1,
                    this._scene = t,
                    this._ratio = r;
                    var i = t._getComponent(e.SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER);
                    i || (i = new e.GeometryBufferRendererSceneComponent(t),
                    t._addComponent(i)),
                    this._createRenderTargets()
                }
                return Object.defineProperty(t.prototype, "renderList", {
                    set: function(e) {
                        this._multiRenderTarget.renderList = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "isSupported", {
                    get: function() {
                        return this._multiRenderTarget.isSupported
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "enablePosition", {
                    get: function() {
                        return this._enablePosition
                    },
                    set: function(e) {
                        this._enablePosition = e,
                        this.dispose(),
                        this._createRenderTargets()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "scene", {
                    get: function() {
                        return this._scene
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "ratio", {
                    get: function() {
                        return this._ratio
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.isReady = function(t, r) {
                    var i = t.getMaterial();
                    if (i && i.disableDepthWrite)
                        return !1;
                    var n = []
                      , o = [e.VertexBuffer.PositionKind, e.VertexBuffer.NormalKind]
                      , a = t.getMesh();
                    i && i.needAlphaTesting() && (n.push("#define ALPHATEST"),
                    a.isVerticesDataPresent(e.VertexBuffer.UVKind) && (o.push(e.VertexBuffer.UVKind),
                    n.push("#define UV1")),
                    a.isVerticesDataPresent(e.VertexBuffer.UV2Kind) && (o.push(e.VertexBuffer.UV2Kind),
                    n.push("#define UV2"))),
                    this._enablePosition && n.push("#define POSITION"),
                    a.useBones && a.computeBonesUsingShaders ? (o.push(e.VertexBuffer.MatricesIndicesKind),
                    o.push(e.VertexBuffer.MatricesWeightsKind),
                    a.numBoneInfluencers > 4 && (o.push(e.VertexBuffer.MatricesIndicesExtraKind),
                    o.push(e.VertexBuffer.MatricesWeightsExtraKind)),
                    n.push("#define NUM_BONE_INFLUENCERS " + a.numBoneInfluencers),
                    n.push("#define BonesPerMesh " + (a.skeleton ? a.skeleton.bones.length + 1 : 0))) : n.push("#define NUM_BONE_INFLUENCERS 0"),
                    r && (n.push("#define INSTANCES"),
                    o.push("world0"),
                    o.push("world1"),
                    o.push("world2"),
                    o.push("world3"));
                    var s = n.join("\n");
                    return this._cachedDefines !== s && (this._cachedDefines = s,
                    this._effect = this._scene.getEngine().createEffect("geometry", o, ["world", "mBones", "viewProjection", "diffuseMatrix", "view"], ["diffuseSampler"], s, void 0, void 0, void 0, {
                        buffersCount: this._enablePosition ? 3 : 2
                    })),
                    this._effect.isReady()
                }
                ,
                t.prototype.getGBuffer = function() {
                    return this._multiRenderTarget
                }
                ,
                Object.defineProperty(t.prototype, "samples", {
                    get: function() {
                        return this._multiRenderTarget.samples
                    },
                    set: function(e) {
                        this._multiRenderTarget.samples = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.dispose = function() {
                    this.getGBuffer().dispose()
                }
                ,
                t.prototype._createRenderTargets = function() {
                    var t = this
                      , r = this._scene.getEngine()
                      , i = this._enablePosition ? 3 : 2;
                    if (this._multiRenderTarget = new e.MultiRenderTarget("gBuffer",{
                        width: r.getRenderWidth() * this._ratio,
                        height: r.getRenderHeight() * this._ratio
                    },i,this._scene,{
                        generateMipMaps: !1,
                        generateDepthTexture: !0,
                        defaultType: e.Engine.TEXTURETYPE_FLOAT
                    }),
                    this.isSupported) {
                        this._multiRenderTarget.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                        this._multiRenderTarget.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                        this._multiRenderTarget.refreshRate = 1,
                        this._multiRenderTarget.renderParticles = !1,
                        this._multiRenderTarget.renderList = null,
                        this._multiRenderTarget.onClearObservable.add((function(t) {
                            t.clear(new e.Color4(0,0,0,1), !0, !0, !0)
                        }
                        ));
                        var n = function(r) {
                            var i = r.getRenderingMesh()
                              , n = t._scene
                              , o = n.getEngine()
                              , a = r.getMaterial();
                            if (a) {
                                o.setState(a.backFaceCulling, 0, !1, n.useRightHandedSystem);
                                var s = i._getInstancesRenderList(r._id);
                                if (!s.mustReturn) {
                                    var y = o.getCaps().instancedArrays && null !== s.visibleInstances[r._id];
                                    if (t.isReady(r, y)) {
                                        if (o.enableEffect(t._effect),
                                        i._bind(r, t._effect, e.Material.TriangleFillMode),
                                        t._effect.setMatrix("viewProjection", n.getTransformMatrix()),
                                        t._effect.setMatrix("view", n.getViewMatrix()),
                                        a && a.needAlphaTesting()) {
                                            var l = a.getAlphaTestTexture();
                                            l && (t._effect.setTexture("diffuseSampler", l),
                                            t._effect.setMatrix("diffuseMatrix", l.getTextureMatrix()))
                                        }
                                        i.useBones && i.computeBonesUsingShaders && i.skeleton && t._effect.setMatrices("mBones", i.skeleton.getTransformMatrices(i)),
                                        i._processRendering(r, t._effect, e.Material.TriangleFillMode, s, y, (function(e, r) {
                                            return t._effect.setMatrix("world", r)
                                        }
                                        ))
                                    }
                                }
                            }
                        };
                        this._multiRenderTarget.customRenderFunction = function(e, t, i, o) {
                            var a;
                            if (o.length) {
                                for (r.setColorWrite(!1),
                                a = 0; a < o.length; a++)
                                    n(o.data[a]);
                                r.setColorWrite(!0)
                            }
                            for (a = 0; a < e.length; a++)
                                n(e.data[a]);
                            for (a = 0; a < t.length; a++)
                                n(t.data[a])
                        }
                    }
                }
                ,
                t
            }();
            e.GeometryBufferRenderer = t
        }(s || (s = {})),
        function(e) {
            Object.defineProperty(e.Scene.prototype, "geometryBufferRenderer", {
                get: function() {
                    this._geometryBufferRenderer
                },
                set: function(e) {
                    e && e.isSupported && (this._geometryBufferRenderer = e)
                },
                enumerable: !0,
                configurable: !0
            }),
            e.Scene.prototype.enableGeometryBufferRenderer = function(t) {
                return void 0 === t && (t = 1),
                this._geometryBufferRenderer ? this._geometryBufferRenderer : (this._geometryBufferRenderer = new e.GeometryBufferRenderer(this,t),
                this._geometryBufferRenderer.isSupported || (this._geometryBufferRenderer = null),
                this._geometryBufferRenderer)
            }
            ,
            e.Scene.prototype.disableGeometryBufferRenderer = function() {
                this._geometryBufferRenderer && (this._geometryBufferRenderer.dispose(),
                this._geometryBufferRenderer = null)
            }
            ;
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER,
                    this.scene = t
                }
                return t.prototype.register = function() {
                    this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER, this, this._gatherRenderTargets)
                }
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.dispose = function() {}
                ,
                t.prototype._gatherRenderTargets = function(e) {
                    this.scene._geometryBufferRenderer && e.push(this.scene._geometryBufferRenderer.getGBuffer())
                }
                ,
                t
            }();
            e.GeometryBufferRendererSceneComponent = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o) {
                    var a = t.call(this, i.getEngine(), r) || this;
                    a.SSAOOriginalSceneColorEffect = "SSAOOriginalSceneColorEffect",
                    a.SSAORenderEffect = "SSAORenderEffect",
                    a.SSAOBlurHRenderEffect = "SSAOBlurHRenderEffect",
                    a.SSAOBlurVRenderEffect = "SSAOBlurVRenderEffect",
                    a.SSAOCombineRenderEffect = "SSAOCombineRenderEffect",
                    a.totalStrength = 1,
                    a.radius = 1e-4,
                    a.area = .0075,
                    a.fallOff = 1e-6,
                    a.base = .5,
                    a._firstUpdate = !0,
                    a._scene = i,
                    a._createRandomTexture(),
                    a._depthTexture = i.enableDepthRenderer().getDepthMap();
                    var s = n.ssaoRatio || n
                      , y = n.combineRatio || n;
                    return a._originalColorPostProcess = new e.PassPostProcess("SSAOOriginalSceneColor",y,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1),
                    a._createSSAOPostProcess(s),
                    a._createBlurPostProcess(s),
                    a._createSSAOCombinePostProcess(y),
                    a.addEffect(new e.PostProcessRenderEffect(i.getEngine(),a.SSAOOriginalSceneColorEffect,(function() {
                        return a._originalColorPostProcess
                    }
                    ),!0)),
                    a.addEffect(new e.PostProcessRenderEffect(i.getEngine(),a.SSAORenderEffect,(function() {
                        return a._ssaoPostProcess
                    }
                    ),!0)),
                    a.addEffect(new e.PostProcessRenderEffect(i.getEngine(),a.SSAOBlurHRenderEffect,(function() {
                        return a._blurHPostProcess
                    }
                    ),!0)),
                    a.addEffect(new e.PostProcessRenderEffect(i.getEngine(),a.SSAOBlurVRenderEffect,(function() {
                        return a._blurVPostProcess
                    }
                    ),!0)),
                    a.addEffect(new e.PostProcessRenderEffect(i.getEngine(),a.SSAOCombineRenderEffect,(function() {
                        return a._ssaoCombinePostProcess
                    }
                    ),!0)),
                    i.postProcessRenderPipelineManager.addPipeline(a),
                    o && i.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(r, o),
                    a
                }
                return o(r, t),
                r.prototype.dispose = function(e) {
                    void 0 === e && (e = !1);
                    for (var r = 0; r < this._scene.cameras.length; r++) {
                        var i = this._scene.cameras[r];
                        this._originalColorPostProcess.dispose(i),
                        this._ssaoPostProcess.dispose(i),
                        this._blurHPostProcess.dispose(i),
                        this._blurVPostProcess.dispose(i),
                        this._ssaoCombinePostProcess.dispose(i)
                    }
                    this._randomTexture.dispose(),
                    e && this._scene.disableDepthRenderer(),
                    this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._scene.cameras),
                    t.prototype.dispose.call(this)
                }
                ,
                r.prototype._createBlurPostProcess = function(t) {
                    var r = this;
                    this._blurHPostProcess = new e.BlurPostProcess("BlurH",new e.Vector2(1,0),16,t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this._blurVPostProcess = new e.BlurPostProcess("BlurV",new e.Vector2(0,1),16,t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this._blurHPostProcess.onActivateObservable.add((function() {
                        var e = r._blurHPostProcess.width / r._scene.getEngine().getRenderWidth();
                        r._blurHPostProcess.kernel = 16 * e
                    }
                    )),
                    this._blurVPostProcess.onActivateObservable.add((function() {
                        var e = r._blurVPostProcess.height / r._scene.getEngine().getRenderHeight();
                        r._blurVPostProcess.kernel = 16 * e
                    }
                    ))
                }
                ,
                r.prototype._rebuild = function() {
                    this._firstUpdate = !0,
                    t.prototype._rebuild.call(this)
                }
                ,
                r.prototype._createSSAOPostProcess = function(t) {
                    var r = this
                      , i = [.5381, .1856, -.4319, .1379, .2486, .443, .3371, .5679, -.0057, -.6999, -.0451, -.0019, .0689, -.1598, -.8547, .056, .0069, -.1843, -.0146, .1402, .0762, .01, -.1924, -.0344, -.3577, -.5301, -.4358, -.3169, .1063, .0158, .0103, -.5869, .0046, -.0897, -.494, .3287, .7119, -.0154, -.0918, -.0533, .0596, -.5411, .0352, -.0631, .546, -.4776, .2847, -.0271];
                    this._ssaoPostProcess = new e.PostProcess("ssao","ssao",["sampleSphere", "samplesFactor", "randTextureTiles", "totalStrength", "radius", "area", "fallOff", "base", "range", "viewport"],["randomSampler"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO"),
                    this._ssaoPostProcess.onApply = function(e) {
                        r._firstUpdate && (e.setArray3("sampleSphere", i),
                        e.setFloat("samplesFactor", 1 / 16),
                        e.setFloat("randTextureTiles", 4)),
                        e.setFloat("totalStrength", r.totalStrength),
                        e.setFloat("radius", r.radius),
                        e.setFloat("area", r.area),
                        e.setFloat("fallOff", r.fallOff),
                        e.setFloat("base", r.base),
                        e.setTexture("textureSampler", r._depthTexture),
                        e.setTexture("randomSampler", r._randomTexture)
                    }
                }
                ,
                r.prototype._createSSAOCombinePostProcess = function(t) {
                    var r = this;
                    this._ssaoCombinePostProcess = new e.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor", "viewport"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),
                    this._ssaoCombinePostProcess.onApply = function(t) {
                        t.setVector4("viewport", e.Tmp.Vector4[0].copyFromFloats(0, 0, 1, 1)),
                        t.setTextureFromPostProcess("originalColor", r._originalColorPostProcess)
                    }
                }
                ,
                r.prototype._createRandomTexture = function() {
                    this._randomTexture = new e.DynamicTexture("SSAORandomTexture",512,this._scene,!1,e.Texture.TRILINEAR_SAMPLINGMODE),
                    this._randomTexture.wrapU = e.Texture.WRAP_ADDRESSMODE,
                    this._randomTexture.wrapV = e.Texture.WRAP_ADDRESSMODE;
                    for (var t = this._randomTexture.getContext(), r = function(e, t) {
                        return Math.random() * (t - e) + e
                    }, i = e.Vector3.Zero(), n = 0; n < 512; n++)
                        for (var o = 0; o < 512; o++)
                            i.x = Math.floor(255 * r(-1, 1)),
                            i.y = Math.floor(255 * r(-1, 1)),
                            i.z = Math.floor(255 * r(-1, 1)),
                            t.fillStyle = "rgb(" + i.x + ", " + i.y + ", " + i.z + ")",
                            t.fillRect(n, o, 1, 1);
                    this._randomTexture.update(!1)
                }
                ,
                n([e.serialize()], r.prototype, "totalStrength", void 0),
                n([e.serialize()], r.prototype, "radius", void 0),
                n([e.serialize()], r.prototype, "area", void 0),
                n([e.serialize()], r.prototype, "fallOff", void 0),
                n([e.serialize()], r.prototype, "base", void 0),
                r
            }(e.PostProcessRenderPipeline);
            e.SSAORenderingPipeline = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o) {
                    var a = t.call(this, i.getEngine(), r) || this;
                    if (a.SSAOOriginalSceneColorEffect = "SSAOOriginalSceneColorEffect",
                    a.SSAORenderEffect = "SSAORenderEffect",
                    a.SSAOBlurHRenderEffect = "SSAOBlurHRenderEffect",
                    a.SSAOBlurVRenderEffect = "SSAOBlurVRenderEffect",
                    a.SSAOCombineRenderEffect = "SSAOCombineRenderEffect",
                    a.totalStrength = 1,
                    a.maxZ = 100,
                    a.minZAspect = .2,
                    a._samples = 8,
                    a._textureSamples = 1,
                    a._expensiveBlur = !0,
                    a.radius = 2,
                    a.base = 0,
                    a._firstUpdate = !0,
                    a._bits = new Uint32Array(1),
                    a._scene = i,
                    a._ratio = n,
                    !a.isSupported)
                        return e.Tools.Error("SSAO 2 needs WebGL 2 support."),
                        a;
                    var s = a._ratio.ssaoRatio || n
                      , y = a._ratio.blurRatio || n
                      , l = i.enableGeometryBufferRenderer();
                    return a._createRandomTexture(),
                    a._depthTexture = l.getGBuffer().textures[0],
                    a._normalTexture = l.getGBuffer().textures[1],
                    a._originalColorPostProcess = new e.PassPostProcess("SSAOOriginalSceneColor",1,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1),
                    a._originalColorPostProcess.samples = a.textureSamples,
                    a._createSSAOPostProcess(1),
                    a._createBlurPostProcess(s, y),
                    a._createSSAOCombinePostProcess(y),
                    a.addEffect(new e.PostProcessRenderEffect(i.getEngine(),a.SSAOOriginalSceneColorEffect,(function() {
                        return a._originalColorPostProcess
                    }
                    ),!0)),
                    a.addEffect(new e.PostProcessRenderEffect(i.getEngine(),a.SSAORenderEffect,(function() {
                        return a._ssaoPostProcess
                    }
                    ),!0)),
                    a.addEffect(new e.PostProcessRenderEffect(i.getEngine(),a.SSAOBlurHRenderEffect,(function() {
                        return a._blurHPostProcess
                    }
                    ),!0)),
                    a.addEffect(new e.PostProcessRenderEffect(i.getEngine(),a.SSAOBlurVRenderEffect,(function() {
                        return a._blurVPostProcess
                    }
                    ),!0)),
                    a.addEffect(new e.PostProcessRenderEffect(i.getEngine(),a.SSAOCombineRenderEffect,(function() {
                        return a._ssaoCombinePostProcess
                    }
                    ),!0)),
                    i.postProcessRenderPipelineManager.addPipeline(a),
                    o && i.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(r, o),
                    a
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "samples", {
                    get: function() {
                        return this._samples
                    },
                    set: function(e) {
                        this._ssaoPostProcess.updateEffect("#define SAMPLES " + e + "\n#define SSAO"),
                        this._samples = e,
                        this._sampleSphere = this._generateHemisphere(),
                        this._firstUpdate = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "textureSamples", {
                    get: function() {
                        return this._textureSamples
                    },
                    set: function(e) {
                        this._textureSamples = e,
                        this._originalColorPostProcess.samples = e,
                        this._blurHPostProcess.samples = e,
                        this._blurVPostProcess.samples = e,
                        this._ssaoPostProcess.samples = e,
                        this._ssaoCombinePostProcess.samples = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "expensiveBlur", {
                    get: function() {
                        return this._expensiveBlur
                    },
                    set: function(e) {
                        this._blurHPostProcess.updateEffect("#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE " + (e ? "1" : "0") + "\n", null, ["textureSampler", "depthSampler"]),
                        this._blurVPostProcess.updateEffect("#define BILATERAL_BLUR\n#define SAMPLES 16\n#define EXPENSIVE " + (e ? "1" : "0") + "\n", null, ["textureSampler", "depthSampler"]),
                        this._expensiveBlur = e,
                        this._firstUpdate = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r, "IsSupported", {
                    get: function() {
                        var t = e.Engine.LastCreatedEngine;
                        return !!t && t.getCaps().drawBuffersExtension
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.dispose = function(e) {
                    void 0 === e && (e = !1);
                    for (var r = 0; r < this._scene.cameras.length; r++) {
                        var i = this._scene.cameras[r];
                        this._originalColorPostProcess.dispose(i),
                        this._ssaoPostProcess.dispose(i),
                        this._blurHPostProcess.dispose(i),
                        this._blurVPostProcess.dispose(i),
                        this._ssaoCombinePostProcess.dispose(i)
                    }
                    this._randomTexture.dispose(),
                    e && this._scene.disableGeometryBufferRenderer(),
                    this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._scene.cameras),
                    t.prototype.dispose.call(this)
                }
                ,
                r.prototype._createBlurPostProcess = function(t, r) {
                    var i = this;
                    this._samplerOffsets = [];
                    for (var n = this.expensiveBlur, o = -8; o < 8; o++)
                        this._samplerOffsets.push(2 * o + .5);
                    this._blurHPostProcess = new e.PostProcess("BlurH","ssao2",["outSize", "samplerOffsets", "near", "far", "radius"],["depthSampler"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE " + (n ? "1" : "0") + "\n"),
                    this._blurHPostProcess.onApply = function(e) {
                        i._scene.activeCamera && (e.setFloat("outSize", i._ssaoCombinePostProcess.width > 0 ? i._ssaoCombinePostProcess.width : i._originalColorPostProcess.width),
                        e.setFloat("near", i._scene.activeCamera.minZ),
                        e.setFloat("far", i._scene.activeCamera.maxZ),
                        e.setFloat("radius", i.radius),
                        e.setTexture("depthSampler", i._depthTexture),
                        i._firstUpdate && e.setArray("samplerOffsets", i._samplerOffsets))
                    }
                    ,
                    this._blurVPostProcess = new e.PostProcess("BlurV","ssao2",["outSize", "samplerOffsets", "near", "far", "radius"],["depthSampler"],r,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_V\n#define SAMPLES 16\n#define EXPENSIVE " + (n ? "1" : "0") + "\n"),
                    this._blurVPostProcess.onApply = function(e) {
                        i._scene.activeCamera && (e.setFloat("outSize", i._ssaoCombinePostProcess.height > 0 ? i._ssaoCombinePostProcess.height : i._originalColorPostProcess.height),
                        e.setFloat("near", i._scene.activeCamera.minZ),
                        e.setFloat("far", i._scene.activeCamera.maxZ),
                        e.setFloat("radius", i.radius),
                        e.setTexture("depthSampler", i._depthTexture),
                        i._firstUpdate && (e.setArray("samplerOffsets", i._samplerOffsets),
                        i._firstUpdate = !1))
                    }
                    ,
                    this._blurHPostProcess.samples = this.textureSamples,
                    this._blurVPostProcess.samples = this.textureSamples
                }
                ,
                r.prototype._rebuild = function() {
                    this._firstUpdate = !0,
                    t.prototype._rebuild.call(this)
                }
                ,
                r.prototype._radicalInverse_VdC = function(e) {
                    return this._bits[0] = e,
                    this._bits[0] = (this._bits[0] << 16 | this._bits[0] >> 16) >>> 0,
                    this._bits[0] = (1431655765 & this._bits[0]) << 1 | (2863311530 & this._bits[0]) >>> 1 >>> 0,
                    this._bits[0] = (858993459 & this._bits[0]) << 2 | (3435973836 & this._bits[0]) >>> 2 >>> 0,
                    this._bits[0] = (252645135 & this._bits[0]) << 4 | (4042322160 & this._bits[0]) >>> 4 >>> 0,
                    this._bits[0] = (16711935 & this._bits[0]) << 8 | (4278255360 & this._bits[0]) >>> 8 >>> 0,
                    2.3283064365386963e-10 * this._bits[0]
                }
                ,
                r.prototype._hammersley = function(e, t) {
                    return [e / t, this._radicalInverse_VdC(e)]
                }
                ,
                r.prototype._hemisphereSample_uniform = function(t, r) {
                    var i = 2 * r * Math.PI
                      , n = 1 - (.85 * t + .15)
                      , o = Math.sqrt(1 - n * n);
                    return new e.Vector3(Math.cos(i) * o,Math.sin(i) * o,n)
                }
                ,
                r.prototype._generateHemisphere = function() {
                    for (var e, t = this.samples, r = [], i = 0; i < t; ) {
                        if (t < 16)
                            e = this._hemisphereSample_uniform(Math.random(), Math.random());
                        else {
                            var n = this._hammersley(i, t);
                            e = this._hemisphereSample_uniform(n[0], n[1])
                        }
                        r.push(e.x, e.y, e.z),
                        i++
                    }
                    return r
                }
                ,
                r.prototype._createSSAOPostProcess = function(t) {
                    var r = this
                      , i = this.samples;
                    this._sampleSphere = this._generateHemisphere(),
                    this._ssaoPostProcess = new e.PostProcess("ssao2","ssao2",["sampleSphere", "samplesFactor", "randTextureTiles", "totalStrength", "radius", "base", "range", "projection", "near", "far", "texelSize", "xViewport", "yViewport", "maxZ", "minZAspect"],["randomSampler", "normalSampler"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES " + i + "\n#define SSAO"),
                    this._ssaoPostProcess.onApply = function(e) {
                        r._firstUpdate && (e.setArray3("sampleSphere", r._sampleSphere),
                        e.setFloat("randTextureTiles", 32)),
                        r._scene.activeCamera && (e.setFloat("samplesFactor", 1 / r.samples),
                        e.setFloat("totalStrength", r.totalStrength),
                        e.setFloat2("texelSize", 1 / r._ssaoPostProcess.width, 1 / r._ssaoPostProcess.height),
                        e.setFloat("radius", r.radius),
                        e.setFloat("maxZ", r.maxZ),
                        e.setFloat("minZAspect", r.minZAspect),
                        e.setFloat("base", r.base),
                        e.setFloat("near", r._scene.activeCamera.minZ),
                        e.setFloat("far", r._scene.activeCamera.maxZ),
                        e.setFloat("xViewport", Math.tan(r._scene.activeCamera.fov / 2) * r._scene.getEngine().getAspectRatio(r._scene.activeCamera, !0)),
                        e.setFloat("yViewport", Math.tan(r._scene.activeCamera.fov / 2)),
                        e.setMatrix("projection", r._scene.getProjectionMatrix()),
                        e.setTexture("textureSampler", r._depthTexture),
                        e.setTexture("normalSampler", r._normalTexture),
                        e.setTexture("randomSampler", r._randomTexture))
                    }
                    ,
                    this._ssaoPostProcess.samples = this.textureSamples
                }
                ,
                r.prototype._createSSAOCombinePostProcess = function(t) {
                    var r = this;
                    this._ssaoCombinePostProcess = new e.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor", "viewport"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),
                    this._ssaoCombinePostProcess.onApply = function(t) {
                        var i = r._scene.activeCamera.viewport;
                        t.setVector4("viewport", e.Tmp.Vector4[0].copyFromFloats(i.x, i.y, i.width, i.height)),
                        t.setTextureFromPostProcess("originalColor", r._originalColorPostProcess)
                    }
                    ,
                    this._ssaoCombinePostProcess.samples = this.textureSamples
                }
                ,
                r.prototype._createRandomTexture = function() {
                    this._randomTexture = new e.DynamicTexture("SSAORandomTexture",128,this._scene,!1,e.Texture.TRILINEAR_SAMPLINGMODE),
                    this._randomTexture.wrapU = e.Texture.WRAP_ADDRESSMODE,
                    this._randomTexture.wrapV = e.Texture.WRAP_ADDRESSMODE;
                    for (var t = this._randomTexture.getContext(), r = function(e, t) {
                        return Math.random() * (t - e) + e
                    }, i = e.Vector3.Zero(), n = 0; n < 128; n++)
                        for (var o = 0; o < 128; o++)
                            i.x = r(0, 1),
                            i.y = r(0, 1),
                            i.z = 0,
                            i.normalize(),
                            i.scaleInPlace(255),
                            i.x = Math.floor(i.x),
                            i.y = Math.floor(i.y),
                            t.fillStyle = "rgb(" + i.x + ", " + i.y + ", " + i.z + ")",
                            t.fillRect(n, o, 1, 1);
                    this._randomTexture.update(!1)
                }
                ,
                r.prototype.serialize = function() {
                    var t = e.SerializationHelper.Serialize(this);
                    return t.customType = "SSAO2RenderingPipeline",
                    t
                }
                ,
                r.Parse = function(t, i, n) {
                    return e.SerializationHelper.Parse((function() {
                        return new r(t._name,i,t._ratio)
                    }
                    ), t, i, n)
                }
                ,
                n([e.serialize()], r.prototype, "totalStrength", void 0),
                n([e.serialize()], r.prototype, "maxZ", void 0),
                n([e.serialize()], r.prototype, "minZAspect", void 0),
                n([e.serialize("samples")], r.prototype, "_samples", void 0),
                n([e.serialize("textureSamples")], r.prototype, "_textureSamples", void 0),
                n([e.serialize()], r.prototype, "_ratio", void 0),
                n([e.serialize("expensiveBlur")], r.prototype, "_expensiveBlur", void 0),
                n([e.serialize()], r.prototype, "radius", void 0),
                n([e.serialize()], r.prototype, "base", void 0),
                r
            }(e.PostProcessRenderPipeline);
            e.SSAO2RenderingPipeline = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a) {
                    void 0 === o && (o = 1);
                    var s = t.call(this, n.getEngine(), r) || this;
                    return s.LensChromaticAberrationEffect = "LensChromaticAberrationEffect",
                    s.HighlightsEnhancingEffect = "HighlightsEnhancingEffect",
                    s.LensDepthOfFieldEffect = "LensDepthOfFieldEffect",
                    s._scene = n,
                    s._depthTexture = n.enableDepthRenderer().getDepthMap(),
                    i.grain_texture ? s._grainTexture = i.grain_texture : s._createGrainTexture(),
                    s._edgeBlur = i.edge_blur ? i.edge_blur : 0,
                    s._grainAmount = i.grain_amount ? i.grain_amount : 0,
                    s._chromaticAberration = i.chromatic_aberration ? i.chromatic_aberration : 0,
                    s._distortion = i.distortion ? i.distortion : 0,
                    s._highlightsGain = void 0 !== i.dof_gain ? i.dof_gain : -1,
                    s._highlightsThreshold = i.dof_threshold ? i.dof_threshold : 1,
                    s._dofDistance = void 0 !== i.dof_focus_distance ? i.dof_focus_distance : -1,
                    s._dofAperture = i.dof_aperture ? i.dof_aperture : 1,
                    s._dofDarken = i.dof_darken ? i.dof_darken : 0,
                    s._dofPentagon = void 0 === i.dof_pentagon || i.dof_pentagon,
                    s._blurNoise = void 0 === i.blur_noise || i.blur_noise,
                    s._createChromaticAberrationPostProcess(o),
                    s._createHighlightsPostProcess(o),
                    s._createDepthOfFieldPostProcess(o / 4),
                    s.addEffect(new e.PostProcessRenderEffect(n.getEngine(),s.LensChromaticAberrationEffect,(function() {
                        return s._chromaticAberrationPostProcess
                    }
                    ),!0)),
                    s.addEffect(new e.PostProcessRenderEffect(n.getEngine(),s.HighlightsEnhancingEffect,(function() {
                        return s._highlightsPostProcess
                    }
                    ),!0)),
                    s.addEffect(new e.PostProcessRenderEffect(n.getEngine(),s.LensDepthOfFieldEffect,(function() {
                        return s._depthOfFieldPostProcess
                    }
                    ),!0)),
                    -1 === s._highlightsGain && s._disableEffect(s.HighlightsEnhancingEffect, null),
                    n.postProcessRenderPipelineManager.addPipeline(s),
                    a && n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(r, a),
                    s
                }
                return o(r, t),
                r.prototype.setEdgeBlur = function(e) {
                    this._edgeBlur = e
                }
                ,
                r.prototype.disableEdgeBlur = function() {
                    this._edgeBlur = 0
                }
                ,
                r.prototype.setGrainAmount = function(e) {
                    this._grainAmount = e
                }
                ,
                r.prototype.disableGrain = function() {
                    this._grainAmount = 0
                }
                ,
                r.prototype.setChromaticAberration = function(e) {
                    this._chromaticAberration = e
                }
                ,
                r.prototype.disableChromaticAberration = function() {
                    this._chromaticAberration = 0
                }
                ,
                r.prototype.setEdgeDistortion = function(e) {
                    this._distortion = e
                }
                ,
                r.prototype.disableEdgeDistortion = function() {
                    this._distortion = 0
                }
                ,
                r.prototype.setFocusDistance = function(e) {
                    this._dofDistance = e
                }
                ,
                r.prototype.disableDepthOfField = function() {
                    this._dofDistance = -1
                }
                ,
                r.prototype.setAperture = function(e) {
                    this._dofAperture = e
                }
                ,
                r.prototype.setDarkenOutOfFocus = function(e) {
                    this._dofDarken = e
                }
                ,
                r.prototype.enablePentagonBokeh = function() {
                    this._highlightsPostProcess.updateEffect("#define PENTAGON\n")
                }
                ,
                r.prototype.disablePentagonBokeh = function() {
                    this._highlightsPostProcess.updateEffect()
                }
                ,
                r.prototype.enableNoiseBlur = function() {
                    this._blurNoise = !0
                }
                ,
                r.prototype.disableNoiseBlur = function() {
                    this._blurNoise = !1
                }
                ,
                r.prototype.setHighlightsGain = function(e) {
                    this._highlightsGain = e
                }
                ,
                r.prototype.setHighlightsThreshold = function(e) {
                    -1 === this._highlightsGain && (this._highlightsGain = 1),
                    this._highlightsThreshold = e
                }
                ,
                r.prototype.disableHighlights = function() {
                    this._highlightsGain = -1
                }
                ,
                r.prototype.dispose = function(e) {
                    void 0 === e && (e = !1),
                    this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._scene.cameras),
                    this._chromaticAberrationPostProcess = null,
                    this._highlightsPostProcess = null,
                    this._depthOfFieldPostProcess = null,
                    this._grainTexture.dispose(),
                    e && this._scene.disableDepthRenderer()
                }
                ,
                r.prototype._createChromaticAberrationPostProcess = function(t) {
                    var r = this;
                    this._chromaticAberrationPostProcess = new e.PostProcess("LensChromaticAberration","chromaticAberration",["chromatic_aberration", "screen_width", "screen_height", "direction", "radialIntensity", "centerPosition"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),
                    this._chromaticAberrationPostProcess.onApply = function(e) {
                        e.setFloat("chromatic_aberration", r._chromaticAberration),
                        e.setFloat("screen_width", r._scene.getEngine().getRenderWidth()),
                        e.setFloat("screen_height", r._scene.getEngine().getRenderHeight()),
                        e.setFloat("radialIntensity", 1),
                        e.setFloat2("direction", 17, 17),
                        e.setFloat2("centerPosition", .5, .5)
                    }
                }
                ,
                r.prototype._createHighlightsPostProcess = function(t) {
                    var r = this;
                    this._highlightsPostProcess = new e.PostProcess("LensHighlights","lensHighlights",["gain", "threshold", "screen_width", "screen_height"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon ? "#define PENTAGON\n" : ""),
                    this._highlightsPostProcess.onApply = function(e) {
                        e.setFloat("gain", r._highlightsGain),
                        e.setFloat("threshold", r._highlightsThreshold),
                        e.setTextureFromPostProcess("textureSampler", r._chromaticAberrationPostProcess),
                        e.setFloat("screen_width", r._scene.getEngine().getRenderWidth()),
                        e.setFloat("screen_height", r._scene.getEngine().getRenderHeight())
                    }
                }
                ,
                r.prototype._createDepthOfFieldPostProcess = function(t) {
                    var r = this;
                    this._depthOfFieldPostProcess = new e.PostProcess("LensDepthOfField","depthOfField",["grain_amount", "blur_noise", "screen_width", "screen_height", "distortion", "dof_enabled", "screen_distance", "aperture", "darken", "edge_blur", "highlights", "near", "far"],["depthSampler", "grainSampler", "highlightsSampler"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),
                    this._depthOfFieldPostProcess.onApply = function(e) {
                        e.setTexture("depthSampler", r._depthTexture),
                        e.setTexture("grainSampler", r._grainTexture),
                        e.setTextureFromPostProcess("textureSampler", r._highlightsPostProcess),
                        e.setTextureFromPostProcess("highlightsSampler", r._depthOfFieldPostProcess),
                        e.setFloat("grain_amount", r._grainAmount),
                        e.setBool("blur_noise", r._blurNoise),
                        e.setFloat("screen_width", r._scene.getEngine().getRenderWidth()),
                        e.setFloat("screen_height", r._scene.getEngine().getRenderHeight()),
                        e.setFloat("distortion", r._distortion),
                        e.setBool("dof_enabled", -1 !== r._dofDistance),
                        e.setFloat("screen_distance", 1 / (.1 - 1 / r._dofDistance)),
                        e.setFloat("aperture", r._dofAperture),
                        e.setFloat("darken", r._dofDarken),
                        e.setFloat("edge_blur", r._edgeBlur),
                        e.setBool("highlights", -1 !== r._highlightsGain),
                        r._scene.activeCamera && (e.setFloat("near", r._scene.activeCamera.minZ),
                        e.setFloat("far", r._scene.activeCamera.maxZ))
                    }
                }
                ,
                r.prototype._createGrainTexture = function() {
                    this._grainTexture = new e.DynamicTexture("LensNoiseTexture",512,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),
                    this._grainTexture.wrapU = e.Texture.WRAP_ADDRESSMODE,
                    this._grainTexture.wrapV = e.Texture.WRAP_ADDRESSMODE;
                    for (var t, r, i, n = this._grainTexture.getContext(), o = 0; o < 512; o++)
                        for (var a = 0; a < 512; a++)
                            t = Math.floor(255 * (r = .42,
                            i = .58,
                            Math.random() * (i - r) + r)),
                            n.fillStyle = "rgb(" + t + ", " + t + ", " + t + ")",
                            n.fillRect(o, a, 1, 1);
                    this._grainTexture.update(!1)
                }
                ,
                r
            }(e.PostProcessRenderPipeline);
            e.LensRenderingPipeline = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a) {
                    void 0 === o && (o = null);
                    var s = t.call(this, i.getEngine(), r) || this;
                    return s.downSampleX4PostProcess = null,
                    s.brightPassPostProcess = null,
                    s.blurHPostProcesses = [],
                    s.blurVPostProcesses = [],
                    s.textureAdderPostProcess = null,
                    s.volumetricLightPostProcess = null,
                    s.volumetricLightSmoothXPostProcess = null,
                    s.volumetricLightSmoothYPostProcess = null,
                    s.volumetricLightMergePostProces = null,
                    s.volumetricLightFinalPostProcess = null,
                    s.luminancePostProcess = null,
                    s.luminanceDownSamplePostProcesses = [],
                    s.hdrPostProcess = null,
                    s.textureAdderFinalPostProcess = null,
                    s.lensFlareFinalPostProcess = null,
                    s.hdrFinalPostProcess = null,
                    s.lensFlarePostProcess = null,
                    s.lensFlareComposePostProcess = null,
                    s.motionBlurPostProcess = null,
                    s.depthOfFieldPostProcess = null,
                    s.fxaaPostProcess = null,
                    s.brightThreshold = 1,
                    s.blurWidth = 512,
                    s.horizontalBlur = !1,
                    s.exposure = 1,
                    s.lensTexture = null,
                    s.volumetricLightCoefficient = .2,
                    s.volumetricLightPower = 4,
                    s.volumetricLightBlurScale = 64,
                    s.sourceLight = null,
                    s.hdrMinimumLuminance = 1,
                    s.hdrDecreaseRate = .5,
                    s.hdrIncreaseRate = .5,
                    s.lensColorTexture = null,
                    s.lensFlareStrength = 20,
                    s.lensFlareGhostDispersal = 1.4,
                    s.lensFlareHaloWidth = .7,
                    s.lensFlareDistortionStrength = 16,
                    s.lensStarTexture = null,
                    s.lensFlareDirtTexture = null,
                    s.depthOfFieldDistance = 10,
                    s.depthOfFieldBlurWidth = 64,
                    s.motionStrength = 1,
                    s.animations = [],
                    s._currentDepthOfFieldSource = null,
                    s._hdrCurrentLuminance = 1,
                    s._bloomEnabled = !1,
                    s._depthOfFieldEnabled = !1,
                    s._vlsEnabled = !1,
                    s._lensFlareEnabled = !1,
                    s._hdrEnabled = !1,
                    s._motionBlurEnabled = !1,
                    s._fxaaEnabled = !1,
                    s._motionBlurSamples = 64,
                    s._volumetricLightStepsCount = 50,
                    s._samples = 1,
                    s._cameras = a || [],
                    s._scene = i,
                    s._basePostProcess = o,
                    s._ratio = n,
                    s._floatTextureType = i.getEngine().getCaps().textureFloatRender ? e.Engine.TEXTURETYPE_FLOAT : e.Engine.TEXTURETYPE_HALF_FLOAT,
                    i.postProcessRenderPipelineManager.addPipeline(s),
                    s._buildPipeline(),
                    s
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "BloomEnabled", {
                    get: function() {
                        return this._bloomEnabled
                    },
                    set: function(e) {
                        this._bloomEnabled !== e && (this._bloomEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "DepthOfFieldEnabled", {
                    get: function() {
                        return this._depthOfFieldEnabled
                    },
                    set: function(e) {
                        this._depthOfFieldEnabled !== e && (this._depthOfFieldEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "LensFlareEnabled", {
                    get: function() {
                        return this._lensFlareEnabled
                    },
                    set: function(e) {
                        this._lensFlareEnabled !== e && (this._lensFlareEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "HDREnabled", {
                    get: function() {
                        return this._hdrEnabled
                    },
                    set: function(e) {
                        this._hdrEnabled !== e && (this._hdrEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "VLSEnabled", {
                    get: function() {
                        return this._vlsEnabled
                    },
                    set: function(t) {
                        if (this._vlsEnabled !== t) {
                            if (t)
                                if (!this._scene.enableGeometryBufferRenderer())
                                    return void e.Tools.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline");
                            this._vlsEnabled = t,
                            this._buildPipeline()
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "MotionBlurEnabled", {
                    get: function() {
                        return this._motionBlurEnabled
                    },
                    set: function(e) {
                        this._motionBlurEnabled !== e && (this._motionBlurEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "fxaaEnabled", {
                    get: function() {
                        return this._fxaaEnabled
                    },
                    set: function(e) {
                        this._fxaaEnabled !== e && (this._fxaaEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "volumetricLightStepsCount", {
                    get: function() {
                        return this._volumetricLightStepsCount
                    },
                    set: function(e) {
                        this.volumetricLightPostProcess && this.volumetricLightPostProcess.updateEffect("#define VLS\n#define NB_STEPS " + e.toFixed(1)),
                        this._volumetricLightStepsCount = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "motionBlurSamples", {
                    get: function() {
                        return this._motionBlurSamples
                    },
                    set: function(e) {
                        this.motionBlurPostProcess && this.motionBlurPostProcess.updateEffect("#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES " + e.toFixed(1)),
                        this._motionBlurSamples = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "samples", {
                    get: function() {
                        return this._samples
                    },
                    set: function(e) {
                        this._samples !== e && (this._samples = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._buildPipeline = function() {
                    var t = this
                      , r = this._ratio
                      , i = this._scene;
                    this._disposePostProcesses(),
                    this._reset(),
                    this._basePostProcess ? this.originalPostProcess = this._basePostProcess : (this.originalPostProcess = new e.PostProcess("HDRPass","standard",[],[],r,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),
                    this.originalPostProcess.onApply = function(e) {
                        t._currentDepthOfFieldSource = t.originalPostProcess
                    }
                    ),
                    (this._bloomEnabled || this._vlsEnabled || this._lensFlareEnabled || this._depthOfFieldEnabled || this._motionBlurEnabled) && this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRPassPostProcess",(function() {
                        return t.originalPostProcess
                    }
                    ),!0)),
                    this._currentDepthOfFieldSource = this.originalPostProcess,
                    this._bloomEnabled && (this._createDownSampleX4PostProcess(i, r / 2),
                    this._createBrightPassPostProcess(i, r / 2),
                    this._createBlurPostProcesses(i, r / 4, 1),
                    this._createTextureAdderPostProcess(i, r),
                    this.textureAdderFinalPostProcess = new e.PostProcess("HDRDepthOfFieldSource","standard",[],[],r,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRBaseDepthOfFieldSource",(function() {
                        return t.textureAdderFinalPostProcess
                    }
                    ),!0))),
                    this._vlsEnabled && (this._createVolumetricLightPostProcess(i, r),
                    this.volumetricLightFinalPostProcess = new e.PostProcess("HDRVLSFinal","standard",[],[],r,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRVLSFinal",(function() {
                        return t.volumetricLightFinalPostProcess
                    }
                    ),!0))),
                    this._lensFlareEnabled && (this._createLensFlarePostProcess(i, r),
                    this.lensFlareFinalPostProcess = new e.PostProcess("HDRPostLensFlareDepthOfFieldSource","standard",[],[],r,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRPostLensFlareDepthOfFieldSource",(function() {
                        return t.lensFlareFinalPostProcess
                    }
                    ),!0))),
                    this._hdrEnabled && (this._createLuminancePostProcesses(i, this._floatTextureType),
                    this._createHdrPostProcess(i, r),
                    this.hdrFinalPostProcess = new e.PostProcess("HDRPostHDReDepthOfFieldSource","standard",[],[],r,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRPostHDReDepthOfFieldSource",(function() {
                        return t.hdrFinalPostProcess
                    }
                    ),!0))),
                    this._depthOfFieldEnabled && (this._createBlurPostProcesses(i, r / 2, 3, "depthOfFieldBlurWidth"),
                    this._createDepthOfFieldPostProcess(i, r)),
                    this._motionBlurEnabled && this._createMotionBlurPostProcess(i, r),
                    this._fxaaEnabled && (this.fxaaPostProcess = new e.FxaaPostProcess("fxaa",1,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRFxaa",(function() {
                        return t.fxaaPostProcess
                    }
                    ),!0))),
                    null !== this._cameras && this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name, this._cameras),
                    !this._enableMSAAOnFirstPostProcess(this._samples) && this._samples > 1 && e.Tools.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")
                }
                ,
                r.prototype._createDownSampleX4PostProcess = function(t, r) {
                    var i = this
                      , n = new Array(32);
                    this.downSampleX4PostProcess = new e.PostProcess("HDRDownSampleX4","standard",["dsOffsets"],[],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define DOWN_SAMPLE_X4",e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this.downSampleX4PostProcess.onApply = function(e) {
                        for (var t = 0, r = i.downSampleX4PostProcess.width, o = i.downSampleX4PostProcess.height, a = -2; a < 2; a++)
                            for (var s = -2; s < 2; s++)
                                n[t] = (a + .5) * (1 / r),
                                n[t + 1] = (s + .5) * (1 / o),
                                t += 2;
                        e.setArray2("dsOffsets", n)
                    }
                    ,
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRDownSampleX4",(function() {
                        return i.downSampleX4PostProcess
                    }
                    ),!0))
                }
                ,
                r.prototype._createBrightPassPostProcess = function(t, r) {
                    var i = this
                      , n = new Array(8);
                    this.brightPassPostProcess = new e.PostProcess("HDRBrightPass","standard",["dsOffsets", "brightThreshold"],[],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define BRIGHT_PASS",e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this.brightPassPostProcess.onApply = function(e) {
                        var t = 1 / i.brightPassPostProcess.width
                          , r = 1 / i.brightPassPostProcess.height;
                        n[0] = -.5 * t,
                        n[1] = .5 * r,
                        n[2] = .5 * t,
                        n[3] = .5 * r,
                        n[4] = -.5 * t,
                        n[5] = -.5 * r,
                        n[6] = .5 * t,
                        n[7] = -.5 * r,
                        e.setArray2("dsOffsets", n),
                        e.setFloat("brightThreshold", i.brightThreshold)
                    }
                    ,
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRBrightPass",(function() {
                        return i.brightPassPostProcess
                    }
                    ),!0))
                }
                ,
                r.prototype._createBlurPostProcesses = function(t, r, i, n) {
                    var o = this;
                    void 0 === n && (n = "blurWidth");
                    var a = t.getEngine()
                      , s = new e.BlurPostProcess("HDRBlurH_" + i,new e.Vector2(1,0),this[n],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT)
                      , y = new e.BlurPostProcess("HDRBlurV_" + i,new e.Vector2(0,1),this[n],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT);
                    s.onActivateObservable.add((function() {
                        var e = s.width / a.getRenderWidth();
                        s.kernel = o[n] * e
                    }
                    )),
                    y.onActivateObservable.add((function() {
                        var e = y.height / a.getRenderHeight();
                        y.kernel = o.horizontalBlur ? 64 * e : o[n] * e
                    }
                    )),
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRBlurH" + i,(function() {
                        return s
                    }
                    ),!0)),
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRBlurV" + i,(function() {
                        return y
                    }
                    ),!0)),
                    this.blurHPostProcesses.push(s),
                    this.blurVPostProcesses.push(y)
                }
                ,
                r.prototype._createTextureAdderPostProcess = function(t, r) {
                    var i = this;
                    this.textureAdderPostProcess = new e.PostProcess("HDRTextureAdder","standard",["exposure"],["otherSampler", "lensSampler"],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define TEXTURE_ADDER",e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this.textureAdderPostProcess.onApply = function(e) {
                        e.setTextureFromPostProcess("otherSampler", i._vlsEnabled ? i._currentDepthOfFieldSource : i.originalPostProcess),
                        e.setTexture("lensSampler", i.lensTexture),
                        e.setFloat("exposure", i.exposure),
                        i._currentDepthOfFieldSource = i.textureAdderFinalPostProcess
                    }
                    ,
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRTextureAdder",(function() {
                        return i.textureAdderPostProcess
                    }
                    ),!0))
                }
                ,
                r.prototype._createVolumetricLightPostProcess = function(t, r) {
                    var i = this
                      , n = t.enableGeometryBufferRenderer();
                    n.enablePosition = !0;
                    var o = n.getGBuffer();
                    this.volumetricLightPostProcess = new e.PostProcess("HDRVLS","standard",["shadowViewProjection", "cameraPosition", "sunDirection", "sunColor", "scatteringCoefficient", "scatteringPower", "depthValues"],["shadowMapSampler", "positionSampler"],r / 8,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define VLS\n#define NB_STEPS " + this._volumetricLightStepsCount.toFixed(1));
                    var a = e.Vector2.Zero();
                    this.volumetricLightPostProcess.onApply = function(e) {
                        if (i.sourceLight && i.sourceLight.getShadowGenerator() && i._scene.activeCamera) {
                            var t = i.sourceLight.getShadowGenerator();
                            e.setTexture("shadowMapSampler", t.getShadowMap()),
                            e.setTexture("positionSampler", o.textures[2]),
                            e.setColor3("sunColor", i.sourceLight.diffuse),
                            e.setVector3("sunDirection", i.sourceLight.getShadowDirection()),
                            e.setVector3("cameraPosition", i._scene.activeCamera.globalPosition),
                            e.setMatrix("shadowViewProjection", t.getTransformMatrix()),
                            e.setFloat("scatteringCoefficient", i.volumetricLightCoefficient),
                            e.setFloat("scatteringPower", i.volumetricLightPower),
                            a.x = i.sourceLight.getDepthMinZ(i._scene.activeCamera),
                            a.y = i.sourceLight.getDepthMaxZ(i._scene.activeCamera),
                            e.setVector2("depthValues", a)
                        }
                    }
                    ,
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRVLS",(function() {
                        return i.volumetricLightPostProcess
                    }
                    ),!0)),
                    this._createBlurPostProcesses(t, r / 4, 0, "volumetricLightBlurScale"),
                    this.volumetricLightMergePostProces = new e.PostProcess("HDRVLSMerge","standard",[],["originalSampler"],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define VLSMERGE"),
                    this.volumetricLightMergePostProces.onApply = function(e) {
                        e.setTextureFromPostProcess("originalSampler", i._bloomEnabled ? i.textureAdderFinalPostProcess : i.originalPostProcess),
                        i._currentDepthOfFieldSource = i.volumetricLightFinalPostProcess
                    }
                    ,
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRVLSMerge",(function() {
                        return i.volumetricLightMergePostProces
                    }
                    ),!0))
                }
                ,
                r.prototype._createLuminancePostProcesses = function(t, i) {
                    var n = this
                      , o = Math.pow(3, r.LuminanceSteps);
                    this.luminancePostProcess = new e.PostProcess("HDRLuminance","standard",["lumOffsets"],[],{
                        width: o,
                        height: o
                    },null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define LUMINANCE",i);
                    var a = [];
                    this.luminancePostProcess.onApply = function(e) {
                        var t = 1 / n.luminancePostProcess.width
                          , r = 1 / n.luminancePostProcess.height;
                        a[0] = -.5 * t,
                        a[1] = .5 * r,
                        a[2] = .5 * t,
                        a[3] = .5 * r,
                        a[4] = -.5 * t,
                        a[5] = -.5 * r,
                        a[6] = .5 * t,
                        a[7] = -.5 * r,
                        e.setArray2("lumOffsets", a)
                    }
                    ,
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLuminance",(function() {
                        return n.luminancePostProcess
                    }
                    ),!0));
                    for (var s = r.LuminanceSteps - 1; s >= 0; s--) {
                        o = Math.pow(3, s);
                        var y = "#define LUMINANCE_DOWN_SAMPLE\n";
                        0 === s && (y += "#define FINAL_DOWN_SAMPLER");
                        var l = new e.PostProcess("HDRLuminanceDownSample" + s,"standard",["dsOffsets", "halfDestPixelSize"],[],{
                            width: o,
                            height: o
                        },null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,y,i);
                        this.luminanceDownSamplePostProcesses.push(l)
                    }
                    var c = this.luminancePostProcess;
                    this.luminanceDownSamplePostProcesses.forEach((function(r, i) {
                        var o = new Array(18);
                        r.onApply = function(e) {
                            if (c) {
                                for (var t = 0, a = -1; a < 2; a++)
                                    for (var s = -1; s < 2; s++)
                                        o[t] = a / c.width,
                                        o[t + 1] = s / c.height,
                                        t += 2;
                                e.setArray2("dsOffsets", o),
                                e.setFloat("halfDestPixelSize", .5 / c.width),
                                c = i === n.luminanceDownSamplePostProcesses.length - 1 ? n.luminancePostProcess : r
                            }
                        }
                        ,
                        i === n.luminanceDownSamplePostProcesses.length - 1 && (r.onAfterRender = function(r) {
                            var i = t.getEngine().readPixels(0, 0, 1, 1)
                              , o = new e.Vector4(1 / 16581375,1 / 65025,1 / 255,1);
                            n._hdrCurrentLuminance = (i[0] * o.x + i[1] * o.y + i[2] * o.z + i[3] * o.w) / 100
                        }
                        ),
                        n.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLuminanceDownSample" + i,(function() {
                            return r
                        }
                        ),!0))
                    }
                    ))
                }
                ,
                r.prototype._createHdrPostProcess = function(t, r) {
                    var i = this;
                    this.hdrPostProcess = new e.PostProcess("HDR","standard",["averageLuminance"],["textureAdderSampler"],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define HDR",e.Engine.TEXTURETYPE_UNSIGNED_INT);
                    var n = 1
                      , o = 0
                      , a = 0;
                    this.hdrPostProcess.onApply = function(r) {
                        if (r.setTextureFromPostProcess("textureAdderSampler", i._currentDepthOfFieldSource),
                        o += t.getEngine().getDeltaTime(),
                        n < 0)
                            n = i._hdrCurrentLuminance;
                        else {
                            var s = (a - o) / 1e3;
                            i._hdrCurrentLuminance < n + i.hdrDecreaseRate * s ? n += i.hdrDecreaseRate * s : i._hdrCurrentLuminance > n - i.hdrIncreaseRate * s ? n -= i.hdrIncreaseRate * s : n = i._hdrCurrentLuminance
                        }
                        n = e.Scalar.Clamp(n, i.hdrMinimumLuminance, 1e20),
                        r.setFloat("averageLuminance", n),
                        a = o,
                        i._currentDepthOfFieldSource = i.hdrFinalPostProcess
                    }
                    ,
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDR",(function() {
                        return i.hdrPostProcess
                    }
                    ),!0))
                }
                ,
                r.prototype._createLensFlarePostProcess = function(t, r) {
                    var i = this;
                    this.lensFlarePostProcess = new e.PostProcess("HDRLensFlare","standard",["strength", "ghostDispersal", "haloWidth", "resolution", "distortionStrength"],["lensColorSampler"],r / 2,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define LENS_FLARE",e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLensFlare",(function() {
                        return i.lensFlarePostProcess
                    }
                    ),!0)),
                    this._createBlurPostProcesses(t, r / 4, 2),
                    this.lensFlareComposePostProcess = new e.PostProcess("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler", "lensDirtSampler", "lensStarSampler"],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define LENS_FLARE_COMPOSE",e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLensFlareCompose",(function() {
                        return i.lensFlareComposePostProcess
                    }
                    ),!0));
                    var n = new e.Vector2(0,0);
                    this.lensFlarePostProcess.onApply = function(e) {
                        e.setTextureFromPostProcess("textureSampler", i._bloomEnabled ? i.blurHPostProcesses[0] : i.originalPostProcess),
                        e.setTexture("lensColorSampler", i.lensColorTexture),
                        e.setFloat("strength", i.lensFlareStrength),
                        e.setFloat("ghostDispersal", i.lensFlareGhostDispersal),
                        e.setFloat("haloWidth", i.lensFlareHaloWidth),
                        n.x = i.lensFlarePostProcess.width,
                        n.y = i.lensFlarePostProcess.height,
                        e.setVector2("resolution", n),
                        e.setFloat("distortionStrength", i.lensFlareDistortionStrength)
                    }
                    ;
                    var o = e.Matrix.FromValues(2, 0, -1, 0, 0, 2, -1, 0, 0, 0, 1, 0, 0, 0, 0, 1)
                      , a = e.Matrix.FromValues(.5, 0, .5, 0, 0, .5, .5, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                    this.lensFlareComposePostProcess.onApply = function(t) {
                        if (i._scene.activeCamera) {
                            t.setTextureFromPostProcess("otherSampler", i._currentDepthOfFieldSource),
                            t.setTexture("lensDirtSampler", i.lensFlareDirtTexture),
                            t.setTexture("lensStarSampler", i.lensStarTexture);
                            var r = i._scene.activeCamera.getViewMatrix().getRow(0)
                              , n = i._scene.activeCamera.getViewMatrix().getRow(2)
                              , s = e.Vector3.Dot(r.toVector3(), new e.Vector3(1,0,0)) + e.Vector3.Dot(n.toVector3(), new e.Vector3(0,0,1));
                            s *= 4;
                            var y = e.Matrix.FromValues(.5 * Math.cos(s), -Math.sin(s), 0, 0, Math.sin(s), .5 * Math.cos(s), 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)
                              , l = a.multiply(y).multiply(o);
                            t.setMatrix("lensStarMatrix", l),
                            i._currentDepthOfFieldSource = i.lensFlareFinalPostProcess
                        }
                    }
                }
                ,
                r.prototype._createDepthOfFieldPostProcess = function(t, r) {
                    var i = this;
                    this.depthOfFieldPostProcess = new e.PostProcess("HDRDepthOfField","standard",["distance"],["otherSampler", "depthSampler"],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define DEPTH_OF_FIELD",e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this.depthOfFieldPostProcess.onApply = function(e) {
                        e.setTextureFromPostProcess("otherSampler", i._currentDepthOfFieldSource),
                        e.setTexture("depthSampler", i._getDepthTexture()),
                        e.setFloat("distance", i.depthOfFieldDistance)
                    }
                    ,
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRDepthOfField",(function() {
                        return i.depthOfFieldPostProcess
                    }
                    ),!0))
                }
                ,
                r.prototype._createMotionBlurPostProcess = function(t, r) {
                    var i = this;
                    this.motionBlurPostProcess = new e.PostProcess("HDRMotionBlur","standard",["inverseViewProjection", "prevViewProjection", "screenSize", "motionScale", "motionStrength"],["depthSampler"],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES " + this.motionBlurSamples.toFixed(1),e.Engine.TEXTURETYPE_UNSIGNED_INT);
                    var n = 0
                      , o = e.Matrix.Identity()
                      , a = e.Matrix.Identity()
                      , s = e.Matrix.Identity()
                      , y = e.Vector2.Zero();
                    this.motionBlurPostProcess.onApply = function(e) {
                        (s = t.getProjectionMatrix().multiply(t.getViewMatrix())).invertToRef(a),
                        e.setMatrix("inverseViewProjection", a),
                        e.setMatrix("prevViewProjection", o),
                        o = s,
                        y.x = i.motionBlurPostProcess.width,
                        y.y = i.motionBlurPostProcess.height,
                        e.setVector2("screenSize", y),
                        n = t.getEngine().getFps() / 60,
                        e.setFloat("motionScale", n),
                        e.setFloat("motionStrength", i.motionStrength),
                        e.setTexture("depthSampler", i._getDepthTexture())
                    }
                    ,
                    this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRMotionBlur",(function() {
                        return i.motionBlurPostProcess
                    }
                    ),!0))
                }
                ,
                r.prototype._getDepthTexture = function() {
                    return this._scene.getEngine().getCaps().drawBuffersExtension ? this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0] : this._scene.enableDepthRenderer().getDepthMap()
                }
                ,
                r.prototype._disposePostProcesses = function() {
                    for (var e = 0; e < this._cameras.length; e++) {
                        var t = this._cameras[e];
                        this.originalPostProcess && this.originalPostProcess.dispose(t),
                        this.downSampleX4PostProcess && this.downSampleX4PostProcess.dispose(t),
                        this.brightPassPostProcess && this.brightPassPostProcess.dispose(t),
                        this.textureAdderPostProcess && this.textureAdderPostProcess.dispose(t),
                        this.textureAdderFinalPostProcess && this.textureAdderFinalPostProcess.dispose(t),
                        this.volumetricLightPostProcess && this.volumetricLightPostProcess.dispose(t),
                        this.volumetricLightSmoothXPostProcess && this.volumetricLightSmoothXPostProcess.dispose(t),
                        this.volumetricLightSmoothYPostProcess && this.volumetricLightSmoothYPostProcess.dispose(t),
                        this.volumetricLightMergePostProces && this.volumetricLightMergePostProces.dispose(t),
                        this.volumetricLightFinalPostProcess && this.volumetricLightFinalPostProcess.dispose(t),
                        this.lensFlarePostProcess && this.lensFlarePostProcess.dispose(t),
                        this.lensFlareComposePostProcess && this.lensFlareComposePostProcess.dispose(t);
                        for (var r = 0; r < this.luminanceDownSamplePostProcesses.length; r++)
                            this.luminanceDownSamplePostProcesses[r].dispose(t);
                        this.luminancePostProcess && this.luminancePostProcess.dispose(t),
                        this.hdrPostProcess && this.hdrPostProcess.dispose(t),
                        this.hdrFinalPostProcess && this.hdrFinalPostProcess.dispose(t),
                        this.depthOfFieldPostProcess && this.depthOfFieldPostProcess.dispose(t),
                        this.motionBlurPostProcess && this.motionBlurPostProcess.dispose(t),
                        this.fxaaPostProcess && this.fxaaPostProcess.dispose(t);
                        for (r = 0; r < this.blurHPostProcesses.length; r++)
                            this.blurHPostProcesses[r].dispose(t);
                        for (r = 0; r < this.blurVPostProcesses.length; r++)
                            this.blurVPostProcesses[r].dispose(t)
                    }
                    this.originalPostProcess = null,
                    this.downSampleX4PostProcess = null,
                    this.brightPassPostProcess = null,
                    this.textureAdderPostProcess = null,
                    this.textureAdderFinalPostProcess = null,
                    this.volumetricLightPostProcess = null,
                    this.volumetricLightSmoothXPostProcess = null,
                    this.volumetricLightSmoothYPostProcess = null,
                    this.volumetricLightMergePostProces = null,
                    this.volumetricLightFinalPostProcess = null,
                    this.lensFlarePostProcess = null,
                    this.lensFlareComposePostProcess = null,
                    this.luminancePostProcess = null,
                    this.hdrPostProcess = null,
                    this.hdrFinalPostProcess = null,
                    this.depthOfFieldPostProcess = null,
                    this.motionBlurPostProcess = null,
                    this.fxaaPostProcess = null,
                    this.luminanceDownSamplePostProcesses = [],
                    this.blurHPostProcesses = [],
                    this.blurVPostProcesses = []
                }
                ,
                r.prototype.dispose = function() {
                    this._disposePostProcesses(),
                    this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._cameras),
                    t.prototype.dispose.call(this)
                }
                ,
                r.prototype.serialize = function() {
                    var t = e.SerializationHelper.Serialize(this);
                    return this.sourceLight && (t.sourceLightId = this.sourceLight.id),
                    t.customType = "StandardRenderingPipeline",
                    t
                }
                ,
                r.Parse = function(t, i, n) {
                    var o = e.SerializationHelper.Parse((function() {
                        return new r(t._name,i,t._ratio)
                    }
                    ), t, i, n);
                    return t.sourceLightId && (o.sourceLight = i.getLightByID(t.sourceLightId)),
                    o
                }
                ,
                r.LuminanceSteps = 6,
                n([e.serialize()], r.prototype, "brightThreshold", void 0),
                n([e.serialize()], r.prototype, "blurWidth", void 0),
                n([e.serialize()], r.prototype, "horizontalBlur", void 0),
                n([e.serialize()], r.prototype, "exposure", void 0),
                n([e.serializeAsTexture("lensTexture")], r.prototype, "lensTexture", void 0),
                n([e.serialize()], r.prototype, "volumetricLightCoefficient", void 0),
                n([e.serialize()], r.prototype, "volumetricLightPower", void 0),
                n([e.serialize()], r.prototype, "volumetricLightBlurScale", void 0),
                n([e.serialize()], r.prototype, "hdrMinimumLuminance", void 0),
                n([e.serialize()], r.prototype, "hdrDecreaseRate", void 0),
                n([e.serialize()], r.prototype, "hdrIncreaseRate", void 0),
                n([e.serializeAsTexture("lensColorTexture")], r.prototype, "lensColorTexture", void 0),
                n([e.serialize()], r.prototype, "lensFlareStrength", void 0),
                n([e.serialize()], r.prototype, "lensFlareGhostDispersal", void 0),
                n([e.serialize()], r.prototype, "lensFlareHaloWidth", void 0),
                n([e.serialize()], r.prototype, "lensFlareDistortionStrength", void 0),
                n([e.serializeAsTexture("lensStarTexture")], r.prototype, "lensStarTexture", void 0),
                n([e.serializeAsTexture("lensFlareDirtTexture")], r.prototype, "lensFlareDirtTexture", void 0),
                n([e.serialize()], r.prototype, "depthOfFieldDistance", void 0),
                n([e.serialize()], r.prototype, "depthOfFieldBlurWidth", void 0),
                n([e.serialize()], r.prototype, "motionStrength", void 0),
                n([e.serialize()], r.prototype, "_ratio", void 0),
                n([e.serialize()], r.prototype, "BloomEnabled", null),
                n([e.serialize()], r.prototype, "DepthOfFieldEnabled", null),
                n([e.serialize()], r.prototype, "LensFlareEnabled", null),
                n([e.serialize()], r.prototype, "HDREnabled", null),
                n([e.serialize()], r.prototype, "VLSEnabled", null),
                n([e.serialize()], r.prototype, "MotionBlurEnabled", null),
                n([e.serialize()], r.prototype, "fxaaEnabled", null),
                n([e.serialize()], r.prototype, "volumetricLightStepsCount", null),
                n([e.serialize()], r.prototype, "motionBlurSamples", null),
                n([e.serialize()], r.prototype, "samples", null),
                r
            }(e.PostProcessRenderPipeline);
            e.StandardRenderingPipeline = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y) {
                    void 0 === n && (n = null),
                    void 0 === y && (y = e.Engine.TEXTURETYPE_UNSIGNED_INT);
                    var l = t.call(this, r, "fxaa", ["texelSize"], null, i, n, o || e.Texture.BILINEAR_SAMPLINGMODE, a, s, null, y, "fxaa", void 0, !0) || this
                      , c = l._getDefines();
                    return l.updateEffect(c),
                    l.onApplyObservable.add((function(e) {
                        var t = l.texelSize;
                        e.setFloat2("texelSize", t.x, t.y)
                    }
                    )),
                    l
                }
                return o(r, t),
                r.prototype._getDefines = function() {
                    var e = this.getEngine();
                    if (!e)
                        return null;
                    var t = e.getGlInfo();
                    return t && t.renderer && t.renderer.toLowerCase().indexOf("mali") > -1 ? "#define MALI 1\n" : null
                }
                ,
                r
            }(e.PostProcess);
            e.FxaaPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c, h) {
                    void 0 === c && (c = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === h && (h = !1);
                    var u = t.call(this, r, "chromaticAberration", ["chromatic_aberration", "screen_width", "screen_height", "direction", "radialIntensity", "centerPosition"], [], o, a, s, y, l, null, c, void 0, null, h) || this;
                    return u.aberrationAmount = 30,
                    u.radialIntensity = 0,
                    u.direction = new e.Vector2(.707,.707),
                    u.centerPosition = new e.Vector2(.5,.5),
                    u.onApplyObservable.add((function(e) {
                        e.setFloat("chromatic_aberration", u.aberrationAmount),
                        e.setFloat("screen_width", i),
                        e.setFloat("screen_height", n),
                        e.setFloat("radialIntensity", u.radialIntensity),
                        e.setFloat2("direction", u.direction.x, u.direction.y),
                        e.setFloat2("centerPosition", u.centerPosition.x, u.centerPosition.y)
                    }
                    )),
                    u
                }
                return o(r, t),
                r
            }(e.PostProcess);
            e.ChromaticAberrationPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l) {
                    void 0 === y && (y = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === l && (l = !1);
                    var c = t.call(this, r, "grain", ["intensity", "animatedSeed"], [], i, n, o, a, s, null, y, void 0, null, l) || this;
                    return c.intensity = 30,
                    c.animated = !1,
                    c.onApplyObservable.add((function(e) {
                        e.setFloat("intensity", c.intensity),
                        e.setFloat("animatedSeed", c.animated ? Math.random() + 1 : 1)
                    }
                    )),
                    c
                }
                return o(r, t),
                r
            }(e.PostProcess);
            e.GrainPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l) {
                    void 0 === y && (y = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === l && (l = !1);
                    var c = t.call(this, r, "sharpen", ["sharpnessAmounts", "screenSize"], null, i, n, o, a, s, null, y, void 0, null, l) || this;
                    return c.colorAmount = 1,
                    c.edgeAmount = .3,
                    c.onApply = function(e) {
                        e.setFloat2("screenSize", c.width, c.height),
                        e.setFloat2("sharpnessAmounts", c.edgeAmount, c.colorAmount)
                    }
                    ,
                    c
                }
                return o(r, t),
                r
            }(e.PostProcess);
            e.SharpenPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c, h, u) {
                    void 0 === s && (s = e.Texture.BILINEAR_SAMPLINGMODE),
                    void 0 === c && (c = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === h && (h = ""),
                    void 0 === u && (u = !1);
                    var d = t.call(this, r, "kernelBlur", ["delta", "direction", "cameraMinMaxZ"], ["circleOfConfusionSampler"], o, a, s, y, l, null, c, "kernelBlur", {
                        varyingCount: 0,
                        depCount: 0
                    }, !0) || this;
                    return d.direction = i,
                    d.blockCompilation = u,
                    d._packedFloat = !1,
                    d._staticDefines = "",
                    d._staticDefines = h,
                    d.onApplyObservable.add((function(e) {
                        d._outputTexture ? e.setFloat2("delta", 1 / d._outputTexture.width * d.direction.x, 1 / d._outputTexture.height * d.direction.y) : e.setFloat2("delta", 1 / d.width * d.direction.x, 1 / d.height * d.direction.y)
                    }
                    )),
                    d.kernel = n,
                    d
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "kernel", {
                    get: function() {
                        return this._idealKernel
                    },
                    set: function(e) {
                        this._idealKernel !== e && (e = Math.max(e, 1),
                        this._idealKernel = e,
                        this._kernel = this._nearestBestKernel(e),
                        this.blockCompilation || this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "packedFloat", {
                    get: function() {
                        return this._packedFloat
                    },
                    set: function(e) {
                        this._packedFloat !== e && (this._packedFloat = e,
                        this.blockCompilation || this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.updateEffect = function(e, t, r, i, n, o) {
                    void 0 === e && (e = null),
                    void 0 === t && (t = null),
                    void 0 === r && (r = null),
                    this._updateParameters(n, o)
                }
                ,
                r.prototype._updateParameters = function(e, r) {
                    for (var i = this._kernel, n = (i - 1) / 2, o = [], a = [], s = 0, y = 0; y < i; y++) {
                        var l = y / (i - 1)
                          , c = this._gaussianWeight(2 * l - 1);
                        o[y] = y - n,
                        a[y] = c,
                        s += c
                    }
                    for (y = 0; y < a.length; y++)
                        a[y] /= s;
                    var h = []
                      , u = []
                      , d = [];
                    for (y = 0; y <= n; y += 2) {
                        var x = Math.min(y + 1, Math.floor(n));
                        if (y === x)
                            d.push({
                                o: o[y],
                                w: a[y]
                            });
                        else {
                            var p = x === n
                              , f = a[y] + a[x] * (p ? .5 : 1)
                              , m = o[y] + 1 / (1 + a[y] / a[x]);
                            0 === m ? (d.push({
                                o: o[y],
                                w: a[y]
                            }),
                            d.push({
                                o: o[y + 1],
                                w: a[y + 1]
                            })) : (d.push({
                                o: m,
                                w: f
                            }),
                            d.push({
                                o: -m,
                                w: f
                            }))
                        }
                    }
                    for (y = 0; y < d.length; y++)
                        u[y] = d[y].o,
                        h[y] = d[y].w;
                    o = u,
                    a = h;
                    var z = this.getEngine().getCaps().maxVaryingVectors
                      , _ = Math.max(z, 0) - 1
                      , g = Math.min(o.length, _)
                      , v = "";
                    v += this._staticDefines,
                    -1 != this._staticDefines.indexOf("DOF") && (v += "#define CENTER_WEIGHT " + this._glslFloat(a[g - 1]) + "\r\n",
                    g--);
                    for (y = 0; y < g; y++)
                        v += "#define KERNEL_OFFSET" + y + " " + this._glslFloat(o[y]) + "\r\n",
                        v += "#define KERNEL_WEIGHT" + y + " " + this._glslFloat(a[y]) + "\r\n";
                    var b = 0;
                    for (y = _; y < o.length; y++)
                        v += "#define KERNEL_DEP_OFFSET" + b + " " + this._glslFloat(o[y]) + "\r\n",
                        v += "#define KERNEL_DEP_WEIGHT" + b + " " + this._glslFloat(a[y]) + "\r\n",
                        b++;
                    this.packedFloat && (v += "#define PACKEDFLOAT 1"),
                    this.blockCompilation = !1,
                    t.prototype.updateEffect.call(this, v, null, null, {
                        varyingCount: g,
                        depCount: b
                    }, e, r)
                }
                ,
                r.prototype._nearestBestKernel = function(e) {
                    for (var t = Math.round(e), r = 0, i = [t, t - 1, t + 1, t - 2, t + 2]; r < i.length; r++) {
                        var n = i[r];
                        if (n % 2 != 0 && Math.floor(n / 2) % 2 == 0 && n > 0)
                            return Math.max(n, 3)
                    }
                    return Math.max(t, 3)
                }
                ,
                r.prototype._gaussianWeight = function(e) {
                    var t = -e * e / (1 / 3 * 2 * (1 / 3));
                    return 1 / (Math.sqrt(2 * Math.PI) * (1 / 3)) * Math.exp(t)
                }
                ,
                r.prototype._glslFloat = function(e, t) {
                    return void 0 === t && (t = 8),
                    e.toFixed(t).replace(/0+$/, "")
                }
                ,
                r
            }(e.PostProcess);
            e.BlurPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c, h, u, d, x) {
                    void 0 === l && (l = null),
                    void 0 === c && (c = e.Texture.BILINEAR_SAMPLINGMODE),
                    void 0 === d && (d = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === x && (x = !1);
                    var p = t.call(this, r, n, o, a, s, c = e.Texture.BILINEAR_SAMPLINGMODE, h, u, d = e.Engine.TEXTURETYPE_UNSIGNED_INT, "#define DOF 1\r\n", x) || this;
                    return p.direction = n,
                    p.onApplyObservable.add((function(e) {
                        null != l && e.setTextureFromPostProcess("textureSampler", l),
                        e.setTextureFromPostProcessOutput("circleOfConfusionSampler", y),
                        i.activeCamera && e.setFloat2("cameraMinMaxZ", i.activeCamera.minZ, i.activeCamera.maxZ)
                    }
                    )),
                    p
                }
                return o(r, t),
                r
            }(e.BlurPostProcess);
            e.DepthOfFieldBlurPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function() {};
            e.DepthOfFieldMergePostProcessOptions = t;
            var r = function(t) {
                function r(r, i, n, o, a, s, y, l, c, h, u) {
                    void 0 === h && (h = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === u && (u = !1);
                    var d = t.call(this, r, "depthOfFieldMerge", [], ["circleOfConfusionSampler", "blurStep0", "blurStep1", "blurStep2"], a, s, y, l, c, null, h, void 0, null, !0) || this;
                    return d.blurSteps = o,
                    d.onApplyObservable.add((function(e) {
                        e.setTextureFromPostProcess("textureSampler", i),
                        e.setTextureFromPostProcessOutput("circleOfConfusionSampler", n),
                        o.forEach((function(t, r) {
                            e.setTextureFromPostProcessOutput("blurStep" + (o.length - r - 1), t)
                        }
                        ))
                    }
                    )),
                    u || d.updateEffect(),
                    d
                }
                return o(r, t),
                r.prototype.updateEffect = function(e, r, i, n, o, a) {
                    void 0 === e && (e = null),
                    void 0 === r && (r = null),
                    void 0 === i && (i = null),
                    e || (e = "",
                    e += "#define BLUR_LEVEL " + (this.blurSteps.length - 1) + "\n"),
                    t.prototype.updateEffect.call(this, e, r, i, n, o, a)
                }
                ,
                r
            }(e.PostProcess);
            e.DepthOfFieldMergePostProcess = r
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c) {
                    void 0 === l && (l = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === c && (c = !1);
                    var h = t.call(this, r, "circleOfConfusion", ["cameraMinMaxZ", "focusDistance", "cocPrecalculation"], ["depthSampler"], n, o, a, s, y, null, l, void 0, null, c) || this;
                    return h.lensSize = 50,
                    h.fStop = 1.4,
                    h.focusDistance = 2e3,
                    h.focalLength = 50,
                    h._depthTexture = null,
                    h._depthTexture = i,
                    h.onApplyObservable.add((function(t) {
                        if (h._depthTexture) {
                            t.setTexture("depthSampler", h._depthTexture);
                            var r = h.lensSize / h.fStop * h.focalLength / (h.focusDistance - h.focalLength);
                            t.setFloat("focusDistance", h.focusDistance),
                            t.setFloat("cocPrecalculation", r),
                            t.setFloat2("cameraMinMaxZ", h._depthTexture.activeCamera.minZ, h._depthTexture.activeCamera.maxZ)
                        } else
                            e.Tools.Warn("No depth texture set on CircleOfConfusionPostProcess")
                    }
                    )),
                    h
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "depthTexture", {
                    set: function(e) {
                        this._depthTexture = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r
            }(e.PostProcess);
            e.CircleOfConfusionPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t;
            !function(e) {
                e[e.Low = 0] = "Low",
                e[e.Medium = 1] = "Medium",
                e[e.High = 2] = "High"
            }(t = e.DepthOfFieldEffectBlurLevel || (e.DepthOfFieldEffectBlurLevel = {}));
            var r = function(r) {
                function i(i, n, o, a, s) {
                    void 0 === o && (o = t.Low),
                    void 0 === a && (a = 0),
                    void 0 === s && (s = !1);
                    var y = r.call(this, i.getEngine(), "depth of field", (function() {
                        return y._effects
                    }
                    ), !0) || this;
                    y._effects = [],
                    y._circleOfConfusion = new e.CircleOfConfusionPostProcess("circleOfConfusion",n,1,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,a,s),
                    y._depthOfFieldBlurY = [],
                    y._depthOfFieldBlurX = [];
                    var l = 1
                      , c = 15;
                    switch (o) {
                    case t.High:
                        l = 3,
                        c = 51;
                        break;
                    case t.Medium:
                        l = 2,
                        c = 31;
                        break;
                    default:
                        c = 15,
                        l = 1
                    }
                    for (var h = c / Math.pow(2, l - 1), u = 1, d = 0; d < l; d++) {
                        var x = new e.DepthOfFieldBlurPostProcess("verticle blur",i,new e.Vector2(0,1),h,u,null,y._circleOfConfusion,0 == d ? y._circleOfConfusion : null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,a,s);
                        x.autoClear = !1,
                        u = .75 / Math.pow(2, d);
                        var p = new e.DepthOfFieldBlurPostProcess("horizontal blur",i,new e.Vector2(1,0),h,u,null,y._circleOfConfusion,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,a,s);
                        p.autoClear = !1,
                        y._depthOfFieldBlurY.push(x),
                        y._depthOfFieldBlurX.push(p)
                    }
                    y._effects = [y._circleOfConfusion];
                    for (d = 0; d < y._depthOfFieldBlurX.length; d++)
                        y._effects.push(y._depthOfFieldBlurY[d]),
                        y._effects.push(y._depthOfFieldBlurX[d]);
                    return y._dofMerge = new e.DepthOfFieldMergePostProcess("dofMerge",y._circleOfConfusion,y._circleOfConfusion,y._depthOfFieldBlurX,u,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,a,s),
                    y._dofMerge.autoClear = !1,
                    y._effects.push(y._dofMerge),
                    y
                }
                return o(i, r),
                Object.defineProperty(i.prototype, "focalLength", {
                    get: function() {
                        return this._circleOfConfusion.focalLength
                    },
                    set: function(e) {
                        this._circleOfConfusion.focalLength = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "fStop", {
                    get: function() {
                        return this._circleOfConfusion.fStop
                    },
                    set: function(e) {
                        this._circleOfConfusion.fStop = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "focusDistance", {
                    get: function() {
                        return this._circleOfConfusion.focusDistance
                    },
                    set: function(e) {
                        this._circleOfConfusion.focusDistance = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "lensSize", {
                    get: function() {
                        return this._circleOfConfusion.lensSize
                    },
                    set: function(e) {
                        this._circleOfConfusion.lensSize = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "depthTexture", {
                    set: function(e) {
                        this._circleOfConfusion.depthTexture = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.disposeEffects = function(e) {
                    for (var t = 0; t < this._effects.length; t++)
                        this._effects[t].dispose(e)
                }
                ,
                i.prototype._updateEffects = function() {
                    for (var e = 0; e < this._effects.length; e++)
                        this._effects[e].updateEffect()
                }
                ,
                i.prototype._isReady = function() {
                    for (var e = 0; e < this._effects.length; e++)
                        if (!this._effects[e].isReady())
                            return !1;
                    return !0
                }
                ,
                i
            }(e.PostProcessRenderEffect);
            e.DepthOfFieldEffect = r
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c, h, u) {
                    void 0 === h && (h = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === u && (u = !1);
                    var d = t.call(this, r, "bloomMerge", ["bloomWeight"], ["circleOfConfusionSampler", "blurStep0", "blurStep1", "blurStep2", "bloomBlur"], a, s, y, l, c, null, h, void 0, null, !0) || this;
                    return d.weight = o,
                    d.onApplyObservable.add((function(e) {
                        e.setTextureFromPostProcess("textureSampler", i),
                        e.setTextureFromPostProcessOutput("bloomBlur", n),
                        e.setFloat("bloomWeight", d.weight)
                    }
                    )),
                    u || d.updateEffect(),
                    d
                }
                return o(r, t),
                r
            }(e.PostProcess);
            e.BloomMergePostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l) {
                    void 0 === y && (y = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    void 0 === l && (l = !1);
                    var c = t.call(this, r, "extractHighlights", ["threshold", "exposure"], null, i, n, o, a, s, null, y, void 0, null, l) || this;
                    return c.threshold = .9,
                    c._exposure = 1,
                    c._inputPostProcess = null,
                    c.onApplyObservable.add((function(t) {
                        c._inputPostProcess && t.setTextureFromPostProcess("textureSampler", c._inputPostProcess),
                        t.setFloat("threshold", Math.pow(c.threshold, e.ToGammaSpace)),
                        t.setFloat("exposure", c._exposure)
                    }
                    )),
                    c
                }
                return o(r, t),
                r
            }(e.PostProcess);
            e.ExtractHighlightsPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s) {
                    void 0 === a && (a = 0),
                    void 0 === s && (s = !1);
                    var y = t.call(this, r.getEngine(), "bloom", (function() {
                        return y._effects
                    }
                    ), !0) || this;
                    return y.bloomScale = i,
                    y._effects = [],
                    y._downscale = new e.ExtractHighlightsPostProcess("highlights",1,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,a,s),
                    y._blurX = new e.BlurPostProcess("horizontal blur",new e.Vector2(1,0),10,i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,a,void 0,s),
                    y._blurX.alwaysForcePOT = !0,
                    y._blurX.autoClear = !1,
                    y._blurY = new e.BlurPostProcess("vertical blur",new e.Vector2(0,1),10,i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,a,void 0,s),
                    y._blurY.alwaysForcePOT = !0,
                    y._blurY.autoClear = !1,
                    y.kernel = o,
                    y._effects = [y._downscale, y._blurX, y._blurY],
                    y._merge = new e.BloomMergePostProcess("bloomMerge",y._downscale,y._blurY,n,i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,a,s),
                    y._merge.autoClear = !1,
                    y._effects.push(y._merge),
                    y
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "threshold", {
                    get: function() {
                        return this._downscale.threshold
                    },
                    set: function(e) {
                        this._downscale.threshold = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "weight", {
                    get: function() {
                        return this._merge.weight
                    },
                    set: function(e) {
                        this._merge.weight = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "kernel", {
                    get: function() {
                        return this._blurX.kernel / this.bloomScale
                    },
                    set: function(e) {
                        this._blurX.kernel = e * this.bloomScale,
                        this._blurY.kernel = e * this.bloomScale
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.disposeEffects = function(e) {
                    for (var t = 0; t < this._effects.length; t++)
                        this._effects[t].dispose(e)
                }
                ,
                r.prototype._updateEffects = function() {
                    for (var e = 0; e < this._effects.length; e++)
                        this._effects[e].updateEffect()
                }
                ,
                r.prototype._isReady = function() {
                    for (var e = 0; e < this._effects.length; e++)
                        if (!this._effects[e].isReady())
                            return !1;
                    return !0
                }
                ,
                r
            }(e.PostProcessRenderEffect);
            e.BloomEffect = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a) {
                    void 0 === r && (r = ""),
                    void 0 === i && (i = !0),
                    void 0 === n && (n = e.Engine.LastCreatedScene),
                    void 0 === a && (a = !0);
                    var s = t.call(this, n.getEngine(), r) || this;
                    s._camerasToBeAttached = [],
                    s.SharpenPostProcessId = "SharpenPostProcessEffect",
                    s.ImageProcessingPostProcessId = "ImageProcessingPostProcessEffect",
                    s.FxaaPostProcessId = "FxaaPostProcessEffect",
                    s.ChromaticAberrationPostProcessId = "ChromaticAberrationPostProcessEffect",
                    s.GrainPostProcessId = "GrainPostProcessEffect",
                    s._glowLayer = null,
                    s.animations = [],
                    s._imageProcessingConfigurationObserver = null,
                    s._sharpenEnabled = !1,
                    s._bloomEnabled = !1,
                    s._depthOfFieldEnabled = !1,
                    s._depthOfFieldBlurLevel = e.DepthOfFieldEffectBlurLevel.Low,
                    s._fxaaEnabled = !1,
                    s._imageProcessingEnabled = !0,
                    s._bloomScale = .5,
                    s._chromaticAberrationEnabled = !1,
                    s._grainEnabled = !1,
                    s._buildAllowed = !0,
                    s._resizeObserver = null,
                    s._hardwareScaleLevel = 1,
                    s._bloomKernel = 64,
                    s._bloomWeight = .15,
                    s._bloomThreshold = .9,
                    s._samples = 1,
                    s._hasCleared = !1,
                    s._prevPostProcess = null,
                    s._prevPrevPostProcess = null,
                    s._depthOfFieldSceneObserver = null,
                    s._cameras = o || n.cameras,
                    s._cameras = s._cameras.slice(),
                    s._camerasToBeAttached = s._cameras.slice(),
                    s._buildAllowed = a,
                    s._scene = n;
                    var y = s._scene.getEngine().getCaps();
                    s._hdr = i && (y.textureHalfFloatRender || y.textureFloatRender),
                    s._hdr ? y.textureHalfFloatRender ? s._defaultPipelineTextureType = e.Engine.TEXTURETYPE_HALF_FLOAT : y.textureFloatRender && (s._defaultPipelineTextureType = e.Engine.TEXTURETYPE_FLOAT) : s._defaultPipelineTextureType = e.Engine.TEXTURETYPE_UNSIGNED_INT,
                    n.postProcessRenderPipelineManager.addPipeline(s);
                    var l = s._scene.getEngine();
                    return s.sharpen = new e.SharpenPostProcess("sharpen",1,null,e.Texture.BILINEAR_SAMPLINGMODE,l,!1,s._defaultPipelineTextureType,!0),
                    s._sharpenEffect = new e.PostProcessRenderEffect(l,s.SharpenPostProcessId,(function() {
                        return s.sharpen
                    }
                    ),!0),
                    s.depthOfField = new e.DepthOfFieldEffect(s._scene,null,s._depthOfFieldBlurLevel,s._defaultPipelineTextureType,!0),
                    s.bloom = new e.BloomEffect(s._scene,s._bloomScale,s._bloomWeight,s.bloomKernel,s._defaultPipelineTextureType,!0),
                    s.chromaticAberration = new e.ChromaticAberrationPostProcess("ChromaticAberration",l.getRenderWidth(),l.getRenderHeight(),1,null,e.Texture.BILINEAR_SAMPLINGMODE,l,!1,s._defaultPipelineTextureType,!0),
                    s._chromaticAberrationEffect = new e.PostProcessRenderEffect(l,s.ChromaticAberrationPostProcessId,(function() {
                        return s.chromaticAberration
                    }
                    ),!0),
                    s.grain = new e.GrainPostProcess("Grain",1,null,e.Texture.BILINEAR_SAMPLINGMODE,l,!1,s._defaultPipelineTextureType,!0),
                    s._grainEffect = new e.PostProcessRenderEffect(l,s.GrainPostProcessId,(function() {
                        return s.grain
                    }
                    ),!0),
                    s._resizeObserver = l.onResizeObservable.add((function() {
                        s._hardwareScaleLevel = l.getHardwareScalingLevel(),
                        s.bloomKernel = s.bloomKernel
                    }
                    )),
                    s._imageProcessingConfigurationObserver = s._scene.imageProcessingConfiguration.onUpdateParameters.add((function() {
                        s.bloom._downscale._exposure = s._scene.imageProcessingConfiguration.exposure
                    }
                    )),
                    s._buildPipeline(),
                    s
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "sharpenEnabled", {
                    get: function() {
                        return this._sharpenEnabled
                    },
                    set: function(e) {
                        this._sharpenEnabled !== e && (this._sharpenEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "bloomKernel", {
                    get: function() {
                        return this._bloomKernel
                    },
                    set: function(e) {
                        this._bloomKernel = e,
                        this.bloom.kernel = e / this._hardwareScaleLevel
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "bloomWeight", {
                    get: function() {
                        return this._bloomWeight
                    },
                    set: function(e) {
                        this._bloomWeight !== e && (this.bloom.weight = e,
                        this._bloomWeight = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "bloomThreshold", {
                    get: function() {
                        return this._bloomThreshold
                    },
                    set: function(e) {
                        this._bloomThreshold !== e && (this.bloom.threshold = e,
                        this._bloomThreshold = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "bloomScale", {
                    get: function() {
                        return this._bloomScale
                    },
                    set: function(e) {
                        this._bloomScale !== e && (this._bloomScale = e,
                        this._rebuildBloom(),
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "bloomEnabled", {
                    get: function() {
                        return this._bloomEnabled
                    },
                    set: function(e) {
                        this._bloomEnabled !== e && (this._bloomEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._rebuildBloom = function() {
                    var t = this.bloom;
                    this.bloom = new e.BloomEffect(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),
                    this.bloom.threshold = t.threshold;
                    for (var r = 0; r < this._cameras.length; r++)
                        t.disposeEffects(this._cameras[r])
                }
                ,
                Object.defineProperty(r.prototype, "depthOfFieldEnabled", {
                    get: function() {
                        return this._depthOfFieldEnabled
                    },
                    set: function(e) {
                        this._depthOfFieldEnabled !== e && (this._depthOfFieldEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "depthOfFieldBlurLevel", {
                    get: function() {
                        return this._depthOfFieldBlurLevel
                    },
                    set: function(t) {
                        if (this._depthOfFieldBlurLevel !== t) {
                            this._depthOfFieldBlurLevel = t;
                            var r = this.depthOfField;
                            this.depthOfField = new e.DepthOfFieldEffect(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),
                            this.depthOfField.focalLength = r.focalLength,
                            this.depthOfField.focusDistance = r.focusDistance,
                            this.depthOfField.fStop = r.fStop,
                            this.depthOfField.lensSize = r.lensSize;
                            for (var i = 0; i < this._cameras.length; i++)
                                r.disposeEffects(this._cameras[i]);
                            this._buildPipeline()
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "fxaaEnabled", {
                    get: function() {
                        return this._fxaaEnabled
                    },
                    set: function(e) {
                        this._fxaaEnabled !== e && (this._fxaaEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "samples", {
                    get: function() {
                        return this._samples
                    },
                    set: function(e) {
                        this._samples !== e && (this._samples = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "imageProcessingEnabled", {
                    get: function() {
                        return this._imageProcessingEnabled
                    },
                    set: function(e) {
                        this._imageProcessingEnabled !== e && (this._imageProcessingEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "glowLayerEnabled", {
                    get: function() {
                        return null == this._glowLayer
                    },
                    set: function(t) {
                        t && !this._glowLayer ? this._glowLayer = new e.GlowLayer("",this._scene) : !t && this._glowLayer && (this._glowLayer.dispose(),
                        this._glowLayer = null)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "chromaticAberrationEnabled", {
                    get: function() {
                        return this._chromaticAberrationEnabled
                    },
                    set: function(e) {
                        this._chromaticAberrationEnabled !== e && (this._chromaticAberrationEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "grainEnabled", {
                    get: function() {
                        return this._grainEnabled
                    },
                    set: function(e) {
                        this._grainEnabled !== e && (this._grainEnabled = e,
                        this._buildPipeline())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.prepare = function() {
                    var e = this._buildAllowed;
                    this._buildAllowed = !0,
                    this._buildPipeline(),
                    this._buildAllowed = e
                }
                ,
                r.prototype._setAutoClearAndTextureSharing = function(e, t) {
                    void 0 === t && (t = !1),
                    this._hasCleared ? e.autoClear = !1 : (e.autoClear = !0,
                    this._scene.autoClear = !1,
                    this._hasCleared = !0),
                    t || (this._prevPrevPostProcess ? e.shareOutputWith(this._prevPrevPostProcess) : e.useOwnOutput(),
                    this._prevPostProcess && (this._prevPrevPostProcess = this._prevPostProcess),
                    this._prevPostProcess = e)
                }
                ,
                r.prototype._buildPipeline = function() {
                    var t = this;
                    if (this._buildAllowed) {
                        this._scene.autoClear = !0;
                        var r = this._scene.getEngine();
                        if (this._disposePostProcesses(),
                        null !== this._cameras && (this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._cameras),
                        this._cameras = this._camerasToBeAttached.slice()),
                        this._reset(),
                        this._prevPostProcess = null,
                        this._prevPrevPostProcess = null,
                        this._hasCleared = !1,
                        this.depthOfFieldEnabled) {
                            if (this._cameras.length > 1) {
                                for (var i = 0, n = this._cameras; i < n.length; i++) {
                                    var o = n[i];
                                    (a = this._scene.enableDepthRenderer(o)).useOnlyInActiveCamera = !0
                                }
                                this._depthOfFieldSceneObserver = this._scene.onAfterRenderTargetsRenderObservable.add((function(e) {
                                    t._cameras.indexOf(e.activeCamera) > -1 && (t.depthOfField.depthTexture = e.enableDepthRenderer(e.activeCamera).getDepthMap())
                                }
                                ))
                            } else {
                                this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);
                                var a = this._scene.enableDepthRenderer(this._cameras[0]);
                                this.depthOfField.depthTexture = a.getDepthMap()
                            }
                            this.depthOfField._isReady() || this.depthOfField._updateEffects(),
                            this.addEffect(this.depthOfField),
                            this._setAutoClearAndTextureSharing(this.depthOfField._effects[0], !0)
                        } else
                            this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);
                        this.bloomEnabled && (this.bloom._isReady() || this.bloom._updateEffects(),
                        this.addEffect(this.bloom),
                        this._setAutoClearAndTextureSharing(this.bloom._effects[0], !0)),
                        this._imageProcessingEnabled && (this.imageProcessing = new e.ImageProcessingPostProcess("imageProcessing",1,null,e.Texture.BILINEAR_SAMPLINGMODE,r,!1,this._defaultPipelineTextureType),
                        this._hdr ? (this.addEffect(new e.PostProcessRenderEffect(r,this.ImageProcessingPostProcessId,(function() {
                            return t.imageProcessing
                        }
                        ),!0)),
                        this._setAutoClearAndTextureSharing(this.imageProcessing)) : this._scene.imageProcessingConfiguration.applyByPostProcess = !1),
                        this.sharpenEnabled && (this.sharpen.isReady() || this.sharpen.updateEffect(),
                        this.addEffect(this._sharpenEffect),
                        this._setAutoClearAndTextureSharing(this.sharpen)),
                        this.grainEnabled && (this.grain.isReady() || this.grain.updateEffect(),
                        this.addEffect(this._grainEffect),
                        this._setAutoClearAndTextureSharing(this.grain)),
                        this.chromaticAberrationEnabled && (this.chromaticAberration.isReady() || this.chromaticAberration.updateEffect(),
                        this.addEffect(this._chromaticAberrationEffect),
                        this._setAutoClearAndTextureSharing(this.chromaticAberration)),
                        this.fxaaEnabled && (this.fxaa = new e.FxaaPostProcess("fxaa",1,null,e.Texture.BILINEAR_SAMPLINGMODE,r,!1,this._defaultPipelineTextureType),
                        this.addEffect(new e.PostProcessRenderEffect(r,this.FxaaPostProcessId,(function() {
                            return t.fxaa
                        }
                        ),!0)),
                        this._setAutoClearAndTextureSharing(this.fxaa, !0)),
                        null !== this._cameras && this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name, this._cameras),
                        !this._enableMSAAOnFirstPostProcess(this.samples) && this.samples > 1 && e.Tools.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")
                    }
                }
                ,
                r.prototype._disposePostProcesses = function(e) {
                    void 0 === e && (e = !1);
                    for (var t = 0; t < this._cameras.length; t++) {
                        var r = this._cameras[t];
                        this.imageProcessing && this.imageProcessing.dispose(r),
                        this.fxaa && this.fxaa.dispose(r),
                        e && (this.sharpen && this.sharpen.dispose(r),
                        this.depthOfField && (this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),
                        this.depthOfField.disposeEffects(r)),
                        this.bloom && this.bloom.disposeEffects(r),
                        this.chromaticAberration && this.chromaticAberration.dispose(r),
                        this.grain && this.grain.dispose(r),
                        this._glowLayer && this._glowLayer.dispose())
                    }
                    this.imageProcessing = null,
                    this.fxaa = null,
                    e && (this.sharpen = null,
                    this._sharpenEffect = null,
                    this.depthOfField = null,
                    this.bloom = null,
                    this.chromaticAberration = null,
                    this._chromaticAberrationEffect = null,
                    this.grain = null,
                    this._grainEffect = null,
                    this._glowLayer = null)
                }
                ,
                r.prototype.addCamera = function(e) {
                    this._camerasToBeAttached.push(e),
                    this._buildPipeline()
                }
                ,
                r.prototype.removeCamera = function(e) {
                    var t = this._camerasToBeAttached.indexOf(e);
                    this._camerasToBeAttached.splice(t, 1),
                    this._buildPipeline()
                }
                ,
                r.prototype.dispose = function() {
                    this._disposePostProcesses(!0),
                    this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._cameras),
                    this._scene.autoClear = !0,
                    this._resizeObserver && (this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),
                    this._resizeObserver = null),
                    this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),
                    t.prototype.dispose.call(this)
                }
                ,
                r.prototype.serialize = function() {
                    var t = e.SerializationHelper.Serialize(this);
                    return t.customType = "DefaultRenderingPipeline",
                    t
                }
                ,
                r.Parse = function(t, i, n) {
                    return e.SerializationHelper.Parse((function() {
                        return new r(t._name,t._name._hdr,i)
                    }
                    ), t, i, n)
                }
                ,
                n([e.serialize()], r.prototype, "sharpenEnabled", null),
                n([e.serialize()], r.prototype, "bloomKernel", null),
                n([e.serialize()], r.prototype, "_bloomWeight", void 0),
                n([e.serialize()], r.prototype, "_bloomThreshold", void 0),
                n([e.serialize()], r.prototype, "_hdr", void 0),
                n([e.serialize()], r.prototype, "bloomWeight", null),
                n([e.serialize()], r.prototype, "bloomThreshold", null),
                n([e.serialize()], r.prototype, "bloomScale", null),
                n([e.serialize()], r.prototype, "bloomEnabled", null),
                n([e.serialize()], r.prototype, "depthOfFieldEnabled", null),
                n([e.serialize()], r.prototype, "depthOfFieldBlurLevel", null),
                n([e.serialize()], r.prototype, "fxaaEnabled", null),
                n([e.serialize()], r.prototype, "samples", null),
                n([e.serialize()], r.prototype, "imageProcessingEnabled", null),
                n([e.serialize()], r.prototype, "glowLayerEnabled", null),
                n([e.serialize()], r.prototype, "chromaticAberrationEnabled", null),
                n([e.serialize()], r.prototype, "grainEnabled", null),
                r
            }(e.PostProcessRenderPipeline);
            e.DefaultRenderingPipeline = t
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t() {
                    var t = e.call(this) || this;
                    return t.IMAGEPROCESSING = !1,
                    t.VIGNETTE = !1,
                    t.VIGNETTEBLENDMODEMULTIPLY = !1,
                    t.VIGNETTEBLENDMODEOPAQUE = !1,
                    t.TONEMAPPING = !1,
                    t.TONEMAPPING_ACES = !1,
                    t.CONTRAST = !1,
                    t.COLORCURVES = !1,
                    t.COLORGRADING = !1,
                    t.COLORGRADING3D = !1,
                    t.SAMPLER3DGREENDEPTH = !1,
                    t.SAMPLER3DBGRMAP = !1,
                    t.IMAGEPROCESSINGPOSTPROCESS = !1,
                    t.EXPOSURE = !1,
                    t.rebuild(),
                    t
                }
                return o(t, e),
                t
            }(e.MaterialDefines);
            e.ImageProcessingConfigurationDefines = t;
            var r = function() {
                function t() {
                    this.colorCurves = new e.ColorCurves,
                    this._colorCurvesEnabled = !1,
                    this._colorGradingEnabled = !1,
                    this._colorGradingWithGreenDepth = !0,
                    this._colorGradingBGR = !0,
                    this._exposure = 1,
                    this._toneMappingEnabled = !1,
                    this._toneMappingType = t.TONEMAPPING_STANDARD,
                    this._contrast = 1,
                    this.vignetteStretch = 0,
                    this.vignetteCentreX = 0,
                    this.vignetteCentreY = 0,
                    this.vignetteWeight = 1.5,
                    this.vignetteColor = new e.Color4(0,0,0,0),
                    this.vignetteCameraFov = .5,
                    this._vignetteBlendMode = t.VIGNETTEMODE_MULTIPLY,
                    this._vignetteEnabled = !1,
                    this._applyByPostProcess = !1,
                    this._isEnabled = !0,
                    this.onUpdateParameters = new e.Observable
                }
                return Object.defineProperty(t.prototype, "colorCurvesEnabled", {
                    get: function() {
                        return this._colorCurvesEnabled
                    },
                    set: function(e) {
                        this._colorCurvesEnabled !== e && (this._colorCurvesEnabled = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "colorGradingTexture", {
                    get: function() {
                        return this._colorGradingTexture
                    },
                    set: function(e) {
                        this._colorGradingTexture !== e && (this._colorGradingTexture = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "colorGradingEnabled", {
                    get: function() {
                        return this._colorGradingEnabled
                    },
                    set: function(e) {
                        this._colorGradingEnabled !== e && (this._colorGradingEnabled = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "colorGradingWithGreenDepth", {
                    get: function() {
                        return this._colorGradingWithGreenDepth
                    },
                    set: function(e) {
                        this._colorGradingWithGreenDepth !== e && (this._colorGradingWithGreenDepth = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "colorGradingBGR", {
                    get: function() {
                        return this._colorGradingBGR
                    },
                    set: function(e) {
                        this._colorGradingBGR !== e && (this._colorGradingBGR = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "exposure", {
                    get: function() {
                        return this._exposure
                    },
                    set: function(e) {
                        this._exposure !== e && (this._exposure = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "toneMappingEnabled", {
                    get: function() {
                        return this._toneMappingEnabled
                    },
                    set: function(e) {
                        this._toneMappingEnabled !== e && (this._toneMappingEnabled = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "toneMappingType", {
                    get: function() {
                        return this._toneMappingType
                    },
                    set: function(e) {
                        this._toneMappingType !== e && (this._toneMappingType = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "contrast", {
                    get: function() {
                        return this._contrast
                    },
                    set: function(e) {
                        this._contrast !== e && (this._contrast = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "vignetteBlendMode", {
                    get: function() {
                        return this._vignetteBlendMode
                    },
                    set: function(e) {
                        this._vignetteBlendMode !== e && (this._vignetteBlendMode = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "vignetteEnabled", {
                    get: function() {
                        return this._vignetteEnabled
                    },
                    set: function(e) {
                        this._vignetteEnabled !== e && (this._vignetteEnabled = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "applyByPostProcess", {
                    get: function() {
                        return this._applyByPostProcess
                    },
                    set: function(e) {
                        this._applyByPostProcess !== e && (this._applyByPostProcess = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "isEnabled", {
                    get: function() {
                        return this._isEnabled
                    },
                    set: function(e) {
                        this._isEnabled !== e && (this._isEnabled = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._updateParameters = function() {
                    this.onUpdateParameters.notifyObservers(this)
                }
                ,
                t.prototype.getClassName = function() {
                    return "ImageProcessingConfiguration"
                }
                ,
                t.PrepareUniforms = function(t, r) {
                    r.EXPOSURE && t.push("exposureLinear"),
                    r.CONTRAST && t.push("contrast"),
                    r.COLORGRADING && t.push("colorTransformSettings"),
                    r.VIGNETTE && (t.push("vInverseScreenSize"),
                    t.push("vignetteSettings1"),
                    t.push("vignetteSettings2")),
                    r.COLORCURVES && e.ColorCurves.PrepareUniforms(t)
                }
                ,
                t.PrepareSamplers = function(e, t) {
                    t.COLORGRADING && e.push("txColorTransform")
                }
                ,
                t.prototype.prepareDefines = function(e, r) {
                    if (void 0 === r && (r = !1),
                    r !== this.applyByPostProcess || !this._isEnabled)
                        return e.VIGNETTE = !1,
                        e.TONEMAPPING = !1,
                        e.TONEMAPPING_ACES = !1,
                        e.CONTRAST = !1,
                        e.EXPOSURE = !1,
                        e.COLORCURVES = !1,
                        e.COLORGRADING = !1,
                        e.COLORGRADING3D = !1,
                        e.IMAGEPROCESSING = !1,
                        void (e.IMAGEPROCESSINGPOSTPROCESS = this.applyByPostProcess && this._isEnabled);
                    switch (e.VIGNETTE = this.vignetteEnabled,
                    e.VIGNETTEBLENDMODEMULTIPLY = this.vignetteBlendMode === t._VIGNETTEMODE_MULTIPLY,
                    e.VIGNETTEBLENDMODEOPAQUE = !e.VIGNETTEBLENDMODEMULTIPLY,
                    e.TONEMAPPING = this.toneMappingEnabled,
                    this._toneMappingType) {
                    case t.TONEMAPPING_ACES:
                        e.TONEMAPPING_ACES = !0
                    }
                    e.CONTRAST = 1 !== this.contrast,
                    e.EXPOSURE = 1 !== this.exposure,
                    e.COLORCURVES = this.colorCurvesEnabled && !!this.colorCurves,
                    e.COLORGRADING = this.colorGradingEnabled && !!this.colorGradingTexture,
                    e.COLORGRADING ? e.COLORGRADING3D = this.colorGradingTexture.is3D : e.COLORGRADING3D = !1,
                    e.SAMPLER3DGREENDEPTH = this.colorGradingWithGreenDepth,
                    e.SAMPLER3DBGRMAP = this.colorGradingBGR,
                    e.IMAGEPROCESSINGPOSTPROCESS = this.applyByPostProcess,
                    e.IMAGEPROCESSING = e.VIGNETTE || e.TONEMAPPING || e.CONTRAST || e.EXPOSURE || e.COLORCURVES || e.COLORGRADING
                }
                ,
                t.prototype.isReady = function() {
                    return !this.colorGradingEnabled || !this.colorGradingTexture || this.colorGradingTexture.isReady()
                }
                ,
                t.prototype.bind = function(t, r) {
                    if (void 0 === r && (r = 1),
                    this._colorCurvesEnabled && this.colorCurves && e.ColorCurves.Bind(this.colorCurves, t),
                    this._vignetteEnabled) {
                        var i = 1 / t.getEngine().getRenderWidth()
                          , n = 1 / t.getEngine().getRenderHeight();
                        t.setFloat2("vInverseScreenSize", i, n);
                        var o = Math.tan(.5 * this.vignetteCameraFov)
                          , a = o * r
                          , s = Math.sqrt(a * o);
                        a = e.Tools.Mix(a, s, this.vignetteStretch),
                        o = e.Tools.Mix(o, s, this.vignetteStretch),
                        t.setFloat4("vignetteSettings1", a, o, -a * this.vignetteCentreX, -o * this.vignetteCentreY);
                        var y = -2 * this.vignetteWeight;
                        t.setFloat4("vignetteSettings2", this.vignetteColor.r, this.vignetteColor.g, this.vignetteColor.b, y)
                    }
                    if (t.setFloat("exposureLinear", this.exposure),
                    t.setFloat("contrast", this.contrast),
                    this.colorGradingTexture) {
                        t.setTexture("txColorTransform", this.colorGradingTexture);
                        var l = this.colorGradingTexture.getSize().height;
                        t.setFloat4("colorTransformSettings", (l - 1) / l, .5 / l, l, this.colorGradingTexture.level)
                    }
                }
                ,
                t.prototype.clone = function() {
                    return e.SerializationHelper.Clone((function() {
                        return new t
                    }
                    ), this)
                }
                ,
                t.prototype.serialize = function() {
                    return e.SerializationHelper.Serialize(this)
                }
                ,
                t.Parse = function(r) {
                    return e.SerializationHelper.Parse((function() {
                        return new t
                    }
                    ), r, null, null)
                }
                ,
                Object.defineProperty(t, "VIGNETTEMODE_MULTIPLY", {
                    get: function() {
                        return this._VIGNETTEMODE_MULTIPLY
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "VIGNETTEMODE_OPAQUE", {
                    get: function() {
                        return this._VIGNETTEMODE_OPAQUE
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.TONEMAPPING_STANDARD = 0,
                t.TONEMAPPING_ACES = 1,
                t._VIGNETTEMODE_MULTIPLY = 0,
                t._VIGNETTEMODE_OPAQUE = 1,
                n([e.serializeAsColorCurves()], t.prototype, "colorCurves", void 0),
                n([e.serialize()], t.prototype, "_colorCurvesEnabled", void 0),
                n([e.serializeAsTexture("colorGradingTexture")], t.prototype, "_colorGradingTexture", void 0),
                n([e.serialize()], t.prototype, "_colorGradingEnabled", void 0),
                n([e.serialize()], t.prototype, "_colorGradingWithGreenDepth", void 0),
                n([e.serialize()], t.prototype, "_colorGradingBGR", void 0),
                n([e.serialize()], t.prototype, "_exposure", void 0),
                n([e.serialize()], t.prototype, "_toneMappingEnabled", void 0),
                n([e.serialize()], t.prototype, "_toneMappingType", void 0),
                n([e.serialize()], t.prototype, "_contrast", void 0),
                n([e.serialize()], t.prototype, "vignetteStretch", void 0),
                n([e.serialize()], t.prototype, "vignetteCentreX", void 0),
                n([e.serialize()], t.prototype, "vignetteCentreY", void 0),
                n([e.serialize()], t.prototype, "vignetteWeight", void 0),
                n([e.serializeAsColor4()], t.prototype, "vignetteColor", void 0),
                n([e.serialize()], t.prototype, "vignetteCameraFov", void 0),
                n([e.serialize()], t.prototype, "_vignetteBlendMode", void 0),
                n([e.serialize()], t.prototype, "_vignetteEnabled", void 0),
                n([e.serialize()], t.prototype, "_applyByPostProcess", void 0),
                n([e.serialize()], t.prototype, "_isEnabled", void 0),
                t
            }();
            e.ImageProcessingConfiguration = r
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i) {
                    var n = t.call(this, i) || this;
                    return r ? (n._engine = i.getEngine(),
                    n._textureMatrix = e.Matrix.Identity(),
                    n.name = r,
                    n.url = r,
                    n.hasAlpha = !1,
                    n.isCube = !1,
                    n.is3D = n._engine.webGLVersion > 1,
                    n.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    n.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    n.wrapR = e.Texture.CLAMP_ADDRESSMODE,
                    n.anisotropicFilteringLevel = 1,
                    n._texture = n._getFromCache(r, !0),
                    n._texture || (i.useDelayedTextureLoading ? n.delayLoadState = e.Engine.DELAYLOADSTATE_NOTLOADED : n.loadTexture()),
                    n) : n
                }
                return o(r, t),
                r.prototype.getTextureMatrix = function() {
                    return this._textureMatrix
                }
                ,
                r.prototype.load3dlTexture = function() {
                    var t, i = this._engine;
                    t = 1 === i.webGLVersion ? i.createRawTexture(null, 1, 1, e.Engine.TEXTUREFORMAT_RGBA, !1, !1, e.Texture.BILINEAR_SAMPLINGMODE) : i.createRawTexture3D(null, 1, 1, 1, e.Engine.TEXTUREFORMAT_RGBA, !1, !1, e.Texture.BILINEAR_SAMPLINGMODE),
                    this._texture = t;
                    var n = function(n) {
                        if ("string" == typeof n) {
                            for (var o, a = null, s = null, y = n.split("\n"), l = 0, c = 0, h = 0, u = 0, d = 0, x = 0; x < y.length; x++)
                                if (o = y[x],
                                r._noneEmptyLineRegex.test(o) && 0 !== o.indexOf("#")) {
                                    var p = o.split(" ");
                                    if (0 !== l) {
                                        if (0 != l) {
                                            var f = Math.max(parseInt(p[0]), 0)
                                              , m = Math.max(parseInt(p[1]), 0)
                                              , z = Math.max(parseInt(p[2]), 0);
                                            d = Math.max(f, d),
                                            d = Math.max(m, d),
                                            d = Math.max(z, d);
                                            var _ = 4 * (c + u * l + h * l * l);
                                            s && (s[_ + 0] = f,
                                            s[_ + 1] = m,
                                            s[_ + 2] = z),
                                            ++h % l == 0 && (h = 0,
                                            ++u % l == 0 && (c++,
                                            u = 0))
                                        }
                                    } else
                                        l = p.length,
                                        a = new Uint8Array(l * l * l * 4),
                                        s = new Float32Array(l * l * l * 4)
                                }
                            if (s && a)
                                for (x = 0; x < s.length; x++)
                                    if (x > 0 && (x + 1) % 4 == 0)
                                        a[x] = 255;
                                    else {
                                        var g = s[x];
                                        a[x] = g / d * 255
                                    }
                            t.is3D ? (t.updateSize(l, l, l),
                            i.updateRawTexture3D(t, a, e.Engine.TEXTUREFORMAT_RGBA, !1)) : (t.updateSize(l * l, l),
                            i.updateRawTexture(t, a, e.Engine.TEXTUREFORMAT_RGBA, !1))
                        }
                    }
                      , o = this.getScene();
                    return o ? o._loadFile(this.url, n) : this._engine._loadFile(this.url, n),
                    this._texture
                }
                ,
                r.prototype.loadTexture = function() {
                    this.url && this.url.toLocaleLowerCase().indexOf(".3dl") == this.url.length - 4 && this.load3dlTexture()
                }
                ,
                r.prototype.clone = function() {
                    var e = new r(this.url,this.getScene());
                    return e.level = this.level,
                    e
                }
                ,
                r.prototype.delayLoad = function() {
                    this.delayLoadState === e.Engine.DELAYLOADSTATE_NOTLOADED && (this.delayLoadState = e.Engine.DELAYLOADSTATE_LOADED,
                    this._texture = this._getFromCache(this.url, !0),
                    this._texture || this.loadTexture())
                }
                ,
                r.Parse = function(e, t, i) {
                    var n = null;
                    return e.name && !e.isRenderTarget && ((n = new r(e.name,t)).name = e.name,
                    n.level = e.level),
                    n
                }
                ,
                r.prototype.serialize = function() {
                    if (!this.name)
                        return null;
                    var e = {};
                    return e.name = this.name,
                    e.level = this.level,
                    e.customType = "BABYLON.ColorGradingTexture",
                    e
                }
                ,
                r._noneEmptyLineRegex = /\S+/,
                r
            }(e.BaseTexture);
            e.ColorGradingTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this._dirty = !0,
                    this._tempColor = new e.Color4(0,0,0,0),
                    this._globalCurve = new e.Color4(0,0,0,0),
                    this._highlightsCurve = new e.Color4(0,0,0,0),
                    this._midtonesCurve = new e.Color4(0,0,0,0),
                    this._shadowsCurve = new e.Color4(0,0,0,0),
                    this._positiveCurve = new e.Color4(0,0,0,0),
                    this._negativeCurve = new e.Color4(0,0,0,0),
                    this._globalHue = 30,
                    this._globalDensity = 0,
                    this._globalSaturation = 0,
                    this._globalExposure = 0,
                    this._highlightsHue = 30,
                    this._highlightsDensity = 0,
                    this._highlightsSaturation = 0,
                    this._highlightsExposure = 0,
                    this._midtonesHue = 30,
                    this._midtonesDensity = 0,
                    this._midtonesSaturation = 0,
                    this._midtonesExposure = 0,
                    this._shadowsHue = 30,
                    this._shadowsDensity = 0,
                    this._shadowsSaturation = 0,
                    this._shadowsExposure = 0
                }
                return Object.defineProperty(t.prototype, "globalHue", {
                    get: function() {
                        return this._globalHue
                    },
                    set: function(e) {
                        this._globalHue = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "globalDensity", {
                    get: function() {
                        return this._globalDensity
                    },
                    set: function(e) {
                        this._globalDensity = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "globalSaturation", {
                    get: function() {
                        return this._globalSaturation
                    },
                    set: function(e) {
                        this._globalSaturation = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "globalExposure", {
                    get: function() {
                        return this._globalExposure
                    },
                    set: function(e) {
                        this._globalExposure = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "highlightsHue", {
                    get: function() {
                        return this._highlightsHue
                    },
                    set: function(e) {
                        this._highlightsHue = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "highlightsDensity", {
                    get: function() {
                        return this._highlightsDensity
                    },
                    set: function(e) {
                        this._highlightsDensity = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "highlightsSaturation", {
                    get: function() {
                        return this._highlightsSaturation
                    },
                    set: function(e) {
                        this._highlightsSaturation = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "highlightsExposure", {
                    get: function() {
                        return this._highlightsExposure
                    },
                    set: function(e) {
                        this._highlightsExposure = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "midtonesHue", {
                    get: function() {
                        return this._midtonesHue
                    },
                    set: function(e) {
                        this._midtonesHue = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "midtonesDensity", {
                    get: function() {
                        return this._midtonesDensity
                    },
                    set: function(e) {
                        this._midtonesDensity = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "midtonesSaturation", {
                    get: function() {
                        return this._midtonesSaturation
                    },
                    set: function(e) {
                        this._midtonesSaturation = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "midtonesExposure", {
                    get: function() {
                        return this._midtonesExposure
                    },
                    set: function(e) {
                        this._midtonesExposure = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "shadowsHue", {
                    get: function() {
                        return this._shadowsHue
                    },
                    set: function(e) {
                        this._shadowsHue = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "shadowsDensity", {
                    get: function() {
                        return this._shadowsDensity
                    },
                    set: function(e) {
                        this._shadowsDensity = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "shadowsSaturation", {
                    get: function() {
                        return this._shadowsSaturation
                    },
                    set: function(e) {
                        this._shadowsSaturation = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "shadowsExposure", {
                    get: function() {
                        return this._shadowsExposure
                    },
                    set: function(e) {
                        this._shadowsExposure = e,
                        this._dirty = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getClassName = function() {
                    return "ColorCurves"
                }
                ,
                t.Bind = function(e, t, r, i, n) {
                    void 0 === r && (r = "vCameraColorCurvePositive"),
                    void 0 === i && (i = "vCameraColorCurveNeutral"),
                    void 0 === n && (n = "vCameraColorCurveNegative"),
                    e._dirty && (e._dirty = !1,
                    e.getColorGradingDataToRef(e._globalHue, e._globalDensity, e._globalSaturation, e._globalExposure, e._globalCurve),
                    e.getColorGradingDataToRef(e._highlightsHue, e._highlightsDensity, e._highlightsSaturation, e._highlightsExposure, e._tempColor),
                    e._tempColor.multiplyToRef(e._globalCurve, e._highlightsCurve),
                    e.getColorGradingDataToRef(e._midtonesHue, e._midtonesDensity, e._midtonesSaturation, e._midtonesExposure, e._tempColor),
                    e._tempColor.multiplyToRef(e._globalCurve, e._midtonesCurve),
                    e.getColorGradingDataToRef(e._shadowsHue, e._shadowsDensity, e._shadowsSaturation, e._shadowsExposure, e._tempColor),
                    e._tempColor.multiplyToRef(e._globalCurve, e._shadowsCurve),
                    e._highlightsCurve.subtractToRef(e._midtonesCurve, e._positiveCurve),
                    e._midtonesCurve.subtractToRef(e._shadowsCurve, e._negativeCurve)),
                    t && (t.setFloat4(r, e._positiveCurve.r, e._positiveCurve.g, e._positiveCurve.b, e._positiveCurve.a),
                    t.setFloat4(i, e._midtonesCurve.r, e._midtonesCurve.g, e._midtonesCurve.b, e._midtonesCurve.a),
                    t.setFloat4(n, e._negativeCurve.r, e._negativeCurve.g, e._negativeCurve.b, e._negativeCurve.a))
                }
                ,
                t.PrepareUniforms = function(e) {
                    e.push("vCameraColorCurveNeutral", "vCameraColorCurvePositive", "vCameraColorCurveNegative")
                }
                ,
                t.prototype.getColorGradingDataToRef = function(e, r, i, n, o) {
                    null != e && (e = t.clamp(e, 0, 360),
                    r = t.clamp(r, -100, 100),
                    i = t.clamp(i, -100, 100),
                    n = t.clamp(n, -100, 100),
                    r = t.applyColorGradingSliderNonlinear(r),
                    r *= .5,
                    n = t.applyColorGradingSliderNonlinear(n),
                    r < 0 && (r *= -1,
                    e = (e + 180) % 360),
                    t.fromHSBToRef(e, r, 50 + .25 * n, o),
                    o.scaleToRef(2, o),
                    o.a = 1 + .01 * i)
                }
                ,
                t.applyColorGradingSliderNonlinear = function(e) {
                    e /= 100;
                    var t = Math.abs(e);
                    return t = Math.pow(t, 2),
                    e < 0 && (t *= -1),
                    t *= 100
                }
                ,
                t.fromHSBToRef = function(e, r, i, n) {
                    var o = t.clamp(e, 0, 360)
                      , a = t.clamp(r / 100, 0, 1)
                      , s = t.clamp(i / 100, 0, 1);
                    if (0 === a)
                        n.r = s,
                        n.g = s,
                        n.b = s;
                    else {
                        o /= 60;
                        var y = Math.floor(o)
                          , l = o - y
                          , c = s * (1 - a)
                          , h = s * (1 - a * l)
                          , u = s * (1 - a * (1 - l));
                        switch (y) {
                        case 0:
                            n.r = s,
                            n.g = u,
                            n.b = c;
                            break;
                        case 1:
                            n.r = h,
                            n.g = s,
                            n.b = c;
                            break;
                        case 2:
                            n.r = c,
                            n.g = s,
                            n.b = u;
                            break;
                        case 3:
                            n.r = c,
                            n.g = h,
                            n.b = s;
                            break;
                        case 4:
                            n.r = u,
                            n.g = c,
                            n.b = s;
                            break;
                        default:
                            n.r = s,
                            n.g = c,
                            n.b = h
                        }
                    }
                    n.a = 1
                }
                ,
                t.clamp = function(e, t, r) {
                    return Math.min(Math.max(e, t), r)
                }
                ,
                t.prototype.clone = function() {
                    return e.SerializationHelper.Clone((function() {
                        return new t
                    }
                    ), this)
                }
                ,
                t.prototype.serialize = function() {
                    return e.SerializationHelper.Serialize(this)
                }
                ,
                t.Parse = function(r) {
                    return e.SerializationHelper.Parse((function() {
                        return new t
                    }
                    ), r, null, null)
                }
                ,
                n([e.serialize()], t.prototype, "_globalHue", void 0),
                n([e.serialize()], t.prototype, "_globalDensity", void 0),
                n([e.serialize()], t.prototype, "_globalSaturation", void 0),
                n([e.serialize()], t.prototype, "_globalExposure", void 0),
                n([e.serialize()], t.prototype, "_highlightsHue", void 0),
                n([e.serialize()], t.prototype, "_highlightsDensity", void 0),
                n([e.serialize()], t.prototype, "_highlightsSaturation", void 0),
                n([e.serialize()], t.prototype, "_highlightsExposure", void 0),
                n([e.serialize()], t.prototype, "_midtonesHue", void 0),
                n([e.serialize()], t.prototype, "_midtonesDensity", void 0),
                n([e.serialize()], t.prototype, "_midtonesSaturation", void 0),
                n([e.serialize()], t.prototype, "_midtonesExposure", void 0),
                t
            }();
            e.ColorCurves = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c, h) {
                    var u = t.call(this, r, "refraction", ["baseColor", "depth", "colorLevel"], ["refractionSampler"], s, y, l, c, h) || this;
                    return u.color = n,
                    u.depth = o,
                    u.colorLevel = a,
                    u._ownRefractionTexture = !0,
                    u.onActivateObservable.add((function(t) {
                        u._refTexture = u._refTexture || new e.Texture(i,t.getScene())
                    }
                    )),
                    u.onApplyObservable.add((function(e) {
                        e.setColor3("baseColor", u.color),
                        e.setFloat("depth", u.depth),
                        e.setFloat("colorLevel", u.colorLevel),
                        e.setTexture("refractionSampler", u._refTexture)
                    }
                    )),
                    u
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "refractionTexture", {
                    get: function() {
                        return this._refTexture
                    },
                    set: function(e) {
                        this._refTexture && this._ownRefractionTexture && this._refTexture.dispose(),
                        this._refTexture = e,
                        this._ownRefractionTexture = !1
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.dispose = function(e) {
                    this._refTexture && this._ownRefractionTexture && (this._refTexture.dispose(),
                    this._refTexture = null),
                    t.prototype.dispose.call(this, e)
                }
                ,
                r
            }(e.PostProcess);
            e.RefractionPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t(t, r, i, n, o, a) {
                    var s = e.call(this, t, "blackAndWhite", ["degree"], null, r, i, n, o, a) || this;
                    return s.degree = 1,
                    s.onApplyObservable.add((function(e) {
                        e.setFloat("degree", s.degree)
                    }
                    )),
                    s
                }
                return o(t, e),
                t
            }(e.PostProcess);
            e.BlackAndWhitePostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l) {
                    void 0 === l && (l = e.Engine.TEXTURETYPE_UNSIGNED_INT);
                    var c = t.call(this, r, "convolution", ["kernel", "screenSize"], null, n, o, a, s, y, null, l) || this;
                    return c.kernel = i,
                    c.onApply = function(e) {
                        e.setFloat2("screenSize", c.width, c.height),
                        e.setArray("kernel", c.kernel)
                    }
                    ,
                    c
                }
                return o(r, t),
                r.EdgeDetect0Kernel = [1, 0, -1, 0, 0, 0, -1, 0, 1],
                r.EdgeDetect1Kernel = [0, 1, 0, 1, -4, 1, 0, 1, 0],
                r.EdgeDetect2Kernel = [-1, -1, -1, -1, 8, -1, -1, -1, -1],
                r.SharpenKernel = [0, -1, 0, -1, 5, -1, 0, -1, 0],
                r.EmbossKernel = [-2, -1, 0, -1, 1, 1, 0, 1, 2],
                r.GaussianKernel = [0, 1, 0, 1, 1, 1, 0, 1, 0],
                r
            }(e.PostProcess);
            e.ConvolutionPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t(t, r, i, n, o, a, s) {
                    var y = e.call(this, t, "filter", ["kernelMatrix"], null, i, n, o, a, s) || this;
                    return y.kernelMatrix = r,
                    y.onApply = function(e) {
                        e.setMatrix("kernelMatrix", y.kernelMatrix)
                    }
                    ,
                    y
                }
                return o(t, e),
                t
            }(e.PostProcess);
            e.FilterPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(i, n, o, a, s, y, l, c, h) {
                    void 0 === s && (s = 100),
                    void 0 === y && (y = e.Texture.BILINEAR_SAMPLINGMODE);
                    var u = t.call(this, i, "volumetricLightScattering", ["decay", "exposure", "weight", "meshPositionOnScreen", "density"], ["lightScatteringSampler"], n.postProcessRatio || n, o, y, l, c, "#define NUM_SAMPLES " + s) || this;
                    return u._screenCoordinates = e.Vector2.Zero(),
                    u.customMeshPosition = e.Vector3.Zero(),
                    u.useCustomMeshPosition = !1,
                    u.invert = !0,
                    u.excludedMeshes = new Array,
                    u.exposure = .3,
                    u.decay = .96815,
                    u.weight = .58767,
                    u.density = .926,
                    l = (h = null === o ? h : o.getScene()).getEngine(),
                    u._viewPort = new e.Viewport(0,0,1,1).toGlobal(l.getRenderWidth(), l.getRenderHeight()),
                    u.mesh = null !== a ? a : r.CreateDefaultMesh("VolumetricLightScatteringMesh", h),
                    u._createPass(h, n.passRatio || n),
                    u.onActivate = function(e) {
                        u.isSupported || u.dispose(e),
                        u.onActivate = null
                    }
                    ,
                    u.onApplyObservable.add((function(e) {
                        u._updateMeshScreenCoordinates(h),
                        e.setTexture("lightScatteringSampler", u._volumetricLightScatteringRTT),
                        e.setFloat("exposure", u.exposure),
                        e.setFloat("decay", u.decay),
                        e.setFloat("weight", u.weight),
                        e.setFloat("density", u.density),
                        e.setVector2("meshPositionOnScreen", u._screenCoordinates)
                    }
                    )),
                    u
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "useDiffuseColor", {
                    get: function() {
                        return e.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),
                        !1
                    },
                    set: function(t) {
                        e.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getClassName = function() {
                    return "VolumetricLightScatteringPostProcess"
                }
                ,
                r.prototype._isReady = function(t, r) {
                    var i = t.getMesh();
                    if (i === this.mesh && i.material)
                        return i.material.isReady(i);
                    var n = []
                      , o = [e.VertexBuffer.PositionKind]
                      , a = t.getMaterial();
                    a && (a.needAlphaTesting() && n.push("#define ALPHATEST"),
                    i.isVerticesDataPresent(e.VertexBuffer.UVKind) && (o.push(e.VertexBuffer.UVKind),
                    n.push("#define UV1")),
                    i.isVerticesDataPresent(e.VertexBuffer.UV2Kind) && (o.push(e.VertexBuffer.UV2Kind),
                    n.push("#define UV2"))),
                    i.useBones && i.computeBonesUsingShaders ? (o.push(e.VertexBuffer.MatricesIndicesKind),
                    o.push(e.VertexBuffer.MatricesWeightsKind),
                    n.push("#define NUM_BONE_INFLUENCERS " + i.numBoneInfluencers),
                    n.push("#define BonesPerMesh " + (i.skeleton ? i.skeleton.bones.length + 1 : 0))) : n.push("#define NUM_BONE_INFLUENCERS 0"),
                    r && (n.push("#define INSTANCES"),
                    o.push("world0"),
                    o.push("world1"),
                    o.push("world2"),
                    o.push("world3"));
                    var s = n.join("\n");
                    return this._cachedDefines !== s && (this._cachedDefines = s,
                    this._volumetricLightScatteringPass = i.getScene().getEngine().createEffect({
                        vertexElement: "depth",
                        fragmentElement: "volumetricLightScatteringPass"
                    }, o, ["world", "mBones", "viewProjection", "diffuseMatrix"], ["diffuseSampler"], s)),
                    this._volumetricLightScatteringPass.isReady()
                }
                ,
                r.prototype.setCustomMeshPosition = function(e) {
                    this.customMeshPosition = e
                }
                ,
                r.prototype.getCustomMeshPosition = function() {
                    return this.customMeshPosition
                }
                ,
                r.prototype.dispose = function(e) {
                    var r = e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);
                    -1 !== r && e.getScene().customRenderTargets.splice(r, 1),
                    this._volumetricLightScatteringRTT.dispose(),
                    t.prototype.dispose.call(this, e)
                }
                ,
                r.prototype.getPass = function() {
                    return this._volumetricLightScatteringRTT
                }
                ,
                r.prototype._meshExcluded = function(e) {
                    return this.excludedMeshes.length > 0 && -1 !== this.excludedMeshes.indexOf(e)
                }
                ,
                r.prototype._createPass = function(t, r) {
                    var i = this
                      , n = t.getEngine();
                    this._volumetricLightScatteringRTT = new e.RenderTargetTexture("volumetricLightScatteringMap",{
                        width: n.getRenderWidth() * r,
                        height: n.getRenderHeight() * r
                    },t,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this._volumetricLightScatteringRTT.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    this._volumetricLightScatteringRTT.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    this._volumetricLightScatteringRTT.renderList = null,
                    this._volumetricLightScatteringRTT.renderParticles = !1,
                    this._volumetricLightScatteringRTT.ignoreCameraViewport = !0;
                    var o = this.getCamera();
                    o ? o.customRenderTargets.push(this._volumetricLightScatteringRTT) : t.customRenderTargets.push(this._volumetricLightScatteringRTT);
                    var a, s = function(t) {
                        var r = t.getRenderingMesh();
                        if (!i._meshExcluded(r)) {
                            var n = t.getMaterial();
                            if (n) {
                                var o = r.getScene()
                                  , a = o.getEngine();
                                a.setState(n.backFaceCulling);
                                var s = r._getInstancesRenderList(t._id);
                                if (!s.mustReturn) {
                                    var y = a.getCaps().instancedArrays && null !== s.visibleInstances[t._id];
                                    if (i._isReady(t, y)) {
                                        var l = i._volumetricLightScatteringPass;
                                        if (r === i.mesh && (l = t.effect ? t.effect : n.getEffect()),
                                        a.enableEffect(l),
                                        r._bind(t, l, e.Material.TriangleFillMode),
                                        r === i.mesh)
                                            n.bind(r.getWorldMatrix(), r);
                                        else {
                                            if (i._volumetricLightScatteringPass.setMatrix("viewProjection", o.getTransformMatrix()),
                                            n && n.needAlphaTesting()) {
                                                var c = n.getAlphaTestTexture();
                                                i._volumetricLightScatteringPass.setTexture("diffuseSampler", c),
                                                c && i._volumetricLightScatteringPass.setMatrix("diffuseMatrix", c.getTextureMatrix())
                                            }
                                            r.useBones && r.computeBonesUsingShaders && r.skeleton && i._volumetricLightScatteringPass.setMatrices("mBones", r.skeleton.getTransformMatrices(r))
                                        }
                                        r._processRendering(t, i._volumetricLightScatteringPass, e.Material.TriangleFillMode, s, y, (function(e, t) {
                                            return l.setMatrix("world", t)
                                        }
                                        ))
                                    }
                                }
                            }
                        }
                    }, y = new e.Color4(0,0,0,1);
                    this._volumetricLightScatteringRTT.onBeforeRenderObservable.add((function() {
                        a = t.clearColor,
                        t.clearColor = y
                    }
                    )),
                    this._volumetricLightScatteringRTT.onAfterRenderObservable.add((function() {
                        t.clearColor = a
                    }
                    )),
                    this._volumetricLightScatteringRTT.customRenderFunction = function(r, i, n, o) {
                        var a, y = t.getEngine();
                        if (o.length) {
                            for (y.setColorWrite(!1),
                            a = 0; a < o.length; a++)
                                s(o.data[a]);
                            y.setColorWrite(!0)
                        }
                        for (a = 0; a < r.length; a++)
                            s(r.data[a]);
                        for (a = 0; a < i.length; a++)
                            s(i.data[a]);
                        if (n.length) {
                            for (a = 0; a < n.length; a++) {
                                var l = n.data[a]
                                  , c = l.getBoundingInfo();
                                c && t.activeCamera && (l._alphaIndex = l.getMesh().alphaIndex,
                                l._distanceToCamera = c.boundingSphere.centerWorld.subtract(t.activeCamera.position).length())
                            }
                            var h = n.data.slice(0, n.length);
                            for (h.sort((function(e, t) {
                                return e._alphaIndex > t._alphaIndex ? 1 : e._alphaIndex < t._alphaIndex ? -1 : e._distanceToCamera < t._distanceToCamera ? 1 : e._distanceToCamera > t._distanceToCamera ? -1 : 0
                            }
                            )),
                            y.setAlphaMode(e.Engine.ALPHA_COMBINE),
                            a = 0; a < h.length; a++)
                                s(h[a]);
                            y.setAlphaMode(e.Engine.ALPHA_DISABLE)
                        }
                    }
                }
                ,
                r.prototype._updateMeshScreenCoordinates = function(t) {
                    var r, i = t.getTransformMatrix();
                    r = this.useCustomMeshPosition ? this.customMeshPosition : this.attachedNode ? this.attachedNode.position : this.mesh.parent ? this.mesh.getAbsolutePosition() : this.mesh.position;
                    var n = e.Vector3.Project(r, e.Matrix.Identity(), i, this._viewPort);
                    this._screenCoordinates.x = n.x / this._viewPort.width,
                    this._screenCoordinates.y = n.y / this._viewPort.height,
                    this.invert && (this._screenCoordinates.y = 1 - this._screenCoordinates.y)
                }
                ,
                r.CreateDefaultMesh = function(t, r) {
                    var i = e.Mesh.CreatePlane(t, 1, r);
                    i.billboardMode = e.AbstractMesh.BILLBOARDMODE_ALL;
                    var n = new e.StandardMaterial(t + "Material",r);
                    return n.emissiveColor = new e.Color3(1,1,1),
                    i.material = n,
                    i
                }
                ,
                n([e.serializeAsVector3()], r.prototype, "customMeshPosition", void 0),
                n([e.serialize()], r.prototype, "useCustomMeshPosition", void 0),
                n([e.serialize()], r.prototype, "invert", void 0),
                n([e.serializeAsMeshReference()], r.prototype, "mesh", void 0),
                n([e.serialize()], r.prototype, "excludedMeshes", void 0),
                n([e.serialize()], r.prototype, "exposure", void 0),
                n([e.serialize()], r.prototype, "decay", void 0),
                n([e.serialize()], r.prototype, "weight", void 0),
                n([e.serialize()], r.prototype, "density", void 0),
                r
            }(e.PostProcess);
            e.VolumetricLightScatteringPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y) {
                    var l = t.call(this, r, "colorCorrection", null, ["colorTable"], n, o, a, s, y) || this;
                    return l._colorTableTexture = new e.Texture(i,o.getScene(),!0,!1,e.Texture.TRILINEAR_SAMPLINGMODE),
                    l._colorTableTexture.anisotropicFilteringLevel = 1,
                    l._colorTableTexture.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    l._colorTableTexture.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    l.onApply = function(e) {
                        e.setTexture("colorTable", l._colorTableTexture)
                    }
                    ,
                    l
                }
                return o(r, t),
                r
            }(e.PostProcess);
            e.ColorCorrectionPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t;
            !function(e) {
                e[e.Hable = 0] = "Hable",
                e[e.Reinhard = 1] = "Reinhard",
                e[e.HejiDawson = 2] = "HejiDawson",
                e[e.Photographic = 3] = "Photographic"
            }(t = e.TonemappingOperator || (e.TonemappingOperator = {}));
            var r = function(r) {
                function i(i, n, o, a, s, y, l) {
                    void 0 === s && (s = e.Texture.BILINEAR_SAMPLINGMODE),
                    void 0 === l && (l = e.Engine.TEXTURETYPE_UNSIGNED_INT);
                    var c = r.call(this, i, "tonemap", ["_ExposureAdjustment"], null, 1, a, s, y, !0, null, l) || this;
                    c._operator = n,
                    c.exposureAdjustment = o;
                    var h = "#define ";
                    return c._operator === t.Hable ? h += "HABLE_TONEMAPPING" : c._operator === t.Reinhard ? h += "REINHARD_TONEMAPPING" : c._operator === t.HejiDawson ? h += "OPTIMIZED_HEJIDAWSON_TONEMAPPING" : c._operator === t.Photographic && (h += "PHOTOGRAPHIC_TONEMAPPING"),
                    c.updateEffect(h),
                    c.onApply = function(e) {
                        e.setFloat("_ExposureAdjustment", c.exposureAdjustment)
                    }
                    ,
                    c
                }
                return o(i, r),
                i
            }(e.PostProcess);
            e.TonemapPostProcess = r
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t(t, r, i, n, o, a) {
                    return e.call(this, t, "displayPass", ["passSampler"], ["passSampler"], r, i, n, o, a) || this
                }
                return o(t, e),
                t
            }(e.PostProcess);
            e.DisplayPassPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y) {
                    return void 0 === y && (y = e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    t.call(this, r, "highlights", null, null, i, n, o, a, s, null, y) || this
                }
                return o(r, t),
                r
            }(e.PostProcess);
            e.HighlightsPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l) {
                    void 0 === n && (n = null),
                    void 0 === y && (y = e.Engine.TEXTURETYPE_UNSIGNED_INT);
                    var c = t.call(this, r, "imageProcessing", [], [], i, n, o, a, s, null, y, "postprocess", null, !0) || this;
                    return c._fromLinearSpace = !0,
                    c._defines = {
                        IMAGEPROCESSING: !1,
                        VIGNETTE: !1,
                        VIGNETTEBLENDMODEMULTIPLY: !1,
                        VIGNETTEBLENDMODEOPAQUE: !1,
                        TONEMAPPING: !1,
                        TONEMAPPING_ACES: !1,
                        CONTRAST: !1,
                        COLORCURVES: !1,
                        COLORGRADING: !1,
                        COLORGRADING3D: !1,
                        FROMLINEARSPACE: !1,
                        SAMPLER3DGREENDEPTH: !1,
                        SAMPLER3DBGRMAP: !1,
                        IMAGEPROCESSINGPOSTPROCESS: !1,
                        EXPOSURE: !1
                    },
                    l ? (l.applyByPostProcess = !0,
                    c._attachImageProcessingConfiguration(l, !0),
                    c.fromLinearSpace = !1) : (c._attachImageProcessingConfiguration(null, !0),
                    c.imageProcessingConfiguration.applyByPostProcess = !0),
                    c.onApply = function(e) {
                        c.imageProcessingConfiguration.bind(e, c.aspectRatio)
                    }
                    ,
                    c
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "imageProcessingConfiguration", {
                    get: function() {
                        return this._imageProcessingConfiguration
                    },
                    set: function(e) {
                        this._attachImageProcessingConfiguration(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._attachImageProcessingConfiguration = function(t, r) {
                    var i = this;
                    if (void 0 === r && (r = !1),
                    t !== this._imageProcessingConfiguration) {
                        if (this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),
                        t)
                            this._imageProcessingConfiguration = t;
                        else {
                            var n = null
                              , o = this.getEngine()
                              , a = this.getCamera();
                            if (a)
                                n = a.getScene();
                            else if (o && o.scenes) {
                                var s = o.scenes;
                                n = s[s.length - 1]
                            } else
                                n = e.Engine.LastCreatedScene;
                            this._imageProcessingConfiguration = n.imageProcessingConfiguration
                        }
                        this._imageProcessingConfiguration && (this._imageProcessingObserver = this._imageProcessingConfiguration.onUpdateParameters.add((function(e) {
                            i._updateParameters()
                        }
                        ))),
                        r || this._updateParameters()
                    }
                }
                ,
                Object.defineProperty(r.prototype, "colorCurves", {
                    get: function() {
                        return this.imageProcessingConfiguration.colorCurves
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorCurves = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "colorCurvesEnabled", {
                    get: function() {
                        return this.imageProcessingConfiguration.colorCurvesEnabled
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorCurvesEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "colorGradingTexture", {
                    get: function() {
                        return this.imageProcessingConfiguration.colorGradingTexture
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorGradingTexture = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "colorGradingEnabled", {
                    get: function() {
                        return this.imageProcessingConfiguration.colorGradingEnabled
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorGradingEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "exposure", {
                    get: function() {
                        return this.imageProcessingConfiguration.exposure
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.exposure = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "toneMappingEnabled", {
                    get: function() {
                        return this._imageProcessingConfiguration.toneMappingEnabled
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.toneMappingEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "contrast", {
                    get: function() {
                        return this.imageProcessingConfiguration.contrast
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.contrast = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "vignetteStretch", {
                    get: function() {
                        return this.imageProcessingConfiguration.vignetteStretch
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.vignetteStretch = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "vignetteCentreX", {
                    get: function() {
                        return this.imageProcessingConfiguration.vignetteCentreX
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.vignetteCentreX = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "vignetteCentreY", {
                    get: function() {
                        return this.imageProcessingConfiguration.vignetteCentreY
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.vignetteCentreY = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "vignetteWeight", {
                    get: function() {
                        return this.imageProcessingConfiguration.vignetteWeight
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.vignetteWeight = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "vignetteColor", {
                    get: function() {
                        return this.imageProcessingConfiguration.vignetteColor
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.vignetteColor = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "vignetteCameraFov", {
                    get: function() {
                        return this.imageProcessingConfiguration.vignetteCameraFov
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.vignetteCameraFov = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "vignetteBlendMode", {
                    get: function() {
                        return this.imageProcessingConfiguration.vignetteBlendMode
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.vignetteBlendMode = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "vignetteEnabled", {
                    get: function() {
                        return this.imageProcessingConfiguration.vignetteEnabled
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.vignetteEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "fromLinearSpace", {
                    get: function() {
                        return this._fromLinearSpace
                    },
                    set: function(e) {
                        this._fromLinearSpace !== e && (this._fromLinearSpace = e,
                        this._updateParameters())
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getClassName = function() {
                    return "ImageProcessingPostProcess"
                }
                ,
                r.prototype._updateParameters = function() {
                    this._defines.FROMLINEARSPACE = this._fromLinearSpace,
                    this.imageProcessingConfiguration.prepareDefines(this._defines, !0);
                    var t = "";
                    for (var r in this._defines)
                        this._defines[r] && (t += "#define " + r + ";\r\n");
                    var i = ["textureSampler"]
                      , n = ["scale"];
                    e.ImageProcessingConfiguration && (e.ImageProcessingConfiguration.PrepareSamplers(i, this._defines),
                    e.ImageProcessingConfiguration.PrepareUniforms(n, this._defines)),
                    this.updateEffect(t, n, i)
                }
                ,
                r.prototype.dispose = function(e) {
                    t.prototype.dispose.call(this, e),
                    this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),
                    this._imageProcessingConfiguration && (this.imageProcessingConfiguration.applyByPostProcess = !1)
                }
                ,
                n([e.serialize()], r.prototype, "_fromLinearSpace", void 0),
                r
            }(e.PostProcess);
            e.ImageProcessingPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y) {
                    void 0 === n && (n = null),
                    void 0 === o && (o = null),
                    void 0 === a && (a = null),
                    void 0 === s && (s = null),
                    void 0 === y && (y = null);
                    var l = t.call(this, r, i.getScene()) || this;
                    return l.name = r,
                    l.children = new Array,
                    l.animations = new Array,
                    l._index = null,
                    l._absoluteTransform = new e.Matrix,
                    l._invertedAbsoluteTransform = new e.Matrix,
                    l._scalingDeterminant = 1,
                    l._worldTransform = new e.Matrix,
                    l._needToDecompose = !0,
                    l._needToCompose = !1,
                    l._skeleton = i,
                    l._localMatrix = o ? o.clone() : e.Matrix.Identity(),
                    l._restPose = a || l._localMatrix.clone(),
                    l._baseMatrix = s || l._localMatrix.clone(),
                    l._index = y,
                    i.bones.push(l),
                    l.setParent(n, !1),
                    (s || o) && l._updateDifferenceMatrix(),
                    l
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "_matrix", {
                    get: function() {
                        return this._compose(),
                        this._localMatrix
                    },
                    set: function(e) {
                        this._localMatrix.copyFrom(e),
                        this._needToDecompose = !0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getSkeleton = function() {
                    return this._skeleton
                }
                ,
                r.prototype.getParent = function() {
                    return this._parent
                }
                ,
                r.prototype.setParent = function(e, t) {
                    if (void 0 === t && (t = !0),
                    this._parent !== e) {
                        if (this._parent) {
                            var r = this._parent.children.indexOf(this);
                            -1 !== r && this._parent.children.splice(r, 1)
                        }
                        this._parent = e,
                        this._parent && this._parent.children.push(this),
                        t && this._updateDifferenceMatrix(),
                        this.markAsDirty()
                    }
                }
                ,
                r.prototype.getLocalMatrix = function() {
                    return this._compose(),
                    this._localMatrix
                }
                ,
                r.prototype.getBaseMatrix = function() {
                    return this._baseMatrix
                }
                ,
                r.prototype.getRestPose = function() {
                    return this._restPose
                }
                ,
                r.prototype.getWorldMatrix = function() {
                    return this._worldTransform
                }
                ,
                r.prototype.returnToRest = function() {
                    this.updateMatrix(this._restPose.clone())
                }
                ,
                r.prototype.getInvertedAbsoluteTransform = function() {
                    return this._invertedAbsoluteTransform
                }
                ,
                r.prototype.getAbsoluteTransform = function() {
                    return this._absoluteTransform
                }
                ,
                Object.defineProperty(r.prototype, "position", {
                    get: function() {
                        return this._decompose(),
                        this._localPosition
                    },
                    set: function(e) {
                        this._decompose(),
                        this._localPosition.copyFrom(e),
                        this._markAsDirtyAndCompose()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "rotation", {
                    get: function() {
                        return this.getRotation()
                    },
                    set: function(e) {
                        this.setRotation(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "rotationQuaternion", {
                    get: function() {
                        return this._decompose(),
                        this._localRotation
                    },
                    set: function(e) {
                        this.setRotationQuaternion(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "scaling", {
                    get: function() {
                        return this.getScale()
                    },
                    set: function(e) {
                        this.setScale(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "animationPropertiesOverride", {
                    get: function() {
                        return this._skeleton.animationPropertiesOverride
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype._decompose = function() {
                    this._needToDecompose && (this._needToDecompose = !1,
                    this._localScaling || (this._localScaling = e.Vector3.Zero(),
                    this._localRotation = e.Quaternion.Zero(),
                    this._localPosition = e.Vector3.Zero()),
                    this._localMatrix.decompose(this._localScaling, this._localRotation, this._localPosition))
                }
                ,
                r.prototype._compose = function() {
                    this._needToCompose && (this._needToCompose = !1,
                    e.Matrix.ComposeToRef(this._localScaling, this._localRotation, this._localPosition, this._localMatrix))
                }
                ,
                r.prototype.updateMatrix = function(e, t, r) {
                    void 0 === t && (t = !0),
                    void 0 === r && (r = !0),
                    this._baseMatrix.copyFrom(e),
                    t && this._updateDifferenceMatrix(),
                    r ? (this._localMatrix.copyFrom(e),
                    this._markAsDirtyAndDecompose()) : this.markAsDirty()
                }
                ,
                r.prototype._updateDifferenceMatrix = function(e, t) {
                    if (void 0 === t && (t = !0),
                    e || (e = this._baseMatrix),
                    this._parent ? e.multiplyToRef(this._parent._absoluteTransform, this._absoluteTransform) : this._absoluteTransform.copyFrom(e),
                    this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),
                    t)
                        for (var r = 0; r < this.children.length; r++)
                            this.children[r]._updateDifferenceMatrix();
                    this._scalingDeterminant = this._absoluteTransform.determinant() < 0 ? -1 : 1
                }
                ,
                r.prototype.markAsDirty = function() {
                    this._currentRenderId++,
                    this._childRenderId++,
                    this._skeleton._markAsDirty()
                }
                ,
                r.prototype._markAsDirtyAndCompose = function() {
                    this.markAsDirty(),
                    this._needToCompose = !0
                }
                ,
                r.prototype._markAsDirtyAndDecompose = function() {
                    this.markAsDirty(),
                    this._needToDecompose = !0
                }
                ,
                r.prototype.copyAnimationRange = function(t, r, i, n, o) {
                    void 0 === n && (n = !1),
                    void 0 === o && (o = null),
                    0 === this.animations.length && (this.animations.push(new e.Animation(this.name,"_matrix",t.animations[0].framePerSecond,e.Animation.ANIMATIONTYPE_MATRIX,0)),
                    this.animations[0].setKeys([]));
                    var a = t.animations[0].getRange(r);
                    if (!a)
                        return !1;
                    for (var s, y, l, c = a.from, h = a.to, u = t.animations[0].getKeys(), d = t.length, x = t.getParent(), p = this.getParent(), f = n && x && d && this.length && d !== this.length, m = f && p && x ? p.length / x.length : 1, z = n && !p && o && (1 !== o.x || 1 !== o.y || 1 !== o.z), _ = this.animations[0].getKeys(), g = 0, v = u.length; g < v; g++)
                        (s = u[g]).frame >= c && s.frame <= h && (n ? (l = s.value.clone(),
                        f ? (y = l.getTranslation(),
                        l.setTranslation(y.scaleInPlace(m))) : z && o ? (y = l.getTranslation(),
                        l.setTranslation(y.multiplyInPlace(o))) : l = s.value) : l = s.value,
                        _.push({
                            frame: s.frame + i,
                            value: l
                        }));
                    return this.animations[0].createRange(r, c + i, h + i),
                    !0
                }
                ,
                r.prototype.translate = function(t, i, n) {
                    void 0 === i && (i = e.Space.LOCAL);
                    var o = this.getLocalMatrix();
                    if (i == e.Space.LOCAL)
                        o.m[12] += t.x,
                        o.m[13] += t.y,
                        o.m[14] += t.z;
                    else {
                        var a = null;
                        n && (a = n.getWorldMatrix()),
                        this._skeleton.computeAbsoluteTransforms();
                        var s = r._tmpMats[0]
                          , y = r._tmpVecs[0];
                        this._parent && (n && a ? (s.copyFrom(this._parent.getAbsoluteTransform()),
                        s.multiplyToRef(a, s)) : s.copyFrom(this._parent.getAbsoluteTransform())),
                        s.m[12] = 0,
                        s.m[13] = 0,
                        s.m[14] = 0,
                        s.invert(),
                        e.Vector3.TransformCoordinatesToRef(t, s, y),
                        o.m[12] += y.x,
                        o.m[13] += y.y,
                        o.m[14] += y.z
                    }
                    this._markAsDirtyAndDecompose()
                }
                ,
                r.prototype.setPosition = function(t, i, n) {
                    void 0 === i && (i = e.Space.LOCAL);
                    var o = this.getLocalMatrix();
                    if (i == e.Space.LOCAL)
                        o.m[12] = t.x,
                        o.m[13] = t.y,
                        o.m[14] = t.z;
                    else {
                        var a = null;
                        n && (a = n.getWorldMatrix()),
                        this._skeleton.computeAbsoluteTransforms();
                        var s = r._tmpMats[0]
                          , y = r._tmpVecs[0];
                        this._parent && (n && a ? (s.copyFrom(this._parent.getAbsoluteTransform()),
                        s.multiplyToRef(a, s)) : s.copyFrom(this._parent.getAbsoluteTransform())),
                        s.invert(),
                        e.Vector3.TransformCoordinatesToRef(t, s, y),
                        o.m[12] = y.x,
                        o.m[13] = y.y,
                        o.m[14] = y.z
                    }
                    this._markAsDirtyAndDecompose()
                }
                ,
                r.prototype.setAbsolutePosition = function(t, r) {
                    this.setPosition(t, e.Space.WORLD, r)
                }
                ,
                r.prototype.scale = function(t, i, n, o) {
                    void 0 === o && (o = !1);
                    var a = this.getLocalMatrix()
                      , s = r._tmpMats[0];
                    e.Matrix.ScalingToRef(t, i, n, s),
                    s.multiplyToRef(a, a),
                    s.invert();
                    for (var y = 0, l = this.children; y < l.length; y++) {
                        var c = (d = l[y]).getLocalMatrix();
                        c.multiplyToRef(s, c),
                        c.m[12] *= t,
                        c.m[13] *= i,
                        c.m[14] *= n,
                        d._markAsDirtyAndDecompose()
                    }
                    if (this._markAsDirtyAndDecompose(),
                    o)
                        for (var h = 0, u = this.children; h < u.length; h++) {
                            var d;
                            (d = u[h]).scale(t, i, n, o)
                        }
                }
                ,
                r.prototype.setScale = function(e) {
                    this._decompose(),
                    this._localScaling.copyFrom(e),
                    this._markAsDirtyAndCompose()
                }
                ,
                r.prototype.getScale = function() {
                    return this._decompose(),
                    this._localScaling
                }
                ,
                r.prototype.getScaleToRef = function(e) {
                    this._decompose(),
                    e.copyFrom(this._localScaling)
                }
                ,
                r.prototype.setYawPitchRoll = function(t, i, n, o, a) {
                    if (void 0 === o && (o = e.Space.LOCAL),
                    o === e.Space.LOCAL) {
                        var s = r._tmpQuat;
                        return e.Quaternion.RotationYawPitchRollToRef(t, i, n, s),
                        void this.setRotationQuaternion(s, o, a)
                    }
                    var y = r._tmpMats[0];
                    if (this._getNegativeRotationToRef(y, a)) {
                        var l = r._tmpMats[1];
                        e.Matrix.RotationYawPitchRollToRef(t, i, n, l),
                        y.multiplyToRef(l, l),
                        this._rotateWithMatrix(l, o, a)
                    }
                }
                ,
                r.prototype.rotate = function(t, i, n, o) {
                    void 0 === n && (n = e.Space.LOCAL);
                    var a = r._tmpMats[0];
                    a.m[12] = 0,
                    a.m[13] = 0,
                    a.m[14] = 0,
                    e.Matrix.RotationAxisToRef(t, i, a),
                    this._rotateWithMatrix(a, n, o)
                }
                ,
                r.prototype.setAxisAngle = function(t, i, n, o) {
                    if (void 0 === n && (n = e.Space.LOCAL),
                    n === e.Space.LOCAL) {
                        var a = r._tmpQuat;
                        return e.Quaternion.RotationAxisToRef(t, i, a),
                        void this.setRotationQuaternion(a, n, o)
                    }
                    var s = r._tmpMats[0];
                    if (this._getNegativeRotationToRef(s, o)) {
                        var y = r._tmpMats[1];
                        e.Matrix.RotationAxisToRef(t, i, y),
                        s.multiplyToRef(y, y),
                        this._rotateWithMatrix(y, n, o)
                    }
                }
                ,
                r.prototype.setRotation = function(t, r, i) {
                    void 0 === r && (r = e.Space.LOCAL),
                    this.setYawPitchRoll(t.y, t.x, t.z, r, i)
                }
                ,
                r.prototype.setRotationQuaternion = function(t, i, n) {
                    if (void 0 === i && (i = e.Space.LOCAL),
                    i === e.Space.LOCAL)
                        return this._decompose(),
                        this._localRotation.copyFrom(t),
                        void this._markAsDirtyAndCompose();
                    var o = r._tmpMats[0];
                    if (this._getNegativeRotationToRef(o, n)) {
                        var a = r._tmpMats[1];
                        e.Matrix.FromQuaternionToRef(t, a),
                        o.multiplyToRef(a, a),
                        this._rotateWithMatrix(a, i, n)
                    }
                }
                ,
                r.prototype.setRotationMatrix = function(t, i, n) {
                    if (void 0 === i && (i = e.Space.LOCAL),
                    i === e.Space.LOCAL) {
                        var o = r._tmpQuat;
                        return e.Quaternion.FromRotationMatrixToRef(t, o),
                        void this.setRotationQuaternion(o, i, n)
                    }
                    var a = r._tmpMats[0];
                    if (this._getNegativeRotationToRef(a, n)) {
                        var s = r._tmpMats[1];
                        s.copyFrom(t),
                        a.multiplyToRef(t, s),
                        this._rotateWithMatrix(s, i, n)
                    }
                }
                ,
                r.prototype._rotateWithMatrix = function(t, i, n) {
                    void 0 === i && (i = e.Space.LOCAL);
                    var o = this.getLocalMatrix()
                      , a = o.m[12]
                      , s = o.m[13]
                      , y = o.m[14]
                      , l = this.getParent()
                      , c = r._tmpMats[3]
                      , h = r._tmpMats[4];
                    l && i == e.Space.WORLD ? (n ? (c.copyFrom(n.getWorldMatrix()),
                    l.getAbsoluteTransform().multiplyToRef(c, c)) : c.copyFrom(l.getAbsoluteTransform()),
                    h.copyFrom(c),
                    h.invert(),
                    o.multiplyToRef(c, o),
                    o.multiplyToRef(t, o),
                    o.multiplyToRef(h, o)) : i == e.Space.WORLD && n ? (c.copyFrom(n.getWorldMatrix()),
                    h.copyFrom(c),
                    h.invert(),
                    o.multiplyToRef(c, o),
                    o.multiplyToRef(t, o),
                    o.multiplyToRef(h, o)) : o.multiplyToRef(t, o),
                    o.m[12] = a,
                    o.m[13] = s,
                    o.m[14] = y,
                    this.computeAbsoluteTransforms(),
                    this._markAsDirtyAndDecompose()
                }
                ,
                r.prototype._getNegativeRotationToRef = function(t, i) {
                    var n = r._tmpMats[2];
                    return t.copyFrom(this.getAbsoluteTransform()),
                    i && (t.multiplyToRef(i.getWorldMatrix(), t),
                    e.Matrix.ScalingToRef(i.scaling.x, i.scaling.y, i.scaling.z, n)),
                    t.invert(),
                    !isNaN(t.m[0]) && (n.m[0] *= this._scalingDeterminant,
                    t.multiplyToRef(n, t),
                    !0)
                }
                ,
                r.prototype.getPosition = function(t, r) {
                    void 0 === t && (t = e.Space.LOCAL),
                    void 0 === r && (r = null);
                    var i = e.Vector3.Zero();
                    return this.getPositionToRef(t, r, i),
                    i
                }
                ,
                r.prototype.getPositionToRef = function(t, i, n) {
                    if (void 0 === t && (t = e.Space.LOCAL),
                    t == e.Space.LOCAL) {
                        var o = this.getLocalMatrix();
                        n.x = o.m[12],
                        n.y = o.m[13],
                        n.z = o.m[14]
                    } else {
                        var a = null;
                        i && (a = i.getWorldMatrix()),
                        this._skeleton.computeAbsoluteTransforms();
                        var s = r._tmpMats[0];
                        i && a ? (s.copyFrom(this.getAbsoluteTransform()),
                        s.multiplyToRef(a, s)) : s = this.getAbsoluteTransform(),
                        n.x = s.m[12],
                        n.y = s.m[13],
                        n.z = s.m[14]
                    }
                }
                ,
                r.prototype.getAbsolutePosition = function(t) {
                    void 0 === t && (t = null);
                    var r = e.Vector3.Zero();
                    return this.getPositionToRef(e.Space.WORLD, t, r),
                    r
                }
                ,
                r.prototype.getAbsolutePositionToRef = function(t, r) {
                    this.getPositionToRef(e.Space.WORLD, t, r)
                }
                ,
                r.prototype.computeAbsoluteTransforms = function() {
                    if (this._compose(),
                    this._parent)
                        this._localMatrix.multiplyToRef(this._parent._absoluteTransform, this._absoluteTransform);
                    else {
                        this._absoluteTransform.copyFrom(this._localMatrix);
                        var e = this._skeleton.getPoseMatrix();
                        e && this._absoluteTransform.multiplyToRef(e, this._absoluteTransform)
                    }
                    for (var t = this.children, r = t.length, i = 0; i < r; i++)
                        t[i].computeAbsoluteTransforms()
                }
                ,
                r.prototype.getDirection = function(t, r) {
                    void 0 === r && (r = null);
                    var i = e.Vector3.Zero();
                    return this.getDirectionToRef(t, r, i),
                    i
                }
                ,
                r.prototype.getDirectionToRef = function(t, i, n) {
                    void 0 === i && (i = null);
                    var o = null;
                    i && (o = i.getWorldMatrix()),
                    this._skeleton.computeAbsoluteTransforms();
                    var a = r._tmpMats[0];
                    a.copyFrom(this.getAbsoluteTransform()),
                    i && o && a.multiplyToRef(o, a),
                    e.Vector3.TransformNormalToRef(t, a, n),
                    n.normalize()
                }
                ,
                r.prototype.getRotation = function(t, r) {
                    void 0 === t && (t = e.Space.LOCAL),
                    void 0 === r && (r = null);
                    var i = e.Vector3.Zero();
                    return this.getRotationToRef(t, r, i),
                    i
                }
                ,
                r.prototype.getRotationToRef = function(t, i, n) {
                    void 0 === t && (t = e.Space.LOCAL),
                    void 0 === i && (i = null);
                    var o = r._tmpQuat;
                    this.getRotationQuaternionToRef(t, i, o),
                    o.toEulerAnglesToRef(n)
                }
                ,
                r.prototype.getRotationQuaternion = function(t, r) {
                    void 0 === t && (t = e.Space.LOCAL),
                    void 0 === r && (r = null);
                    var i = e.Quaternion.Identity();
                    return this.getRotationQuaternionToRef(t, r, i),
                    i
                }
                ,
                r.prototype.getRotationQuaternionToRef = function(t, i, n) {
                    if (void 0 === t && (t = e.Space.LOCAL),
                    void 0 === i && (i = null),
                    t == e.Space.LOCAL)
                        this._decompose(),
                        n.copyFrom(this._localRotation);
                    else {
                        var o = r._tmpMats[0]
                          , a = this.getAbsoluteTransform();
                        i ? a.multiplyToRef(i.getWorldMatrix(), o) : o.copyFrom(a),
                        o.m[0] *= this._scalingDeterminant,
                        o.m[1] *= this._scalingDeterminant,
                        o.m[2] *= this._scalingDeterminant,
                        o.decompose(void 0, n, void 0)
                    }
                }
                ,
                r.prototype.getRotationMatrix = function(t, r) {
                    void 0 === t && (t = e.Space.LOCAL);
                    var i = e.Matrix.Identity();
                    return this.getRotationMatrixToRef(t, r, i),
                    i
                }
                ,
                r.prototype.getRotationMatrixToRef = function(t, i, n) {
                    if (void 0 === t && (t = e.Space.LOCAL),
                    t == e.Space.LOCAL)
                        this.getLocalMatrix().getRotationMatrixToRef(n);
                    else {
                        var o = r._tmpMats[0]
                          , a = this.getAbsoluteTransform();
                        i ? a.multiplyToRef(i.getWorldMatrix(), o) : o.copyFrom(a),
                        o.m[0] *= this._scalingDeterminant,
                        o.m[1] *= this._scalingDeterminant,
                        o.m[2] *= this._scalingDeterminant,
                        o.getRotationMatrixToRef(n)
                    }
                }
                ,
                r.prototype.getAbsolutePositionFromLocal = function(t, r) {
                    void 0 === r && (r = null);
                    var i = e.Vector3.Zero();
                    return this.getAbsolutePositionFromLocalToRef(t, r, i),
                    i
                }
                ,
                r.prototype.getAbsolutePositionFromLocalToRef = function(t, i, n) {
                    void 0 === i && (i = null);
                    var o = null;
                    i && (o = i.getWorldMatrix()),
                    this._skeleton.computeAbsoluteTransforms();
                    var a = r._tmpMats[0];
                    i && o ? (a.copyFrom(this.getAbsoluteTransform()),
                    a.multiplyToRef(o, a)) : a = this.getAbsoluteTransform(),
                    e.Vector3.TransformCoordinatesToRef(t, a, n)
                }
                ,
                r.prototype.getLocalPositionFromAbsolute = function(t, r) {
                    void 0 === r && (r = null);
                    var i = e.Vector3.Zero();
                    return this.getLocalPositionFromAbsoluteToRef(t, r, i),
                    i
                }
                ,
                r.prototype.getLocalPositionFromAbsoluteToRef = function(t, i, n) {
                    void 0 === i && (i = null);
                    var o = null;
                    i && (o = i.getWorldMatrix()),
                    this._skeleton.computeAbsoluteTransforms();
                    var a = r._tmpMats[0];
                    a.copyFrom(this.getAbsoluteTransform()),
                    i && o && a.multiplyToRef(o, a),
                    a.invert(),
                    e.Vector3.TransformCoordinatesToRef(t, a, n)
                }
                ,
                r._tmpVecs = [e.Vector3.Zero(), e.Vector3.Zero()],
                r._tmpQuat = e.Quaternion.Identity(),
                r._tmpMats = [e.Matrix.Identity(), e.Matrix.Identity(), e.Matrix.Identity(), e.Matrix.Identity(), e.Matrix.Identity()],
                r
            }(e.Node);
            e.Bone = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i) {
                    if (this.targetPosition = e.Vector3.Zero(),
                    this.poleTargetPosition = e.Vector3.Zero(),
                    this.poleTargetLocalOffset = e.Vector3.Zero(),
                    this.poleAngle = 0,
                    this.slerpAmount = 1,
                    this._bone1Quat = e.Quaternion.Identity(),
                    this._bone1Mat = e.Matrix.Identity(),
                    this._bone2Ang = Math.PI,
                    this._maxAngle = Math.PI,
                    this._rightHandedSystem = !1,
                    this._bendAxis = e.Vector3.Right(),
                    this._slerping = !1,
                    this._adjustRoll = 0,
                    this._bone2 = r,
                    this._bone1 = r.getParent(),
                    this._bone1) {
                        this.mesh = t;
                        var n = r.getPosition();
                        if (r.getAbsoluteTransform().determinant() > 0 && (this._rightHandedSystem = !0,
                        this._bendAxis.x = 0,
                        this._bendAxis.y = 0,
                        this._bendAxis.z = -1,
                        n.x > n.y && n.x > n.z && (this._adjustRoll = .5 * Math.PI,
                        this._bendAxis.z = 1)),
                        this._bone1.length) {
                            var o = this._bone1.getScale()
                              , a = this._bone2.getScale();
                            this._bone1Length = this._bone1.length * o.y * this.mesh.scaling.y,
                            this._bone2Length = this._bone2.length * a.y * this.mesh.scaling.y
                        } else if (this._bone1.children[0]) {
                            t.computeWorldMatrix(!0);
                            var s = this._bone2.children[0].getAbsolutePosition(t)
                              , y = this._bone2.getAbsolutePosition(t)
                              , l = this._bone1.getAbsolutePosition(t);
                            this._bone1Length = e.Vector3.Distance(s, y),
                            this._bone2Length = e.Vector3.Distance(y, l)
                        }
                        this._bone1.getRotationMatrixToRef(e.Space.WORLD, t, this._bone1Mat),
                        this.maxAngle = Math.PI,
                        i && (i.targetMesh && (this.targetMesh = i.targetMesh,
                        this.targetMesh.computeWorldMatrix(!0)),
                        i.poleTargetMesh ? (this.poleTargetMesh = i.poleTargetMesh,
                        this.poleTargetMesh.computeWorldMatrix(!0)) : i.poleTargetBone ? this.poleTargetBone = i.poleTargetBone : this._bone1.getParent() && (this.poleTargetBone = this._bone1.getParent()),
                        i.poleTargetLocalOffset && this.poleTargetLocalOffset.copyFrom(i.poleTargetLocalOffset),
                        i.poleAngle && (this.poleAngle = i.poleAngle),
                        i.bendAxis && this._bendAxis.copyFrom(i.bendAxis),
                        i.maxAngle && (this.maxAngle = i.maxAngle),
                        i.slerpAmount && (this.slerpAmount = i.slerpAmount))
                    }
                }
                return Object.defineProperty(t.prototype, "maxAngle", {
                    get: function() {
                        return this._maxAngle
                    },
                    set: function(e) {
                        this._setMaxAngle(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._setMaxAngle = function(e) {
                    e < 0 && (e = 0),
                    (e > Math.PI || null == e) && (e = Math.PI),
                    this._maxAngle = e;
                    var t = this._bone1Length
                      , r = this._bone2Length;
                    this._maxReach = Math.sqrt(t * t + r * r - 2 * t * r * Math.cos(e))
                }
                ,
                t.prototype.update = function() {
                    var r = this._bone1;
                    if (r) {
                        var i = this.targetPosition
                          , n = this.poleTargetPosition
                          , o = t._tmpMats[0]
                          , a = t._tmpMats[1];
                        this.targetMesh && i.copyFrom(this.targetMesh.getAbsolutePosition()),
                        this.poleTargetBone ? this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset, this.mesh, n) : this.poleTargetMesh && e.Vector3.TransformCoordinatesToRef(this.poleTargetLocalOffset, this.poleTargetMesh.getWorldMatrix(), n);
                        var s = t._tmpVecs[0]
                          , y = t._tmpVecs[1]
                          , l = t._tmpVecs[2]
                          , c = t._tmpVecs[3]
                          , h = t._tmpVecs[4]
                          , u = t._tmpQuat;
                        r.getAbsolutePositionToRef(this.mesh, s),
                        n.subtractToRef(s, h),
                        0 == h.x && 0 == h.y && 0 == h.z ? h.y = 1 : h.normalize(),
                        i.subtractToRef(s, c),
                        c.normalize(),
                        e.Vector3.CrossToRef(c, h, y),
                        y.normalize(),
                        e.Vector3.CrossToRef(c, y, l),
                        l.normalize(),
                        e.Matrix.FromXYZAxesToRef(l, c, y, o);
                        var d = this._bone1Length
                          , x = this._bone2Length
                          , p = e.Vector3.Distance(s, i);
                        this._maxReach > 0 && (p = Math.min(this._maxReach, p));
                        var f = (x * x + p * p - d * d) / (2 * x * p)
                          , m = (p * p + d * d - x * x) / (2 * p * d);
                        f > 1 && (f = 1),
                        m > 1 && (m = 1),
                        f < -1 && (f = -1),
                        m < -1 && (m = -1);
                        var z = Math.acos(f)
                          , _ = Math.acos(m)
                          , g = -z - _;
                        if (this._rightHandedSystem)
                            e.Matrix.RotationYawPitchRollToRef(0, 0, this._adjustRoll, a),
                            a.multiplyToRef(o, o),
                            e.Matrix.RotationAxisToRef(this._bendAxis, _, a),
                            a.multiplyToRef(o, o);
                        else {
                            var v = t._tmpVecs[5];
                            v.copyFrom(this._bendAxis),
                            v.x *= -1,
                            e.Matrix.RotationAxisToRef(v, -_, a),
                            a.multiplyToRef(o, o)
                        }
                        this.poleAngle && (e.Matrix.RotationAxisToRef(c, this.poleAngle, a),
                        o.multiplyToRef(a, o)),
                        this._bone1 && (this.slerpAmount < 1 ? (this._slerping || e.Quaternion.FromRotationMatrixToRef(this._bone1Mat, this._bone1Quat),
                        e.Quaternion.FromRotationMatrixToRef(o, u),
                        e.Quaternion.SlerpToRef(this._bone1Quat, u, this.slerpAmount, this._bone1Quat),
                        g = this._bone2Ang * (1 - this.slerpAmount) + g * this.slerpAmount,
                        this._bone1.setRotationQuaternion(this._bone1Quat, e.Space.WORLD, this.mesh),
                        this._slerping = !0) : (this._bone1.setRotationMatrix(o, e.Space.WORLD, this.mesh),
                        this._bone1Mat.copyFrom(o),
                        this._slerping = !1)),
                        this._bone2.setAxisAngle(this._bendAxis, g, e.Space.LOCAL),
                        this._bone2Ang = g
                    }
                }
                ,
                t._tmpVecs = [e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero()],
                t._tmpQuat = e.Quaternion.Identity(),
                t._tmpMats = [e.Matrix.Identity(), e.Matrix.Identity()],
                t
            }();
            e.BoneIKController = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n) {
                    if (this.upAxis = e.Vector3.Up(),
                    this.upAxisSpace = e.Space.LOCAL,
                    this.adjustYaw = 0,
                    this.adjustPitch = 0,
                    this.adjustRoll = 0,
                    this.slerpAmount = 1,
                    this._boneQuat = e.Quaternion.Identity(),
                    this._slerping = !1,
                    this._firstFrameSkipped = !1,
                    this._fowardAxis = e.Vector3.Forward(),
                    this.mesh = t,
                    this.bone = r,
                    this.target = i,
                    n && (n.adjustYaw && (this.adjustYaw = n.adjustYaw),
                    n.adjustPitch && (this.adjustPitch = n.adjustPitch),
                    n.adjustRoll && (this.adjustRoll = n.adjustRoll),
                    null != n.maxYaw ? this.maxYaw = n.maxYaw : this.maxYaw = Math.PI,
                    null != n.minYaw ? this.minYaw = n.minYaw : this.minYaw = -Math.PI,
                    null != n.maxPitch ? this.maxPitch = n.maxPitch : this.maxPitch = Math.PI,
                    null != n.minPitch ? this.minPitch = n.minPitch : this.minPitch = -Math.PI,
                    null != n.slerpAmount && (this.slerpAmount = n.slerpAmount),
                    null != n.upAxis && (this.upAxis = n.upAxis),
                    null != n.upAxisSpace && (this.upAxisSpace = n.upAxisSpace),
                    null != n.yawAxis || null != n.pitchAxis)) {
                        var o = e.Axis.Y
                          , a = e.Axis.X;
                        null != n.yawAxis && (o = n.yawAxis.clone()).normalize(),
                        null != n.pitchAxis && (a = n.pitchAxis.clone()).normalize();
                        var s = e.Vector3.Cross(a, o);
                        this._transformYawPitch = e.Matrix.Identity(),
                        e.Matrix.FromXYZAxesToRef(a, o, s, this._transformYawPitch),
                        this._transformYawPitchInv = this._transformYawPitch.clone(),
                        this._transformYawPitch.invert()
                    }
                    r.getParent() || this.upAxisSpace != e.Space.BONE || (this.upAxisSpace = e.Space.LOCAL)
                }
                return Object.defineProperty(t.prototype, "minYaw", {
                    get: function() {
                        return this._minYaw
                    },
                    set: function(e) {
                        this._minYaw = e,
                        this._minYawSin = Math.sin(e),
                        this._minYawCos = Math.cos(e),
                        null != this._maxYaw && (this._midYawConstraint = .5 * this._getAngleDiff(this._minYaw, this._maxYaw) + this._minYaw,
                        this._yawRange = this._maxYaw - this._minYaw)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "maxYaw", {
                    get: function() {
                        return this._maxYaw
                    },
                    set: function(e) {
                        this._maxYaw = e,
                        this._maxYawSin = Math.sin(e),
                        this._maxYawCos = Math.cos(e),
                        null != this._minYaw && (this._midYawConstraint = .5 * this._getAngleDiff(this._minYaw, this._maxYaw) + this._minYaw,
                        this._yawRange = this._maxYaw - this._minYaw)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "minPitch", {
                    get: function() {
                        return this._minPitch
                    },
                    set: function(e) {
                        this._minPitch = e,
                        this._minPitchTan = Math.tan(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "maxPitch", {
                    get: function() {
                        return this._maxPitch
                    },
                    set: function(e) {
                        this._maxPitch = e,
                        this._maxPitchTan = Math.tan(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.update = function() {
                    if (this.slerpAmount < 1 && !this._firstFrameSkipped)
                        this._firstFrameSkipped = !0;
                    else {
                        var r = this.bone
                          , i = t._tmpVecs[0];
                        r.getAbsolutePositionToRef(this.mesh, i);
                        var n = this.target
                          , o = t._tmpMats[0]
                          , a = t._tmpMats[1]
                          , s = this.mesh
                          , y = r.getParent()
                          , l = t._tmpVecs[1];
                        l.copyFrom(this.upAxis),
                        this.upAxisSpace == e.Space.BONE && y ? (this._transformYawPitch && e.Vector3.TransformCoordinatesToRef(l, this._transformYawPitchInv, l),
                        y.getDirectionToRef(l, this.mesh, l)) : this.upAxisSpace == e.Space.LOCAL && (s.getDirectionToRef(l, l),
                        1 == s.scaling.x && 1 == s.scaling.y && 1 == s.scaling.z || l.normalize());
                        var c = !1
                          , h = !1;
                        if (this._maxYaw == Math.PI && this._minYaw == -Math.PI || (c = !0),
                        this._maxPitch == Math.PI && this._minPitch == -Math.PI || (h = !0),
                        c || h) {
                            var u = t._tmpMats[2]
                              , d = t._tmpMats[3];
                            if (this.upAxisSpace == e.Space.BONE && 1 == l.y && y)
                                y.getRotationMatrixToRef(e.Space.WORLD, this.mesh, u);
                            else if (this.upAxisSpace != e.Space.LOCAL || 1 != l.y || y) {
                                (p = t._tmpVecs[2]).copyFrom(this._fowardAxis),
                                this._transformYawPitch && e.Vector3.TransformCoordinatesToRef(p, this._transformYawPitchInv, p),
                                y ? y.getDirectionToRef(p, this.mesh, p) : s.getDirectionToRef(p, p);
                                var x = e.Vector3.Cross(l, p);
                                x.normalize();
                                var p = e.Vector3.Cross(x, l);
                                e.Matrix.FromXYZAxesToRef(x, l, p, u)
                            } else
                                u.copyFrom(s.getWorldMatrix());
                            u.invertToRef(d);
                            var f = null;
                            if (h) {
                                var m = t._tmpVecs[3];
                                n.subtractToRef(i, m),
                                e.Vector3.TransformCoordinatesToRef(m, d, m),
                                f = Math.sqrt(m.x * m.x + m.z * m.z);
                                var z = Math.atan2(m.y, f)
                                  , _ = z;
                                z > this._maxPitch ? (m.y = this._maxPitchTan * f,
                                _ = this._maxPitch) : z < this._minPitch && (m.y = this._minPitchTan * f,
                                _ = this._minPitch),
                                z != _ && (e.Vector3.TransformCoordinatesToRef(m, u, m),
                                m.addInPlace(i),
                                n = m)
                            }
                            if (c) {
                                m = t._tmpVecs[4];
                                n.subtractToRef(i, m),
                                e.Vector3.TransformCoordinatesToRef(m, d, m);
                                var g = Math.atan2(m.x, m.z)
                                  , v = g;
                                if ((g > this._maxYaw || g < this._minYaw) && (null == f && (f = Math.sqrt(m.x * m.x + m.z * m.z)),
                                this._yawRange > Math.PI ? this._isAngleBetween(g, this._maxYaw, this._midYawConstraint) ? (m.z = this._maxYawCos * f,
                                m.x = this._maxYawSin * f,
                                v = this._maxYaw) : this._isAngleBetween(g, this._midYawConstraint, this._minYaw) && (m.z = this._minYawCos * f,
                                m.x = this._minYawSin * f,
                                v = this._minYaw) : g > this._maxYaw ? (m.z = this._maxYawCos * f,
                                m.x = this._maxYawSin * f,
                                v = this._maxYaw) : g < this._minYaw && (m.z = this._minYawCos * f,
                                m.x = this._minYawSin * f,
                                v = this._minYaw)),
                                this._slerping && this._yawRange > Math.PI) {
                                    var b = t._tmpVecs[8];
                                    b.copyFrom(e.Axis.Z),
                                    this._transformYawPitch && e.Vector3.TransformCoordinatesToRef(b, this._transformYawPitchInv, b);
                                    var T = t._tmpMats[4];
                                    this._boneQuat.toRotationMatrix(T),
                                    this.mesh.getWorldMatrix().multiplyToRef(T, T),
                                    e.Vector3.TransformCoordinatesToRef(b, T, b),
                                    e.Vector3.TransformCoordinatesToRef(b, d, b);
                                    var E = Math.atan2(b.x, b.z);
                                    if (this._getAngleBetween(E, g) > this._getAngleBetween(E, this._midYawConstraint)) {
                                        null == f && (f = Math.sqrt(m.x * m.x + m.z * m.z));
                                        var P = this._getAngleBetween(E, this._maxYaw);
                                        this._getAngleBetween(E, this._minYaw) < P ? (v = E + .75 * Math.PI,
                                        m.z = Math.cos(v) * f,
                                        m.x = Math.sin(v) * f) : (v = E - .75 * Math.PI,
                                        m.z = Math.cos(v) * f,
                                        m.x = Math.sin(v) * f)
                                    }
                                }
                                g != v && (e.Vector3.TransformCoordinatesToRef(m, u, m),
                                m.addInPlace(i),
                                n = m)
                            }
                        }
                        var A = t._tmpVecs[5]
                          , S = t._tmpVecs[6]
                          , M = t._tmpVecs[7]
                          , C = t._tmpQuat;
                        n.subtractToRef(i, A),
                        A.normalize(),
                        e.Vector3.CrossToRef(l, A, S),
                        S.normalize(),
                        e.Vector3.CrossToRef(A, S, M),
                        M.normalize(),
                        e.Matrix.FromXYZAxesToRef(S, M, A, o),
                        0 === S.x && 0 === S.y && 0 === S.z || 0 === M.x && 0 === M.y && 0 === M.z || 0 === A.x && 0 === A.y && 0 === A.z || ((this.adjustYaw || this.adjustPitch || this.adjustRoll) && (e.Matrix.RotationYawPitchRollToRef(this.adjustYaw, this.adjustPitch, this.adjustRoll, a),
                        a.multiplyToRef(o, o)),
                        this.slerpAmount < 1 ? (this._slerping || this.bone.getRotationQuaternionToRef(e.Space.WORLD, this.mesh, this._boneQuat),
                        this._transformYawPitch && this._transformYawPitch.multiplyToRef(o, o),
                        e.Quaternion.FromRotationMatrixToRef(o, C),
                        e.Quaternion.SlerpToRef(this._boneQuat, C, this.slerpAmount, this._boneQuat),
                        this.bone.setRotationQuaternion(this._boneQuat, e.Space.WORLD, this.mesh),
                        this._slerping = !0) : (this._transformYawPitch && this._transformYawPitch.multiplyToRef(o, o),
                        this.bone.setRotationMatrix(o, e.Space.WORLD, this.mesh),
                        this._slerping = !1))
                    }
                }
                ,
                t.prototype._getAngleDiff = function(e, t) {
                    var r = t - e;
                    return (r %= 2 * Math.PI) > Math.PI ? r -= 2 * Math.PI : r < -Math.PI && (r += 2 * Math.PI),
                    r
                }
                ,
                t.prototype._getAngleBetween = function(e, t) {
                    var r = 0;
                    return (r = (e = (e %= 2 * Math.PI) < 0 ? e + 2 * Math.PI : e) < (t = (t %= 2 * Math.PI) < 0 ? t + 2 * Math.PI : t) ? t - e : e - t) > Math.PI && (r = 2 * Math.PI - r),
                    r
                }
                ,
                t.prototype._isAngleBetween = function(e, t, r) {
                    if (e = (e %= 2 * Math.PI) < 0 ? e + 2 * Math.PI : e,
                    (t = (t %= 2 * Math.PI) < 0 ? t + 2 * Math.PI : t) < (r = (r %= 2 * Math.PI) < 0 ? r + 2 * Math.PI : r)) {
                        if (e > t && e < r)
                            return !0
                    } else if (e > r && e < t)
                        return !0;
                    return !1
                }
                ,
                t._tmpVecs = [e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero()],
                t._tmpQuat = e.Quaternion.Identity(),
                t._tmpMats = [e.Matrix.Identity(), e.Matrix.Identity(), e.Matrix.Identity(), e.Matrix.Identity(), e.Matrix.Identity()],
                t
            }();
            e.BoneLookController = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i) {
                    this.name = t,
                    this.id = r,
                    this.bones = new Array,
                    this.needInitialSkinMatrix = !1,
                    this._isDirty = !0,
                    this._meshesWithPoseMatrix = new Array,
                    this._identity = e.Matrix.Identity(),
                    this._ranges = {},
                    this._lastAbsoluteTransformsUpdateId = -1,
                    this.doNotSerialize = !1,
                    this._animationPropertiesOverride = null,
                    this.onBeforeComputeObservable = new e.Observable,
                    this.bones = [],
                    this._scene = i || e.Engine.LastCreatedScene,
                    i.skeletons.push(this),
                    this._isDirty = !0
                }
                return Object.defineProperty(t.prototype, "animationPropertiesOverride", {
                    get: function() {
                        return this._animationPropertiesOverride ? this._animationPropertiesOverride : this._scene.animationPropertiesOverride
                    },
                    set: function(e) {
                        this._animationPropertiesOverride = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getTransformMatrices = function(e) {
                    return this.needInitialSkinMatrix && e._bonesTransformMatrices ? e._bonesTransformMatrices : (this._transformMatrices || this.prepare(),
                    this._transformMatrices)
                }
                ,
                t.prototype.getScene = function() {
                    return this._scene
                }
                ,
                t.prototype.toString = function(e) {
                    var t = "Name: " + this.name + ", nBones: " + this.bones.length;
                    if (t += ", nAnimationRanges: " + (this._ranges ? Object.keys(this._ranges).length : "none"),
                    e) {
                        t += ", Ranges: {";
                        var r = !0;
                        for (var i in this._ranges)
                            r && (t += ", ",
                            r = !1),
                            t += i;
                        t += "}"
                    }
                    return t
                }
                ,
                t.prototype.getBoneIndexByName = function(e) {
                    for (var t = 0, r = this.bones.length; t < r; t++)
                        if (this.bones[t].name === e)
                            return t;
                    return -1
                }
                ,
                t.prototype.createAnimationRange = function(t, r, i) {
                    if (!this._ranges[t]) {
                        this._ranges[t] = new e.AnimationRange(t,r,i);
                        for (var n = 0, o = this.bones.length; n < o; n++)
                            this.bones[n].animations[0] && this.bones[n].animations[0].createRange(t, r, i)
                    }
                }
                ,
                t.prototype.deleteAnimationRange = function(e, t) {
                    void 0 === t && (t = !0);
                    for (var r = 0, i = this.bones.length; r < i; r++)
                        this.bones[r].animations[0] && this.bones[r].animations[0].deleteRange(e, t);
                    this._ranges[e] = null
                }
                ,
                t.prototype.getAnimationRange = function(e) {
                    return this._ranges[e]
                }
                ,
                t.prototype.getAnimationRanges = function() {
                    var e, t = [], r = 0;
                    for (e in this._ranges)
                        t[r] = this._ranges[e],
                        r++;
                    return t
                }
                ,
                t.prototype.copyAnimationRange = function(t, r, i) {
                    if (void 0 === i && (i = !1),
                    this._ranges[r] || !t.getAnimationRange(r))
                        return !1;
                    var n, o, a = !0, s = this._getHighestAnimationFrame() + 1, y = {}, l = t.bones;
                    for (o = 0,
                    n = l.length; o < n; o++)
                        y[l[o].name] = l[o];
                    this.bones.length !== l.length && (e.Tools.Warn("copyAnimationRange: this rig has " + this.bones.length + " bones, while source as " + l.length),
                    a = !1);
                    var c = i && this.dimensionsAtRest && t.dimensionsAtRest ? this.dimensionsAtRest.divide(t.dimensionsAtRest) : null;
                    for (o = 0,
                    n = this.bones.length; o < n; o++) {
                        var h = this.bones[o].name
                          , u = y[h];
                        u ? a = a && this.bones[o].copyAnimationRange(u, r, s, i, c) : (e.Tools.Warn("copyAnimationRange: not same rig, missing source bone " + h),
                        a = !1)
                    }
                    var d = t.getAnimationRange(r);
                    return d && (this._ranges[r] = new e.AnimationRange(r,d.from + s,d.to + s)),
                    a
                }
                ,
                t.prototype.returnToRest = function() {
                    for (var e = 0; e < this.bones.length; e++)
                        this.bones[e].returnToRest()
                }
                ,
                t.prototype._getHighestAnimationFrame = function() {
                    for (var e = 0, t = 0, r = this.bones.length; t < r; t++)
                        if (this.bones[t].animations[0]) {
                            var i = this.bones[t].animations[0].getHighestFrame();
                            e < i && (e = i)
                        }
                    return e
                }
                ,
                t.prototype.beginAnimation = function(e, t, r, i) {
                    var n = this.getAnimationRange(e);
                    return n ? this._scene.beginAnimation(this, n.from, n.to, t, r, i) : null
                }
                ,
                t.prototype._markAsDirty = function() {
                    this._isDirty = !0
                }
                ,
                t.prototype._registerMeshWithPoseMatrix = function(e) {
                    this._meshesWithPoseMatrix.push(e)
                }
                ,
                t.prototype._unregisterMeshWithPoseMatrix = function(e) {
                    var t = this._meshesWithPoseMatrix.indexOf(e);
                    t > -1 && this._meshesWithPoseMatrix.splice(t, 1)
                }
                ,
                t.prototype._computeTransformMatrices = function(e, t) {
                    this.onBeforeComputeObservable.notifyObservers(this);
                    for (var r = 0; r < this.bones.length; r++) {
                        var i = this.bones[r]
                          , n = i.getParent();
                        if (n ? i.getLocalMatrix().multiplyToRef(n.getWorldMatrix(), i.getWorldMatrix()) : t ? i.getLocalMatrix().multiplyToRef(t, i.getWorldMatrix()) : i.getWorldMatrix().copyFrom(i.getLocalMatrix()),
                        -1 !== i._index) {
                            var o = null === i._index ? r : i._index;
                            i.getInvertedAbsoluteTransform().multiplyToArray(i.getWorldMatrix(), e, 16 * o)
                        }
                    }
                    this._identity.copyToArray(e, 16 * this.bones.length)
                }
                ,
                t.prototype.prepare = function() {
                    if (this._isDirty) {
                        if (this.needInitialSkinMatrix)
                            for (var t = 0; t < this._meshesWithPoseMatrix.length; t++) {
                                var r = this._meshesWithPoseMatrix[t]
                                  , i = r.getPoseMatrix();
                                if (r._bonesTransformMatrices && r._bonesTransformMatrices.length === 16 * (this.bones.length + 1) || (r._bonesTransformMatrices = new Float32Array(16 * (this.bones.length + 1))),
                                this._synchronizedWithMesh !== r) {
                                    this._synchronizedWithMesh = r;
                                    for (var n = 0; n < this.bones.length; n++) {
                                        var o = this.bones[n];
                                        if (!o.getParent())
                                            o.getBaseMatrix().multiplyToRef(i, e.Tmp.Matrix[1]),
                                            o._updateDifferenceMatrix(e.Tmp.Matrix[1])
                                    }
                                }
                                this._computeTransformMatrices(r._bonesTransformMatrices, i)
                            }
                        else
                            this._transformMatrices && this._transformMatrices.length === 16 * (this.bones.length + 1) || (this._transformMatrices = new Float32Array(16 * (this.bones.length + 1))),
                            this._computeTransformMatrices(this._transformMatrices, null);
                        this._isDirty = !1,
                        this._scene._activeBones.addCount(this.bones.length, !1)
                    }
                }
                ,
                t.prototype.getAnimatables = function() {
                    if (!this._animatables || this._animatables.length !== this.bones.length) {
                        this._animatables = [];
                        for (var e = 0; e < this.bones.length; e++)
                            this._animatables.push(this.bones[e])
                    }
                    return this._animatables
                }
                ,
                t.prototype.clone = function(r, i) {
                    var n = new t(r,i || r,this._scene);
                    n.needInitialSkinMatrix = this.needInitialSkinMatrix;
                    for (var o = 0; o < this.bones.length; o++) {
                        var a = this.bones[o]
                          , s = null
                          , y = a.getParent();
                        if (y) {
                            var l = this.bones.indexOf(y);
                            s = n.bones[l]
                        }
                        var c = new e.Bone(a.name,n,s,a.getBaseMatrix().clone(),a.getRestPose().clone());
                        e.Tools.DeepCopy(a.animations, c.animations)
                    }
                    if (this._ranges)
                        for (var h in n._ranges = {},
                        this._ranges) {
                            var u = this._ranges[h];
                            u && (n._ranges[h] = u.clone())
                        }
                    return this._isDirty = !0,
                    n
                }
                ,
                t.prototype.enableBlending = function(e) {
                    void 0 === e && (e = .01),
                    this.bones.forEach((function(t) {
                        t.animations.forEach((function(t) {
                            t.enableBlending = !0,
                            t.blendingSpeed = e
                        }
                        ))
                    }
                    ))
                }
                ,
                t.prototype.dispose = function() {
                    this._meshesWithPoseMatrix = [],
                    this.getScene().stopAnimation(this),
                    this.getScene().removeSkeleton(this)
                }
                ,
                t.prototype.serialize = function() {
                    var e = {};
                    e.name = this.name,
                    e.id = this.id,
                    this.dimensionsAtRest && (e.dimensionsAtRest = this.dimensionsAtRest.asArray()),
                    e.bones = [],
                    e.needInitialSkinMatrix = this.needInitialSkinMatrix;
                    for (var t = 0; t < this.bones.length; t++) {
                        var r = this.bones[t]
                          , i = r.getParent()
                          , n = {
                            parentBoneIndex: i ? this.bones.indexOf(i) : -1,
                            name: r.name,
                            matrix: r.getBaseMatrix().toArray(),
                            rest: r.getRestPose().toArray()
                        };
                        for (var o in e.bones.push(n),
                        r.length && (n.length = r.length),
                        r.metadata && (n.metadata = r.metadata),
                        r.animations && r.animations.length > 0 && (n.animation = r.animations[0].serialize()),
                        e.ranges = [],
                        this._ranges) {
                            var a = this._ranges[o];
                            if (a) {
                                var s = {};
                                s.name = o,
                                s.from = a.from,
                                s.to = a.to,
                                e.ranges.push(s)
                            }
                        }
                    }
                    return e
                }
                ,
                t.Parse = function(r, i) {
                    var n, o = new t(r.name,r.id,i);
                    for (r.dimensionsAtRest && (o.dimensionsAtRest = e.Vector3.FromArray(r.dimensionsAtRest)),
                    o.needInitialSkinMatrix = r.needInitialSkinMatrix,
                    n = 0; n < r.bones.length; n++) {
                        var a = r.bones[n]
                          , s = null;
                        a.parentBoneIndex > -1 && (s = o.bones[a.parentBoneIndex]);
                        var y = a.rest ? e.Matrix.FromArray(a.rest) : null
                          , l = new e.Bone(a.name,o,s,e.Matrix.FromArray(a.matrix),y);
                        void 0 !== a.id && null !== a.id && (l.id = a.id),
                        a.length && (l.length = a.length),
                        a.metadata && (l.metadata = a.metadata),
                        a.animation && l.animations.push(e.Animation.Parse(a.animation))
                    }
                    if (r.ranges)
                        for (n = 0; n < r.ranges.length; n++) {
                            var c = r.ranges[n];
                            o.createAnimationRange(c.name, c.from, c.to)
                        }
                    return o
                }
                ,
                t.prototype.computeAbsoluteTransforms = function(e) {
                    void 0 === e && (e = !1);
                    var t = this._scene.getRenderId();
                    (this._lastAbsoluteTransformsUpdateId != t || e) && (this.bones[0].computeAbsoluteTransforms(),
                    this._lastAbsoluteTransformsUpdateId = t)
                }
                ,
                t.prototype.getPoseMatrix = function() {
                    var e = null;
                    return this._meshesWithPoseMatrix.length > 0 && (e = this._meshesWithPoseMatrix[0].getPoseMatrix()),
                    e
                }
                ,
                t.prototype.sortBones = function() {
                    for (var e = new Array, t = new Array(this.bones.length), r = 0; r < this.bones.length; r++)
                        this._sortBones(r, e, t);
                    this.bones = e
                }
                ,
                t.prototype._sortBones = function(e, t, r) {
                    if (!r[e]) {
                        r[e] = !0;
                        var i = this.bones[e];
                        void 0 === i._index && (i._index = e);
                        var n = i.getParent();
                        n && this._sortBones(this.bones.indexOf(n), t, r),
                        t.push(i)
                    }
                }
                ,
                t
            }();
            e.Skeleton = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.Ldexp = function(e, t) {
                    return t > 1023 ? e * Math.pow(2, 1023) * Math.pow(2, t - 1023) : t < -1074 ? e * Math.pow(2, -1074) * Math.pow(2, t + 1074) : e * Math.pow(2, t)
                }
                ,
                t.Rgbe2float = function(e, t, r, i, n, o) {
                    n > 0 ? (n = this.Ldexp(1, n - 136),
                    e[o + 0] = t * n,
                    e[o + 1] = r * n,
                    e[o + 2] = i * n) : (e[o + 0] = 0,
                    e[o + 1] = 0,
                    e[o + 2] = 0)
                }
                ,
                t.readStringLine = function(e, t) {
                    for (var r = "", i = "", n = t; n < e.length - t && "\n" != (i = String.fromCharCode(e[n])); n++)
                        r += i;
                    return r
                }
                ,
                t.RGBE_ReadHeader = function(e) {
                    var t, r, i = this.readStringLine(e, 0);
                    if ("#" != i[0] || "?" != i[1])
                        throw "Bad HDR Format.";
                    var n = !1
                      , o = !1
                      , a = 0;
                    do {
                        a += i.length + 1,
                        "FORMAT=32-bit_rle_rgbe" == (i = this.readStringLine(e, a)) ? o = !0 : 0 == i.length && (n = !0)
                    } while (!n);if (!o)
                        throw "HDR Bad header format, unsupported FORMAT";
                    a += i.length + 1,
                    i = this.readStringLine(e, a);
                    var s = /^\-Y (.*) \+X (.*)$/g.exec(i);
                    if (!s || s.length < 3)
                        throw "HDR Bad header format, no size";
                    if (r = parseInt(s[2]),
                    t = parseInt(s[1]),
                    r < 8 || r > 32767)
                        throw "HDR Bad header format, unsupported size";
                    return {
                        height: t,
                        width: r,
                        dataPosition: a += i.length + 1
                    }
                }
                ,
                t.GetCubeMapTextureData = function(t, r) {
                    var i = new Uint8Array(t)
                      , n = this.RGBE_ReadHeader(i)
                      , o = this.RGBE_ReadPixels_RLE(i, n);
                    return e.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(o, n.width, n.height, r)
                }
                ,
                t.RGBE_ReadPixels = function(e, t) {
                    return this.RGBE_ReadPixels_RLE(e, t)
                }
                ,
                t.RGBE_ReadPixels_RLE = function(e, t) {
                    for (var r, i, n, o, a, s = t.height, y = t.width, l = t.dataPosition, c = 0, h = 0, u = 0, d = new ArrayBuffer(4 * y), x = new Uint8Array(d), p = new ArrayBuffer(t.width * t.height * 4 * 3), f = new Float32Array(p); s > 0; ) {
                        if (r = e[l++],
                        i = e[l++],
                        n = e[l++],
                        o = e[l++],
                        2 != r || 2 != i || 128 & n)
                            throw "HDR Bad header format, not RLE";
                        if ((n << 8 | o) != y)
                            throw "HDR Bad header format, wrong scan line width";
                        for (c = 0,
                        u = 0; u < 4; u++)
                            for (h = (u + 1) * y; c < h; )
                                if (r = e[l++],
                                i = e[l++],
                                r > 128) {
                                    if (0 == (a = r - 128) || a > h - c)
                                        throw "HDR Bad Format, bad scanline data (run)";
                                    for (; a-- > 0; )
                                        x[c++] = i
                                } else {
                                    if (0 == (a = r) || a > h - c)
                                        throw "HDR Bad Format, bad scanline data (non-run)";
                                    if (x[c++] = i,
                                    --a > 0)
                                        for (var m = 0; m < a; m++)
                                            x[c++] = e[l++]
                                }
                        for (u = 0; u < y; u++)
                            r = x[u],
                            i = x[u + y],
                            n = x[u + 2 * y],
                            o = x[u + 3 * y],
                            this.Rgbe2float(f, r, i, n, o, (t.height - s) * y * 3 + 3 * u);
                        s--
                    }
                    return f
                }
                ,
                t
            }();
            e.HDRTools = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l, c) {
                    void 0 === o && (o = !1),
                    void 0 === a && (a = !0),
                    void 0 === s && (s = !1),
                    void 0 === y && (y = !1),
                    void 0 === l && (l = null),
                    void 0 === c && (c = null);
                    var h = t.call(this, i) || this;
                    return h._generateHarmonics = !0,
                    h._onLoad = null,
                    h._onError = null,
                    h.coordinatesMode = e.Texture.CUBIC_MODE,
                    h._isBlocking = !0,
                    h._rotationY = 0,
                    h.boundingBoxPosition = e.Vector3.Zero(),
                    r ? (h.name = r,
                    h.url = r,
                    h.hasAlpha = !1,
                    h.isCube = !0,
                    h._textureMatrix = e.Matrix.Identity(),
                    h._onLoad = l,
                    h._onError = c,
                    h.gammaSpace = s,
                    h._noMipmap = o,
                    h._size = n,
                    h._texture = h._getFromCache(r, h._noMipmap),
                    h._texture || (i.useDelayedTextureLoading ? h.delayLoadState = e.Engine.DELAYLOADSTATE_NOTLOADED : h.loadTexture()),
                    h) : h
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "isBlocking", {
                    get: function() {
                        return this._isBlocking
                    },
                    set: function(e) {
                        this._isBlocking = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "rotationY", {
                    get: function() {
                        return this._rotationY
                    },
                    set: function(t) {
                        this._rotationY = t,
                        this.setReflectionTextureMatrix(e.Matrix.RotationY(this._rotationY))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "boundingBoxSize", {
                    get: function() {
                        return this._boundingBoxSize
                    },
                    set: function(t) {
                        if (!this._boundingBoxSize || !this._boundingBoxSize.equals(t)) {
                            this._boundingBoxSize = t;
                            var r = this.getScene();
                            r && r.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag)
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.loadTexture = function() {
                    var t = this
                      , i = this.getScene();
                    i && (this._texture = i.getEngine().createRawCubeTextureFromUrl(this.url, i, this._size, e.Engine.TEXTUREFORMAT_RGB, i.getEngine().getCaps().textureFloat ? e.Engine.TEXTURETYPE_FLOAT : e.Engine.TEXTURETYPE_UNSIGNED_INT, this._noMipmap, (function(i) {
                        t.lodGenerationOffset = 0,
                        t.lodGenerationScale = .8;
                        var n = t.getScene();
                        if (!n)
                            return null;
                        var o = e.HDRTools.GetCubeMapTextureData(i, t._size);
                        if (t._generateHarmonics) {
                            var a = e.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(o);
                            t.sphericalPolynomial = a
                        }
                        for (var s = [], y = null, l = 0; l < 6; l++) {
                            if (!n.getEngine().getCaps().textureFloat) {
                                var c = new ArrayBuffer(t._size * t._size * 3);
                                y = new Uint8Array(c)
                            }
                            var h = o[r._facesMapping[l]];
                            if (t.gammaSpace || y)
                                for (var u = 0; u < t._size * t._size; u++)
                                    if (t.gammaSpace && (h[3 * u + 0] = Math.pow(h[3 * u + 0], e.ToGammaSpace),
                                    h[3 * u + 1] = Math.pow(h[3 * u + 1], e.ToGammaSpace),
                                    h[3 * u + 2] = Math.pow(h[3 * u + 2], e.ToGammaSpace)),
                                    y) {
                                        var d = Math.max(255 * h[3 * u + 0], 0)
                                          , x = Math.max(255 * h[3 * u + 1], 0)
                                          , p = Math.max(255 * h[3 * u + 2], 0)
                                          , f = Math.max(Math.max(d, x), p);
                                        if (f > 255) {
                                            var m = 255 / f;
                                            d *= m,
                                            x *= m,
                                            p *= m
                                        }
                                        y[3 * u + 0] = d,
                                        y[3 * u + 1] = x,
                                        y[3 * u + 2] = p
                                    }
                            y ? s.push(y) : s.push(h)
                        }
                        return s
                    }
                    ), null, this._onLoad, this._onError))
                }
                ,
                r.prototype.clone = function() {
                    var e = this.getScene();
                    if (!e)
                        return this;
                    var t = new r(this.url,e,this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);
                    return t.level = this.level,
                    t.wrapU = this.wrapU,
                    t.wrapV = this.wrapV,
                    t.coordinatesIndex = this.coordinatesIndex,
                    t.coordinatesMode = this.coordinatesMode,
                    t
                }
                ,
                r.prototype.delayLoad = function() {
                    this.delayLoadState === e.Engine.DELAYLOADSTATE_NOTLOADED && (this.delayLoadState = e.Engine.DELAYLOADSTATE_LOADED,
                    this._texture = this._getFromCache(this.url, this._noMipmap),
                    this._texture || this.loadTexture())
                }
                ,
                r.prototype.getReflectionTextureMatrix = function() {
                    return this._textureMatrix
                }
                ,
                r.prototype.setReflectionTextureMatrix = function(e) {
                    this._textureMatrix = e
                }
                ,
                r.Parse = function(t, i, n) {
                    var o = null;
                    return t.name && !t.isRenderTarget && ((o = new r(n + t.name,i,t.size,t.noMipmap,t.generateHarmonics,t.useInGammaSpace)).name = t.name,
                    o.hasAlpha = t.hasAlpha,
                    o.level = t.level,
                    o.coordinatesMode = t.coordinatesMode,
                    o.isBlocking = t.isBlocking),
                    o && (t.boundingBoxPosition && (o.boundingBoxPosition = e.Vector3.FromArray(t.boundingBoxPosition)),
                    t.boundingBoxSize && (o.boundingBoxSize = e.Vector3.FromArray(t.boundingBoxSize)),
                    t.rotationY && (o.rotationY = t.rotationY)),
                    o
                }
                ,
                r.prototype.serialize = function() {
                    if (!this.name)
                        return null;
                    var e = {};
                    return e.name = this.name,
                    e.hasAlpha = this.hasAlpha,
                    e.isCube = !0,
                    e.level = this.level,
                    e.size = this._size,
                    e.coordinatesMode = this.coordinatesMode,
                    e.useInGammaSpace = this.gammaSpace,
                    e.generateHarmonics = this._generateHarmonics,
                    e.customType = "BABYLON.HDRCubeTexture",
                    e.noMipmap = this._noMipmap,
                    e.isBlocking = this._isBlocking,
                    e.rotationY = this._rotationY,
                    e
                }
                ,
                r._facesMapping = ["right", "left", "up", "down", "front", "back"],
                r
            }(e.BaseTexture);
            e.HDRCubeTexture = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.ConvertPanoramaToCubemap = function(t, r, i, n) {
                    if (!t)
                        throw "ConvertPanoramaToCubemap: input cannot be null";
                    if (t.length != r * i * 3)
                        throw "ConvertPanoramaToCubemap: input size is wrong";
                    return {
                        front: this.CreateCubemapTexture(n, this.FACE_FRONT, t, r, i),
                        back: this.CreateCubemapTexture(n, this.FACE_BACK, t, r, i),
                        left: this.CreateCubemapTexture(n, this.FACE_LEFT, t, r, i),
                        right: this.CreateCubemapTexture(n, this.FACE_RIGHT, t, r, i),
                        up: this.CreateCubemapTexture(n, this.FACE_UP, t, r, i),
                        down: this.CreateCubemapTexture(n, this.FACE_DOWN, t, r, i),
                        size: n,
                        type: e.Engine.TEXTURETYPE_FLOAT,
                        format: e.Engine.TEXTUREFORMAT_RGB,
                        gammaSpace: !1
                    }
                }
                ,
                t.CreateCubemapTexture = function(e, t, r, i, n) {
                    for (var o = new ArrayBuffer(e * e * 4 * 3), a = new Float32Array(o), s = t[1].subtract(t[0]).scale(1 / e), y = t[3].subtract(t[2]).scale(1 / e), l = 1 / e, c = 0, h = 0; h < e; h++) {
                        for (var u = t[0], d = t[2], x = 0; x < e; x++) {
                            var p = d.subtract(u).scale(c).add(u);
                            p.normalize();
                            var f = this.CalcProjectionSpherical(p, r, i, n);
                            a[h * e * 3 + 3 * x + 0] = f.r,
                            a[h * e * 3 + 3 * x + 1] = f.g,
                            a[h * e * 3 + 3 * x + 2] = f.b,
                            u = u.add(s),
                            d = d.add(y)
                        }
                        c += l
                    }
                    return a
                }
                ,
                t.CalcProjectionSpherical = function(e, t, r, i) {
                    for (var n = Math.atan2(e.z, e.x), o = Math.acos(e.y); n < -Math.PI; )
                        n += 2 * Math.PI;
                    for (; n > Math.PI; )
                        n -= 2 * Math.PI;
                    var a = n / Math.PI
                      , s = o / Math.PI;
                    a = .5 * a + .5;
                    var y = Math.round(a * r);
                    y < 0 ? y = 0 : y >= r && (y = r - 1);
                    var l = Math.round(s * i);
                    l < 0 ? l = 0 : l >= i && (l = i - 1);
                    var c = i - l - 1;
                    return {
                        r: t[c * r * 3 + 3 * y + 0],
                        g: t[c * r * 3 + 3 * y + 1],
                        b: t[c * r * 3 + 3 * y + 2]
                    }
                }
                ,
                t.FACE_FRONT = [new e.Vector3(-1,-1,-1), new e.Vector3(1,-1,-1), new e.Vector3(-1,1,-1), new e.Vector3(1,1,-1)],
                t.FACE_BACK = [new e.Vector3(1,-1,1), new e.Vector3(-1,-1,1), new e.Vector3(1,1,1), new e.Vector3(-1,1,1)],
                t.FACE_RIGHT = [new e.Vector3(1,-1,-1), new e.Vector3(1,-1,1), new e.Vector3(1,1,-1), new e.Vector3(1,1,1)],
                t.FACE_LEFT = [new e.Vector3(-1,-1,1), new e.Vector3(-1,-1,-1), new e.Vector3(-1,1,1), new e.Vector3(-1,1,-1)],
                t.FACE_DOWN = [new e.Vector3(-1,1,-1), new e.Vector3(1,1,-1), new e.Vector3(-1,1,1), new e.Vector3(1,1,1)],
                t.FACE_UP = [new e.Vector3(-1,-1,1), new e.Vector3(1,-1,1), new e.Vector3(-1,-1,-1), new e.Vector3(1,-1,-1)],
                t
            }();
            e.PanoramaToCubeMapTools = t
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t(t, r) {
                    var i = e.call(this, t.x, t.y) || this;
                    return i.index = r,
                    i
                }
                return o(t, e),
                t
            }(e.Vector2)
              , i = function() {
                function r() {
                    this.elements = new Array
                }
                return r.prototype.add = function(e) {
                    var r = this
                      , i = new Array;
                    return e.forEach((function(e) {
                        if (0 === i.length || !e.equalsWithEpsilon(i[0])) {
                            var n = new t(e,r.elements.length);
                            i.push(n),
                            r.elements.push(n)
                        }
                    }
                    )),
                    i
                }
                ,
                r.prototype.computeBounds = function() {
                    var t = new e.Vector2(this.elements[0].x,this.elements[0].y)
                      , r = new e.Vector2(this.elements[0].x,this.elements[0].y);
                    return this.elements.forEach((function(e) {
                        e.x < t.x ? t.x = e.x : e.x > r.x && (r.x = e.x),
                        e.y < t.y ? t.y = e.y : e.y > r.y && (r.y = e.y)
                    }
                    )),
                    {
                        min: t,
                        max: r,
                        width: r.x - t.x,
                        height: r.y - t.y
                    }
                }
                ,
                r
            }()
              , n = function() {
                function t() {}
                return t.Rectangle = function(t, r, i, n) {
                    return [new e.Vector2(t,r), new e.Vector2(i,r), new e.Vector2(i,n), new e.Vector2(t,n)]
                }
                ,
                t.Circle = function(t, r, i, n) {
                    void 0 === r && (r = 0),
                    void 0 === i && (i = 0),
                    void 0 === n && (n = 32);
                    for (var o = new Array, a = 0, s = 2 * Math.PI / n, y = 0; y < n; y++)
                        o.push(new e.Vector2(r + Math.cos(a) * t,i + Math.sin(a) * t)),
                        a -= s;
                    return o
                }
                ,
                t.Parse = function(t) {
                    var r, i = t.split(/[^-+eE\.\d]+/).map(parseFloat).filter((function(e) {
                        return !isNaN(e)
                    }
                    )), n = [];
                    for (r = 0; r < (2147483646 & i.length); r += 2)
                        n.push(new e.Vector2(i[r],i[r + 1]));
                    return n
                }
                ,
                t.StartingAt = function(t, r) {
                    return e.Path2.StartingAt(t, r)
                }
                ,
                t
            }();
            e.Polygon = n;
            var a = function() {
                function t(t, n, o) {
                    var a;
                    this._points = new i,
                    this._outlinepoints = new i,
                    this._holes = new Array,
                    this._epoints = new Array,
                    this._eholes = new Array,
                    this._name = t,
                    this._scene = o,
                    a = n instanceof e.Path2 ? n.getPoints() : n,
                    this._addToepoint(a),
                    this._points.add(a),
                    this._outlinepoints.add(a),
                    void 0 === r && e.Tools.Warn("Earcut was not found, the polygon will not be built.")
                }
                return t.prototype._addToepoint = function(e) {
                    for (var t = 0, r = e; t < r.length; t++) {
                        var i = r[t];
                        this._epoints.push(i.x, i.y)
                    }
                }
                ,
                t.prototype.addHole = function(e) {
                    this._points.add(e);
                    var t = new i;
                    return t.add(e),
                    this._holes.push(t),
                    this._eholes.push(this._epoints.length / 2),
                    this._addToepoint(e),
                    this
                }
                ,
                t.prototype.build = function(t, i) {
                    var n = this;
                    void 0 === t && (t = !1),
                    void 0 === i && (i = 0);
                    var o = new e.Mesh(this._name,this._scene)
                      , a = new Array
                      , s = new Array
                      , y = new Array
                      , l = this._points.computeBounds();
                    this._points.elements.forEach((function(e) {
                        a.push(0, 1, 0),
                        s.push(e.x, 0, e.y),
                        y.push((e.x - l.min.x) / l.width, (e.y - l.min.y) / l.height)
                    }
                    ));
                    for (var c = new Array, h = r(this._epoints, this._eholes, 2), u = 0; u < h.length; u++)
                        c.push(h[u]);
                    if (i > 0) {
                        var d = s.length / 3;
                        this._points.elements.forEach((function(e) {
                            a.push(0, -1, 0),
                            s.push(e.x, -i, e.y),
                            y.push(1 - (e.x - l.min.x) / l.width, 1 - (e.y - l.min.y) / l.height)
                        }
                        ));
                        var x = c.length;
                        for (u = 0; u < x; u += 3) {
                            var p = c[u + 0]
                              , f = c[u + 1]
                              , m = c[u + 2];
                            c.push(m + d),
                            c.push(f + d),
                            c.push(p + d)
                        }
                        this.addSide(s, a, y, c, l, this._outlinepoints, i, !1),
                        this._holes.forEach((function(e) {
                            n.addSide(s, a, y, c, l, e, i, !0)
                        }
                        ))
                    }
                    return o.setVerticesData(e.VertexBuffer.PositionKind, s, t),
                    o.setVerticesData(e.VertexBuffer.NormalKind, a, t),
                    o.setVerticesData(e.VertexBuffer.UVKind, y, t),
                    o.setIndices(c),
                    o
                }
                ,
                t.prototype.addSide = function(t, r, i, n, o, a, s, y) {
                    for (var l = t.length / 3, c = 0, h = 0; h < a.elements.length; h++) {
                        var u, d = a.elements[h];
                        u = h + 1 > a.elements.length - 1 ? a.elements[0] : a.elements[h + 1],
                        t.push(d.x, 0, d.y),
                        t.push(d.x, -s, d.y),
                        t.push(u.x, 0, u.y),
                        t.push(u.x, -s, u.y);
                        var x = new e.Vector3(d.x,0,d.y)
                          , p = new e.Vector3(u.x,0,u.y).subtract(x)
                          , f = new e.Vector3(0,1,0)
                          , m = e.Vector3.Cross(p, f);
                        m = m.normalize(),
                        i.push(c / o.width, 0),
                        i.push(c / o.width, 1),
                        c += p.length(),
                        i.push(c / o.width, 0),
                        i.push(c / o.width, 1),
                        y ? (r.push(m.x, m.y, m.z),
                        r.push(m.x, m.y, m.z),
                        r.push(m.x, m.y, m.z),
                        r.push(m.x, m.y, m.z),
                        n.push(l),
                        n.push(l + 2),
                        n.push(l + 1),
                        n.push(l + 1),
                        n.push(l + 2),
                        n.push(l + 3)) : (r.push(-m.x, -m.y, -m.z),
                        r.push(-m.x, -m.y, -m.z),
                        r.push(-m.x, -m.y, -m.z),
                        r.push(-m.x, -m.y, -m.z),
                        n.push(l),
                        n.push(l + 1),
                        n.push(l + 2),
                        n.push(l + 1),
                        n.push(l + 3),
                        n.push(l + 2)),
                        l += 4
                    }
                }
                ,
                t
            }();
            e.PolygonMeshBuilder = a
        }(s || (s = {})),
        function(e) {
            var t = 0
              , r = function() {
                function t(e, t, r) {
                    this.pos = e,
                    this.normal = t,
                    this.uv = r
                }
                return t.prototype.clone = function() {
                    return new t(this.pos.clone(),this.normal.clone(),this.uv.clone())
                }
                ,
                t.prototype.flip = function() {
                    this.normal = this.normal.scale(-1)
                }
                ,
                t.prototype.interpolate = function(r, i) {
                    return new t(e.Vector3.Lerp(this.pos, r.pos, i),e.Vector3.Lerp(this.normal, r.normal, i),e.Vector2.Lerp(this.uv, r.uv, i))
                }
                ,
                t
            }()
              , i = function() {
                function t(e, t) {
                    this.normal = e,
                    this.w = t
                }
                return t.FromPoints = function(r, i, n) {
                    var o = n.subtract(r)
                      , a = i.subtract(r);
                    if (0 === o.lengthSquared() || 0 === a.lengthSquared())
                        return null;
                    var s = e.Vector3.Normalize(e.Vector3.Cross(o, a));
                    return new t(s,e.Vector3.Dot(s, r))
                }
                ,
                t.prototype.clone = function() {
                    return new t(this.normal.clone(),this.w)
                }
                ,
                t.prototype.flip = function() {
                    this.normal.scaleInPlace(-1),
                    this.w = -this.w
                }
                ,
                t.prototype.splitPolygon = function(r, i, o, a, s) {
                    var y, l, c = 0, h = [];
                    for (y = 0; y < r.vertices.length; y++) {
                        var u = (l = e.Vector3.Dot(this.normal, r.vertices[y].pos) - this.w) < -t.EPSILON ? 2 : l > t.EPSILON ? 1 : 0;
                        c |= u,
                        h.push(u)
                    }
                    switch (c) {
                    case 0:
                        (e.Vector3.Dot(this.normal, r.plane.normal) > 0 ? i : o).push(r);
                        break;
                    case 1:
                        a.push(r);
                        break;
                    case 2:
                        s.push(r);
                        break;
                    case 3:
                        var d, x = [], p = [];
                        for (y = 0; y < r.vertices.length; y++) {
                            var f = (y + 1) % r.vertices.length
                              , m = h[y]
                              , z = h[f]
                              , _ = r.vertices[y]
                              , g = r.vertices[f];
                            if (2 !== m && x.push(_),
                            1 !== m && p.push(2 !== m ? _.clone() : _),
                            3 == (m | z)) {
                                l = (this.w - e.Vector3.Dot(this.normal, _.pos)) / e.Vector3.Dot(this.normal, g.pos.subtract(_.pos));
                                var v = _.interpolate(g, l);
                                x.push(v),
                                p.push(v.clone())
                            }
                        }
                        x.length >= 3 && (d = new n(x,r.shared)).plane && a.push(d),
                        p.length >= 3 && (d = new n(p,r.shared)).plane && s.push(d)
                    }
                }
                ,
                t.EPSILON = 1e-5,
                t
            }()
              , n = function() {
                function e(e, t) {
                    this.vertices = e,
                    this.shared = t,
                    this.plane = i.FromPoints(e[0].pos, e[1].pos, e[2].pos)
                }
                return e.prototype.clone = function() {
                    return new e(this.vertices.map((function(e) {
                        return e.clone()
                    }
                    )),this.shared)
                }
                ,
                e.prototype.flip = function() {
                    this.vertices.reverse().map((function(e) {
                        e.flip()
                    }
                    )),
                    this.plane.flip()
                }
                ,
                e
            }()
              , o = function() {
                function e(e) {
                    this.plane = null,
                    this.front = null,
                    this.back = null,
                    this.polygons = new Array,
                    e && this.build(e)
                }
                return e.prototype.clone = function() {
                    var t = new e;
                    return t.plane = this.plane && this.plane.clone(),
                    t.front = this.front && this.front.clone(),
                    t.back = this.back && this.back.clone(),
                    t.polygons = this.polygons.map((function(e) {
                        return e.clone()
                    }
                    )),
                    t
                }
                ,
                e.prototype.invert = function() {
                    for (var e = 0; e < this.polygons.length; e++)
                        this.polygons[e].flip();
                    this.plane && this.plane.flip(),
                    this.front && this.front.invert(),
                    this.back && this.back.invert();
                    var t = this.front;
                    this.front = this.back,
                    this.back = t
                }
                ,
                e.prototype.clipPolygons = function(e) {
                    if (!this.plane)
                        return e.slice();
                    for (var t = new Array, r = new Array, i = 0; i < e.length; i++)
                        this.plane.splitPolygon(e[i], t, r, t, r);
                    return this.front && (t = this.front.clipPolygons(t)),
                    r = this.back ? this.back.clipPolygons(r) : [],
                    t.concat(r)
                }
                ,
                e.prototype.clipTo = function(e) {
                    this.polygons = e.clipPolygons(this.polygons),
                    this.front && this.front.clipTo(e),
                    this.back && this.back.clipTo(e)
                }
                ,
                e.prototype.allPolygons = function() {
                    var e = this.polygons.slice();
                    return this.front && (e = e.concat(this.front.allPolygons())),
                    this.back && (e = e.concat(this.back.allPolygons())),
                    e
                }
                ,
                e.prototype.build = function(t) {
                    if (t.length) {
                        this.plane || (this.plane = t[0].plane.clone());
                        for (var r = new Array, i = new Array, n = 0; n < t.length; n++)
                            this.plane.splitPolygon(t[n], this.polygons, this.polygons, r, i);
                        r.length && (this.front || (this.front = new e),
                        this.front.build(r)),
                        i.length && (this.back || (this.back = new e),
                        this.back.build(i))
                    }
                }
                ,
                e
            }()
              , a = function() {
                function i() {
                    this.polygons = new Array
                }
                return i.FromMesh = function(o) {
                    var a, s, y, l, c, h, u, d, x, p, f = new Array, m = null;
                    if (!(o instanceof e.Mesh))
                        throw "BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";
                    o.computeWorldMatrix(!0),
                    u = o.getWorldMatrix(),
                    d = o.position.clone(),
                    x = o.rotation.clone(),
                    o.rotationQuaternion && (m = o.rotationQuaternion.clone()),
                    p = o.scaling.clone();
                    for (var z = o.getIndices(), _ = o.getVerticesData(e.VertexBuffer.PositionKind), g = o.getVerticesData(e.VertexBuffer.NormalKind), v = o.getVerticesData(e.VertexBuffer.UVKind), b = o.subMeshes, T = 0, E = b.length; T < E; T++)
                        for (var P = b[T].indexStart, A = b[T].indexCount + b[T].indexStart; P < A; P += 3) {
                            h = [];
                            for (var S = 0; S < 3; S++) {
                                var M = new e.Vector3(g[3 * z[P + S]],g[3 * z[P + S] + 1],g[3 * z[P + S] + 2]);
                                y = new e.Vector2(v[2 * z[P + S]],v[2 * z[P + S] + 1]);
                                var C = new e.Vector3(_[3 * z[P + S]],_[3 * z[P + S] + 1],_[3 * z[P + S] + 2]);
                                l = e.Vector3.TransformCoordinates(C, u),
                                s = e.Vector3.TransformNormal(M, u),
                                a = new r(l,s,y),
                                h.push(a)
                            }
                            (c = new n(h,{
                                subMeshId: T,
                                meshId: t,
                                materialIndex: b[T].materialIndex
                            })).plane && f.push(c)
                        }
                    var R = i.FromPolygons(f);
                    return R.matrix = u,
                    R.position = d,
                    R.rotation = x,
                    R.scaling = p,
                    R.rotationQuaternion = m,
                    t++,
                    R
                }
                ,
                i.FromPolygons = function(e) {
                    var t = new i;
                    return t.polygons = e,
                    t
                }
                ,
                i.prototype.clone = function() {
                    var e = new i;
                    return e.polygons = this.polygons.map((function(e) {
                        return e.clone()
                    }
                    )),
                    e.copyTransformAttributes(this),
                    e
                }
                ,
                i.prototype.union = function(e) {
                    var t = new o(this.clone().polygons)
                      , r = new o(e.clone().polygons);
                    return t.clipTo(r),
                    r.clipTo(t),
                    r.invert(),
                    r.clipTo(t),
                    r.invert(),
                    t.build(r.allPolygons()),
                    i.FromPolygons(t.allPolygons()).copyTransformAttributes(this)
                }
                ,
                i.prototype.unionInPlace = function(e) {
                    var t = new o(this.polygons)
                      , r = new o(e.polygons);
                    t.clipTo(r),
                    r.clipTo(t),
                    r.invert(),
                    r.clipTo(t),
                    r.invert(),
                    t.build(r.allPolygons()),
                    this.polygons = t.allPolygons()
                }
                ,
                i.prototype.subtract = function(e) {
                    var t = new o(this.clone().polygons)
                      , r = new o(e.clone().polygons);
                    return t.invert(),
                    t.clipTo(r),
                    r.clipTo(t),
                    r.invert(),
                    r.clipTo(t),
                    r.invert(),
                    t.build(r.allPolygons()),
                    t.invert(),
                    i.FromPolygons(t.allPolygons()).copyTransformAttributes(this)
                }
                ,
                i.prototype.subtractInPlace = function(e) {
                    var t = new o(this.polygons)
                      , r = new o(e.polygons);
                    t.invert(),
                    t.clipTo(r),
                    r.clipTo(t),
                    r.invert(),
                    r.clipTo(t),
                    r.invert(),
                    t.build(r.allPolygons()),
                    t.invert(),
                    this.polygons = t.allPolygons()
                }
                ,
                i.prototype.intersect = function(e) {
                    var t = new o(this.clone().polygons)
                      , r = new o(e.clone().polygons);
                    return t.invert(),
                    r.clipTo(t),
                    r.invert(),
                    t.clipTo(r),
                    r.clipTo(t),
                    t.build(r.allPolygons()),
                    t.invert(),
                    i.FromPolygons(t.allPolygons()).copyTransformAttributes(this)
                }
                ,
                i.prototype.intersectInPlace = function(e) {
                    var t = new o(this.polygons)
                      , r = new o(e.polygons);
                    t.invert(),
                    r.clipTo(t),
                    r.invert(),
                    t.clipTo(r),
                    r.clipTo(t),
                    t.build(r.allPolygons()),
                    t.invert(),
                    this.polygons = t.allPolygons()
                }
                ,
                i.prototype.inverse = function() {
                    var e = this.clone();
                    return e.inverseInPlace(),
                    e
                }
                ,
                i.prototype.inverseInPlace = function() {
                    this.polygons.map((function(e) {
                        e.flip()
                    }
                    ))
                }
                ,
                i.prototype.copyTransformAttributes = function(e) {
                    return this.matrix = e.matrix,
                    this.position = e.position,
                    this.rotation = e.rotation,
                    this.scaling = e.scaling,
                    this.rotationQuaternion = e.rotationQuaternion,
                    this
                }
                ,
                i.prototype.buildMeshGeometry = function(t, r, i) {
                    var n = this.matrix.clone();
                    n.invert();
                    var o, a, s, y = new e.Mesh(t,r), l = [], c = [], h = [], u = [], d = e.Vector3.Zero(), x = e.Vector3.Zero(), p = e.Vector2.Zero(), f = this.polygons, m = [0, 0, 0], z = {}, _ = 0, g = {};
                    i && f.sort((function(e, t) {
                        return e.shared.meshId === t.shared.meshId ? e.shared.subMeshId - t.shared.subMeshId : e.shared.meshId - t.shared.meshId
                    }
                    ));
                    for (var v = 0, b = f.length; v < b; v++) {
                        g[(o = f[v]).shared.meshId] || (g[o.shared.meshId] = {}),
                        g[o.shared.meshId][o.shared.subMeshId] || (g[o.shared.meshId][o.shared.subMeshId] = {
                            indexStart: 1 / 0,
                            indexEnd: -1 / 0,
                            materialIndex: o.shared.materialIndex
                        }),
                        s = g[o.shared.meshId][o.shared.subMeshId];
                        for (var T = 2, E = o.vertices.length; T < E; T++) {
                            m[0] = 0,
                            m[1] = T - 1,
                            m[2] = T;
                            for (var P = 0; P < 3; P++) {
                                d.copyFrom(o.vertices[m[P]].pos),
                                x.copyFrom(o.vertices[m[P]].normal),
                                p.copyFrom(o.vertices[m[P]].uv);
                                var A = e.Vector3.TransformCoordinates(d, n)
                                  , S = e.Vector3.TransformNormal(x, n);
                                void 0 !== (a = z[A.x + "," + A.y + "," + A.z]) && h[3 * a] === S.x && h[3 * a + 1] === S.y && h[3 * a + 2] === S.z && u[2 * a] === p.x && u[2 * a + 1] === p.y || (l.push(A.x, A.y, A.z),
                                u.push(p.x, p.y),
                                h.push(x.x, x.y, x.z),
                                a = z[A.x + "," + A.y + "," + A.z] = l.length / 3 - 1),
                                c.push(a),
                                s.indexStart = Math.min(_, s.indexStart),
                                s.indexEnd = Math.max(_, s.indexEnd),
                                _++
                            }
                        }
                    }
                    if (y.setVerticesData(e.VertexBuffer.PositionKind, l),
                    y.setVerticesData(e.VertexBuffer.NormalKind, h),
                    y.setVerticesData(e.VertexBuffer.UVKind, u),
                    y.setIndices(c, null),
                    i) {
                        var M, C = 0;
                        for (var R in y.subMeshes = new Array,
                        g) {
                            for (var O in M = -1,
                            g[R])
                                s = g[R][O],
                                e.SubMesh.CreateFromIndices(s.materialIndex + C, s.indexStart, s.indexEnd - s.indexStart + 1, y),
                                M = Math.max(s.materialIndex, M);
                            C += ++M
                        }
                    }
                    return y
                }
                ,
                i.prototype.toMesh = function(e, t, r, i) {
                    var n = this.buildMeshGeometry(e, r, i);
                    return n.material = t,
                    n.position.copyFrom(this.position),
                    n.rotation.copyFrom(this.rotation),
                    this.rotationQuaternion && (n.rotationQuaternion = this.rotationQuaternion.clone()),
                    n.scaling.copyFrom(this.scaling),
                    n.computeWorldMatrix(!0),
                    n
                }
                ,
                i
            }();
            e.CSG = a
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n, o) {
                    this.size = t,
                    this.position = r,
                    this.alphaMode = e.Engine.ALPHA_ONEONE,
                    this.color = i || new e.Color3(1,1,1),
                    this.texture = n ? new e.Texture(n,o.getScene(),!0) : null,
                    this._system = o,
                    o.lensFlares.push(this)
                }
                return t.AddFlare = function(e, r, i, n, o) {
                    return new t(e,r,i,n,o)
                }
                ,
                t.prototype.dispose = function() {
                    this.texture && this.texture.dispose();
                    var e = this._system.lensFlares.indexOf(this);
                    this._system.lensFlares.splice(e, 1)
                }
                ,
                t
            }();
            e.LensFlare = t
        }(s || (s = {})),
        function(e) {
            e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_LENSFLARESYSTEM, (function(t, r, i, n) {
                if (void 0 !== t.lensFlareSystems && null !== t.lensFlareSystems) {
                    i.lensFlareSystems || (i.lensFlareSystems = new Array);
                    for (var o = 0, a = t.lensFlareSystems.length; o < a; o++) {
                        var s = t.lensFlareSystems[o]
                          , y = e.LensFlareSystem.Parse(s, r, n);
                        i.lensFlareSystems.push(y)
                    }
                }
            }
            )),
            e.AbstractScene.prototype.getLensFlareSystemByName = function(e) {
                for (var t = 0; t < this.lensFlareSystems.length; t++)
                    if (this.lensFlareSystems[t].name === e)
                        return this.lensFlareSystems[t];
                return null
            }
            ,
            e.AbstractScene.prototype.getLensFlareSystemByID = function(e) {
                for (var t = 0; t < this.lensFlareSystems.length; t++)
                    if (this.lensFlareSystems[t].id === e)
                        return this.lensFlareSystems[t];
                return null
            }
            ,
            e.AbstractScene.prototype.removeLensFlareSystem = function(e) {
                var t = this.lensFlareSystems.indexOf(e);
                return -1 !== t && this.lensFlareSystems.splice(t, 1),
                t
            }
            ,
            e.AbstractScene.prototype.addLensFlareSystem = function(e) {
                this.lensFlareSystems.push(e)
            }
            ;
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_LENSFLARESYSTEM,
                    this.scene = t,
                    t.lensFlareSystems = new Array
                }
                return t.prototype.register = function() {
                    this.scene._afterCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM, this, this._draw)
                }
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.addFromContainer = function(e) {
                    var t = this;
                    e.lensFlareSystems && e.lensFlareSystems.forEach((function(e) {
                        t.scene.addLensFlareSystem(e)
                    }
                    ))
                }
                ,
                t.prototype.removeFromContainer = function(e) {
                    var t = this;
                    e.lensFlareSystems && e.lensFlareSystems.forEach((function(e) {
                        t.scene.removeLensFlareSystem(e)
                    }
                    ))
                }
                ,
                t.prototype.serialize = function(e) {
                    e.lensFlareSystems = [];
                    for (var t = 0, r = this.scene.lensFlareSystems; t < r.length; t++) {
                        var i = r[t];
                        e.lensFlareSystems.push(i.serialize())
                    }
                }
                ,
                t.prototype.dispose = function() {
                    for (var e = this.scene.lensFlareSystems; e.length; )
                        e[0].dispose()
                }
                ,
                t.prototype._draw = function(t) {
                    if (this.scene.lensFlaresEnabled) {
                        var r = this.scene.lensFlareSystems;
                        e.Tools.StartPerformanceCounter("Lens flares", r.length > 0);
                        for (var i = 0, n = r; i < n.length; i++) {
                            var o = n[i];
                            0 != (t.layerMask & o.layerMask) && o.render()
                        }
                        e.Tools.EndPerformanceCounter("Lens flares", r.length > 0)
                    }
                }
                ,
                t
            }();
            e.LensFlareSystemSceneComponent = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i) {
                    this.name = t,
                    this.lensFlares = new Array,
                    this.borderLimit = 300,
                    this.viewportBorder = 0,
                    this.layerMask = 268435455,
                    this._vertexBuffers = {},
                    this._isEnabled = !0,
                    this._scene = i || e.Engine.LastCreatedScene;
                    var n = this._scene._getComponent(e.SceneComponentConstants.NAME_LENSFLARESYSTEM);
                    n || (n = new e.LensFlareSystemSceneComponent(this._scene),
                    i._addComponent(n)),
                    this._emitter = r,
                    this.id = t,
                    i.lensFlareSystems.push(this),
                    this.meshesSelectionPredicate = function(e) {
                        return i.activeCamera && e.material && e.isVisible && e.isEnabled() && e.isBlocker && 0 != (e.layerMask & i.activeCamera.layerMask)
                    }
                    ;
                    var o = i.getEngine()
                      , a = [];
                    a.push(1, 1),
                    a.push(-1, 1),
                    a.push(-1, -1),
                    a.push(1, -1),
                    this._vertexBuffers[e.VertexBuffer.PositionKind] = new e.VertexBuffer(o,a,e.VertexBuffer.PositionKind,!1,!1,2);
                    var s = [];
                    s.push(0),
                    s.push(1),
                    s.push(2),
                    s.push(0),
                    s.push(2),
                    s.push(3),
                    this._indexBuffer = o.createIndexBuffer(s),
                    this._effect = o.createEffect("lensFlare", [e.VertexBuffer.PositionKind], ["color", "viewportMatrix"], ["textureSampler"], "")
                }
                return Object.defineProperty(t.prototype, "isEnabled", {
                    get: function() {
                        return this._isEnabled
                    },
                    set: function(e) {
                        this._isEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getScene = function() {
                    return this._scene
                }
                ,
                t.prototype.getEmitter = function() {
                    return this._emitter
                }
                ,
                t.prototype.setEmitter = function(e) {
                    this._emitter = e
                }
                ,
                t.prototype.getEmitterPosition = function() {
                    return this._emitter.getAbsolutePosition ? this._emitter.getAbsolutePosition() : this._emitter.position
                }
                ,
                t.prototype.computeEffectivePosition = function(t) {
                    var r = this.getEmitterPosition();
                    return r = e.Vector3.Project(r, e.Matrix.Identity(), this._scene.getTransformMatrix(), t),
                    this._positionX = r.x,
                    this._positionY = r.y,
                    r = e.Vector3.TransformCoordinates(this.getEmitterPosition(), this._scene.getViewMatrix()),
                    this.viewportBorder > 0 && (t.x -= this.viewportBorder,
                    t.y -= this.viewportBorder,
                    t.width += 2 * this.viewportBorder,
                    t.height += 2 * this.viewportBorder,
                    r.x += this.viewportBorder,
                    r.y += this.viewportBorder,
                    this._positionX += this.viewportBorder,
                    this._positionY += this.viewportBorder),
                    r.z > 0 && (this._positionX > t.x && this._positionX < t.x + t.width && this._positionY > t.y && (this._positionY,
                    t.y,
                    t.height),
                    !0)
                }
                ,
                t.prototype._isVisible = function() {
                    if (!this._isEnabled || !this._scene.activeCamera)
                        return !1;
                    var t = this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition)
                      , r = t.length();
                    t.normalize();
                    var i = new e.Ray(this._scene.activeCamera.globalPosition,t)
                      , n = this._scene.pickWithRay(i, this.meshesSelectionPredicate, !0);
                    return !n || !n.hit || n.distance > r
                }
                ,
                t.prototype.render = function() {
                    if (!this._effect.isReady() || !this._scene.activeCamera)
                        return !1;
                    var t, r, i = this._scene.getEngine(), n = this._scene.activeCamera.viewport.toGlobal(i.getRenderWidth(!0), i.getRenderHeight(!0));
                    if (!this.computeEffectivePosition(n))
                        return !1;
                    if (!this._isVisible())
                        return !1;
                    var o = (t = this._positionX < this.borderLimit + n.x ? this.borderLimit + n.x - this._positionX : this._positionX > n.x + n.width - this.borderLimit ? this._positionX - n.x - n.width + this.borderLimit : 0) > (r = this._positionY < this.borderLimit + n.y ? this.borderLimit + n.y - this._positionY : this._positionY > n.y + n.height - this.borderLimit ? this._positionY - n.y - n.height + this.borderLimit : 0) ? t : r;
                    (o -= this.viewportBorder) > this.borderLimit && (o = this.borderLimit);
                    var a = 1 - e.Scalar.Clamp(o / this.borderLimit, 0, 1);
                    if (a < 0)
                        return !1;
                    a > 1 && (a = 1),
                    this.viewportBorder > 0 && (n.x += this.viewportBorder,
                    n.y += this.viewportBorder,
                    n.width -= 2 * this.viewportBorder,
                    n.height -= 2 * this.viewportBorder,
                    this._positionX -= this.viewportBorder,
                    this._positionY -= this.viewportBorder);
                    var s = n.x + n.width / 2
                      , y = n.y + n.height / 2
                      , l = s - this._positionX
                      , c = y - this._positionY;
                    i.enableEffect(this._effect),
                    i.setState(!1),
                    i.setDepthBuffer(!1),
                    i.bindBuffers(this._vertexBuffers, this._indexBuffer, this._effect);
                    for (var h = 0; h < this.lensFlares.length; h++) {
                        var u = this.lensFlares[h];
                        i.setAlphaMode(u.alphaMode);
                        var d = s - l * u.position
                          , x = y - c * u.position
                          , p = u.size
                          , f = u.size * i.getAspectRatio(this._scene.activeCamera, !0)
                          , m = d / (n.width + 2 * n.x) * 2 - 1
                          , z = 1 - x / (n.height + 2 * n.y) * 2
                          , _ = e.Matrix.FromValues(p / 2, 0, 0, 0, 0, f / 2, 0, 0, 0, 0, 1, 0, m, z, 0, 1);
                        this._effect.setMatrix("viewportMatrix", _),
                        this._effect.setTexture("textureSampler", u.texture),
                        this._effect.setFloat4("color", u.color.r * a, u.color.g * a, u.color.b * a, 1),
                        i.drawElementsType(e.Material.TriangleFillMode, 0, 6)
                    }
                    return i.setDepthBuffer(!0),
                    i.setAlphaMode(e.Engine.ALPHA_DISABLE),
                    !0
                }
                ,
                t.prototype.dispose = function() {
                    var t = this._vertexBuffers[e.VertexBuffer.PositionKind];
                    for (t && (t.dispose(),
                    this._vertexBuffers[e.VertexBuffer.PositionKind] = null),
                    this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer),
                    this._indexBuffer = null); this.lensFlares.length; )
                        this.lensFlares[0].dispose();
                    var r = this._scene.lensFlareSystems.indexOf(this);
                    this._scene.lensFlareSystems.splice(r, 1)
                }
                ,
                t.Parse = function(r, i, n) {
                    var o = i.getLastEntryByID(r.emitterId)
                      , a = r.name || "lensFlareSystem#" + r.emitterId
                      , s = new t(a,o,i);
                    s.id = r.id || a,
                    s.borderLimit = r.borderLimit;
                    for (var y = 0; y < r.flares.length; y++) {
                        var l = r.flares[y];
                        e.LensFlare.AddFlare(l.size, l.position, e.Color3.FromArray(l.color), l.textureName ? n + l.textureName : "", s)
                    }
                    return s
                }
                ,
                t.prototype.serialize = function() {
                    var t = {};
                    t.id = this.id,
                    t.name = this.name,
                    t.emitterId = this.getEmitter().id,
                    t.borderLimit = this.borderLimit,
                    t.flares = [];
                    for (var r = 0; r < this.lensFlares.length; r++) {
                        var i = this.lensFlares[r];
                        t.flares.push({
                            size: i.size,
                            position: i.position,
                            color: i.color.asArray(),
                            textureName: e.Tools.GetFilename(i.texture ? i.texture.name : "")
                        })
                    }
                    return t
                }
                ,
                t
            }();
            e.LensFlareSystem = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e(e, t) {
                    this.type = e,
                    this.jointData = t,
                    t.nativeParams = t.nativeParams || {}
                }
                return Object.defineProperty(e.prototype, "physicsJoint", {
                    get: function() {
                        return this._physicsJoint
                    },
                    set: function(e) {
                        this._physicsJoint,
                        this._physicsJoint = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "physicsPlugin", {
                    set: function(e) {
                        this._physicsPlugin = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype.executeNativeFunction = function(e) {
                    e(this._physicsPlugin.world, this._physicsJoint)
                }
                ,
                e.DistanceJoint = 0,
                e.HingeJoint = 1,
                e.BallAndSocketJoint = 2,
                e.WheelJoint = 3,
                e.SliderJoint = 4,
                e.PrismaticJoint = 5,
                e.UniversalJoint = 6,
                e.Hinge2Joint = e.WheelJoint,
                e.PointToPointJoint = 8,
                e.SpringJoint = 9,
                e.LockJoint = 10,
                e
            }();
            e.PhysicsJoint = t;
            var r = function(e) {
                function r(r) {
                    return e.call(this, t.DistanceJoint, r) || this
                }
                return o(r, e),
                r.prototype.updateDistance = function(e, t) {
                    this._physicsPlugin.updateDistanceJoint(this, e, t)
                }
                ,
                r
            }(t);
            e.DistanceJoint = r;
            var i = function(e) {
                function t(t, r) {
                    return e.call(this, t, r) || this
                }
                return o(t, e),
                t.prototype.setMotor = function(e, t) {
                    this._physicsPlugin.setMotor(this, e || 0, t)
                }
                ,
                t.prototype.setLimit = function(e, t) {
                    this._physicsPlugin.setLimit(this, e, t)
                }
                ,
                t
            }(t);
            e.MotorEnabledJoint = i;
            var n = function(e) {
                function r(r) {
                    return e.call(this, t.HingeJoint, r) || this
                }
                return o(r, e),
                r.prototype.setMotor = function(e, t) {
                    this._physicsPlugin.setMotor(this, e || 0, t)
                }
                ,
                r.prototype.setLimit = function(e, t) {
                    this._physicsPlugin.setLimit(this, e, t)
                }
                ,
                r
            }(i);
            e.HingeJoint = n;
            var a = function(e) {
                function r(r) {
                    return e.call(this, t.Hinge2Joint, r) || this
                }
                return o(r, e),
                r.prototype.setMotor = function(e, t, r) {
                    void 0 === r && (r = 0),
                    this._physicsPlugin.setMotor(this, e || 0, t, r)
                }
                ,
                r.prototype.setLimit = function(e, t, r) {
                    void 0 === r && (r = 0),
                    this._physicsPlugin.setLimit(this, e, t, r)
                }
                ,
                r
            }(i);
            e.Hinge2Joint = a
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n) {
                    void 0 === i && (i = {
                        mass: 0
                    });
                    var o = this;
                    this.object = t,
                    this.type = r,
                    this._options = i,
                    this._scene = n,
                    this._bodyUpdateRequired = !1,
                    this._onBeforePhysicsStepCallbacks = new Array,
                    this._onAfterPhysicsStepCallbacks = new Array,
                    this._onPhysicsCollideCallbacks = [],
                    this._deltaPosition = e.Vector3.Zero(),
                    this._isDisposed = !1,
                    this._tmpQuat = new e.Quaternion,
                    this._tmpQuat2 = new e.Quaternion,
                    this.beforeStep = function() {
                        o._physicsEngine && (o.object.translate(o._deltaPosition, -1),
                        o._deltaRotationConjugated && o.object.rotationQuaternion && o.object.rotationQuaternion.multiplyToRef(o._deltaRotationConjugated, o.object.rotationQuaternion),
                        o.object.computeWorldMatrix(!1),
                        o.object.parent && o.object.rotationQuaternion ? (o.getParentsRotation(),
                        o._tmpQuat.multiplyToRef(o.object.rotationQuaternion, o._tmpQuat)) : o._tmpQuat.copyFrom(o.object.rotationQuaternion || new e.Quaternion),
                        o._options.disableBidirectionalTransformation || o.object.rotationQuaternion && o._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(o, o.object.getAbsolutePivotPoint(), o._tmpQuat),
                        o._onBeforePhysicsStepCallbacks.forEach((function(e) {
                            e(o)
                        }
                        )))
                    }
                    ,
                    this.afterStep = function() {
                        o._physicsEngine && (o._onAfterPhysicsStepCallbacks.forEach((function(e) {
                            e(o)
                        }
                        )),
                        o._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(o),
                        o.object.parent && o.object.rotationQuaternion && (o.getParentsRotation(),
                        o._tmpQuat.conjugateInPlace(),
                        o._tmpQuat.multiplyToRef(o.object.rotationQuaternion, o.object.rotationQuaternion)),
                        o.object.setAbsolutePosition(o.object.position),
                        o._deltaRotation && o.object.rotationQuaternion && o.object.rotationQuaternion.multiplyToRef(o._deltaRotation, o.object.rotationQuaternion),
                        o.object.translate(o._deltaPosition, 1))
                    }
                    ,
                    this.onCollideEvent = null,
                    this.onCollide = function(e) {
                        if ((o._onPhysicsCollideCallbacks.length || o.onCollideEvent) && o._physicsEngine) {
                            var t = o._physicsEngine.getImpostorWithPhysicsBody(e.body);
                            t && (o.onCollideEvent && o.onCollideEvent(o, t),
                            o._onPhysicsCollideCallbacks.filter((function(e) {
                                return -1 !== e.otherImpostors.indexOf(t)
                            }
                            )).forEach((function(e) {
                                e.callback(o, t)
                            }
                            )))
                        }
                    }
                    ,
                    this.object ? (!this._scene && t.getScene && (this._scene = t.getScene()),
                    this._scene && (this._physicsEngine = this._scene.getPhysicsEngine(),
                    this._physicsEngine ? (this.object.rotationQuaternion || (this.object.rotation ? this.object.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(this.object.rotation.y, this.object.rotation.x, this.object.rotation.z) : this.object.rotationQuaternion = new e.Quaternion),
                    this._options.mass = void 0 === i.mass ? 0 : i.mass,
                    this._options.friction = void 0 === i.friction ? .2 : i.friction,
                    this._options.restitution = void 0 === i.restitution ? .2 : i.restitution,
                    this._joints = [],
                    !this.object.parent || this._options.ignoreParent ? this._init() : this.object.parent.physicsImpostor && e.Tools.Warn("You must affect impostors to children before affecting impostor to parent.")) : e.Tools.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))) : e.Tools.Error("No object was provided. A physics object is obligatory")
                }
                return Object.defineProperty(t.prototype, "isDisposed", {
                    get: function() {
                        return this._isDisposed
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "mass", {
                    get: function() {
                        return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getBodyMass(this) : 0
                    },
                    set: function(e) {
                        this.setMass(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "friction", {
                    get: function() {
                        return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getBodyFriction(this) : 0
                    },
                    set: function(e) {
                        this._physicsEngine && this._physicsEngine.getPhysicsPlugin().setBodyFriction(this, e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "restitution", {
                    get: function() {
                        return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this) : 0
                    },
                    set: function(e) {
                        this._physicsEngine && this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this, e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._init = function() {
                    this._physicsEngine && (this._physicsEngine.removeImpostor(this),
                    this.physicsBody = null,
                    this._parent = this._parent || this._getPhysicsParent(),
                    this._isDisposed || this.parent && !this._options.ignoreParent || this._physicsEngine.addImpostor(this))
                }
                ,
                t.prototype._getPhysicsParent = function() {
                    return this.object.parent instanceof e.AbstractMesh ? this.object.parent.physicsImpostor : null
                }
                ,
                t.prototype.isBodyInitRequired = function() {
                    return this._bodyUpdateRequired || !this._physicsBody && !this._parent
                }
                ,
                t.prototype.setScalingUpdated = function(e) {
                    this.forceUpdate()
                }
                ,
                t.prototype.forceUpdate = function() {
                    this._init(),
                    this.parent && !this._options.ignoreParent && this.parent.forceUpdate()
                }
                ,
                Object.defineProperty(t.prototype, "physicsBody", {
                    get: function() {
                        return this._parent && !this._options.ignoreParent ? this._parent.physicsBody : this._physicsBody
                    },
                    set: function(e) {
                        this._physicsBody && this._physicsEngine && this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),
                        this._physicsBody = e,
                        this.resetUpdateFlags()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "parent", {
                    get: function() {
                        return !this._options.ignoreParent && this._parent ? this._parent : null
                    },
                    set: function(e) {
                        this._parent = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.resetUpdateFlags = function() {
                    this._bodyUpdateRequired = !1
                }
                ,
                t.prototype.getObjectExtendSize = function() {
                    if (this.object.getBoundingInfo) {
                        var e = this.object.rotationQuaternion;
                        this.object.rotationQuaternion = t.IDENTITY_QUATERNION,
                        this.object.computeWorldMatrix && this.object.computeWorldMatrix(!0);
                        var r = this.object.getBoundingInfo().boundingBox.extendSizeWorld.scale(2);
                        return this.object.rotationQuaternion = e,
                        this.object.computeWorldMatrix && this.object.computeWorldMatrix(!0),
                        r
                    }
                    return t.DEFAULT_OBJECT_SIZE
                }
                ,
                t.prototype.getObjectCenter = function() {
                    return this.object.getBoundingInfo ? this.object.getBoundingInfo().boundingBox.centerWorld : this.object.position
                }
                ,
                t.prototype.getParam = function(e) {
                    return this._options[e]
                }
                ,
                t.prototype.setParam = function(e, t) {
                    this._options[e] = t,
                    this._bodyUpdateRequired = !0
                }
                ,
                t.prototype.setMass = function(e) {
                    this.getParam("mass") !== e && this.setParam("mass", e),
                    this._physicsEngine && this._physicsEngine.getPhysicsPlugin().setBodyMass(this, e)
                }
                ,
                t.prototype.getLinearVelocity = function() {
                    return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this) : e.Vector3.Zero()
                }
                ,
                t.prototype.setLinearVelocity = function(e) {
                    this._physicsEngine && this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this, e)
                }
                ,
                t.prototype.getAngularVelocity = function() {
                    return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this) : e.Vector3.Zero()
                }
                ,
                t.prototype.setAngularVelocity = function(e) {
                    this._physicsEngine && this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this, e)
                }
                ,
                t.prototype.executeNativeFunction = function(e) {
                    this._physicsEngine && e(this._physicsEngine.getPhysicsPlugin().world, this.physicsBody)
                }
                ,
                t.prototype.registerBeforePhysicsStep = function(e) {
                    this._onBeforePhysicsStepCallbacks.push(e)
                }
                ,
                t.prototype.unregisterBeforePhysicsStep = function(t) {
                    var r = this._onBeforePhysicsStepCallbacks.indexOf(t);
                    r > -1 ? this._onBeforePhysicsStepCallbacks.splice(r, 1) : e.Tools.Warn("Function to remove was not found")
                }
                ,
                t.prototype.registerAfterPhysicsStep = function(e) {
                    this._onAfterPhysicsStepCallbacks.push(e)
                }
                ,
                t.prototype.unregisterAfterPhysicsStep = function(t) {
                    var r = this._onAfterPhysicsStepCallbacks.indexOf(t);
                    r > -1 ? this._onAfterPhysicsStepCallbacks.splice(r, 1) : e.Tools.Warn("Function to remove was not found")
                }
                ,
                t.prototype.registerOnPhysicsCollide = function(e, t) {
                    var r = e instanceof Array ? e : [e];
                    this._onPhysicsCollideCallbacks.push({
                        callback: t,
                        otherImpostors: r
                    })
                }
                ,
                t.prototype.unregisterOnPhysicsCollide = function(t, r) {
                    var i = t instanceof Array ? t : [t]
                      , n = -1;
                    this._onPhysicsCollideCallbacks.some((function(e, t) {
                        if (e.callback === r && e.otherImpostors.length === i.length) {
                            var o = e.otherImpostors.every((function(e) {
                                return i.indexOf(e) > -1
                            }
                            ));
                            return o && (n = t),
                            o
                        }
                        return !1
                    }
                    )) ? this._onPhysicsCollideCallbacks.splice(n, 1) : e.Tools.Warn("Function to remove was not found")
                }
                ,
                t.prototype.getParentsRotation = function() {
                    var t = this.object.parent;
                    for (this._tmpQuat.copyFromFloats(0, 0, 0, 1); t; )
                        t.rotationQuaternion ? this._tmpQuat2.copyFrom(t.rotationQuaternion) : e.Quaternion.RotationYawPitchRollToRef(t.rotation.y, t.rotation.x, t.rotation.z, this._tmpQuat2),
                        this._tmpQuat.multiplyToRef(this._tmpQuat2, this._tmpQuat),
                        t = t.parent;
                    return this._tmpQuat
                }
                ,
                t.prototype.applyForce = function(e, t) {
                    return this._physicsEngine && this._physicsEngine.getPhysicsPlugin().applyForce(this, e, t),
                    this
                }
                ,
                t.prototype.applyImpulse = function(e, t) {
                    return this._physicsEngine && this._physicsEngine.getPhysicsPlugin().applyImpulse(this, e, t),
                    this
                }
                ,
                t.prototype.createJoint = function(t, r, i) {
                    var n = new e.PhysicsJoint(r,i);
                    return this.addJoint(t, n),
                    this
                }
                ,
                t.prototype.addJoint = function(e, t) {
                    return this._joints.push({
                        otherImpostor: e,
                        joint: t
                    }),
                    this._physicsEngine && this._physicsEngine.addJoint(this, e, t),
                    this
                }
                ,
                t.prototype.sleep = function() {
                    return this._physicsEngine && this._physicsEngine.getPhysicsPlugin().sleepBody(this),
                    this
                }
                ,
                t.prototype.wakeUp = function() {
                    return this._physicsEngine && this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),
                    this
                }
                ,
                t.prototype.clone = function(e) {
                    return e ? new t(e,this.type,this._options,this._scene) : null
                }
                ,
                t.prototype.dispose = function() {
                    var e = this;
                    this._physicsEngine && (this._joints.forEach((function(t) {
                        e._physicsEngine && e._physicsEngine.removeJoint(e, t.otherImpostor, t.joint)
                    }
                    )),
                    this._physicsEngine.removeImpostor(this),
                    this.parent && this.parent.forceUpdate(),
                    this._isDisposed = !0)
                }
                ,
                t.prototype.setDeltaPosition = function(e) {
                    this._deltaPosition.copyFrom(e)
                }
                ,
                t.prototype.setDeltaRotation = function(t) {
                    this._deltaRotation || (this._deltaRotation = new e.Quaternion),
                    this._deltaRotation.copyFrom(t),
                    this._deltaRotationConjugated = this._deltaRotation.conjugate()
                }
                ,
                t.prototype.getBoxSizeToRef = function(e) {
                    return this._physicsEngine && this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this, e),
                    this
                }
                ,
                t.prototype.getRadius = function() {
                    return this._physicsEngine ? this._physicsEngine.getPhysicsPlugin().getRadius(this) : 0
                }
                ,
                t.prototype.syncBoneWithImpostor = function(r, i, n, o, a) {
                    var s = t._tmpVecs[0]
                      , y = this.object;
                    if (y.rotationQuaternion)
                        if (a) {
                            var l = t._tmpQuat;
                            y.rotationQuaternion.multiplyToRef(a, l),
                            r.setRotationQuaternion(l, e.Space.WORLD, i)
                        } else
                            r.setRotationQuaternion(y.rotationQuaternion, e.Space.WORLD, i);
                    s.x = 0,
                    s.y = 0,
                    s.z = 0,
                    n && (s.x = n.x,
                    s.y = n.y,
                    s.z = n.z,
                    r.getDirectionToRef(s, i, s),
                    null == o && (o = n.length()),
                    s.x *= o,
                    s.y *= o,
                    s.z *= o),
                    r.getParent() ? (s.addInPlace(y.getAbsolutePosition()),
                    r.setAbsolutePosition(s, i)) : (i.setAbsolutePosition(y.getAbsolutePosition()),
                    i.position.x -= s.x,
                    i.position.y -= s.y,
                    i.position.z -= s.z)
                }
                ,
                t.prototype.syncImpostorWithBone = function(r, i, n, o, a, s) {
                    var y = this.object;
                    if (y.rotationQuaternion)
                        if (a) {
                            var l = t._tmpQuat;
                            r.getRotationQuaternionToRef(e.Space.WORLD, i, l),
                            l.multiplyToRef(a, y.rotationQuaternion)
                        } else
                            r.getRotationQuaternionToRef(e.Space.WORLD, i, y.rotationQuaternion);
                    var c = t._tmpVecs[0]
                      , h = t._tmpVecs[1];
                    s || ((s = t._tmpVecs[2]).x = 0,
                    s.y = 1,
                    s.z = 0),
                    r.getDirectionToRef(s, i, h),
                    r.getAbsolutePositionToRef(i, c),
                    null == o && n && (o = n.length()),
                    null != o && (c.x += h.x * o,
                    c.y += h.y * o,
                    c.z += h.z * o),
                    y.setAbsolutePosition(c)
                }
                ,
                t.DEFAULT_OBJECT_SIZE = new e.Vector3(1,1,1),
                t.IDENTITY_QUATERNION = e.Quaternion.Identity(),
                t._tmpVecs = [e.Vector3.Zero(), e.Vector3.Zero(), e.Vector3.Zero()],
                t._tmpQuat = e.Quaternion.Identity(),
                t.NoImpostor = 0,
                t.SphereImpostor = 1,
                t.BoxImpostor = 2,
                t.PlaneImpostor = 3,
                t.MeshImpostor = 4,
                t.CylinderImpostor = 7,
                t.ParticleImpostor = 8,
                t.HeightmapImpostor = 9,
                t
            }();
            e.PhysicsImpostor = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r) {
                    if (void 0 === r && (r = new e.CannonJSPlugin),
                    this._physicsPlugin = r,
                    this._impostors = [],
                    this._joints = [],
                    !this._physicsPlugin.isSupported())
                        throw new Error("Physics Engine " + this._physicsPlugin.name + " cannot be found. Please make sure it is included.");
                    t = t || new e.Vector3(0,-9.807,0),
                    this.setGravity(t),
                    this.setTimeStep()
                }
                return t.prototype.setGravity = function(e) {
                    this.gravity = e,
                    this._physicsPlugin.setGravity(this.gravity)
                }
                ,
                t.prototype.setTimeStep = function(e) {
                    void 0 === e && (e = 1 / 60),
                    this._physicsPlugin.setTimeStep(e)
                }
                ,
                t.prototype.getTimeStep = function() {
                    return this._physicsPlugin.getTimeStep()
                }
                ,
                t.prototype.dispose = function() {
                    this._impostors.forEach((function(e) {
                        e.dispose()
                    }
                    )),
                    this._physicsPlugin.dispose()
                }
                ,
                t.prototype.getPhysicsPluginName = function() {
                    return this._physicsPlugin.name
                }
                ,
                t.prototype.addImpostor = function(e) {
                    e.uniqueId = this._impostors.push(e),
                    e.parent || this._physicsPlugin.generatePhysicsBody(e)
                }
                ,
                t.prototype.removeImpostor = function(e) {
                    var t = this._impostors.indexOf(e);
                    if (t > -1) {
                        var r = this._impostors.splice(t, 1);
                        r.length && (r[0].physicsBody = null)
                    }
                }
                ,
                t.prototype.addJoint = function(e, t, r) {
                    var i = {
                        mainImpostor: e,
                        connectedImpostor: t,
                        joint: r
                    };
                    r.physicsPlugin = this._physicsPlugin,
                    this._joints.push(i),
                    this._physicsPlugin.generateJoint(i)
                }
                ,
                t.prototype.removeJoint = function(e, t, r) {
                    var i = this._joints.filter((function(i) {
                        return i.connectedImpostor === t && i.joint === r && i.mainImpostor === e
                    }
                    ));
                    i.length && this._physicsPlugin.removeJoint(i[0])
                }
                ,
                t.prototype._step = function(e) {
                    var t = this;
                    this._impostors.forEach((function(e) {
                        e.isBodyInitRequired() && t._physicsPlugin.generatePhysicsBody(e)
                    }
                    )),
                    e > .1 ? e = .1 : e <= 0 && (e = 1 / 60),
                    this._physicsPlugin.executeStep(e, this._impostors)
                }
                ,
                t.prototype.getPhysicsPlugin = function() {
                    return this._physicsPlugin
                }
                ,
                t.prototype.getImpostors = function() {
                    return this._impostors
                }
                ,
                t.prototype.getImpostorForPhysicsObject = function(e) {
                    for (var t = 0; t < this._impostors.length; ++t)
                        if (this._impostors[t].object === e)
                            return this._impostors[t];
                    return null
                }
                ,
                t.prototype.getImpostorWithPhysicsBody = function(e) {
                    for (var t = 0; t < this._impostors.length; ++t)
                        if (this._impostors[t].physicsBody === e)
                            return this._impostors[t];
                    return null
                }
                ,
                t.Epsilon = .001,
                t
            }();
            e.PhysicsEngine = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    this._scene = t,
                    this._physicsEngine = this._scene.getPhysicsEngine(),
                    this._physicsEngine || e.Tools.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")
                }
                return t.prototype.applyRadialExplosionImpulse = function(t, i, n, a) {
                    if (void 0 === a && (a = o.Constant),
                    !this._physicsEngine)
                        return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call this method."),
                        null;
                    var s = this._physicsEngine.getImpostors();
                    if (0 === s.length)
                        return null;
                    var y = new r(this._scene);
                    return s.forEach((function(e) {
                        var r = y.getImpostorForceAndContactPoint(e, t, i, n, a);
                        r && e.applyImpulse(r.force, r.contactPoint)
                    }
                    )),
                    y.dispose(!1),
                    y
                }
                ,
                t.prototype.applyRadialExplosionForce = function(t, i, n, a) {
                    if (void 0 === a && (a = o.Constant),
                    !this._physicsEngine)
                        return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),
                        null;
                    var s = this._physicsEngine.getImpostors();
                    if (0 === s.length)
                        return null;
                    var y = new r(this._scene);
                    return s.forEach((function(e) {
                        var r = y.getImpostorForceAndContactPoint(e, t, i, n, a);
                        r && e.applyForce(r.force, r.contactPoint)
                    }
                    )),
                    y.dispose(!1),
                    y
                }
                ,
                t.prototype.gravitationalField = function(t, r, n, a) {
                    if (void 0 === a && (a = o.Constant),
                    !this._physicsEngine)
                        return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),
                        null;
                    if (0 === this._physicsEngine.getImpostors().length)
                        return null;
                    var s = new i(this,this._scene,t,r,n,a);
                    return s.dispose(!1),
                    s
                }
                ,
                t.prototype.updraft = function(t, r, i, o, s) {
                    if (void 0 === s && (s = a.Center),
                    !this._physicsEngine)
                        return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),
                        null;
                    if (0 === this._physicsEngine.getImpostors().length)
                        return null;
                    var y = new n(this._scene,t,r,i,o,s);
                    return y.dispose(!1),
                    y
                }
                ,
                t.prototype.vortex = function(t, r, i, n) {
                    if (!this._physicsEngine)
                        return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),
                        null;
                    if (0 === this._physicsEngine.getImpostors().length)
                        return null;
                    var o = new s(this._scene,t,r,i,n);
                    return o.dispose(!1),
                    o
                }
                ,
                t
            }();
            e.PhysicsHelper = t;
            var r = function() {
                function t(e) {
                    this._sphereOptions = {
                        segments: 32,
                        diameter: 1
                    },
                    this._rays = [],
                    this._dataFetched = !1,
                    this._scene = e
                }
                return t.prototype.getData = function() {
                    return this._dataFetched = !0,
                    {
                        sphere: this._sphere,
                        rays: this._rays
                    }
                }
                ,
                t.prototype.getImpostorForceAndContactPoint = function(t, r, i, n, a) {
                    if (0 === t.mass)
                        return null;
                    if (!this._intersectsWithSphere(t, r, i))
                        return null;
                    if ("Mesh" !== t.object.getClassName() && "InstancedMesh" !== t.object.getClassName())
                        return null;
                    var s = t.getObjectCenter().subtract(r)
                      , y = new e.Ray(r,s,i);
                    this._rays.push(y);
                    var l = y.intersectsMesh(t.object).pickedPoint;
                    if (!l)
                        return null;
                    var c = e.Vector3.Distance(r, l);
                    if (c > i)
                        return null;
                    var h = a === o.Constant ? n : n * (1 - c / i);
                    return {
                        force: s.multiplyByFloats(h, h, h),
                        contactPoint: l
                    }
                }
                ,
                t.prototype.dispose = function(e) {
                    var t = this;
                    void 0 === e && (e = !0),
                    e ? this._sphere.dispose() : setTimeout((function() {
                        t._dataFetched || t._sphere.dispose()
                    }
                    ), 0)
                }
                ,
                t.prototype._prepareSphere = function() {
                    this._sphere || (this._sphere = e.MeshBuilder.CreateSphere("radialExplosionEventSphere", this._sphereOptions, this._scene),
                    this._sphere.isVisible = !1)
                }
                ,
                t.prototype._intersectsWithSphere = function(t, r, i) {
                    var n = t.object;
                    return this._prepareSphere(),
                    this._sphere.position = r,
                    this._sphere.scaling = new e.Vector3(2 * i,2 * i,2 * i),
                    this._sphere._updateBoundingInfo(),
                    this._sphere.computeWorldMatrix(!0),
                    this._sphere.intersectsMesh(n, !0)
                }
                ,
                t
            }();
            e.PhysicsRadialExplosionEvent = r;
            var i = function() {
                function e(e, t, r, i, n, a) {
                    void 0 === a && (a = o.Constant),
                    this._dataFetched = !1,
                    this._physicsHelper = e,
                    this._scene = t,
                    this._origin = r,
                    this._radius = i,
                    this._strength = n,
                    this._falloff = a,
                    this._tickCallback = this._tick.bind(this)
                }
                return e.prototype.getData = function() {
                    return this._dataFetched = !0,
                    {
                        sphere: this._sphere
                    }
                }
                ,
                e.prototype.enable = function() {
                    this._tickCallback.call(this),
                    this._scene.registerBeforeRender(this._tickCallback)
                }
                ,
                e.prototype.disable = function() {
                    this._scene.unregisterBeforeRender(this._tickCallback)
                }
                ,
                e.prototype.dispose = function(e) {
                    var t = this;
                    void 0 === e && (e = !0),
                    e ? this._sphere.dispose() : setTimeout((function() {
                        t._dataFetched || t._sphere.dispose()
                    }
                    ), 0)
                }
                ,
                e.prototype._tick = function() {
                    if (this._sphere)
                        this._physicsHelper.applyRadialExplosionForce(this._origin, this._radius, -1 * this._strength, this._falloff);
                    else {
                        var e = this._physicsHelper.applyRadialExplosionForce(this._origin, this._radius, -1 * this._strength, this._falloff);
                        e && (this._sphere = e.getData().sphere.clone("radialExplosionEventSphereClone"))
                    }
                }
                ,
                e
            }();
            e.PhysicsGravitationalFieldEvent = i;
            var n = function() {
                function t(t, r, i, n, o, s) {
                    this._scene = t,
                    this._origin = r,
                    this._radius = i,
                    this._strength = n,
                    this._height = o,
                    this._updraftMode = s,
                    this._originTop = e.Vector3.Zero(),
                    this._originDirection = e.Vector3.Zero(),
                    this._cylinderPosition = e.Vector3.Zero(),
                    this._dataFetched = !1,
                    this._physicsEngine = this._scene.getPhysicsEngine(),
                    this._origin.addToRef(new e.Vector3(0,this._height / 2,0), this._cylinderPosition),
                    this._origin.addToRef(new e.Vector3(0,this._height,0), this._originTop),
                    this._updraftMode === a.Perpendicular && (this._originDirection = this._origin.subtract(this._originTop).normalize()),
                    this._tickCallback = this._tick.bind(this)
                }
                return t.prototype.getData = function() {
                    return this._dataFetched = !0,
                    {
                        cylinder: this._cylinder
                    }
                }
                ,
                t.prototype.enable = function() {
                    this._tickCallback.call(this),
                    this._scene.registerBeforeRender(this._tickCallback)
                }
                ,
                t.prototype.disable = function() {
                    this._scene.unregisterBeforeRender(this._tickCallback)
                }
                ,
                t.prototype.dispose = function(e) {
                    var t = this;
                    void 0 === e && (e = !0),
                    e ? this._cylinder.dispose() : setTimeout((function() {
                        t._dataFetched || t._cylinder.dispose()
                    }
                    ), 0)
                }
                ,
                t.prototype.getImpostorForceAndContactPoint = function(e) {
                    if (0 === e.mass)
                        return null;
                    if (!this._intersectsWithCylinder(e))
                        return null;
                    var t = e.getObjectCenter();
                    if (this._updraftMode === a.Perpendicular)
                        var r = this._originDirection;
                    else
                        r = t.subtract(this._originTop);
                    var i = -1 * this._strength;
                    return {
                        force: r.multiplyByFloats(i, i, i),
                        contactPoint: t
                    }
                }
                ,
                t.prototype._tick = function() {
                    var e = this;
                    this._physicsEngine.getImpostors().forEach((function(t) {
                        var r = e.getImpostorForceAndContactPoint(t);
                        r && t.applyForce(r.force, r.contactPoint)
                    }
                    ))
                }
                ,
                t.prototype._prepareCylinder = function() {
                    this._cylinder || (this._cylinder = e.MeshBuilder.CreateCylinder("updraftEventCylinder", {
                        height: this._height,
                        diameter: 2 * this._radius
                    }, this._scene),
                    this._cylinder.isVisible = !1)
                }
                ,
                t.prototype._intersectsWithCylinder = function(e) {
                    var t = e.object;
                    return this._prepareCylinder(),
                    this._cylinder.position = this._cylinderPosition,
                    this._cylinder.intersectsMesh(t, !0)
                }
                ,
                t
            }();
            e.PhysicsUpdraftEvent = n;
            var o, a, s = function() {
                function t(t, r, i, n, o) {
                    this._scene = t,
                    this._origin = r,
                    this._radius = i,
                    this._strength = n,
                    this._height = o,
                    this._originTop = e.Vector3.Zero(),
                    this._centripetalForceThreshold = .7,
                    this._updraftMultiplier = .02,
                    this._cylinderPosition = e.Vector3.Zero(),
                    this._dataFetched = !1,
                    this._physicsEngine = this._scene.getPhysicsEngine(),
                    this._origin.addToRef(new e.Vector3(0,this._height / 2,0), this._cylinderPosition),
                    this._origin.addToRef(new e.Vector3(0,this._height,0), this._originTop),
                    this._tickCallback = this._tick.bind(this)
                }
                return t.prototype.getData = function() {
                    return this._dataFetched = !0,
                    {
                        cylinder: this._cylinder
                    }
                }
                ,
                t.prototype.enable = function() {
                    this._tickCallback.call(this),
                    this._scene.registerBeforeRender(this._tickCallback)
                }
                ,
                t.prototype.disable = function() {
                    this._scene.unregisterBeforeRender(this._tickCallback)
                }
                ,
                t.prototype.dispose = function(e) {
                    var t = this;
                    void 0 === e && (e = !0),
                    e ? this._cylinder.dispose() : setTimeout((function() {
                        t._dataFetched || t._cylinder.dispose()
                    }
                    ), 0)
                }
                ,
                t.prototype.getImpostorForceAndContactPoint = function(t) {
                    if (0 === t.mass)
                        return null;
                    if (!this._intersectsWithCylinder(t))
                        return null;
                    if ("Mesh" !== t.object.getClassName() && "InstancedMesh" !== t.object.getClassName())
                        return null;
                    var r = t.getObjectCenter()
                      , i = new e.Vector3(this._origin.x,r.y,this._origin.z)
                      , n = r.subtract(i)
                      , o = new e.Ray(i,n,this._radius).intersectsMesh(t.object)
                      , a = o.pickedPoint;
                    if (!a)
                        return null;
                    var s = o.distance / this._radius
                      , y = e.Vector3.Cross(i, r).normalize()
                      , l = a.normalize();
                    if (s > this._centripetalForceThreshold && (l = l.negate()),
                    s > this._centripetalForceThreshold)
                        var c = l.x * this._strength / 8
                          , h = l.y * this._updraftMultiplier
                          , u = l.z * this._strength / 8;
                    else
                        c = (y.x + l.x) / 2,
                        h = this._originTop.y * this._updraftMultiplier,
                        u = (y.z + l.z) / 2;
                    var d = new e.Vector3(c,h,u);
                    return {
                        force: d = d.multiplyByFloats(this._strength, this._strength, this._strength),
                        contactPoint: r
                    }
                }
                ,
                t.prototype._tick = function() {
                    var e = this;
                    this._physicsEngine.getImpostors().forEach((function(t) {
                        var r = e.getImpostorForceAndContactPoint(t);
                        r && t.applyForce(r.force, r.contactPoint)
                    }
                    ))
                }
                ,
                t.prototype._prepareCylinder = function() {
                    this._cylinder || (this._cylinder = e.MeshBuilder.CreateCylinder("vortexEventCylinder", {
                        height: this._height,
                        diameter: 2 * this._radius
                    }, this._scene),
                    this._cylinder.isVisible = !1)
                }
                ,
                t.prototype._intersectsWithCylinder = function(e) {
                    var t = e.object;
                    return this._prepareCylinder(),
                    this._cylinder.position = this._cylinderPosition,
                    this._cylinder.intersectsMesh(t, !0)
                }
                ,
                t
            }();
            e.PhysicsVortexEvent = s,
            function(e) {
                e[e.Constant = 0] = "Constant",
                e[e.Linear = 1] = "Linear"
            }(o = e.PhysicsRadialImpulseFalloff || (e.PhysicsRadialImpulseFalloff = {})),
            function(e) {
                e[e.Center = 0] = "Center",
                e[e.Perpendicular = 1] = "Perpendicular"
            }(a = e.PhysicsUpdraftMode || (e.PhysicsUpdraftMode = {}))
        }(s || (s = {})),
        function(t) {
            var r = function() {
                function r(r, i) {
                    void 0 === r && (r = !0),
                    void 0 === i && (i = 10),
                    this._useDeltaForWorldStep = r,
                    this.name = "CannonJSPlugin",
                    this._physicsMaterials = new Array,
                    this._fixedTimeStep = 1 / 60,
                    this.BJSCANNON = e,
                    this._minus90X = new t.Quaternion(-.7071067811865475,0,0,.7071067811865475),
                    this._plus90X = new t.Quaternion(.7071067811865475,0,0,.7071067811865475),
                    this._tmpPosition = t.Vector3.Zero(),
                    this._tmpDeltaPosition = t.Vector3.Zero(),
                    this._tmpUnityRotation = new t.Quaternion,
                    this.isSupported() ? (this._extendNamespace(),
                    this.world = new this.BJSCANNON.World,
                    this.world.broadphase = new this.BJSCANNON.NaiveBroadphase,
                    this.world.solver.iterations = i) : t.Tools.Error("CannonJS is not available. Please make sure you included the js file.")
                }
                return r.prototype.setGravity = function(e) {
                    this.world.gravity.copy(e)
                }
                ,
                r.prototype.setTimeStep = function(e) {
                    this._fixedTimeStep = e
                }
                ,
                r.prototype.getTimeStep = function() {
                    return this._fixedTimeStep
                }
                ,
                r.prototype.executeStep = function(e, t) {
                    this.world.step(this._fixedTimeStep, this._useDeltaForWorldStep ? e : 0, 3)
                }
                ,
                r.prototype.applyImpulse = function(e, t, r) {
                    var i = new this.BJSCANNON.Vec3(r.x,r.y,r.z)
                      , n = new this.BJSCANNON.Vec3(t.x,t.y,t.z);
                    e.physicsBody.applyImpulse(n, i)
                }
                ,
                r.prototype.applyForce = function(e, t, r) {
                    var i = new this.BJSCANNON.Vec3(r.x,r.y,r.z)
                      , n = new this.BJSCANNON.Vec3(t.x,t.y,t.z);
                    e.physicsBody.applyForce(n, i)
                }
                ,
                r.prototype.generatePhysicsBody = function(e) {
                    if (e.parent)
                        e.physicsBody && (this.removePhysicsBody(e),
                        e.forceUpdate());
                    else {
                        if (e.isBodyInitRequired()) {
                            var t = this._createShape(e)
                              , r = e.physicsBody;
                            r && this.removePhysicsBody(e);
                            var i = this._addMaterial("mat-" + e.uniqueId, e.getParam("friction"), e.getParam("restitution"))
                              , n = {
                                mass: e.getParam("mass"),
                                material: i
                            }
                              , o = e.getParam("nativeOptions");
                            for (var a in o)
                                o.hasOwnProperty(a) && (n[a] = o[a]);
                            e.physicsBody = new this.BJSCANNON.Body(n),
                            e.physicsBody.addEventListener("collide", e.onCollide),
                            this.world.addEventListener("preStep", e.beforeStep),
                            this.world.addEventListener("postStep", e.afterStep),
                            e.physicsBody.addShape(t),
                            this.world.add(e.physicsBody),
                            r && ["force", "torque", "velocity", "angularVelocity"].forEach((function(t) {
                                e.physicsBody[t].copy(r[t])
                            }
                            )),
                            this._processChildMeshes(e)
                        }
                        this._updatePhysicsBodyTransformation(e)
                    }
                }
                ,
                r.prototype._processChildMeshes = function(e) {
                    var r = this
                      , i = e.object.getChildMeshes ? e.object.getChildMeshes(!0) : []
                      , n = e.object.rotationQuaternion;
                    if (i.length) {
                        var o = function(i, a) {
                            if (n && a.rotationQuaternion) {
                                var s = a.getPhysicsImpostor();
                                if (s)
                                    if (s.parent !== e) {
                                        var y = a.getAbsolutePosition().subtract(e.object.getAbsolutePosition())
                                          , l = a.rotationQuaternion.multiply(t.Quaternion.Inverse(n));
                                        s.physicsBody && (r.removePhysicsBody(s),
                                        s.physicsBody = null),
                                        s.parent = e,
                                        s.resetUpdateFlags(),
                                        e.physicsBody.addShape(r._createShape(s), new r.BJSCANNON.Vec3(y.x,y.y,y.z), new r.BJSCANNON.Quaternion(l.x,l.y,l.z,l.w)),
                                        e.physicsBody.mass += s.getParam("mass")
                                    }
                                n.multiplyInPlace(a.rotationQuaternion),
                                a.getChildMeshes(!0).filter((function(e) {
                                    return !!e.physicsImpostor
                                }
                                )).forEach(o.bind(r, a.getAbsolutePosition()))
                            }
                        };
                        i.filter((function(e) {
                            return !!e.physicsImpostor
                        }
                        )).forEach(o.bind(this, e.object.getAbsolutePosition()))
                    }
                }
                ,
                r.prototype.removePhysicsBody = function(e) {
                    e.physicsBody.removeEventListener("collide", e.onCollide),
                    this.world.removeEventListener("preStep", e.beforeStep),
                    this.world.removeEventListener("postStep", e.afterStep),
                    this.world.remove(e.physicsBody)
                }
                ,
                r.prototype.generateJoint = function(e) {
                    var r = e.mainImpostor.physicsBody
                      , i = e.connectedImpostor.physicsBody;
                    if (r && i) {
                        var n, o = e.joint.jointData, a = {
                            pivotA: o.mainPivot ? (new this.BJSCANNON.Vec3).copy(o.mainPivot) : null,
                            pivotB: o.connectedPivot ? (new this.BJSCANNON.Vec3).copy(o.connectedPivot) : null,
                            axisA: o.mainAxis ? (new this.BJSCANNON.Vec3).copy(o.mainAxis) : null,
                            axisB: o.connectedAxis ? (new this.BJSCANNON.Vec3).copy(o.connectedAxis) : null,
                            maxForce: o.nativeParams.maxForce,
                            collideConnected: !!o.collision
                        };
                        switch (e.joint.type) {
                        case t.PhysicsJoint.HingeJoint:
                        case t.PhysicsJoint.Hinge2Joint:
                            n = new this.BJSCANNON.HingeConstraint(r,i,a);
                            break;
                        case t.PhysicsJoint.DistanceJoint:
                            n = new this.BJSCANNON.DistanceConstraint(r,i,o.maxDistance || 2);
                            break;
                        case t.PhysicsJoint.SpringJoint:
                            var s = o;
                            n = new this.BJSCANNON.Spring(r,i,{
                                restLength: s.length,
                                stiffness: s.stiffness,
                                damping: s.damping,
                                localAnchorA: a.pivotA,
                                localAnchorB: a.pivotB
                            });
                            break;
                        case t.PhysicsJoint.LockJoint:
                            n = new this.BJSCANNON.LockConstraint(r,i,a);
                            break;
                        case t.PhysicsJoint.PointToPointJoint:
                        case t.PhysicsJoint.BallAndSocketJoint:
                        default:
                            n = new this.BJSCANNON.PointToPointConstraint(r,a.pivotA,i,a.pivotA,a.maxForce)
                        }
                        n.collideConnected = !!o.collision,
                        e.joint.physicsJoint = n,
                        e.joint.type !== t.PhysicsJoint.SpringJoint ? this.world.addConstraint(n) : (e.joint.jointData.forceApplicationCallback = e.joint.jointData.forceApplicationCallback || function() {
                            n.applyForce()
                        }
                        ,
                        e.mainImpostor.registerAfterPhysicsStep(e.joint.jointData.forceApplicationCallback))
                    }
                }
                ,
                r.prototype.removeJoint = function(e) {
                    e.joint.type !== t.PhysicsJoint.SpringJoint ? this.world.removeConstraint(e.joint.physicsJoint) : e.mainImpostor.unregisterAfterPhysicsStep(e.joint.jointData.forceApplicationCallback)
                }
                ,
                r.prototype._addMaterial = function(e, t, r) {
                    var i, n;
                    for (i = 0; i < this._physicsMaterials.length; i++)
                        if ((n = this._physicsMaterials[i]).friction === t && n.restitution === r)
                            return n;
                    var o = new this.BJSCANNON.Material(e);
                    return o.friction = t,
                    o.restitution = r,
                    this._physicsMaterials.push(o),
                    o
                }
                ,
                r.prototype._checkWithEpsilon = function(e) {
                    return e < t.PhysicsEngine.Epsilon ? t.PhysicsEngine.Epsilon : e
                }
                ,
                r.prototype._createShape = function(e) {
                    var r, i = e.object, n = e.getObjectExtendSize();
                    switch (e.type) {
                    case t.PhysicsImpostor.SphereImpostor:
                        var o = n.x
                          , a = n.y
                          , s = n.z;
                        r = new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(o), this._checkWithEpsilon(a), this._checkWithEpsilon(s)) / 2);
                        break;
                    case t.PhysicsImpostor.CylinderImpostor:
                        r = new this.BJSCANNON.Cylinder(this._checkWithEpsilon(n.x) / 2,this._checkWithEpsilon(n.x) / 2,this._checkWithEpsilon(n.y),16);
                        break;
                    case t.PhysicsImpostor.BoxImpostor:
                        var y = n.scale(.5);
                        r = new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(y.x),this._checkWithEpsilon(y.y),this._checkWithEpsilon(y.z)));
                        break;
                    case t.PhysicsImpostor.PlaneImpostor:
                        t.Tools.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),
                        r = new this.BJSCANNON.Plane;
                        break;
                    case t.PhysicsImpostor.MeshImpostor:
                        var l = i.getVerticesData ? i.getVerticesData(t.VertexBuffer.PositionKind) : []
                          , c = i.getIndices ? i.getIndices() : [];
                        if (!l)
                            return;
                        var h = i.position.clone()
                          , u = i.rotation && i.rotation.clone()
                          , d = i.rotationQuaternion && i.rotationQuaternion.clone();
                        i.position.copyFromFloats(0, 0, 0),
                        i.rotation && i.rotation.copyFromFloats(0, 0, 0),
                        i.rotationQuaternion && i.rotationQuaternion.copyFrom(e.getParentsRotation()),
                        i.rotationQuaternion && i.parent && i.rotationQuaternion.conjugateInPlace();
                        var x, p = i.computeWorldMatrix(!0), f = new Array;
                        for (x = 0; x < l.length; x += 3)
                            t.Vector3.TransformCoordinates(t.Vector3.FromArray(l, x), p).toArray(f, x);
                        t.Tools.Warn("MeshImpostor only collides against spheres."),
                        r = new this.BJSCANNON.Trimesh(f,c),
                        i.position.copyFrom(h),
                        u && i.rotation && i.rotation.copyFrom(u),
                        d && i.rotationQuaternion && i.rotationQuaternion.copyFrom(d);
                        break;
                    case t.PhysicsImpostor.HeightmapImpostor:
                        var m = i.position.clone()
                          , z = i.rotation && i.rotation.clone()
                          , _ = i.rotationQuaternion && i.rotationQuaternion.clone();
                        i.position.copyFromFloats(0, 0, 0),
                        i.rotation && i.rotation.copyFromFloats(0, 0, 0),
                        i.rotationQuaternion && i.rotationQuaternion.copyFrom(e.getParentsRotation()),
                        i.rotationQuaternion && i.parent && i.rotationQuaternion.conjugateInPlace(),
                        i.rotationQuaternion && i.rotationQuaternion.multiplyInPlace(this._minus90X),
                        r = this._createHeightmap(i),
                        i.position.copyFrom(m),
                        z && i.rotation && i.rotation.copyFrom(z),
                        _ && i.rotationQuaternion && i.rotationQuaternion.copyFrom(_),
                        i.computeWorldMatrix(!0);
                        break;
                    case t.PhysicsImpostor.ParticleImpostor:
                        r = new this.BJSCANNON.Particle
                    }
                    return r
                }
                ,
                r.prototype._createHeightmap = function(e, r) {
                    var i, n = e.getVerticesData(t.VertexBuffer.PositionKind), o = e.computeWorldMatrix(!0), a = new Array;
                    for (i = 0; i < n.length; i += 3)
                        t.Vector3.TransformCoordinates(t.Vector3.FromArray(n, i), o).toArray(a, i);
                    n = a;
                    for (var s = new Array, y = r || ~~(Math.sqrt(n.length / 3) - 1), l = e.getBoundingInfo(), c = Math.min(l.boundingBox.extendSizeWorld.x, l.boundingBox.extendSizeWorld.y), h = l.boundingBox.extendSizeWorld.z, u = 2 * c / y, d = 0; d < n.length; d += 3) {
                        var x = Math.round(n[d + 0] / u + y / 2)
                          , p = Math.round(-1 * (n[d + 1] / u - y / 2))
                          , f = -n[d + 2] + h;
                        s[x] || (s[x] = []),
                        s[x][p] || (s[x][p] = f),
                        s[x][p] = Math.max(f, s[x][p])
                    }
                    for (x = 0; x <= y; ++x) {
                        if (!s[x]) {
                            for (var m = 1; !s[(x + m) % y]; )
                                m++;
                            s[x] = s[(x + m) % y].slice()
                        }
                        for (p = 0; p <= y; ++p)
                            if (!s[x][p]) {
                                var z;
                                for (m = 1; void 0 === z; )
                                    z = s[x][(p + m++) % y];
                                s[x][p] = z
                            }
                    }
                    var _ = new this.BJSCANNON.Heightfield(s,{
                        elementSize: u
                    });
                    return _.minY = h,
                    _
                }
                ,
                r.prototype._updatePhysicsBodyTransformation = function(e) {
                    var r = e.object;
                    if (r.computeWorldMatrix && r.computeWorldMatrix(!0),
                    r.getBoundingInfo()) {
                        var i = e.getObjectCenter();
                        this._tmpDeltaPosition.copyFrom(r.getAbsolutePivotPoint().subtract(i)),
                        this._tmpDeltaPosition.divideInPlace(e.object.scaling),
                        this._tmpPosition.copyFrom(i);
                        var n = r.rotationQuaternion;
                        if (n) {
                            if (e.type !== t.PhysicsImpostor.PlaneImpostor && e.type !== t.PhysicsImpostor.HeightmapImpostor && e.type !== t.PhysicsImpostor.CylinderImpostor || (n = n.multiply(this._minus90X),
                            e.setDeltaRotation(this._plus90X)),
                            e.type === t.PhysicsImpostor.HeightmapImpostor) {
                                var o = r
                                  , a = o.getBoundingInfo()
                                  , s = o.rotationQuaternion;
                                o.rotationQuaternion = this._tmpUnityRotation,
                                o.computeWorldMatrix(!0);
                                var y = i.clone()
                                  , l = o.getPivotMatrix() || t.Matrix.Translation(0, 0, 0)
                                  , c = t.Matrix.Translation(a.boundingBox.extendSizeWorld.x, 0, -a.boundingBox.extendSizeWorld.z);
                                o.setPreTransformMatrix(c),
                                o.computeWorldMatrix(!0);
                                var h = a.boundingBox.centerWorld.subtract(i).subtract(o.position).negate();
                                this._tmpPosition.copyFromFloats(h.x, h.y - a.boundingBox.extendSizeWorld.y, h.z),
                                this._tmpDeltaPosition.copyFrom(a.boundingBox.centerWorld.subtract(y)),
                                this._tmpDeltaPosition.y += a.boundingBox.extendSizeWorld.y,
                                o.rotationQuaternion = s,
                                o.setPreTransformMatrix(l),
                                o.computeWorldMatrix(!0)
                            } else
                                e.type === t.PhysicsImpostor.MeshImpostor && this._tmpDeltaPosition.copyFromFloats(0, 0, 0);
                            e.setDeltaPosition(this._tmpDeltaPosition),
                            e.physicsBody.position.copy(this._tmpPosition),
                            e.physicsBody.quaternion.copy(n)
                        }
                    }
                }
                ,
                r.prototype.setTransformationFromPhysicsBody = function(e) {
                    e.object.position.copyFrom(e.physicsBody.position),
                    e.object.rotationQuaternion && e.object.rotationQuaternion.copyFrom(e.physicsBody.quaternion)
                }
                ,
                r.prototype.setPhysicsBodyTransformation = function(e, t, r) {
                    e.physicsBody.position.copy(t),
                    e.physicsBody.quaternion.copy(r)
                }
                ,
                r.prototype.isSupported = function() {
                    return void 0 !== this.BJSCANNON
                }
                ,
                r.prototype.setLinearVelocity = function(e, t) {
                    e.physicsBody.velocity.copy(t)
                }
                ,
                r.prototype.setAngularVelocity = function(e, t) {
                    e.physicsBody.angularVelocity.copy(t)
                }
                ,
                r.prototype.getLinearVelocity = function(e) {
                    var r = e.physicsBody.velocity;
                    return r ? new t.Vector3(r.x,r.y,r.z) : null
                }
                ,
                r.prototype.getAngularVelocity = function(e) {
                    var r = e.physicsBody.angularVelocity;
                    return r ? new t.Vector3(r.x,r.y,r.z) : null
                }
                ,
                r.prototype.setBodyMass = function(e, t) {
                    e.physicsBody.mass = t,
                    e.physicsBody.updateMassProperties()
                }
                ,
                r.prototype.getBodyMass = function(e) {
                    return e.physicsBody.mass
                }
                ,
                r.prototype.getBodyFriction = function(e) {
                    return e.physicsBody.material.friction
                }
                ,
                r.prototype.setBodyFriction = function(e, t) {
                    e.physicsBody.material.friction = t
                }
                ,
                r.prototype.getBodyRestitution = function(e) {
                    return e.physicsBody.material.restitution
                }
                ,
                r.prototype.setBodyRestitution = function(e, t) {
                    e.physicsBody.material.restitution = t
                }
                ,
                r.prototype.sleepBody = function(e) {
                    e.physicsBody.sleep()
                }
                ,
                r.prototype.wakeUpBody = function(e) {
                    e.physicsBody.wakeUp()
                }
                ,
                r.prototype.updateDistanceJoint = function(e, t, r) {
                    e.physicsJoint.distance = t
                }
                ,
                r.prototype.setMotor = function(e, t, r, i) {
                    i || (e.physicsJoint.enableMotor(),
                    e.physicsJoint.setMotorSpeed(t),
                    r && this.setLimit(e, r))
                }
                ,
                r.prototype.setLimit = function(e, t, r) {
                    e.physicsJoint.motorEquation.maxForce = t,
                    e.physicsJoint.motorEquation.minForce = void 0 === r ? -t : r
                }
                ,
                r.prototype.syncMeshWithImpostor = function(e, t) {
                    var r = t.physicsBody;
                    e.position.x = r.position.x,
                    e.position.y = r.position.y,
                    e.position.z = r.position.z,
                    e.rotationQuaternion && (e.rotationQuaternion.x = r.quaternion.x,
                    e.rotationQuaternion.y = r.quaternion.y,
                    e.rotationQuaternion.z = r.quaternion.z,
                    e.rotationQuaternion.w = r.quaternion.w)
                }
                ,
                r.prototype.getRadius = function(e) {
                    return e.physicsBody.shapes[0].boundingSphereRadius
                }
                ,
                r.prototype.getBoxSizeToRef = function(e, t) {
                    var r = e.physicsBody.shapes[0];
                    t.x = 2 * r.halfExtents.x,
                    t.y = 2 * r.halfExtents.y,
                    t.z = 2 * r.halfExtents.z
                }
                ,
                r.prototype.dispose = function() {}
                ,
                r.prototype._extendNamespace = function() {
                    var e = new this.BJSCANNON.Vec3
                      , t = this.BJSCANNON;
                    this.BJSCANNON.World.prototype.step = function(r, i, n) {
                        if (n = n || 10,
                        0 === (i = i || 0))
                            this.internalStep(r),
                            this.time += r;
                        else {
                            var o = Math.floor((this.time + i) / r) - Math.floor(this.time / r);
                            o = Math.min(o, n) || 1;
                            for (var a = performance.now(), s = 0; s !== o && (this.internalStep(r),
                            !(performance.now() - a > 1e3 * r)); s++)
                                ;
                            this.time += i;
                            for (var y = this.time % r / r, l = e, c = this.bodies, h = 0; h !== c.length; h++) {
                                var u = c[h];
                                u.type !== t.Body.STATIC && u.sleepState !== t.Body.SLEEPING ? (u.position.vsub(u.previousPosition, l),
                                l.scale(y, l),
                                u.position.vadd(l, u.interpolatedPosition)) : (u.interpolatedPosition.copy(u.position),
                                u.interpolatedQuaternion.copy(u.quaternion))
                            }
                        }
                    }
                }
                ,
                r
            }();
            t.CannonJSPlugin = r
        }(s || (s = {})),
        function(e) {
            var r = function() {
                function r(r) {
                    this.name = "OimoJSPlugin",
                    this._tmpImpostorsArray = [],
                    this._tmpPositionVector = e.Vector3.Zero(),
                    this.BJSOIMO = t,
                    this.world = new this.BJSOIMO.World({
                        iterations: r
                    }),
                    this.world.clear()
                }
                return r.prototype.setGravity = function(e) {
                    this.world.gravity.copy(e)
                }
                ,
                r.prototype.setTimeStep = function(e) {
                    this.world.timeStep = e
                }
                ,
                r.prototype.getTimeStep = function() {
                    return this.world.timeStep
                }
                ,
                r.prototype.executeStep = function(e, t) {
                    var r = this;
                    t.forEach((function(e) {
                        e.beforeStep()
                    }
                    )),
                    this.world.step(),
                    t.forEach((function(e) {
                        e.afterStep(),
                        r._tmpImpostorsArray[e.uniqueId] = e
                    }
                    ));
                    for (var i = this.world.contacts; null !== i; )
                        if (!i.touching || i.body1.sleeping || i.body2.sleeping) {
                            var n = this._tmpImpostorsArray[+i.body1.name]
                              , o = this._tmpImpostorsArray[+i.body2.name];
                            n && o ? (n.onCollide({
                                body: o.physicsBody
                            }),
                            o.onCollide({
                                body: n.physicsBody
                            }),
                            i = i.next) : i = i.next
                        } else
                            i = i.next
                }
                ,
                r.prototype.applyImpulse = function(e, t, r) {
                    var i = e.physicsBody.mass;
                    e.physicsBody.applyImpulse(r.scale(this.world.invScale), t.scale(this.world.invScale * i))
                }
                ,
                r.prototype.applyForce = function(t, r, i) {
                    e.Tools.Warn("Oimo doesn't support applying force. Using impule instead."),
                    this.applyImpulse(t, r, i)
                }
                ,
                r.prototype.generatePhysicsBody = function(t) {
                    var r = this;
                    if (t.parent)
                        t.physicsBody && (this.removePhysicsBody(t),
                        t.forceUpdate());
                    else {
                        if (t.isBodyInitRequired()) {
                            var i = {
                                name: t.uniqueId,
                                config: [t.getParam("mass") || 1, t.getParam("friction"), t.getParam("restitution")],
                                size: [],
                                type: [],
                                pos: [],
                                posShape: [],
                                rot: [],
                                rotShape: [],
                                move: 0 !== t.getParam("mass"),
                                density: t.getParam("mass"),
                                friction: t.getParam("friction"),
                                restitution: t.getParam("restitution"),
                                world: this.world
                            }
                              , n = [t];
                            (s = t.object).getChildMeshes && s.getChildMeshes().forEach((function(e) {
                                e.physicsImpostor && n.push(e.physicsImpostor)
                            }
                            ));
                            var o = function(t) {
                                return Math.max(t, e.PhysicsEngine.Epsilon)
                            }
                              , a = new e.Quaternion;
                            n.forEach((function(n) {
                                if (n.object.rotationQuaternion) {
                                    var s = n.object.rotationQuaternion;
                                    a = s.clone();
                                    var y = s.toEulerAngles()
                                      , l = n.getObjectExtendSize();
                                    if (n === t) {
                                        var c = t.getObjectCenter();
                                        t.object.getAbsolutePivotPoint().subtractToRef(c, r._tmpPositionVector),
                                        r._tmpPositionVector.divideInPlace(t.object.scaling),
                                        i.pos.push(c.x),
                                        i.pos.push(c.y),
                                        i.pos.push(c.z),
                                        i.posShape.push(0, 0, 0),
                                        i.rot.push(0),
                                        i.rot.push(0),
                                        i.rot.push(0),
                                        i.rotShape.push(0, 0, 0)
                                    } else {
                                        var h = n.object.getAbsolutePosition().subtract(t.object.getAbsolutePosition());
                                        i.posShape.push(h.x),
                                        i.posShape.push(h.y),
                                        i.posShape.push(h.z),
                                        i.pos.push(0, 0, 0),
                                        i.rot.push(0),
                                        i.rot.push(0),
                                        i.rot.push(0),
                                        i.rotShape.push(57.29577951308232 * y.x),
                                        i.rotShape.push(57.29577951308232 * y.y),
                                        i.rotShape.push(57.29577951308232 * y.z)
                                    }
                                    switch (n.type) {
                                    case e.PhysicsImpostor.ParticleImpostor:
                                        e.Tools.Warn("No Particle support in OIMO.js. using SphereImpostor instead");
                                    case e.PhysicsImpostor.SphereImpostor:
                                        var u = l.x
                                          , d = l.y
                                          , x = l.z
                                          , p = Math.max(o(u), o(d), o(x)) / 2;
                                        i.type.push("sphere"),
                                        i.size.push(p),
                                        i.size.push(p),
                                        i.size.push(p);
                                        break;
                                    case e.PhysicsImpostor.CylinderImpostor:
                                        var f = o(l.x) / 2
                                          , m = o(l.y);
                                        i.type.push("cylinder"),
                                        i.size.push(f),
                                        i.size.push(m),
                                        i.size.push(m);
                                        break;
                                    case e.PhysicsImpostor.PlaneImpostor:
                                    case e.PhysicsImpostor.BoxImpostor:
                                    default:
                                        f = o(l.x),
                                        m = o(l.y);
                                        var z = o(l.z);
                                        i.type.push("box"),
                                        i.size.push(f),
                                        i.size.push(m),
                                        i.size.push(z)
                                    }
                                    n.object.rotationQuaternion = s
                                }
                            }
                            )),
                            t.physicsBody = this.world.add(i),
                            t.physicsBody.resetQuaternion(a),
                            t.physicsBody.updatePosition(0)
                        } else
                            this._tmpPositionVector.copyFromFloats(0, 0, 0);
                        var s;
                        t.setDeltaPosition(this._tmpPositionVector)
                    }
                }
                ,
                r.prototype.removePhysicsBody = function(e) {
                    this.world.removeRigidBody(e.physicsBody)
                }
                ,
                r.prototype.generateJoint = function(t) {
                    var r = t.mainImpostor.physicsBody
                      , i = t.connectedImpostor.physicsBody;
                    if (r && i) {
                        var n, o = t.joint.jointData, a = o.nativeParams || {}, s = {
                            body1: r,
                            body2: i,
                            axe1: a.axe1 || (o.mainAxis ? o.mainAxis.asArray() : null),
                            axe2: a.axe2 || (o.connectedAxis ? o.connectedAxis.asArray() : null),
                            pos1: a.pos1 || (o.mainPivot ? o.mainPivot.asArray() : null),
                            pos2: a.pos2 || (o.connectedPivot ? o.connectedPivot.asArray() : null),
                            min: a.min,
                            max: a.max,
                            collision: a.collision || o.collision,
                            spring: a.spring,
                            world: this.world
                        };
                        switch (t.joint.type) {
                        case e.PhysicsJoint.BallAndSocketJoint:
                            n = "jointBall";
                            break;
                        case e.PhysicsJoint.SpringJoint:
                            e.Tools.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");
                            var y = o;
                            s.min = y.length || s.min,
                            s.max = Math.max(s.min, s.max);
                        case e.PhysicsJoint.DistanceJoint:
                            n = "jointDistance",
                            s.max = o.maxDistance;
                            break;
                        case e.PhysicsJoint.PrismaticJoint:
                            n = "jointPrisme";
                            break;
                        case e.PhysicsJoint.SliderJoint:
                            n = "jointSlide";
                            break;
                        case e.PhysicsJoint.WheelJoint:
                            n = "jointWheel";
                            break;
                        case e.PhysicsJoint.HingeJoint:
                        default:
                            n = "jointHinge"
                        }
                        s.type = n,
                        t.joint.physicsJoint = this.world.add(s)
                    }
                }
                ,
                r.prototype.removeJoint = function(t) {
                    try {
                        this.world.removeJoint(t.joint.physicsJoint)
                    } catch (t) {
                        e.Tools.Warn(t)
                    }
                }
                ,
                r.prototype.isSupported = function() {
                    return void 0 !== this.BJSOIMO
                }
                ,
                r.prototype.setTransformationFromPhysicsBody = function(e) {
                    e.physicsBody.sleeping || (e.object.position.copyFrom(e.physicsBody.getPosition()),
                    e.object.rotationQuaternion && e.object.rotationQuaternion.copyFrom(e.physicsBody.getQuaternion()))
                }
                ,
                r.prototype.setPhysicsBodyTransformation = function(e, t, r) {
                    var i = e.physicsBody;
                    i.position.copy(t),
                    i.orientation.copy(r),
                    i.syncShapes(),
                    i.awake()
                }
                ,
                r.prototype.setLinearVelocity = function(e, t) {
                    e.physicsBody.linearVelocity.copy(t)
                }
                ,
                r.prototype.setAngularVelocity = function(e, t) {
                    e.physicsBody.angularVelocity.copy(t)
                }
                ,
                r.prototype.getLinearVelocity = function(t) {
                    var r = t.physicsBody.linearVelocity;
                    return r ? new e.Vector3(r.x,r.y,r.z) : null
                }
                ,
                r.prototype.getAngularVelocity = function(t) {
                    var r = t.physicsBody.angularVelocity;
                    return r ? new e.Vector3(r.x,r.y,r.z) : null
                }
                ,
                r.prototype.setBodyMass = function(e, t) {
                    var r = 0 === t;
                    e.physicsBody.shapes.density = r ? 1 : t,
                    e.physicsBody.setupMass(r ? 2 : 1)
                }
                ,
                r.prototype.getBodyMass = function(e) {
                    return e.physicsBody.shapes.density
                }
                ,
                r.prototype.getBodyFriction = function(e) {
                    return e.physicsBody.shapes.friction
                }
                ,
                r.prototype.setBodyFriction = function(e, t) {
                    e.physicsBody.shapes.friction = t
                }
                ,
                r.prototype.getBodyRestitution = function(e) {
                    return e.physicsBody.shapes.restitution
                }
                ,
                r.prototype.setBodyRestitution = function(e, t) {
                    e.physicsBody.shapes.restitution = t
                }
                ,
                r.prototype.sleepBody = function(e) {
                    e.physicsBody.sleep()
                }
                ,
                r.prototype.wakeUpBody = function(e) {
                    e.physicsBody.awake()
                }
                ,
                r.prototype.updateDistanceJoint = function(e, t, r) {
                    e.physicsJoint.limitMotor.upperLimit = t,
                    void 0 !== r && (e.physicsJoint.limitMotor.lowerLimit = r)
                }
                ,
                r.prototype.setMotor = function(e, t, r, i) {
                    var n = i ? e.physicsJoint.rotationalLimitMotor2 : e.physicsJoint.rotationalLimitMotor1 || e.physicsJoint.rotationalLimitMotor || e.physicsJoint.limitMotor;
                    n && n.setMotor(t, r)
                }
                ,
                r.prototype.setLimit = function(e, t, r, i) {
                    var n = i ? e.physicsJoint.rotationalLimitMotor2 : e.physicsJoint.rotationalLimitMotor1 || e.physicsJoint.rotationalLimitMotor || e.physicsJoint.limitMotor;
                    n && n.setLimit(t, void 0 === r ? -t : r)
                }
                ,
                r.prototype.syncMeshWithImpostor = function(e, t) {
                    var r = t.physicsBody;
                    e.position.x = r.position.x,
                    e.position.y = r.position.y,
                    e.position.z = r.position.z,
                    e.rotationQuaternion && (e.rotationQuaternion.x = r.orientation.x,
                    e.rotationQuaternion.y = r.orientation.y,
                    e.rotationQuaternion.z = r.orientation.z,
                    e.rotationQuaternion.w = r.orientation.s)
                }
                ,
                r.prototype.getRadius = function(e) {
                    return e.physicsBody.shapes.radius
                }
                ,
                r.prototype.getBoxSizeToRef = function(e, t) {
                    var r = e.physicsBody.shapes;
                    t.x = 2 * r.halfWidth,
                    t.y = 2 * r.halfHeight,
                    t.z = 2 * r.halfDepth
                }
                ,
                r.prototype.dispose = function() {
                    this.world.clear()
                }
                ,
                r
            }();
            e.OimoJSPlugin = r
        }(s || (s = {})),
        function(e) {
            e.Scene.prototype.getPhysicsEngine = function() {
                return this._physicsEngine
            }
            ,
            e.Scene.prototype.enablePhysics = function(r, i) {
                if (void 0 === r && (r = null),
                this._physicsEngine)
                    return !0;
                var n = this._getComponent(e.SceneComponentConstants.NAME_PHYSICSENGINE);
                n || (n = new t(this),
                this._addComponent(n));
                try {
                    return this._physicsEngine = new e.PhysicsEngine(r,i),
                    !0
                } catch (t) {
                    return e.Tools.Error(t.message),
                    !1
                }
            }
            ,
            e.Scene.prototype.disablePhysicsEngine = function() {
                this._physicsEngine && (this._physicsEngine.dispose(),
                this._physicsEngine = null)
            }
            ,
            e.Scene.prototype.isPhysicsEnabled = function() {
                return void 0 !== this._physicsEngine
            }
            ,
            e.Scene.prototype.deleteCompoundImpostor = function(e) {
                var t = e.parts[0].mesh;
                t.physicsImpostor && (t.physicsImpostor.dispose(),
                t.physicsImpostor = null)
            }
            ,
            e.Scene.prototype._advancePhysicsEngineStep = function(e) {
                this._physicsEngine && (this.onBeforePhysicsObservable.notifyObservers(this),
                this._physicsEngine._step(e / 1e3),
                this.onAfterPhysicsObservable.notifyObservers(this))
            }
            ,
            Object.defineProperty(e.AbstractMesh.prototype, "physicsImpostor", {
                get: function() {
                    return this._physicsImpostor
                },
                set: function(e) {
                    var t = this;
                    this._physicsImpostor !== e && (this._disposePhysicsObserver && this.onDisposeObservable.remove(this._disposePhysicsObserver),
                    this._physicsImpostor = e,
                    e && (this._disposePhysicsObserver = this.onDisposeObservable.add((function() {
                        t.physicsImpostor && (t.physicsImpostor.dispose(),
                        t.physicsImpostor = null)
                    }
                    ))))
                },
                enumerable: !0,
                configurable: !0
            }),
            e.AbstractMesh.prototype.getPhysicsImpostor = function() {
                return this.physicsImpostor
            }
            ,
            e.AbstractMesh.prototype.applyImpulse = function(e, t) {
                return this.physicsImpostor ? (this.physicsImpostor.applyImpulse(e, t),
                this) : this
            }
            ,
            e.AbstractMesh.prototype.setPhysicsLinkWith = function(t, r, i, n) {
                return this.physicsImpostor && t.physicsImpostor ? (this.physicsImpostor.createJoint(t.physicsImpostor, e.PhysicsJoint.HingeJoint, {
                    mainPivot: r,
                    connectedPivot: i,
                    nativeParams: n
                }),
                this) : this
            }
            ;
            var t = function() {
                function t(t) {
                    var r = this;
                    this.name = e.SceneComponentConstants.NAME_PHYSICSENGINE,
                    this.scene = t,
                    this.scene.onBeforePhysicsObservable = new e.Observable,
                    this.scene.onAfterPhysicsObservable = new e.Observable,
                    this.scene.getDeterministicFrameTime = function() {
                        return r.scene._physicsEngine ? 1e3 * r.scene._physicsEngine.getTimeStep() : 1e3 / 60
                    }
                }
                return t.prototype.register = function() {}
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.dispose = function() {
                    this.scene.onBeforePhysicsObservable.clear(),
                    this.scene.onAfterPhysicsObservable.clear(),
                    this.scene._physicsEngine && this.scene.disablePhysicsEngine()
                }
                ,
                t
            }();
            e.PhysicsEngineSceneComponent = t
        }(s || (s = {})),
        function(e) {
            function t(e) {
                return e.charCodeAt(0) + (e.charCodeAt(1) << 8) + (e.charCodeAt(2) << 16) + (e.charCodeAt(3) << 24)
            }
            var r = t("DXT1")
              , i = t("DXT3")
              , n = t("DXT5")
              , o = t("DX10")
              , a = function() {
                function t() {}
                return t.GetDDSInfo = function(t) {
                    var a = new Int32Array(t,0,31)
                      , s = new Int32Array(t,0,35)
                      , y = 1;
                    131072 & a[2] && (y = Math.max(1, a[7]));
                    var l = a[21]
                      , c = l === o ? s[32] : 0
                      , h = e.Engine.TEXTURETYPE_UNSIGNED_INT;
                    switch (l) {
                    case 113:
                        h = e.Engine.TEXTURETYPE_HALF_FLOAT;
                        break;
                    case 116:
                        h = e.Engine.TEXTURETYPE_FLOAT;
                        break;
                    case o:
                        if (10 === c) {
                            h = e.Engine.TEXTURETYPE_HALF_FLOAT;
                            break
                        }
                    }
                    return {
                        width: a[4],
                        height: a[3],
                        mipmapCount: y,
                        isFourCC: 4 == (4 & a[20]),
                        isRGB: 64 == (64 & a[20]),
                        isLuminance: 131072 == (131072 & a[20]),
                        isCube: 512 == (512 & a[28]),
                        isCompressed: l === r || l === i || l === n,
                        dxgiFormat: c,
                        textureType: h
                    }
                }
                ,
                t._ToHalfFloat = function(e) {
                    t._FloatView || (t._FloatView = new Float32Array(1),
                    t._Int32View = new Int32Array(t._FloatView.buffer)),
                    t._FloatView[0] = e;
                    var r = t._Int32View[0]
                      , i = r >> 16 & 32768
                      , n = r >> 12 & 2047
                      , o = r >> 23 & 255;
                    return o < 103 ? i : o > 142 ? (i |= 31744,
                    i |= (255 == o ? 0 : 1) && 8388607 & r) : o < 113 ? i |= ((n |= 2048) >> 114 - o) + (n >> 113 - o & 1) : (i |= o - 112 << 10 | n >> 1,
                    i += 1 & n)
                }
                ,
                t._FromHalfFloat = function(e) {
                    var t = (32768 & e) >> 15
                      , r = (31744 & e) >> 10
                      , i = 1023 & e;
                    return 0 === r ? (t ? -1 : 1) * Math.pow(2, -14) * (i / Math.pow(2, 10)) : 31 == r ? i ? NaN : 1 / 0 * (t ? -1 : 1) : (t ? -1 : 1) * Math.pow(2, r - 15) * (1 + i / Math.pow(2, 10))
                }
                ,
                t._GetHalfFloatAsFloatRGBAArrayBuffer = function(e, r, i, n, o, a) {
                    for (var s = new Float32Array(n), y = new Uint16Array(o,i), l = 0, c = 0; c < r; c++)
                        for (var h = 0; h < e; h++) {
                            var u = 4 * (h + c * e);
                            s[l] = t._FromHalfFloat(y[u]),
                            s[l + 1] = t._FromHalfFloat(y[u + 1]),
                            s[l + 2] = t._FromHalfFloat(y[u + 2]),
                            t.StoreLODInAlphaChannel ? s[l + 3] = a : s[l + 3] = t._FromHalfFloat(y[u + 3]),
                            l += 4
                        }
                    return s
                }
                ,
                t._GetHalfFloatRGBAArrayBuffer = function(e, r, i, n, o, a) {
                    if (t.StoreLODInAlphaChannel) {
                        for (var s = new Uint16Array(n), y = new Uint16Array(o,i), l = 0, c = 0; c < r; c++)
                            for (var h = 0; h < e; h++) {
                                var u = 4 * (h + c * e);
                                s[l] = y[u],
                                s[l + 1] = y[u + 1],
                                s[l + 2] = y[u + 2],
                                s[l + 3] = t._ToHalfFloat(a),
                                l += 4
                            }
                        return s
                    }
                    return new Uint16Array(o,i,n)
                }
                ,
                t._GetFloatRGBAArrayBuffer = function(e, r, i, n, o, a) {
                    if (t.StoreLODInAlphaChannel) {
                        for (var s = new Float32Array(n), y = new Float32Array(o,i), l = 0, c = 0; c < r; c++)
                            for (var h = 0; h < e; h++) {
                                var u = 4 * (h + c * e);
                                s[l] = y[u],
                                s[l + 1] = y[u + 1],
                                s[l + 2] = y[u + 2],
                                s[l + 3] = a,
                                l += 4
                            }
                        return s
                    }
                    return new Float32Array(o,i,n)
                }
                ,
                t._GetFloatAsUIntRGBAArrayBuffer = function(r, i, n, o, a, s) {
                    for (var y = new Uint8Array(o), l = new Float32Array(a,n), c = 0, h = 0; h < i; h++)
                        for (var u = 0; u < r; u++) {
                            var d = 4 * (u + h * r);
                            y[c] = 255 * e.Scalar.Clamp(l[d]),
                            y[c + 1] = 255 * e.Scalar.Clamp(l[d + 1]),
                            y[c + 2] = 255 * e.Scalar.Clamp(l[d + 2]),
                            t.StoreLODInAlphaChannel ? y[c + 3] = s : y[c + 3] = 255 * e.Scalar.Clamp(l[d + 3]),
                            c += 4
                        }
                    return y
                }
                ,
                t._GetHalfFloatAsUIntRGBAArrayBuffer = function(r, i, n, o, a, s) {
                    for (var y = new Uint8Array(o), l = new Uint16Array(a,n), c = 0, h = 0; h < i; h++)
                        for (var u = 0; u < r; u++) {
                            var d = 4 * (u + h * r);
                            y[c] = 255 * e.Scalar.Clamp(t._FromHalfFloat(l[d])),
                            y[c + 1] = 255 * e.Scalar.Clamp(t._FromHalfFloat(l[d + 1])),
                            y[c + 2] = 255 * e.Scalar.Clamp(t._FromHalfFloat(l[d + 2])),
                            t.StoreLODInAlphaChannel ? y[c + 3] = s : y[c + 3] = 255 * e.Scalar.Clamp(t._FromHalfFloat(l[d + 3])),
                            c += 4
                        }
                    return y
                }
                ,
                t._GetRGBAArrayBuffer = function(e, t, r, i, n, o, a, s, y) {
                    for (var l = new Uint8Array(i), c = new Uint8Array(n,r), h = 0, u = 0; u < t; u++)
                        for (var d = 0; d < e; d++) {
                            var x = 4 * (d + u * e);
                            l[h] = c[x + o],
                            l[h + 1] = c[x + a],
                            l[h + 2] = c[x + s],
                            l[h + 3] = c[x + y],
                            h += 4
                        }
                    return l
                }
                ,
                t._ExtractLongWordOrder = function(e) {
                    return 0 === e || 255 === e || -16777216 === e ? 0 : 1 + t._ExtractLongWordOrder(e >> 8)
                }
                ,
                t._GetRGBArrayBuffer = function(e, t, r, i, n, o, a, s) {
                    for (var y = new Uint8Array(i), l = new Uint8Array(n,r), c = 0, h = 0; h < t; h++)
                        for (var u = 0; u < e; u++) {
                            var d = 3 * (u + h * e);
                            y[c] = l[d + o],
                            y[c + 1] = l[d + a],
                            y[c + 2] = l[d + s],
                            c += 3
                        }
                    return y
                }
                ,
                t._GetLuminanceArrayBuffer = function(e, t, r, i, n) {
                    for (var o = new Uint8Array(i), a = new Uint8Array(n,r), s = 0, y = 0; y < t; y++)
                        for (var l = 0; l < e; l++) {
                            var c = l + y * e;
                            o[s] = a[c],
                            s++
                        }
                    return o
                }
                ,
                t.UploadDDSLevels = function(a, s, y, l, c, h, u, d) {
                    void 0 === u && (u = -1);
                    var x = null;
                    l.sphericalPolynomial && (x = new Array);
                    var p, f, m, z, _, g, v, b = a.getCaps().s3tc, T = new Int32Array(y,0,31), E = 0, P = 0, A = 1;
                    if (542327876 === T[0])
                        if (l.isFourCC || l.isRGB || l.isLuminance)
                            if (!l.isCompressed || b) {
                                var S = T[22];
                                z = T[1] + 4;
                                var M, C = !1;
                                if (l.isFourCC)
                                    switch (p = T[21]) {
                                    case r:
                                        A = 8,
                                        P = b.COMPRESSED_RGBA_S3TC_DXT1_EXT;
                                        break;
                                    case i:
                                        A = 16,
                                        P = b.COMPRESSED_RGBA_S3TC_DXT3_EXT;
                                        break;
                                    case n:
                                        A = 16,
                                        P = b.COMPRESSED_RGBA_S3TC_DXT5_EXT;
                                        break;
                                    case 113:
                                    case 116:
                                        C = !0;
                                        break;
                                    case o:
                                        z += 20;
                                        var R = !1;
                                        switch (l.dxgiFormat) {
                                        case 10:
                                            C = !0,
                                            R = !0;
                                            break;
                                        case 88:
                                            l.isRGB = !0,
                                            l.isFourCC = !1,
                                            S = 32,
                                            R = !0
                                        }
                                        if (R)
                                            break;
                                    default:
                                        return void console.error("Unsupported FourCC code:", (M = p,
                                        String.fromCharCode(255 & M, M >> 8 & 255, M >> 16 & 255, M >> 24 & 255)))
                                    }
                                var O = t._ExtractLongWordOrder(T[23])
                                  , I = t._ExtractLongWordOrder(T[24])
                                  , w = t._ExtractLongWordOrder(T[25])
                                  , D = t._ExtractLongWordOrder(T[26]);
                                C && (P = a._getRGBABufferInternalSizedFormat(l.textureType)),
                                g = 1,
                                131072 & T[2] && !1 !== c && (g = Math.max(1, T[7]));
                                for (var L = 0; L < h; L++) {
                                    for (f = T[4],
                                    m = T[3],
                                    v = 0; v < g; ++v) {
                                        if (-1 === u || u === v) {
                                            var B = -1 === u ? v : 0;
                                            if (!l.isCompressed && l.isFourCC) {
                                                s.format = e.Engine.TEXTUREFORMAT_RGBA,
                                                E = f * m * 4;
                                                var F = null;
                                                a._badOS || a._badDesktopOS || !a.getCaps().textureHalfFloat && !a.getCaps().textureFloat ? (128 === S ? (F = t._GetFloatAsUIntRGBAArrayBuffer(f, m, z, E, y, B),
                                                x && 0 == B && x.push(t._GetFloatRGBAArrayBuffer(f, m, z, E, y, B))) : 64 === S && (F = t._GetHalfFloatAsUIntRGBAArrayBuffer(f, m, z, E, y, B),
                                                x && 0 == B && x.push(t._GetHalfFloatAsFloatRGBAArrayBuffer(f, m, z, E, y, B))),
                                                s.type = e.Engine.TEXTURETYPE_UNSIGNED_INT) : 128 === S ? (s.type = e.Engine.TEXTURETYPE_FLOAT,
                                                F = t._GetFloatRGBAArrayBuffer(f, m, z, E, y, B),
                                                x && 0 == B && x.push(F)) : 64 !== S || a.getCaps().textureHalfFloat ? (s.type = e.Engine.TEXTURETYPE_HALF_FLOAT,
                                                F = t._GetHalfFloatRGBAArrayBuffer(f, m, z, E, y, B),
                                                x && 0 == B && x.push(t._GetHalfFloatAsFloatRGBAArrayBuffer(f, m, z, E, y, B))) : (s.type = e.Engine.TEXTURETYPE_FLOAT,
                                                F = t._GetHalfFloatAsFloatRGBAArrayBuffer(f, m, z, E, y, B),
                                                x && 0 == B && x.push(F)),
                                                F && a._uploadDataToTextureDirectly(s, F, L, B)
                                            } else if (l.isRGB)
                                                s.type = e.Engine.TEXTURETYPE_UNSIGNED_INT,
                                                24 === S ? (s.format = e.Engine.TEXTUREFORMAT_RGB,
                                                E = f * m * 3,
                                                _ = t._GetRGBArrayBuffer(f, m, z, E, y, O, I, w),
                                                a._uploadDataToTextureDirectly(s, _, L, B)) : (s.format = e.Engine.TEXTUREFORMAT_RGBA,
                                                E = f * m * 4,
                                                _ = t._GetRGBAArrayBuffer(f, m, z, E, y, O, I, w, D),
                                                a._uploadDataToTextureDirectly(s, _, L, B));
                                            else if (l.isLuminance) {
                                                var N = a._getUnpackAlignement()
                                                  , V = f;
                                                E = Math.floor((f + N - 1) / N) * N * (m - 1) + V,
                                                _ = t._GetLuminanceArrayBuffer(f, m, z, E, y),
                                                s.format = e.Engine.TEXTUREFORMAT_LUMINANCE,
                                                s.type = e.Engine.TEXTURETYPE_UNSIGNED_INT,
                                                a._uploadDataToTextureDirectly(s, _, L, B)
                                            } else
                                                E = Math.max(4, f) / 4 * Math.max(4, m) / 4 * A,
                                                _ = new Uint8Array(y,z,E),
                                                s.type = e.Engine.TEXTURETYPE_UNSIGNED_INT,
                                                a._uploadCompressedDataToTextureDirectly(s, P, f, m, _, L, B)
                                        }
                                        z += S ? f * m * (S / 8) : E,
                                        f *= .5,
                                        m *= .5,
                                        f = Math.max(1, f),
                                        m = Math.max(1, m)
                                    }
                                    if (void 0 !== d)
                                        break
                                }
                                x && x.length > 0 ? l.sphericalPolynomial = e.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial({
                                    size: T[4],
                                    right: x[0],
                                    left: x[1],
                                    up: x[2],
                                    down: x[3],
                                    front: x[4],
                                    back: x[5],
                                    format: e.Engine.TEXTUREFORMAT_RGBA,
                                    type: e.Engine.TEXTURETYPE_FLOAT,
                                    gammaSpace: !1
                                }) : l.sphericalPolynomial = void 0
                            } else
                                e.Tools.Error("Compressed textures are not supported on this platform.");
                        else
                            e.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");
                    else
                        e.Tools.Error("Invalid magic number in DDS header")
                }
                ,
                t.StoreLODInAlphaChannel = !1,
                t
            }();
            e.DDSTools = a
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.supportCascades = !0
                }
                return t.prototype.canLoad = function(e, t, r, i, n) {
                    return 0 === e.indexOf(".dds")
                }
                ,
                t.prototype.transformUrl = function(e, t) {
                    return e
                }
                ,
                t.prototype.getFallbackTextureUrl = function(e, t) {
                    return null
                }
                ,
                t.prototype.loadCubeData = function(t, r, i, n, o) {
                    var a, s = r.getEngine(), y = !1;
                    if (Array.isArray(t))
                        for (var l = 0; l < t.length; l++) {
                            var c = t[l];
                            a = e.DDSTools.GetDDSInfo(c),
                            r.width = a.width,
                            r.height = a.height,
                            y = (a.isRGB || a.isLuminance || a.mipmapCount > 1) && r.generateMipMaps,
                            s._unpackFlipY(a.isCompressed),
                            e.DDSTools.UploadDDSLevels(s, r, c, a, y, 6, -1, l),
                            a.isFourCC || 1 !== a.mipmapCount || s.generateMipMapsForCubemap(r)
                        }
                    else {
                        var h = t;
                        a = e.DDSTools.GetDDSInfo(h),
                        r.width = a.width,
                        r.height = a.height,
                        i && (a.sphericalPolynomial = new e.SphericalPolynomial),
                        y = (a.isRGB || a.isLuminance || a.mipmapCount > 1) && r.generateMipMaps,
                        s._unpackFlipY(a.isCompressed),
                        e.DDSTools.UploadDDSLevels(s, r, h, a, y, 6),
                        a.isFourCC || 1 !== a.mipmapCount || s.generateMipMapsForCubemap(r)
                    }
                    s._setCubeMapTextureParams(y),
                    r.isReady = !0,
                    n && n({
                        isDDS: !0,
                        width: r.width,
                        info: a,
                        data: t,
                        texture: r
                    })
                }
                ,
                t.prototype.loadData = function(t, r, i) {
                    var n = e.DDSTools.GetDDSInfo(t)
                      , o = (n.isRGB || n.isLuminance || n.mipmapCount > 1) && r.generateMipMaps && n.width >> n.mipmapCount - 1 == 1;
                    i(n.width, n.height, o, n.isFourCC, (function() {
                        e.DDSTools.UploadDDSLevels(r.getEngine(), r, t, n, o, 1)
                    }
                    ))
                }
                ,
                t
            }();
            e.Engine._TextureLoaders.push(new t)
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.GetTGAHeader = function(e) {
                    var t = 0;
                    return {
                        id_length: e[t++],
                        colormap_type: e[t++],
                        image_type: e[t++],
                        colormap_index: e[t++] | e[t++] << 8,
                        colormap_length: e[t++] | e[t++] << 8,
                        colormap_size: e[t++],
                        origin: [e[t++] | e[t++] << 8, e[t++] | e[t++] << 8],
                        width: e[t++] | e[t++] << 8,
                        height: e[t++] | e[t++] << 8,
                        pixel_size: e[t++],
                        flags: e[t++]
                    }
                }
                ,
                t.UploadContent = function(r, i) {
                    if (i.length < 19)
                        e.Tools.Error("Unable to load TGA file - Not enough data to contain header");
                    else {
                        var n = 18
                          , o = t.GetTGAHeader(i);
                        if (o.id_length + n > i.length)
                            e.Tools.Error("Unable to load TGA file - Not enough data");
                        else {
                            n += o.id_length;
                            var a, s = !1, y = !1, l = !1;
                            switch (o.image_type) {
                            case t._TYPE_RLE_INDEXED:
                                s = !0;
                            case t._TYPE_INDEXED:
                                y = !0;
                                break;
                            case t._TYPE_RLE_RGB:
                                s = !0;
                            case t._TYPE_RGB:
                                break;
                            case t._TYPE_RLE_GREY:
                                s = !0;
                            case t._TYPE_GREY:
                                l = !0
                            }
                            var c, h, u, d, x, p, f, m = o.pixel_size >> 3, z = o.width * o.height * m;
                            if (y && (c = i.subarray(n, n += o.colormap_length * (o.colormap_size >> 3))),
                            s) {
                                var _, g, v;
                                a = new Uint8Array(z);
                                for (var b = 0, T = new Uint8Array(m); n < z && b < z; )
                                    if (g = 1 + (127 & (_ = i[n++])),
                                    128 & _) {
                                        for (v = 0; v < m; ++v)
                                            T[v] = i[n++];
                                        for (v = 0; v < g; ++v)
                                            a.set(T, b + v * m);
                                        b += m * g
                                    } else {
                                        for (g *= m,
                                        v = 0; v < g; ++v)
                                            a[b + v] = i[n++];
                                        b += g
                                    }
                            } else
                                a = i.subarray(n, n += y ? o.width * o.height : z);
                            switch ((o.flags & t._ORIGIN_MASK) >> t._ORIGIN_SHIFT) {
                            default:
                            case t._ORIGIN_UL:
                                h = 0,
                                d = 1,
                                f = o.width,
                                u = 0,
                                x = 1,
                                p = o.height;
                                break;
                            case t._ORIGIN_BL:
                                h = 0,
                                d = 1,
                                f = o.width,
                                u = o.height - 1,
                                x = -1,
                                p = -1;
                                break;
                            case t._ORIGIN_UR:
                                h = o.width - 1,
                                d = -1,
                                f = -1,
                                u = 0,
                                x = 1,
                                p = o.height;
                                break;
                            case t._ORIGIN_BR:
                                h = o.width - 1,
                                d = -1,
                                f = -1,
                                u = o.height - 1,
                                x = -1,
                                p = -1
                            }
                            var E = t["_getImageData" + (l ? "Grey" : "") + o.pixel_size + "bits"](o, c, a, u, x, p, h, d, f);
                            r.getEngine()._uploadDataToTextureDirectly(r, E)
                        }
                    }
                }
                ,
                t._getImageData8bits = function(e, t, r, i, n, o, a, s, y) {
                    var l, c, h, u = r, d = t, x = e.width, p = e.height, f = 0, m = new Uint8Array(x * p * 4);
                    for (h = i; h !== o; h += n)
                        for (c = a; c !== y; c += s,
                        f++)
                            l = u[f],
                            m[4 * (c + x * h) + 3] = 255,
                            m[4 * (c + x * h) + 2] = d[3 * l + 0],
                            m[4 * (c + x * h) + 1] = d[3 * l + 1],
                            m[4 * (c + x * h) + 0] = d[3 * l + 2];
                    return m
                }
                ,
                t._getImageData16bits = function(e, t, r, i, n, o, a, s, y) {
                    var l, c, h, u = r, d = e.width, x = e.height, p = 0, f = new Uint8Array(d * x * 4);
                    for (h = i; h !== o; h += n)
                        for (c = a; c !== y; c += s,
                        p += 2) {
                            var m = 255 * ((31744 & (l = u[p + 0] + (u[p + 1] << 8))) >> 10) / 31 | 0
                              , z = 255 * ((992 & l) >> 5) / 31 | 0
                              , _ = 255 * (31 & l) / 31 | 0;
                            f[4 * (c + d * h) + 0] = m,
                            f[4 * (c + d * h) + 1] = z,
                            f[4 * (c + d * h) + 2] = _,
                            f[4 * (c + d * h) + 3] = 32768 & l ? 0 : 255
                        }
                    return f
                }
                ,
                t._getImageData24bits = function(e, t, r, i, n, o, a, s, y) {
                    var l, c, h = r, u = e.width, d = e.height, x = 0, p = new Uint8Array(u * d * 4);
                    for (c = i; c !== o; c += n)
                        for (l = a; l !== y; l += s,
                        x += 3)
                            p[4 * (l + u * c) + 3] = 255,
                            p[4 * (l + u * c) + 2] = h[x + 0],
                            p[4 * (l + u * c) + 1] = h[x + 1],
                            p[4 * (l + u * c) + 0] = h[x + 2];
                    return p
                }
                ,
                t._getImageData32bits = function(e, t, r, i, n, o, a, s, y) {
                    var l, c, h = r, u = e.width, d = e.height, x = 0, p = new Uint8Array(u * d * 4);
                    for (c = i; c !== o; c += n)
                        for (l = a; l !== y; l += s,
                        x += 4)
                            p[4 * (l + u * c) + 2] = h[x + 0],
                            p[4 * (l + u * c) + 1] = h[x + 1],
                            p[4 * (l + u * c) + 0] = h[x + 2],
                            p[4 * (l + u * c) + 3] = h[x + 3];
                    return p
                }
                ,
                t._getImageDataGrey8bits = function(e, t, r, i, n, o, a, s, y) {
                    var l, c, h, u = r, d = e.width, x = e.height, p = 0, f = new Uint8Array(d * x * 4);
                    for (h = i; h !== o; h += n)
                        for (c = a; c !== y; c += s,
                        p++)
                            l = u[p],
                            f[4 * (c + d * h) + 0] = l,
                            f[4 * (c + d * h) + 1] = l,
                            f[4 * (c + d * h) + 2] = l,
                            f[4 * (c + d * h) + 3] = 255;
                    return f
                }
                ,
                t._getImageDataGrey16bits = function(e, t, r, i, n, o, a, s, y) {
                    var l, c, h = r, u = e.width, d = e.height, x = 0, p = new Uint8Array(u * d * 4);
                    for (c = i; c !== o; c += n)
                        for (l = a; l !== y; l += s,
                        x += 2)
                            p[4 * (l + u * c) + 0] = h[x + 0],
                            p[4 * (l + u * c) + 1] = h[x + 0],
                            p[4 * (l + u * c) + 2] = h[x + 0],
                            p[4 * (l + u * c) + 3] = h[x + 1];
                    return p
                }
                ,
                t._TYPE_INDEXED = 1,
                t._TYPE_RGB = 2,
                t._TYPE_GREY = 3,
                t._TYPE_RLE_INDEXED = 9,
                t._TYPE_RLE_RGB = 10,
                t._TYPE_RLE_GREY = 11,
                t._ORIGIN_MASK = 48,
                t._ORIGIN_SHIFT = 4,
                t._ORIGIN_BL = 0,
                t._ORIGIN_BR = 1,
                t._ORIGIN_UL = 2,
                t._ORIGIN_UR = 3,
                t
            }();
            e.TGATools = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.supportCascades = !1
                }
                return t.prototype.canLoad = function(e, t, r, i, n) {
                    return 0 === e.indexOf(".tga")
                }
                ,
                t.prototype.transformUrl = function(e, t) {
                    return e
                }
                ,
                t.prototype.getFallbackTextureUrl = function(e, t) {
                    return null
                }
                ,
                t.prototype.loadCubeData = function(e, t, r, i, n) {
                    throw ".env not supported in Cube."
                }
                ,
                t.prototype.loadData = function(t, r, i) {
                    var n = new Uint8Array(t)
                      , o = e.TGATools.GetTGAHeader(n);
                    i(o.width, o.height, r.generateMipMaps, !1, (function() {
                        e.TGATools.UploadContent(r, n)
                    }
                    ))
                }
                ,
                t
            }();
            e.Engine._TextureLoaders.push(new t)
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(r, i, n, o) {
                    this.arrayBuffer = r;
                    var a = new Uint8Array(this.arrayBuffer,0,12);
                    if (171 === a[0] && 75 === a[1] && 84 === a[2] && 88 === a[3] && 32 === a[4] && 49 === a[5] && 49 === a[6] && 187 === a[7] && 13 === a[8] && 10 === a[9] && 26 === a[10] && 10 === a[11]) {
                        var s = new Int32Array(this.arrayBuffer,12,13)
                          , y = 16909060 === s[0];
                        this.glType = y ? this.switchEndianness(s[1]) : s[1],
                        this.glTypeSize = y ? this.switchEndianness(s[2]) : s[2],
                        this.glFormat = y ? this.switchEndianness(s[3]) : s[3],
                        this.glInternalFormat = y ? this.switchEndianness(s[4]) : s[4],
                        this.glBaseInternalFormat = y ? this.switchEndianness(s[5]) : s[5],
                        this.pixelWidth = y ? this.switchEndianness(s[6]) : s[6],
                        this.pixelHeight = y ? this.switchEndianness(s[7]) : s[7],
                        this.pixelDepth = y ? this.switchEndianness(s[8]) : s[8],
                        this.numberOfArrayElements = y ? this.switchEndianness(s[9]) : s[9],
                        this.numberOfFaces = y ? this.switchEndianness(s[10]) : s[10],
                        this.numberOfMipmapLevels = y ? this.switchEndianness(s[11]) : s[11],
                        this.bytesOfKeyValueData = y ? this.switchEndianness(s[12]) : s[12],
                        0 === this.glType ? (this.numberOfMipmapLevels = Math.max(1, this.numberOfMipmapLevels),
                        0 !== this.pixelHeight && 0 === this.pixelDepth ? 0 === this.numberOfArrayElements ? this.numberOfFaces === i ? this.loadType = t.COMPRESSED_2D : e.Tools.Error("number of faces expected" + i + ", but found " + this.numberOfFaces) : e.Tools.Error("texture arrays not currently supported") : e.Tools.Error("only 2D textures currently supported")) : e.Tools.Error("only compressed formats currently supported")
                    } else
                        e.Tools.Error("texture missing KTX identifier")
                }
                return t.prototype.switchEndianness = function(e) {
                    return (255 & e) << 24 | (65280 & e) << 8 | e >> 8 & 65280 | e >> 24 & 255
                }
                ,
                t.prototype.uploadLevels = function(e, r) {
                    switch (this.loadType) {
                    case t.COMPRESSED_2D:
                        this._upload2DCompressedLevels(e, r);
                        break;
                    case t.TEX_2D:
                    case t.COMPRESSED_3D:
                    case t.TEX_3D:
                    }
                }
                ,
                t.prototype._upload2DCompressedLevels = function(e, r) {
                    for (var i = t.HEADER_LEN + this.bytesOfKeyValueData, n = this.pixelWidth, o = this.pixelHeight, a = r ? this.numberOfMipmapLevels : 1, s = 0; s < a; s++) {
                        var y = new Int32Array(this.arrayBuffer,i,1)[0];
                        i += 4;
                        for (var l = 0; l < this.numberOfFaces; l++) {
                            var c = new Uint8Array(this.arrayBuffer,i,y);
                            e.getEngine()._uploadCompressedDataToTextureDirectly(e, this.glInternalFormat, n, o, c, l, s),
                            i += y,
                            i += 3 - (y + 3) % 4
                        }
                        n = Math.max(1, .5 * n),
                        o = Math.max(1, .5 * o)
                    }
                }
                ,
                t.HEADER_LEN = 64,
                t.COMPRESSED_2D = 0,
                t.COMPRESSED_3D = 1,
                t.TEX_2D = 2,
                t.TEX_3D = 3,
                t
            }();
            e.KhronosTextureContainer = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.supportCascades = !1
                }
                return t.prototype.canLoad = function(e, t, r, i, n) {
                    return !(!t || i || r || n)
                }
                ,
                t.prototype.transformUrl = function(e, t) {
                    var r = e.lastIndexOf(".");
                    return (r > -1 ? e.substring(0, r) : e) + t
                }
                ,
                t.prototype.getFallbackTextureUrl = function(e, t) {
                    var r = new RegExp(t + "$");
                    return e.replace(r, "")
                }
                ,
                t.prototype.loadCubeData = function(t, r, i, n, o) {
                    if (!Array.isArray(t)) {
                        var a = r.getEngine()
                          , s = new e.KhronosTextureContainer(t,6)
                          , y = s.numberOfMipmapLevels > 1 && r.generateMipMaps;
                        a._unpackFlipY(!0),
                        s.uploadLevels(r, r.generateMipMaps),
                        r.width = s.pixelWidth,
                        r.height = s.pixelHeight,
                        a._setCubeMapTextureParams(y),
                        r.isReady = !0
                    }
                }
                ,
                t.prototype.loadData = function(t, r, i) {
                    var n = new e.KhronosTextureContainer(t,1);
                    i(n.pixelWidth, n.pixelHeight, !1, !0, (function() {
                        n.uploadLevels(r, r.generateMipMaps)
                    }
                    ))
                }
                ,
                t
            }();
            e.Engine._TextureLoaders.unshift(new t)
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.GetEnvInfo = function(r) {
                    for (var i = new DataView(r), n = 0, o = 0; o < t._MagicBytes.length; o++)
                        if (i.getUint8(n++) !== t._MagicBytes[o])
                            return e.Tools.Error("Not a babylon environment map"),
                            null;
                    for (var a = "", s = 0; s = i.getUint8(n++); )
                        a += String.fromCharCode(s);
                    var y = JSON.parse(a);
                    return y.specular && (y.specular.specularDataPosition = n,
                    y.specular.lodGenerationScale = y.specular.lodGenerationScale || .8),
                    y
                }
                ,
                t.CreateEnvTextureAsync = function(r) {
                    var i = this
                      , n = r.getInternalTexture();
                    if (!n)
                        return Promise.reject("The cube texture is invalid.");
                    if (!r._prefiltered)
                        return Promise.reject("The cube texture is invalid (not prefiltered).");
                    var o = n.getEngine();
                    if (o && o.premultipliedAlpha)
                        return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");
                    if (r.textureType === e.Engine.TEXTURETYPE_UNSIGNED_INT)
                        return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");
                    var a = o.getRenderingCanvas();
                    if (!a)
                        return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");
                    var s = e.Engine.TEXTURETYPE_FLOAT;
                    if (!o.getCaps().textureFloatRender && (s = e.Engine.TEXTURETYPE_HALF_FLOAT,
                    !o.getCaps().textureHalfFloatRender))
                        return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");
                    var y = n.width
                      , l = new e.Scene(o)
                      , c = {}
                      , h = []
                      , u = e.Scalar.Log2(n.width);
                    u = Math.round(u);
                    for (var d = function(t) {
                        for (var i = Math.pow(2, u - t), n = function(n) {
                            var y = r.readPixels(n, t)
                              , u = o.createRawTexture(y, i, i, e.Engine.TEXTUREFORMAT_RGBA, !1, !1, e.Texture.NEAREST_SAMPLINGMODE, null, s)
                              , d = new Promise((function(r, s) {
                                var y = new e.PostProcess("rgbdEncode","rgbdEncode",null,null,1,null,e.Texture.NEAREST_SAMPLINGMODE,o,!1,void 0,e.Engine.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);
                                y.getEffect().executeWhenCompiled((function() {
                                    y.onApply = function(e) {
                                        e._bindTexture("textureSampler", u)
                                    }
                                    ;
                                    var s = o.getRenderWidth()
                                      , h = o.getRenderHeight();
                                    o.setSize(i, i),
                                    l.postProcessManager.directRender([y], null),
                                    e.Tools.ToBlob(a, (function(e) {
                                        var i = new FileReader;
                                        i.onload = function(e) {
                                            var i = e.target.result;
                                            c[6 * t + n] = i,
                                            r()
                                        }
                                        ,
                                        i.readAsArrayBuffer(e)
                                    }
                                    )),
                                    o.setSize(s, h)
                                }
                                ))
                            }
                            ));
                            h.push(d)
                        }, y = 0; y < 6; y++)
                            n(y)
                    }, x = 0; x <= u; x++)
                        d(x);
                    return Promise.all(h).then((function() {
                        l.dispose();
                        for (var e = {
                            version: 1,
                            width: y,
                            irradiance: i._CreateEnvTextureIrradiance(r),
                            specular: {
                                mipmaps: [],
                                lodGenerationScale: r.lodGenerationScale
                            }
                        }, n = 0, o = 0; o <= u; o++)
                            for (var a = 0; a < 6; a++) {
                                var s = c[6 * o + a].byteLength;
                                e.specular.mipmaps.push({
                                    length: s,
                                    position: n
                                }),
                                n += s
                            }
                        for (var h = JSON.stringify(e), d = new ArrayBuffer(h.length + 1), x = new Uint8Array(d), p = (o = 0,
                        h.length); o < p; o++)
                            x[o] = h.charCodeAt(o);
                        x[h.length] = 0;
                        var f = t._MagicBytes.length + n + d.byteLength
                          , m = new ArrayBuffer(f)
                          , z = new Uint8Array(m)
                          , _ = new DataView(m)
                          , g = 0;
                        for (o = 0; o < t._MagicBytes.length; o++)
                            _.setUint8(g++, t._MagicBytes[o]);
                        z.set(new Uint8Array(d), g),
                        g += d.byteLength;
                        for (o = 0; o <= u; o++)
                            for (a = 0; a < 6; a++) {
                                var v = c[6 * o + a];
                                z.set(new Uint8Array(v), g),
                                g += v.byteLength
                            }
                        return m
                    }
                    ))
                }
                ,
                t._CreateEnvTextureIrradiance = function(e) {
                    var t = e.sphericalPolynomial;
                    return null == t ? null : {
                        x: [t.x.x, t.x.y, t.x.z],
                        y: [t.y.x, t.y.y, t.y.z],
                        z: [t.z.x, t.z.y, t.z.z],
                        xx: [t.xx.x, t.xx.y, t.xx.z],
                        yy: [t.yy.x, t.yy.y, t.yy.z],
                        zz: [t.zz.x, t.zz.y, t.zz.z],
                        yz: [t.yz.x, t.yz.y, t.yz.z],
                        zx: [t.zx.x, t.zx.y, t.zx.z],
                        xy: [t.xy.x, t.xy.y, t.xy.z]
                    }
                }
                ,
                t.UploadEnvLevelsAsync = function(r, i, n) {
                    if (1 !== n.version)
                        throw new Error('Unsupported babylon environment map version "' + n.version + '"');
                    var o = n.specular;
                    if (!o)
                        return Promise.resolve();
                    var a = e.Scalar.Log2(n.width);
                    if (a = Math.round(a) + 1,
                    o.mipmaps.length !== 6 * a)
                        throw new Error('Unsupported specular mipmaps number "' + o.mipmaps.length + '"');
                    r._lodGenerationScale = o.lodGenerationScale;
                    for (var s = new Array(a), y = 0; y < a; y++) {
                        s[y] = new Array(6);
                        for (var l = 0; l < 6; l++) {
                            var c = o.mipmaps[6 * y + l];
                            s[y][l] = new Uint8Array(i,o.specularDataPosition + c.position,c.length)
                        }
                    }
                    return t.UploadLevelsAsync(r, s)
                }
                ,
                t.UploadLevelsAsync = function(t, r) {
                    if (!e.Tools.IsExponentOfTwo(t.width))
                        throw new Error("Texture size must be a power of two");
                    var i = Math.round(e.Scalar.Log2(t.width)) + 1
                      , n = t.getEngine()
                      , o = !1
                      , a = !1
                      , s = null
                      , y = null
                      , l = null
                      , c = n.getCaps();
                    if (t.format = e.Engine.TEXTUREFORMAT_RGBA,
                    t.type = e.Engine.TEXTURETYPE_UNSIGNED_INT,
                    t.generateMipMaps = !0,
                    n.updateTextureSamplingMode(e.Texture.TRILINEAR_SAMPLINGMODE, t),
                    c.textureLOD ? n.webGLVersion < 2 ? o = !1 : c.textureHalfFloatRender && c.textureHalfFloatLinearFiltering ? (o = !0,
                    t.type = e.Engine.TEXTURETYPE_HALF_FLOAT) : c.textureFloatRender && c.textureFloatLinearFiltering && (o = !0,
                    t.type = e.Engine.TEXTURETYPE_FLOAT) : (o = !1,
                    a = !0,
                    l = {}),
                    o)
                        s = new e.PostProcess("rgbdDecode","rgbdDecode",null,null,1,null,e.Texture.TRILINEAR_SAMPLINGMODE,n,!1,void 0,t.type,void 0,null,!1),
                        t._isRGBD = !1,
                        t.invertY = !1,
                        y = n.createRenderTargetCubeTexture(t.width, {
                            generateDepthBuffer: !1,
                            generateMipMaps: !0,
                            generateStencilBuffer: !1,
                            samplingMode: e.Texture.TRILINEAR_SAMPLINGMODE,
                            type: t.type,
                            format: e.Engine.TEXTUREFORMAT_RGBA
                        });
                    else if (t._isRGBD = !0,
                    t.invertY = !0,
                    a)
                        for (var h = t._lodGenerationScale, u = t._lodGenerationOffset, d = 0; d < 3; d++) {
                            var x = (i - 1) * h + u
                              , p = u + (x - u) * (1 - d / 2)
                              , f = Math.round(Math.min(Math.max(p, 0), x))
                              , m = new e.InternalTexture(n,e.InternalTexture.DATASOURCE_TEMP);
                            m.isCube = !0,
                            m.invertY = !0,
                            m.generateMipMaps = !1,
                            n.updateTextureSamplingMode(e.Texture.LINEAR_LINEAR, m);
                            var z = new e.BaseTexture(null);
                            switch (z.isCube = !0,
                            z._texture = m,
                            l[f] = z,
                            d) {
                            case 0:
                                t._lodTextureLow = z;
                                break;
                            case 1:
                                t._lodTextureMid = z;
                                break;
                            case 2:
                                t._lodTextureHigh = z
                            }
                        }
                    var _ = []
                      , g = function(i) {
                        for (var c = function(c) {
                            var h = r[i][c]
                              , u = new Blob([h],{
                                type: "image/png"
                            })
                              , d = URL.createObjectURL(u)
                              , x = new Image;
                            x.src = d;
                            var p = new Promise((function(r, h) {
                                x.onload = function() {
                                    if (o) {
                                        var u = n.createTexture(null, !0, !0, null, e.Texture.NEAREST_SAMPLINGMODE, null, (function(e) {
                                            h(e)
                                        }
                                        ), x);
                                        s.getEffect().executeWhenCompiled((function() {
                                            s.onApply = function(e) {
                                                e._bindTexture("textureSampler", u),
                                                e.setFloat2("scale", 1, 1)
                                            }
                                            ,
                                            n.scenes[0].postProcessManager.directRender([s], y, !0, c, i),
                                            n.restoreDefaultFramebuffer(),
                                            u.dispose(),
                                            window.URL.revokeObjectURL(d),
                                            r()
                                        }
                                        ))
                                    } else {
                                        if (n._uploadImageToTexture(t, x, c, i),
                                        a) {
                                            var p = l[i];
                                            p && n._uploadImageToTexture(p._texture, x, c, 0)
                                        }
                                        r()
                                    }
                                }
                                ,
                                x.onerror = function(e) {
                                    h(e)
                                }
                            }
                            ));
                            _.push(p)
                        }, h = 0; h < 6; h++)
                            c(h)
                    };
                    for (d = 0; d < r.length; d++)
                        g(d);
                    if (r.length < i) {
                        var v = void 0
                          , b = Math.pow(2, i - 1 - r.length)
                          , T = b * b * 4;
                        switch (t.type) {
                        case e.Engine.TEXTURETYPE_UNSIGNED_INT:
                            v = new Uint8Array(T);
                            break;
                        case e.Engine.TEXTURETYPE_HALF_FLOAT:
                            v = new Uint16Array(T);
                            break;
                        case e.Engine.TEXTURETYPE_FLOAT:
                            v = new Float32Array(T)
                        }
                        for (d = r.length; d < i; d++)
                            for (var E = 0; E < 6; E++)
                                n._uploadArrayBufferViewToTexture(t, v, E, d)
                    }
                    return Promise.all(_).then((function() {
                        y && (n._releaseFramebufferObjects(y),
                        y._swapAndDie(t)),
                        s && s.dispose(),
                        a && (t._lodTextureHigh && t._lodTextureHigh._texture && (t._lodTextureHigh._texture.isReady = !0),
                        t._lodTextureMid && t._lodTextureMid._texture && (t._lodTextureMid._texture.isReady = !0),
                        t._lodTextureLow && t._lodTextureLow._texture && (t._lodTextureLow._texture.isReady = !0))
                    }
                    ))
                }
                ,
                t.UploadEnvSpherical = function(t, r) {
                    1 !== r.version && e.Tools.Warn('Unsupported babylon environment map version "' + r.version + '"');
                    var i = r.irradiance;
                    if (i) {
                        var n = new e.SphericalPolynomial;
                        e.Vector3.FromArrayToRef(i.x, 0, n.x),
                        e.Vector3.FromArrayToRef(i.y, 0, n.y),
                        e.Vector3.FromArrayToRef(i.z, 0, n.z),
                        e.Vector3.FromArrayToRef(i.xx, 0, n.xx),
                        e.Vector3.FromArrayToRef(i.yy, 0, n.yy),
                        e.Vector3.FromArrayToRef(i.zz, 0, n.zz),
                        e.Vector3.FromArrayToRef(i.yz, 0, n.yz),
                        e.Vector3.FromArrayToRef(i.zx, 0, n.zx),
                        e.Vector3.FromArrayToRef(i.xy, 0, n.xy),
                        t._sphericalPolynomial = n
                    }
                }
                ,
                t._MagicBytes = [134, 22, 135, 150, 246, 214, 150, 54],
                t
            }();
            e.EnvironmentTextureTools = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.supportCascades = !1
                }
                return t.prototype.canLoad = function(e, t, r, i, n) {
                    return 0 === e.indexOf(".env")
                }
                ,
                t.prototype.transformUrl = function(e, t) {
                    return e
                }
                ,
                t.prototype.getFallbackTextureUrl = function(e, t) {
                    return null
                }
                ,
                t.prototype.loadCubeData = function(t, r, i, n, o) {
                    if (!Array.isArray(t)) {
                        t = t;
                        var a = e.EnvironmentTextureTools.GetEnvInfo(t);
                        a ? (r.width = a.width,
                        r.height = a.width,
                        e.EnvironmentTextureTools.UploadEnvSpherical(r, a),
                        e.EnvironmentTextureTools.UploadEnvLevelsAsync(r, t, a).then((function() {
                            r.isReady = !0,
                            n && n()
                        }
                        ))) : o && o("Can not parse the environment file", null)
                    }
                }
                ,
                t.prototype.loadData = function(e, t, r) {
                    throw ".env not supported in 2d."
                }
                ,
                t
            }();
            e.Engine._TextureLoaders.push(new t)
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    var r = this;
                    this.originalScene = t,
                    this._pointerCaptures = {},
                    this._lastPointerEvents = {},
                    this.shouldRender = !0,
                    this.onlyCheckPointerDownEvents = !0,
                    this.processAllEvents = !1,
                    this.onPointerOutObservable = new e.Observable,
                    this.utilityLayerScene = new e.Scene(t.getEngine()),
                    this.utilityLayerScene.useRightHandedSystem = t.useRightHandedSystem,
                    this.utilityLayerScene._allowPostProcessClearColor = !1,
                    t.getEngine().scenes.pop(),
                    this.utilityLayerScene.detachControl(),
                    this._originalPointerObserver = t.onPrePointerObservable.add((function(i, n) {
                        if (r.processAllEvents || i.type === e.PointerEventTypes.POINTERMOVE || i.type === e.PointerEventTypes.POINTERUP || i.type === e.PointerEventTypes.POINTERDOWN) {
                            var o = i.event;
                            if (t.isPointerCaptured(o.pointerId))
                                r._pointerCaptures[o.pointerId] = !1;
                            else {
                                var a = i.ray ? r.utilityLayerScene.pickWithRay(i.ray) : r.utilityLayerScene.pick(t.pointerX, t.pointerY);
                                if (!i.ray && a && (i.ray = a.ray),
                                r.utilityLayerScene.onPrePointerObservable.notifyObservers(i),
                                r.onlyCheckPointerDownEvents && i.type != e.PointerEventTypes.POINTERDOWN)
                                    return i.skipOnPointerObservable || r.utilityLayerScene.onPointerObservable.notifyObservers(new e.PointerInfo(i.type,i.event,a)),
                                    void (i.type === e.PointerEventTypes.POINTERUP && r._pointerCaptures[o.pointerId] && (r._pointerCaptures[o.pointerId] = !1));
                                if (r.utilityLayerScene.autoClearDepthAndStencil)
                                    a && a.hit && (i.skipOnPointerObservable || r.utilityLayerScene.onPointerObservable.notifyObservers(new e.PointerInfo(i.type,i.event,a)),
                                    i.skipOnPointerObservable = !0);
                                else {
                                    var s = i.ray ? t.pickWithRay(i.ray) : t.pick(t.pointerX, t.pointerY)
                                      , y = i.event;
                                    s && a && (0 === a.distance && s.pickedMesh ? r.mainSceneTrackerPredicate && r.mainSceneTrackerPredicate(s.pickedMesh) ? (r._notifyObservers(i, s, y),
                                    i.skipOnPointerObservable = !0) : i.type === e.PointerEventTypes.POINTERDOWN ? r._pointerCaptures[y.pointerId] = !0 : r._lastPointerEvents[y.pointerId] && (r.onPointerOutObservable.notifyObservers(y.pointerId),
                                    delete r._lastPointerEvents[y.pointerId]) : !r._pointerCaptures[y.pointerId] && (a.distance < s.distance || 0 === s.distance) ? (r._notifyObservers(i, a, y),
                                    i.skipOnPointerObservable || (i.skipOnPointerObservable = a.distance > 0)) : !r._pointerCaptures[y.pointerId] && a.distance > s.distance && (r.mainSceneTrackerPredicate && r.mainSceneTrackerPredicate(s.pickedMesh) ? (r._notifyObservers(i, s, y),
                                    i.skipOnPointerObservable = !0) : r._lastPointerEvents[y.pointerId] && (r.onPointerOutObservable.notifyObservers(y.pointerId),
                                    delete r._lastPointerEvents[y.pointerId])),
                                    i.type === e.PointerEventTypes.POINTERUP && r._pointerCaptures[y.pointerId] && (r._pointerCaptures[y.pointerId] = !1))
                                }
                            }
                        }
                    }
                    )),
                    this.utilityLayerScene.autoClear = !1,
                    this._afterRenderObserver = this.originalScene.onAfterRenderObservable.add((function() {
                        r.shouldRender && r.render()
                    }
                    )),
                    this._sceneDisposeObserver = this.originalScene.onDisposeObservable.add((function() {
                        r.dispose()
                    }
                    )),
                    this._updateCamera()
                }
                return Object.defineProperty(t, "DefaultUtilityLayer", {
                    get: function() {
                        return null == t._DefaultUtilityLayer && (t._DefaultUtilityLayer = new t(e.Engine.LastCreatedScene),
                        t._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce((function() {
                            t._DefaultUtilityLayer = null
                        }
                        ))),
                        t._DefaultUtilityLayer
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t, "DefaultKeepDepthUtilityLayer", {
                    get: function() {
                        return null == t._DefaultKeepDepthUtilityLayer && (t._DefaultKeepDepthUtilityLayer = new t(e.Engine.LastCreatedScene),
                        t._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil = !1,
                        t._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce((function() {
                            t._DefaultKeepDepthUtilityLayer = null
                        }
                        ))),
                        t._DefaultKeepDepthUtilityLayer
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._notifyObservers = function(t, r, i) {
                    t.skipOnPointerObservable || (this.utilityLayerScene.onPointerObservable.notifyObservers(new e.PointerInfo(t.type,t.event,r)),
                    this._lastPointerEvents[i.pointerId] = !0)
                }
                ,
                t.prototype.render = function() {
                    if (this._updateCamera(),
                    this.utilityLayerScene.activeCamera) {
                        var e = this.utilityLayerScene.activeCamera.getScene()
                          , t = this.utilityLayerScene.activeCamera;
                        t._scene = this.utilityLayerScene,
                        t.leftCamera && (t.leftCamera._scene = this.utilityLayerScene),
                        t.rightCamera && (t.rightCamera._scene = this.utilityLayerScene),
                        this.utilityLayerScene.render(!1),
                        t._scene = e,
                        t.leftCamera && (t.leftCamera._scene = e),
                        t.rightCamera && (t.rightCamera._scene = e)
                    }
                }
                ,
                t.prototype.dispose = function() {
                    this.onPointerOutObservable.clear(),
                    this._afterRenderObserver && this.originalScene.onAfterRenderObservable.remove(this._afterRenderObserver),
                    this._sceneDisposeObserver && this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),
                    this._originalPointerObserver && this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),
                    this.utilityLayerScene.dispose()
                }
                ,
                t.prototype._updateCamera = function() {
                    this.utilityLayerScene.activeCamera = this.originalScene.activeCamera
                }
                ,
                t._DefaultUtilityLayer = null,
                t._DefaultKeepDepthUtilityLayer = null,
                t
            }();
            e.UtilityLayerRenderer = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    this.maxDragAngle = 0,
                    this._useAlternatePickedPointAboveMaxDragAngle = !1,
                    this.currentDraggingPointerID = -1,
                    this.dragging = !1,
                    this.dragDeltaRatio = .2,
                    this.updateDragPlane = !0,
                    this._debugMode = !1,
                    this._moving = !1,
                    this.onDragObservable = new e.Observable,
                    this.onDragStartObservable = new e.Observable,
                    this.onDragEndObservable = new e.Observable,
                    this.moveAttached = !0,
                    this.enabled = !0,
                    this.detachCameraControls = !0,
                    this.useObjectOrienationForDragging = !0,
                    this._tmpVector = new e.Vector3(0,0,0),
                    this._alternatePickedPoint = new e.Vector3(0,0,0),
                    this._worldDragAxis = new e.Vector3(0,0,0),
                    this._targetPosition = new e.Vector3(0,0,0),
                    this._attachedElement = null,
                    this._startDragRay = new e.Ray(new e.Vector3,new e.Vector3),
                    this._lastPointerRay = {},
                    this._dragDelta = new e.Vector3,
                    this._pointA = new e.Vector3(0,0,0),
                    this._pointB = new e.Vector3(0,0,0),
                    this._pointC = new e.Vector3(0,0,0),
                    this._lineA = new e.Vector3(0,0,0),
                    this._lineB = new e.Vector3(0,0,0),
                    this._localAxis = new e.Vector3(0,0,0),
                    this._lookAt = new e.Vector3(0,0,0),
                    this._options = t || {};
                    var r = 0;
                    if (this._options.dragAxis && r++,
                    this._options.dragPlaneNormal && r++,
                    r > 1)
                        throw "Multiple drag modes specified in dragBehavior options. Only one expected"
                }
                return Object.defineProperty(t.prototype, "name", {
                    get: function() {
                        return "PointerDrag"
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.init = function() {}
                ,
                t.prototype.attach = function(r) {
                    var i = this;
                    this._scene = r.getScene(),
                    this._attachedNode = r,
                    t._planeScene || (this._debugMode ? t._planeScene = this._scene : (t._planeScene = new e.Scene(this._scene.getEngine()),
                    t._planeScene.detachControl(),
                    this._scene.getEngine().scenes.pop(),
                    this._scene.onDisposeObservable.addOnce((function() {
                        t._planeScene.dispose(),
                        t._planeScene = null
                    }
                    )))),
                    this._dragPlane = e.Mesh.CreatePlane("pointerDragPlane", this._debugMode ? 1 : 1e4, t._planeScene, !1, e.Mesh.DOUBLESIDE),
                    this.lastDragPosition = new e.Vector3(0,0,0);
                    this._pointerObserver = this._scene.onPointerObservable.add((function(r, n) {
                        var o;
                        if (i.enabled)
                            if (r.type == e.PointerEventTypes.POINTERDOWN)
                                !i.dragging && r.pickInfo && r.pickInfo.hit && r.pickInfo.pickedMesh && r.pickInfo.pickedPoint && r.pickInfo.ray && (o = r.pickInfo.pickedMesh,
                                i._attachedNode == o || o.isDescendantOf(i._attachedNode)) && i._startDrag(r.event.pointerId, r.pickInfo.ray, r.pickInfo.pickedPoint);
                            else if (r.type == e.PointerEventTypes.POINTERUP)
                                i.currentDraggingPointerID == r.event.pointerId && i.releaseDrag();
                            else if (r.type == e.PointerEventTypes.POINTERMOVE) {
                                var a = r.event.pointerId;
                                i.currentDraggingPointerID === t._AnyMouseID && a !== t._AnyMouseID && "mouse" == r.event.pointerType && (i._lastPointerRay[i.currentDraggingPointerID] && (i._lastPointerRay[a] = i._lastPointerRay[i.currentDraggingPointerID],
                                delete i._lastPointerRay[i.currentDraggingPointerID]),
                                i.currentDraggingPointerID = a),
                                i._lastPointerRay[a] || (i._lastPointerRay[a] = new e.Ray(new e.Vector3,new e.Vector3)),
                                r.pickInfo && r.pickInfo.ray && (i._lastPointerRay[a].origin.copyFrom(r.pickInfo.ray.origin),
                                i._lastPointerRay[a].direction.copyFrom(r.pickInfo.ray.direction),
                                i.currentDraggingPointerID == a && i.dragging && i._moveDrag(r.pickInfo.ray))
                            }
                    }
                    )),
                    this._beforeRenderObserver = this._scene.onBeforeRenderObservable.add((function() {
                        i._moving && i.moveAttached && (e.BoundingBoxGizmo._RemoveAndStorePivotPoint(i._attachedNode),
                        i._targetPosition.subtractToRef(i._attachedNode.absolutePosition, i._tmpVector),
                        i._tmpVector.scaleInPlace(i.dragDeltaRatio),
                        i._attachedNode.getAbsolutePosition().addToRef(i._tmpVector, i._tmpVector),
                        i._attachedNode.setAbsolutePosition(i._tmpVector),
                        e.BoundingBoxGizmo._RestorePivotPoint(i._attachedNode))
                    }
                    ))
                }
                ,
                t.prototype.releaseDrag = function() {
                    this.dragging = !1,
                    this.onDragEndObservable.notifyObservers({
                        dragPlanePoint: this.lastDragPosition,
                        pointerId: this.currentDraggingPointerID
                    }),
                    this.currentDraggingPointerID = -1,
                    this._moving = !1,
                    this.detachCameraControls && this._attachedElement && this._scene.activeCamera && !this._scene.activeCamera.leftCamera && this._scene.activeCamera.attachControl(this._attachedElement, !0)
                }
                ,
                t.prototype.startDrag = function(e, r, i) {
                    void 0 === e && (e = t._AnyMouseID),
                    this._startDrag(e, r, i);
                    var n = this._lastPointerRay[e];
                    e === t._AnyMouseID && (n = this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),
                    n && this._moveDrag(n)
                }
                ,
                t.prototype._startDrag = function(t, r, i) {
                    if (this._scene.activeCamera && !this.dragging && this._attachedNode) {
                        e.BoundingBoxGizmo._RemoveAndStorePivotPoint(this._attachedNode),
                        r ? (this._startDragRay.direction.copyFrom(r.direction),
                        this._startDragRay.origin.copyFrom(r.origin)) : (this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),
                        this._attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),
                        this._tmpVector.subtractToRef(this._scene.activeCamera.position, this._startDragRay.direction)),
                        this._updateDragPlanePosition(this._startDragRay, i || this._tmpVector);
                        var n = this._pickWithRayOnDragPlane(this._startDragRay);
                        n && (this.dragging = !0,
                        this.currentDraggingPointerID = t,
                        this.lastDragPosition.copyFrom(n),
                        this.onDragStartObservable.notifyObservers({
                            dragPlanePoint: n,
                            pointerId: this.currentDraggingPointerID
                        }),
                        this._targetPosition.copyFrom(this._attachedNode.absolutePosition),
                        this.detachCameraControls && this._scene.activeCamera && !this._scene.activeCamera.leftCamera && (this._scene.activeCamera.inputs.attachedElement ? (this._attachedElement = this._scene.activeCamera.inputs.attachedElement,
                        this._scene.activeCamera.detachControl(this._scene.activeCamera.inputs.attachedElement)) : this._attachedElement = null)),
                        e.BoundingBoxGizmo._RestorePivotPoint(this._attachedNode)
                    }
                }
                ,
                t.prototype._moveDrag = function(t) {
                    this._moving = !0;
                    var r = this._pickWithRayOnDragPlane(t);
                    if (r) {
                        this.updateDragPlane && this._updateDragPlanePosition(t, r);
                        var i = 0;
                        this._options.dragAxis ? (e.Vector3.TransformCoordinatesToRef(this._options.dragAxis, this._attachedNode.getWorldMatrix().getRotationMatrix(), this._worldDragAxis),
                        r.subtractToRef(this.lastDragPosition, this._tmpVector),
                        i = e.Vector3.Dot(this._tmpVector, this._worldDragAxis),
                        this._worldDragAxis.scaleToRef(i, this._dragDelta)) : (i = this._dragDelta.length(),
                        r.subtractToRef(this.lastDragPosition, this._dragDelta)),
                        this._targetPosition.addInPlace(this._dragDelta),
                        this.onDragObservable.notifyObservers({
                            dragDistance: i,
                            delta: this._dragDelta,
                            dragPlanePoint: r,
                            dragPlaneNormal: this._dragPlane.forward,
                            pointerId: this.currentDraggingPointerID
                        }),
                        this.lastDragPosition.copyFrom(r)
                    }
                }
                ,
                t.prototype._pickWithRayOnDragPlane = function(r) {
                    var i = this;
                    if (!r)
                        return null;
                    var n = Math.acos(e.Vector3.Dot(this._dragPlane.forward, r.direction));
                    if (n > Math.PI / 2 && (n = Math.PI - n),
                    this.maxDragAngle > 0 && n > this.maxDragAngle) {
                        if (this._useAlternatePickedPointAboveMaxDragAngle) {
                            this._tmpVector.copyFrom(r.direction),
                            this._attachedNode.absolutePosition.subtractToRef(r.origin, this._alternatePickedPoint),
                            this._alternatePickedPoint.normalize(),
                            this._alternatePickedPoint.scaleInPlace(-2 * e.Vector3.Dot(this._alternatePickedPoint, this._tmpVector)),
                            this._tmpVector.addInPlace(this._alternatePickedPoint);
                            var o = e.Vector3.Dot(this._dragPlane.forward, this._tmpVector);
                            return this._dragPlane.forward.scaleToRef(-o, this._alternatePickedPoint),
                            this._alternatePickedPoint.addInPlace(this._tmpVector),
                            this._alternatePickedPoint.addInPlace(this._attachedNode.absolutePosition),
                            this._alternatePickedPoint
                        }
                        return null
                    }
                    var a = t._planeScene.pickWithRay(r, (function(e) {
                        return e == i._dragPlane
                    }
                    ));
                    return a && a.hit && a.pickedMesh && a.pickedPoint ? a.pickedPoint : null
                }
                ,
                t.prototype._updateDragPlanePosition = function(t, r) {
                    this._pointA.copyFrom(r),
                    this._options.dragAxis ? (this.useObjectOrienationForDragging ? e.Vector3.TransformCoordinatesToRef(this._options.dragAxis, this._attachedNode.getWorldMatrix().getRotationMatrix(), this._localAxis) : this._localAxis.copyFrom(this._options.dragAxis),
                    this._pointA.addToRef(this._localAxis, this._pointB),
                    t.origin.subtractToRef(this._pointA, this._pointC),
                    this._pointA.addToRef(this._pointC.normalize(), this._pointC),
                    this._pointB.subtractToRef(this._pointA, this._lineA),
                    this._pointC.subtractToRef(this._pointA, this._lineB),
                    e.Vector3.CrossToRef(this._lineA, this._lineB, this._lookAt),
                    e.Vector3.CrossToRef(this._lineA, this._lookAt, this._lookAt),
                    this._lookAt.normalize(),
                    this._dragPlane.position.copyFrom(this._pointA),
                    this._pointA.subtractToRef(this._lookAt, this._lookAt),
                    this._dragPlane.lookAt(this._lookAt)) : this._options.dragPlaneNormal ? (this.useObjectOrienationForDragging ? e.Vector3.TransformCoordinatesToRef(this._options.dragPlaneNormal, this._attachedNode.getWorldMatrix().getRotationMatrix(), this._localAxis) : this._localAxis.copyFrom(this._options.dragPlaneNormal),
                    this._dragPlane.position.copyFrom(this._pointA),
                    this._pointA.subtractToRef(this._localAxis, this._lookAt),
                    this._dragPlane.lookAt(this._lookAt)) : (this._dragPlane.position.copyFrom(this._pointA),
                    this._dragPlane.lookAt(t.origin)),
                    this._dragPlane.computeWorldMatrix(!0)
                }
                ,
                t.prototype.detach = function() {
                    this._pointerObserver && this._scene.onPointerObservable.remove(this._pointerObserver),
                    this._beforeRenderObserver && this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver)
                }
                ,
                t._AnyMouseID = -2,
                t
            }();
            e.PointerDragBehavior = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this._startDistance = 0,
                    this._initialScale = new e.Vector3(0,0,0),
                    this._targetScale = new e.Vector3(0,0,0),
                    this._sceneRenderObserver = null,
                    this._dragBehaviorA = new e.PointerDragBehavior({}),
                    this._dragBehaviorA.moveAttached = !1,
                    this._dragBehaviorB = new e.PointerDragBehavior({}),
                    this._dragBehaviorB.moveAttached = !1
                }
                return Object.defineProperty(t.prototype, "name", {
                    get: function() {
                        return "MultiPointerScale"
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.init = function() {}
                ,
                t.prototype._getCurrentDistance = function() {
                    return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()
                }
                ,
                t.prototype.attach = function(e) {
                    var t = this;
                    this._ownerNode = e,
                    this._dragBehaviorA.onDragStartObservable.add((function(r) {
                        t._dragBehaviorA.dragging && t._dragBehaviorB.dragging && (t._dragBehaviorA.currentDraggingPointerID == t._dragBehaviorB.currentDraggingPointerID ? t._dragBehaviorA.releaseDrag() : (t._initialScale.copyFrom(e.scaling),
                        t._startDistance = t._getCurrentDistance()))
                    }
                    )),
                    this._dragBehaviorB.onDragStartObservable.add((function(r) {
                        t._dragBehaviorA.dragging && t._dragBehaviorB.dragging && (t._dragBehaviorA.currentDraggingPointerID == t._dragBehaviorB.currentDraggingPointerID ? t._dragBehaviorB.releaseDrag() : (t._initialScale.copyFrom(e.scaling),
                        t._startDistance = t._getCurrentDistance()))
                    }
                    )),
                    [this._dragBehaviorA, this._dragBehaviorB].forEach((function(e) {
                        e.onDragObservable.add((function() {
                            if (t._dragBehaviorA.dragging && t._dragBehaviorB.dragging) {
                                var e = t._getCurrentDistance() / t._startDistance;
                                t._initialScale.scaleToRef(e, t._targetScale)
                            }
                        }
                        ))
                    }
                    )),
                    e.addBehavior(this._dragBehaviorA),
                    e.addBehavior(this._dragBehaviorB),
                    this._sceneRenderObserver = e.getScene().onBeforeRenderObservable.add((function() {
                        if (t._dragBehaviorA.dragging && t._dragBehaviorB.dragging) {
                            var r = t._targetScale.subtract(e.scaling).scaleInPlace(.1);
                            r.length() > .01 && e.scaling.addInPlace(r)
                        }
                    }
                    ))
                }
                ,
                t.prototype.detach = function() {
                    var e = this;
                    this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),
                    [this._dragBehaviorA, this._dragBehaviorB].forEach((function(t) {
                        t.onDragStartObservable.clear(),
                        t.onDragObservable.clear(),
                        e._ownerNode.removeBehavior(t)
                    }
                    ))
                }
                ,
                t
            }();
            e.MultiPointerScaleBehavior = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this._sceneRenderObserver = null,
                    this._targetPosition = new e.Vector3(0,0,0),
                    this._moving = !1,
                    this._startingOrientation = new e.Quaternion,
                    this.zDragFactor = 3,
                    this.dragging = !1,
                    this.dragDeltaRatio = .2,
                    this.currentDraggingPointerID = -1,
                    this.detachCameraControls = !0,
                    this.onDragStartObservable = new e.Observable,
                    this.onDragEndObservable = new e.Observable
                }
                return Object.defineProperty(t.prototype, "name", {
                    get: function() {
                        return "SixDofDrag"
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.init = function() {}
                ,
                t.prototype.attach = function(r) {
                    var i = this;
                    this._ownerNode = r,
                    this._scene = this._ownerNode.getScene(),
                    t._virtualScene || (t._virtualScene = new e.Scene(this._scene.getEngine()),
                    t._virtualScene.detachControl(),
                    this._scene.getEngine().scenes.pop());
                    var n = null
                      , o = new e.Vector3(0,0,0);
                    this._virtualOriginMesh = new e.AbstractMesh("",t._virtualScene),
                    this._virtualOriginMesh.rotationQuaternion = new e.Quaternion,
                    this._virtualDragMesh = new e.AbstractMesh("",t._virtualScene),
                    this._virtualDragMesh.rotationQuaternion = new e.Quaternion;
                    var a = null;
                    this._pointerObserver = this._scene.onPointerObservable.add((function(t, r) {
                        if (t.type == e.PointerEventTypes.POINTERDOWN) {
                            if (!i.dragging && t.pickInfo && t.pickInfo.hit && t.pickInfo.pickedMesh && t.pickInfo.ray && (h = t.pickInfo.pickedMesh,
                            i._ownerNode == h || h.isDescendantOf(i._ownerNode))) {
                                i._scene.activeCamera && i._scene.activeCamera.cameraRigMode == e.Camera.RIG_MODE_NONE && t.pickInfo.ray.origin.copyFrom(i._scene.activeCamera.position),
                                n = i._ownerNode,
                                e.BoundingBoxGizmo._RemoveAndStorePivotPoint(n),
                                o.copyFrom(t.pickInfo.ray.origin),
                                i._virtualOriginMesh.position.copyFrom(t.pickInfo.ray.origin),
                                i._virtualOriginMesh.lookAt(t.pickInfo.ray.origin.subtract(t.pickInfo.ray.direction)),
                                i._virtualOriginMesh.removeChild(i._virtualDragMesh),
                                n.computeWorldMatrix(),
                                i._virtualDragMesh.position.copyFrom(n.absolutePosition),
                                n.rotationQuaternion || (n.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(n.rotation.y, n.rotation.x, n.rotation.z));
                                var s = n.parent;
                                n.setParent(null),
                                i._virtualDragMesh.rotationQuaternion.copyFrom(n.rotationQuaternion),
                                n.setParent(s),
                                i._virtualOriginMesh.addChild(i._virtualDragMesh),
                                i._targetPosition.copyFrom(i._virtualDragMesh.absolutePosition),
                                i.dragging = !0,
                                i.currentDraggingPointerID = t.event.pointerId,
                                i.detachCameraControls && i._scene.activeCamera && !i._scene.activeCamera.leftCamera && (i._scene.activeCamera.inputs.attachedElement ? (a = i._scene.activeCamera.inputs.attachedElement,
                                i._scene.activeCamera.detachControl(i._scene.activeCamera.inputs.attachedElement)) : a = null),
                                e.BoundingBoxGizmo._RestorePivotPoint(n),
                                i.onDragStartObservable.notifyObservers({})
                            }
                        } else if (t.type == e.PointerEventTypes.POINTERUP)
                            i.currentDraggingPointerID == t.event.pointerId && (i.dragging = !1,
                            i._moving = !1,
                            i.currentDraggingPointerID = -1,
                            n = null,
                            i._virtualOriginMesh.removeChild(i._virtualDragMesh),
                            i.detachCameraControls && a && i._scene.activeCamera && !i._scene.activeCamera.leftCamera && i._scene.activeCamera.attachControl(a, !0),
                            i.onDragEndObservable.notifyObservers({}));
                        else if (t.type == e.PointerEventTypes.POINTERMOVE && i.currentDraggingPointerID == t.event.pointerId && i.dragging && t.pickInfo && t.pickInfo.ray && n) {
                            var y = i.zDragFactor;
                            i._scene.activeCamera && i._scene.activeCamera.cameraRigMode == e.Camera.RIG_MODE_NONE && (t.pickInfo.ray.origin.copyFrom(i._scene.activeCamera.position),
                            y = 0);
                            var l = t.pickInfo.ray.origin.subtract(o);
                            o.copyFrom(t.pickInfo.ray.origin);
                            var c = -e.Vector3.Dot(l, t.pickInfo.ray.direction);
                            i._virtualOriginMesh.addChild(i._virtualDragMesh),
                            i._virtualDragMesh.position.z -= i._virtualDragMesh.position.z < 1 ? c * i.zDragFactor : c * y * i._virtualDragMesh.position.z,
                            i._virtualDragMesh.position.z < 0 && (i._virtualDragMesh.position.z = 0),
                            i._virtualOriginMesh.position.copyFrom(t.pickInfo.ray.origin),
                            i._virtualOriginMesh.lookAt(t.pickInfo.ray.origin.subtract(t.pickInfo.ray.direction)),
                            i._virtualOriginMesh.removeChild(i._virtualDragMesh),
                            i._targetPosition.copyFrom(i._virtualDragMesh.absolutePosition),
                            n.parent && e.Vector3.TransformCoordinatesToRef(i._targetPosition, e.Matrix.Invert(n.parent.getWorldMatrix()), i._targetPosition),
                            i._moving || i._startingOrientation.copyFrom(i._virtualDragMesh.rotationQuaternion),
                            i._moving = !0
                        }
                        var h
                    }
                    ));
                    var s = new e.Quaternion;
                    this._sceneRenderObserver = r.getScene().onBeforeRenderObservable.add((function() {
                        if (i.dragging && i._moving && n) {
                            e.BoundingBoxGizmo._RemoveAndStorePivotPoint(n),
                            n.position.addInPlace(i._targetPosition.subtract(n.position).scale(i.dragDeltaRatio)),
                            s.copyFrom(i._startingOrientation),
                            s.x = -s.x,
                            s.y = -s.y,
                            s.z = -s.z,
                            i._virtualDragMesh.rotationQuaternion.multiplyToRef(s, s),
                            e.Quaternion.RotationYawPitchRollToRef(s.toEulerAngles("xyz").y, 0, 0, s),
                            s.multiplyToRef(i._startingOrientation, s);
                            var t = n.parent;
                            n.setParent(null),
                            e.Quaternion.SlerpToRef(n.rotationQuaternion, s, i.dragDeltaRatio, n.rotationQuaternion),
                            n.setParent(t),
                            e.BoundingBoxGizmo._RestorePivotPoint(n)
                        }
                    }
                    ))
                }
                ,
                t.prototype.detach = function() {
                    this._scene && this._scene.onPointerObservable.remove(this._pointerObserver),
                    this._ownerNode && this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),
                    this._virtualOriginMesh && this._virtualOriginMesh.dispose(),
                    this._virtualDragMesh && this._virtualDragMesh.dispose(),
                    this.onDragEndObservable.clear(),
                    this.onDragStartObservable.clear()
                }
                ,
                t
            }();
            e.SixDofDragBehavior = t
        }(s || (s = {})),
        function(e) {
            var t = function(t, r, i, n) {
                void 0 === r && (r = new e.Vector3),
                void 0 === i && (i = 0),
                void 0 === n && (n = !1),
                this.direction = t,
                this.rotatedDirection = r,
                this.diff = i,
                this.ignore = n
            }
              , r = function() {
                function r(r) {
                    this.ui = r,
                    this.name = "AttachToBoxBehavior",
                    this.distanceAwayFromFace = .15,
                    this.distanceAwayFromBottomOfFace = .15,
                    this._faceVectors = [new t(e.Vector3.Up()), new t(e.Vector3.Down()), new t(e.Vector3.Left()), new t(e.Vector3.Right()), new t(e.Vector3.Forward()), new t(e.Vector3.Forward().scaleInPlace(-1))],
                    this._tmpMatrix = new e.Matrix,
                    this._tmpVector = new e.Vector3,
                    this._zeroVector = e.Vector3.Zero(),
                    this._lookAtTmpMatrix = new e.Matrix
                }
                return r.prototype.init = function() {}
                ,
                r.prototype._closestFace = function(t) {
                    var r = this;
                    return this._faceVectors.forEach((function(i) {
                        r._target.rotationQuaternion || (r._target.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(r._target.rotation.y, r._target.rotation.x, r._target.rotation.z)),
                        r._target.rotationQuaternion.toRotationMatrix(r._tmpMatrix),
                        e.Vector3.TransformCoordinatesToRef(i.direction, r._tmpMatrix, i.rotatedDirection),
                        i.diff = e.Vector3.GetAngleBetweenVectors(i.rotatedDirection, t, e.Vector3.Cross(i.rotatedDirection, t))
                    }
                    )),
                    this._faceVectors.reduce((function(e, t) {
                        return e.ignore ? t : t.ignore ? e : e.diff < t.diff ? e : t
                    }
                    ), this._faceVectors[0])
                }
                ,
                r.prototype._lookAtToRef = function(t, r, i) {
                    void 0 === r && (r = new e.Vector3(0,1,0)),
                    e.Matrix.LookAtLHToRef(this._zeroVector, t, r, this._lookAtTmpMatrix),
                    this._lookAtTmpMatrix.invert(),
                    e.Quaternion.FromRotationMatrixToRef(this._lookAtTmpMatrix, i)
                }
                ,
                r.prototype.attach = function(t) {
                    var r = this;
                    this._target = t,
                    this._scene = this._target.getScene(),
                    this._onRenderObserver = this._scene.onBeforeRenderObservable.add((function() {
                        if (r._scene.activeCamera) {
                            var i = r._scene.activeCamera.position;
                            r._scene.activeCamera.devicePosition && (i = r._scene.activeCamera.devicePosition);
                            var n = r._closestFace(i.subtract(t.position));
                            r._scene.activeCamera.leftCamera ? r._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(r._tmpMatrix) : r._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(r._tmpMatrix),
                            e.Vector3.TransformCoordinatesToRef(e.Vector3.Up(), r._tmpMatrix, r._tmpVector),
                            r._faceVectors.forEach((function(e) {
                                n.direction.x && e.direction.x && (e.ignore = !0),
                                n.direction.y && e.direction.y && (e.ignore = !0),
                                n.direction.z && e.direction.z && (e.ignore = !0)
                            }
                            ));
                            var o = r._closestFace(r._tmpVector);
                            r._faceVectors.forEach((function(e) {
                                e.ignore = !1
                            }
                            )),
                            r.ui.position.copyFrom(t.position),
                            n.direction.x && (n.rotatedDirection.scaleToRef(t.scaling.x / 2 + r.distanceAwayFromFace, r._tmpVector),
                            r.ui.position.addInPlace(r._tmpVector)),
                            n.direction.y && (n.rotatedDirection.scaleToRef(t.scaling.y / 2 + r.distanceAwayFromFace, r._tmpVector),
                            r.ui.position.addInPlace(r._tmpVector)),
                            n.direction.z && (n.rotatedDirection.scaleToRef(t.scaling.z / 2 + r.distanceAwayFromFace, r._tmpVector),
                            r.ui.position.addInPlace(r._tmpVector)),
                            r.ui.rotationQuaternion || (r.ui.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(r.ui.rotation.y, r.ui.rotation.x, r.ui.rotation.z)),
                            n.rotatedDirection.scaleToRef(-1, r._tmpVector),
                            r._lookAtToRef(r._tmpVector, o.rotatedDirection, r.ui.rotationQuaternion),
                            o.direction.x && r.ui.up.scaleToRef(r.distanceAwayFromBottomOfFace - t.scaling.x / 2, r._tmpVector),
                            o.direction.y && r.ui.up.scaleToRef(r.distanceAwayFromBottomOfFace - t.scaling.y / 2, r._tmpVector),
                            o.direction.z && r.ui.up.scaleToRef(r.distanceAwayFromBottomOfFace - t.scaling.z / 2, r._tmpVector),
                            r.ui.position.addInPlace(r._tmpVector)
                        }
                    }
                    ))
                }
                ,
                r.prototype.detach = function() {
                    this._scene.onBeforeRenderObservable.remove(this._onRenderObserver)
                }
                ,
                r
            }();
            e.AttachToBoxBehavior = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {
                    var e = this;
                    this.delay = 0,
                    this.fadeInTime = 300,
                    this._millisecondsPerFrame = 1e3 / 60,
                    this._hovered = !1,
                    this._hoverValue = 0,
                    this._ownerNode = null,
                    this._update = function() {
                        if (e._ownerNode) {
                            if (e._hoverValue += e._hovered ? e._millisecondsPerFrame : -e._millisecondsPerFrame,
                            e._setAllVisibility(e._ownerNode, (e._hoverValue - e.delay) / e.fadeInTime),
                            e._ownerNode.visibility > 1)
                                return e._setAllVisibility(e._ownerNode, 1),
                                void (e._hoverValue = e.fadeInTime + e.delay);
                            if (e._ownerNode.visibility < 0 && (e._setAllVisibility(e._ownerNode, 0),
                            e._hoverValue < 0))
                                return void (e._hoverValue = 0);
                            setTimeout(e._update, e._millisecondsPerFrame)
                        }
                    }
                }
                return Object.defineProperty(e.prototype, "name", {
                    get: function() {
                        return "FadeInOut"
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype.init = function() {}
                ,
                e.prototype.attach = function(e) {
                    this._ownerNode = e,
                    this._setAllVisibility(this._ownerNode, 0)
                }
                ,
                e.prototype.detach = function() {
                    this._ownerNode = null
                }
                ,
                e.prototype.fadeIn = function(e) {
                    this._hovered = e,
                    this._update()
                }
                ,
                e.prototype._setAllVisibility = function(e, t) {
                    var r = this;
                    e.visibility = t,
                    e.getChildMeshes().forEach((function(e) {
                        r._setAllVisibility(e, t)
                    }
                    ))
                }
                ,
                e
            }();
            e.FadeInOutBehavior = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    void 0 === t && (t = e.UtilityLayerRenderer.DefaultUtilityLayer);
                    var r = this;
                    this.gizmoLayer = t,
                    this.scaleRatio = 1,
                    this._tmpMatrix = new e.Matrix,
                    this._customMeshSet = !1,
                    this.updateGizmoRotationToMatchAttachedMesh = !0,
                    this.updateGizmoPositionToMatchAttachedMesh = !0,
                    this._updateScale = !0,
                    this._interactionsEnabled = !0,
                    this._tempVector = new e.Vector3,
                    this._rootMesh = new e.Mesh("gizmoRootNode",t.utilityLayerScene),
                    this._beforeRenderObserver = this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add((function() {
                        r._update()
                    }
                    )),
                    this.attachedMesh = null
                }
                return Object.defineProperty(t.prototype, "attachedMesh", {
                    get: function() {
                        return this._attachedMesh
                    },
                    set: function(e) {
                        this._attachedMesh = e,
                        this._rootMesh.setEnabled(!!e),
                        this._attachedMeshChanged(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.setCustomMesh = function(e) {
                    if (e.getScene() != this.gizmoLayer.utilityLayerScene)
                        throw "When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";
                    this._rootMesh.getChildMeshes().forEach((function(e) {
                        e.dispose()
                    }
                    )),
                    e.parent = this._rootMesh,
                    this._customMeshSet = !0
                }
                ,
                t.prototype._attachedMeshChanged = function(e) {}
                ,
                t.prototype._update = function() {
                    if (this.attachedMesh && (this.updateGizmoRotationToMatchAttachedMesh ? (this._rootMesh.rotationQuaternion || (this._rootMesh.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(this._rootMesh.rotation.y, this._rootMesh.rotation.x, this._rootMesh.rotation.z)),
                    this._tempVector.copyFrom(this.attachedMesh.scaling),
                    this.attachedMesh.scaling.x < 0 && (this.attachedMesh.scaling.x *= -1),
                    this.attachedMesh.scaling.y < 0 && (this.attachedMesh.scaling.y *= -1),
                    this.attachedMesh.scaling.z < 0 && (this.attachedMesh.scaling.z *= -1),
                    this.attachedMesh.computeWorldMatrix().getRotationMatrixToRef(this._tmpMatrix),
                    this.attachedMesh.scaling.copyFrom(this._tempVector),
                    this.attachedMesh.computeWorldMatrix(),
                    e.Quaternion.FromRotationMatrixToRef(this._tmpMatrix, this._rootMesh.rotationQuaternion)) : this._rootMesh.rotationQuaternion && this._rootMesh.rotationQuaternion.set(0, 0, 0, 1),
                    this.updateGizmoPositionToMatchAttachedMesh && this._rootMesh.position.copyFrom(this.attachedMesh.absolutePosition),
                    this._updateScale && this.gizmoLayer.utilityLayerScene.activeCamera && this.attachedMesh)) {
                        var t = this.gizmoLayer.utilityLayerScene.activeCamera.position;
                        this.gizmoLayer.utilityLayerScene.activeCamera.devicePosition && (t = this.gizmoLayer.utilityLayerScene.activeCamera.devicePosition),
                        this._rootMesh.position.subtractToRef(t, this._tempVector);
                        var r = this._tempVector.length() * this.scaleRatio;
                        this._rootMesh.scaling.set(r, r, r)
                    }
                }
                ,
                t.prototype.dispose = function() {
                    this._rootMesh.dispose(),
                    this._beforeRenderObserver && this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)
                }
                ,
                t
            }();
            e.Gizmo = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n) {
                    void 0 === i && (i = e.Color3.Gray()),
                    void 0 === n && (n = e.UtilityLayerRenderer.DefaultUtilityLayer);
                    var o = t.call(this, n) || this;
                    o._pointerObserver = null,
                    o.snapDistance = 0,
                    o.onSnapObservable = new e.Observable;
                    var a = new e.StandardMaterial("",n.utilityLayerScene);
                    a.disableLighting = !0,
                    a.emissiveColor = i;
                    var s = new e.StandardMaterial("",n.utilityLayerScene);
                    s.disableLighting = !0,
                    s.emissiveColor = i.add(new e.Color3(.3,.3,.3));
                    var y = new e.AbstractMesh("",n.utilityLayerScene)
                      , l = e.MeshBuilder.CreateCylinder("yPosMesh", {
                        diameterTop: 0,
                        height: 1.5,
                        diameterBottom: .75,
                        tessellation: 96
                    }, n.utilityLayerScene)
                      , c = e.MeshBuilder.CreateLines("yPosMesh", {
                        points: [new e.Vector3(0,0,0), new e.Vector3(0,1.1,0)]
                    }, n.utilityLayerScene);
                    c.color = a.emissiveColor,
                    y.addChild(l),
                    y.addChild(c),
                    l.scaling.scaleInPlace(.05),
                    l.material = a,
                    l.rotation.x = Math.PI / 2,
                    l.position.z += .3,
                    c.scaling.scaleInPlace(.26),
                    c.rotation.x = Math.PI / 2,
                    c.material = a,
                    y.lookAt(o._rootMesh.position.subtract(r)),
                    y.scaling.scaleInPlace(1 / 3),
                    o._rootMesh.addChild(y);
                    var h = 0
                      , u = new e.Vector3
                      , d = {
                        snapDistance: 0
                    };
                    o.dragBehavior = new e.PointerDragBehavior({
                        dragAxis: r
                    }),
                    o.dragBehavior.moveAttached = !1,
                    o._rootMesh.addBehavior(o.dragBehavior);
                    var x = new e.Vector3
                      , p = new e.Matrix;
                    return o.dragBehavior.onDragObservable.add((function(t) {
                        if (o.attachedMesh)
                            if (o.attachedMesh.parent ? (o.attachedMesh.parent.computeWorldMatrix().invertToRef(p),
                            p.setTranslationFromFloats(0, 0, 0),
                            e.Vector3.TransformCoordinatesToRef(t.delta, p, x)) : x.copyFrom(t.delta),
                            0 == o.snapDistance)
                                o.attachedMesh.position.addInPlace(x);
                            else if (h += t.dragDistance,
                            Math.abs(h) > o.snapDistance) {
                                var r = Math.floor(Math.abs(h) / o.snapDistance);
                                h %= o.snapDistance,
                                x.normalizeToRef(u),
                                u.scaleInPlace(o.snapDistance * r),
                                o.attachedMesh.position.addInPlace(u),
                                d.snapDistance = o.snapDistance * r,
                                o.onSnapObservable.notifyObservers(d)
                            }
                    }
                    )),
                    o._pointerObserver = n.utilityLayerScene.onPointerObservable.add((function(e, t) {
                        if (!o._customMeshSet) {
                            var r = e.pickInfo && -1 != o._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh) ? s : a;
                            o._rootMesh.getChildMeshes().forEach((function(e) {
                                e.material = r,
                                e.color && (e.color = r.emissiveColor)
                            }
                            ))
                        }
                    }
                    )),
                    o
                }
                return o(r, t),
                r.prototype._attachedMeshChanged = function(e) {
                    this.dragBehavior && (this.dragBehavior.enabled = !!e)
                }
                ,
                r.prototype.dispose = function() {
                    this.onSnapObservable.clear(),
                    this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),
                    this.dragBehavior.detach(),
                    t.prototype.dispose.call(this)
                }
                ,
                r
            }(e.Gizmo);
            e.AxisDragGizmo = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n) {
                    void 0 === i && (i = e.Color3.Gray()),
                    void 0 === n && (n = e.UtilityLayerRenderer.DefaultUtilityLayer);
                    var o = t.call(this, n) || this;
                    o._pointerObserver = null,
                    o.snapDistance = 0,
                    o.onSnapObservable = new e.Observable,
                    o.uniformScaling = !1,
                    o._coloredMaterial = new e.StandardMaterial("",n.utilityLayerScene),
                    o._coloredMaterial.disableLighting = !0,
                    o._coloredMaterial.emissiveColor = i;
                    var a = new e.StandardMaterial("",n.utilityLayerScene);
                    a.disableLighting = !0,
                    a.emissiveColor = i.add(new e.Color3(.3,.3,.3));
                    var s = new e.AbstractMesh("",n.utilityLayerScene)
                      , y = e.MeshBuilder.CreateBox("yPosMesh", {
                        size: .4
                    }, n.utilityLayerScene)
                      , l = e.MeshBuilder.CreateLines("yPosMesh", {
                        points: [new e.Vector3(0,0,0), new e.Vector3(0,1.1,0)]
                    }, n.utilityLayerScene);
                    l.color = o._coloredMaterial.emissiveColor,
                    s.addChild(y),
                    s.addChild(l),
                    y.scaling.scaleInPlace(.1),
                    y.material = o._coloredMaterial,
                    y.rotation.x = Math.PI / 2,
                    y.position.z += .3,
                    l.scaling.scaleInPlace(.26),
                    l.rotation.x = Math.PI / 2,
                    l.material = o._coloredMaterial,
                    s.lookAt(o._rootMesh.position.subtract(r)),
                    o._rootMesh.addChild(s),
                    s.scaling.scaleInPlace(1 / 3),
                    o.dragBehavior = new e.PointerDragBehavior({
                        dragAxis: r
                    }),
                    o.dragBehavior.moveAttached = !1,
                    o._rootMesh.addBehavior(o.dragBehavior);
                    var c = 0
                      , h = new e.Vector3
                      , u = {
                        snapDistance: 0
                    };
                    return o.dragBehavior.onDragObservable.add((function(e) {
                        if (o.attachedMesh) {
                            var t = !1
                              , i = 0;
                            o.uniformScaling ? (o.attachedMesh.scaling.normalizeToRef(h),
                            h.y < 0 && h.scaleInPlace(-1)) : h.copyFrom(r),
                            0 == o.snapDistance ? h.scaleToRef(e.dragDistance, h) : (c += e.dragDistance,
                            Math.abs(c) > o.snapDistance ? (i = Math.floor(c / o.snapDistance),
                            c %= o.snapDistance,
                            h.scaleToRef(o.snapDistance * i, h),
                            t = !0) : h.scaleInPlace(0)),
                            o.attachedMesh.scaling.addInPlace(h),
                            t && (u.snapDistance = o.snapDistance * i,
                            o.onSnapObservable.notifyObservers(u))
                        }
                    }
                    )),
                    o._pointerObserver = n.utilityLayerScene.onPointerObservable.add((function(e, t) {
                        if (!o._customMeshSet) {
                            var r = e.pickInfo && -1 != o._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh) ? a : o._coloredMaterial;
                            o._rootMesh.getChildMeshes().forEach((function(e) {
                                e.material = r,
                                e.color && (e.color = r.emissiveColor)
                            }
                            ))
                        }
                    }
                    )),
                    o
                }
                return o(r, t),
                r.prototype._attachedMeshChanged = function(e) {
                    this.dragBehavior && (this.dragBehavior.enabled = !!e)
                }
                ,
                r.prototype.dispose = function() {
                    this.onSnapObservable.clear(),
                    this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),
                    this.dragBehavior.detach(),
                    t.prototype.dispose.call(this)
                }
                ,
                r.prototype.setCustomMesh = function(e, r) {
                    var i = this;
                    void 0 === r && (r = !1),
                    t.prototype.setCustomMesh.call(this, e),
                    r && (this._rootMesh.getChildMeshes().forEach((function(e) {
                        e.material = i._coloredMaterial,
                        e.color && (e.color = i._coloredMaterial.emissiveColor)
                    }
                    )),
                    this._customMeshSet = !1)
                }
                ,
                r
            }(e.Gizmo);
            e.AxisScaleGizmo = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o) {
                    void 0 === i && (i = e.Color3.Gray()),
                    void 0 === n && (n = e.UtilityLayerRenderer.DefaultUtilityLayer),
                    void 0 === o && (o = 32);
                    var a = t.call(this, n) || this;
                    a._pointerObserver = null,
                    a.snapDistance = 0,
                    a.onSnapObservable = new e.Observable;
                    var s = new e.StandardMaterial("",n.utilityLayerScene);
                    s.disableLighting = !0,
                    s.emissiveColor = i;
                    var y = new e.StandardMaterial("",n.utilityLayerScene);
                    y.disableLighting = !0,
                    y.emissiveColor = i.add(new e.Color3(.3,.3,.3));
                    for (var l = new e.AbstractMesh("",n.utilityLayerScene), c = new Array, h = 0; h < o; h++) {
                        var u = 2 * Math.PI * (h / (o - 1));
                        c.push(new e.Vector3(.8 * Math.sin(u),0,.8 * Math.cos(u)))
                    }
                    var d = e.Mesh.CreateLines("", c, n.utilityLayerScene);
                    d.color = s.emissiveColor,
                    d.scaling.scaleInPlace(.26),
                    d.material = s,
                    d.rotation.x = Math.PI / 2,
                    l.addChild(d),
                    l.lookAt(a._rootMesh.position.subtract(r)),
                    a._rootMesh.addChild(l),
                    l.scaling.scaleInPlace(1 / 3),
                    a.dragBehavior = new e.PointerDragBehavior({
                        dragPlaneNormal: r
                    }),
                    a.dragBehavior.moveAttached = !1,
                    a.dragBehavior.maxDragAngle = 9 * Math.PI / 20,
                    a.dragBehavior._useAlternatePickedPointAboveMaxDragAngle = !0,
                    a._rootMesh.addBehavior(a.dragBehavior);
                    var x = new e.Vector3;
                    a.dragBehavior.onDragStartObservable.add((function(e) {
                        a.attachedMesh && x.copyFrom(e.dragPlanePoint)
                    }
                    ));
                    var p = new e.Matrix
                      , f = new e.Vector3
                      , m = new e.Vector3
                      , z = {
                        snapDistance: 0
                    }
                      , _ = 0
                      , g = new e.Matrix
                      , v = new e.Vector3
                      , b = new e.Quaternion;
                    return a.dragBehavior.onDragObservable.add((function(t) {
                        if (a.attachedMesh) {
                            a.attachedMesh.rotationQuaternion || (a.attachedMesh.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(a.attachedMesh.rotation.y, a.attachedMesh.rotation.x, a.attachedMesh.rotation.z));
                            var i = t.dragPlanePoint.subtract(a.attachedMesh.absolutePosition).normalize()
                              , o = x.subtract(a.attachedMesh.absolutePosition).normalize()
                              , s = e.Vector3.Cross(i, o)
                              , y = e.Vector3.Dot(i, o)
                              , l = Math.atan2(s.length(), y);
                            if (f.copyFrom(r),
                            m.copyFrom(r),
                            a.updateGizmoRotationToMatchAttachedMesh && (a.attachedMesh.rotationQuaternion.toRotationMatrix(p),
                            m = e.Vector3.TransformCoordinates(f, p)),
                            n.utilityLayerScene.activeCamera) {
                                var c = n.utilityLayerScene.activeCamera.position.subtract(a.attachedMesh.position);
                                e.Vector3.Dot(c, m) > 0 && (f.scaleInPlace(-1),
                                m.scaleInPlace(-1))
                            }
                            e.Vector3.Dot(m, s) > 0 && (l = -l);
                            var h = !1;
                            if (0 != a.snapDistance)
                                if (_ += l,
                                Math.abs(_) > a.snapDistance) {
                                    var u = Math.floor(_ / a.snapDistance);
                                    _ %= a.snapDistance,
                                    l = a.snapDistance * u,
                                    h = !0
                                } else
                                    l = 0;
                            g.reset(),
                            a.attachedMesh.parent && (a.attachedMesh.parent.computeWorldMatrix().invertToRef(g),
                            g.getRotationMatrixToRef(g),
                            e.Vector3.TransformCoordinatesToRef(f, g, f));
                            var d = Math.sin(l / 2);
                            b.set(f.x * d, f.y * d, f.z * d, Math.cos(l / 2)),
                            g.determinant() > 0 && (b.toEulerAnglesToRef(v),
                            e.Quaternion.RotationYawPitchRollToRef(v.y, -v.x, -v.z, b)),
                            a.updateGizmoRotationToMatchAttachedMesh ? a.attachedMesh.rotationQuaternion.multiplyToRef(b, a.attachedMesh.rotationQuaternion) : b.multiplyToRef(a.attachedMesh.rotationQuaternion, a.attachedMesh.rotationQuaternion),
                            x.copyFrom(t.dragPlanePoint),
                            h && (z.snapDistance = l,
                            a.onSnapObservable.notifyObservers(z))
                        }
                    }
                    )),
                    a._pointerObserver = n.utilityLayerScene.onPointerObservable.add((function(e, t) {
                        if (!a._customMeshSet) {
                            var r = e.pickInfo && -1 != a._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh) ? y : s;
                            a._rootMesh.getChildMeshes().forEach((function(e) {
                                e.material = r,
                                e.color && (e.color = r.emissiveColor)
                            }
                            ))
                        }
                    }
                    )),
                    a
                }
                return o(r, t),
                r.prototype._attachedMeshChanged = function(e) {
                    this.dragBehavior && (this.dragBehavior.enabled = !!e)
                }
                ,
                r.prototype.dispose = function() {
                    this.onSnapObservable.clear(),
                    this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),
                    this.dragBehavior.detach(),
                    t.prototype.dispose.call(this)
                }
                ,
                r
            }(e.Gizmo);
            e.PlaneRotationGizmo = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r) {
                    void 0 === r && (r = e.UtilityLayerRenderer.DefaultUtilityLayer);
                    var i = t.call(this, r) || this;
                    return i.onDragStartObservable = new e.Observable,
                    i.onDragEndObservable = new e.Observable,
                    i.xGizmo = new e.AxisDragGizmo(new e.Vector3(1,0,0),e.Color3.Red().scale(.5),r),
                    i.yGizmo = new e.AxisDragGizmo(new e.Vector3(0,1,0),e.Color3.Green().scale(.5),r),
                    i.zGizmo = new e.AxisDragGizmo(new e.Vector3(0,0,1),e.Color3.Blue().scale(.5),r),
                    [i.xGizmo, i.yGizmo, i.zGizmo].forEach((function(e) {
                        e.dragBehavior.onDragStartObservable.add((function() {
                            i.onDragStartObservable.notifyObservers({})
                        }
                        )),
                        e.dragBehavior.onDragEndObservable.add((function() {
                            i.onDragEndObservable.notifyObservers({})
                        }
                        ))
                    }
                    )),
                    i.attachedMesh = null,
                    i
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "attachedMesh", {
                    set: function(e) {
                        this.xGizmo && (this.xGizmo.attachedMesh = e,
                        this.yGizmo.attachedMesh = e,
                        this.zGizmo.attachedMesh = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "updateGizmoRotationToMatchAttachedMesh", {
                    get: function() {
                        return this.xGizmo.updateGizmoRotationToMatchAttachedMesh
                    },
                    set: function(e) {
                        this.xGizmo && (this.xGizmo.updateGizmoRotationToMatchAttachedMesh = e,
                        this.yGizmo.updateGizmoRotationToMatchAttachedMesh = e,
                        this.zGizmo.updateGizmoRotationToMatchAttachedMesh = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "snapDistance", {
                    get: function() {
                        return this.xGizmo.snapDistance
                    },
                    set: function(e) {
                        this.xGizmo && (this.xGizmo.snapDistance = e,
                        this.yGizmo.snapDistance = e,
                        this.zGizmo.snapDistance = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "scaleRatio", {
                    get: function() {
                        return this.xGizmo.scaleRatio
                    },
                    set: function(e) {
                        this.xGizmo && (this.xGizmo.scaleRatio = e,
                        this.yGizmo.scaleRatio = e,
                        this.zGizmo.scaleRatio = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.dispose = function() {
                    this.xGizmo.dispose(),
                    this.yGizmo.dispose(),
                    this.zGizmo.dispose(),
                    this.onDragStartObservable.clear(),
                    this.onDragEndObservable.clear()
                }
                ,
                r.prototype.setCustomMesh = function(t) {
                    e.Tools.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")
                }
                ,
                r
            }(e.Gizmo);
            e.PositionGizmo = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i) {
                    void 0 === r && (r = e.UtilityLayerRenderer.DefaultUtilityLayer),
                    void 0 === i && (i = 32);
                    var n = t.call(this, r) || this;
                    return n.onDragStartObservable = new e.Observable,
                    n.onDragEndObservable = new e.Observable,
                    n.xGizmo = new e.PlaneRotationGizmo(new e.Vector3(1,0,0),e.Color3.Red().scale(.5),r,i),
                    n.yGizmo = new e.PlaneRotationGizmo(new e.Vector3(0,1,0),e.Color3.Green().scale(.5),r,i),
                    n.zGizmo = new e.PlaneRotationGizmo(new e.Vector3(0,0,1),e.Color3.Blue().scale(.5),r,i),
                    [n.xGizmo, n.yGizmo, n.zGizmo].forEach((function(e) {
                        e.dragBehavior.onDragStartObservable.add((function() {
                            n.onDragStartObservable.notifyObservers({})
                        }
                        )),
                        e.dragBehavior.onDragEndObservable.add((function() {
                            n.onDragEndObservable.notifyObservers({})
                        }
                        ))
                    }
                    )),
                    n.attachedMesh = null,
                    n
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "attachedMesh", {
                    set: function(e) {
                        this.xGizmo && (this.xGizmo.attachedMesh = e,
                        this.yGizmo.attachedMesh = e,
                        this.zGizmo.attachedMesh = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "updateGizmoRotationToMatchAttachedMesh", {
                    get: function() {
                        return this.xGizmo.updateGizmoRotationToMatchAttachedMesh
                    },
                    set: function(e) {
                        this.xGizmo && (this.xGizmo.updateGizmoRotationToMatchAttachedMesh = e,
                        this.yGizmo.updateGizmoRotationToMatchAttachedMesh = e,
                        this.zGizmo.updateGizmoRotationToMatchAttachedMesh = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "snapDistance", {
                    get: function() {
                        return this.xGizmo.snapDistance
                    },
                    set: function(e) {
                        this.xGizmo && (this.xGizmo.snapDistance = e,
                        this.yGizmo.snapDistance = e,
                        this.zGizmo.snapDistance = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "scaleRatio", {
                    get: function() {
                        return this.xGizmo.scaleRatio
                    },
                    set: function(e) {
                        this.xGizmo && (this.xGizmo.scaleRatio = e,
                        this.yGizmo.scaleRatio = e,
                        this.zGizmo.scaleRatio = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.dispose = function() {
                    this.xGizmo.dispose(),
                    this.yGizmo.dispose(),
                    this.zGizmo.dispose(),
                    this.onDragStartObservable.clear(),
                    this.onDragEndObservable.clear()
                }
                ,
                r.prototype.setCustomMesh = function(t) {
                    e.Tools.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")
                }
                ,
                r
            }(e.Gizmo);
            e.RotationGizmo = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r) {
                    void 0 === r && (r = e.UtilityLayerRenderer.DefaultUtilityLayer);
                    var i = t.call(this, r) || this;
                    i.onDragStartObservable = new e.Observable,
                    i.onDragEndObservable = new e.Observable,
                    i.xGizmo = new e.AxisScaleGizmo(new e.Vector3(1,0,0),e.Color3.Red().scale(.5),r),
                    i.yGizmo = new e.AxisScaleGizmo(new e.Vector3(0,1,0),e.Color3.Green().scale(.5),r),
                    i.zGizmo = new e.AxisScaleGizmo(new e.Vector3(0,0,1),e.Color3.Blue().scale(.5),r),
                    i.uniformScaleGizmo = new e.AxisScaleGizmo(new e.Vector3(0,1,0),e.Color3.Yellow().scale(.5),r),
                    i.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh = !1,
                    i.uniformScaleGizmo.uniformScaling = !0;
                    var n = e.Mesh.CreatePolyhedron("", {
                        type: 1
                    }, i.uniformScaleGizmo.gizmoLayer.utilityLayerScene);
                    n.scaling.scaleInPlace(.02),
                    n.visibility = 0;
                    var o = e.Mesh.CreatePolyhedron("", {
                        type: 1
                    }, i.uniformScaleGizmo.gizmoLayer.utilityLayerScene);
                    return o.scaling.scaleInPlace(.007),
                    n.addChild(o),
                    i.uniformScaleGizmo.setCustomMesh(n, !0),
                    [i.xGizmo, i.yGizmo, i.zGizmo, i.uniformScaleGizmo].forEach((function(e) {
                        e.dragBehavior.onDragStartObservable.add((function() {
                            i.onDragStartObservable.notifyObservers({})
                        }
                        )),
                        e.dragBehavior.onDragEndObservable.add((function() {
                            i.onDragEndObservable.notifyObservers({})
                        }
                        ))
                    }
                    )),
                    i.attachedMesh = null,
                    i
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "attachedMesh", {
                    set: function(e) {
                        this.xGizmo && (this.xGizmo.attachedMesh = e,
                        this.yGizmo.attachedMesh = e,
                        this.zGizmo.attachedMesh = e,
                        this.uniformScaleGizmo.attachedMesh = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "updateGizmoRotationToMatchAttachedMesh", {
                    get: function() {
                        return this.xGizmo.updateGizmoRotationToMatchAttachedMesh
                    },
                    set: function(t) {
                        t || e.Tools.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported."),
                        this.xGizmo && (this.xGizmo.updateGizmoRotationToMatchAttachedMesh = t,
                        this.yGizmo.updateGizmoRotationToMatchAttachedMesh = t,
                        this.zGizmo.updateGizmoRotationToMatchAttachedMesh = t)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "snapDistance", {
                    get: function() {
                        return this.xGizmo.snapDistance
                    },
                    set: function(e) {
                        this.xGizmo && (this.xGizmo.snapDistance = e,
                        this.yGizmo.snapDistance = e,
                        this.zGizmo.snapDistance = e,
                        this.uniformScaleGizmo.snapDistance = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "scaleRatio", {
                    get: function() {
                        return this.xGizmo.scaleRatio
                    },
                    set: function(e) {
                        this.xGizmo && (this.xGizmo.scaleRatio = e,
                        this.yGizmo.scaleRatio = e,
                        this.zGizmo.scaleRatio = e,
                        this.uniformScaleGizmo.scaleRatio = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.dispose = function() {
                    this.xGizmo.dispose(),
                    this.yGizmo.dispose(),
                    this.zGizmo.dispose(),
                    this.uniformScaleGizmo.dispose(),
                    this.onDragStartObservable.clear(),
                    this.onDragEndObservable.clear()
                }
                ,
                r
            }(e.Gizmo);
            e.ScaleGizmo = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(i, n) {
                    void 0 === i && (i = e.Color3.Gray()),
                    void 0 === n && (n = e.UtilityLayerRenderer.DefaultKeepDepthUtilityLayer);
                    var o = t.call(this, n) || this;
                    o._boundingDimensions = new e.Vector3(1,1,1),
                    o._renderObserver = null,
                    o._pointerObserver = null,
                    o._scaleDragSpeed = .2,
                    o._tmpQuaternion = new e.Quaternion,
                    o._tmpVector = new e.Vector3(0,0,0),
                    o._tmpRotationMatrix = new e.Matrix,
                    o.ignoreChildren = !1,
                    o.includeChildPredicate = null,
                    o.rotationSphereSize = .1,
                    o.scaleBoxSize = .1,
                    o.fixedDragMeshScreenSize = !1,
                    o.fixedDragMeshScreenSizeDistanceFactor = 10,
                    o.onDragStartObservable = new e.Observable,
                    o.onScaleBoxDragObservable = new e.Observable,
                    o.onScaleBoxDragEndObservable = new e.Observable,
                    o.onRotationSphereDragObservable = new e.Observable,
                    o.onRotationSphereDragEndObservable = new e.Observable,
                    o.scalePivot = null,
                    o._existingMeshScale = new e.Vector3,
                    o._updateScale = !1,
                    o._anchorMesh = new e.AbstractMesh("anchor",n.utilityLayerScene);
                    var a = new e.StandardMaterial("",n.utilityLayerScene);
                    a.disableLighting = !0,
                    a.emissiveColor = i;
                    var s = new e.StandardMaterial("",n.utilityLayerScene);
                    s.disableLighting = !0,
                    s.emissiveColor = i.clone().add(new e.Color3(.3,.3,.3)),
                    o._lineBoundingBox = new e.AbstractMesh("",n.utilityLayerScene),
                    o._lineBoundingBox.rotationQuaternion = new e.Quaternion;
                    var y = [];
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(0,0,0), new e.Vector3(o._boundingDimensions.x,0,0)]
                    }, n.utilityLayerScene)),
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(0,0,0), new e.Vector3(0,o._boundingDimensions.y,0)]
                    }, n.utilityLayerScene)),
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(0,0,0), new e.Vector3(0,0,o._boundingDimensions.z)]
                    }, n.utilityLayerScene)),
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(o._boundingDimensions.x,0,0), new e.Vector3(o._boundingDimensions.x,o._boundingDimensions.y,0)]
                    }, n.utilityLayerScene)),
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(o._boundingDimensions.x,0,0), new e.Vector3(o._boundingDimensions.x,0,o._boundingDimensions.z)]
                    }, n.utilityLayerScene)),
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(0,o._boundingDimensions.y,0), new e.Vector3(o._boundingDimensions.x,o._boundingDimensions.y,0)]
                    }, n.utilityLayerScene)),
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(0,o._boundingDimensions.y,0), new e.Vector3(0,o._boundingDimensions.y,o._boundingDimensions.z)]
                    }, n.utilityLayerScene)),
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(0,0,o._boundingDimensions.z), new e.Vector3(o._boundingDimensions.x,0,o._boundingDimensions.z)]
                    }, n.utilityLayerScene)),
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(0,0,o._boundingDimensions.z), new e.Vector3(0,o._boundingDimensions.y,o._boundingDimensions.z)]
                    }, n.utilityLayerScene)),
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(o._boundingDimensions.x,o._boundingDimensions.y,o._boundingDimensions.z), new e.Vector3(0,o._boundingDimensions.y,o._boundingDimensions.z)]
                    }, n.utilityLayerScene)),
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(o._boundingDimensions.x,o._boundingDimensions.y,o._boundingDimensions.z), new e.Vector3(o._boundingDimensions.x,0,o._boundingDimensions.z)]
                    }, n.utilityLayerScene)),
                    y.push(e.MeshBuilder.CreateLines("lines", {
                        points: [new e.Vector3(o._boundingDimensions.x,o._boundingDimensions.y,o._boundingDimensions.z), new e.Vector3(o._boundingDimensions.x,o._boundingDimensions.y,0)]
                    }, n.utilityLayerScene)),
                    y.forEach((function(t) {
                        t.color = i,
                        t.position.addInPlace(new e.Vector3(-o._boundingDimensions.x / 2,-o._boundingDimensions.y / 2,-o._boundingDimensions.z / 2)),
                        t.isPickable = !1,
                        o._lineBoundingBox.addChild(t)
                    }
                    )),
                    o._rootMesh.addChild(o._lineBoundingBox),
                    o._rotateSpheresParent = new e.AbstractMesh("",n.utilityLayerScene),
                    o._rotateSpheresParent.rotationQuaternion = new e.Quaternion;
                    for (var l = function(t) {
                        var i = e.MeshBuilder.CreateSphere("", {
                            diameter: 1
                        }, n.utilityLayerScene);
                        i.rotationQuaternion = new e.Quaternion,
                        i.material = a,
                        (x = new e.PointerDragBehavior({})).moveAttached = !1,
                        x.updateDragPlane = !1,
                        i.addBehavior(x);
                        var s = new e.Vector3(1,0,0)
                          , y = 0;
                        x.onDragStartObservable.add((function(e) {
                            s.copyFrom(i.forward),
                            y = 0
                        }
                        )),
                        x.onDragObservable.add((function(i) {
                            if (o.onRotationSphereDragObservable.notifyObservers({}),
                            o.attachedMesh) {
                                r._RemoveAndStorePivotPoint(o.attachedMesh);
                                var n = s
                                  , a = i.dragPlaneNormal.scale(e.Vector3.Dot(i.dragPlaneNormal, n))
                                  , l = n.subtract(a).normalizeToNew()
                                  , c = -e.Vector3.Dot(l, i.delta);
                                c = c / o._boundingDimensions.length() * o._anchorMesh.scaling.length(),
                                o.attachedMesh.rotationQuaternion || (o.attachedMesh.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(o.attachedMesh.rotation.y, o.attachedMesh.rotation.x, o.attachedMesh.rotation.z)),
                                o._anchorMesh.rotationQuaternion || (o._anchorMesh.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(o._anchorMesh.rotation.y, o._anchorMesh.rotation.x, o._anchorMesh.rotation.z)),
                                y += c,
                                Math.abs(y) <= 2 * Math.PI && (t >= 8 ? e.Quaternion.RotationYawPitchRollToRef(0, 0, c, o._tmpQuaternion) : t >= 4 ? e.Quaternion.RotationYawPitchRollToRef(c, 0, 0, o._tmpQuaternion) : e.Quaternion.RotationYawPitchRollToRef(0, c, 0, o._tmpQuaternion),
                                o._anchorMesh.addChild(o.attachedMesh),
                                o._anchorMesh.rotationQuaternion.multiplyToRef(o._tmpQuaternion, o._anchorMesh.rotationQuaternion),
                                o._anchorMesh.removeChild(o.attachedMesh)),
                                o.updateBoundingBox(),
                                r._RestorePivotPoint(o.attachedMesh)
                            }
                        }
                        )),
                        x.onDragStartObservable.add((function() {
                            o.onDragStartObservable.notifyObservers({}),
                            o._selectNode(i)
                        }
                        )),
                        x.onDragEndObservable.add((function() {
                            o.onRotationSphereDragEndObservable.notifyObservers({}),
                            o._selectNode(null)
                        }
                        )),
                        c._rotateSpheresParent.addChild(i)
                    }, c = this, h = 0; h < 12; h++)
                        l(h);
                    o._rootMesh.addChild(o._rotateSpheresParent),
                    o._scaleBoxesParent = new e.AbstractMesh("",n.utilityLayerScene),
                    o._scaleBoxesParent.rotationQuaternion = new e.Quaternion;
                    for (var u = 0; u < 2; u++)
                        for (var d = 0; d < 2; d++)
                            for (var x, p = function() {
                                var t = e.MeshBuilder.CreateBox("", {
                                    size: 1
                                }, n.utilityLayerScene);
                                t.material = a;
                                var i = new e.Vector3(0 == u ? -1 : 1,0 == d ? -1 : 1,0 == m ? -1 : 1);
                                (x = new e.PointerDragBehavior({
                                    dragAxis: i
                                })).moveAttached = !1,
                                t.addBehavior(x),
                                x.onDragObservable.add((function(i) {
                                    if (o.onScaleBoxDragObservable.notifyObservers({}),
                                    o.attachedMesh) {
                                        r._RemoveAndStorePivotPoint(o.attachedMesh);
                                        var n = i.dragDistance / o._boundingDimensions.length() * o._anchorMesh.scaling.length()
                                          , a = new e.Vector3(n,n,n);
                                        a.scaleInPlace(o._scaleDragSpeed),
                                        o.updateBoundingBox(),
                                        o.scalePivot ? (o.attachedMesh.getWorldMatrix().getRotationMatrixToRef(o._tmpRotationMatrix),
                                        o._boundingDimensions.scaleToRef(.5, o._tmpVector),
                                        e.Vector3.TransformCoordinatesToRef(o._tmpVector, o._tmpRotationMatrix, o._tmpVector),
                                        o._anchorMesh.position.subtractInPlace(o._tmpVector),
                                        o._boundingDimensions.multiplyToRef(o.scalePivot, o._tmpVector),
                                        e.Vector3.TransformCoordinatesToRef(o._tmpVector, o._tmpRotationMatrix, o._tmpVector),
                                        o._anchorMesh.position.addInPlace(o._tmpVector)) : (t.absolutePosition.subtractToRef(o._anchorMesh.position, o._tmpVector),
                                        o._anchorMesh.position.subtractInPlace(o._tmpVector)),
                                        o._anchorMesh.addChild(o.attachedMesh),
                                        o._anchorMesh.scaling.addInPlace(a),
                                        (o._anchorMesh.scaling.x < 0 || o._anchorMesh.scaling.y < 0 || o._anchorMesh.scaling.z < 0) && o._anchorMesh.scaling.subtractInPlace(a),
                                        o._anchorMesh.removeChild(o.attachedMesh),
                                        r._RestorePivotPoint(o.attachedMesh)
                                    }
                                }
                                )),
                                x.onDragStartObservable.add((function() {
                                    o.onDragStartObservable.notifyObservers({}),
                                    o._selectNode(t)
                                }
                                )),
                                x.onDragEndObservable.add((function() {
                                    o.onScaleBoxDragEndObservable.notifyObservers({}),
                                    o._selectNode(null)
                                }
                                )),
                                f._scaleBoxesParent.addChild(t)
                            }, f = this, m = 0; m < 2; m++)
                                p();
                    o._rootMesh.addChild(o._scaleBoxesParent);
                    var z = new Array;
                    return o._pointerObserver = n.utilityLayerScene.onPointerObservable.add((function(e, t) {
                        z[e.event.pointerId] ? e.pickInfo && e.pickInfo.pickedMesh != z[e.event.pointerId] && (z[e.event.pointerId].material = a,
                        delete z[e.event.pointerId]) : o._rotateSpheresParent.getChildMeshes().concat(o._scaleBoxesParent.getChildMeshes()).forEach((function(t) {
                            e.pickInfo && e.pickInfo.pickedMesh == t && (z[e.event.pointerId] = t,
                            t.material = s)
                        }
                        ))
                    }
                    )),
                    o._renderObserver = o.gizmoLayer.originalScene.onBeforeRenderObservable.add((function() {
                        o.attachedMesh && !o._existingMeshScale.equals(o.attachedMesh.scaling) && o.updateBoundingBox()
                    }
                    )),
                    o.updateBoundingBox(),
                    o
                }
                return o(r, t),
                r._RemoveAndStorePivotPoint = function(t) {
                    t && 0 === r._PivotCached && (t.getPivotPointToRef(r._OldPivotPoint),
                    r._OldPivotPoint.equalsToFloats(0, 0, 0) || (t.setPivotMatrix(e.Matrix.IdentityReadOnly),
                    r._OldPivotPoint.subtractToRef(t.getPivotPoint(), r._PivotTranslation),
                    r._PivotTmpVector.copyFromFloats(1, 1, 1),
                    r._PivotTmpVector.subtractInPlace(t.scaling),
                    r._PivotTmpVector.multiplyInPlace(r._PivotTranslation),
                    t.position.addInPlace(r._PivotTmpVector))),
                    r._PivotCached++
                }
                ,
                r._RestorePivotPoint = function(e) {
                    e && !r._OldPivotPoint.equalsToFloats(0, 0, 0) && 1 === r._PivotCached && (e.setPivotPoint(r._OldPivotPoint),
                    r._PivotTmpVector.copyFromFloats(1, 1, 1),
                    r._PivotTmpVector.subtractInPlace(e.scaling),
                    r._PivotTmpVector.multiplyInPlace(r._PivotTranslation),
                    e.position.subtractInPlace(r._PivotTmpVector)),
                    this._PivotCached--
                }
                ,
                r.prototype._attachedMeshChanged = function(e) {
                    e && (r._RemoveAndStorePivotPoint(e),
                    this._anchorMesh.addChild(e),
                    this._anchorMesh.removeChild(e),
                    r._RestorePivotPoint(e),
                    this.updateBoundingBox())
                }
                ,
                r.prototype._selectNode = function(e) {
                    this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach((function(t, r) {
                        t.isVisible = !e || t == e
                    }
                    ))
                }
                ,
                r.prototype.updateBoundingBox = function() {
                    if (this.attachedMesh) {
                        r._RemoveAndStorePivotPoint(this.attachedMesh),
                        this._update(),
                        this.attachedMesh.rotationQuaternion || (this.attachedMesh.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(this.attachedMesh.rotation.y, this.attachedMesh.rotation.x, this.attachedMesh.rotation.z)),
                        this._anchorMesh.rotationQuaternion || (this._anchorMesh.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(this._anchorMesh.rotation.y, this._anchorMesh.rotation.x, this._anchorMesh.rotation.z)),
                        this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),
                        this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),
                        this._tmpVector.copyFrom(this.attachedMesh.position),
                        this.attachedMesh.rotationQuaternion.set(0, 0, 0, 1),
                        this.attachedMesh.position.set(0, 0, 0);
                        var t = this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren, this.includeChildPredicate);
                        t.max.subtractToRef(t.min, this._boundingDimensions),
                        this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),
                        this._lineBoundingBox.position.set((t.max.x + t.min.x) / 2, (t.max.y + t.min.y) / 2, (t.max.z + t.min.z) / 2),
                        this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),
                        this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),
                        this._lineBoundingBox.computeWorldMatrix(),
                        this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),
                        this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),
                        this.attachedMesh.position.copyFrom(this._tmpVector)
                    }
                    for (var i = this._rotateSpheresParent.getChildMeshes(), n = 0; n < 3; n++)
                        for (var o = 0; o < 2; o++)
                            for (var a = 0; a < 2; a++) {
                                var s = 4 * n + 2 * o + a;
                                if (0 == n && (i[s].position.set(this._boundingDimensions.x / 2, this._boundingDimensions.y * o, this._boundingDimensions.z * a),
                                i[s].position.addInPlace(new e.Vector3(-this._boundingDimensions.x / 2,-this._boundingDimensions.y / 2,-this._boundingDimensions.z / 2)),
                                i[s].lookAt(e.Vector3.Cross(e.Vector3.Right(), i[s].position.normalizeToNew()).normalizeToNew().add(i[s].position))),
                                1 == n && (i[s].position.set(this._boundingDimensions.x * o, this._boundingDimensions.y / 2, this._boundingDimensions.z * a),
                                i[s].position.addInPlace(new e.Vector3(-this._boundingDimensions.x / 2,-this._boundingDimensions.y / 2,-this._boundingDimensions.z / 2)),
                                i[s].lookAt(e.Vector3.Cross(e.Vector3.Up(), i[s].position.normalizeToNew()).normalizeToNew().add(i[s].position))),
                                2 == n && (i[s].position.set(this._boundingDimensions.x * o, this._boundingDimensions.y * a, this._boundingDimensions.z / 2),
                                i[s].position.addInPlace(new e.Vector3(-this._boundingDimensions.x / 2,-this._boundingDimensions.y / 2,-this._boundingDimensions.z / 2)),
                                i[s].lookAt(e.Vector3.Cross(e.Vector3.Forward(), i[s].position.normalizeToNew()).normalizeToNew().add(i[s].position))),
                                this.fixedDragMeshScreenSize) {
                                    this._rootMesh.computeWorldMatrix(),
                                    this._rotateSpheresParent.computeWorldMatrix(),
                                    i[s].computeWorldMatrix(),
                                    i[s].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position, this._tmpVector);
                                    var y = this.rotationSphereSize * this._tmpVector.length() / this.fixedDragMeshScreenSizeDistanceFactor;
                                    i[s].scaling.set(y, y, y)
                                } else
                                    i[s].scaling.set(this.rotationSphereSize, this.rotationSphereSize, this.rotationSphereSize)
                            }
                    var l = this._scaleBoxesParent.getChildMeshes();
                    for (n = 0; n < 2; n++)
                        for (o = 0; o < 2; o++)
                            for (a = 0; a < 2; a++) {
                                if (l[s = 4 * n + 2 * o + a])
                                    if (l[s].position.set(this._boundingDimensions.x * n, this._boundingDimensions.y * o, this._boundingDimensions.z * a),
                                    l[s].position.addInPlace(new e.Vector3(-this._boundingDimensions.x / 2,-this._boundingDimensions.y / 2,-this._boundingDimensions.z / 2)),
                                    this.fixedDragMeshScreenSize) {
                                        this._rootMesh.computeWorldMatrix(),
                                        this._scaleBoxesParent.computeWorldMatrix(),
                                        l[s].computeWorldMatrix(),
                                        l[s].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position, this._tmpVector);
                                        y = this.scaleBoxSize * this._tmpVector.length() / this.fixedDragMeshScreenSizeDistanceFactor;
                                        l[s].scaling.set(y, y, y)
                                    } else
                                        l[s].scaling.set(this.scaleBoxSize, this.scaleBoxSize, this.scaleBoxSize)
                            }
                    this.attachedMesh && (this._existingMeshScale.copyFrom(this.attachedMesh.scaling),
                    r._RestorePivotPoint(this.attachedMesh))
                }
                ,
                r.prototype.setEnabledRotationAxis = function(e) {
                    this._rotateSpheresParent.getChildMeshes().forEach((function(t, r) {
                        r < 4 ? t.setEnabled(-1 != e.indexOf("x")) : r < 8 ? t.setEnabled(-1 != e.indexOf("y")) : t.setEnabled(-1 != e.indexOf("z"))
                    }
                    ))
                }
                ,
                r.prototype.dispose = function() {
                    this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),
                    this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),
                    this._lineBoundingBox.dispose(),
                    this._rotateSpheresParent.dispose(),
                    this._scaleBoxesParent.dispose(),
                    t.prototype.dispose.call(this)
                }
                ,
                r.MakeNotPickableAndWrapInBoundingBox = function(t) {
                    var r = function(e) {
                        e.isPickable = !1,
                        e.getChildMeshes().forEach((function(e) {
                            r(e)
                        }
                        ))
                    };
                    r(t),
                    t.rotationQuaternion || (t.rotationQuaternion = e.Quaternion.RotationYawPitchRoll(t.rotation.y, t.rotation.x, t.rotation.z));
                    var i = t.position.clone()
                      , n = t.rotationQuaternion.clone();
                    t.rotationQuaternion.set(0, 0, 0, 1),
                    t.position.set(0, 0, 0);
                    var o = e.MeshBuilder.CreateBox("box", {
                        size: 1
                    }, t.getScene())
                      , a = t.getHierarchyBoundingVectors();
                    return a.max.subtractToRef(a.min, o.scaling),
                    o.position.set((a.max.x + a.min.x) / 2, (a.max.y + a.min.y) / 2, (a.max.z + a.min.z) / 2),
                    t.addChild(o),
                    t.rotationQuaternion.copyFrom(n),
                    t.position.copyFrom(i),
                    t.removeChild(o),
                    o.addChild(t),
                    o.visibility = 0,
                    o
                }
                ,
                r.prototype.setCustomMesh = function(t) {
                    e.Tools.Error("Custom meshes are not supported on this gizmo")
                }
                ,
                r._PivotCached = 0,
                r._OldPivotPoint = new e.Vector3,
                r._PivotTranslation = new e.Vector3,
                r._PivotTmpVector = new e.Vector3,
                r
            }(e.Gizmo);
            e.BoundingBoxGizmo = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    var r = this;
                    this.scene = t,
                    this._gizmosEnabled = {
                        positionGizmo: !1,
                        rotationGizmo: !1,
                        scaleGizmo: !1,
                        boundingBoxGizmo: !1
                    },
                    this._pointerObserver = null,
                    this._attachedMesh = null,
                    this._boundingBoxColor = e.Color3.FromHexString("#0984e3"),
                    this.boundingBoxDragBehavior = new e.SixDofDragBehavior,
                    this.attachableMeshes = null,
                    this.usePointerToAttachGizmos = !0,
                    this._defaultKeepDepthUtilityLayer = new e.UtilityLayerRenderer(t),
                    this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil = !1,
                    this._defaultUtilityLayer = new e.UtilityLayerRenderer(t),
                    this.gizmos = {
                        positionGizmo: null,
                        rotationGizmo: null,
                        scaleGizmo: null,
                        boundingBoxGizmo: null
                    },
                    this._pointerObserver = t.onPointerObservable.add((function(t, i) {
                        if (r.usePointerToAttachGizmos && t.type == e.PointerEventTypes.POINTERDOWN)
                            if (t.pickInfo && t.pickInfo.pickedMesh) {
                                var n = t.pickInfo.pickedMesh;
                                if (null == r.attachableMeshes)
                                    for (; n && null != n.parent; )
                                        n = n.parent;
                                else {
                                    var o = !1;
                                    r.attachableMeshes.forEach((function(e) {
                                        n && (n == e || n.isDescendantOf(e)) && (n = e,
                                        o = !0)
                                    }
                                    )),
                                    o || (n = null)
                                }
                                n instanceof e.AbstractMesh ? r._attachedMesh != n && r.attachToMesh(n) : r.attachToMesh(null)
                            } else
                                r.attachToMesh(null)
                    }
                    ))
                }
                return t.prototype.attachToMesh = function(e) {
                    for (var t in this._attachedMesh && this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),
                    this._attachedMesh = e,
                    this.gizmos) {
                        var r = this.gizmos[t];
                        r && this._gizmosEnabled[t] && (r.attachedMesh = e)
                    }
                    this.boundingBoxGizmoEnabled && this._attachedMesh && this._attachedMesh.addBehavior(this.boundingBoxDragBehavior)
                }
                ,
                Object.defineProperty(t.prototype, "positionGizmoEnabled", {
                    get: function() {
                        return this._gizmosEnabled.positionGizmo
                    },
                    set: function(t) {
                        t ? (this.gizmos.positionGizmo || (this.gizmos.positionGizmo = new e.PositionGizmo(this._defaultUtilityLayer)),
                        this.gizmos.positionGizmo.attachedMesh = this._attachedMesh) : this.gizmos.positionGizmo && (this.gizmos.positionGizmo.attachedMesh = null),
                        this._gizmosEnabled.positionGizmo = t
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "rotationGizmoEnabled", {
                    get: function() {
                        return this._gizmosEnabled.rotationGizmo
                    },
                    set: function(t) {
                        t ? (this.gizmos.rotationGizmo || (this.gizmos.rotationGizmo = new e.RotationGizmo(this._defaultUtilityLayer)),
                        this.gizmos.rotationGizmo.attachedMesh = this._attachedMesh) : this.gizmos.rotationGizmo && (this.gizmos.rotationGizmo.attachedMesh = null),
                        this._gizmosEnabled.rotationGizmo = t
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "scaleGizmoEnabled", {
                    get: function() {
                        return this._gizmosEnabled.scaleGizmo
                    },
                    set: function(t) {
                        t ? (this.gizmos.scaleGizmo = this.gizmos.scaleGizmo || new e.ScaleGizmo(this._defaultUtilityLayer),
                        this.gizmos.scaleGizmo.attachedMesh = this._attachedMesh) : this.gizmos.scaleGizmo && (this.gizmos.scaleGizmo.attachedMesh = null),
                        this._gizmosEnabled.scaleGizmo = t
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "boundingBoxGizmoEnabled", {
                    get: function() {
                        return this._gizmosEnabled.boundingBoxGizmo
                    },
                    set: function(t) {
                        t ? (this.gizmos.boundingBoxGizmo = this.gizmos.boundingBoxGizmo || new e.BoundingBoxGizmo(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),
                        this.gizmos.boundingBoxGizmo.attachedMesh = this._attachedMesh,
                        this._attachedMesh && (this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),
                        this._attachedMesh.addBehavior(this.boundingBoxDragBehavior))) : this.gizmos.boundingBoxGizmo && (this.gizmos.boundingBoxGizmo.attachedMesh = null),
                        this._gizmosEnabled.boundingBoxGizmo = t
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.dispose = function() {
                    for (var e in this.scene.onPointerObservable.remove(this._pointerObserver),
                    this.gizmos) {
                        var t = this.gizmos[e];
                        t && t.dispose()
                    }
                    this._defaultKeepDepthUtilityLayer.dispose(),
                    this._defaultUtilityLayer.dispose(),
                    this.boundingBoxDragBehavior.detach()
                }
                ,
                t
            }();
            e.GizmoManager = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i) {
                    void 0 === r && (r = 0),
                    void 0 === i && (i = null),
                    this.name = t,
                    this.animations = new Array,
                    this._positions = null,
                    this._normals = null,
                    this._tangents = null,
                    this.onInfluenceChanged = new e.Observable,
                    this._onDataLayoutChanged = new e.Observable,
                    this._animationPropertiesOverride = null,
                    this._scene = i || e.Engine.LastCreatedScene,
                    this.influence = r
                }
                return Object.defineProperty(t.prototype, "influence", {
                    get: function() {
                        return this._influence
                    },
                    set: function(e) {
                        if (this._influence !== e) {
                            var t = this._influence;
                            this._influence = e,
                            this.onInfluenceChanged.hasObservers && this.onInfluenceChanged.notifyObservers(0 === t || 0 === e)
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "animationPropertiesOverride", {
                    get: function() {
                        return !this._animationPropertiesOverride && this._scene ? this._scene.animationPropertiesOverride : this._animationPropertiesOverride
                    },
                    set: function(e) {
                        this._animationPropertiesOverride = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "hasPositions", {
                    get: function() {
                        return !!this._positions
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "hasNormals", {
                    get: function() {
                        return !!this._normals
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "hasTangents", {
                    get: function() {
                        return !!this._tangents
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.setPositions = function(e) {
                    var t = this.hasPositions;
                    this._positions = e,
                    t !== this.hasPositions && this._onDataLayoutChanged.notifyObservers(void 0)
                }
                ,
                t.prototype.getPositions = function() {
                    return this._positions
                }
                ,
                t.prototype.setNormals = function(e) {
                    var t = this.hasNormals;
                    this._normals = e,
                    t !== this.hasNormals && this._onDataLayoutChanged.notifyObservers(void 0)
                }
                ,
                t.prototype.getNormals = function() {
                    return this._normals
                }
                ,
                t.prototype.setTangents = function(e) {
                    var t = this.hasTangents;
                    this._tangents = e,
                    t !== this.hasTangents && this._onDataLayoutChanged.notifyObservers(void 0)
                }
                ,
                t.prototype.getTangents = function() {
                    return this._tangents
                }
                ,
                t.prototype.serialize = function() {
                    var t = {};
                    return t.name = this.name,
                    t.influence = this.influence,
                    t.positions = Array.prototype.slice.call(this.getPositions()),
                    this.hasNormals && (t.normals = Array.prototype.slice.call(this.getNormals())),
                    this.hasTangents && (t.tangents = Array.prototype.slice.call(this.getTangents())),
                    e.Animation.AppendSerializedAnimations(this, t),
                    t
                }
                ,
                t.Parse = function(r) {
                    var i = new t(r.name,r.influence);
                    if (i.setPositions(r.positions),
                    r.normals && i.setNormals(r.normals),
                    r.tangents && i.setTangents(r.tangents),
                    r.animations)
                        for (var n = 0; n < r.animations.length; n++) {
                            var o = r.animations[n];
                            i.animations.push(e.Animation.Parse(o))
                        }
                    return i
                }
                ,
                t.FromMesh = function(r, i, n) {
                    i || (i = r.name);
                    var o = new t(i,n,r.getScene());
                    return o.setPositions(r.getVerticesData(e.VertexBuffer.PositionKind)),
                    r.isVerticesDataPresent(e.VertexBuffer.NormalKind) && o.setNormals(r.getVerticesData(e.VertexBuffer.NormalKind)),
                    r.isVerticesDataPresent(e.VertexBuffer.TangentKind) && o.setTangents(r.getVerticesData(e.VertexBuffer.TangentKind)),
                    o
                }
                ,
                t
            }();
            e.MorphTarget = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    void 0 === t && (t = null),
                    this._targets = new Array,
                    this._targetInfluenceChangedObservers = new Array,
                    this._targetDataLayoutChangedObservers = new Array,
                    this._activeTargets = new e.SmartArray(16),
                    this._supportsNormals = !1,
                    this._supportsTangents = !1,
                    this._vertexCount = 0,
                    this._uniqueId = 0,
                    this._tempInfluences = new Array,
                    t || (t = e.Engine.LastCreatedScene),
                    this._scene = t,
                    this._scene && (this._scene.morphTargetManagers.push(this),
                    this._uniqueId = this._scene.getUniqueId())
                }
                return Object.defineProperty(t.prototype, "uniqueId", {
                    get: function() {
                        return this._uniqueId
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "vertexCount", {
                    get: function() {
                        return this._vertexCount
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "supportsNormals", {
                    get: function() {
                        return this._supportsNormals
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "supportsTangents", {
                    get: function() {
                        return this._supportsTangents
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "numTargets", {
                    get: function() {
                        return this._targets.length
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "numInfluencers", {
                    get: function() {
                        return this._activeTargets.length
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "influences", {
                    get: function() {
                        return this._influences
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getActiveTarget = function(e) {
                    return this._activeTargets.data[e]
                }
                ,
                t.prototype.getTarget = function(e) {
                    return this._targets[e]
                }
                ,
                t.prototype.addTarget = function(e) {
                    var t = this;
                    this._targets.push(e),
                    this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add((function(e) {
                        t._syncActiveTargets(e)
                    }
                    ))),
                    this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add((function() {
                        t._syncActiveTargets(!0)
                    }
                    ))),
                    this._syncActiveTargets(!0)
                }
                ,
                t.prototype.removeTarget = function(e) {
                    var t = this._targets.indexOf(e);
                    t >= 0 && (this._targets.splice(t, 1),
                    e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(t, 1)[0]),
                    e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(t, 1)[0]),
                    this._syncActiveTargets(!0))
                }
                ,
                t.prototype.serialize = function() {
                    var e = {};
                    e.id = this.uniqueId,
                    e.targets = [];
                    for (var t = 0, r = this._targets; t < r.length; t++) {
                        var i = r[t];
                        e.targets.push(i.serialize())
                    }
                    return e
                }
                ,
                t.prototype._syncActiveTargets = function(t) {
                    var r = 0;
                    this._activeTargets.reset(),
                    this._supportsNormals = !0,
                    this._supportsTangents = !0,
                    this._vertexCount = 0;
                    for (var i = 0, n = this._targets; i < n.length; i++) {
                        var o = n[i];
                        if (0 !== o.influence) {
                            this._activeTargets.push(o),
                            this._tempInfluences[r++] = o.influence,
                            this._supportsNormals = this._supportsNormals && o.hasNormals,
                            this._supportsTangents = this._supportsTangents && o.hasTangents;
                            var a = o.getPositions();
                            if (a) {
                                var s = a.length / 3;
                                if (0 === this._vertexCount)
                                    this._vertexCount = s;
                                else if (this._vertexCount !== s)
                                    return void e.Tools.Error("Incompatible target. Targets must all have the same vertices count.")
                            }
                        }
                    }
                    this._influences && this._influences.length === r || (this._influences = new Float32Array(r));
                    for (var y = 0; y < r; y++)
                        this._influences[y] = this._tempInfluences[y];
                    t && this.synchronize()
                }
                ,
                t.prototype.synchronize = function() {
                    if (this._scene)
                        for (var e = 0, t = this._scene.meshes; e < t.length; e++) {
                            var r = t[e];
                            r.morphTargetManager === this && r._syncGeometryWithMorphTargetManager()
                        }
                }
                ,
                t.Parse = function(r, i) {
                    var n = new t(i);
                    n._uniqueId = r.id;
                    for (var o = 0, a = r.targets; o < a.length; o++) {
                        var s = a[o];
                        n.addTarget(e.MorphTarget.Parse(s))
                    }
                    return n
                }
                ,
                t
            }();
            e.MorphTargetManager = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i) {
                    void 0 === i && (i = 2),
                    this.maxDepth = i,
                    this.dynamicContent = new Array,
                    this._maxBlockCapacity = r || 64,
                    this._selectionContent = new e.SmartArrayNoDuplicate(1024),
                    this._creationFunc = t
                }
                return t.prototype.update = function(e, r, i) {
                    t._CreateBlocks(e, r, i, this._maxBlockCapacity, 0, this.maxDepth, this, this._creationFunc)
                }
                ,
                t.prototype.addMesh = function(e) {
                    for (var t = 0; t < this.blocks.length; t++) {
                        this.blocks[t].addEntry(e)
                    }
                }
                ,
                t.prototype.select = function(e, t) {
                    this._selectionContent.reset();
                    for (var r = 0; r < this.blocks.length; r++) {
                        this.blocks[r].select(e, this._selectionContent, t)
                    }
                    return t ? this._selectionContent.concat(this.dynamicContent) : this._selectionContent.concatWithNoDuplicate(this.dynamicContent),
                    this._selectionContent
                }
                ,
                t.prototype.intersects = function(e, t, r) {
                    this._selectionContent.reset();
                    for (var i = 0; i < this.blocks.length; i++) {
                        this.blocks[i].intersects(e, t, this._selectionContent, r)
                    }
                    return r ? this._selectionContent.concat(this.dynamicContent) : this._selectionContent.concatWithNoDuplicate(this.dynamicContent),
                    this._selectionContent
                }
                ,
                t.prototype.intersectsRay = function(e) {
                    this._selectionContent.reset();
                    for (var t = 0; t < this.blocks.length; t++) {
                        this.blocks[t].intersectsRay(e, this._selectionContent)
                    }
                    return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),
                    this._selectionContent
                }
                ,
                t._CreateBlocks = function(t, r, i, n, o, a, s, y) {
                    s.blocks = new Array;
                    for (var l = new e.Vector3((r.x - t.x) / 2,(r.y - t.y) / 2,(r.z - t.z) / 2), c = 0; c < 2; c++)
                        for (var h = 0; h < 2; h++)
                            for (var u = 0; u < 2; u++) {
                                var d = t.add(l.multiplyByFloats(c, h, u))
                                  , x = t.add(l.multiplyByFloats(c + 1, h + 1, u + 1))
                                  , p = new e.OctreeBlock(d,x,n,o + 1,a,y);
                                p.addEntries(i),
                                s.blocks.push(p)
                            }
                }
                ,
                t.CreationFuncForMeshes = function(e, t) {
                    var r = e.getBoundingInfo();
                    !e.isBlocked && r.boundingBox.intersectsMinMax(t.minPoint, t.maxPoint) && t.entries.push(e)
                }
                ,
                t.CreationFuncForSubMeshes = function(e, t) {
                    e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint, t.maxPoint) && t.entries.push(e)
                }
                ,
                t
            }();
            e.Octree = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(e, t, r, i, n, o) {
                    this.entries = new Array,
                    this._boundingVectors = new Array,
                    this._capacity = r,
                    this._depth = i,
                    this._maxDepth = n,
                    this._creationFunc = o,
                    this._minPoint = e,
                    this._maxPoint = t,
                    this._boundingVectors.push(e.clone()),
                    this._boundingVectors.push(t.clone()),
                    this._boundingVectors.push(e.clone()),
                    this._boundingVectors[2].x = t.x,
                    this._boundingVectors.push(e.clone()),
                    this._boundingVectors[3].y = t.y,
                    this._boundingVectors.push(e.clone()),
                    this._boundingVectors[4].z = t.z,
                    this._boundingVectors.push(t.clone()),
                    this._boundingVectors[5].z = e.z,
                    this._boundingVectors.push(t.clone()),
                    this._boundingVectors[6].x = e.x,
                    this._boundingVectors.push(t.clone()),
                    this._boundingVectors[7].y = e.y
                }
                return Object.defineProperty(t.prototype, "capacity", {
                    get: function() {
                        return this._capacity
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "minPoint", {
                    get: function() {
                        return this._minPoint
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "maxPoint", {
                    get: function() {
                        return this._maxPoint
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.addEntry = function(e) {
                    if (this.blocks)
                        for (var t = 0; t < this.blocks.length; t++) {
                            this.blocks[t].addEntry(e)
                        }
                    else
                        this._creationFunc(e, this),
                        this.entries.length > this.capacity && this._depth < this._maxDepth && this.createInnerBlocks()
                }
                ,
                t.prototype.addEntries = function(e) {
                    for (var t = 0; t < e.length; t++) {
                        var r = e[t];
                        this.addEntry(r)
                    }
                }
                ,
                t.prototype.select = function(t, r, i) {
                    if (e.BoundingBox.IsInFrustum(this._boundingVectors, t)) {
                        if (this.blocks) {
                            for (var n = 0; n < this.blocks.length; n++) {
                                this.blocks[n].select(t, r, i)
                            }
                            return
                        }
                        i ? r.concat(this.entries) : r.concatWithNoDuplicate(this.entries)
                    }
                }
                ,
                t.prototype.intersects = function(t, r, i, n) {
                    if (e.BoundingBox.IntersectsSphere(this._minPoint, this._maxPoint, t, r)) {
                        if (this.blocks) {
                            for (var o = 0; o < this.blocks.length; o++) {
                                this.blocks[o].intersects(t, r, i, n)
                            }
                            return
                        }
                        n ? i.concat(this.entries) : i.concatWithNoDuplicate(this.entries)
                    }
                }
                ,
                t.prototype.intersectsRay = function(e, t) {
                    if (e.intersectsBoxMinMax(this._minPoint, this._maxPoint)) {
                        if (this.blocks) {
                            for (var r = 0; r < this.blocks.length; r++) {
                                this.blocks[r].intersectsRay(e, t)
                            }
                            return
                        }
                        t.concatWithNoDuplicate(this.entries)
                    }
                }
                ,
                t.prototype.createInnerBlocks = function() {
                    e.Octree._CreateBlocks(this._minPoint, this._maxPoint, this.entries, this._capacity, this._depth, this._maxDepth, this, this._creationFunc)
                }
                ,
                t
            }();
            e.OctreeBlock = t
        }(s || (s = {})),
        function(e) {
            e.Scene.prototype.createOrUpdateSelectionOctree = function(r, i) {
                void 0 === r && (r = 64),
                void 0 === i && (i = 2);
                var n = this._getComponent(e.SceneComponentConstants.NAME_OCTREE);
                n || (n = new t(this),
                this._addComponent(n)),
                this._selectionOctree || (this._selectionOctree = new e.Octree(e.Octree.CreationFuncForMeshes,r,i));
                var o = this.getWorldExtends();
                return this._selectionOctree.update(o.min, o.max, this.meshes),
                this._selectionOctree
            }
            ,
            Object.defineProperty(e.Scene.prototype, "selectionOctree", {
                get: function() {
                    return this._selectionOctree
                },
                enumerable: !0,
                configurable: !0
            }),
            e.AbstractMesh.prototype.createOrUpdateSubmeshesOctree = function(r, i) {
                void 0 === r && (r = 64),
                void 0 === i && (i = 2);
                var n = this.getScene()
                  , o = n._getComponent(e.SceneComponentConstants.NAME_OCTREE);
                o || (o = new t(n),
                n._addComponent(o)),
                this._submeshesOctree || (this._submeshesOctree = new e.Octree(e.Octree.CreationFuncForSubMeshes,r,i)),
                this.computeWorldMatrix(!0);
                var a = this.getBoundingInfo().boundingBox;
                return this._submeshesOctree.update(a.minimumWorld, a.maximumWorld, this.subMeshes),
                this._submeshesOctree
            }
            ;
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_OCTREE,
                    this.checksIsEnabled = !0,
                    this._tempRay = new e.Ray(e.Vector3.Zero(),new e.Vector3(1,1,1)),
                    this.scene = t,
                    this.scene.getActiveMeshCandidates = this.getActiveMeshCandidates.bind(this),
                    this.scene.getActiveSubMeshCandidates = this.getActiveSubMeshCandidates.bind(this),
                    this.scene.getCollidingSubMeshCandidates = this.getCollidingSubMeshCandidates.bind(this),
                    this.scene.getIntersectingSubMeshCandidates = this.getIntersectingSubMeshCandidates.bind(this)
                }
                return t.prototype.register = function() {
                    var e = this;
                    this.scene.onMeshRemovedObservable.add((function(t) {
                        var r = e.scene.selectionOctree;
                        if (null != r) {
                            var i = r.dynamicContent.indexOf(t);
                            -1 !== i && r.dynamicContent.splice(i, 1)
                        }
                    }
                    )),
                    this.scene.onMeshImportedObservable.add((function(t) {
                        var r = e.scene.selectionOctree;
                        null != r && r.addMesh(t)
                    }
                    ))
                }
                ,
                t.prototype.getActiveMeshCandidates = function() {
                    return this.scene._selectionOctree ? this.scene._selectionOctree.select(this.scene.frustumPlanes) : this.scene._getDefaultMeshCandidates()
                }
                ,
                t.prototype.getActiveSubMeshCandidates = function(e) {
                    return e._submeshesOctree && e.useOctreeForRenderingSelection ? e._submeshesOctree.select(this.scene.frustumPlanes) : this.scene._getDefaultSubMeshCandidates(e)
                }
                ,
                t.prototype.getIntersectingSubMeshCandidates = function(t, r) {
                    return t._submeshesOctree && t.useOctreeForPicking ? (e.Ray.TransformToRef(r, t.getWorldMatrix(), this._tempRay),
                    t._submeshesOctree.intersectsRay(this._tempRay)) : this.scene._getDefaultSubMeshCandidates(t)
                }
                ,
                t.prototype.getCollidingSubMeshCandidates = function(e, t) {
                    if (e._submeshesOctree && e.useOctreeForCollisions) {
                        var r = t._velocityWorldLength + Math.max(t._radius.x, t._radius.y, t._radius.z);
                        return e._submeshesOctree.intersects(t._basePointWorld, r)
                    }
                    return this.scene._getDefaultSubMeshCandidates(e)
                }
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.dispose = function() {}
                ,
                t
            }();
            e.OctreeSceneComponent = t
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t(t, r, i, n, o, a) {
                    var s = e.call(this, t, "anaglyph", null, ["leftSampler"], r, i[1], n, o, a) || this;
                    return s._passedProcess = i[0]._rigPostProcess,
                    s.onApplyObservable.add((function(e) {
                        e.setTextureFromPostProcess("leftSampler", s._passedProcess)
                    }
                    )),
                    s
                }
                return o(t, e),
                t
            }(e.PostProcess);
            e.AnaglyphPostProcess = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("AnaglyphArcRotateCamera", (function(r, i, n) {
                return function() {
                    return new t(r,0,0,1,e.Vector3.Zero(),n.interaxial_distance,i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o, a, s, y) {
                    var l = t.call(this, r, i, n, o, a, y) || this;
                    return l.interaxialDistance = s,
                    l.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH, {
                        interaxialDistance: s
                    }),
                    l
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "AnaglyphArcRotateCamera"
                }
                ,
                r
            }(e.ArcRotateCamera);
            e.AnaglyphArcRotateCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("AnaglyphFreeCamera", (function(r, i, n) {
                return function() {
                    return new t(r,e.Vector3.Zero(),n.interaxial_distance,i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o) {
                    var a = t.call(this, r, i, o) || this;
                    return a.interaxialDistance = n,
                    a.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH, {
                        interaxialDistance: n
                    }),
                    a
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "AnaglyphFreeCamera"
                }
                ,
                r
            }(e.FreeCamera);
            e.AnaglyphFreeCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("AnaglyphGamepadCamera", (function(r, i, n) {
                return function() {
                    return new t(r,e.Vector3.Zero(),n.interaxial_distance,i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o) {
                    var a = t.call(this, r, i, o) || this;
                    return a.interaxialDistance = n,
                    a.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH, {
                        interaxialDistance: n
                    }),
                    a
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "AnaglyphGamepadCamera"
                }
                ,
                r
            }(e.GamepadCamera);
            e.AnaglyphGamepadCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("AnaglyphUniversalCamera", (function(r, i, n) {
                return function() {
                    return new t(r,e.Vector3.Zero(),n.interaxial_distance,i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o) {
                    var a = t.call(this, r, i, o) || this;
                    return a.interaxialDistance = n,
                    a.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH, {
                        interaxialDistance: n
                    }),
                    a
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "AnaglyphUniversalCamera"
                }
                ,
                r
            }(e.UniversalCamera);
            e.AnaglyphUniversalCamera = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a, s) {
                    var y = t.call(this, r, "stereoscopicInterlace", ["stepSize"], ["camASampler"], 1, i[1], o, a, s, n ? "#define IS_STEREOSCOPIC_HORIZ 1" : void 0) || this;
                    return y._passedProcess = i[0]._rigPostProcess,
                    y._stepSize = new e.Vector2(1 / y.width,1 / y.height),
                    y.onSizeChangedObservable.add((function() {
                        y._stepSize = new e.Vector2(1 / y.width,1 / y.height)
                    }
                    )),
                    y.onApplyObservable.add((function(e) {
                        e.setTextureFromPostProcess("camASampler", y._passedProcess),
                        e.setFloat2("stepSize", y._stepSize.x, y._stepSize.y)
                    }
                    )),
                    y
                }
                return o(r, t),
                r
            }(e.PostProcess);
            e.StereoscopicInterlacePostProcess = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("StereoscopicArcRotateCamera", (function(r, i, n) {
                return function() {
                    return new t(r,0,0,1,e.Vector3.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l) {
                    var c = t.call(this, r, i, n, o, a, l) || this;
                    return c.interaxialDistance = s,
                    c.isStereoscopicSideBySide = y,
                    c.setCameraRigMode(y ? e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL : e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER, {
                        interaxialDistance: s
                    }),
                    c
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "StereoscopicArcRotateCamera"
                }
                ,
                r
            }(e.ArcRotateCamera);
            e.StereoscopicArcRotateCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("StereoscopicFreeCamera", (function(r, i, n) {
                return function() {
                    return new t(r,e.Vector3.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o, a) {
                    var s = t.call(this, r, i, a) || this;
                    return s.interaxialDistance = n,
                    s.isStereoscopicSideBySide = o,
                    s.setCameraRigMode(o ? e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL : e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER, {
                        interaxialDistance: n
                    }),
                    s
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "StereoscopicFreeCamera"
                }
                ,
                r
            }(e.FreeCamera);
            e.StereoscopicFreeCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("StereoscopicGamepadCamera", (function(r, i, n) {
                return function() {
                    return new t(r,e.Vector3.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o, a) {
                    var s = t.call(this, r, i, a) || this;
                    return s.interaxialDistance = n,
                    s.isStereoscopicSideBySide = o,
                    s.setCameraRigMode(o ? e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL : e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER, {
                        interaxialDistance: n
                    }),
                    s
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "StereoscopicGamepadCamera"
                }
                ,
                r
            }(e.GamepadCamera);
            e.StereoscopicGamepadCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("StereoscopicFreeCamera", (function(r, i, n) {
                return function() {
                    return new t(r,e.Vector3.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o, a) {
                    var s = t.call(this, r, i, a) || this;
                    return s.interaxialDistance = n,
                    s.isStereoscopicSideBySide = o,
                    s.setCameraRigMode(o ? e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL : e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER, {
                        interaxialDistance: n
                    }),
                    s
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "StereoscopicUniversalCamera"
                }
                ,
                r
            }(e.UniversalCamera);
            e.StereoscopicUniversalCamera = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o) {
                    var a = t.call(this, r, "vrDistortionCorrection", ["LensCenter", "Scale", "ScaleIn", "HmdWarpParam"], null, o.postProcessScaleFactor, i, e.Texture.BILINEAR_SAMPLINGMODE) || this;
                    return a._isRightEye = n,
                    a._distortionFactors = o.distortionK,
                    a._postProcessScaleFactor = o.postProcessScaleFactor,
                    a._lensCenterOffset = o.lensCenterOffset,
                    a.adaptScaleToCurrentViewport = !0,
                    a.onSizeChangedObservable.add((function() {
                        a._scaleIn = new e.Vector2(2,2 / a.aspectRatio),
                        a._scaleFactor = new e.Vector2(1 / a._postProcessScaleFactor * .5,1 / a._postProcessScaleFactor * .5 * a.aspectRatio),
                        a._lensCenter = new e.Vector2(a._isRightEye ? .5 - .5 * a._lensCenterOffset : .5 + .5 * a._lensCenterOffset,.5)
                    }
                    )),
                    a.onApplyObservable.add((function(e) {
                        e.setFloat2("LensCenter", a._lensCenter.x, a._lensCenter.y),
                        e.setFloat2("Scale", a._scaleFactor.x, a._scaleFactor.y),
                        e.setFloat2("ScaleIn", a._scaleIn.x, a._scaleIn.y),
                        e.setFloat4("HmdWarpParam", a._distortionFactors[0], a._distortionFactors[1], a._distortionFactors[2], a._distortionFactors[3])
                    }
                    )),
                    a
                }
                return o(r, t),
                r
            }(e.PostProcess);
            e.VRDistortionCorrectionPostProcess = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    var t = this;
                    this._screenOrientationAngle = 0,
                    this._screenQuaternion = new e.Quaternion,
                    this._alpha = 0,
                    this._beta = 0,
                    this._gamma = 0,
                    this._orientationChanged = function() {
                        t._screenOrientationAngle = void 0 !== window.orientation ? +window.orientation : window.screen.orientation && window.screen.orientation.angle ? window.screen.orientation.angle : 0,
                        t._screenOrientationAngle = -e.Tools.ToRadians(t._screenOrientationAngle / 2),
                        t._screenQuaternion.copyFromFloats(0, Math.sin(t._screenOrientationAngle), 0, Math.cos(t._screenOrientationAngle))
                    }
                    ,
                    this._deviceOrientation = function(e) {
                        t._alpha = null !== e.alpha ? e.alpha : 0,
                        t._beta = null !== e.beta ? e.beta : 0,
                        t._gamma = null !== e.gamma ? e.gamma : 0
                    }
                    ,
                    this._constantTranform = new e.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),
                    this._orientationChanged()
                }
                return Object.defineProperty(t.prototype, "camera", {
                    get: function() {
                        return this._camera
                    },
                    set: function(t) {
                        this._camera = t,
                        null == this._camera || this._camera.rotationQuaternion || (this._camera.rotationQuaternion = new e.Quaternion)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.attachControl = function(e, t) {
                    window.addEventListener("orientationchange", this._orientationChanged),
                    window.addEventListener("deviceorientation", this._deviceOrientation),
                    this._orientationChanged()
                }
                ,
                t.prototype.detachControl = function(e) {
                    window.removeEventListener("orientationchange", this._orientationChanged),
                    window.removeEventListener("deviceorientation", this._deviceOrientation)
                }
                ,
                t.prototype.checkInputs = function() {
                    this._alpha && (e.Quaternion.RotationYawPitchRollToRef(e.Tools.ToRadians(this._alpha), e.Tools.ToRadians(this._beta), -e.Tools.ToRadians(this._gamma), this.camera.rotationQuaternion),
                    this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),
                    this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),
                    this._camera.rotationQuaternion.z *= -1,
                    this._camera.rotationQuaternion.w *= -1)
                }
                ,
                t.prototype.getClassName = function() {
                    return "FreeCameraDeviceOrientationInput"
                }
                ,
                t.prototype.getSimpleName = function() {
                    return "deviceOrientation"
                }
                ,
                t
            }();
            e.FreeCameraDeviceOrientationInput = t,
            e.CameraInputTypes.FreeCameraDeviceOrientationInput = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e() {
                    this.alphaCorrection = 1,
                    this.betaCorrection = 1,
                    this.gammaCorrection = 1,
                    this._alpha = 0,
                    this._gamma = 0,
                    this._dirty = !1,
                    this._deviceOrientationHandler = this._onOrientationEvent.bind(this)
                }
                return e.prototype.attachControl = function(e, t) {
                    this.camera.attachControl(e, t),
                    window.addEventListener("deviceorientation", this._deviceOrientationHandler)
                }
                ,
                e.prototype._onOrientationEvent = function(e) {
                    null !== e.alpha && (this._alpha = 0 | +e.alpha),
                    null !== e.gamma && (this._gamma = 0 | +e.gamma),
                    this._dirty = !0
                }
                ,
                e.prototype.checkInputs = function() {
                    this._dirty && (this._dirty = !1,
                    this._gamma < 0 && (this._gamma = 180 + this._gamma),
                    this.camera.alpha = -this._alpha / 180 * Math.PI % Math.PI * 2,
                    this.camera.beta = this._gamma / 180 * Math.PI)
                }
                ,
                e.prototype.detachControl = function(e) {
                    window.removeEventListener("deviceorientation", this._deviceOrientationHandler)
                }
                ,
                e.prototype.getClassName = function() {
                    return "ArcRotateCameraVRDeviceOrientationInput"
                }
                ,
                e.prototype.getSimpleName = function() {
                    return "VRDeviceOrientation"
                }
                ,
                e
            }();
            e.ArcRotateCameraVRDeviceOrientationInput = t,
            e.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.compensateDistortion = !0
                }
                return Object.defineProperty(t.prototype, "aspectRatio", {
                    get: function() {
                        return this.hResolution / (2 * this.vResolution)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "aspectRatioFov", {
                    get: function() {
                        return 2 * Math.atan(this.postProcessScaleFactor * this.vScreenSize / (2 * this.eyeToScreenDistance))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "leftHMatrix", {
                    get: function() {
                        var t = 4 * (this.hScreenSize / 4 - this.lensSeparationDistance / 2) / this.hScreenSize;
                        return e.Matrix.Translation(t, 0, 0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "rightHMatrix", {
                    get: function() {
                        var t = 4 * (this.hScreenSize / 4 - this.lensSeparationDistance / 2) / this.hScreenSize;
                        return e.Matrix.Translation(-t, 0, 0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "leftPreViewMatrix", {
                    get: function() {
                        return e.Matrix.Translation(.5 * this.interpupillaryDistance, 0, 0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "rightPreViewMatrix", {
                    get: function() {
                        return e.Matrix.Translation(-.5 * this.interpupillaryDistance, 0, 0)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.GetDefault = function() {
                    var e = new t;
                    return e.hResolution = 1280,
                    e.vResolution = 800,
                    e.hScreenSize = .149759993,
                    e.vScreenSize = .0935999975,
                    e.vScreenCenter = .0467999987,
                    e.eyeToScreenDistance = .0410000011,
                    e.lensSeparationDistance = .063500002,
                    e.interpupillaryDistance = .064000003,
                    e.distortionK = [1, .219999999, .239999995, 0],
                    e.chromaAbCorrection = [.995999992, -.00400000019, 1.01400006, 0],
                    e.postProcessScaleFactor = 1.714605507808412,
                    e.lensCenterOffset = .151976421,
                    e
                }
                ,
                t
            }();
            e.VRCameraMetrics = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("WebVRFreeCamera", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            )),
            e.Node.AddNodeConstructor("WebVRGamepadCamera", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o) {
                    void 0 === o && (o = {});
                    var a = t.call(this, r, i, n) || this;
                    a.webVROptions = o,
                    a._vrDevice = null,
                    a.rawPose = null,
                    a._specsVersion = "1.1",
                    a._attached = !1,
                    a._descendants = [],
                    a._deviceRoomPosition = e.Vector3.Zero(),
                    a._deviceRoomRotationQuaternion = e.Quaternion.Identity(),
                    a._standingMatrix = null,
                    a.devicePosition = e.Vector3.Zero(),
                    a.deviceRotationQuaternion = e.Quaternion.Identity(),
                    a.deviceScaleFactor = 1,
                    a._deviceToWorld = e.Matrix.Identity(),
                    a._worldToDevice = e.Matrix.Identity(),
                    a.controllers = [],
                    a.onControllersAttachedObservable = new e.Observable,
                    a.onControllerMeshLoadedObservable = new e.Observable,
                    a.onPoseUpdatedFromDeviceObservable = new e.Observable,
                    a._poseSet = !1,
                    a.rigParenting = !0,
                    a._defaultHeight = void 0,
                    a._htmlElementAttached = null,
                    a._detachIfAttached = function() {
                        var e = a.getEngine().getVRDevice();
                        e && !e.isPresenting && a._htmlElementAttached && a.detachControl(a._htmlElementAttached)
                    }
                    ,
                    a._workingVector = e.Vector3.Zero(),
                    a._oneVector = e.Vector3.One(),
                    a._workingMatrix = e.Matrix.Identity(),
                    a._tmpMatrix = new e.Matrix,
                    a._cache.position = e.Vector3.Zero(),
                    o.defaultHeight && (a._defaultHeight = o.defaultHeight,
                    a.position.y = a._defaultHeight),
                    a.minZ = .1,
                    5 === arguments.length && (a.webVROptions = arguments[4]),
                    null == a.webVROptions.trackPosition && (a.webVROptions.trackPosition = !0),
                    null == a.webVROptions.controllerMeshes && (a.webVROptions.controllerMeshes = !0),
                    null == a.webVROptions.defaultLightingOnControllers && (a.webVROptions.defaultLightingOnControllers = !0),
                    a.rotationQuaternion = new e.Quaternion,
                    a.webVROptions && a.webVROptions.positionScale && (a.deviceScaleFactor = a.webVROptions.positionScale);
                    var s = a.getEngine();
                    return a._onVREnabled = function(e) {
                        e && a.initControllers()
                    }
                    ,
                    s.onVRRequestPresentComplete.add(a._onVREnabled),
                    s.initWebVR().add((function(t) {
                        t.vrDisplay && a._vrDevice !== t.vrDisplay && (a._vrDevice = t.vrDisplay,
                        a.setCameraRigMode(e.Camera.RIG_MODE_WEBVR, {
                            parentCamera: a,
                            vrDisplay: a._vrDevice,
                            frameData: a._frameData,
                            specs: a._specsVersion
                        }),
                        a._attached && a.getEngine().enableVR())
                    }
                    )),
                    "undefined" != typeof VRFrameData && (a._frameData = new VRFrameData),
                    n.onBeforeCameraRenderObservable.add((function(e) {
                        e.parent === a && a.rigParenting && (a._descendants = a.getDescendants(!0, (function(e) {
                            var t = a.controllers.some((function(t) {
                                return t._mesh === e
                            }
                            ))
                              , r = -1 !== a._rigCameras.indexOf(e);
                            return !t && !r
                        }
                        )),
                        a._descendants.forEach((function(t) {
                            t.parent = e
                        }
                        )))
                    }
                    )),
                    n.onAfterCameraRenderObservable.add((function(e) {
                        e.parent === a && a.rigParenting && a._descendants.forEach((function(e) {
                            e.parent = a
                        }
                        ))
                    }
                    )),
                    a
                }
                return o(r, t),
                r.prototype.deviceDistanceToRoomGround = function() {
                    return this._standingMatrix ? (this._standingMatrix.getTranslationToRef(this._workingVector),
                    this._deviceRoomPosition.y + this._workingVector.y) : this._defaultHeight || 0
                }
                ,
                r.prototype.useStandingMatrix = function(t) {
                    var r = this;
                    void 0 === t && (t = function(e) {}
                    ),
                    this.getEngine().initWebVRAsync().then((function(i) {
                        i.vrDisplay && i.vrDisplay.stageParameters && i.vrDisplay.stageParameters.sittingToStandingTransform && r.webVROptions.trackPosition ? (r._standingMatrix = new e.Matrix,
                        e.Matrix.FromFloat32ArrayToRefScaled(i.vrDisplay.stageParameters.sittingToStandingTransform, 0, 1, r._standingMatrix),
                        r.getScene().useRightHandedSystem || [2, 6, 8, 9, 14].forEach((function(e) {
                            r._standingMatrix && (r._standingMatrix.m[e] *= -1)
                        }
                        )),
                        t(!0)) : t(!1)
                    }
                    ))
                }
                ,
                r.prototype.useStandingMatrixAsync = function() {
                    var e = this;
                    return new Promise((function(t, r) {
                        e.useStandingMatrix((function(e) {
                            t(e)
                        }
                        ))
                    }
                    ))
                }
                ,
                r.prototype.dispose = function() {
                    this._detachIfAttached(),
                    this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),
                    this._updateCacheWhenTrackingDisabledObserver && this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),
                    t.prototype.dispose.call(this)
                }
                ,
                r.prototype.getControllerByName = function(e) {
                    for (var t = 0, r = this.controllers; t < r.length; t++) {
                        var i = r[t];
                        if (i.hand === e)
                            return i
                    }
                    return null
                }
                ,
                Object.defineProperty(r.prototype, "leftController", {
                    get: function() {
                        return this._leftController || (this._leftController = this.getControllerByName("left")),
                        this._leftController
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "rightController", {
                    get: function() {
                        return this._rightController || (this._rightController = this.getControllerByName("right")),
                        this._rightController
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getForwardRay = function(e) {
                    return void 0 === e && (e = 100),
                    this.leftCamera ? t.prototype.getForwardRay.call(this, e, this.leftCamera.getWorldMatrix(), this.leftCamera.globalPosition) : t.prototype.getForwardRay.call(this, e)
                }
                ,
                r.prototype._checkInputs = function() {
                    this._vrDevice && this._vrDevice.isPresenting && (this._vrDevice.getFrameData(this._frameData),
                    this.updateFromDevice(this._frameData.pose)),
                    t.prototype._checkInputs.call(this)
                }
                ,
                r.prototype.updateFromDevice = function(e) {
                    e && e.orientation && (this.rawPose = e,
                    this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[0], e.orientation[1], -e.orientation[2], -e.orientation[3]),
                    this.getScene().useRightHandedSystem && (this._deviceRoomRotationQuaternion.z *= -1,
                    this._deviceRoomRotationQuaternion.w *= -1),
                    this.webVROptions.trackPosition && this.rawPose.position && (this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0], this.rawPose.position[1], -this.rawPose.position[2]),
                    this.getScene().useRightHandedSystem && (this._deviceRoomPosition.z *= -1)),
                    this._poseSet = !0)
                }
                ,
                r.prototype.attachControl = function(r, i) {
                    t.prototype.attachControl.call(this, r, i),
                    this._attached = !0,
                    this._htmlElementAttached = r,
                    i = !e.Camera.ForceAttachControlToAlwaysPreventDefault && i,
                    this._vrDevice && this.getEngine().enableVR(),
                    window.addEventListener("vrdisplaypresentchange", this._detachIfAttached)
                }
                ,
                r.prototype.detachControl = function(e) {
                    this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),
                    this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),
                    t.prototype.detachControl.call(this, e),
                    this._attached = !1,
                    this.getEngine().disableVR(),
                    window.removeEventListener("vrdisplaypresentchange", this._detachIfAttached)
                }
                ,
                r.prototype.getClassName = function() {
                    return "WebVRFreeCamera"
                }
                ,
                r.prototype.resetToCurrentRotation = function() {
                    this._vrDevice.resetPose()
                }
                ,
                r.prototype._updateRigCameras = function() {
                    var e = this._rigCameras[0]
                      , t = this._rigCameras[1];
                    e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),
                    t.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),
                    e.position.copyFrom(this._deviceRoomPosition),
                    t.position.copyFrom(this._deviceRoomPosition)
                }
                ,
                r.prototype._correctPositionIfNotTrackPosition = function(t, r) {
                    void 0 === r && (r = !1),
                    this.rawPose && this.rawPose.position && !this.webVROptions.trackPosition && (e.Matrix.TranslationToRef(this.rawPose.position[0], this.rawPose.position[1], -this.rawPose.position[2], this._tmpMatrix),
                    r || this._tmpMatrix.invert(),
                    this._tmpMatrix.multiplyToRef(t, t))
                }
                ,
                r.prototype._updateCache = function(r) {
                    var i = this;
                    this.rotationQuaternion.equals(this._cache.rotationQuaternion) && this.position.equals(this._cache.position) || (this.updateCacheCalled || (this.updateCacheCalled = !0,
                    this.update()),
                    this.rotationQuaternion.toRotationMatrix(this._workingMatrix),
                    e.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition, this._workingMatrix, this._workingVector),
                    this.devicePosition.subtractToRef(this._workingVector, this._workingVector),
                    e.Matrix.ComposeToRef(this._oneVector, this.rotationQuaternion, this._workingVector, this._deviceToWorld),
                    this._deviceToWorld.getTranslationToRef(this._workingVector),
                    this._workingVector.addInPlace(this.position),
                    this._workingVector.subtractInPlace(this._cache.position),
                    this._deviceToWorld.setTranslation(this._workingVector),
                    this._deviceToWorld.invertToRef(this._worldToDevice),
                    this.controllers.forEach((function(e) {
                        e._deviceToWorld.copyFrom(i._deviceToWorld),
                        i._correctPositionIfNotTrackPosition(e._deviceToWorld),
                        e.update()
                    }
                    ))),
                    r || t.prototype._updateCache.call(this),
                    this.updateCacheCalled = !1
                }
                ,
                r.prototype._computeDevicePosition = function() {
                    e.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition, this._deviceToWorld, this.devicePosition)
                }
                ,
                r.prototype.update = function() {
                    this._computeDevicePosition(),
                    e.Matrix.FromQuaternionToRef(this._deviceRoomRotationQuaternion, this._workingMatrix),
                    this._workingMatrix.multiplyToRef(this._deviceToWorld, this._workingMatrix),
                    e.Quaternion.FromRotationMatrixToRef(this._workingMatrix, this.deviceRotationQuaternion),
                    this._poseSet && this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),
                    t.prototype.update.call(this)
                }
                ,
                r.prototype._getViewMatrix = function() {
                    return e.Matrix.Identity()
                }
                ,
                r.prototype._getWebVRViewMatrix = function() {
                    var t = this
                      , r = this._cameraRigParams.parentCamera;
                    r._updateCache();
                    var i = this._cameraRigParams.left ? this._cameraRigParams.frameData.leftViewMatrix : this._cameraRigParams.frameData.rightViewMatrix;
                    return e.Matrix.FromArrayToRef(i, 0, this._webvrViewMatrix),
                    this.getScene().useRightHandedSystem || [2, 6, 8, 9, 14].forEach((function(e) {
                        t._webvrViewMatrix.m[e] *= -1
                    }
                    )),
                    this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),
                    e.Vector3.TransformCoordinatesToRef(this._referencePoint, this._cameraRotationMatrix, this._transformedReferencePoint),
                    this.position.addToRef(this._transformedReferencePoint, this._currentTarget),
                    1 !== r.deviceScaleFactor && (this._webvrViewMatrix.invert(),
                    r.deviceScaleFactor && (this._webvrViewMatrix.m[12] *= r.deviceScaleFactor,
                    this._webvrViewMatrix.m[13] *= r.deviceScaleFactor,
                    this._webvrViewMatrix.m[14] *= r.deviceScaleFactor),
                    this._webvrViewMatrix.invert()),
                    r._correctPositionIfNotTrackPosition(this._webvrViewMatrix, !0),
                    r._worldToDevice.multiplyToRef(this._webvrViewMatrix, this._webvrViewMatrix),
                    this._workingMatrix = this._workingMatrix || e.Matrix.Identity(),
                    this._webvrViewMatrix.invertToRef(this._workingMatrix),
                    this._workingMatrix.multiplyToRef(r.getWorldMatrix(), this._workingMatrix),
                    this._workingMatrix.getTranslationToRef(this._globalPosition),
                    this._markSyncedWithParent(),
                    this._webvrViewMatrix
                }
                ,
                r.prototype._getWebVRProjectionMatrix = function() {
                    var t = this
                      , r = this.parent;
                    r._vrDevice.depthNear = r.minZ,
                    r._vrDevice.depthFar = r.maxZ;
                    var i = this._cameraRigParams.left ? this._cameraRigParams.frameData.leftProjectionMatrix : this._cameraRigParams.frameData.rightProjectionMatrix;
                    return e.Matrix.FromArrayToRef(i, 0, this._projectionMatrix),
                    this.getScene().useRightHandedSystem || [8, 9, 10, 11].forEach((function(e) {
                        t._projectionMatrix.m[e] *= -1
                    }
                    )),
                    this._projectionMatrix
                }
                ,
                r.prototype.initControllers = function() {
                    var t = this;
                    this.controllers = [];
                    var r = this.getScene().gamepadManager;
                    this._onGamepadDisconnectedObserver = r.onGamepadDisconnectedObservable.add((function(r) {
                        if (r.type === e.Gamepad.POSE_ENABLED) {
                            var i = r;
                            i.defaultModel && i.defaultModel.setEnabled(!1),
                            "right" === i.hand && (t._rightController = null),
                            "left" === i.hand && (t._leftController = null);
                            var n = t.controllers.indexOf(i);
                            -1 !== n && t.controllers.splice(n, 1)
                        }
                    }
                    )),
                    this._onGamepadConnectedObserver = r.onGamepadConnectedObservable.add((function(r) {
                        if (r.type === e.Gamepad.POSE_ENABLED) {
                            var i = r;
                            if (t.webVROptions.trackPosition || (i._disableTrackPosition(new e.Vector3("left" == i.hand ? -.15 : .15,-.5,.25)),
                            t._updateCacheWhenTrackingDisabledObserver || (t._updateCacheWhenTrackingDisabledObserver = t._scene.onBeforeRenderObservable.add((function() {
                                t._updateCache()
                            }
                            )))),
                            i.deviceScaleFactor = t.deviceScaleFactor,
                            i._deviceToWorld.copyFrom(t._deviceToWorld),
                            t._correctPositionIfNotTrackPosition(i._deviceToWorld),
                            t.webVROptions.controllerMeshes && (i.defaultModel ? i.defaultModel.setEnabled(!0) : i.initControllerMesh(t.getScene(), (function(r) {
                                if (r.scaling.scaleInPlace(t.deviceScaleFactor),
                                t.onControllerMeshLoadedObservable.notifyObservers(i),
                                t.webVROptions.defaultLightingOnControllers) {
                                    t._lightOnControllers || (t._lightOnControllers = new e.HemisphericLight("vrControllersLight",new e.Vector3(0,1,0),t.getScene()));
                                    var n = function(e, t) {
                                        var r = e.getChildren();
                                        r && 0 !== r.length && r.forEach((function(e) {
                                            t.includedOnlyMeshes.push(e),
                                            n(e, t)
                                        }
                                        ))
                                    };
                                    t._lightOnControllers.includedOnlyMeshes.push(r),
                                    n(r, t._lightOnControllers)
                                }
                            }
                            ))),
                            i.attachToPoseControlledCamera(t),
                            -1 === t.controllers.indexOf(i)) {
                                t.controllers.push(i);
                                for (var n = !1, o = 0; o < t.controllers.length; o++)
                                    t.controllers[o].controllerType === e.PoseEnabledControllerType.VIVE && (n ? t.controllers[o].hand = "right" : (n = !0,
                                    t.controllers[o].hand = "left"));
                                t.controllers.length >= 2 && t.onControllersAttachedObservable.notifyObservers(t.controllers)
                            }
                        }
                    }
                    ))
                }
                ,
                r
            }(e.FreeCamera);
            e.WebVRFreeCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("DeviceOrientationCamera", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n) {
                    var o = t.call(this, r, i, n) || this;
                    return o._quaternionCache = new e.Quaternion,
                    o.inputs.addDeviceOrientation(),
                    o
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "DeviceOrientationCamera"
                }
                ,
                r.prototype._checkInputs = function() {
                    t.prototype._checkInputs.call(this),
                    this._quaternionCache.copyFrom(this.rotationQuaternion),
                    this._initialQuaternion && this._initialQuaternion.multiplyToRef(this.rotationQuaternion, this.rotationQuaternion)
                }
                ,
                r.prototype.resetToCurrentRotation = function(t) {
                    var r = this;
                    void 0 === t && (t = e.Axis.Y),
                    this.rotationQuaternion && (this._initialQuaternion || (this._initialQuaternion = new e.Quaternion),
                    this._initialQuaternion.copyFrom(this._quaternionCache || this.rotationQuaternion),
                    ["x", "y", "z"].forEach((function(e) {
                        t[e] ? r._initialQuaternion[e] *= -1 : r._initialQuaternion[e] = 0
                    }
                    )),
                    this._initialQuaternion.normalize(),
                    this._initialQuaternion.multiplyToRef(this.rotationQuaternion, this.rotationQuaternion))
                }
                ,
                r
            }(e.FreeCamera);
            e.DeviceOrientationCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("VRDeviceOrientationFreeCamera", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o, a) {
                    void 0 === o && (o = !0),
                    void 0 === a && (a = e.VRCameraMetrics.GetDefault());
                    var s = t.call(this, r, i, n) || this;
                    return a.compensateDistortion = o,
                    s.setCameraRigMode(e.Camera.RIG_MODE_VR, {
                        vrCameraMetrics: a
                    }),
                    s
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "VRDeviceOrientationFreeCamera"
                }
                ,
                r
            }(e.DeviceOrientationCamera);
            e.VRDeviceOrientationFreeCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("VRDeviceOrientationFreeCamera", (function(r, i) {
                return function() {
                    return new t(r,0,0,1,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l) {
                    void 0 === y && (y = !0),
                    void 0 === l && (l = e.VRCameraMetrics.GetDefault());
                    var c = t.call(this, r, i, n, o, a, s) || this;
                    return l.compensateDistortion = y,
                    c.setCameraRigMode(e.Camera.RIG_MODE_VR, {
                        vrCameraMetrics: l
                    }),
                    c.inputs.addVRDeviceOrientation(),
                    c
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "VRDeviceOrientationArcRotateCamera"
                }
                ,
                r
            }(e.ArcRotateCamera);
            e.VRDeviceOrientationArcRotateCamera = t
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("VRDeviceOrientationGamepadCamera", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(t) {
                function r(r, i, n, o, a) {
                    void 0 === o && (o = !0),
                    void 0 === a && (a = e.VRCameraMetrics.GetDefault());
                    var s = t.call(this, r, i, n, o, a) || this;
                    return s.inputs.addGamepad(),
                    s
                }
                return o(r, t),
                r.prototype.getClassName = function() {
                    return "VRDeviceOrientationGamepadCamera"
                }
                ,
                r
            }(e.VRDeviceOrientationFreeCamera);
            e.VRDeviceOrientationGamepadCamera = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(r, i) {
                    if (void 0 === i && (i = null),
                    this.scene = r,
                    this._pointerDownOnMeshAsked = !1,
                    this._isActionableMesh = !1,
                    this._teleportationRequestInitiated = !1,
                    this._teleportationBackRequestInitiated = !1,
                    this._rotationRightAsked = !1,
                    this._rotationLeftAsked = !1,
                    this._dpadPressed = !0,
                    this._activePointer = !1,
                    this._id = t._idCounter++,
                    i)
                        this._gazeTracker = i.clone("gazeTracker");
                    else {
                        this._gazeTracker = e.Mesh.CreateTorus("gazeTracker", .0035, .0025, 20, r, !1),
                        this._gazeTracker.bakeCurrentTransformIntoVertices(),
                        this._gazeTracker.isPickable = !1,
                        this._gazeTracker.isVisible = !1;
                        var n = new e.StandardMaterial("targetMat",r);
                        n.specularColor = e.Color3.Black(),
                        n.emissiveColor = new e.Color3(.7,.7,.7),
                        n.backFaceCulling = !1,
                        this._gazeTracker.material = n
                    }
                }
                return t.prototype._getForwardRay = function(t) {
                    return new e.Ray(e.Vector3.Zero(),new e.Vector3(0,0,t))
                }
                ,
                t.prototype._selectionPointerDown = function() {
                    this._pointerDownOnMeshAsked = !0,
                    this._currentHit && this.scene.simulatePointerDown(this._currentHit, {
                        pointerId: this._id
                    })
                }
                ,
                t.prototype._selectionPointerUp = function() {
                    this._currentHit && this.scene.simulatePointerUp(this._currentHit, {
                        pointerId: this._id
                    }),
                    this._pointerDownOnMeshAsked = !1
                }
                ,
                t.prototype._activatePointer = function() {
                    this._activePointer = !0
                }
                ,
                t.prototype._deactivatePointer = function() {
                    this._activePointer = !1
                }
                ,
                t.prototype._updatePointerDistance = function(e) {
                    void 0 === e && (e = 100)
                }
                ,
                t.prototype.dispose = function() {
                    this._interactionsEnabled = !1,
                    this._teleportationEnabled = !1,
                    this._gazeTracker && this._gazeTracker.dispose()
                }
                ,
                t._idCounter = 0,
                t
            }()
              , r = function(t) {
                function r(r, i, n) {
                    var o = t.call(this, i, n) || this;
                    o.webVRController = r,
                    o._laserPointer = e.Mesh.CreateCylinder("laserPointer", 1, .004, 2e-4, 20, 1, i, !1);
                    var a = new e.StandardMaterial("laserPointerMat",i);
                    if (a.emissiveColor = new e.Color3(.7,.7,.7),
                    a.alpha = .6,
                    o._laserPointer.material = a,
                    o._laserPointer.rotation.x = Math.PI / 2,
                    o._laserPointer.position.z = -.5,
                    o._laserPointer.isVisible = !1,
                    o._laserPointer.isPickable = !1,
                    !r.mesh) {
                        var s = new e.Mesh("preloadControllerMesh",i)
                          , y = new e.Mesh(e.PoseEnabledController.POINTING_POSE,i);
                        y.rotation.x = -.7,
                        s.addChild(y),
                        r.attachToMesh(s)
                    }
                    return o._setLaserPointerParent(r.mesh),
                    o._meshAttachedObserver = r._meshAttachedObservable.add((function(e) {
                        o._setLaserPointerParent(e)
                    }
                    )),
                    o
                }
                return o(r, t),
                r.prototype._getForwardRay = function(e) {
                    return this.webVRController.getForwardRay(e)
                }
                ,
                r.prototype._activatePointer = function() {
                    t.prototype._activatePointer.call(this),
                    this._laserPointer.isVisible = !0
                }
                ,
                r.prototype._deactivatePointer = function() {
                    t.prototype._deactivatePointer.call(this),
                    this._laserPointer.isVisible = !1
                }
                ,
                r.prototype._setLaserPointerColor = function(e) {
                    this._laserPointer.material.emissiveColor = e
                }
                ,
                r.prototype._setLaserPointerParent = function(t) {
                    var r = function(e) {
                        e.isPickable = !1,
                        e.getChildMeshes().forEach((function(e) {
                            r(e)
                        }
                        ))
                    };
                    r(t);
                    var i = t.getChildMeshes();
                    this.webVRController._pointingPoseNode = null;
                    for (var n = 0; n < i.length; n++)
                        if (i[n].name && i[n].name.indexOf(e.PoseEnabledController.POINTING_POSE) >= 0) {
                            t = i[n],
                            this.webVRController._pointingPoseNode = t;
                            break
                        }
                    this._laserPointer.parent = t
                }
                ,
                r.prototype._updatePointerDistance = function(e) {
                    void 0 === e && (e = 100),
                    this._laserPointer.scaling.y = e,
                    this._laserPointer.position.z = -e / 2
                }
                ,
                r.prototype.dispose = function() {
                    t.prototype.dispose.call(this),
                    this._laserPointer.dispose(),
                    this._meshAttachedObserver && this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)
                }
                ,
                r
            }(t)
              , i = function(t) {
                function r(e, r) {
                    var i = t.call(this, r) || this;
                    return i.getCamera = e,
                    i
                }
                return o(r, t),
                r.prototype._getForwardRay = function(t) {
                    var r = this.getCamera();
                    return r ? r.getForwardRay(t) : new e.Ray(e.Vector3.Zero(),e.Vector3.Forward())
                }
                ,
                r
            }(t)
              , n = function() {
                function t(t, n) {
                    void 0 === n && (n = {});
                    var o = this;
                    if (this.webVROptions = n,
                    this._webVRsupported = !1,
                    this._webVRready = !1,
                    this._webVRrequesting = !1,
                    this._webVRpresenting = !1,
                    this._fullscreenVRpresenting = !1,
                    this.onEnteringVRObservable = new e.Observable,
                    this.onExitingVRObservable = new e.Observable,
                    this.onControllerMeshLoadedObservable = new e.Observable,
                    this._useCustomVRButton = !1,
                    this._teleportationRequested = !1,
                    this._teleportActive = !1,
                    this._floorMeshesCollection = [],
                    this._rotationAllowed = !0,
                    this._teleportBackwardsVector = new e.Vector3(0,-1,-1),
                    this._isDefaultTeleportationTarget = !0,
                    this._teleportationFillColor = "#444444",
                    this._teleportationBorderColor = "#FFFFFF",
                    this._rotationAngle = 0,
                    this._haloCenter = new e.Vector3(0,0,0),
                    this._padSensibilityUp = .65,
                    this._padSensibilityDown = .35,
                    this._leftController = null,
                    this._rightController = null,
                    this.onNewMeshSelected = new e.Observable,
                    this.onNewMeshPicked = new e.Observable,
                    this.onBeforeCameraTeleport = new e.Observable,
                    this.onAfterCameraTeleport = new e.Observable,
                    this.onSelectedMeshUnselected = new e.Observable,
                    this.teleportationEnabled = !0,
                    this._teleportationInitialized = !1,
                    this._interactionsEnabled = !1,
                    this._interactionsRequested = !1,
                    this._displayGaze = !0,
                    this._displayLaserPointer = !0,
                    this.updateGazeTrackerScale = !0,
                    this._onResize = function() {
                        o.moveButtonToBottomRight(),
                        o._fullscreenVRpresenting && o._webVRready && o.exitVR()
                    }
                    ,
                    this._onFullscreenChange = function() {
                        void 0 !== document.fullscreen ? o._fullscreenVRpresenting = document.fullscreen : void 0 !== document.mozFullScreen ? o._fullscreenVRpresenting = document.mozFullScreen : void 0 !== document.webkitIsFullScreen ? o._fullscreenVRpresenting = document.webkitIsFullScreen : void 0 !== document.msIsFullScreen ? o._fullscreenVRpresenting = document.msIsFullScreen : void 0 !== document.msFullscreenElement && (o._fullscreenVRpresenting = document.msFullscreenElement),
                        !o._fullscreenVRpresenting && o._canvas && (o.exitVR(),
                        o._useCustomVRButton || (o._btnVR.style.top = o._canvas.offsetTop + o._canvas.offsetHeight - 70 + "px",
                        o._btnVR.style.left = o._canvas.offsetLeft + o._canvas.offsetWidth - 100 + "px"))
                    }
                    ,
                    this.beforeRender = function() {
                        o._leftController && o._leftController._activePointer && o._castRayAndSelectObject(o._leftController),
                        o._rightController && o._rightController._activePointer && o._castRayAndSelectObject(o._rightController),
                        o._noControllerIsActive ? o._castRayAndSelectObject(o._cameraGazer) : o._cameraGazer._gazeTracker.isVisible = !1
                    }
                    ,
                    this._onNewGamepadConnected = function(t) {
                        if (t.type !== e.Gamepad.POSE_ENABLED)
                            t.leftStick && t.onleftstickchanged((function(e) {
                                o._teleportationInitialized && o.teleportationEnabled && (!o._leftController && !o._rightController || o._leftController && !o._leftController._activePointer && o._rightController && !o._rightController._activePointer) && (o._checkTeleportWithRay(e, o._cameraGazer),
                                o._checkTeleportBackwards(e, o._cameraGazer))
                            }
                            )),
                            t.rightStick && t.onrightstickchanged((function(e) {
                                o._teleportationInitialized && o._checkRotate(e, o._cameraGazer)
                            }
                            )),
                            t.type === e.Gamepad.XBOX && (t.onbuttondown((function(t) {
                                o._interactionsEnabled && t === e.Xbox360Button.A && o._cameraGazer._selectionPointerDown()
                            }
                            )),
                            t.onbuttonup((function(t) {
                                o._interactionsEnabled && t === e.Xbox360Button.A && o._cameraGazer._selectionPointerUp()
                            }
                            )));
                        else {
                            var i = t
                              , n = new r(i,o._scene,o._cameraGazer._gazeTracker);
                            "right" === i.hand || o._leftController && o._leftController.webVRController != i ? o._rightController = n : o._leftController = n,
                            o._tryEnableInteractionOnController(n)
                        }
                    }
                    ,
                    this._tryEnableInteractionOnController = function(e) {
                        o._interactionsRequested && !e._interactionsEnabled && o._enableInteractionOnController(e),
                        o._teleportationRequested && !e._teleportationEnabled && o._enableTeleportationOnController(e)
                    }
                    ,
                    this._onNewGamepadDisconnected = function(t) {
                        t instanceof e.WebVRController && ("left" === t.hand && null != o._leftController && (o._leftController.dispose(),
                        o._leftController = null),
                        "right" === t.hand && null != o._rightController && (o._rightController.dispose(),
                        o._rightController = null))
                    }
                    ,
                    this._workingVector = e.Vector3.Zero(),
                    this._workingQuaternion = e.Quaternion.Identity(),
                    this._workingMatrix = e.Matrix.Identity(),
                    this._scene = t,
                    this._canvas = t.getEngine().getRenderingCanvas(),
                    void 0 === n.createFallbackVRDeviceOrientationFreeCamera && (n.createFallbackVRDeviceOrientationFreeCamera = !0),
                    void 0 === n.createDeviceOrientationCamera && (n.createDeviceOrientationCamera = !0),
                    void 0 === n.laserToggle && (n.laserToggle = !0),
                    void 0 === n.defaultHeight && (n.defaultHeight = 1.7),
                    n.useCustomVRButton && (this._useCustomVRButton = !0,
                    n.customVRButton && (this._btnVR = n.customVRButton)),
                    n.rayLength && (this._rayLength = n.rayLength),
                    this._defaultHeight = n.defaultHeight,
                    n.positionScale && (this._rayLength *= n.positionScale,
                    this._defaultHeight *= n.positionScale),
                    this._hasEnteredVR = !1,
                    this._scene.activeCamera ? this._position = this._scene.activeCamera.position.clone() : this._position = new e.Vector3(0,this._defaultHeight,0),
                    n.createDeviceOrientationCamera || !this._scene.activeCamera) {
                        if (this._deviceOrientationCamera = new e.DeviceOrientationCamera("deviceOrientationVRHelper",this._position.clone(),t),
                        this._scene.activeCamera && (this._deviceOrientationCamera.minZ = this._scene.activeCamera.minZ,
                        this._deviceOrientationCamera.maxZ = this._scene.activeCamera.maxZ,
                        this._scene.activeCamera instanceof e.TargetCamera && this._scene.activeCamera.rotation)) {
                            var a = this._scene.activeCamera;
                            a.rotationQuaternion ? this._deviceOrientationCamera.rotationQuaternion.copyFrom(a.rotationQuaternion) : this._deviceOrientationCamera.rotationQuaternion.copyFrom(e.Quaternion.RotationYawPitchRoll(a.rotation.y, a.rotation.x, a.rotation.z)),
                            this._deviceOrientationCamera.rotation = a.rotation.clone()
                        }
                        this._scene.activeCamera = this._deviceOrientationCamera,
                        this._canvas && this._scene.activeCamera.attachControl(this._canvas)
                    } else
                        this._existingCamera = this._scene.activeCamera;
                    if (n.createFallbackVRDeviceOrientationFreeCamera && (this._vrDeviceOrientationCamera = new e.VRDeviceOrientationFreeCamera("VRDeviceOrientationVRHelper",this._position,this._scene)),
                    this._webVRCamera = new e.WebVRFreeCamera("WebVRHelper",this._position,this._scene,n),
                    this._webVRCamera.useStandingMatrix(),
                    this._cameraGazer = new i((function() {
                        return o.currentVRCamera
                    }
                    ),t),
                    !this._useCustomVRButton) {
                        this._btnVR = document.createElement("BUTTON"),
                        this._btnVR.className = "babylonVRicon",
                        this._btnVR.id = "babylonVRiconbtn",
                        this._btnVR.title = "Click to switch to VR";
                        ".babylonVRicon.vrdisplaypresenting { display: none; }";
                        var s = document.createElement("style");
                        s.appendChild(document.createTextNode(".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }.babylonVRicon.vrdisplaypresenting { display: none; }")),
                        document.getElementsByTagName("head")[0].appendChild(s),
                        this.moveButtonToBottomRight()
                    }
                    this._btnVR && this._btnVR.addEventListener("click", (function() {
                        o.isInVRMode ? o.exitVR() : o.enterVR()
                    }
                    )),
                    window.addEventListener("resize", this._onResize),
                    document.addEventListener("fullscreenchange", this._onFullscreenChange, !1),
                    document.addEventListener("mozfullscreenchange", this._onFullscreenChange, !1),
                    document.addEventListener("webkitfullscreenchange", this._onFullscreenChange, !1),
                    document.addEventListener("msfullscreenchange", this._onFullscreenChange, !1),
                    document.onmsfullscreenchange = this._onFullscreenChange,
                    n.createFallbackVRDeviceOrientationFreeCamera ? this.displayVRButton() : this._scene.getEngine().onVRDisplayChangedObservable.add((function(e) {
                        e.vrDisplay && o.displayVRButton()
                    }
                    )),
                    this._onKeyDown = function(e) {
                        27 === e.keyCode && o.isInVRMode && o.exitVR()
                    }
                    ,
                    document.addEventListener("keydown", this._onKeyDown),
                    this._scene.onPrePointerObservable.add((function(e, t) {
                        o.isInVRMode && (o.exitVR(),
                        o._fullscreenVRpresenting && o._scene.getEngine().switchFullscreen(!0))
                    }
                    ), e.PointerEventTypes.POINTERDOUBLETAP, !1),
                    this._onVRDisplayChanged = function(e) {
                        return o.onVRDisplayChanged(e)
                    }
                    ,
                    this._onVrDisplayPresentChange = function() {
                        return o.onVrDisplayPresentChange()
                    }
                    ,
                    this._onVRRequestPresentStart = function() {
                        o._webVRrequesting = !0,
                        o.updateButtonVisibility()
                    }
                    ,
                    this._onVRRequestPresentComplete = function(e) {
                        o._webVRrequesting = !1,
                        o.updateButtonVisibility()
                    }
                    ,
                    t.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),
                    t.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),
                    t.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),
                    window.addEventListener("vrdisplaypresentchange", this._onVrDisplayPresentChange),
                    t.onDisposeObservable.add((function() {
                        o.dispose()
                    }
                    )),
                    this._webVRCamera.onControllerMeshLoadedObservable.add((function(e) {
                        return o._onDefaultMeshLoaded(e)
                    }
                    )),
                    this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),
                    this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),
                    this.updateButtonVisibility(),
                    this._circleEase = new e.CircleEase,
                    this._circleEase.setEasingMode(e.EasingFunction.EASINGMODE_EASEINOUT),
                    this.webVROptions.floorMeshes && this.enableTeleportation({
                        floorMeshes: this.webVROptions.floorMeshes
                    })
                }
                return Object.defineProperty(t.prototype, "onEnteringVR", {
                    get: function() {
                        return this.onEnteringVRObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onExitingVR", {
                    get: function() {
                        return this.onExitingVRObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onControllerMeshLoaded", {
                    get: function() {
                        return this.onControllerMeshLoadedObservable
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "teleportationTarget", {
                    get: function() {
                        return this._teleportationTarget
                    },
                    set: function(e) {
                        e && (e.name = "teleportationTarget",
                        this._isDefaultTeleportationTarget = !1,
                        this._teleportationTarget = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "gazeTrackerMesh", {
                    get: function() {
                        return this._cameraGazer._gazeTracker
                    },
                    set: function(e) {
                        e && (this._cameraGazer._gazeTracker && this._cameraGazer._gazeTracker.dispose(),
                        this._leftController && this._leftController._gazeTracker && this._leftController._gazeTracker.dispose(),
                        this._rightController && this._rightController._gazeTracker && this._rightController._gazeTracker.dispose(),
                        this._cameraGazer._gazeTracker = e,
                        this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),
                        this._cameraGazer._gazeTracker.isPickable = !1,
                        this._cameraGazer._gazeTracker.isVisible = !1,
                        this._cameraGazer._gazeTracker.name = "gazeTracker",
                        this._leftController && (this._leftController._gazeTracker = this._cameraGazer._gazeTracker.clone("gazeTracker")),
                        this._rightController && (this._rightController._gazeTracker = this._cameraGazer._gazeTracker.clone("gazeTracker")))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "leftControllerGazeTrackerMesh", {
                    get: function() {
                        return this._leftController ? this._leftController._gazeTracker : null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "rightControllerGazeTrackerMesh", {
                    get: function() {
                        return this._rightController ? this._rightController._gazeTracker : null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "displayGaze", {
                    get: function() {
                        return this._displayGaze
                    },
                    set: function(e) {
                        this._displayGaze = e,
                        e || (this._cameraGazer._gazeTracker.isVisible = !1,
                        this._leftController && (this._leftController._gazeTracker.isVisible = !1),
                        this._rightController && (this._rightController._gazeTracker.isVisible = !1))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "displayLaserPointer", {
                    get: function() {
                        return this._displayLaserPointer
                    },
                    set: function(e) {
                        this._displayLaserPointer = e,
                        e ? (this._rightController && this._rightController._activatePointer(),
                        this._leftController && this._leftController._activatePointer()) : (this._rightController && (this._rightController._deactivatePointer(),
                        this._rightController._gazeTracker.isVisible = !1),
                        this._leftController && (this._leftController._deactivatePointer(),
                        this._leftController._gazeTracker.isVisible = !1))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "deviceOrientationCamera", {
                    get: function() {
                        return this._deviceOrientationCamera
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "currentVRCamera", {
                    get: function() {
                        return this._webVRready ? this._webVRCamera : this._scene.activeCamera
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "webVRCamera", {
                    get: function() {
                        return this._webVRCamera
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "vrDeviceOrientationCamera", {
                    get: function() {
                        return this._vrDeviceOrientationCamera
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "_teleportationRequestInitiated", {
                    get: function() {
                        return this._cameraGazer._teleportationRequestInitiated || null !== this._leftController && this._leftController._teleportationRequestInitiated || null !== this._rightController && this._rightController._teleportationRequestInitiated
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._onDefaultMeshLoaded = function(t) {
                    this._leftController && this._leftController.webVRController == t && t.mesh && this._leftController._setLaserPointerParent(t.mesh),
                    this._rightController && this._rightController.webVRController == t && t.mesh && this._rightController._setLaserPointerParent(t.mesh);
                    try {
                        this.onControllerMeshLoadedObservable.notifyObservers(t)
                    } catch (t) {
                        e.Tools.Warn("Error in your custom logic onControllerMeshLoaded: " + t)
                    }
                }
                ,
                Object.defineProperty(t.prototype, "isInVRMode", {
                    get: function() {
                        return this._webVRpresenting || this._fullscreenVRpresenting
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.onVrDisplayPresentChange = function() {
                    var t = this._scene.getEngine().getVRDevice();
                    if (t) {
                        var r = this._webVRpresenting;
                        this._webVRpresenting = t.isPresenting,
                        r && !this._webVRpresenting && this.exitVR()
                    } else
                        e.Tools.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");
                    this.updateButtonVisibility()
                }
                ,
                t.prototype.onVRDisplayChanged = function(e) {
                    this._webVRsupported = e.vrSupported,
                    this._webVRready = !!e.vrDisplay,
                    this._webVRpresenting = e.vrDisplay && e.vrDisplay.isPresenting,
                    this.updateButtonVisibility()
                }
                ,
                t.prototype.moveButtonToBottomRight = function() {
                    this._canvas && !this._useCustomVRButton && (this._btnVR.style.top = this._canvas.offsetTop + this._canvas.offsetHeight - 70 + "px",
                    this._btnVR.style.left = this._canvas.offsetLeft + this._canvas.offsetWidth - 100 + "px")
                }
                ,
                t.prototype.displayVRButton = function() {
                    this._useCustomVRButton || this._btnVRDisplayed || (document.body.appendChild(this._btnVR),
                    this._btnVRDisplayed = !0)
                }
                ,
                t.prototype.updateButtonVisibility = function() {
                    this._btnVR && !this._useCustomVRButton && (this._btnVR.className = "babylonVRicon",
                    this.isInVRMode ? this._btnVR.className += " vrdisplaypresenting" : (this._webVRready && (this._btnVR.className += " vrdisplayready"),
                    this._webVRsupported && (this._btnVR.className += " vrdisplaysupported"),
                    this._webVRrequesting && (this._btnVR.className += " vrdisplayrequesting")))
                }
                ,
                t.prototype.enterVR = function() {
                    if (this.onEnteringVRObservable)
                        try {
                            this.onEnteringVRObservable.notifyObservers(this)
                        } catch (t) {
                            e.Tools.Warn("Error in your custom logic onEnteringVR: " + t)
                        }
                    this._scene.activeCamera && (this._position = this._scene.activeCamera.position.clone(),
                    this._existingCamera = this._scene.activeCamera),
                    this._webVRrequesting || (this._webVRready ? this._webVRpresenting || (this._webVRCamera.position = this._position,
                    this._scene.activeCamera = this._webVRCamera) : this._vrDeviceOrientationCamera && (this._vrDeviceOrientationCamera.position = this._position,
                    this._scene.activeCamera && (this._vrDeviceOrientationCamera.minZ = this._scene.activeCamera.minZ),
                    this._scene.activeCamera = this._vrDeviceOrientationCamera,
                    this._scene.getEngine().switchFullscreen(!0),
                    this.updateButtonVisibility()),
                    this._scene.activeCamera && this._canvas && this._scene.activeCamera.attachControl(this._canvas),
                    this._interactionsEnabled && this._scene.registerBeforeRender(this.beforeRender),
                    this._hasEnteredVR = !0)
                }
                ,
                t.prototype.exitVR = function() {
                    if (this._hasEnteredVR) {
                        if (this.onExitingVRObservable)
                            try {
                                this.onExitingVRObservable.notifyObservers(this)
                            } catch (t) {
                                e.Tools.Warn("Error in your custom logic onExitingVR: " + t)
                            }
                        this._webVRpresenting && this._scene.getEngine().disableVR(),
                        this._scene.activeCamera && (this._position = this._scene.activeCamera.position.clone()),
                        this._deviceOrientationCamera ? (this._deviceOrientationCamera.position = this._position,
                        this._scene.activeCamera = this._deviceOrientationCamera,
                        this._canvas && this._scene.activeCamera.attachControl(this._canvas)) : this._existingCamera && (this._existingCamera.position = this._position,
                        this._scene.activeCamera = this._existingCamera),
                        this.updateButtonVisibility(),
                        this._interactionsEnabled && (this._scene.unregisterBeforeRender(this.beforeRender),
                        this._cameraGazer._gazeTracker.isVisible = !1,
                        this._leftController && (this._leftController._gazeTracker.isVisible = !1),
                        this._rightController && (this._rightController._gazeTracker.isVisible = !1)),
                        this._scene.getEngine().resize(),
                        this._hasEnteredVR = !1
                    }
                }
                ,
                Object.defineProperty(t.prototype, "position", {
                    get: function() {
                        return this._position
                    },
                    set: function(e) {
                        this._position = e,
                        this._scene.activeCamera && (this._scene.activeCamera.position = e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.enableInteractions = function() {
                    var e = this;
                    this._interactionsEnabled || (this._interactionsRequested = !0,
                    this._leftController && this._enableInteractionOnController(this._leftController),
                    this._rightController && this._enableInteractionOnController(this._rightController),
                    this.raySelectionPredicate = function(t) {
                        return t.isVisible && (t.isPickable || t.name === e._floorMeshName)
                    }
                    ,
                    this.meshSelectionPredicate = function(e) {
                        return !0
                    }
                    ,
                    this._raySelectionPredicate = function(t) {
                        return !!(e._isTeleportationFloor(t) || -1 === t.name.indexOf("gazeTracker") && -1 === t.name.indexOf("teleportationTarget") && -1 === t.name.indexOf("torusTeleportation")) && e.raySelectionPredicate(t)
                    }
                    ,
                    this._interactionsEnabled = !0)
                }
                ,
                Object.defineProperty(t.prototype, "_noControllerIsActive", {
                    get: function() {
                        return !(this._leftController && this._leftController._activePointer || this._rightController && this._rightController._activePointer)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._isTeleportationFloor = function(e) {
                    for (var t = 0; t < this._floorMeshesCollection.length; t++)
                        if (this._floorMeshesCollection[t].id === e.id)
                            return !0;
                    return !(!this._floorMeshName || e.name !== this._floorMeshName)
                }
                ,
                t.prototype.addFloorMesh = function(e) {
                    this._floorMeshesCollection && (this._floorMeshesCollection.indexOf(e) > -1 || this._floorMeshesCollection.push(e))
                }
                ,
                t.prototype.removeFloorMesh = function(e) {
                    if (this._floorMeshesCollection) {
                        var t = this._floorMeshesCollection.indexOf(e);
                        -1 !== t && this._floorMeshesCollection.splice(t, 1)
                    }
                }
                ,
                t.prototype.enableTeleportation = function(t) {
                    if (void 0 === t && (t = {}),
                    !this._teleportationInitialized) {
                        this._teleportationRequested = !0,
                        this.enableInteractions(),
                        t.floorMeshName && (this._floorMeshName = t.floorMeshName),
                        t.floorMeshes && (this._floorMeshesCollection = t.floorMeshes),
                        null != this._leftController && this._enableTeleportationOnController(this._leftController),
                        null != this._rightController && this._enableTeleportationOnController(this._rightController);
                        var r = new e.ImageProcessingConfiguration;
                        r.vignetteColor = new e.Color4(0,0,0,0),
                        r.vignetteEnabled = !0,
                        this._postProcessMove = new e.ImageProcessingPostProcess("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,r),
                        this._webVRCamera.detachPostProcess(this._postProcessMove),
                        this._teleportationInitialized = !0,
                        this._isDefaultTeleportationTarget && (this._createTeleportationCircles(),
                        this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))
                    }
                }
                ,
                t.prototype._enableInteractionOnController = function(e) {
                    var t = this;
                    e.webVRController.mesh && (e._interactionsEnabled = !0,
                    e._activatePointer(),
                    this.webVROptions.laserToggle && e.webVRController.onMainButtonStateChangedObservable.add((function(r) {
                        t._displayLaserPointer && 1 === r.value && (e._activePointer ? e._deactivatePointer() : e._activatePointer(),
                        t.displayGaze && (e._gazeTracker.isVisible = e._activePointer))
                    }
                    )),
                    e.webVRController.onTriggerStateChangedObservable.add((function(r) {
                        var i = e;
                        t._noControllerIsActive && (i = t._cameraGazer),
                        i._pointerDownOnMeshAsked ? r.value < t._padSensibilityDown && i._selectionPointerUp() : r.value > t._padSensibilityUp && i._selectionPointerDown()
                    }
                    )))
                }
                ,
                t.prototype._checkTeleportWithRay = function(e, t) {
                    this._teleportationRequestInitiated && !t._teleportationRequestInitiated || (t._teleportationRequestInitiated ? Math.sqrt(e.y * e.y + e.x * e.x) < this._padSensibilityDown && (this._teleportActive && this.teleportCamera(this._haloCenter),
                    t._teleportationRequestInitiated = !1) : e.y < -this._padSensibilityUp && t._dpadPressed && (t._activatePointer(),
                    t._teleportationRequestInitiated = !0))
                }
                ,
                t.prototype._checkRotate = function(e, t) {
                    t._teleportationRequestInitiated || (t._rotationLeftAsked ? e.x > -this._padSensibilityDown && (t._rotationLeftAsked = !1) : e.x < -this._padSensibilityUp && t._dpadPressed && (t._rotationLeftAsked = !0,
                    this._rotationAllowed && this._rotateCamera(!1)),
                    t._rotationRightAsked ? e.x < this._padSensibilityDown && (t._rotationRightAsked = !1) : e.x > this._padSensibilityUp && t._dpadPressed && (t._rotationRightAsked = !0,
                    this._rotationAllowed && this._rotateCamera(!0)))
                }
                ,
                t.prototype._checkTeleportBackwards = function(t, r) {
                    if (!r._teleportationRequestInitiated)
                        if (t.y > this._padSensibilityUp && r._dpadPressed) {
                            if (!r._teleportationBackRequestInitiated) {
                                if (!this.currentVRCamera)
                                    return;
                                var i = e.Quaternion.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix())
                                  , n = this.currentVRCamera.position;
                                this.currentVRCamera.devicePosition && this.currentVRCamera.deviceRotationQuaternion && (i = this.currentVRCamera.deviceRotationQuaternion,
                                n = this.currentVRCamera.devicePosition),
                                i.toEulerAnglesToRef(this._workingVector),
                                this._workingVector.z = 0,
                                this._workingVector.x = 0,
                                e.Quaternion.RotationYawPitchRollToRef(this._workingVector.y, this._workingVector.x, this._workingVector.z, this._workingQuaternion),
                                this._workingQuaternion.toRotationMatrix(this._workingMatrix),
                                e.Vector3.TransformCoordinatesToRef(this._teleportBackwardsVector, this._workingMatrix, this._workingVector);
                                var o = new e.Ray(n,this._workingVector)
                                  , a = this._scene.pickWithRay(o, this._raySelectionPredicate);
                                a && a.pickedPoint && a.pickedMesh && this._isTeleportationFloor(a.pickedMesh) && a.distance < 5 && this.teleportCamera(a.pickedPoint),
                                r._teleportationBackRequestInitiated = !0
                            }
                        } else
                            r._teleportationBackRequestInitiated = !1
                }
                ,
                t.prototype._enableTeleportationOnController = function(t) {
                    var r = this;
                    t.webVRController.mesh && (t._interactionsEnabled || this._enableInteractionOnController(t),
                    t._interactionsEnabled = !0,
                    t._teleportationEnabled = !0,
                    t.webVRController.controllerType === e.PoseEnabledControllerType.VIVE && (t._dpadPressed = !1,
                    t.webVRController.onPadStateChangedObservable.add((function(e) {
                        t._dpadPressed = e.pressed,
                        t._dpadPressed || (t._rotationLeftAsked = !1,
                        t._rotationRightAsked = !1,
                        t._teleportationBackRequestInitiated = !1)
                    }
                    ))),
                    t.webVRController.onPadValuesChangedObservable.add((function(e) {
                        r.teleportationEnabled && (r._checkTeleportBackwards(e, t),
                        r._checkTeleportWithRay(e, t)),
                        r._checkRotate(e, t)
                    }
                    )))
                }
                ,
                t.prototype._createTeleportationCircles = function() {
                    this._teleportationTarget = e.Mesh.CreateGround("teleportationTarget", 2, 2, 2, this._scene),
                    this._teleportationTarget.isPickable = !1;
                    var t = new e.DynamicTexture("DynamicTexture",512,this._scene,!0);
                    t.hasAlpha = !0;
                    var r = t.getContext();
                    r.beginPath(),
                    r.arc(256, 256, 200, 0, 2 * Math.PI, !1),
                    r.fillStyle = this._teleportationFillColor,
                    r.fill(),
                    r.lineWidth = 10,
                    r.strokeStyle = this._teleportationBorderColor,
                    r.stroke(),
                    r.closePath(),
                    t.update();
                    var i = new e.StandardMaterial("TextPlaneMaterial",this._scene);
                    i.diffuseTexture = t,
                    this._teleportationTarget.material = i;
                    var n = e.Mesh.CreateTorus("torusTeleportation", .75, .1, 25, this._scene, !1);
                    n.isPickable = !1,
                    n.parent = this._teleportationTarget;
                    var o = new e.Animation("animationInnerCircle","position.y",30,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CYCLE)
                      , a = [];
                    a.push({
                        frame: 0,
                        value: 0
                    }),
                    a.push({
                        frame: 30,
                        value: .4
                    }),
                    a.push({
                        frame: 60,
                        value: 0
                    }),
                    o.setKeys(a);
                    var s = new e.SineEase;
                    s.setEasingMode(e.EasingFunction.EASINGMODE_EASEINOUT),
                    o.setEasingFunction(s),
                    n.animations = [],
                    n.animations.push(o),
                    this._scene.beginAnimation(n, 0, 60, !0),
                    this._hideTeleportationTarget()
                }
                ,
                t.prototype._displayTeleportationTarget = function() {
                    this._teleportActive = !0,
                    this._teleportationInitialized && (this._teleportationTarget.isVisible = !0,
                    this._isDefaultTeleportationTarget && (this._teleportationTarget.getChildren()[0].isVisible = !0))
                }
                ,
                t.prototype._hideTeleportationTarget = function() {
                    this._teleportActive = !1,
                    this._teleportationInitialized && (this._teleportationTarget.isVisible = !1,
                    this._isDefaultTeleportationTarget && (this._teleportationTarget.getChildren()[0].isVisible = !1))
                }
                ,
                t.prototype._rotateCamera = function(t) {
                    var r = this;
                    if (this.currentVRCamera instanceof e.FreeCamera) {
                        t ? this._rotationAngle++ : this._rotationAngle--,
                        this.currentVRCamera.animations = [];
                        var i = e.Quaternion.FromRotationMatrix(e.Matrix.RotationY(Math.PI / 4 * this._rotationAngle))
                          , n = new e.Animation("animationRotation","rotationQuaternion",90,e.Animation.ANIMATIONTYPE_QUATERNION,e.Animation.ANIMATIONLOOPMODE_CONSTANT)
                          , o = [];
                        o.push({
                            frame: 0,
                            value: this.currentVRCamera.rotationQuaternion
                        }),
                        o.push({
                            frame: 6,
                            value: i
                        }),
                        n.setKeys(o),
                        n.setEasingFunction(this._circleEase),
                        this.currentVRCamera.animations.push(n),
                        this._postProcessMove.animations = [];
                        var a = new e.Animation("animationPP","vignetteWeight",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT)
                          , s = [];
                        s.push({
                            frame: 0,
                            value: 0
                        }),
                        s.push({
                            frame: 3,
                            value: 4
                        }),
                        s.push({
                            frame: 6,
                            value: 0
                        }),
                        a.setKeys(s),
                        a.setEasingFunction(this._circleEase),
                        this._postProcessMove.animations.push(a);
                        var y = new e.Animation("animationPP2","vignetteStretch",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT)
                          , l = [];
                        l.push({
                            frame: 0,
                            value: 0
                        }),
                        l.push({
                            frame: 3,
                            value: 10
                        }),
                        l.push({
                            frame: 6,
                            value: 0
                        }),
                        y.setKeys(l),
                        y.setEasingFunction(this._circleEase),
                        this._postProcessMove.animations.push(y),
                        this._postProcessMove.imageProcessingConfiguration.vignetteWeight = 0,
                        this._postProcessMove.imageProcessingConfiguration.vignetteStretch = 0,
                        this._postProcessMove.samples = 4,
                        this._webVRCamera.attachPostProcess(this._postProcessMove),
                        this._scene.beginAnimation(this._postProcessMove, 0, 6, !1, 1, (function() {
                            r._webVRCamera.detachPostProcess(r._postProcessMove)
                        }
                        )),
                        this._scene.beginAnimation(this.currentVRCamera, 0, 6, !1, 1)
                    }
                }
                ,
                t.prototype._moveTeleportationSelectorTo = function(t, r, i) {
                    if (t.pickedPoint) {
                        r._teleportationRequestInitiated && (this._displayTeleportationTarget(),
                        this._haloCenter.copyFrom(t.pickedPoint),
                        this._teleportationTarget.position.copyFrom(t.pickedPoint));
                        var n = this._convertNormalToDirectionOfRay(t.getNormal(!0, !1), i);
                        if (n) {
                            var o = e.Vector3.Cross(e.Axis.Y, n)
                              , a = e.Vector3.Cross(n, o);
                            e.Vector3.RotationFromAxisToRef(a, n, o, this._teleportationTarget.rotation)
                        }
                        this._teleportationTarget.position.y += .1
                    }
                }
                ,
                t.prototype.teleportCamera = function(t) {
                    var r = this;
                    if (this.currentVRCamera instanceof e.FreeCamera) {
                        this.webVRCamera.leftCamera ? (this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),
                        this._workingVector.subtractInPlace(this.webVRCamera.position),
                        t.subtractToRef(this._workingVector, this._workingVector)) : this._workingVector.copyFrom(t),
                        this.isInVRMode ? this._workingVector.y += this.webVRCamera.deviceDistanceToRoomGround() * this._webVRCamera.deviceScaleFactor : this._workingVector.y += this._defaultHeight,
                        this.onBeforeCameraTeleport.notifyObservers(this._workingVector),
                        this.currentVRCamera.animations = [];
                        var i = new e.Animation("animationCameraTeleportation","position",90,e.Animation.ANIMATIONTYPE_VECTOR3,e.Animation.ANIMATIONLOOPMODE_CONSTANT)
                          , n = [{
                            frame: 0,
                            value: this.currentVRCamera.position
                        }, {
                            frame: 11,
                            value: this._workingVector
                        }];
                        i.setKeys(n),
                        i.setEasingFunction(this._circleEase),
                        this.currentVRCamera.animations.push(i),
                        this._postProcessMove.animations = [];
                        var o = new e.Animation("animationPP","vignetteWeight",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT)
                          , a = [];
                        a.push({
                            frame: 0,
                            value: 0
                        }),
                        a.push({
                            frame: 5,
                            value: 8
                        }),
                        a.push({
                            frame: 11,
                            value: 0
                        }),
                        o.setKeys(a),
                        this._postProcessMove.animations.push(o);
                        var s = new e.Animation("animationPP2","vignetteStretch",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT)
                          , y = [];
                        y.push({
                            frame: 0,
                            value: 0
                        }),
                        y.push({
                            frame: 5,
                            value: 10
                        }),
                        y.push({
                            frame: 11,
                            value: 0
                        }),
                        s.setKeys(y),
                        this._postProcessMove.animations.push(s),
                        this._postProcessMove.imageProcessingConfiguration.vignetteWeight = 0,
                        this._postProcessMove.imageProcessingConfiguration.vignetteStretch = 0,
                        this._webVRCamera.attachPostProcess(this._postProcessMove),
                        this._scene.beginAnimation(this._postProcessMove, 0, 11, !1, 1, (function() {
                            r._webVRCamera.detachPostProcess(r._postProcessMove)
                        }
                        )),
                        this._scene.beginAnimation(this.currentVRCamera, 0, 11, !1, 1, (function() {
                            r.onAfterCameraTeleport.notifyObservers(r._workingVector)
                        }
                        )),
                        this._hideTeleportationTarget()
                    }
                }
                ,
                t.prototype._convertNormalToDirectionOfRay = function(t, r) {
                    t && (Math.acos(e.Vector3.Dot(t, r.direction)) < Math.PI / 2 && t.scaleInPlace(-1));
                    return t
                }
                ,
                t.prototype._castRayAndSelectObject = function(t) {
                    if (this.currentVRCamera instanceof e.FreeCamera) {
                        var r = t._getForwardRay(this._rayLength)
                          , i = this._scene.pickWithRay(r, this._raySelectionPredicate);
                        if (i && (t._laserPointer && (i.originMesh = t._laserPointer.parent),
                        this._scene.simulatePointerMove(i, {
                            pointerId: t._id
                        })),
                        t._currentHit = i,
                        i && i.pickedPoint) {
                            if (this._displayGaze) {
                                var n = 1;
                                t._gazeTracker.isVisible = !0,
                                t._isActionableMesh && (n = 3),
                                this.updateGazeTrackerScale && (t._gazeTracker.scaling.x = i.distance * n,
                                t._gazeTracker.scaling.y = i.distance * n,
                                t._gazeTracker.scaling.z = i.distance * n);
                                var o = this._convertNormalToDirectionOfRay(i.getNormal(), r);
                                if (o) {
                                    var a = e.Vector3.Cross(e.Axis.Y, o)
                                      , s = e.Vector3.Cross(o, a);
                                    e.Vector3.RotationFromAxisToRef(s, o, a, t._gazeTracker.rotation)
                                }
                                t._gazeTracker.position.copyFrom(i.pickedPoint),
                                t._gazeTracker.position.x < 0 ? t._gazeTracker.position.x += .002 : t._gazeTracker.position.x -= .002,
                                t._gazeTracker.position.y < 0 ? t._gazeTracker.position.y += .002 : t._gazeTracker.position.y -= .002,
                                t._gazeTracker.position.z < 0 ? t._gazeTracker.position.z += .002 : t._gazeTracker.position.z -= .002
                            }
                            t._updatePointerDistance(i.distance)
                        } else
                            t._updatePointerDistance(),
                            t._gazeTracker.isVisible = !1;
                        if (i && i.pickedMesh) {
                            if (this._teleportationInitialized && this._isTeleportationFloor(i.pickedMesh) && i.pickedPoint)
                                return t._currentMeshSelected && !this._isTeleportationFloor(t._currentMeshSelected) && this._notifySelectedMeshUnselected(t._currentMeshSelected),
                                t._currentMeshSelected = null,
                                void (t._teleportationRequestInitiated && this._moveTeleportationSelectorTo(i, t, r));
                            if (i.pickedMesh !== t._currentMeshSelected)
                                if (this.meshSelectionPredicate(i.pickedMesh)) {
                                    this.onNewMeshPicked.notifyObservers(i),
                                    t._currentMeshSelected = i.pickedMesh,
                                    i.pickedMesh.isPickable && i.pickedMesh.actionManager ? (this.changeGazeColor(new e.Color3(0,0,1)),
                                    this.changeLaserColor(new e.Color3(.2,.2,1)),
                                    t._isActionableMesh = !0) : (this.changeGazeColor(new e.Color3(.7,.7,.7)),
                                    this.changeLaserColor(new e.Color3(.7,.7,.7)),
                                    t._isActionableMesh = !1);
                                    try {
                                        this.onNewMeshSelected.notifyObservers(i.pickedMesh)
                                    } catch (t) {
                                        e.Tools.Warn("Error in your custom logic onNewMeshSelected: " + t)
                                    }
                                } else
                                    this._notifySelectedMeshUnselected(t._currentMeshSelected),
                                    t._currentMeshSelected = null,
                                    this.changeGazeColor(new e.Color3(.7,.7,.7)),
                                    this.changeLaserColor(new e.Color3(.7,.7,.7))
                        } else
                            this._notifySelectedMeshUnselected(t._currentMeshSelected),
                            t._currentMeshSelected = null,
                            this.changeGazeColor(new e.Color3(.7,.7,.7)),
                            this.changeLaserColor(new e.Color3(.7,.7,.7))
                    }
                }
                ,
                t.prototype._notifySelectedMeshUnselected = function(e) {
                    e && this.onSelectedMeshUnselected.notifyObservers(e)
                }
                ,
                t.prototype.changeLaserColor = function(e) {
                    this._leftController && this._leftController._setLaserPointerColor(e),
                    this._rightController && this._rightController._setLaserPointerColor(e)
                }
                ,
                t.prototype.changeGazeColor = function(e) {
                    this._cameraGazer._gazeTracker.material && (this._cameraGazer._gazeTracker.material.emissiveColor = e,
                    this._leftController && (this._leftController._gazeTracker.material.emissiveColor = e),
                    this._rightController && (this._rightController._gazeTracker.material.emissiveColor = e))
                }
                ,
                t.prototype.dispose = function() {
                    this.isInVRMode && this.exitVR(),
                    this._postProcessMove && this._postProcessMove.dispose(),
                    this._webVRCamera && this._webVRCamera.dispose(),
                    this._vrDeviceOrientationCamera && this._vrDeviceOrientationCamera.dispose(),
                    !this._useCustomVRButton && this._btnVR.parentNode && document.body.removeChild(this._btnVR),
                    this._deviceOrientationCamera && this._scene.activeCamera != this._deviceOrientationCamera && this._deviceOrientationCamera.dispose(),
                    this._cameraGazer && this._cameraGazer.dispose(),
                    this._leftController && this._leftController.dispose(),
                    this._rightController && this._rightController.dispose(),
                    this._teleportationTarget && this._teleportationTarget.dispose(),
                    this._floorMeshesCollection = [],
                    document.removeEventListener("keydown", this._onKeyDown),
                    window.removeEventListener("vrdisplaypresentchange", this._onVrDisplayPresentChange),
                    window.removeEventListener("resize", this._onResize),
                    document.removeEventListener("fullscreenchange", this._onFullscreenChange),
                    document.removeEventListener("mozfullscreenchange", this._onFullscreenChange),
                    document.removeEventListener("webkitfullscreenchange", this._onFullscreenChange),
                    document.removeEventListener("msfullscreenchange", this._onFullscreenChange),
                    document.onmsfullscreenchange = null,
                    this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),
                    this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),
                    this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),
                    window.removeEventListener("vrdisplaypresentchange", this._onVrDisplayPresentChange),
                    this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),
                    this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),
                    this._scene.unregisterBeforeRender(this.beforeRender)
                }
                ,
                t.prototype.getClassName = function() {
                    return "VRExperienceHelper"
                }
                ,
                t
            }();
            e.VRExperienceHelper = n
        }(s || (s = {})),
        function(e) {
            var t;
            !function(e) {
                e[e.X = 0] = "X",
                e[e.Y = 1] = "Y",
                e[e.Z = 2] = "Z"
            }(t = e.JoystickAxis || (e.JoystickAxis = {}));
            var r = function() {
                function r(i) {
                    var n = this;
                    if (this._leftJoystick = !!i,
                    r._globalJoystickIndex++,
                    this._axisTargetedByLeftAndRight = t.X,
                    this._axisTargetedByUpAndDown = t.Y,
                    this.reverseLeftRight = !1,
                    this.reverseUpDown = !1,
                    this._touches = new e.StringDictionary,
                    this.deltaPosition = e.Vector3.Zero(),
                    this._joystickSensibility = 25,
                    this._inversedSensibility = 1 / (this._joystickSensibility / 1e3),
                    this._onResize = function(e) {
                        r.vjCanvasWidth = window.innerWidth,
                        r.vjCanvasHeight = window.innerHeight,
                        r.vjCanvas && (r.vjCanvas.width = r.vjCanvasWidth,
                        r.vjCanvas.height = r.vjCanvasHeight),
                        r.halfWidth = r.vjCanvasWidth / 2
                    }
                    ,
                    !r.vjCanvas) {
                        window.addEventListener("resize", this._onResize, !1),
                        r.vjCanvas = document.createElement("canvas"),
                        r.vjCanvasWidth = window.innerWidth,
                        r.vjCanvasHeight = window.innerHeight,
                        r.vjCanvas.width = window.innerWidth,
                        r.vjCanvas.height = window.innerHeight,
                        r.vjCanvas.style.width = "100%",
                        r.vjCanvas.style.height = "100%",
                        r.vjCanvas.style.position = "absolute",
                        r.vjCanvas.style.backgroundColor = "transparent",
                        r.vjCanvas.style.top = "0px",
                        r.vjCanvas.style.left = "0px",
                        r.vjCanvas.style.zIndex = "5",
                        r.vjCanvas.style.msTouchAction = "none",
                        r.vjCanvas.setAttribute("touch-action", "none");
                        var o = r.vjCanvas.getContext("2d");
                        if (!o)
                            throw new Error("Unable to create canvas for virtual joystick");
                        r.vjCanvasContext = o,
                        r.vjCanvasContext.strokeStyle = "#ffffff",
                        r.vjCanvasContext.lineWidth = 2,
                        document.body.appendChild(r.vjCanvas)
                    }
                    r.halfWidth = r.vjCanvas.width / 2,
                    this.pressed = !1,
                    this._joystickColor = "cyan",
                    this._joystickPointerID = -1,
                    this._joystickPointerPos = new e.Vector2(0,0),
                    this._joystickPreviousPointerPos = new e.Vector2(0,0),
                    this._joystickPointerStartPos = new e.Vector2(0,0),
                    this._deltaJoystickVector = new e.Vector2(0,0),
                    this._onPointerDownHandlerRef = function(e) {
                        n._onPointerDown(e)
                    }
                    ,
                    this._onPointerMoveHandlerRef = function(e) {
                        n._onPointerMove(e)
                    }
                    ,
                    this._onPointerUpHandlerRef = function(e) {
                        n._onPointerUp(e)
                    }
                    ,
                    r.vjCanvas.addEventListener("pointerdown", this._onPointerDownHandlerRef, !1),
                    r.vjCanvas.addEventListener("pointermove", this._onPointerMoveHandlerRef, !1),
                    r.vjCanvas.addEventListener("pointerup", this._onPointerUpHandlerRef, !1),
                    r.vjCanvas.addEventListener("pointerout", this._onPointerUpHandlerRef, !1),
                    r.vjCanvas.addEventListener("contextmenu", (function(e) {
                        e.preventDefault()
                    }
                    ), !1),
                    requestAnimationFrame((function() {
                        n._drawVirtualJoystick()
                    }
                    ))
                }
                return r.prototype.setJoystickSensibility = function(e) {
                    this._joystickSensibility = e,
                    this._inversedSensibility = 1 / (this._joystickSensibility / 1e3)
                }
                ,
                r.prototype._onPointerDown = function(e) {
                    e.preventDefault(),
                    (!0 === this._leftJoystick ? e.clientX < r.halfWidth : e.clientX > r.halfWidth) && this._joystickPointerID < 0 ? (this._joystickPointerID = e.pointerId,
                    this._joystickPointerStartPos.x = e.clientX,
                    this._joystickPointerStartPos.y = e.clientY,
                    this._joystickPointerPos = this._joystickPointerStartPos.clone(),
                    this._joystickPreviousPointerPos = this._joystickPointerStartPos.clone(),
                    this._deltaJoystickVector.x = 0,
                    this._deltaJoystickVector.y = 0,
                    this.pressed = !0,
                    this._touches.add(e.pointerId.toString(), e)) : r._globalJoystickIndex < 2 && this._action && (this._action(),
                    this._touches.add(e.pointerId.toString(), {
                        x: e.clientX,
                        y: e.clientY,
                        prevX: e.clientX,
                        prevY: e.clientY
                    }))
                }
                ,
                r.prototype._onPointerMove = function(e) {
                    if (this._joystickPointerID == e.pointerId) {
                        this._joystickPointerPos.x = e.clientX,
                        this._joystickPointerPos.y = e.clientY,
                        this._deltaJoystickVector = this._joystickPointerPos.clone(),
                        this._deltaJoystickVector = this._deltaJoystickVector.subtract(this._joystickPointerStartPos);
                        var r = (this.reverseLeftRight ? -1 : 1) * this._deltaJoystickVector.x / this._inversedSensibility;
                        switch (this._axisTargetedByLeftAndRight) {
                        case t.X:
                            this.deltaPosition.x = Math.min(1, Math.max(-1, r));
                            break;
                        case t.Y:
                            this.deltaPosition.y = Math.min(1, Math.max(-1, r));
                            break;
                        case t.Z:
                            this.deltaPosition.z = Math.min(1, Math.max(-1, r))
                        }
                        var i = (this.reverseUpDown ? 1 : -1) * this._deltaJoystickVector.y / this._inversedSensibility;
                        switch (this._axisTargetedByUpAndDown) {
                        case t.X:
                            this.deltaPosition.x = Math.min(1, Math.max(-1, i));
                            break;
                        case t.Y:
                            this.deltaPosition.y = Math.min(1, Math.max(-1, i));
                            break;
                        case t.Z:
                            this.deltaPosition.z = Math.min(1, Math.max(-1, i))
                        }
                    } else {
                        var n = this._touches.get(e.pointerId.toString());
                        n && (n.x = e.clientX,
                        n.y = e.clientY)
                    }
                }
                ,
                r.prototype._onPointerUp = function(e) {
                    if (this._joystickPointerID == e.pointerId)
                        r.vjCanvasContext.clearRect(this._joystickPointerStartPos.x - 64, this._joystickPointerStartPos.y - 64, 128, 128),
                        r.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x - 42, this._joystickPreviousPointerPos.y - 42, 84, 84),
                        this._joystickPointerID = -1,
                        this.pressed = !1;
                    else {
                        var t = this._touches.get(e.pointerId.toString());
                        t && r.vjCanvasContext.clearRect(t.prevX - 44, t.prevY - 44, 88, 88)
                    }
                    this._deltaJoystickVector.x = 0,
                    this._deltaJoystickVector.y = 0,
                    this._touches.remove(e.pointerId.toString())
                }
                ,
                r.prototype.setJoystickColor = function(e) {
                    this._joystickColor = e
                }
                ,
                r.prototype.setActionOnTouch = function(e) {
                    this._action = e
                }
                ,
                r.prototype.setAxisForLeftRight = function(e) {
                    switch (e) {
                    case t.X:
                    case t.Y:
                    case t.Z:
                        this._axisTargetedByLeftAndRight = e;
                        break;
                    default:
                        this._axisTargetedByLeftAndRight = t.X
                    }
                }
                ,
                r.prototype.setAxisForUpDown = function(e) {
                    switch (e) {
                    case t.X:
                    case t.Y:
                    case t.Z:
                        this._axisTargetedByUpAndDown = e;
                        break;
                    default:
                        this._axisTargetedByUpAndDown = t.Y
                    }
                }
                ,
                r.prototype._drawVirtualJoystick = function() {
                    var e = this;
                    this.pressed && this._touches.forEach((function(t, i) {
                        i.pointerId === e._joystickPointerID ? (r.vjCanvasContext.clearRect(e._joystickPointerStartPos.x - 64, e._joystickPointerStartPos.y - 64, 128, 128),
                        r.vjCanvasContext.clearRect(e._joystickPreviousPointerPos.x - 42, e._joystickPreviousPointerPos.y - 42, 84, 84),
                        r.vjCanvasContext.beginPath(),
                        r.vjCanvasContext.lineWidth = 6,
                        r.vjCanvasContext.strokeStyle = e._joystickColor,
                        r.vjCanvasContext.arc(e._joystickPointerStartPos.x, e._joystickPointerStartPos.y, 40, 0, 2 * Math.PI, !0),
                        r.vjCanvasContext.stroke(),
                        r.vjCanvasContext.closePath(),
                        r.vjCanvasContext.beginPath(),
                        r.vjCanvasContext.strokeStyle = e._joystickColor,
                        r.vjCanvasContext.lineWidth = 2,
                        r.vjCanvasContext.arc(e._joystickPointerStartPos.x, e._joystickPointerStartPos.y, 60, 0, 2 * Math.PI, !0),
                        r.vjCanvasContext.stroke(),
                        r.vjCanvasContext.closePath(),
                        r.vjCanvasContext.beginPath(),
                        r.vjCanvasContext.strokeStyle = e._joystickColor,
                        r.vjCanvasContext.arc(e._joystickPointerPos.x, e._joystickPointerPos.y, 40, 0, 2 * Math.PI, !0),
                        r.vjCanvasContext.stroke(),
                        r.vjCanvasContext.closePath(),
                        e._joystickPreviousPointerPos = e._joystickPointerPos.clone()) : (r.vjCanvasContext.clearRect(i.prevX - 44, i.prevY - 44, 88, 88),
                        r.vjCanvasContext.beginPath(),
                        r.vjCanvasContext.fillStyle = "white",
                        r.vjCanvasContext.beginPath(),
                        r.vjCanvasContext.strokeStyle = "red",
                        r.vjCanvasContext.lineWidth = 6,
                        r.vjCanvasContext.arc(i.x, i.y, 40, 0, 2 * Math.PI, !0),
                        r.vjCanvasContext.stroke(),
                        r.vjCanvasContext.closePath(),
                        i.prevX = i.x,
                        i.prevY = i.y)
                    }
                    )),
                    requestAnimationFrame((function() {
                        e._drawVirtualJoystick()
                    }
                    ))
                }
                ,
                r.prototype.releaseCanvas = function() {
                    r.vjCanvas && (r.vjCanvas.removeEventListener("pointerdown", this._onPointerDownHandlerRef),
                    r.vjCanvas.removeEventListener("pointermove", this._onPointerMoveHandlerRef),
                    r.vjCanvas.removeEventListener("pointerup", this._onPointerUpHandlerRef),
                    r.vjCanvas.removeEventListener("pointerout", this._onPointerUpHandlerRef),
                    window.removeEventListener("resize", this._onResize),
                    document.body.removeChild(r.vjCanvas),
                    r.vjCanvas = null)
                }
                ,
                r._globalJoystickIndex = 0,
                r
            }();
            e.VirtualJoystick = r
        }(s || (s = {})),
        function(e) {
            e.Node.AddNodeConstructor("VirtualJoysticksCamera", (function(r, i) {
                return function() {
                    return new t(r,e.Vector3.Zero(),i)
                }
            }
            ));
            var t = function(e) {
                function t(t, r, i) {
                    var n = e.call(this, t, r, i) || this;
                    return n.inputs.addVirtualJoystick(),
                    n
                }
                return o(t, e),
                t.prototype.getClassName = function() {
                    return "VirtualJoysticksCamera"
                }
                ,
                t
            }(e.FreeCamera);
            e.VirtualJoysticksCamera = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.prototype.getLeftJoystick = function() {
                    return this._leftjoystick
                }
                ,
                t.prototype.getRightJoystick = function() {
                    return this._rightjoystick
                }
                ,
                t.prototype.checkInputs = function() {
                    if (this._leftjoystick) {
                        var t = this.camera
                          , r = 50 * t._computeLocalCameraSpeed()
                          , i = e.Matrix.RotationYawPitchRoll(t.rotation.y, t.rotation.x, 0)
                          , n = e.Vector3.TransformCoordinates(new e.Vector3(this._leftjoystick.deltaPosition.x * r,this._leftjoystick.deltaPosition.y * r,this._leftjoystick.deltaPosition.z * r), i);
                        t.cameraDirection = t.cameraDirection.add(n),
                        t.cameraRotation = t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),
                        this._leftjoystick.pressed || (this._leftjoystick.deltaPosition = this._leftjoystick.deltaPosition.scale(.9)),
                        this._rightjoystick.pressed || (this._rightjoystick.deltaPosition = this._rightjoystick.deltaPosition.scale(.9))
                    }
                }
                ,
                t.prototype.attachControl = function(t, r) {
                    this._leftjoystick = new e.VirtualJoystick(!0),
                    this._leftjoystick.setAxisForUpDown(e.JoystickAxis.Z),
                    this._leftjoystick.setAxisForLeftRight(e.JoystickAxis.X),
                    this._leftjoystick.setJoystickSensibility(.15),
                    this._rightjoystick = new e.VirtualJoystick(!1),
                    this._rightjoystick.setAxisForUpDown(e.JoystickAxis.X),
                    this._rightjoystick.setAxisForLeftRight(e.JoystickAxis.Y),
                    this._rightjoystick.reverseUpDown = !0,
                    this._rightjoystick.setJoystickSensibility(.05),
                    this._rightjoystick.setJoystickColor("yellow")
                }
                ,
                t.prototype.detachControl = function(e) {
                    this._leftjoystick.releaseCanvas(),
                    this._rightjoystick.releaseCanvas()
                }
                ,
                t.prototype.getClassName = function() {
                    return "FreeCameraVirtualJoystickInput"
                }
                ,
                t.prototype.getSimpleName = function() {
                    return "virtualJoystick"
                }
                ,
                t
            }();
            e.FreeCameraVirtualJoystickInput = t,
            e.CameraInputTypes.FreeCameraVirtualJoystickInput = t
        }(s || (s = {})),
        function(e) {
            var t = function(e, t, r) {
                this.quality = e,
                this.distance = t,
                this.optimizeMesh = r
            };
            e.SimplificationSettings = t;
            var r, i = function() {
                function t() {
                    this.running = !1,
                    this._simplificationArray = []
                }
                return t.prototype.addTask = function(e) {
                    this._simplificationArray.push(e)
                }
                ,
                t.prototype.executeNext = function() {
                    var e = this._simplificationArray.pop();
                    e ? (this.running = !0,
                    this.runSimplification(e)) : this.running = !1
                }
                ,
                t.prototype.runSimplification = function(t) {
                    var r = this;
                    if (t.parallelProcessing)
                        t.settings.forEach((function(e) {
                            r.getSimplifier(t).simplify(e, (function(i) {
                                t.mesh.addLODLevel(e.distance, i),
                                i.isVisible = !0,
                                e.quality === t.settings[t.settings.length - 1].quality && t.successCallback && t.successCallback(),
                                r.executeNext()
                            }
                            ))
                        }
                        ));
                    else {
                        var i = this.getSimplifier(t);
                        e.AsyncLoop.Run(t.settings.length, (function(e) {
                            var r, n;
                            r = t.settings[e.index],
                            n = function() {
                                e.executeNext()
                            }
                            ,
                            i.simplify(r, (function(e) {
                                t.mesh.addLODLevel(r.distance, e),
                                e.isVisible = !0,
                                n()
                            }
                            ))
                        }
                        ), (function() {
                            t.successCallback && t.successCallback(),
                            r.executeNext()
                        }
                        ))
                    }
                }
                ,
                t.prototype.getSimplifier = function(e) {
                    switch (e.simplificationType) {
                    case r.QUADRATIC:
                    default:
                        return new y(e.mesh)
                    }
                }
                ,
                t
            }();
            e.SimplificationQueue = i,
            function(e) {
                e[e.QUADRATIC = 0] = "QUADRATIC"
            }(r = e.SimplificationType || (e.SimplificationType = {}));
            var n = function(e) {
                this.vertices = e,
                this.error = new Array(4),
                this.deleted = !1,
                this.isDirty = !1,
                this.deletePending = !1,
                this.borderFactor = 0
            }
              , o = function() {
                function e(e, t) {
                    this.position = e,
                    this.id = t,
                    this.isBorder = !0,
                    this.q = new a,
                    this.triangleCount = 0,
                    this.triangleStart = 0,
                    this.originalOffsets = []
                }
                return e.prototype.updatePosition = function(e) {
                    this.position.copyFrom(e)
                }
                ,
                e
            }()
              , a = function() {
                function e(e) {
                    this.data = new Array(10);
                    for (var t = 0; t < 10; ++t)
                        e && e[t] ? this.data[t] = e[t] : this.data[t] = 0
                }
                return e.prototype.det = function(e, t, r, i, n, o, a, s, y) {
                    return this.data[e] * this.data[n] * this.data[y] + this.data[r] * this.data[i] * this.data[s] + this.data[t] * this.data[o] * this.data[a] - this.data[r] * this.data[n] * this.data[a] - this.data[e] * this.data[o] * this.data[s] - this.data[t] * this.data[i] * this.data[y]
                }
                ,
                e.prototype.addInPlace = function(e) {
                    for (var t = 0; t < 10; ++t)
                        this.data[t] += e.data[t]
                }
                ,
                e.prototype.addArrayInPlace = function(e) {
                    for (var t = 0; t < 10; ++t)
                        this.data[t] += e[t]
                }
                ,
                e.prototype.add = function(t) {
                    for (var r = new e, i = 0; i < 10; ++i)
                        r.data[i] = this.data[i] + t.data[i];
                    return r
                }
                ,
                e.FromData = function(t, r, i, n) {
                    return new e(e.DataFromNumbers(t, r, i, n))
                }
                ,
                e.DataFromNumbers = function(e, t, r, i) {
                    return [e * e, e * t, e * r, e * i, t * t, t * r, t * i, r * r, r * i, i * i]
                }
                ,
                e
            }()
              , s = function(e, t) {
                this.vertexId = e,
                this.triangleId = t
            }
              , y = function() {
                function t(t) {
                    this._mesh = t,
                    this.syncIterations = 5e3,
                    this.aggressiveness = 7,
                    this.decimationIterations = 100,
                    this.boundingBoxEpsilon = e.Epsilon
                }
                return t.prototype.simplify = function(t, r) {
                    var i = this;
                    this.initDecimatedMesh(),
                    e.AsyncLoop.Run(this._mesh.subMeshes.length, (function(e) {
                        i.initWithMesh(e.index, (function() {
                            i.runDecimation(t, e.index, (function() {
                                e.executeNext()
                            }
                            ))
                        }
                        ), t.optimizeMesh)
                    }
                    ), (function() {
                        setTimeout((function() {
                            r(i._reconstructedMesh)
                        }
                        ), 0)
                    }
                    ))
                }
                ,
                t.prototype.runDecimation = function(t, r, i) {
                    var n = this
                      , o = ~~(this.triangles.length * t.quality)
                      , a = 0
                      , s = this.triangles.length;
                    e.AsyncLoop.Run(this.decimationIterations, (function(t) {
                        var r, i;
                        s - a <= o ? t.breakLoop() : (r = t.index,
                        i = function() {
                            t.executeNext()
                        }
                        ,
                        setTimeout((function() {
                            r % 5 == 0 && n.updateMesh(0 === r);
                            for (var t = 0; t < n.triangles.length; ++t)
                                n.triangles[t].isDirty = !1;
                            var y = 1e-9 * Math.pow(r + 3, n.aggressiveness);
                            e.AsyncLoop.SyncAsyncForLoop(n.triangles.length, n.syncIterations, (function(t) {
                                var r = ~~((n.triangles.length / 2 + t) % n.triangles.length)
                                  , i = n.triangles[r];
                                if (i && !(i.error[3] > y || i.deleted || i.isDirty))
                                    for (var o = 0; o < 3; ++o)
                                        if (i.error[o] < y) {
                                            var s = []
                                              , l = []
                                              , c = i.vertices[o]
                                              , h = i.vertices[(o + 1) % 3];
                                            if (c.isBorder || h.isBorder)
                                                continue;
                                            var u = e.Vector3.Zero()
                                              , d = e.Vector3.Zero()
                                              , x = e.Vector2.Zero()
                                              , p = new e.Color4(0,0,0,1);
                                            n.calculateError(c, h, u, d, x, p);
                                            var f = new Array;
                                            if (n.isFlipped(c, h, u, s, i.borderFactor, f))
                                                continue;
                                            if (n.isFlipped(h, c, u, l, i.borderFactor, f))
                                                continue;
                                            if (s.indexOf(!0) < 0 || l.indexOf(!0) < 0)
                                                continue;
                                            var m = new Array;
                                            if (f.forEach((function(e) {
                                                -1 === m.indexOf(e) && (e.deletePending = !0,
                                                m.push(e))
                                            }
                                            )),
                                            m.length % 2 != 0)
                                                continue;
                                            c.q = h.q.add(c.q),
                                            c.updatePosition(u);
                                            var z = n.references.length;
                                            a = n.updateTriangles(c, c, s, a),
                                            a = n.updateTriangles(c, h, l, a);
                                            var _ = n.references.length - z;
                                            if (_ <= c.triangleCount) {
                                                if (_)
                                                    for (var g = 0; g < _; g++)
                                                        n.references[c.triangleStart + g] = n.references[z + g]
                                            } else
                                                c.triangleStart = z;
                                            c.triangleCount = _;
                                            break
                                        }
                            }
                            ), i, (function() {
                                return s - a <= o
                            }
                            ))
                        }
                        ), 0))
                    }
                    ), (function() {
                        setTimeout((function() {
                            n.reconstructMesh(r),
                            i()
                        }
                        ), 0)
                    }
                    ))
                }
                ,
                t.prototype.initWithMesh = function(t, r, i) {
                    var a = this;
                    this.vertices = [],
                    this.triangles = [];
                    var s = this._mesh.getVerticesData(e.VertexBuffer.PositionKind)
                      , y = this._mesh.getIndices()
                      , l = this._mesh.subMeshes[t]
                      , c = []
                      , h = l.verticesCount;
                    e.AsyncLoop.SyncAsyncForLoop(h, this.syncIterations / 4 >> 0, (function(t) {
                        if (s) {
                            var r = t + l.verticesStart
                              , n = e.Vector3.FromArray(s, 3 * r)
                              , y = function(e) {
                                if (i)
                                    for (var t = 0; t < a.vertices.length; ++t)
                                        if (a.vertices[t].position.equals(e))
                                            return a.vertices[t];
                                return null
                            }(n) || new o(n,a.vertices.length);
                            y.originalOffsets.push(r),
                            y.id === a.vertices.length && a.vertices.push(y),
                            c.push(y.id)
                        }
                    }
                    ), (function() {
                        e.AsyncLoop.SyncAsyncForLoop(l.indexCount / 3, a.syncIterations, (function(e) {
                            if (y) {
                                var t = 3 * (l.indexStart / 3 + e)
                                  , r = y[t + 0]
                                  , i = y[t + 1]
                                  , o = y[t + 2]
                                  , s = a.vertices[c[r - l.verticesStart]]
                                  , h = a.vertices[c[i - l.verticesStart]]
                                  , u = a.vertices[c[o - l.verticesStart]]
                                  , d = new n([s, h, u]);
                                d.originalOffset = t,
                                a.triangles.push(d)
                            }
                        }
                        ), (function() {
                            a.init(r)
                        }
                        ))
                    }
                    ))
                }
                ,
                t.prototype.init = function(t) {
                    var r = this;
                    e.AsyncLoop.SyncAsyncForLoop(this.triangles.length, this.syncIterations, (function(t) {
                        var i = r.triangles[t];
                        i.normal = e.Vector3.Cross(i.vertices[1].position.subtract(i.vertices[0].position), i.vertices[2].position.subtract(i.vertices[0].position)).normalize();
                        for (var n = 0; n < 3; n++)
                            i.vertices[n].q.addArrayInPlace(a.DataFromNumbers(i.normal.x, i.normal.y, i.normal.z, -e.Vector3.Dot(i.normal, i.vertices[0].position)))
                    }
                    ), (function() {
                        e.AsyncLoop.SyncAsyncForLoop(r.triangles.length, r.syncIterations, (function(e) {
                            for (var t = r.triangles[e], i = 0; i < 3; ++i)
                                t.error[i] = r.calculateError(t.vertices[i], t.vertices[(i + 1) % 3]);
                            t.error[3] = Math.min(t.error[0], t.error[1], t.error[2])
                        }
                        ), (function() {
                            t()
                        }
                        ))
                    }
                    ))
                }
                ,
                t.prototype.reconstructMesh = function(t) {
                    var r, i, n, o = [];
                    for (r = 0; r < this.vertices.length; ++r)
                        this.vertices[r].triangleCount = 0;
                    for (r = 0; r < this.triangles.length; ++r)
                        if (!this.triangles[r].deleted) {
                            for (i = this.triangles[r],
                            n = 0; n < 3; ++n)
                                i.vertices[n].triangleCount = 1;
                            o.push(i)
                        }
                    var a = this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind) || []
                      , s = this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind) || []
                      , y = this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind) || []
                      , l = this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind) || []
                      , c = this._mesh.getVerticesData(e.VertexBuffer.NormalKind)
                      , h = this._mesh.getVerticesData(e.VertexBuffer.UVKind)
                      , u = this._mesh.getVerticesData(e.VertexBuffer.ColorKind)
                      , d = 0;
                    for (r = 0; r < this.vertices.length; ++r) {
                        var x = this.vertices[r];
                        x.id = d,
                        x.triangleCount && x.originalOffsets.forEach((function(e) {
                            c && (a.push(x.position.x),
                            a.push(x.position.y),
                            a.push(x.position.z),
                            s.push(c[3 * e]),
                            s.push(c[3 * e + 1]),
                            s.push(c[3 * e + 2]),
                            h && h.length ? (y.push(h[2 * e]),
                            y.push(h[2 * e + 1])) : u && u.length && (l.push(u[4 * e]),
                            l.push(u[4 * e + 1]),
                            l.push(u[4 * e + 2]),
                            l.push(u[4 * e + 3])),
                            ++d)
                        }
                        ))
                    }
                    var p = this._reconstructedMesh.getTotalIndices()
                      , f = this._reconstructedMesh.getTotalVertices()
                      , m = this._reconstructedMesh.subMeshes;
                    this._reconstructedMesh.subMeshes = [];
                    var z = this._reconstructedMesh.getIndices()
                      , _ = this._mesh.getIndices();
                    for (r = 0; r < o.length; ++r)
                        i = o[r],
                        [0, 1, 2].forEach((function(e) {
                            var t = _[i.originalOffset + e]
                              , r = i.vertices[e].originalOffsets.indexOf(t);
                            r < 0 && (r = 0),
                            z.push(i.vertices[e].id + r + f)
                        }
                        ));
                    this._reconstructedMesh.setIndices(z),
                    this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind, a),
                    this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind, s),
                    y.length > 0 && this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind, y),
                    l.length > 0 && this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind, l);
                    var g = this._mesh.subMeshes[t];
                    t > 0 && (this._reconstructedMesh.subMeshes = [],
                    m.forEach((function(t) {
                        e.SubMesh.AddToMesh(t.materialIndex, t.verticesStart, t.verticesCount, t.indexStart, t.indexCount, t.getMesh())
                    }
                    )),
                    e.SubMesh.AddToMesh(g.materialIndex, f, d, p, 3 * o.length, this._reconstructedMesh))
                }
                ,
                t.prototype.initDecimatedMesh = function() {
                    this._reconstructedMesh = new e.Mesh(this._mesh.name + "Decimated",this._mesh.getScene()),
                    this._reconstructedMesh.material = this._mesh.material,
                    this._reconstructedMesh.parent = this._mesh.parent,
                    this._reconstructedMesh.isVisible = !1,
                    this._reconstructedMesh.renderingGroupId = this._mesh.renderingGroupId
                }
                ,
                t.prototype.isFlipped = function(t, r, i, n, o, a) {
                    for (var s = 0; s < t.triangleCount; ++s) {
                        var y = this.triangles[this.references[t.triangleStart + s].triangleId];
                        if (!y.deleted) {
                            var l = this.references[t.triangleStart + s].vertexId
                              , c = y.vertices[(l + 1) % 3]
                              , h = y.vertices[(l + 2) % 3];
                            if (c !== r && h !== r) {
                                var u = c.position.subtract(i);
                                u = u.normalize();
                                var d = h.position.subtract(i);
                                if (d = d.normalize(),
                                Math.abs(e.Vector3.Dot(u, d)) > .999)
                                    return !0;
                                var x = e.Vector3.Cross(u, d).normalize();
                                if (n[s] = !1,
                                e.Vector3.Dot(x, y.normal) < .2)
                                    return !0
                            } else
                                n[s] = !0,
                                a.push(y)
                        }
                    }
                    return !1
                }
                ,
                t.prototype.updateTriangles = function(e, t, r, i) {
                    for (var n = i, o = 0; o < t.triangleCount; ++o) {
                        var a = this.references[t.triangleStart + o]
                          , s = this.triangles[a.triangleId];
                        s.deleted || (r[o] && s.deletePending ? (s.deleted = !0,
                        n++) : (s.vertices[a.vertexId] = e,
                        s.isDirty = !0,
                        s.error[0] = this.calculateError(s.vertices[0], s.vertices[1]) + s.borderFactor / 2,
                        s.error[1] = this.calculateError(s.vertices[1], s.vertices[2]) + s.borderFactor / 2,
                        s.error[2] = this.calculateError(s.vertices[2], s.vertices[0]) + s.borderFactor / 2,
                        s.error[3] = Math.min(s.error[0], s.error[1], s.error[2]),
                        this.references.push(a)))
                    }
                    return n
                }
                ,
                t.prototype.identifyBorder = function() {
                    for (var e = 0; e < this.vertices.length; ++e) {
                        var t, r = [], i = [], n = this.vertices[e];
                        for (t = 0; t < n.triangleCount; ++t)
                            for (var o = this.triangles[this.references[n.triangleStart + t].triangleId], a = 0; a < 3; a++) {
                                for (var s = 0, y = o.vertices[a]; s < r.length && i[s] !== y.id; )
                                    ++s;
                                s === r.length ? (r.push(1),
                                i.push(y.id)) : r[s]++
                            }
                        for (t = 0; t < r.length; ++t)
                            1 === r[t] ? this.vertices[i[t]].isBorder = !0 : this.vertices[i[t]].isBorder = !1
                    }
                }
                ,
                t.prototype.updateMesh = function(e) {
                    var t, r, i, n;
                    if (void 0 === e && (e = !1),
                    !e) {
                        var o = [];
                        for (t = 0; t < this.triangles.length; ++t)
                            this.triangles[t].deleted || o.push(this.triangles[t]);
                        this.triangles = o
                    }
                    for (t = 0; t < this.vertices.length; ++t)
                        this.vertices[t].triangleCount = 0,
                        this.vertices[t].triangleStart = 0;
                    for (t = 0; t < this.triangles.length; ++t)
                        for (r = this.triangles[t],
                        i = 0; i < 3; ++i)
                            (n = r.vertices[i]).triangleCount++;
                    var a = 0;
                    for (t = 0; t < this.vertices.length; ++t)
                        this.vertices[t].triangleStart = a,
                        a += this.vertices[t].triangleCount,
                        this.vertices[t].triangleCount = 0;
                    var y = new Array(3 * this.triangles.length);
                    for (t = 0; t < this.triangles.length; ++t)
                        for (r = this.triangles[t],
                        i = 0; i < 3; ++i)
                            y[(n = r.vertices[i]).triangleStart + n.triangleCount] = new s(i,t),
                            n.triangleCount++;
                    this.references = y,
                    e && this.identifyBorder()
                }
                ,
                t.prototype.vertexError = function(e, t) {
                    var r = t.x
                      , i = t.y
                      , n = t.z;
                    return e.data[0] * r * r + 2 * e.data[1] * r * i + 2 * e.data[2] * r * n + 2 * e.data[3] * r + e.data[4] * i * i + 2 * e.data[5] * i * n + 2 * e.data[6] * i + e.data[7] * n * n + 2 * e.data[8] * n + e.data[9]
                }
                ,
                t.prototype.calculateError = function(t, r, i, n, o, a) {
                    var s = t.q.add(r.q)
                      , y = t.isBorder && r.isBorder
                      , l = 0
                      , c = s.det(0, 1, 2, 1, 4, 5, 2, 5, 7);
                    if (0 === c || y) {
                        var h = t.position.add(r.position).divide(new e.Vector3(2,2,2))
                          , u = this.vertexError(s, t.position)
                          , d = this.vertexError(s, r.position)
                          , x = this.vertexError(s, h);
                        (l = Math.min(u, d, x)) === u ? i && i.copyFrom(t.position) : l === d ? i && i.copyFrom(r.position) : i && i.copyFrom(h)
                    } else
                        i || (i = e.Vector3.Zero()),
                        i.x = -1 / c * s.det(1, 2, 3, 4, 5, 6, 5, 7, 8),
                        i.y = 1 / c * s.det(0, 2, 3, 1, 5, 6, 2, 7, 8),
                        i.z = -1 / c * s.det(0, 1, 3, 1, 4, 6, 2, 5, 8),
                        l = this.vertexError(s, i);
                    return l
                }
                ,
                t
            }()
        }(s || (s = {})),
        function(e) {
            Object.defineProperty(e.Scene.prototype, "simplificationQueue", {
                get: function() {
                    if (!this._simplificationQueue) {
                        this._simplificationQueue = new e.SimplificationQueue;
                        var r = this._getComponent(e.SceneComponentConstants.NAME_SIMPLIFICATIONQUEUE);
                        r || (r = new t(this),
                        this._addComponent(r))
                    }
                    return this._simplificationQueue
                },
                set: function(e) {
                    this._simplificationQueue = e
                },
                enumerable: !0,
                configurable: !0
            }),
            e.Mesh.prototype.simplify = function(t, r, i, n) {
                return void 0 === r && (r = !0),
                void 0 === i && (i = e.SimplificationType.QUADRATIC),
                this.getScene().simplificationQueue.addTask({
                    settings: t,
                    parallelProcessing: r,
                    mesh: this,
                    simplificationType: i,
                    successCallback: n
                }),
                this
            }
            ;
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_SIMPLIFICATIONQUEUE,
                    this.scene = t
                }
                return t.prototype.register = function() {
                    this.scene._beforeCameraUpdateStage.registerStep(e.SceneComponentConstants.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE, this, this._beforeCameraUpdate)
                }
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.dispose = function() {}
                ,
                t.prototype._beforeCameraUpdate = function() {
                    this.scene._simplificationQueue && !this.scene._simplificationQueue.running && this.scene._simplificationQueue.executeNext()
                }
                ,
                t
            }();
            e.SimplicationQueueSceneComponent = t
        }(s || (s = {})),
        function(e) {
            var t = function(e, t) {
                this.distance = e,
                this.mesh = t
            };
            e.MeshLODLevel = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function e(e) {
                    void 0 === e && (e = 0),
                    this.priority = e
                }
                return e.prototype.getDescription = function() {
                    return ""
                }
                ,
                e.prototype.apply = function(e, t) {
                    return !0
                }
                ,
                e
            }();
            e.SceneOptimization = t;
            var r = function(e) {
                function t(t, r, i) {
                    void 0 === t && (t = 0),
                    void 0 === r && (r = 1024),
                    void 0 === i && (i = .5);
                    var n = e.call(this, t) || this;
                    return n.priority = t,
                    n.maximumSize = r,
                    n.step = i,
                    n
                }
                return o(t, e),
                t.prototype.getDescription = function() {
                    return "Reducing render target texture size to " + this.maximumSize
                }
                ,
                t.prototype.apply = function(e, t) {
                    for (var r = !0, i = 0; i < e.textures.length; i++) {
                        var n = e.textures[i];
                        if (n.canRescale && !n.getContext) {
                            var o = n.getSize();
                            Math.max(o.width, o.height) > this.maximumSize && (n.scale(this.step),
                            r = !1)
                        }
                    }
                    return r
                }
                ,
                t
            }(t);
            e.TextureOptimization = r;
            var i = function(e) {
                function t(t, r, i) {
                    void 0 === t && (t = 0),
                    void 0 === r && (r = 2),
                    void 0 === i && (i = .25);
                    var n = e.call(this, t) || this;
                    return n.priority = t,
                    n.maximumScale = r,
                    n.step = i,
                    n._currentScale = -1,
                    n._directionOffset = 1,
                    n
                }
                return o(t, e),
                t.prototype.getDescription = function() {
                    return "Setting hardware scaling level to " + this._currentScale
                }
                ,
                t.prototype.apply = function(e, t) {
                    return -1 === this._currentScale && (this._currentScale = e.getEngine().getHardwareScalingLevel(),
                    this._currentScale > this.maximumScale && (this._directionOffset = -1)),
                    this._currentScale += this._directionOffset * this.step,
                    e.getEngine().setHardwareScalingLevel(this._currentScale),
                    1 === this._directionOffset ? this._currentScale >= this.maximumScale : this._currentScale <= this.maximumScale
                }
                ,
                t
            }(t);
            e.HardwareScalingOptimization = i;
            var n = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.getDescription = function() {
                    return "Turning shadows on/off"
                }
                ,
                t.prototype.apply = function(e, t) {
                    return e.shadowsEnabled = t.isInImprovementMode,
                    !0
                }
                ,
                t
            }(t);
            e.ShadowsOptimization = n;
            var a = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.getDescription = function() {
                    return "Turning post-processes on/off"
                }
                ,
                t.prototype.apply = function(e, t) {
                    return e.postProcessesEnabled = t.isInImprovementMode,
                    !0
                }
                ,
                t
            }(t);
            e.PostProcessesOptimization = a;
            var s = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.getDescription = function() {
                    return "Turning lens flares on/off"
                }
                ,
                t.prototype.apply = function(e, t) {
                    return e.lensFlaresEnabled = t.isInImprovementMode,
                    !0
                }
                ,
                t
            }(t);
            e.LensFlaresOptimization = s;
            var y = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.getDescription = function() {
                    return this.onGetDescription ? this.onGetDescription() : "Running user defined callback"
                }
                ,
                t.prototype.apply = function(e, t) {
                    return !this.onApply || this.onApply(e, t)
                }
                ,
                t
            }(t);
            e.CustomOptimization = y;
            var l = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.getDescription = function() {
                    return "Turning particles on/off"
                }
                ,
                t.prototype.apply = function(e, t) {
                    return e.particlesEnabled = t.isInImprovementMode,
                    !0
                }
                ,
                t
            }(t);
            e.ParticlesOptimization = l;
            var c = function(e) {
                function t() {
                    return null !== e && e.apply(this, arguments) || this
                }
                return o(t, e),
                t.prototype.getDescription = function() {
                    return "Turning render targets off"
                }
                ,
                t.prototype.apply = function(e, t) {
                    return e.renderTargetsEnabled = t.isInImprovementMode,
                    !0
                }
                ,
                t
            }(t);
            e.RenderTargetsOptimization = c;
            var h = function(t) {
                function r() {
                    var r = null !== t && t.apply(this, arguments) || this;
                    return r._canBeMerged = function(t) {
                        if (!(t instanceof e.Mesh))
                            return !1;
                        var r = t;
                        return !r.isDisposed() && (!(!r.isVisible || !r.isEnabled()) && (!(r.instances.length > 0) && (!r.skeleton && !r.hasLODLevels)))
                    }
                    ,
                    r
                }
                return o(r, t),
                Object.defineProperty(r, "UpdateSelectionTree", {
                    get: function() {
                        return r._UpdateSelectionTree
                    },
                    set: function(e) {
                        r._UpdateSelectionTree = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getDescription = function() {
                    return "Merging similar meshes together"
                }
                ,
                r.prototype.apply = function(t, i, n) {
                    for (var o = t.meshes.slice(0), a = o.length, s = 0; s < a; s++) {
                        var y = new Array
                          , l = o[s];
                        if (this._canBeMerged(l)) {
                            y.push(l);
                            for (var c = s + 1; c < a; c++) {
                                var h = o[c];
                                this._canBeMerged(h) && (h.material === l.material && h.checkCollisions === l.checkCollisions && (y.push(h),
                                a--,
                                o.splice(c, 1),
                                c--))
                            }
                            y.length < 2 || e.Mesh.MergeMeshes(y, void 0, !0)
                        }
                    }
                    var u = t;
                    return u.createOrUpdateSelectionOctree && (null != n ? n && u.createOrUpdateSelectionOctree() : r.UpdateSelectionTree && u.createOrUpdateSelectionOctree()),
                    !0
                }
                ,
                r._UpdateSelectionTree = !1,
                r
            }(t);
            e.MergeMeshesOptimization = h;
            var u = function() {
                function e(e, t) {
                    void 0 === e && (e = 60),
                    void 0 === t && (t = 2e3),
                    this.targetFrameRate = e,
                    this.trackerDuration = t,
                    this.optimizations = new Array
                }
                return e.prototype.addOptimization = function(e) {
                    return this.optimizations.push(e),
                    this
                }
                ,
                e.prototype.addCustomOptimization = function(e, t, r) {
                    void 0 === r && (r = 0);
                    var i = new y(r);
                    return i.onApply = e,
                    i.onGetDescription = t,
                    this.optimizations.push(i),
                    this
                }
                ,
                e.LowDegradationAllowed = function(t) {
                    var i = new e(t)
                      , o = 0;
                    return i.addOptimization(new h(o)),
                    i.addOptimization(new n(o)),
                    i.addOptimization(new s(o)),
                    o++,
                    i.addOptimization(new a(o)),
                    i.addOptimization(new l(o)),
                    o++,
                    i.addOptimization(new r(o,1024)),
                    i
                }
                ,
                e.ModerateDegradationAllowed = function(t) {
                    var o = new e(t)
                      , y = 0;
                    return o.addOptimization(new h(y)),
                    o.addOptimization(new n(y)),
                    o.addOptimization(new s(y)),
                    y++,
                    o.addOptimization(new a(y)),
                    o.addOptimization(new l(y)),
                    y++,
                    o.addOptimization(new r(y,512)),
                    y++,
                    o.addOptimization(new c(y)),
                    y++,
                    o.addOptimization(new i(y,2)),
                    o
                }
                ,
                e.HighDegradationAllowed = function(t) {
                    var o = new e(t)
                      , y = 0;
                    return o.addOptimization(new h(y)),
                    o.addOptimization(new n(y)),
                    o.addOptimization(new s(y)),
                    y++,
                    o.addOptimization(new a(y)),
                    o.addOptimization(new l(y)),
                    y++,
                    o.addOptimization(new r(y,256)),
                    y++,
                    o.addOptimization(new c(y)),
                    y++,
                    o.addOptimization(new i(y,4)),
                    o
                }
                ,
                e
            }();
            e.SceneOptimizerOptions = u;
            var d = function() {
                function t(t, r, i, n) {
                    void 0 === i && (i = !0),
                    void 0 === n && (n = !1);
                    var o = this;
                    if (this._isRunning = !1,
                    this._currentPriorityLevel = 0,
                    this._targetFrameRate = 60,
                    this._trackerDuration = 2e3,
                    this._currentFrameRate = 0,
                    this._improvementMode = !1,
                    this.onSuccessObservable = new e.Observable,
                    this.onNewOptimizationAppliedObservable = new e.Observable,
                    this.onFailureObservable = new e.Observable,
                    this._options = r || new u,
                    this._options.targetFrameRate && (this._targetFrameRate = this._options.targetFrameRate),
                    this._options.trackerDuration && (this._trackerDuration = this._options.trackerDuration),
                    i)
                        for (var a = 0, s = 0, y = this._options.optimizations; s < y.length; s++) {
                            y[s].priority = a++
                        }
                    this._improvementMode = n,
                    this._scene = t || e.Engine.LastCreatedScene,
                    this._sceneDisposeObserver = this._scene.onDisposeObservable.add((function() {
                        o._sceneDisposeObserver = null,
                        o.dispose()
                    }
                    ))
                }
                return Object.defineProperty(t.prototype, "isInImprovementMode", {
                    get: function() {
                        return this._improvementMode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "currentPriorityLevel", {
                    get: function() {
                        return this._currentPriorityLevel
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "currentFrameRate", {
                    get: function() {
                        return this._currentFrameRate
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "targetFrameRate", {
                    get: function() {
                        return this._targetFrameRate
                    },
                    set: function(e) {
                        this._targetFrameRate = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "trackerDuration", {
                    get: function() {
                        return this._trackerDuration
                    },
                    set: function(e) {
                        this._trackerDuration = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "optimizations", {
                    get: function() {
                        return this._options.optimizations
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.stop = function() {
                    this._isRunning = !1
                }
                ,
                t.prototype.reset = function() {
                    this._currentPriorityLevel = 0
                }
                ,
                t.prototype.start = function() {
                    var e = this;
                    this._isRunning || (this._isRunning = !0,
                    this._scene.executeWhenReady((function() {
                        setTimeout((function() {
                            e._checkCurrentState()
                        }
                        ), e._trackerDuration)
                    }
                    )))
                }
                ,
                t.prototype._checkCurrentState = function() {
                    var e = this;
                    if (this._isRunning) {
                        var t = this._scene
                          , r = this._options;
                        if (this._currentFrameRate = Math.round(t.getEngine().getFps()),
                        this._improvementMode && this._currentFrameRate <= this._targetFrameRate || !this._improvementMode && this._currentFrameRate >= this._targetFrameRate)
                            return this._isRunning = !1,
                            void this.onSuccessObservable.notifyObservers(this);
                        for (var i = !0, n = !0, o = 0; o < r.optimizations.length; o++) {
                            var a = r.optimizations[o];
                            a.priority === this._currentPriorityLevel && (n = !1,
                            i = i && a.apply(t, this),
                            this.onNewOptimizationAppliedObservable.notifyObservers(a))
                        }
                        if (n)
                            return this._isRunning = !1,
                            void this.onFailureObservable.notifyObservers(this);
                        i && this._currentPriorityLevel++,
                        t.executeWhenReady((function() {
                            setTimeout((function() {
                                e._checkCurrentState()
                            }
                            ), e._trackerDuration)
                        }
                        ))
                    }
                }
                ,
                t.prototype.dispose = function() {
                    this.stop(),
                    this.onSuccessObservable.clear(),
                    this.onFailureObservable.clear(),
                    this.onNewOptimizationAppliedObservable.clear(),
                    this._sceneDisposeObserver && this._scene.onDisposeObservable.remove(this._sceneDisposeObserver)
                }
                ,
                t.OptimizeAsync = function(e, r, i, n) {
                    var o = new t(e,r || u.ModerateDegradationAllowed(),!1);
                    return i && o.onSuccessObservable.add((function() {
                        i()
                    }
                    )),
                    n && o.onFailureObservable.add((function() {
                        n()
                    }
                    )),
                    o.start(),
                    o
                }
                ,
                t
            }();
            e.SceneOptimizer = d
        }(s || (s = {})),
        function(e) {
            e.Scene.prototype.getOutlineRenderer = function() {
                return this._outlineRenderer || (this._outlineRenderer = new t(this)),
                this._outlineRenderer
            }
            ,
            Object.defineProperty(e.AbstractMesh.prototype, "renderOutline", {
                get: function() {
                    return this._renderOutline
                },
                set: function(e) {
                    e && this.getScene().getOutlineRenderer(),
                    this._renderOutline = e
                },
                enumerable: !0,
                configurable: !0
            }),
            Object.defineProperty(e.AbstractMesh.prototype, "renderOverlay", {
                get: function() {
                    return this._renderOverlay
                },
                set: function(e) {
                    e && this.getScene().getOutlineRenderer(),
                    this._renderOverlay = e
                },
                enumerable: !0,
                configurable: !0
            });
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_OUTLINERENDERER,
                    this.zOffset = 1,
                    this.scene = t,
                    this._engine = t.getEngine(),
                    this.scene._addComponent(this)
                }
                return t.prototype.register = function() {
                    this.scene._beforeRenderingMeshStage.registerStep(e.SceneComponentConstants.STEP_BEFORERENDERINGMESH_OUTLINE, this, this._beforeRenderingMesh),
                    this.scene._afterRenderingMeshStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDERINGMESH_OUTLINE, this, this._afterRenderingMesh)
                }
                ,
                t.prototype.rebuild = function() {}
                ,
                t.prototype.dispose = function() {}
                ,
                t.prototype.render = function(t, r, i) {
                    var n = this;
                    void 0 === i && (i = !1);
                    var o = this.scene
                      , a = o.getEngine()
                      , s = a.getCaps().instancedArrays && null !== r.visibleInstances[t._id] && void 0 !== r.visibleInstances[t._id];
                    if (this.isReady(t, s)) {
                        var y = t.getRenderingMesh()
                          , l = t.getMaterial();
                        if (l && o.activeCamera) {
                            if (a.enableEffect(this._effect),
                            l.useLogarithmicDepth && this._effect.setFloat("logarithmicDepthConstant", 2 / (Math.log(o.activeCamera.maxZ + 1) / Math.LN2)),
                            this._effect.setFloat("offset", i ? 0 : y.outlineWidth),
                            this._effect.setColor4("color", i ? y.overlayColor : y.outlineColor, i ? y.overlayAlpha : l.alpha),
                            this._effect.setMatrix("viewProjection", o.getTransformMatrix()),
                            y.useBones && y.computeBonesUsingShaders && y.skeleton && this._effect.setMatrices("mBones", y.skeleton.getTransformMatrices(y)),
                            y._bind(t, this._effect, e.Material.TriangleFillMode),
                            l && l.needAlphaTesting()) {
                                var c = l.getAlphaTestTexture();
                                c && (this._effect.setTexture("diffuseSampler", c),
                                this._effect.setMatrix("diffuseMatrix", c.getTextureMatrix()))
                            }
                            a.setZOffset(-this.zOffset),
                            y._processRendering(t, this._effect, e.Material.TriangleFillMode, r, s, (function(e, t) {
                                n._effect.setMatrix("world", t)
                            }
                            )),
                            a.setZOffset(0)
                        }
                    }
                }
                ,
                t.prototype.isReady = function(t, r) {
                    var i = []
                      , n = [e.VertexBuffer.PositionKind, e.VertexBuffer.NormalKind]
                      , o = t.getMesh()
                      , a = t.getMaterial();
                    a && (a.needAlphaTesting() && (i.push("#define ALPHATEST"),
                    o.isVerticesDataPresent(e.VertexBuffer.UVKind) && (n.push(e.VertexBuffer.UVKind),
                    i.push("#define UV1")),
                    o.isVerticesDataPresent(e.VertexBuffer.UV2Kind) && (n.push(e.VertexBuffer.UV2Kind),
                    i.push("#define UV2"))),
                    a.useLogarithmicDepth && i.push("#define LOGARITHMICDEPTH")),
                    o.useBones && o.computeBonesUsingShaders ? (n.push(e.VertexBuffer.MatricesIndicesKind),
                    n.push(e.VertexBuffer.MatricesWeightsKind),
                    o.numBoneInfluencers > 4 && (n.push(e.VertexBuffer.MatricesIndicesExtraKind),
                    n.push(e.VertexBuffer.MatricesWeightsExtraKind)),
                    i.push("#define NUM_BONE_INFLUENCERS " + o.numBoneInfluencers),
                    i.push("#define BonesPerMesh " + (o.skeleton ? o.skeleton.bones.length + 1 : 0))) : i.push("#define NUM_BONE_INFLUENCERS 0"),
                    r && (i.push("#define INSTANCES"),
                    n.push("world0"),
                    n.push("world1"),
                    n.push("world2"),
                    n.push("world3"));
                    var s = i.join("\n");
                    return this._cachedDefines !== s && (this._cachedDefines = s,
                    this._effect = this.scene.getEngine().createEffect("outline", n, ["world", "mBones", "viewProjection", "diffuseMatrix", "offset", "color", "logarithmicDepthConstant"], ["diffuseSampler"], s)),
                    this._effect.isReady()
                }
                ,
                t.prototype._beforeRenderingMesh = function(e, t, r) {
                    this._savedDepthWrite = this._engine.getDepthWrite(),
                    e.renderOutline && (this._engine.setDepthWrite(!1),
                    this.render(t, r),
                    this._engine.setDepthWrite(this._savedDepthWrite))
                }
                ,
                t.prototype._afterRenderingMesh = function(t, r, i) {
                    if (t.renderOutline && this._savedDepthWrite && (this._engine.setDepthWrite(!0),
                    this._engine.setColorWrite(!1),
                    this.render(r, i),
                    this._engine.setColorWrite(!0)),
                    t.renderOverlay) {
                        var n = this._engine.getAlphaMode();
                        this._engine.setAlphaMode(e.Engine.ALPHA_COMBINE),
                        this.render(r, i, !0),
                        this._engine.setAlphaMode(n)
                    }
                }
                ,
                t
            }();
            e.OutlineRenderer = t
        }(s || (s = {})),
        function(e) {
            e.AbstractMesh.prototype.disableEdgesRendering = function() {
                return this._edgesRenderer && (this._edgesRenderer.dispose(),
                this._edgesRenderer = null),
                this
            }
            ,
            e.AbstractMesh.prototype.enableEdgesRendering = function(e, t) {
                return void 0 === e && (e = .95),
                void 0 === t && (t = !1),
                this.disableEdgesRendering(),
                this._edgesRenderer = new r(this,e,t),
                this
            }
            ,
            Object.defineProperty(e.AbstractMesh.prototype, "edgesRenderer", {
                get: function() {
                    return this._edgesRenderer
                },
                enumerable: !0,
                configurable: !0
            }),
            e.LinesMesh.prototype.enableEdgesRendering = function(t, r) {
                return void 0 === t && (t = .95),
                void 0 === r && (r = !1),
                this.disableEdgesRendering(),
                this._edgesRenderer = new e.LineEdgesRenderer(this,t,r),
                this
            }
            ;
            var t = function() {
                this.edges = new Array,
                this.edgesConnectedCount = 0
            }
              , r = function() {
                function r(e, t, r, i) {
                    void 0 === t && (t = .95),
                    void 0 === r && (r = !1),
                    void 0 === i && (i = !0);
                    var n = this;
                    this.edgesWidthScalerForOrthographic = 1e3,
                    this.edgesWidthScalerForPerspective = 50,
                    this._linesPositions = new Array,
                    this._linesNormals = new Array,
                    this._linesIndices = new Array,
                    this._buffers = {},
                    this._checkVerticesInsteadOfIndices = !1,
                    this.isEnabled = !0,
                    this._source = e,
                    this._checkVerticesInsteadOfIndices = r,
                    this._epsilon = t,
                    this._prepareRessources(),
                    i && this._generateEdgesLines(),
                    this._meshRebuildObserver = this._source.onRebuildObservable.add((function() {
                        n._rebuild()
                    }
                    )),
                    this._meshDisposeObserver = this._source.onDisposeObservable.add((function() {
                        n.dispose()
                    }
                    ))
                }
                return r.prototype._prepareRessources = function() {
                    this._lineShader || (this._lineShader = new e.ShaderMaterial("lineShader",this._source.getScene(),"line",{
                        attributes: ["position", "normal"],
                        uniforms: ["worldViewProjection", "color", "width", "aspectRatio"]
                    }),
                    this._lineShader.disableDepthWrite = !0,
                    this._lineShader.backFaceCulling = !1)
                }
                ,
                r.prototype._rebuild = function() {
                    var t = this._buffers[e.VertexBuffer.PositionKind];
                    t && t._rebuild(),
                    (t = this._buffers[e.VertexBuffer.NormalKind]) && t._rebuild();
                    var r = this._source.getScene().getEngine();
                    this._ib = r.createIndexBuffer(this._linesIndices)
                }
                ,
                r.prototype.dispose = function() {
                    this._source.onRebuildObservable.remove(this._meshRebuildObserver),
                    this._source.onDisposeObservable.remove(this._meshDisposeObserver);
                    var t = this._buffers[e.VertexBuffer.PositionKind];
                    t && (t.dispose(),
                    this._buffers[e.VertexBuffer.PositionKind] = null),
                    (t = this._buffers[e.VertexBuffer.NormalKind]) && (t.dispose(),
                    this._buffers[e.VertexBuffer.NormalKind] = null),
                    this._source.getScene().getEngine()._releaseBuffer(this._ib),
                    this._lineShader.dispose()
                }
                ,
                r.prototype._processEdgeForAdjacencies = function(e, t, r, i, n) {
                    return e === r && t === i || e === i && t === r ? 0 : e === i && t === n || e === n && t === i ? 1 : e === n && t === r || e === r && t === n ? 2 : -1
                }
                ,
                r.prototype._processEdgeForAdjacenciesWithVertices = function(e, t, r, i, n) {
                    return e.equalsWithEpsilon(r) && t.equalsWithEpsilon(i) || e.equalsWithEpsilon(i) && t.equalsWithEpsilon(r) ? 0 : e.equalsWithEpsilon(i) && t.equalsWithEpsilon(n) || e.equalsWithEpsilon(n) && t.equalsWithEpsilon(i) ? 1 : e.equalsWithEpsilon(n) && t.equalsWithEpsilon(r) || e.equalsWithEpsilon(r) && t.equalsWithEpsilon(n) ? 2 : -1
                }
                ,
                r.prototype._checkEdge = function(t, r, i, n, o) {
                    var a;
                    void 0 === r ? a = !0 : a = e.Vector3.Dot(i[t], i[r]) < this._epsilon;
                    if (a) {
                        var s = this._linesPositions.length / 3;
                        n.subtract(o).normalize(),
                        this._linesPositions.push(n.x),
                        this._linesPositions.push(n.y),
                        this._linesPositions.push(n.z),
                        this._linesPositions.push(n.x),
                        this._linesPositions.push(n.y),
                        this._linesPositions.push(n.z),
                        this._linesPositions.push(o.x),
                        this._linesPositions.push(o.y),
                        this._linesPositions.push(o.z),
                        this._linesPositions.push(o.x),
                        this._linesPositions.push(o.y),
                        this._linesPositions.push(o.z),
                        this._linesNormals.push(o.x),
                        this._linesNormals.push(o.y),
                        this._linesNormals.push(o.z),
                        this._linesNormals.push(-1),
                        this._linesNormals.push(o.x),
                        this._linesNormals.push(o.y),
                        this._linesNormals.push(o.z),
                        this._linesNormals.push(1),
                        this._linesNormals.push(n.x),
                        this._linesNormals.push(n.y),
                        this._linesNormals.push(n.z),
                        this._linesNormals.push(-1),
                        this._linesNormals.push(n.x),
                        this._linesNormals.push(n.y),
                        this._linesNormals.push(n.z),
                        this._linesNormals.push(1),
                        this._linesIndices.push(s),
                        this._linesIndices.push(s + 1),
                        this._linesIndices.push(s + 2),
                        this._linesIndices.push(s),
                        this._linesIndices.push(s + 2),
                        this._linesIndices.push(s + 3)
                    }
                }
                ,
                r.prototype._generateEdgesLines = function() {
                    var r = this._source.getVerticesData(e.VertexBuffer.PositionKind)
                      , i = this._source.getIndices();
                    if (i && r) {
                        var n, o, a = new Array, s = new Array;
                        for (n = 0; n < i.length; n += 3) {
                            o = new t;
                            var y = i[n]
                              , l = i[n + 1]
                              , c = i[n + 2];
                            o.p0 = new e.Vector3(r[3 * y],r[3 * y + 1],r[3 * y + 2]),
                            o.p1 = new e.Vector3(r[3 * l],r[3 * l + 1],r[3 * l + 2]),
                            o.p2 = new e.Vector3(r[3 * c],r[3 * c + 1],r[3 * c + 2]);
                            var h = e.Vector3.Cross(o.p1.subtract(o.p0), o.p2.subtract(o.p1));
                            h.normalize(),
                            s.push(h),
                            a.push(o)
                        }
                        for (n = 0; n < a.length; n++) {
                            o = a[n];
                            for (var u = n + 1; u < a.length; u++) {
                                var d = a[u];
                                if (3 === o.edgesConnectedCount)
                                    break;
                                if (3 !== d.edgesConnectedCount)
                                    for (var x = i[3 * u], p = i[3 * u + 1], f = i[3 * u + 2], m = 0; m < 3; m++) {
                                        var z = 0;
                                        if (void 0 === o.edges[m]) {
                                            switch (m) {
                                            case 0:
                                                z = this._checkVerticesInsteadOfIndices ? this._processEdgeForAdjacenciesWithVertices(o.p0, o.p1, d.p0, d.p1, d.p2) : this._processEdgeForAdjacencies(i[3 * n], i[3 * n + 1], x, p, f);
                                                break;
                                            case 1:
                                                z = this._checkVerticesInsteadOfIndices ? this._processEdgeForAdjacenciesWithVertices(o.p1, o.p2, d.p0, d.p1, d.p2) : this._processEdgeForAdjacencies(i[3 * n + 1], i[3 * n + 2], x, p, f);
                                                break;
                                            case 2:
                                                z = this._checkVerticesInsteadOfIndices ? this._processEdgeForAdjacenciesWithVertices(o.p2, o.p0, d.p0, d.p1, d.p2) : this._processEdgeForAdjacencies(i[3 * n + 2], i[3 * n], x, p, f)
                                            }
                                            if (-1 !== z && (o.edges[m] = u,
                                            d.edges[z] = n,
                                            o.edgesConnectedCount++,
                                            d.edgesConnectedCount++,
                                            3 === o.edgesConnectedCount))
                                                break
                                        }
                                    }
                            }
                        }
                        for (n = 0; n < a.length; n++) {
                            var _ = a[n];
                            this._checkEdge(n, _.edges[0], s, _.p0, _.p1),
                            this._checkEdge(n, _.edges[1], s, _.p1, _.p2),
                            this._checkEdge(n, _.edges[2], s, _.p2, _.p0)
                        }
                        var g = this._source.getScene().getEngine();
                        this._buffers[e.VertexBuffer.PositionKind] = new e.VertexBuffer(g,this._linesPositions,e.VertexBuffer.PositionKind,!1),
                        this._buffers[e.VertexBuffer.NormalKind] = new e.VertexBuffer(g,this._linesNormals,e.VertexBuffer.NormalKind,!1,!1,4),
                        this._ib = g.createIndexBuffer(this._linesIndices),
                        this._indicesCount = this._linesIndices.length
                    }
                }
                ,
                r.prototype.isReady = function() {
                    return this._lineShader.isReady()
                }
                ,
                r.prototype.render = function() {
                    var t = this._source.getScene();
                    if (this.isReady() && t.activeCamera) {
                        var r = t.getEngine();
                        this._lineShader._preBind(),
                        1 !== this._source.edgesColor.a ? r.setAlphaMode(e.Engine.ALPHA_COMBINE) : r.setAlphaMode(e.Engine.ALPHA_DISABLE),
                        r.bindBuffers(this._buffers, this._ib, this._lineShader.getEffect()),
                        t.resetCachedMaterial(),
                        this._lineShader.setColor4("color", this._source.edgesColor),
                        t.activeCamera.mode === e.Camera.ORTHOGRAPHIC_CAMERA ? this._lineShader.setFloat("width", this._source.edgesWidth / this.edgesWidthScalerForOrthographic) : this._lineShader.setFloat("width", this._source.edgesWidth / this.edgesWidthScalerForPerspective),
                        this._lineShader.setFloat("aspectRatio", r.getAspectRatio(t.activeCamera)),
                        this._lineShader.bind(this._source.getWorldMatrix()),
                        r.drawElementsType(e.Material.TriangleFillMode, 0, this._indicesCount),
                        this._lineShader.unbind()
                    }
                }
                ,
                r
            }();
            e.EdgesRenderer = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                this.edges = new Array,
                this.edgesConnectedCount = 0
            }
              , r = function(r) {
                function i(e, t, i) {
                    void 0 === t && (t = .95),
                    void 0 === i && (i = !1);
                    var n = r.call(this, e, t, i, !1) || this;
                    return n._generateEdgesLines(),
                    n
                }
                return o(i, r),
                i.prototype._checkEdge = function(e, t, r, i, n) {
                    var o = this._linesPositions.length / 3;
                    i.subtract(n).normalize(),
                    this._linesPositions.push(i.x),
                    this._linesPositions.push(i.y),
                    this._linesPositions.push(i.z),
                    this._linesPositions.push(i.x),
                    this._linesPositions.push(i.y),
                    this._linesPositions.push(i.z),
                    this._linesPositions.push(n.x),
                    this._linesPositions.push(n.y),
                    this._linesPositions.push(n.z),
                    this._linesPositions.push(n.x),
                    this._linesPositions.push(n.y),
                    this._linesPositions.push(n.z),
                    this._linesNormals.push(n.x),
                    this._linesNormals.push(n.y),
                    this._linesNormals.push(n.z),
                    this._linesNormals.push(-1),
                    this._linesNormals.push(n.x),
                    this._linesNormals.push(n.y),
                    this._linesNormals.push(n.z),
                    this._linesNormals.push(1),
                    this._linesNormals.push(i.x),
                    this._linesNormals.push(i.y),
                    this._linesNormals.push(i.z),
                    this._linesNormals.push(-1),
                    this._linesNormals.push(i.x),
                    this._linesNormals.push(i.y),
                    this._linesNormals.push(i.z),
                    this._linesNormals.push(1),
                    this._linesIndices.push(o),
                    this._linesIndices.push(o + 1),
                    this._linesIndices.push(o + 2),
                    this._linesIndices.push(o),
                    this._linesIndices.push(o + 2),
                    this._linesIndices.push(o + 3)
                }
                ,
                i.prototype._generateEdgesLines = function() {
                    var r = this._source.getVerticesData(e.VertexBuffer.PositionKind);
                    if (this._source.getIndices() && r) {
                        for (var i, n = new Array, o = new Array, a = 0; a < r.length / 3 - 1; a++) {
                            var s = new t;
                            s.p0 = new e.Vector3(r[3 * a],r[3 * a + 1],r[3 * a + 2]),
                            s.p1 = new e.Vector3(r[3 * (a + 1)],r[3 * (a + 1) + 1],r[3 * (a + 1) + 2]),
                            n.push(s)
                        }
                        for (i = 0; i < n.length; i++) {
                            var y = n[i];
                            this._checkEdge(i, y.edges[0], o, y.p0, y.p1)
                        }
                        var l = this._source.getScene().getEngine();
                        this._buffers[e.VertexBuffer.PositionKind] = new e.VertexBuffer(l,this._linesPositions,e.VertexBuffer.PositionKind,!1),
                        this._buffers[e.VertexBuffer.NormalKind] = new e.VertexBuffer(l,this._linesNormals,e.VertexBuffer.NormalKind,!1,!1,4),
                        this._ib = l.createIndexBuffer(this._linesIndices),
                        this._indicesCount = this._linesIndices.length
                    }
                }
                ,
                i
            }(e.EdgesRenderer);
            e.LineEdgesRenderer = r
        }(s || (s = {})),
        function(e) {
            e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_EFFECTLAYER, (function(t, r, i, n) {
                if (t.effectLayers) {
                    i.effectLayers || (i.effectLayers = new Array);
                    for (var o = 0; o < t.effectLayers.length; o++) {
                        var a = e.EffectLayer.Parse(t.effectLayers[o], r, n);
                        i.effectLayers.push(a)
                    }
                }
            }
            )),
            e.AbstractScene.prototype.removeEffectLayer = function(e) {
                var t = this.effectLayers.indexOf(e);
                return -1 !== t && this.effectLayers.splice(t, 1),
                t
            }
            ,
            e.AbstractScene.prototype.addEffectLayer = function(e) {
                this.effectLayers.push(e)
            }
            ;
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_EFFECTLAYER,
                    this._renderEffects = !1,
                    this._needStencil = !1,
                    this._previousStencilState = !1,
                    this.scene = t,
                    this._engine = t.getEngine(),
                    t.effectLayers = new Array
                }
                return t.prototype.register = function() {
                    this.scene._isReadyForMeshStage.registerStep(e.SceneComponentConstants.STEP_ISREADYFORMESH_EFFECTLAYER, this, this._isReadyForMesh),
                    this.scene._cameraDrawRenderTargetStage.registerStep(e.SceneComponentConstants.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER, this, this._renderMainTexture),
                    this.scene._beforeCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_BEFORECAMERADRAW_EFFECTLAYER, this, this._setStencil),
                    this.scene._afterRenderingGroupDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW, this, this._drawRenderingGroup),
                    this.scene._afterCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER, this, this._setStencilBack),
                    this.scene._afterCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW, this, this._drawCamera)
                }
                ,
                t.prototype.rebuild = function() {
                    for (var e = 0, t = this.scene.effectLayers; e < t.length; e++) {
                        t[e]._rebuild()
                    }
                }
                ,
                t.prototype.serialize = function(e) {
                    e.effectLayers = [];
                    for (var t = 0, r = this.scene.effectLayers; t < r.length; t++) {
                        var i = r[t];
                        i.serialize && e.effectLayers.push(i.serialize())
                    }
                }
                ,
                t.prototype.addFromContainer = function(e) {
                    var t = this;
                    e.effectLayers && e.effectLayers.forEach((function(e) {
                        t.scene.addEffectLayer(e)
                    }
                    ))
                }
                ,
                t.prototype.removeFromContainer = function(e) {
                    var t = this;
                    e.effectLayers && e.effectLayers.forEach((function(e) {
                        t.scene.removeEffectLayer(e)
                    }
                    ))
                }
                ,
                t.prototype.dispose = function() {
                    for (var e = this.scene.effectLayers; e.length; )
                        e[0].dispose()
                }
                ,
                t.prototype._isReadyForMesh = function(e, t) {
                    for (var r = 0, i = this.scene.effectLayers; r < i.length; r++) {
                        var n = i[r];
                        if (n.hasMesh(e))
                            for (var o = 0, a = e.subMeshes; o < a.length; o++) {
                                var s = a[o];
                                if (!n.isReady(s, t))
                                    return !1
                            }
                    }
                    return !0
                }
                ,
                t.prototype._renderMainTexture = function(t) {
                    this._renderEffects = !1,
                    this._needStencil = !1;
                    var r = this.scene.effectLayers;
                    if (r && r.length > 0) {
                        this._previousStencilState = this._engine.getStencilBuffer();
                        for (var i = 0, n = r; i < n.length; i++) {
                            var o = n[i];
                            if (o.shouldRender() && (!o.camera || o.camera.cameraRigMode === e.Camera.RIG_MODE_NONE && t === o.camera || o.camera.cameraRigMode !== e.Camera.RIG_MODE_NONE && o.camera._rigCameras.indexOf(t) > -1)) {
                                this._renderEffects = !0,
                                this._needStencil = this._needStencil || o.needStencil();
                                var a = o._mainTexture;
                                a._shouldRender() && (this.scene.incrementRenderId(),
                                a.render(!1, !1))
                            }
                        }
                        this.scene.incrementRenderId()
                    }
                }
                ,
                t.prototype._setStencil = function(e) {
                    this._needStencil && this._engine.setStencilBuffer(!0)
                }
                ,
                t.prototype._setStencilBack = function(e) {
                    this._needStencil && this._engine.setStencilBuffer(this._previousStencilState)
                }
                ,
                t.prototype._draw = function(e) {
                    if (this._renderEffects) {
                        this._engine.setDepthBuffer(!1);
                        for (var t = this.scene.effectLayers, r = 0; r < t.length; r++) {
                            var i = t[r];
                            i.renderingGroupId === e && i.shouldRender() && i.render()
                        }
                        this._engine.setDepthBuffer(!0)
                    }
                }
                ,
                t.prototype._drawCamera = function(e) {
                    this._renderEffects && this._draw(-1)
                }
                ,
                t.prototype._drawRenderingGroup = function(e) {
                    !this.scene._isInIntermediateRendering() && this._renderEffects && this._draw(e)
                }
                ,
                t
            }();
            e.EffectLayerSceneComponent = t
        }(s || (s = {}));
        a = this && this.__assign || function() {
            return (a = Object.assign || function(e) {
                for (var t, r = 1, i = arguments.length; r < i; r++)
                    for (var n in t = arguments[r])
                        Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]);
                return e
            }
            ).apply(this, arguments)
        }
        ;
        !function(e) {
            var t = function() {
                function t(t, r) {
                    this._vertexBuffers = {},
                    this._maxSize = 0,
                    this._mainTextureDesiredSize = {
                        width: 0,
                        height: 0
                    },
                    this._shouldRender = !0,
                    this._postProcesses = [],
                    this._textures = [],
                    this._emissiveTextureAndColor = {
                        texture: null,
                        color: new e.Color4
                    },
                    this.neutralColor = new e.Color4,
                    this.isEnabled = !0,
                    this.onDisposeObservable = new e.Observable,
                    this.onBeforeRenderMainTextureObservable = new e.Observable,
                    this.onBeforeComposeObservable = new e.Observable,
                    this.onAfterComposeObservable = new e.Observable,
                    this.onSizeChangedObservable = new e.Observable,
                    this.name = t,
                    this._scene = r || e.Engine.LastCreatedScene;
                    var i = this._scene._getComponent(e.SceneComponentConstants.NAME_EFFECTLAYER);
                    i || (i = new e.EffectLayerSceneComponent(this._scene),
                    this._scene._addComponent(i)),
                    this._engine = this._scene.getEngine(),
                    this._maxSize = this._engine.getCaps().maxTextureSize,
                    this._scene.effectLayers.push(this),
                    this._generateIndexBuffer(),
                    this._genrateVertexBuffer()
                }
                return Object.defineProperty(t.prototype, "camera", {
                    get: function() {
                        return this._effectLayerOptions.camera
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "renderingGroupId", {
                    get: function() {
                        return this._effectLayerOptions.renderingGroupId
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._init = function(t) {
                    this._effectLayerOptions = a({
                        mainTextureRatio: .5,
                        alphaBlendingMode: e.Engine.ALPHA_COMBINE,
                        camera: null,
                        renderingGroupId: -1
                    }, t),
                    this._setMainTextureSize(),
                    this._createMainTexture(),
                    this._createTextureAndPostProcesses(),
                    this._mergeEffect = this._createMergeEffect()
                }
                ,
                t.prototype._generateIndexBuffer = function() {
                    var e = [];
                    e.push(0),
                    e.push(1),
                    e.push(2),
                    e.push(0),
                    e.push(2),
                    e.push(3),
                    this._indexBuffer = this._engine.createIndexBuffer(e)
                }
                ,
                t.prototype._genrateVertexBuffer = function() {
                    var t = [];
                    t.push(1, 1),
                    t.push(-1, 1),
                    t.push(-1, -1),
                    t.push(1, -1);
                    var r = new e.VertexBuffer(this._engine,t,e.VertexBuffer.PositionKind,!1,!1,2);
                    this._vertexBuffers[e.VertexBuffer.PositionKind] = r
                }
                ,
                t.prototype._setMainTextureSize = function() {
                    this._effectLayerOptions.mainTextureFixedSize ? (this._mainTextureDesiredSize.width = this._effectLayerOptions.mainTextureFixedSize,
                    this._mainTextureDesiredSize.height = this._effectLayerOptions.mainTextureFixedSize) : (this._mainTextureDesiredSize.width = this._engine.getRenderWidth() * this._effectLayerOptions.mainTextureRatio,
                    this._mainTextureDesiredSize.height = this._engine.getRenderHeight() * this._effectLayerOptions.mainTextureRatio,
                    this._mainTextureDesiredSize.width = this._engine.needPOTTextures ? e.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.width, this._maxSize) : this._mainTextureDesiredSize.width,
                    this._mainTextureDesiredSize.height = this._engine.needPOTTextures ? e.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.height, this._maxSize) : this._mainTextureDesiredSize.height),
                    this._mainTextureDesiredSize.width = Math.floor(this._mainTextureDesiredSize.width),
                    this._mainTextureDesiredSize.height = Math.floor(this._mainTextureDesiredSize.height)
                }
                ,
                t.prototype._createMainTexture = function() {
                    var t = this;
                    this._mainTexture = new e.RenderTargetTexture("HighlightLayerMainRTT",{
                        width: this._mainTextureDesiredSize.width,
                        height: this._mainTextureDesiredSize.height
                    },this._scene,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),
                    this._mainTexture.activeCamera = this._effectLayerOptions.camera,
                    this._mainTexture.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    this._mainTexture.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    this._mainTexture.anisotropicFilteringLevel = 1,
                    this._mainTexture.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE),
                    this._mainTexture.renderParticles = !1,
                    this._mainTexture.renderList = null,
                    this._mainTexture.ignoreCameraViewport = !0,
                    this._mainTexture.customRenderFunction = function(e, r, i, n) {
                        var o;
                        t.onBeforeRenderMainTextureObservable.notifyObservers(t);
                        var a = t._scene.getEngine();
                        if (n.length) {
                            for (a.setColorWrite(!1),
                            o = 0; o < n.length; o++)
                                t._renderSubMesh(n.data[o]);
                            a.setColorWrite(!0)
                        }
                        for (o = 0; o < e.length; o++)
                            t._renderSubMesh(e.data[o]);
                        for (o = 0; o < r.length; o++)
                            t._renderSubMesh(r.data[o]);
                        for (o = 0; o < i.length; o++)
                            t._renderSubMesh(i.data[o])
                    }
                    ,
                    this._mainTexture.onClearObservable.add((function(e) {
                        e.clear(t.neutralColor, !0, !0, !0)
                    }
                    ))
                }
                ,
                t.prototype._isReady = function(t, r, i) {
                    var n = t.getMaterial();
                    if (!n)
                        return !1;
                    if (!n.isReady(t.getMesh(), r))
                        return !1;
                    var o = []
                      , a = [e.VertexBuffer.PositionKind]
                      , s = t.getMesh()
                      , y = !1
                      , l = !1;
                    if (n && n.needAlphaTesting()) {
                        var c = n.getAlphaTestTexture();
                        c && (o.push("#define ALPHATEST"),
                        s.isVerticesDataPresent(e.VertexBuffer.UV2Kind) && 1 === c.coordinatesIndex ? (o.push("#define DIFFUSEUV2"),
                        l = !0) : s.isVerticesDataPresent(e.VertexBuffer.UVKind) && (o.push("#define DIFFUSEUV1"),
                        y = !0))
                    }
                    i && (o.push("#define EMISSIVE"),
                    s.isVerticesDataPresent(e.VertexBuffer.UV2Kind) && 1 === i.coordinatesIndex ? (o.push("#define EMISSIVEUV2"),
                    l = !0) : s.isVerticesDataPresent(e.VertexBuffer.UVKind) && (o.push("#define EMISSIVEUV1"),
                    y = !0)),
                    y && (a.push(e.VertexBuffer.UVKind),
                    o.push("#define UV1")),
                    l && (a.push(e.VertexBuffer.UV2Kind),
                    o.push("#define UV2")),
                    s.useBones && s.computeBonesUsingShaders ? (a.push(e.VertexBuffer.MatricesIndicesKind),
                    a.push(e.VertexBuffer.MatricesWeightsKind),
                    s.numBoneInfluencers > 4 && (a.push(e.VertexBuffer.MatricesIndicesExtraKind),
                    a.push(e.VertexBuffer.MatricesWeightsExtraKind)),
                    o.push("#define NUM_BONE_INFLUENCERS " + s.numBoneInfluencers),
                    o.push("#define BonesPerMesh " + (s.skeleton ? s.skeleton.bones.length + 1 : 0))) : o.push("#define NUM_BONE_INFLUENCERS 0");
                    var h = s.morphTargetManager
                      , u = 0;
                    h && h.numInfluencers > 0 && (o.push("#define MORPHTARGETS"),
                    u = h.numInfluencers,
                    o.push("#define NUM_MORPH_INFLUENCERS " + u),
                    e.MaterialHelper.PrepareAttributesForMorphTargets(a, s, {
                        NUM_MORPH_INFLUENCERS: u
                    })),
                    r && (o.push("#define INSTANCES"),
                    a.push("world0"),
                    a.push("world1"),
                    a.push("world2"),
                    a.push("world3"));
                    var d = o.join("\n");
                    return this._cachedDefines !== d && (this._cachedDefines = d,
                    this._effectLayerMapGenerationEffect = this._scene.getEngine().createEffect("glowMapGeneration", a, ["world", "mBones", "viewProjection", "diffuseMatrix", "color", "emissiveMatrix", "morphTargetInfluences"], ["diffuseSampler", "emissiveSampler"], d, void 0, void 0, void 0, {
                        maxSimultaneousMorphTargets: u
                    })),
                    this._effectLayerMapGenerationEffect.isReady()
                }
                ,
                t.prototype.render = function() {
                    var e = this._mergeEffect;
                    if (e.isReady()) {
                        for (var t = 0; t < this._postProcesses.length; t++)
                            if (!this._postProcesses[t].isReady())
                                return;
                        var r = this._scene.getEngine();
                        this.onBeforeComposeObservable.notifyObservers(this),
                        r.enableEffect(e),
                        r.setState(!1),
                        r.bindBuffers(this._vertexBuffers, this._indexBuffer, e);
                        var i = r.getAlphaMode();
                        r.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),
                        this._internalRender(e),
                        r.setAlphaMode(i),
                        this.onAfterComposeObservable.notifyObservers(this);
                        var n = this._mainTexture.getSize();
                        this._setMainTextureSize(),
                        n.width === this._mainTextureDesiredSize.width && n.height === this._mainTextureDesiredSize.height || (this.onSizeChangedObservable.notifyObservers(this),
                        this._disposeTextureAndPostProcesses(),
                        this._createMainTexture(),
                        this._createTextureAndPostProcesses())
                    }
                }
                ,
                t.prototype.hasMesh = function(e) {
                    return -1 === this.renderingGroupId || e.renderingGroupId === this.renderingGroupId
                }
                ,
                t.prototype.shouldRender = function() {
                    return this.isEnabled && this._shouldRender
                }
                ,
                t.prototype._shouldRenderMesh = function(e) {
                    return !0
                }
                ,
                t.prototype._shouldRenderEmissiveTextureForMesh = function(e) {
                    return !0
                }
                ,
                t.prototype._renderSubMesh = function(t) {
                    var r = this;
                    if (this.shouldRender()) {
                        var i = t.getMaterial()
                          , n = t.getRenderingMesh()
                          , o = this._scene
                          , a = o.getEngine();
                        if (i && !i.needAlphaBlendingForMesh(n)) {
                            a.setState(i.backFaceCulling);
                            var s = n._getInstancesRenderList(t._id);
                            if (!s.mustReturn && this._shouldRenderMesh(n)) {
                                var y = a.getCaps().instancedArrays && null !== s.visibleInstances[t._id] && void 0 !== s.visibleInstances[t._id];
                                if (this._setEmissiveTextureAndColor(n, t, i),
                                this._isReady(t, y, this._emissiveTextureAndColor.texture)) {
                                    if (a.enableEffect(this._effectLayerMapGenerationEffect),
                                    n._bind(t, this._effectLayerMapGenerationEffect, e.Material.TriangleFillMode),
                                    this._effectLayerMapGenerationEffect.setMatrix("viewProjection", o.getTransformMatrix()),
                                    this._effectLayerMapGenerationEffect.setFloat4("color", this._emissiveTextureAndColor.color.r, this._emissiveTextureAndColor.color.g, this._emissiveTextureAndColor.color.b, this._emissiveTextureAndColor.color.a),
                                    i && i.needAlphaTesting()) {
                                        var l = i.getAlphaTestTexture();
                                        if (l) {
                                            this._effectLayerMapGenerationEffect.setTexture("diffuseSampler", l);
                                            var c = l.getTextureMatrix();
                                            c && this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix", c)
                                        }
                                    }
                                    this._emissiveTextureAndColor.texture && (this._effectLayerMapGenerationEffect.setTexture("emissiveSampler", this._emissiveTextureAndColor.texture),
                                    this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix", this._emissiveTextureAndColor.texture.getTextureMatrix())),
                                    n.useBones && n.computeBonesUsingShaders && n.skeleton && this._effectLayerMapGenerationEffect.setMatrices("mBones", n.skeleton.getTransformMatrices(n)),
                                    e.MaterialHelper.BindMorphTargetParameters(n, this._effectLayerMapGenerationEffect),
                                    n._processRendering(t, this._effectLayerMapGenerationEffect, e.Material.TriangleFillMode, s, y, (function(e, t) {
                                        return r._effectLayerMapGenerationEffect.setMatrix("world", t)
                                    }
                                    ))
                                } else
                                    this._mainTexture.resetRefreshCounter()
                            }
                        }
                    }
                }
                ,
                t.prototype._rebuild = function() {
                    var t = this._vertexBuffers[e.VertexBuffer.PositionKind];
                    t && t._rebuild(),
                    this._generateIndexBuffer()
                }
                ,
                t.prototype._disposeTextureAndPostProcesses = function() {
                    this._mainTexture.dispose();
                    for (var e = 0; e < this._postProcesses.length; e++)
                        this._postProcesses[e] && this._postProcesses[e].dispose();
                    this._postProcesses = [];
                    for (e = 0; e < this._textures.length; e++)
                        this._textures[e] && this._textures[e].dispose();
                    this._textures = []
                }
                ,
                t.prototype.dispose = function() {
                    var t = this._vertexBuffers[e.VertexBuffer.PositionKind];
                    t && (t.dispose(),
                    this._vertexBuffers[e.VertexBuffer.PositionKind] = null),
                    this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer),
                    this._indexBuffer = null),
                    this._disposeTextureAndPostProcesses();
                    var r = this._scene.effectLayers.indexOf(this, 0);
                    r > -1 && this._scene.effectLayers.splice(r, 1),
                    this.onDisposeObservable.notifyObservers(this),
                    this.onDisposeObservable.clear(),
                    this.onBeforeRenderMainTextureObservable.clear(),
                    this.onBeforeComposeObservable.clear(),
                    this.onAfterComposeObservable.clear(),
                    this.onSizeChangedObservable.clear()
                }
                ,
                t.prototype.getClassName = function() {
                    return "EffectLayer"
                }
                ,
                t.Parse = function(t, r, i) {
                    return e.Tools.Instantiate(t.customType).Parse(t, r, i)
                }
                ,
                n([e.serialize()], t.prototype, "name", void 0),
                n([e.serializeAsColor4()], t.prototype, "neutralColor", void 0),
                n([e.serialize()], t.prototype, "isEnabled", void 0),
                n([e.serializeAsCameraReference()], t.prototype, "camera", null),
                n([e.serialize()], t.prototype, "renderingGroupId", null),
                t
            }();
            e.EffectLayer = t
        }(s || (s = {})),
        function(e) {
            e.AbstractScene.prototype.getHighlightLayerByName = function(e) {
                for (var t = 0; t < this.effectLayers.length; t++)
                    if (this.effectLayers[t].name === e && this.effectLayers[t].getEffectName() === r.EffectName)
                        return this.effectLayers[t];
                return null
            }
            ;
            var t = function(t) {
                function r(r, i, n, o, a, s, y, l) {
                    void 0 === s && (s = e.Texture.BILINEAR_SAMPLINGMODE);
                    var c = t.call(this, r, "glowBlurPostProcess", ["screenSize", "direction", "blurWidth"], null, o, a, s, y, l) || this;
                    return c.direction = i,
                    c.kernel = n,
                    c.onApplyObservable.add((function(e) {
                        e.setFloat2("screenSize", c.width, c.height),
                        e.setVector2("direction", c.direction),
                        e.setFloat("blurWidth", c.kernel)
                    }
                    )),
                    c
                }
                return o(r, t),
                r
            }(e.PostProcess)
              , r = function(r) {
                function i(t, n, o) {
                    var s = r.call(this, t, n) || this;
                    return s.name = t,
                    s.innerGlow = !0,
                    s.outerGlow = !0,
                    s.onBeforeBlurObservable = new e.Observable,
                    s.onAfterBlurObservable = new e.Observable,
                    s._instanceGlowingMeshStencilReference = i.GlowingMeshStencilReference++,
                    s._meshes = {},
                    s._excludedMeshes = {},
                    s.neutralColor = i.NeutralColor,
                    s._engine.isStencilEnable || e.Tools.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new BABYLON.Engine(canvas, antialias, { stencil: true }"),
                    s._options = a({
                        mainTextureRatio: .5,
                        blurTextureSizeRatio: .5,
                        blurHorizontalSize: 1,
                        blurVerticalSize: 1,
                        alphaBlendingMode: e.Engine.ALPHA_COMBINE,
                        camera: null,
                        renderingGroupId: -1
                    }, o),
                    s._init({
                        alphaBlendingMode: s._options.alphaBlendingMode,
                        camera: s._options.camera,
                        mainTextureFixedSize: s._options.mainTextureFixedSize,
                        mainTextureRatio: s._options.mainTextureRatio,
                        renderingGroupId: s._options.renderingGroupId
                    }),
                    s._shouldRender = !1,
                    s
                }
                return o(i, r),
                Object.defineProperty(i.prototype, "blurHorizontalSize", {
                    get: function() {
                        return this._horizontalBlurPostprocess.kernel
                    },
                    set: function(e) {
                        this._horizontalBlurPostprocess.kernel = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "blurVerticalSize", {
                    get: function() {
                        return this._verticalBlurPostprocess.kernel
                    },
                    set: function(e) {
                        this._verticalBlurPostprocess.kernel = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.getEffectName = function() {
                    return i.EffectName
                }
                ,
                i.prototype._createMergeEffect = function() {
                    return this._engine.createEffect("glowMapMerge", [e.VertexBuffer.PositionKind], ["offset"], ["textureSampler"], this._options.isStroke ? "#define STROKE \n" : void 0)
                }
                ,
                i.prototype._createTextureAndPostProcesses = function() {
                    var r = this
                      , i = this._mainTextureDesiredSize.width * this._options.blurTextureSizeRatio
                      , n = this._mainTextureDesiredSize.height * this._options.blurTextureSizeRatio;
                    i = this._engine.needPOTTextures ? e.Tools.GetExponentOfTwo(i, this._maxSize) : i,
                    n = this._engine.needPOTTextures ? e.Tools.GetExponentOfTwo(n, this._maxSize) : n;
                    var o = 0;
                    o = this._engine.getCaps().textureHalfFloatRender ? e.Engine.TEXTURETYPE_HALF_FLOAT : e.Engine.TEXTURETYPE_UNSIGNED_INT,
                    this._blurTexture = new e.RenderTargetTexture("HighlightLayerBlurRTT",{
                        width: i,
                        height: n
                    },this._scene,!1,!0,o),
                    this._blurTexture.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    this._blurTexture.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    this._blurTexture.anisotropicFilteringLevel = 16,
                    this._blurTexture.updateSamplingMode(e.Texture.TRILINEAR_SAMPLINGMODE),
                    this._blurTexture.renderParticles = !1,
                    this._blurTexture.ignoreCameraViewport = !0,
                    this._textures = [this._blurTexture],
                    this._options.alphaBlendingMode === e.Engine.ALPHA_COMBINE ? (this._downSamplePostprocess = new e.PassPostProcess("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),
                    this._downSamplePostprocess.onApplyObservable.add((function(e) {
                        e.setTexture("textureSampler", r._mainTexture)
                    }
                    )),
                    this._horizontalBlurPostprocess = new t("HighlightLayerHBP",new e.Vector2(1,0),this._options.blurHorizontalSize,1,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),
                    this._horizontalBlurPostprocess.onApplyObservable.add((function(e) {
                        e.setFloat2("screenSize", i, n)
                    }
                    )),
                    this._verticalBlurPostprocess = new t("HighlightLayerVBP",new e.Vector2(0,1),this._options.blurVerticalSize,1,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),
                    this._verticalBlurPostprocess.onApplyObservable.add((function(e) {
                        e.setFloat2("screenSize", i, n)
                    }
                    )),
                    this._postProcesses = [this._downSamplePostprocess, this._horizontalBlurPostprocess, this._verticalBlurPostprocess]) : (this._horizontalBlurPostprocess = new e.BlurPostProcess("HighlightLayerHBP",new e.Vector2(1,0),this._options.blurHorizontalSize / 2,{
                        width: i,
                        height: n
                    },null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),
                    this._horizontalBlurPostprocess.width = i,
                    this._horizontalBlurPostprocess.height = n,
                    this._horizontalBlurPostprocess.onApplyObservable.add((function(e) {
                        e.setTexture("textureSampler", r._mainTexture)
                    }
                    )),
                    this._verticalBlurPostprocess = new e.BlurPostProcess("HighlightLayerVBP",new e.Vector2(0,1),this._options.blurVerticalSize / 2,{
                        width: i,
                        height: n
                    },null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),
                    this._postProcesses = [this._horizontalBlurPostprocess, this._verticalBlurPostprocess]),
                    this._mainTexture.onAfterUnbindObservable.add((function() {
                        r.onBeforeBlurObservable.notifyObservers(r);
                        var e = r._blurTexture.getInternalTexture();
                        e && r._scene.postProcessManager.directRender(r._postProcesses, e, !0),
                        r.onAfterBlurObservable.notifyObservers(r)
                    }
                    )),
                    this._postProcesses.map((function(e) {
                        e.autoClear = !1
                    }
                    ))
                }
                ,
                i.prototype.needStencil = function() {
                    return !0
                }
                ,
                i.prototype.isReady = function(e, t) {
                    var i = e.getMaterial()
                      , n = e.getRenderingMesh();
                    if (!i || !n || !this._meshes)
                        return !1;
                    var o = null
                      , a = this._meshes[n.uniqueId];
                    return a && a.glowEmissiveOnly && i && (o = i.emissiveTexture),
                    r.prototype._isReady.call(this, e, t, o)
                }
                ,
                i.prototype._internalRender = function(t) {
                    t.setTexture("textureSampler", this._blurTexture);
                    var r = this._engine
                      , i = r.getStencilBuffer()
                      , n = r.getStencilFunction()
                      , o = r.getStencilMask()
                      , a = r.getStencilOperationPass()
                      , s = r.getStencilOperationFail()
                      , y = r.getStencilOperationDepthFail()
                      , l = r.getStencilFunctionReference();
                    r.setStencilOperationPass(e.Engine.REPLACE),
                    r.setStencilOperationFail(e.Engine.KEEP),
                    r.setStencilOperationDepthFail(e.Engine.KEEP),
                    r.setStencilMask(0),
                    r.setStencilBuffer(!0),
                    r.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),
                    this.outerGlow && (t.setFloat("offset", 0),
                    r.setStencilFunction(e.Engine.NOTEQUAL),
                    r.drawElementsType(e.Material.TriangleFillMode, 0, 6)),
                    this.innerGlow && (t.setFloat("offset", 1),
                    r.setStencilFunction(e.Engine.EQUAL),
                    r.drawElementsType(e.Material.TriangleFillMode, 0, 6)),
                    r.setStencilFunction(n),
                    r.setStencilMask(o),
                    r.setStencilBuffer(i),
                    r.setStencilOperationPass(a),
                    r.setStencilOperationFail(s),
                    r.setStencilOperationDepthFail(y),
                    r.setStencilFunctionReference(l)
                }
                ,
                i.prototype.shouldRender = function() {
                    return !!r.prototype.shouldRender.call(this) && !!this._meshes
                }
                ,
                i.prototype._shouldRenderMesh = function(e) {
                    return (!this._excludedMeshes || !this._excludedMeshes[e.uniqueId]) && !!r.prototype.hasMesh.call(this, e)
                }
                ,
                i.prototype._setEmissiveTextureAndColor = function(e, t, r) {
                    var i = this._meshes[e.uniqueId];
                    i ? this._emissiveTextureAndColor.color.set(i.color.r, i.color.g, i.color.b, 1) : this._emissiveTextureAndColor.color.set(this.neutralColor.r, this.neutralColor.g, this.neutralColor.b, this.neutralColor.a),
                    i && i.glowEmissiveOnly && r ? (this._emissiveTextureAndColor.texture = r.emissiveTexture,
                    this._emissiveTextureAndColor.color.set(1, 1, 1, 1)) : this._emissiveTextureAndColor.texture = null
                }
                ,
                i.prototype.addExcludedMesh = function(e) {
                    this._excludedMeshes && (this._excludedMeshes[e.uniqueId] || (this._excludedMeshes[e.uniqueId] = {
                        mesh: e,
                        beforeRender: e.onBeforeRenderObservable.add((function(e) {
                            e.getEngine().setStencilBuffer(!1)
                        }
                        )),
                        afterRender: e.onAfterRenderObservable.add((function(e) {
                            e.getEngine().setStencilBuffer(!0)
                        }
                        ))
                    }))
                }
                ,
                i.prototype.removeExcludedMesh = function(e) {
                    if (this._excludedMeshes) {
                        var t = this._excludedMeshes[e.uniqueId];
                        t && (t.beforeRender && e.onBeforeRenderObservable.remove(t.beforeRender),
                        t.afterRender && e.onAfterRenderObservable.remove(t.afterRender)),
                        this._excludedMeshes[e.uniqueId] = null
                    }
                }
                ,
                i.prototype.hasMesh = function(e) {
                    return !!this._meshes && (!!r.prototype.hasMesh.call(this, e) && (void 0 !== this._meshes[e.uniqueId] && null !== this._meshes[e.uniqueId]))
                }
                ,
                i.prototype.addMesh = function(e, t, r) {
                    var i = this;
                    if (void 0 === r && (r = !1),
                    this._meshes) {
                        var n = this._meshes[e.uniqueId];
                        n ? n.color = t : (this._meshes[e.uniqueId] = {
                            mesh: e,
                            color: t,
                            observerHighlight: e.onBeforeRenderObservable.add((function(e) {
                                i._excludedMeshes && i._excludedMeshes[e.uniqueId] ? i._defaultStencilReference(e) : e.getScene().getEngine().setStencilFunctionReference(i._instanceGlowingMeshStencilReference)
                            }
                            )),
                            observerDefault: e.onAfterRenderObservable.add(this._defaultStencilReference),
                            glowEmissiveOnly: r
                        },
                        e.onDisposeObservable.add((function() {
                            i._disposeMesh(e)
                        }
                        ))),
                        this._shouldRender = !0
                    }
                }
                ,
                i.prototype.removeMesh = function(e) {
                    if (this._meshes) {
                        var t = this._meshes[e.uniqueId];
                        for (var r in t && (t.observerHighlight && e.onBeforeRenderObservable.remove(t.observerHighlight),
                        t.observerDefault && e.onAfterRenderObservable.remove(t.observerDefault),
                        delete this._meshes[e.uniqueId]),
                        this._shouldRender = !1,
                        this._meshes)
                            if (this._meshes[r]) {
                                this._shouldRender = !0;
                                break
                            }
                    }
                }
                ,
                i.prototype._defaultStencilReference = function(e) {
                    e.getScene().getEngine().setStencilFunctionReference(i.NormalMeshStencilReference)
                }
                ,
                i.prototype._disposeMesh = function(e) {
                    this.removeMesh(e),
                    this.removeExcludedMesh(e)
                }
                ,
                i.prototype.dispose = function() {
                    if (this._meshes) {
                        for (var e in this._meshes) {
                            (t = this._meshes[e]) && t.mesh && (t.observerHighlight && t.mesh.onBeforeRenderObservable.remove(t.observerHighlight),
                            t.observerDefault && t.mesh.onAfterRenderObservable.remove(t.observerDefault))
                        }
                        this._meshes = null
                    }
                    if (this._excludedMeshes) {
                        for (var e in this._excludedMeshes) {
                            var t;
                            (t = this._excludedMeshes[e]) && (t.beforeRender && t.mesh.onBeforeRenderObservable.remove(t.beforeRender),
                            t.afterRender && t.mesh.onAfterRenderObservable.remove(t.afterRender))
                        }
                        this._excludedMeshes = null
                    }
                    r.prototype.dispose.call(this)
                }
                ,
                i.prototype.getClassName = function() {
                    return "HighlightLayer"
                }
                ,
                i.prototype.serialize = function() {
                    var t = e.SerializationHelper.Serialize(this);
                    if (t.customType = "BABYLON.HighlightLayer",
                    t.meshes = [],
                    this._meshes)
                        for (var r in this._meshes) {
                            var i = this._meshes[r];
                            i && t.meshes.push({
                                glowEmissiveOnly: i.glowEmissiveOnly,
                                color: i.color.asArray(),
                                meshId: i.mesh.id
                            })
                        }
                    if (t.excludedMeshes = [],
                    this._excludedMeshes)
                        for (var n in this._excludedMeshes) {
                            var o = this._excludedMeshes[n];
                            o && t.excludedMeshes.push(o.mesh.id)
                        }
                    return t
                }
                ,
                i.Parse = function(t, r, n) {
                    var o, a = e.SerializationHelper.Parse((function() {
                        return new i(t.name,r,t.options)
                    }
                    ), t, r, n);
                    for (o = 0; o < t.excludedMeshes.length; o++) {
                        (s = r.getMeshByID(t.excludedMeshes[o])) && a.addExcludedMesh(s)
                    }
                    for (o = 0; o < t.meshes.length; o++) {
                        var s, y = t.meshes[o];
                        (s = r.getMeshByID(y.meshId)) && a.addMesh(s, e.Color3.FromArray(y.color), y.glowEmissiveOnly)
                    }
                    return a
                }
                ,
                i.EffectName = "HighlightLayer",
                i.NeutralColor = new e.Color4(0,0,0,0),
                i.GlowingMeshStencilReference = 2,
                i.NormalMeshStencilReference = 1,
                n([e.serialize()], i.prototype, "innerGlow", void 0),
                n([e.serialize()], i.prototype, "outerGlow", void 0),
                n([e.serialize()], i.prototype, "blurHorizontalSize", null),
                n([e.serialize()], i.prototype, "blurVerticalSize", null),
                n([e.serialize("options")], i.prototype, "_options", void 0),
                i
            }(e.EffectLayer);
            e.HighlightLayer = r
        }(s || (s = {})),
        function(e) {
            e.AbstractScene.prototype.getGlowLayerByName = function(e) {
                for (var r = 0; r < this.effectLayers.length; r++)
                    if (this.effectLayers[r].name === e && this.effectLayers[r].getEffectName() === t.EffectName)
                        return this.effectLayers[r];
                return null
            }
            ;
            var t = function(t) {
                function r(i, n, o) {
                    var s = t.call(this, i, n) || this;
                    return s._intensity = 1,
                    s._includedOnlyMeshes = [],
                    s._excludedMeshes = [],
                    s.neutralColor = new e.Color4(0,0,0,1),
                    s._options = a({
                        mainTextureRatio: r.DefaultTextureRatio,
                        blurKernelSize: 32,
                        mainTextureFixedSize: void 0,
                        camera: null,
                        mainTextureSamples: 1,
                        renderingGroupId: -1
                    }, o),
                    s._init({
                        alphaBlendingMode: e.Engine.ALPHA_ADD,
                        camera: s._options.camera,
                        mainTextureFixedSize: s._options.mainTextureFixedSize,
                        mainTextureRatio: s._options.mainTextureRatio,
                        renderingGroupId: s._options.renderingGroupId
                    }),
                    s
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "blurKernelSize", {
                    get: function() {
                        return this._horizontalBlurPostprocess1.kernel
                    },
                    set: function(e) {
                        this._horizontalBlurPostprocess1.kernel = e,
                        this._verticalBlurPostprocess1.kernel = e,
                        this._horizontalBlurPostprocess2.kernel = e,
                        this._verticalBlurPostprocess2.kernel = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "intensity", {
                    get: function() {
                        return this._intensity
                    },
                    set: function(e) {
                        this._intensity = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.getEffectName = function() {
                    return r.EffectName
                }
                ,
                r.prototype._createMergeEffect = function() {
                    return this._engine.createEffect("glowMapMerge", [e.VertexBuffer.PositionKind], ["offset"], ["textureSampler", "textureSampler2"], "#define EMISSIVE \n")
                }
                ,
                r.prototype._createTextureAndPostProcesses = function() {
                    var t = this
                      , r = this._mainTextureDesiredSize.width
                      , i = this._mainTextureDesiredSize.height;
                    r = this._engine.needPOTTextures ? e.Tools.GetExponentOfTwo(r, this._maxSize) : r,
                    i = this._engine.needPOTTextures ? e.Tools.GetExponentOfTwo(i, this._maxSize) : i;
                    var n = 0;
                    n = this._engine.getCaps().textureHalfFloatRender ? e.Engine.TEXTURETYPE_HALF_FLOAT : e.Engine.TEXTURETYPE_UNSIGNED_INT,
                    this._blurTexture1 = new e.RenderTargetTexture("GlowLayerBlurRTT",{
                        width: r,
                        height: i
                    },this._scene,!1,!0,n),
                    this._blurTexture1.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    this._blurTexture1.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    this._blurTexture1.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE),
                    this._blurTexture1.renderParticles = !1,
                    this._blurTexture1.ignoreCameraViewport = !0;
                    var o = Math.floor(r / 2)
                      , a = Math.floor(i / 2);
                    this._blurTexture2 = new e.RenderTargetTexture("GlowLayerBlurRTT2",{
                        width: o,
                        height: a
                    },this._scene,!1,!0,n),
                    this._blurTexture2.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    this._blurTexture2.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    this._blurTexture2.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE),
                    this._blurTexture2.renderParticles = !1,
                    this._blurTexture2.ignoreCameraViewport = !0,
                    this._textures = [this._blurTexture1, this._blurTexture2],
                    this._horizontalBlurPostprocess1 = new e.BlurPostProcess("GlowLayerHBP1",new e.Vector2(1,0),this._options.blurKernelSize / 2,{
                        width: r,
                        height: i
                    },null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,n),
                    this._horizontalBlurPostprocess1.width = r,
                    this._horizontalBlurPostprocess1.height = i,
                    this._horizontalBlurPostprocess1.onApplyObservable.add((function(e) {
                        e.setTexture("textureSampler", t._mainTexture)
                    }
                    )),
                    this._verticalBlurPostprocess1 = new e.BlurPostProcess("GlowLayerVBP1",new e.Vector2(0,1),this._options.blurKernelSize / 2,{
                        width: r,
                        height: i
                    },null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,n),
                    this._horizontalBlurPostprocess2 = new e.BlurPostProcess("GlowLayerHBP2",new e.Vector2(1,0),this._options.blurKernelSize / 2,{
                        width: o,
                        height: a
                    },null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,n),
                    this._horizontalBlurPostprocess2.width = o,
                    this._horizontalBlurPostprocess2.height = a,
                    this._horizontalBlurPostprocess2.onApplyObservable.add((function(e) {
                        e.setTexture("textureSampler", t._blurTexture1)
                    }
                    )),
                    this._verticalBlurPostprocess2 = new e.BlurPostProcess("GlowLayerVBP2",new e.Vector2(0,1),this._options.blurKernelSize / 2,{
                        width: o,
                        height: a
                    },null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,n),
                    this._postProcesses = [this._horizontalBlurPostprocess1, this._verticalBlurPostprocess1, this._horizontalBlurPostprocess2, this._verticalBlurPostprocess2],
                    this._postProcesses1 = [this._horizontalBlurPostprocess1, this._verticalBlurPostprocess1],
                    this._postProcesses2 = [this._horizontalBlurPostprocess2, this._verticalBlurPostprocess2],
                    this._mainTexture.samples = this._options.mainTextureSamples,
                    this._mainTexture.onAfterUnbindObservable.add((function() {
                        var e = t._blurTexture1.getInternalTexture();
                        e && (t._scene.postProcessManager.directRender(t._postProcesses1, e, !0),
                        (e = t._blurTexture2.getInternalTexture()) && t._scene.postProcessManager.directRender(t._postProcesses2, e, !0))
                    }
                    )),
                    this._postProcesses.map((function(e) {
                        e.autoClear = !1
                    }
                    ))
                }
                ,
                r.prototype.isReady = function(e, r) {
                    var i = e.getMaterial()
                      , n = e.getRenderingMesh();
                    if (!i || !n)
                        return !1;
                    var o = i.emissiveTexture;
                    return t.prototype._isReady.call(this, e, r, o)
                }
                ,
                r.prototype.needStencil = function() {
                    return !1
                }
                ,
                r.prototype._internalRender = function(t) {
                    t.setTexture("textureSampler", this._blurTexture1),
                    t.setTexture("textureSampler2", this._blurTexture2),
                    t.setFloat("offset", this._intensity);
                    var r = this._engine
                      , i = r.getStencilBuffer();
                    r.setStencilBuffer(!1),
                    r.drawElementsType(e.Material.TriangleFillMode, 0, 6),
                    r.setStencilBuffer(i)
                }
                ,
                r.prototype._setEmissiveTextureAndColor = function(e, t, r) {
                    var i = 1;
                    this.customEmissiveTextureSelector ? this._emissiveTextureAndColor.texture = this.customEmissiveTextureSelector(e, t, r) : r ? (this._emissiveTextureAndColor.texture = r.emissiveTexture,
                    this._emissiveTextureAndColor.texture && (i = this._emissiveTextureAndColor.texture.level)) : this._emissiveTextureAndColor.texture = null,
                    this.customEmissiveColorSelector ? this.customEmissiveColorSelector(e, t, r, this._emissiveTextureAndColor.color) : r.emissiveColor ? this._emissiveTextureAndColor.color.set(r.emissiveColor.r * i, r.emissiveColor.g * i, r.emissiveColor.b * i, 1) : this._emissiveTextureAndColor.color.set(this.neutralColor.r, this.neutralColor.g, this.neutralColor.b, this.neutralColor.a)
                }
                ,
                r.prototype._shouldRenderMesh = function(e) {
                    return this.hasMesh(e)
                }
                ,
                r.prototype.addExcludedMesh = function(e) {
                    -1 === this._excludedMeshes.indexOf(e.uniqueId) && this._excludedMeshes.push(e.uniqueId)
                }
                ,
                r.prototype.removeExcludedMesh = function(e) {
                    var t = this._excludedMeshes.indexOf(e.uniqueId);
                    -1 !== t && this._excludedMeshes.splice(t, 1)
                }
                ,
                r.prototype.addIncludedOnlyMesh = function(e) {
                    -1 === this._includedOnlyMeshes.indexOf(e.uniqueId) && this._includedOnlyMeshes.push(e.uniqueId)
                }
                ,
                r.prototype.removeIncludedOnlyMesh = function(e) {
                    var t = this._includedOnlyMeshes.indexOf(e.uniqueId);
                    -1 !== t && this._includedOnlyMeshes.splice(t, 1)
                }
                ,
                r.prototype.hasMesh = function(e) {
                    return !!t.prototype.hasMesh.call(this, e) && (this._includedOnlyMeshes.length ? -1 !== this._includedOnlyMeshes.indexOf(e.uniqueId) : !this._excludedMeshes.length || -1 === this._excludedMeshes.indexOf(e.uniqueId))
                }
                ,
                r.prototype._disposeMesh = function(e) {
                    this.removeIncludedOnlyMesh(e),
                    this.removeExcludedMesh(e)
                }
                ,
                r.prototype.getClassName = function() {
                    return "GlowLayer"
                }
                ,
                r.prototype.serialize = function() {
                    var t, r = e.SerializationHelper.Serialize(this);
                    if (r.customType = "BABYLON.GlowLayer",
                    r.includedMeshes = [],
                    this._includedOnlyMeshes.length)
                        for (t = 0; t < this._includedOnlyMeshes.length; t++) {
                            (i = this._scene.getMeshByUniqueID(this._includedOnlyMeshes[t])) && r.includedMeshes.push(i.id)
                        }
                    if (r.excludedMeshes = [],
                    this._excludedMeshes.length)
                        for (t = 0; t < this._excludedMeshes.length; t++) {
                            var i;
                            (i = this._scene.getMeshByUniqueID(this._excludedMeshes[t])) && r.excludedMeshes.push(i.id)
                        }
                    return r
                }
                ,
                r.Parse = function(t, i, n) {
                    var o, a = e.SerializationHelper.Parse((function() {
                        return new r(t.name,i,t.options)
                    }
                    ), t, i, n);
                    for (o = 0; o < t.excludedMeshes.length; o++) {
                        (s = i.getMeshByID(t.excludedMeshes[o])) && a.addExcludedMesh(s)
                    }
                    for (o = 0; o < t.includedMeshes.length; o++) {
                        var s;
                        (s = i.getMeshByID(t.includedMeshes[o])) && a.addIncludedOnlyMesh(s)
                    }
                    return a
                }
                ,
                r.EffectName = "GlowLayer",
                r.DefaultBlurKernelSize = 32,
                r.DefaultTextureRatio = .5,
                n([e.serialize()], r.prototype, "blurKernelSize", null),
                n([e.serialize()], r.prototype, "intensity", null),
                n([e.serialize("options")], r.prototype, "_options", void 0),
                r
            }(e.EffectLayer);
            e.GlowLayer = t
        }(s || (s = {})),
        function(e) {
            var t;
            !function(e) {
                e[e.INIT = 0] = "INIT",
                e[e.RUNNING = 1] = "RUNNING",
                e[e.DONE = 2] = "DONE",
                e[e.ERROR = 3] = "ERROR"
            }(t = e.AssetTaskState || (e.AssetTaskState = {}));
            var r = function() {
                function e(e) {
                    this.name = e,
                    this._isCompleted = !1,
                    this._taskState = t.INIT
                }
                return Object.defineProperty(e.prototype, "isCompleted", {
                    get: function() {
                        return this._isCompleted
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "taskState", {
                    get: function() {
                        return this._taskState
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(e.prototype, "errorObject", {
                    get: function() {
                        return this._errorObject
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                e.prototype._setErrorObject = function(e, t) {
                    this._errorObject || (this._errorObject = {
                        message: e,
                        exception: t
                    })
                }
                ,
                e.prototype.run = function(e, r, i) {
                    var n = this;
                    this._taskState = t.RUNNING,
                    this.runTask(e, (function() {
                        n.onDoneCallback(r, i)
                    }
                    ), (function(e, t) {
                        n.onErrorCallback(i, e, t)
                    }
                    ))
                }
                ,
                e.prototype.runTask = function(e, t, r) {
                    throw new Error("runTask is not implemented")
                }
                ,
                e.prototype.reset = function() {
                    this._taskState = t.INIT
                }
                ,
                e.prototype.onErrorCallback = function(e, r, i) {
                    this._taskState = t.ERROR,
                    this._errorObject = {
                        message: r,
                        exception: i
                    },
                    this.onError && this.onError(this, r, i),
                    e()
                }
                ,
                e.prototype.onDoneCallback = function(e, r) {
                    try {
                        this._taskState = t.DONE,
                        this._isCompleted = !0,
                        this.onSuccess && this.onSuccess(this),
                        e()
                    } catch (e) {
                        this.onErrorCallback(r, "Task is done, error executing success callback(s)", e)
                    }
                }
                ,
                e
            }();
            e.AbstractAssetTask = r;
            var i = function(e, t, r) {
                this.remainingCount = e,
                this.totalCount = t,
                this.task = r
            };
            e.AssetsProgressEvent = i;
            var n = function(t) {
                function r(e, r, i, n) {
                    var o = t.call(this, e) || this;
                    return o.name = e,
                    o.meshesNames = r,
                    o.rootUrl = i,
                    o.sceneFilename = n,
                    o
                }
                return o(r, t),
                r.prototype.runTask = function(t, r, i) {
                    var n = this;
                    e.SceneLoader.ImportMesh(this.meshesNames, this.rootUrl, this.sceneFilename, t, (function(e, t, i) {
                        n.loadedMeshes = e,
                        n.loadedParticleSystems = t,
                        n.loadedSkeletons = i,
                        r()
                    }
                    ), null, (function(e, t, r) {
                        i(t, r)
                    }
                    ))
                }
                ,
                r
            }(r);
            e.MeshAssetTask = n;
            var a = function(e) {
                function t(t, r) {
                    var i = e.call(this, t) || this;
                    return i.name = t,
                    i.url = r,
                    i
                }
                return o(t, e),
                t.prototype.runTask = function(e, t, r) {
                    var i = this;
                    e._loadFile(this.url, (function(e) {
                        i.text = e,
                        t()
                    }
                    ), void 0, !1, !1, (function(e, t) {
                        e && r(e.status + " " + e.statusText, t)
                    }
                    ))
                }
                ,
                t
            }(r);
            e.TextFileAssetTask = a;
            var s = function(e) {
                function t(t, r) {
                    var i = e.call(this, t) || this;
                    return i.name = t,
                    i.url = r,
                    i
                }
                return o(t, e),
                t.prototype.runTask = function(e, t, r) {
                    var i = this;
                    e._loadFile(this.url, (function(e) {
                        i.data = e,
                        t()
                    }
                    ), void 0, !0, !0, (function(e, t) {
                        e && r(e.status + " " + e.statusText, t)
                    }
                    ))
                }
                ,
                t
            }(r);
            e.BinaryFileAssetTask = s;
            var y = function(t) {
                function r(e, r) {
                    var i = t.call(this, e) || this;
                    return i.name = e,
                    i.url = r,
                    i
                }
                return o(r, t),
                r.prototype.runTask = function(t, r, i) {
                    var n = this
                      , o = new Image;
                    e.Tools.SetCorsBehavior(this.url, o),
                    o.onload = function() {
                        n.image = o,
                        r()
                    }
                    ,
                    o.onerror = function(e) {
                        i("Error loading image", e)
                    }
                    ,
                    o.src = this.url
                }
                ,
                r
            }(r);
            e.ImageAssetTask = y;
            var l = function(t) {
                function r(r, i, n, o, a) {
                    void 0 === a && (a = e.Texture.TRILINEAR_SAMPLINGMODE);
                    var s = t.call(this, r) || this;
                    return s.name = r,
                    s.url = i,
                    s.noMipmap = n,
                    s.invertY = o,
                    s.samplingMode = a,
                    s
                }
                return o(r, t),
                r.prototype.runTask = function(t, r, i) {
                    this.texture = new e.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,(function() {
                        r()
                    }
                    ),(function(e, t) {
                        i(e, t)
                    }
                    ))
                }
                ,
                r
            }(r);
            e.TextureAssetTask = l;
            var c = function(t) {
                function r(e, r, i, n, o) {
                    var a = t.call(this, e) || this;
                    return a.name = e,
                    a.url = r,
                    a.extensions = i,
                    a.noMipmap = n,
                    a.files = o,
                    a
                }
                return o(r, t),
                r.prototype.runTask = function(t, r, i) {
                    this.texture = new e.CubeTexture(this.url,t,this.extensions,this.noMipmap,this.files,(function() {
                        r()
                    }
                    ),(function(e, t) {
                        i(e, t)
                    }
                    ))
                }
                ,
                r
            }(r);
            e.CubeTextureAssetTask = c;
            var h = function(t) {
                function r(e, r, i, n, o, a, s) {
                    void 0 === n && (n = !1),
                    void 0 === o && (o = !0),
                    void 0 === a && (a = !1),
                    void 0 === s && (s = !1);
                    var y = t.call(this, e) || this;
                    return y.name = e,
                    y.url = r,
                    y.size = i,
                    y.noMipmap = n,
                    y.generateHarmonics = o,
                    y.gammaSpace = a,
                    y.reserved = s,
                    y
                }
                return o(r, t),
                r.prototype.run = function(t, r, i) {
                    this.texture = new e.HDRCubeTexture(this.url,t,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,(function() {
                        r()
                    }
                    ),(function(e, t) {
                        i(e, t)
                    }
                    ))
                }
                ,
                r
            }(r);
            e.HDRCubeTextureAssetTask = h;
            var u = function() {
                function r(t) {
                    this._isLoading = !1,
                    this._tasks = new Array,
                    this._waitingTasksCount = 0,
                    this._totalTasksCount = 0,
                    this.onTaskSuccessObservable = new e.Observable,
                    this.onTaskErrorObservable = new e.Observable,
                    this.onTasksDoneObservable = new e.Observable,
                    this.onProgressObservable = new e.Observable,
                    this.useDefaultLoadingScreen = !0,
                    this._scene = t
                }
                return r.prototype.addMeshTask = function(e, t, r, i) {
                    var o = new n(e,t,r,i);
                    return this._tasks.push(o),
                    o
                }
                ,
                r.prototype.addTextFileTask = function(e, t) {
                    var r = new a(e,t);
                    return this._tasks.push(r),
                    r
                }
                ,
                r.prototype.addBinaryFileTask = function(e, t) {
                    var r = new s(e,t);
                    return this._tasks.push(r),
                    r
                }
                ,
                r.prototype.addImageTask = function(e, t) {
                    var r = new y(e,t);
                    return this._tasks.push(r),
                    r
                }
                ,
                r.prototype.addTextureTask = function(t, r, i, n, o) {
                    void 0 === o && (o = e.Texture.TRILINEAR_SAMPLINGMODE);
                    var a = new l(t,r,i,n,o);
                    return this._tasks.push(a),
                    a
                }
                ,
                r.prototype.addCubeTextureTask = function(e, t, r, i, n) {
                    var o = new c(e,t,r,i,n);
                    return this._tasks.push(o),
                    o
                }
                ,
                r.prototype.addHDRCubeTextureTask = function(e, t, r, i, n, o, a) {
                    void 0 === i && (i = !1),
                    void 0 === n && (n = !0),
                    void 0 === o && (o = !1),
                    void 0 === a && (a = !1);
                    var s = new h(e,t,r,i,n,o,a);
                    return this._tasks.push(s),
                    s
                }
                ,
                r.prototype.removeTask = function(e) {
                    var t = this._tasks.indexOf(e);
                    t > -1 && this._tasks.splice(t, 1)
                }
                ,
                r.prototype._decreaseWaitingTasksCount = function(r) {
                    this._waitingTasksCount--;
                    try {
                        this.onProgress && this.onProgress(this._waitingTasksCount, this._totalTasksCount, r),
                        this.onProgressObservable.notifyObservers(new i(this._waitingTasksCount,this._totalTasksCount,r))
                    } catch (t) {
                        e.Tools.Error("Error running progress callbacks."),
                        console.log(t)
                    }
                    if (0 === this._waitingTasksCount) {
                        try {
                            this.onFinish && this.onFinish(this._tasks);
                            for (var n = this._tasks.slice(), o = 0, a = n; o < a.length; o++) {
                                if ((r = a[o]).taskState === t.DONE) {
                                    var s = this._tasks.indexOf(r);
                                    s > -1 && this._tasks.splice(s, 1)
                                }
                            }
                            this.onTasksDoneObservable.notifyObservers(this._tasks)
                        } catch (t) {
                            e.Tools.Error("Error running tasks-done callbacks."),
                            console.log(t)
                        }
                        this._isLoading = !1,
                        this._scene.getEngine().hideLoadingUI()
                    }
                }
                ,
                r.prototype._runTask = function(e) {
                    var t = this
                      , r = function(r, i) {
                        e._setErrorObject(r, i),
                        t.onTaskError && t.onTaskError(e),
                        t.onTaskErrorObservable.notifyObservers(e),
                        t._decreaseWaitingTasksCount(e)
                    };
                    e.run(this._scene, (function() {
                        try {
                            t.onTaskSuccess && t.onTaskSuccess(e),
                            t.onTaskSuccessObservable.notifyObservers(e),
                            t._decreaseWaitingTasksCount(e)
                        } catch (e) {
                            r("Error executing task success callbacks", e)
                        }
                    }
                    ), r)
                }
                ,
                r.prototype.reset = function() {
                    return this._isLoading = !1,
                    this._tasks = new Array,
                    this
                }
                ,
                r.prototype.load = function() {
                    if (this._isLoading)
                        return this;
                    if (this._isLoading = !0,
                    this._waitingTasksCount = this._tasks.length,
                    this._totalTasksCount = this._tasks.length,
                    0 === this._waitingTasksCount)
                        return this._isLoading = !1,
                        this.onFinish && this.onFinish(this._tasks),
                        this.onTasksDoneObservable.notifyObservers(this._tasks),
                        this;
                    this.useDefaultLoadingScreen && this._scene.getEngine().displayLoadingUI();
                    for (var e = 0; e < this._tasks.length; e++) {
                        var r = this._tasks[e];
                        r.taskState === t.INIT && this._runTask(r)
                    }
                    return this
                }
                ,
                r
            }();
            e.AssetsManager = u
        }(s || (s = {})),
        function(e) {
            var t = []
              , r = function(r, i) {
                if (!t[r.id] && !r.doNotSerialize) {
                    if (r instanceof e.BoxGeometry)
                        i.boxes.push(r.serialize());
                    else if (r instanceof e.SphereGeometry)
                        i.spheres.push(r.serialize());
                    else if (r instanceof e.CylinderGeometry)
                        i.cylinders.push(r.serialize());
                    else if (r instanceof e.TorusGeometry)
                        i.toruses.push(r.serialize());
                    else if (r instanceof e.GroundGeometry)
                        i.grounds.push(r.serialize());
                    else if (r instanceof e.Plane)
                        i.planes.push(r.serialize());
                    else if (r instanceof e.TorusKnotGeometry)
                        i.torusKnots.push(r.serialize());
                    else {
                        if (r instanceof e._PrimitiveGeometry)
                            throw new Error("Unknown primitive type");
                        i.vertexData.push(r.serializeVerticeData())
                    }
                    t[r.id] = !0
                }
            }
              , i = function(e, t) {
                var i = {}
                  , n = e._geometry;
                return n && (e.getScene().getGeometryByID(n.id) || r(n, t.geometries)),
                e.serialize && e.serialize(i),
                i
            }
              , n = function() {
                function n() {}
                return n.ClearCache = function() {
                    t = []
                }
                ,
                n.Serialize = function(o) {
                    var a, s, y, l = {};
                    if (n.ClearCache(),
                    l.useDelayedTextureLoading = o.useDelayedTextureLoading,
                    l.autoClear = o.autoClear,
                    l.clearColor = o.clearColor.asArray(),
                    l.ambientColor = o.ambientColor.asArray(),
                    l.gravity = o.gravity.asArray(),
                    l.collisionsEnabled = o.collisionsEnabled,
                    l.workerCollisions = o.workerCollisions,
                    o.fogMode && 0 !== o.fogMode && (l.fogMode = o.fogMode,
                    l.fogColor = o.fogColor.asArray(),
                    l.fogStart = o.fogStart,
                    l.fogEnd = o.fogEnd,
                    l.fogDensity = o.fogDensity),
                    o.isPhysicsEnabled()) {
                        var c = o.getPhysicsEngine();
                        c && (l.physicsEnabled = !0,
                        l.physicsGravity = c.gravity.asArray(),
                        l.physicsEngine = c.getPhysicsPluginName())
                    }
                    o.metadata && (l.metadata = o.metadata),
                    l.morphTargetManagers = [];
                    for (var h = 0, u = o.meshes; h < u.length; h++) {
                        var d = (_ = u[h]).morphTargetManager;
                        d && l.morphTargetManagers.push(d.serialize())
                    }
                    for (l.lights = [],
                    a = 0; a < o.lights.length; a++)
                        (s = o.lights[a]).doNotSerialize || l.lights.push(s.serialize());
                    for (l.cameras = [],
                    a = 0; a < o.cameras.length; a++) {
                        var x = o.cameras[a];
                        x.doNotSerialize || l.cameras.push(x.serialize())
                    }
                    for (o.activeCamera && (l.activeCameraID = o.activeCamera.id),
                    e.Animation.AppendSerializedAnimations(o, l),
                    l.materials = [],
                    l.multiMaterials = [],
                    a = 0; a < o.materials.length; a++)
                        (y = o.materials[a]).doNotSerialize || l.materials.push(y.serialize());
                    for (l.multiMaterials = [],
                    a = 0; a < o.multiMaterials.length; a++) {
                        var p = o.multiMaterials[a];
                        l.multiMaterials.push(p.serialize())
                    }
                    for (o.environmentTexture && (l.environmentTexture = o.environmentTexture.name),
                    l.skeletons = [],
                    a = 0; a < o.skeletons.length; a++) {
                        var f = o.skeletons[a];
                        f.doNotSerialize || l.skeletons.push(f.serialize())
                    }
                    for (l.transformNodes = [],
                    a = 0; a < o.transformNodes.length; a++)
                        l.transformNodes.push(o.transformNodes[a].serialize());
                    l.geometries = {},
                    l.geometries.boxes = [],
                    l.geometries.spheres = [],
                    l.geometries.cylinders = [],
                    l.geometries.toruses = [],
                    l.geometries.grounds = [],
                    l.geometries.planes = [],
                    l.geometries.torusKnots = [],
                    l.geometries.vertexData = [],
                    t = [];
                    var m = o.getGeometries();
                    for (a = 0; a < m.length; a++) {
                        var z = m[a];
                        z.isReady() && r(z, l.geometries)
                    }
                    for (l.meshes = [],
                    a = 0; a < o.meshes.length; a++) {
                        var _;
                        if ((_ = o.meshes[a])instanceof e.Mesh) {
                            var g = _;
                            g.doNotSerialize || g.delayLoadState !== e.Engine.DELAYLOADSTATE_LOADED && g.delayLoadState !== e.Engine.DELAYLOADSTATE_NONE || l.meshes.push(i(g, l))
                        }
                    }
                    for (l.particleSystems = [],
                    a = 0; a < o.particleSystems.length; a++)
                        l.particleSystems.push(o.particleSystems[a].serialize());
                    o.actionManager && (l.actions = o.actionManager.serialize("scene"));
                    for (var v = 0, b = o._serializableComponents; v < b.length; v++) {
                        b[v].serialize(l)
                    }
                    return l
                }
                ,
                n.SerializeMesh = function(t, o, a) {
                    void 0 === o && (o = !1),
                    void 0 === a && (a = !1);
                    var s = {};
                    if (n.ClearCache(),
                    t = t instanceof Array ? t : [t],
                    o || a)
                        for (var y = 0; y < t.length; ++y)
                            a && t[y].getDescendants().forEach((function(r) {
                                r instanceof e.Mesh && t.indexOf(r) < 0 && t.push(r)
                            }
                            )),
                            o && t[y].parent && t.indexOf(t[y].parent) < 0 && t.push(t[y].parent);
                    return t.forEach((function(t) {
                        !function(t, n) {
                            if (t.delayLoadState === e.Engine.DELAYLOADSTATE_LOADED || t.delayLoadState === e.Engine.DELAYLOADSTATE_NONE) {
                                if (t.material)
                                    if (t.material instanceof e.MultiMaterial) {
                                        if (n.multiMaterials = n.multiMaterials || [],
                                        n.materials = n.materials || [],
                                        !n.multiMaterials.some((function(e) {
                                            return e.id === t.material.id
                                        }
                                        ))) {
                                            n.multiMaterials.push(t.material.serialize());
                                            for (var o = function(e) {
                                                e && (n.materials.some((function(t) {
                                                    return t.id === e.id
                                                }
                                                )) || n.materials.push(e.serialize()))
                                            }, a = 0, s = t.material.subMaterials; a < s.length; a++) {
                                                o(s[a])
                                            }
                                        }
                                    } else
                                        n.materials = n.materials || [],
                                        n.materials.some((function(e) {
                                            return e.id === t.material.id
                                        }
                                        )) || n.materials.push(t.material.serialize());
                                var y = t._geometry;
                                y && (n.geometries || (n.geometries = {},
                                n.geometries.boxes = [],
                                n.geometries.spheres = [],
                                n.geometries.cylinders = [],
                                n.geometries.toruses = [],
                                n.geometries.grounds = [],
                                n.geometries.planes = [],
                                n.geometries.torusKnots = [],
                                n.geometries.vertexData = []),
                                r(y, n.geometries)),
                                t.skeleton && (n.skeletons = n.skeletons || [],
                                n.skeletons.push(t.skeleton.serialize())),
                                n.meshes = n.meshes || [],
                                n.meshes.push(i(t, n))
                            }
                        }(t, s)
                    }
                    )),
                    s
                }
                ,
                n
            }();
            e.SceneSerializer = n
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n, o) {
                    void 0 === n && (n = !0),
                    void 0 === o && (o = !1);
                    var a = this;
                    this.name = t,
                    this._viewMatrix = e.Matrix.Identity(),
                    this._target = e.Vector3.Zero(),
                    this._add = e.Vector3.Zero(),
                    this._invertYAxis = !1,
                    this.position = e.Vector3.Zero(),
                    this._scene = i,
                    this._scene.reflectionProbes || (this._scene.reflectionProbes = new Array),
                    this._scene.reflectionProbes.push(this),
                    this._renderTargetTexture = new e.RenderTargetTexture(t,r,i,n,!0,o ? e.Engine.TEXTURETYPE_FLOAT : e.Engine.TEXTURETYPE_UNSIGNED_INT,!0),
                    this._renderTargetTexture.onBeforeRenderObservable.add((function(t) {
                        switch (t) {
                        case 0:
                            a._add.copyFromFloats(1, 0, 0);
                            break;
                        case 1:
                            a._add.copyFromFloats(-1, 0, 0);
                            break;
                        case 2:
                            a._add.copyFromFloats(0, a._invertYAxis ? 1 : -1, 0);
                            break;
                        case 3:
                            a._add.copyFromFloats(0, a._invertYAxis ? -1 : 1, 0);
                            break;
                        case 4:
                            a._add.copyFromFloats(0, 0, 1);
                            break;
                        case 5:
                            a._add.copyFromFloats(0, 0, -1)
                        }
                        a._attachedMesh && a.position.copyFrom(a._attachedMesh.getAbsolutePosition()),
                        a.position.addToRef(a._add, a._target),
                        e.Matrix.LookAtLHToRef(a.position, a._target, e.Vector3.Up(), a._viewMatrix),
                        i.setTransformMatrix(a._viewMatrix, a._projectionMatrix),
                        i._forcedViewPosition = a.position
                    }
                    )),
                    this._renderTargetTexture.onAfterUnbindObservable.add((function() {
                        i._forcedViewPosition = null,
                        i.updateTransformMatrix(!0)
                    }
                    )),
                    i.activeCamera && (this._projectionMatrix = e.Matrix.PerspectiveFovLH(Math.PI / 2, 1, i.activeCamera.minZ, i.activeCamera.maxZ))
                }
                return Object.defineProperty(t.prototype, "samples", {
                    get: function() {
                        return this._renderTargetTexture.samples
                    },
                    set: function(e) {
                        this._renderTargetTexture.samples = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "refreshRate", {
                    get: function() {
                        return this._renderTargetTexture.refreshRate
                    },
                    set: function(e) {
                        this._renderTargetTexture.refreshRate = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.getScene = function() {
                    return this._scene
                }
                ,
                Object.defineProperty(t.prototype, "cubeTexture", {
                    get: function() {
                        return this._renderTargetTexture
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "renderList", {
                    get: function() {
                        return this._renderTargetTexture.renderList
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.attachToMesh = function(e) {
                    this._attachedMesh = e
                }
                ,
                t.prototype.setRenderingAutoClearDepthStencil = function(e, t) {
                    this._renderTargetTexture.setRenderingAutoClearDepthStencil(e, t)
                }
                ,
                t.prototype.dispose = function() {
                    var e = this._scene.reflectionProbes.indexOf(this);
                    -1 !== e && this._scene.reflectionProbes.splice(e, 1),
                    this._renderTargetTexture && (this._renderTargetTexture.dispose(),
                    this._renderTargetTexture = null)
                }
                ,
                t
            }();
            e.ReflectionProbe = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    this.name = e.SceneComponentConstants.NAME_LAYER,
                    this.scene = t,
                    this._engine = t.getEngine(),
                    t.layers = new Array
                }
                return t.prototype.register = function() {
                    this.scene._beforeCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_BEFORECAMERADRAW_LAYER, this, this._drawBackground),
                    this.scene._afterCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERCAMERADRAW_LAYER, this, this._drawForeground)
                }
                ,
                t.prototype.rebuild = function() {
                    for (var e = 0, t = this.scene.layers; e < t.length; e++) {
                        t[e]._rebuild()
                    }
                }
                ,
                t.prototype.dispose = function() {
                    for (var e = this.scene.layers; e.length; )
                        e[0].dispose()
                }
                ,
                t.prototype._draw = function(e, t) {
                    var r = this.scene.layers;
                    if (r.length) {
                        this._engine.setDepthBuffer(!1);
                        for (var i = e.layerMask, n = 0, o = r; n < o.length; n++) {
                            var a = o[n];
                            a.isBackground === t && 0 != (a.layerMask & i) && a.render()
                        }
                        this._engine.setDepthBuffer(!0)
                    }
                }
                ,
                t.prototype._drawBackground = function(e) {
                    this._draw(e, !0)
                }
                ,
                t.prototype._drawForeground = function(e) {
                    this._draw(e, !1)
                }
                ,
                t
            }();
            e.LayerSceneComponent = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t, r, i, n, o) {
                    this.name = t,
                    this.scale = new e.Vector2(1,1),
                    this.offset = new e.Vector2(0,0),
                    this.alphaBlendingMode = e.Engine.ALPHA_COMBINE,
                    this.layerMask = 268435455,
                    this._vertexBuffers = {},
                    this.onDisposeObservable = new e.Observable,
                    this.onBeforeRenderObservable = new e.Observable,
                    this.onAfterRenderObservable = new e.Observable,
                    this.texture = r ? new e.Texture(r,i,!0) : null,
                    this.isBackground = void 0 === n || n,
                    this.color = void 0 === o ? new e.Color4(1,1,1,1) : o,
                    this._scene = i || e.Engine.LastCreatedScene;
                    var a = this._scene._getComponent(e.SceneComponentConstants.NAME_LAYER);
                    a || (a = new e.LayerSceneComponent(this._scene),
                    this._scene._addComponent(a)),
                    this._scene.layers.push(this);
                    var s = this._scene.getEngine()
                      , y = [];
                    y.push(1, 1),
                    y.push(-1, 1),
                    y.push(-1, -1),
                    y.push(1, -1);
                    var l = new e.VertexBuffer(s,y,e.VertexBuffer.PositionKind,!1,!1,2);
                    this._vertexBuffers[e.VertexBuffer.PositionKind] = l,
                    this._createIndexBuffer(),
                    this._effect = s.createEffect("layer", [e.VertexBuffer.PositionKind], ["textureMatrix", "color", "scale", "offset"], ["textureSampler"], ""),
                    this._alphaTestEffect = s.createEffect("layer", [e.VertexBuffer.PositionKind], ["textureMatrix", "color", "scale", "offset"], ["textureSampler"], "#define ALPHATEST")
                }
                return Object.defineProperty(t.prototype, "onDispose", {
                    set: function(e) {
                        this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver),
                        this._onDisposeObserver = this.onDisposeObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onBeforeRender", {
                    set: function(e) {
                        this._onBeforeRenderObserver && this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),
                        this._onBeforeRenderObserver = this.onBeforeRenderObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "onAfterRender", {
                    set: function(e) {
                        this._onAfterRenderObserver && this.onAfterRenderObservable.remove(this._onAfterRenderObserver),
                        this._onAfterRenderObserver = this.onAfterRenderObservable.add(e)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype._createIndexBuffer = function() {
                    var e = this._scene.getEngine()
                      , t = [];
                    t.push(0),
                    t.push(1),
                    t.push(2),
                    t.push(0),
                    t.push(2),
                    t.push(3),
                    this._indexBuffer = e.createIndexBuffer(t)
                }
                ,
                t.prototype._rebuild = function() {
                    var t = this._vertexBuffers[e.VertexBuffer.PositionKind];
                    t && t._rebuild(),
                    this._createIndexBuffer()
                }
                ,
                t.prototype.render = function() {
                    var t = this.alphaTest ? this._alphaTestEffect : this._effect;
                    if (t.isReady() && this.texture && this.texture.isReady()) {
                        var r = this._scene.getEngine();
                        this.onBeforeRenderObservable.notifyObservers(this),
                        r.enableEffect(t),
                        r.setState(!1),
                        t.setTexture("textureSampler", this.texture),
                        t.setMatrix("textureMatrix", this.texture.getTextureMatrix()),
                        t.setFloat4("color", this.color.r, this.color.g, this.color.b, this.color.a),
                        t.setVector2("offset", this.offset),
                        t.setVector2("scale", this.scale),
                        r.bindBuffers(this._vertexBuffers, this._indexBuffer, t),
                        this.alphaTest ? r.drawElementsType(e.Material.TriangleFillMode, 0, 6) : (r.setAlphaMode(this.alphaBlendingMode),
                        r.drawElementsType(e.Material.TriangleFillMode, 0, 6),
                        r.setAlphaMode(e.Engine.ALPHA_DISABLE)),
                        this.onAfterRenderObservable.notifyObservers(this)
                    }
                }
                ,
                t.prototype.dispose = function() {
                    var t = this._vertexBuffers[e.VertexBuffer.PositionKind];
                    t && (t.dispose(),
                    this._vertexBuffers[e.VertexBuffer.PositionKind] = null),
                    this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer),
                    this._indexBuffer = null),
                    this.texture && (this.texture.dispose(),
                    this.texture = null);
                    var r = this._scene.layers.indexOf(this);
                    this._scene.layers.splice(r, 1),
                    this.onDisposeObservable.notifyObservers(this),
                    this.onDisposeObservable.clear(),
                    this.onAfterRenderObservable.clear(),
                    this.onBeforeRenderObservable.clear()
                }
                ,
                t
            }();
            e.Layer = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.CreateResizedCopy = function(t, r, i, n) {
                    void 0 === n && (n = !0);
                    var o = t.getScene()
                      , a = o.getEngine()
                      , s = new e.RenderTargetTexture("resized" + t.name,{
                        width: r,
                        height: i
                    },o,!t.noMipmap,!0,t._texture.type,!1,t._samplingMode,!1);
                    s.wrapU = t.wrapU,
                    s.wrapV = t.wrapV,
                    s.uOffset = t.uOffset,
                    s.vOffset = t.vOffset,
                    s.uScale = t.uScale,
                    s.vScale = t.vScale,
                    s.uAng = t.uAng,
                    s.vAng = t.vAng,
                    s.wAng = t.wAng,
                    s.coordinatesIndex = t.coordinatesIndex,
                    s.level = t.level,
                    s.anisotropicFilteringLevel = t.anisotropicFilteringLevel,
                    s._texture.isReady = !1,
                    t.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    t.wrapV = e.Texture.CLAMP_ADDRESSMODE;
                    var y = new e.PassPostProcess("pass",1,null,n ? e.Texture.BILINEAR_SAMPLINGMODE : e.Texture.NEAREST_SAMPLINGMODE,a,!1,e.Engine.TEXTURETYPE_UNSIGNED_INT);
                    return y.getEffect().executeWhenCompiled((function() {
                        y.onApply = function(e) {
                            e.setTexture("textureSampler", t)
                        }
                        ;
                        var e = s.getInternalTexture();
                        e && (o.postProcessManager.directRender([y], e),
                        a.unBindFramebuffer(e),
                        s.disposeFramebufferObjects(),
                        y.dispose(),
                        e.isReady = !0)
                    }
                    )),
                    s
                }
                ,
                t.GetEnvironmentBRDFTexture = function(t) {
                    if (!t._environmentBRDFTexture) {
                        var r = e.Texture.CreateFromBase64String(this._environmentBRDFBase64Texture, "EnvironmentBRDFTexture", t, !0, !1, e.Texture.BILINEAR_SAMPLINGMODE);
                        r.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                        r.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                        t._environmentBRDFTexture = r
                    }
                    return t._environmentBRDFTexture
                }
                ,
                t._environmentBRDFBase64Texture = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR4Xu19Z7PtTHbW1g3jMMbGmGDAZAMm5xxMLDAU0WSKWOQcCoqccw6eGdtgk4yNbZxnvvAL+Af8Af6AsQl+06ako9X36dXPSi3pnPu+cz/cOntL3S1pq5+w1mrpLs/eud9fvn27rf9evPPwFz+v22S7fGZ/n7/70G79J5/Xv/qzbLP+Pnvvoc/6Tz7jX/15/c62LfeH7fofbpfP3l/ct36Wf+u4+D37+XYb++G26LPsr/zFttnPuh37bm1bt0f7MvtlnOx4uv0H4fty8UUsz77rfn/57u32cgXvDv72eQf0tl0+G38b0Nf9K4Dl704MEfA16KsE8Gw9JgD+DQE8EA0DT2b7GwK4GHnF4a8iguXZt9/vL5/dbisJbEq/uwD5vIK/fbbAv4N9U/8nJIDNCazKvBLBGwdwu62OhajxmQSAx6gqNp5HCg9wPan2nwSNjhLD8ux/3u8vP3y7vbwDAYjtR8AzFyDqLu1Q+YEINnew23rPCYiKb+q/K7o4AVT4tg0t/h4ydJZfkQASQ/d5b9fZ/Z1ENmuPn/cwYCYEELBguKC3nRkCnE0AFOwOKCOAR/sH/L4hgFMpbSWP5dn/uN9ffs7t9mJ5cAHoBLTyszBAFJ/F/xIKdASw5wgaEWDMLySxAk4svf6L+4QAGPiJCziNAPb4f3UZ2dh/m+z7BK4SAPYrxf5FB6ABPgCUAfANAZwKyscc7IEA/vv9/uLzbreXzx9cQCMACAl00m8jAlF7ov6SCMQ8gJsMFFBnCECSg5H6TxJAU3vPAbwhgFfz9AABeOEDBcIbB3AqPzwQwH+731/8sNvt5Ydut5e3B2C/fG9P+jESgGz/RgxG9r9VAwTUUh0goQDafUz+DYnAnSha5l99Z1l/yQVswAZSGIAugNd/9xBgCw9E8aECkHUB22QPHIAVDlQdQAMWAibhBgZAasAVHUAI8Cqg96Tm0bj3VBS9jwd7IIBvuN9ffMHt9vLTbreXy+32QlwAhgMIeuNzKwOqCoB2Aa00KHE+EsIeDuj4H2N+Hf/TfAC6A4nhgQCQDDwiaKDXiq9KgBEJNPArAtCk0AEd2mpAizW3/lYIoANpBPg3BPA+hjs/9eXZV+0E8Bm32wsJA9aEoBCAuAABPiEAC/yDC4gSgRgKRHkAlgsI6v7iEFqJEMgBwb4BGkEfEEDnDlReoAP/SQRgOYIB+IYDMEE/SQBbXoLNr0jhq4qOZc0PHBSf5oKW519xvz//kbfby8+83V68ABfwniIBgwgQ/HoRUMv8w5qAoQqgk4DWQiCw+63eD8k/XAPQgK5s/5a5xzAAqgR6wY9k+ZEMtCOoJABb230hEHMFWQdgAl0Ap/+uc6tKBrrP/n0AuwfiNwTwNKguHHV5/qX3+/M1B/Ddb7cXax7g2e324vaQB3hhkMAW92tHoFb96cVAbimwkgQ0Vv7R+D8iACfuxzKfLvnNlAAjAsBwwP2MwLQAD9sbYJME0AFcg5uBPSAA0x0AobhtcDKDA0j3KYDhk7Hp8uKj9/vzH3C7vfget9uLT9nDgDUZuOYCLBJA8MNKPyGGIftPrL+4gy3eh5p/lwRUYYAs9Fn7tM/E9lvJwCH2DxJ/mPTr4nyyLiDtBgTAGCrgNuPzNuETgN+suEEAFhng9lkCoICMLH7V0isCeEMCxylrefkl9/uzz90J4NNUGLDmAnYXINUBrf5dCCAuQCcCvYVAYPk3G++VAveVfkIAFRLolgbr2F9ifP33pAqAV/fHRF4HcAS7AKlAAEIYFNwITOszs/wMsB6II4BXFZ0QwBsSOEYCDwTw2TsBfPrt9uLlqzCgcwFABI0EVCiANl8Uvq0JWNsi2JPZ/0YKsOiHxftsW4v51ZqAaBWgZf91PsBL/jFHwEqBR1cCiuJ3gAfCmCEA3cf8rmz8AMZHIoA3JDBPAsuHVgL4jNvt+UoCH34ggK0asIYBGArsAB7AD+reQgCl+GwZ8LaNlP3MEEDaSg4ACMGr/+ulwV4JsAEfLH42/vdKgWElAJ4QpBl+LAlKErHwt+oGMgTA2ngE4IUIOH3dGr/hAKT/m/UBdSJYPuVL7vflU26352sScCWAD+0EsCcDVxewKjfmAzAsENVn4EfgdySgnYB81yEAgL4RA8T8mTUASAAYBgylQAkL8K/+zL6rsl8qF6ArAeS7WRGoAB8Sf7isN/VZqTs6jQ5wXlweWfyqpQ8I4I0TmCCAT/3I/b48u92ef9bt9nwNAdZE4FoOFALYXcAGegkDMByAzzQEgJh+cAIs/legH0IA5QTCPADE+7ISkD0TgA/8sBIgLQfOgF/F9kPcr+J8fIYguyCILQRKgV4DNviOzoKqeJS0u4AA3pBAjQSWT//I/b5OmC0MWB3ASgBrGLA+IryvDNxCgRXo+wKhjgwk8bcTwUACsJ09ANRVAALwCxmEoFcrAUsuAJ4M1E8BDuHABAHomJ8RgACrZfQLyT9dBWi2OOEG9NJd/TDQ8HAQuBE97ZhjGKy6o+imnU+4gDckkCeB5cMfud/v6zr9Dz84gOdCAM/3JwQhF9CAD25gBWWz/8wNgMpj3K9Lfy0foMMBVffXyT4r+cceC9bvCcDFP0311QrATPkvWgosYQFLAuoqQEcQuw3v2si25F+M1RkZXLUU+CgBmCBOEsCbvECOBJbP+Oj9fv+u2+3Zp91uz9cy4Kfebs/3ROD6iPD2b10YJCXB+0PyrgsHdtBuRACfBeTN+uM+suJPSEDbfh3/oxPoHgwiC3/06j8Eutj69sAQqj++I0CUfvIpwCEvYCT90O4Pn1XsT5Ve1/+dcp9FBh3woqXBSEJkvjHHEOUPqJPAjUUCeOMGfCJYPvOj9/t7//d2e7YmAlcS2B3A8xcPYcBm/7ULEDIQew+5gS0EIEA31R8Uf6gAoBsgKwBd9ddvBBJAs6XARgLQXQ2o7T8+IETe+9eRACg7rhCMVgCiE8D4O9wOCb2ubOht1/vYd2ubzLlgKbBHEDSnAMfL6durVm8qBPwXWz7rY/f7/X/fbsvL2+3Zqv4QAjzfw4COAMAJbEC3wC8koBJ9lAhgxZ+4hi3Oh/f8dU8EqtV/JhHgWn9cC4CJQZXZp6GAk/1nawMkrrcqAiwPIIA2FwOB2oaAF5UkcX+GADBs0I5gsNbBQqCorJcFJjqWKvhNMjky0Aek7/LZH7vf3/vO2215vruAD91uz/dSYCOAPQzYkoD7vw34sFIQw4LNymNSUKk8Wv0hCYhkoJ74Q6BboO9eDKoWAHXvBiCvAdPZf4nt3QqA924AbfXV8t8uN4Bt2We029WkoErWpSoCSm11TM8AOYA5uRS4RAITIQDDavaYHxCcm5exfM7H7vd3v2N9McDt9uxDD//WKsAG/ue32/M1DEACuO3g1jkBsf57fqCL/7UbIISAio85AAG0VQEYiIC9DJTYfy/+Dx8HlpeDRK8G90IBHQbgWgD2WT8LoOJ7NyeA5JEkAwwxmuqzur5X6y+sBEwDMggrqoBNH7c68Puk/fI9Vwfwvx4e6H724oEA1iSg5AAaAewlweeyLmAnAHQCTfU1CTAH4GyTMt+QDMRFQFEYQB71lXUAOjHYlvTqh4N2xe5yASoh2PpaJUGDBDrLr9cGIDlY1l+vDlQOAQHckYMiA68KMFsGtOy65RCGsMIDT+QqJoD3yUwCy/f+6P3+7koAt50AXrwigM0FrIuEoBrwHMMAUhmQUKAlAwHo7VmAPURo9h/r//ozLv1V7/5v6wGMV4B3rwYPXEBqIZAQwp4TYDE+LQlqtQfw6my/LgsyZaeLg7wVgmDnWQ5AA5ZWCDRx7ECzyn3udgFptFCIgTlyFRMEUCKgA+O/jl2Xz/3o/f7Otz88QvpszQOsLmAPARoBSDVgud02AthdwPZ5BSxUBVr8L3kAVHrvs076KSLQi3/M9QCJ7H/G/rf4n8X41XIgcwHecuBMDgAe+BHA6uQgqnvbF5DB5hwUQM3vQgIWkKOVftH+gAC6cz0RXZ9MjmD5fh/ZCWCd1CsB7CSwhgArAUgIIC5AQoDOCewJwab+CH79WR4C0mQAZT4hEQS9DgfEztNkoEECDfi6FAhZflb6Q1XXqwHDEECpvZX4a0qP1l7bfAS98cQfzQUo9a4mASMC0CsIm6JGK/2i/QkCuFK9PxmIYPm8nQDu795uy3K7LTvwVyJAB7ARwJoAVLkA7QIkJ9A5AQS95Ad2YmgvAJWwQFcBpB38pUuB9wVKbAWgCXwV86Mz2ICKTwUWFgOxMEBicr0eoBwCGBUADfxsDsAiA+zflNay31ZcfnAdAAXgDGkcdAcfZCJYfuCX3O9vf/vtthHAmgcQF7ATwOoAtn9IACsRSDkQ/wqIIUGoXYEQQ/sL5IDJP539776DwodVAGlr5QBgP8sDdApP3gSUXQa8/rZsRaBeHmy+HwDyCI1MUNlZzX9iJSBO9igJGJYCo4RdIqMfJQ4Ztq8C7FXjHuSnQ92XH/yvdwJ4Z68ErOXAlQRW0O9/JRG42v9GBHsuAImAqv+uzDo30C3yAfVHoHeg9xyAp/7wlp+WFCSWv1sOTBb+0EoAZP5DImBrApAUMFHolQG19c+EAkbpjyUEdQ6gm/QEsCzZFxKDlWNwprJVWfBm/1WAvWrcQ0ie7Lz80H91v7/9v263+9sPI2zrAZAEdvXvXMBKBJIIFDcgyUAEvHICg/o7wA/Bvyt35wCc2F9Cg03RvRyAA34N8hD0xsIfXP7bQgDMFSgyYO8GsF4N/hQ5ALak1yUGRQDZZJ5VWXgKEsie8yQuH63b8vn/8oEA3lsJYJ2EQgD73xX4z9bs/74gaHMBQgA7+DsXAJWBBniHCLTtNx2AUnkG/LYNiUCpvX7wp6sIOHF/lwgkNf8UGagwYMgLMBdgLQCyVgOyciCGCs5nz/Jr8EXOQOcQZEbrfjjTU8qaCBseMyx4vxPB8iP+RU8A24Kg9R8Qgaj/av8lDBgcwApQ+QdVgW0bKr3+jsk//AztzBKgtv4K+Kj08rl7JFgt9BnCAIsQcD2AsQAolQj0CAGAqhOFCK5u3cA+84dyIJLCPm6buAgoBa5qDoDF6wzUkZ13iSDKKwTamSKZSf29cuzJUwq7LV/wz18RwH2Nl9dKABLArv6bC5B/+9OBGxmsIIR1AQ3w2gk4RECTfwBulgC0rP96/FYJUOv9SzkAB/xuKTBY/qsTgZ0LILF/s/RW9v81ywEwhbeAwUIH6hRwGp+wEOhqoF49fojqQoPlR/+z+/3t77jd3n3rdru999CzEYAQAYJfXACEAqL8W5lQgA5uoJUK9zxBB3ii9ALiYT2AjvuN72wFILP+XdlP8gLKFeg6f5QM3AC+VlMMZ9ABGuN+VePHWL6tHVD23or3tQPo2iWfBRgShDp0ELcBjmIAbwTWqEzIJvLM6kEDEFcD9erxCzg3my4/9p/e7299x+323lu32+oAtjwAhgE7Cazqv7mAvRLQcgG7A9B5AAwHus87CWBYsIKFfe+eCSBgt2J+7QBQ+VsogOU/9fIPBvLhASEF8AHwlhPQ2wVYFhmo/Wby74QyYLcmQAEbbbue2FcnAb28QTmHQKBwNVCvHv8IESw//h/f7299pyIA7QIE/LsTeIbqL59hPUADvHIBG8jBIWgn0L4rsKMj2Noomz8QgZELsCoAAnh0Caj8lup7ib9tX+ZBoKgUmFkWTGJ8S/UHZa/kAHT+QGaeoeQmMUC/CoAzVYAjYDvSNwPCq8fPnINus/zEfwQE8O7tdt8dwGZjIQQQ9Y9cwAB+RQIC4I4MdvvdLL+O//E7LgLykn6q3Efjf6X8bOUfkoNYcQZ8z/KzBUBYCqT/YQgjBuOBHxPs7JHh7JoAy/IzWz+xEtBKBEYg8fIGw+SeQQQ+CzHZP+oWXWPU/8z9y0/+h/f729/5kAN4791X/6/cpl4SCsDfLRQwHEBLCmJFYH92vssNgBPo7D8qv4CekIHpAjKgx1iffGbKb5UAQwdguIAtz2KsEWj7vIQggNON91lYoIFN2mznYKj9UBmwQgXLLcDstRTdBchEFWAWcLP9MgC9cuzM8aXN8lP//v3+9v/uCUDyAM0FIBFADqAjAsgFiAvYwK3/MfAL8InSd/Yfy37Qpyv3OSTgxf8C5vZXPfF3aB2AA3hJGg5LghMOgCUBo8SgEAyC3Irvh5xAwhW0cT1iQBKYWds/QQLdeVUQcrEjeGoiWH7633sggHfWJOAaAkglYL/wLQyQf3tYsCp9CwmgFIgOgIJ/JwMdBuB3cQTDX4z9wR2whN+WE9idh67761p/F/8bpb8O/OotQCsJDhZfji0qT9p0LsCI83X9H8E9KH8iCSiTrQO29bwAAbvlCipPAw4T/oRKQAVElbaMJ472t7jnqnEjrlt+1t+539/6P4oAxLquawIkF7Bb/40M9hAAHcD2GVzABmBYKSgxfyMGAbROCipl1w6gs/8ZF0Cy/UIOOr7vHAIu9iHP/2v77yX9ROUt29+AHVUCnDJgtvSn8wXsnQGzIUAW3F27qFS4z2CrD07wCogqbR8LtGecUwR4vX/5OX/7FQFsOYC9FCiToBGAEAH83ZwA5AM06BspiPKrNQIt/kcg69iffBegNqVXb/wdQgIMC0DltUuQ+L+Bmz0OrNTdK/91+4JVf15SEPMCYRkwEfc3stBxurMS0AoTMKRocaV8cKw6jpcFsdUn2/8qRT8buGeP55HC8vP+5v3+1v99cADvvfNQBZB4dO24Kv5GAntSUOz/+n1wAis4wAnoMAC/N9svSUKsBABgmwPAbQTwWzsW/2vAI6j14h+1CEjnBYZFQWSxj+sEVFyPjgBBrhf+aOtPY39vRaBVJlQ2vyOGIATQsb6etBguDMSQyAF4IMhUAmZANNNnUNSqBDvtzzif6HSWL/wbuwN4eycA4gDEBQgRYPzfSGC3/BYBdOCHxKBHBAJoAbdWfIz1I9XXsf5g9y0yAJB7iUDPCaC6e2EA2ngMGyIHwAgBldncf4ID0EDXVp1NYmbnrclOtyfDhiPOoCO4CEXB/rOBfOZ4yy/8a7sDAALY1gKAfWMEgOovoNdk0IArKr+7gwH02gWQ2L4t/sEEoLL2IQnoFX96HYC4CIz/jcSgAJSVAtu2RPZ/SPRBHkC7AkYEqceC2fqBfdKaCcHAAeAkpKVBCANcElBVgBQRTC4HngHOTJ+rQo2jhEbP6xf/VU4AmBza7L+EAZgLgGSgxP8dGQDwmQOQbS2xp6oEWAnQn1seIEMCJO4fsv8Q2w/JQU0IJMvPiCCT/NPuQP/noJ0rAFBa23VSr1N/vQhIgxzzB9odMMIAkGvFZPF6JkyIlJeFFl6IcRYYX0ciOOOcll/6l+/3t/7fngPYy4BSCmyT0SGAlgvY4/+BAET10fZjUhAWCg2AV8nBEPQ6D6DJgSUAoQ/G+Dr+T9l/pfg0HxAs/e3WBUhbsihIgHKkHGiGCQHYO/UHomDgdd0BcRkZlYtyAFlgZNtlzqkSJcwc1xr/6FjLL/tLPQG8t+YA3tuXBKPiqISgAB//bjZdkoNE/Rs5EAIYXIAKCwYHYJADlvhalp8RgS4PogNwFN8jgo1A2LoALxRw1gA09TbCAjckQHBZlQEFwEoS0Iv1S3mAYFGPlwOIJn+0v+ocPohEsHzRX9gJYM0BvPvwTyoB2gGsP6iEAowANsBJWAAVgRYeAPCb/WdkAKEAttNJwRbzM+UPQI8K36k9Kf3RagBTe2vhj3o8uAFXLxUGxTdXBrK1AIltTZ2JzUe7Lp/Ralvxvrb5kcWP9nv2fwBzIRF4FRFkx/XcwRljHCGm5Vf++fv9re+63d4xCABVRhOAJoOtRCguQKoCmghwv7L/mBPQwB/KfMQhCEF0ym8RAUkIToUAxrP/gxOwSoDGmn9WCjTzASw3kHQA5poA7Q4g3n+MEMAChiadiopXwHZV26usvB43e/7Lr/pznADakmBdDcB8AFj+5ggcF4AhgAlwwyUM6m+pPgF8U3BS6jOdAAkJ3HUAO5C7ZKBT99/IVDsGhwyY3e8qNfhCERXDa5BrlW/ftaoqe265Ar0U+PIQQCUzqwqYBYfnSK4AcuW8sjmHaMzl1/zZnQDeud3eXRcCrfH/ngNYbyxzAKL8nQNAMiC5gI0gBNz42XIBAnAkBACwqDyWByPlp2BPWP7WD0Crs/5ewq+1JaBnWX8rEajbDiVAlbNpwHRyAJ4D6EqECQcQWfxo/0wI4E3wcPJnUbSLXqH5A26qHaD9kb7ssKaj+nV/ZiSALRG4rwhsJLBfUKt/k3yAJMGwEtCFBGD/PTIY4n6d8ANyaEk/Q/nPUv8h+WeRgXYCVgIwSwbK3osKi4PonEGUC2C2Pngc2LL73Xanlj9bBTg7BIgAFe2vuoxZS14B7wy/DCT8xX/qfn/rrYccwLtrElA7AJkgkrDSJUHJfO/Z/wZ4Kx8g4IXyYKfm0i9QfkoSJK5HghALr51Ce2Jwv0ad9BvAj1WCidKfZf1x3UDnvPQ90HYf7o1WfSQMGbOpU1D3H6oCynpjPE7VfSccpoalMEHNdAxFKkDLgDzTRo5ZaXukz1E34f1Gy2/8kzEB6MUlsjCoCwWMEAAdgOcGTECrnECn+JYTgPyABn0U82vwt7hfJft0rK9DAlHooTSolH94GxBUAnTSL/reAbz6UBADt344SDkIJBIT5E62HgnEAwgFmjq3ChFkAJUFd7Zd9fwsdZ89nnX85Tf/8Z0A1hwAOgDJAxBbuU1usboYCoiCKvWX+L/lAUDlNUG0bD8Bt7dviP9Vf0v9LbV3XQCz/3qbZf2d0h8D+JAPYDb/RAfArL1l92W7Z/OjEICpOZvkw7bES0EisET7M0RxRNkzx78qJGj37rf+MUUA+zoAnQjs1gTAhJNyFy4X7kBtkYHKB0ifDMgrLiADfJMESGa/Cwe0/a+CHsmA5QQ8N6ByAzJZh1IhEobOAegsvwaVDhEKDkCre0cielYbau4SQfIZggyIM0DMtMkc6ywnMHMsduzlt/+R+/2tt2+3d8QBiAtQSUBaEVDxPyYB22cEuiYDQgJtLUFk7539ke1vgAeAR05gC3ekbAclwuaEjEVA3XoAAnLpT6sBCuStrUrIpqsBHhkwcBOVTecFJAteCAFSyk/GzapwBOJofwV0mbEQkNX2p/X9HX9IEcB7eyLw3q8IlPgSbV/LBThEIMreQJkhAeYOIsDrsELV8VmIgHX9ITGo1L+BnxGB5wQY6IvKLzZZCKD7nsj8m+sADjoAVHk9ga19tF1CzSk5GO8T9MCUAdpZbSqEUW17lpNYfucfvN/fBgfwLlQBcEnwdkA9cdGiCjCgGrCpZhACDMSA6wL28dewgKl6GzuI963EXwtf1Nr/wQ0YMb+bCJwAPgKc5gPIPeiImeUC4B5J2zbZnGXBQjI4Mdk2HFNPYqv9MNlJCJByAzPPEezIiUAe7a8ANjPWGYpePc52Db/799/vb7/zKgQQAnhvDwH0cwFWLqBluwkRYJ7AqgoMTiHjApTqR9ZfbLxbCbCUX1wOKQGiO8ASn7XdKgMimL2SoG4nkxGVnqk+OoeBDHR4AN87EmCWnlULBGiBuiNJMFC5RJB8HsACRgYwZ7WpEEY2pNEuYOoYv/f37Q7g3dvtnT3+39YC6BBAv3IK1wVA9p8SAYC5gRDBqz53QDasvag/dQboGMCy0zBA7e/CgoTyszX/VeA35QeH1YGc2Hwr2YchGn5mJNGVd8FdoEOIHEBo9VkeQc3cqFJgEkPhxSBHwoIMCVTAlx1vlggq4y+/7/fe72+tDuDdV2XARgD7isDtd95BpZWjKRUov4Acwa6BT5OEsEjICg1aBUAl8DpwA2kgQeCYbHsjL0zygfKbll9XC5xk3zYGgM1yA0IKERGgI2PJQJ20M13CAQfgWv1kEjBj+Yc2zlqAGdWPgBPtrwI2O16FXMrn8Ad+z04AaxVgTwDiasAtBNgnrK4E6HBgSApichCBBHkBCnQNbmb1iTPoSEXlDXCfTv6x0EAA2OUDtCPA70bMT6sAXjVAlf4sIhieC8BYXy0CYk5gIPKCA8CJGzoAI5QYJqoRzx8NAZ6KCLLgzra7igSWP/i79hzA6gCAAMQFrBMNSUCrFypUm+x78k/cQRffY45AqatOGDJy0CDHkh5dDERielFhWvrTIYHO+icy/jK+qe6sCkCAH70erLsXylXMWv5GFowQrLyACISU6HZ0W+RALX0Qz2ug4NgYUWScRNQ+q6IZ8GbaVMCdHS99jX/4dwIBCAmsoNd5AHAB1sRDArByAV1YgLkBnfRDF6AtPbP4LNY32lkOgMX/tPynSKFzC466Y2JP+mT+mk8BOiVAVP2MA9COgH4nQGcgHxyCAe5uMicqARTcJ+QBIlB5+6O+V4E7c9wMCSx/9HfkCEDyAMPDJiQZ2AABqtZUVwG7s+ZWMlCDO/F9iPFZso9l/IkDaMRgxPqe4g8JQa30yg14pdaM7TddgWHxXcUPVgLqvnqyWw6AqrlT0jPV33AekYJb4IlAdfX+6LwR0BVi8Yhg+WO//X5/e68AyLMAawlwCAEwF2BkpTfgqwlu5QU6G45KrdYNsNi9qwAQMgjBnyEDI77XYGcxfjXut1wAhlfSptsGoNHJPab6XkLwTAeAk1MIidp+mJlRJYCqPxCABwizr0aUDl3I/ogEMsDMjJEZp0oYjECWP/HbSA4ACEDWAbA8gJ6MjADWbYP6i5LqvyRROBBABHgjXEAV14k963s7d0koOkm/s+J+FiaERADqbjkAHKNNrsRCoE7lmYsQ0HjlPm+dgMzKRLmQkkgyBJhR/SPWPwPyTJuriWD5U78FHMB7eyJQ5QDaYiBhXL0mgGWumRNQAO/KbieTASMOL8bvVgUSq2/lAvAaOvDiwiEjs6/BThdZ6bUBJNvfuQN0Z+pzVzI09nXqrT3UMRMAACAASURBVJcKg+J6xKAnLao7Tvruc6ZcyBS6EDpUXUIEvgyAz2oTnQuqe+aYzT386d98v69rALZ1AEIAazVgz/4zBzC8aorlAdS2rkIgC4e8v2TxkOsGMLeA45I6vgZ7ygFg4g8JQhOdl+FPZv+ZnRey0CQhE4PtH1TfCBmkXQd+S+1ZXkCTiQZq0gG4sb6qMHSAKFYQHpsIMoDMtKla/syYy5/9Tb0DWGP/7R8QgOUA2NtnzEw3LhRS6hjlA9CK6/gfS4XU5rOk427p9bg02cfATtS9CwGcSsB6/taTf9Zvx0ItvQ2JgH7WgEYyMMA+5AwmHMBMDsAjAhrPTz5M9H4mggy4M65g+XO/YSeAXf1lLYAsBca/24D7MwKdakBIYOUBxKYyJ0BDAeIOTOW2QI75AgVkXNVH7b+VBFTgDisAQda/gd5LrCrlZpa/WXJrEVBk+cGxNWAkqwDMQWiFNq2/zNKgDOi6A2NFICULRAV8rrSN7HgEzmh/NH4G2MZlDi8qXf78Fz8QgNj/thjIcADtvw9HNcgQwGxIwPIGLHTQVj8BfszWmzkAlZsQwFrlPbcCYOUCjBwKKwl6pUBRWyFhukxY7LmO7414X8f61BVY4YLY9iDBhy6BTX6LPJCoPHtcAXelbQRUD+gZEojGZyCvjrv8hV/fOwArBGBLgnFpcGdJYUJ0gNknxLDNCwm8xKEV6xtqPwt4DWpm92kIQICN7bSNF2Xv/pLfUgNd5wxoCEAA34GbqL0VAmhSuMIBuIqv8wGJRUQWmCzAfNIQwV/8tff7O+9BEhBKgEMiUIUAXjLQinMbAAAcCIruFWMVgBPFX28iLhW2Yvzu+JCo06A21wAQm69XRVJwk+RpaiEQCxeQKEDlaWhgtEWQWEqvt7vhwoQDKAFfjR+5hytdgjf20X1HLH/kIpa//GtUCLATgE4CogOQz628IwzslKx0gosuG1bWnuUGotJhyzUYYUIjBSsnoJKVXZnPCAeYo3EBH1UDDIA38CniiBR/CA1I1r5VEQBUg/1XVt8jjG7iWZUD5WEz5UIK8sRagIhYquQQgfqI/a/aeBYKZMOD5a/86r0MCGsApAqQcQDbgTQBMNuqJ70GE/nuOgMSGjDFj7ZZhNABnxBTIxon459Vfa9yYpUEEfRU5RXounEUkJEgGJlEYNb9O2IQ16hsO07y9nk2ETjzJKG4JIKUSlgQKqyDzgzQM22ic/AcxPLXflXSAew30no8eDsJvBGWyhmJsKojQOAOi3R0yRFtPcvuqxo/tf7qeryYv2T/mZqT0IARgfzmG9Eg6erP8Jvr+4Tk4Sk6IwnWfgA/IxsCPhmfKWuk3ugcqENIgLwC+hl1j4Ac7c+CPDNOd4/++q/ccwCRA1iFHkqAtBrA3ICh/J46Yp7AjM+DHIK27t1aA0YIbKGPIisrw59NAOqSH/0NEKyMCBS4qwnAtNpnk4JGnN8pfKYKoIgiA2R2DEYglW1XE8FZQI6AHu1vv8nf+BUPBNDKgFYOgDkAsHdmQhAnkhP74kNDg72OwgMP0CRuN90GW+CTdCwWoVluQKv3EAYQ1cZjuOpv9JXJNyT49KIgliMwlByVu7kJUFwvPBjcQuaxYSuUOBAGZMjGIxEP1BEQn3z/3/oi4gA0CQD4uxAACMBLCKLNjFSPJd3Q7rtJOWu1oZNcHMgmE+8H5T3P3Xj7OlCzCgEeN+sEVDs8Rpu4Ol9ggd1ScuYWkAQIsDv1lrYqB+BZ/2FfsBqQAe3sbZG6Xwn2aGzr3Ja//cuJA8CnAXfr314SajgBkwBwAs6EAwmwWWFChThY0s8iI297B3DDPYRtCLi3Psb2AdRAHrKvqb9BCEyNtaKXS4OkoqAnomXjKUEo9e/GSjqAs0HvAS8C5WzfaNwKES1/95cZDmAlAbIacPudIRcgi4H0oqBuUirgU6WDSVtJsHnJw8gtZNyGWeJLEJNn61vZzYjzo/3dQ0Ea1DgmUXMWAqTAbil9UOaLynttQj+iAzibCCLQRfstUM+ShJiqqP/y937p7gDuex5gBz5bByD23woDMA9ACeCAG8jkCLTis+8ZUhjCAisZOKvwySw/OoWONFWMrmv4ZsWAqX+wrXMGbLkwnMvgIowEIWuHTsV1CTKz978WeViA88IKDzRnA/Ts8TyCcUng7/+SngC2twFZJLBPljIB4IQ1wgA9waPM+rCfJApN9Tae1beOGZ1LO06CEKj7UbF9A7CVB7AShIa9R3Uf1gOwhF9V6S1iEEQFDqFN3my14IJEYNYRTANNERd+PZMMIsXXp7H8g198v68VgHf2uP9dBX5xAtvbgaUUqEqCg/1HKweAlx9vsLeGIlqxchWojCyqY1RCgXK5jxGHofIsD9B+V92nSAgIxCEkgLEGBU8mAaO4PgoVmEJbOQQG1CzIs+08Msg6kAwRzJBOlgiWf/SLRgewksCq8l0YAKBveQAgBGb/t4vDhJQmAwf4a9dQeZPWnJbiHMfgOYeNlAKlx3BFOxs3L6B+LySS8EUg6rzwuEgQ3luBGugDqx/lCzyCGPbtCBBi05M9Io2OFB4hEXgmGLMgzZDEjIvYruUf/0I7BGgkAJWAbY46SUArGThMyAIZVADH2ppEkiCBir2n5xmpu5ME1I5pUH+LYEnFICKEDpiFEADPSSu0JhQX/MphTBFBIYnI3MRjgLviLs48H9OR/JNf4IcAK9bxPwoV9TerAXgj4T0BOJk9MhAQDZOfACUCNgIy0zbTJpPZpyGAQwTiKug7AYkr0L+N991Vf00gpGyHINbK3yZVMQQwVT2xEMh1BEZ/Nvk1EKsKmgXyGeOeTQQdEf/TL3wggNX2b/H//jqwLRGo1gC0HMCeD9AlQPw+WDqZJEZIoCdaNY6OgOmFAVq5u7ae3Y9AHam7sd8kApUsZHaekclAvrv86eoBcwkZkFvrA1hf1wU4Cu4Btu1T/c8G/hWgrxDEmSFDc0D//OdDCEAqADoPIMnA7a8wrv6LpSEFfJlkoQtAdfKShEmAWlUDN7xgOYYE6DPuBY+Lv0W0HRXdK/cN2X6l0jqcsICubbx2AVeFAK7Sy+zV1YDiasAjgH6MvqZth+vXH6sksfyLn/eKAFaw6yoA5gEE9FYScDsZZfsR8CwhSJNb2Tq5UVLsQO0lE5Pk4bqRiBDU/oEcHFVn9X1T4dFZ6TKhYfWZcltqbm6HsZm6D07QKuGRcqQGgEUKSF5N2QySYPutbZkw4SmJwCIIJIXIYSz/8uf2BEDXAWAosN/w7gUhAHwhge7GY2wGBKFtf5oMGKgcl1Cx/wKwKKQY2hWB3oHbqver7ab6J8t/2L9VbaR6sM8auk4gArlRNbBchQnSaBw5RyV7lRCAgSYCerS/otRZwqiMmSECc7x/9XNUDkCvAyB5AAwDtrlBQgG8KegCOsvolQgrgPKcQKTQSReBhOCquBP3a8LTToXF/vpY8ls2J6AdBFH/rNJfov4YDoL6UzVP5gDc8MBJBFbBnwHrWW08EEcqrvhw+5oNBZZ//bMLBCDqb7kAcAJtUQeyOuQDcGIPnzFeJQClSbJqngBULW3xIzKpkBYe3wGxkISn/u5zASwccLbh5NHhht43ELsFcGeFXwfmA1UAdBsZ9YxU/ej+zDkwJ+RtO5Mkmhh9yc+637cKwJ79lxyAlP/kKcC1IqBzAJgL0K4AQwC0m7hgyAsBrAVEaL0HJU6SQKeiyT6dWictOwsTsqW+9ttosAax/pA3AKJBEqEhQLX+T+J2PG9GEIxEPPC6ag/SNzhOtm/fZo3JABYpfLT/KBFU+leUvxHNR37mSAAC/lYBUDkA76EgIYWOAHASKnXHm4/hwaB8pIxIV8oFFpxlziNws/0diSgF91bwuQQmE7QQ+2fUvwO+pf7KkXRA9db6W6QB1+KCHu1qMgTQE70DoTOG24/Y5qMuIEMOFYBXQ4FM++WjP2MnAFUClGTg5gCEAMhy4M4F7JNou/eZ0qBWELD7qO6D0uNkZXmEwKqb4HXI4wzAa8ejLTYSjb5mfXz8jgCvlP86YrhC/ZH4lfpSFU4SgAfMo88TZFxAlRgyY1aI4Iy2zQF87KfbBLCVAAP199YCaBJAV9AlnAxX0NqwnIBSrHSSziAPa/VeJt/ACMp0AY6l1+CNvofqb6h6NikoJMMUHN2apayZNt3YxRwAPa6Tb2iTXj4cVP2MwkdkUQFz5njsGt1tX/rTHghArwHY7P++DBhdwDanYCWgzgPIfh2TtfUB+6QcJhcBedfGUXoGwAaOyXhdKy4rC1rxPAtlymqfjP0x5h6ArVSdARJdiQa6BWC8t3h8RhQ616AnY+cEigRQdREWUZ1NDBnFz4I5Y+OroMf2y5f9VE4ACH50AS4B7OD28gDtxyEVgW6yOIQwWGlg/Uz8bQLXcBoa/AM56Dq8FcMbCTyx/o3ISF3fsvaMWPRv7JLEPht08nC4TyTDb5UNI1VnwO3coaHQFPBKxa0QwAO/G1LAucwA+2oHkDkny2Vs27/8pygCANUXF9D+h2CdC1CA334rcQf7Z7yxsp8qiFpBOKhPQAiW6jIlN9UdzllAKQBjdtxT9eF8HJLQ5xNae6Lska1nSu+pfyMjb3GOlxwEYrHANwA6sO/abdBxyRiPAf4ZoGf6WOA9y0Es/+YnAwHs4JfsP4v/JSEoTgD/is1veYFZEsB+xAp7gDEX0yRU2asQaHX2wD8QjEEsCDKt0pZqM2LpSqaiiNpteCW7mQSgukc4UTWxsH0Z8EaKT/erRGIW/E/pAo6AOdt35+Pxvwf/t0gA8BKQFfzZMiDmAYakoJ4oUB2gE4UtHDLiYQSa9bnsDEhJj4HfdBYHF/V4Vn8gvh3sh9Rfk60ot7c9Uf+Xc80AkDnCNGng+RrnzCa/RS6Z8zXBJDv0ORnf9bHY96Pbov7LV/ykMQfQrQMgVQABvP67//60BKgXA7UTU9Z/mDgk+TeAndjrBtpCBcEF9Wz23on7j1p9TW74mzaH4jgC/Vtri20uDdakzvIDbTL0y1I9Gx+V8CJHgNeTBfIMEXhjz5LDU5HB8pU/ccwByBOAXQ6AxP9sQVBL5EJGF8uByPYDCehJE1UGAuB7JKD3MadA22iFx9DCiPPpeZAFOZWyH46Jk2cDPiZFRX1IvI7XrMdg2fsOvCRsYGMM25QadgC8KAeQIg5BblAajOL26v5Z4DPrb6m95wKWf/cTxhwAPgJskQAu/aUhAIB5+22J9aelQa0uOuFFQoRBCY2Soc4PNBDBMQVAGJ50amqVI8kYOH4F3FTZsyU9EvuLMs4q/NBP3SNT1Y2FPQyQcs0RYYT7JxYTZQgiAmoE/Ki/8E80DgO+RQYe8Nvx/v2P3wng9updALgAyEoEYrY/ejS4katyBegG2OfOEqpSX7s4K0QohgVUpSft+5VgR7BFsb/nEkxScByD/s31pB2IIOMSIETRE9YLF0wiOGMtwcUu4EoyyIAe79uyEsDwIhAsBSrrT6sAuyJ0i4KU6p9CAkpl9boBNuHT7iCw9vThJBJfe8erKrt2IZZjoWSIcTkLCTwVt6oC6nojwLKYvuoWIsUf1DsZRljn7m3PAPcMBY/GqIK8YU/IHTYs/+HHKQLYAd+tBCQkMIQA7L0AQAxo8bbjI1MXPiOIqMJNOgIEly4HmvsUIaUA7oQ0tD/LuBsAzTqC7XosUnAy/MwBZADtKTl1fjhB2aT19j9RCHAGOWTGyII/Gyos//HHAgEo5c8kAbv4X6m+lRDEmy73EtViSEA5pcFOIVTSMHIEAgTLVuvVceXVeFWwO3F+ByIW5zuxv1ZRRqL6d2TK64E1Y/9dIiDWfVB3veqPEcEThAARcDNgPKtNdC6Dw/lPP+Z+fxcWAOHbgM2FQKDsQ/wP+7TSo+qzsiAqk1apLmGoVUor4kTpcCCDALzZen1EQpbNp+QEjgNdiZWxN8t4pCKQUXeLOChZOFacEoFxTmzsYRIjEZwQAnjjRwCL7Hu0PxofLnVc1IM7gzxGE96vWgkAHwUWF8AWAuGDQOyhIAQ/KwPu+9t5KmVvJwXtMHSgE9BQfU0g7oMy2g4byb9ZMFtkwUCMhNDtJ2VDDVoNLBoSEBLpQBYB18kPpElkv9HM1XRzwFB85gzw2BaArX4uoRRAFYG7up+RQYYgKm5i+aof/RACiPK39wAAEbB3ArSq3v4Bl//qpcAa8Nt3QhAM7N0FE7DTSWc4goEUAAwm8Ky1CNYCG69syWr/BJBWLkArvWflL1H/iDwE2I6dH0hKJkeyYtCRFYCThSdZYLuEwo6hCGwGlE9FBsNx//OP2gkAwwBJBBoVgK4SsE8KyQWwuJ8RAoIdCQJvpMXqVnlQA3z4TpRdjsHA1IEo6hss7JFzQQDQYwaE0AHAUmMrSWgAmJKomuRH7D8DmOVWGMAjgHb7T8oBeORR2XcFOcyMyfps2776C/ocwPr7df8rkEMC23xS/0uQLgVm3IBOAHYni1ldneHVcSMJKdbJEYYOQU7BDR+M8VMZeQZUY1tHVNYxlQJnQgJNKNbk9tzGAFovx0CWDXurDkPF1+MVcgBZhzDbbgaoVWdQsftNaIHcNwLQIYCQgCh9SwaC2jfgQ/lPg92qAnQnokIB6gCUcrlVAqNsZqqco+xMtTM2/FTwVxyBofAsvGGgNe25UxqskgxV+ETIkCaCAgFEzkLmqdXuqZ1ARBam6gMAl6/5kSoEUPYfwa/fBNSeBQBi2MZW7wRox8skBgnYTUfgKLeA11O4KDk3gJ0pWzI00BOYxuhOeU9fhwXWqdg/Io7MfuJKKNhBfRrAJisAFJgH1wF4oPYAF4HxyP6oLwN6xhls/f7Lj7jf5dHf9hdeBNoRgJH5L4UB+2TSpBDmBADsCG5U9izYq+Sg25uKqqsJhnJ64JdrcC13Mfan14tAdDL76MhM0qmOFdh2fRxGJBZQoycKI7BkQZ5tFx0v2h+BPw30BrhXH7bweCOA/eWf+kUgFvjxKcChGqAAbuYADCLQ4N5O14j9I/DjftcGe1UDpn7Ogh2LhCrHfyzw098Hwews/aVkkMzkD8qd7JciggNJQItUjoC0CuAjxMLOMzz3r/3h4ADgLcDM+ktOwKwC4HJg9ZmV/RoXWaGBUv1TiYABO8ofWLHwRDLPBd8JCn8quLMWPeMkiPozK5/dNpBCkAPIgnwWiLP9QqAqBc8of6rN1/3wh4VA8gRg9AxARwI7iFgJUCcAKwlBFg50lQIdDoCbMC1rpYKQrBygW+kUMcjkR+CsxvHus/sReCPQRvsR0A74rPCBnXtK6ZVTsdzgYwK+ovaVthE5zCi/8MnydZ+vQgC1AIiFARveINHnJQMbNlHlAbDbiTj7NBmUiYCoNqsiDBNUT+YjoHaSh3Lz3BDBcivedkaSjvqa8X2ypBe+QEQBVl9vBHrmCCi4H7EKcJban00GFcJYvv6H9UlA+i4AXAuAZT/1WWf/LdXv8G6VAQkxlMHPMsJFJ3CJylugstTaU2FPdT3wZpQ9UZ4LiYvU/TswJ1xDRsWZ88v0a0oIFjtDNt7YEQCPEEc0dnX/AwGQ2P9oDkDCAvld9XdP9dEV4I3tbpaenMZ3V2lIn0yCSlv0wyTh1Nkz9p6ppxVGoFU2VV/UOqn+6NKiMbtzdQgmcgRv1P/hJlXdw/C7/dcfajsAifeFDESU27MB+wa5jzoUaOB3LD4SA4v9NVF4LgAnd3ehgeozAHugHianEx6wCR+FG2YeA294whVQYtjvWQRUMw9BlDIkG7b6j4VmVrusOp9s/y0ncJX6R+POAD4kiI0A4L8BQ+Uf3gfg2H/2MBBTfdP+C7vAzdaPAFfIwLSERHVoIoqUBjNKm3EDGVIwx8kAOFLuaL86hkkkxcU/jDgrSh8CUhG9B6iMzc+0iUB7xO6H4EWszLqBb/ghJARgTwKytwI7OYAhBHBcQDYckOtlTmFYABIA3XILbCEJ3QaE1ampsRItHTbsF+mqqpUryCzZzYA/QzJJN+ICPLFqLwPCI/F/aXy5N4YjiRT6akB7BGmd2/INP/ghBGjJPwL+1QnIfGf2X8CuQ4GGEZXoO9UFEOdwhAxYDiCtXE79ngKh2t7LFWTAHwAbSTEKEby2kaqznEHUJ6XmCUJJjaPUdFbFK4CvtI2IprJ/+caVAHQSkD0ObL0MxCgJbnNNqb7+XlX+KATYLlwdky4NZVaRxY/ZcMGLZwNHkCaXCPwZ1bbOBZXNyS0wkJruSKmll1w9CsrHdACzZOBdYwWwYj7CcAhcijf+8o0/KHYAkgzs/u4Trqm+/g7gKYUDRNG7F4jKhTlAbz+SbgNjdz+g0S5yA0wFO5AQAnHVzwOoZ/vPAn8yMeclKSMlPwOspm1nhO2oeRZEM+0qgH8q9d/O8ZtWAig4AMGQuRDIWQ48JAUBkO3eRcDWuQSi+pETQOBSdpxQ/kjJI7IYljkrVXaBlajpZxbqeGrOQEDzGqA8OoywfvdqHP5+IICznEKFSDJOYhjvm35g0QEkFwIh2Bm4w3AgcAJ6MrV5R+y9BpcmCFQl+oOz8MByE0qNu/EK4UDkJBihWHF7Bvz4m5jAJct+I8Wn+6+I1a8YE0k4+OwBtaLwlbYZwIfjrQQwrP4jK/82+6+2y8q/IQmolR2SiNvvqFUc3x/A9jOwESfAgB6BnxGJFR6E9tWbhJ499ey9FUbIhDT6ejadAjwKMbSVtkgxY7kvAOuZjwFn1fvq0CACeAhucGPycejzzT9gdABYERheCLqDUQhh+0qeC2iYNcBvWf4wMWgQhE7+CdHoC04TAlFy0zkY6+41udAJkyANar8JKVIHEBFEspYfOZLIxofkmSEOr82B+H9WvWcIoALaStuILNj+bdtKAF4JUKu+uQpQx/5AFKj6NBwQeiLOYCCxKEegCELb++GHcCoCA2taYHXU0IrtXTJhjsd5kKcDpziDBEEgQZkkg+MBWVigiYjA/T3gZofjGI4kC+azwTszXgTaqwlgHX/5ls97tRRYVL2tADRCgUH1yYKgDofE4nc4VqDG/EGbE0ZiziMIF/yGYlCHYJEKKzviJLaOEWTbQ5CQpN9AAhcoP5JWGaBA8lmyKYHZI+FgldwMeLNhgncNlX0RWczufyAAWQqcjP2tCgACV+Z+t0RYAUmIpAOxEdtHTmDbTybBsHaAnIMmiuHmatcBk9m8iexcEgrqVgP2c6cxvFL+LMii2HkYJ5Er8H6TaeL4ANj/CKSPofiIowcH8P23COBGnwHQhOBVALxHg1l4kCED0mbIEVjqTIhk+4GT26dJIXAF0yGBQR4U6MR5ZNsNTkIRS0mVsa8ir+o4LnF4ZKvPYXKV3xWK/1o4gG/9/ioJKC8E9dyAAXaM75sDANDp+N8LA7p3CyjF1Y5B3xxKEsZ6AVo5SIDYZHMvGRUlqqLseLCSbzunpBVGMsy6hTA0icAWXf9sIjC45irZyPzKuJUjIH4KxR8cwLd+v50A1PMAmOzTnwXTYvkld7Bth5uM+9uBo3yAodKR8uP4HUEQ5dFtGYEM25QCDwQQqVAEzAgcQdx/JvipC4jICX50Cpxk/wzoorCkAsrM8WbHM0WCEGXU9qr9y0oAWwiglH8LCYz1/w3wqvznqr5BDhqsUwuEqg5BkUwHdgOI2yGsx02tHIHcaGd/pMQIbArMRF7hCGAwFMqAxWwTEdys+sO9zJzfjBuoKPVVba8lgGISsFsApElivyE45wdXADdNhwUdlkm8nnYCCeWXY+l439tecgvG5OxuZqSMjnPoJnwWYJETYUoenWOkaBP9M2C2yDML8my72fg/Am2FLKKxZvZvfb7t+77KAWxOwEj8NXUHp7DNb3QBCvwSAnSCq0MAQhiitugOcCzcbsX71qrAri9OXEY21nMGHUu9GnG4oQVncMg2Z8FPSDEFNMcVHemf6ssIidw3a6wsyM9oVwXhUQLwznkQMVIKbQRAV/45RKDJoAHcIQMhiwjUQwjQscer3hYh0BWBxhhCNCzej/ZZx9FuIsolHLbMFUWfAXIUviAY2ecKOUVjMTIoXH8EmAwhRSA/Cuoj/c255pHot33uQw6A5QFku5cLQGAjMSDmLCcw4BImixUaCDCZkntuwGtPCcABCx6nHBJkVDg7qSuvwEoAcQDIBPi9MTIAKyt59rcKyGWWHCr9IvJ4kv2NAII8gIC1Wwqs1wUAoi0yEABrx82UP+sGziCFDsgkHLDyBN1N80gjqCLg+CkQJOPqdn4BUOhEniENVJtE/2x8TduRa/IAmT1WBMSzxomO8yj7P/65r1YCotIPn0m8j28BFpVvwGdkoCRf2/gOd1k3MNgImIEEyBZZYEKJugVrHYEoi3EsTSzu5HEIZCCFyuQPnMIl4If7kgVMtt0hUkOCMj5XgVex7VM2XU3IlEAQxyPDdP0//n3GlYAh+FWs370OXBbbqWSfblNxAlbbsuUPyMLLBeA9YLafTZruB8+AO2vps+32650Flqem4b4T1d881oyreWICqJLL1e2XjQDkjUDkmX+d5WffEVeWE0CBNJU/qfq6f0eQBdVv/Qw1tdyCBWzGsDJGqBIZgiCAzjqK0kQ6A1hnjOGBNUEwIUmd5AAqxyndB0PFw7nkOAY9R5ePf+9XSUBGBAJudAVt234Ttn37xi4ESGyTE0rnAIBtBqwfAD/+Zl68r8nGdA3RykEsy2TtfJYkKsfWk+wM4GavJwnA2fj/CDCPgqzSPwoLov1HSOUVAeBKwGgtgJH80+AfbL8OC9A66Od0gFy0UiuCa+Sjt0cKboYQRGmHsR0w4vmGE0GRltk+AapuIlTbG9dcDh8mxpkCauL6wt/eUcojfY8AUiv0Wd+tc3ogAA/8xsKfDuykTVP2/YO1GlCLNnUCiii0Cpu7LUfgjUf2WTG/JgXLORwFtbkE2VLQRNKPTgiHjNKASBw7PZZ2J0Vnc+Q4ugsk6gAAG0BJREFUVVKKQH/muZxKCp/4Xv3DQGLn0fI3sEerAPVTghAaaFyllgcDi1Asq43t6yzwI2IIKgHiOFKWjZyjZ3XZBMuAOJqYbTJVwwuDfIb/l8FR2cy5VX6Ts0HmZdunz90i7eClJZnjZdoMv1EjAMcFbLiYAT+x8TpX0DCeAHPXxAA5XTug7YiW7on9NPYPwgLtEEKiSNjcTg2y4YSehCeBv+xUZid98ne5khCmwHaQDGeOGfVZVgKwqgAiiBH4U2XAfTCco1qxNcAZxiOAm+J/kSvwEoYU4Anl325ath0hr5BYNPDYq9Sr4LzY+reJfBZZVa/vhPYRGGf2Z/p4bZZPfM++CmCFAF4YIETR/upnApw3AqUJAQ4ShQPD/ovA3wjdANDwwxvKZbVjN45uSwI427eqnIywpsbIKOT7iAAy4Ix+p5kxMn2kzSsCCKoA+AiwJoOOAJTtF8vPSAK3NSFLhAJdPwLuTKiwHc8jhsx+1YaGBSRxJdeadQgWETBVTJNG0mVEE3TbXww9yg6lmPzL/gapawNSitpXgIdcF40783tlzmUd94EAEiVAuc8m+HWOoCH61fxAy19R/mplAElHicqrryeD3wM1fVkpm1gBkOgxHEV0gZA4VnpiFlQ5MzHNNoXjpM+9APBozKuI59BvpgAwJgE/B0KA6CWgrP7vZP4bWcBJZJYEI1FYQuzlAtw8gTFg2jXs12I+diz7gQA9tu/2GaRkOQvrfYapiZgNR6znyMn1zQCkpG7GOZfG0PenQAAZIM6cS2bcq9osnxAC0C6AgH14+Ie9EIQQwoY5FRo0HAbbKY5In3Yf2QtHEGVWiGEAVhHow1cHPHgeJnAZqAIll3GrSUdKBkdyBmQF41WTsxv3LMK6mAAe5bdwSKt6/AcCMEIAmevrbz88A7Dv1CofVQQ66w9ftAJrMdSuAHD46ucIiEGDeRDcKCwgB43KgZYa47l4biIav0QyybjfOufhWGcRiQHK7nivKQFUATcQ+Ylgnhl7+cT3sEOARgDO038dATjZ/w74AKTM9q05AScjBY8YEHRVy4/Kr4mEKZXbRnaSa/IAvR3HISk3CZkkr3AMOPeM3c2SiTtWAfyzgDyz3+xYZ/6e6XPoCMBZ9tuAboB8cALKIbT5x54H2CeVBrkGOHUFHjFQNlBJ6wnVZ+AWgogA3Fg6cVymuJ1zME/kYQdT0CwgXTUpEFdmUodtCgQQjrVf2NXtMuNn2lTu18x4rxyACgO8sp+n+ts+A+Rs+a+0Z1jFfXS/ASLLGQxjJEAYlgpn1FwdN0UazloDD6wR4aQVH4GTPP+ZCUkn/MmhxtWgsu7H7O9x5fkun/hsFQKw5B+AGsGfjfc9UrDIYjukmmjatlv4taoAFduvyccFWYJIvOSdFvIo7s8Avps0ScBaE606VoVUdFvL9byO4Inc2PvhnEcC2CfL+mf7p+P//ar1dgTsEA7AmJ1gFrZ36k36tXEjV8CshFwT3tEsqBPt2rDQNqX68GNl2kfEUQGmpcQR+VSOkQJIQf2vUMorxkxdd1R+hbl6aLzmAMhCnuEZAKPmrxW+EYAFcGtpsLM9dATgUrSiMvLQbSruYArQCaKIAJxyCjgxnGN6hGLuyy55npicFuEcJZSjAD7aPwvOK46TGfPBAej4nz3959T8B8VXYMR5aK4HIACOLD8DLZvzlp2nZiAB1G1+J9pVbD8jrdR6Awts5PymQL+Pf6j6EBCCNVHN/7iV/lgq6XkWCcn1k2NmwX2UxLLHyQBeLkPGXD7x3cccQGbdP1P9UPmt5CAAqiMLOVvD8re2XkjggHXASALUWfAzl4BzKLT0wblk+kdt0vuNc6lMbBPkhtU9tMpRgfUogGaApfmi8lsdPd9S/44ASLyPQEelZwlATQqIPU/56ctB1MtEGI61slP1NybvU4LfELBXmxMZfzZGxnGkQY8HgB9rxkVM9XkK0imqfYUYqgRYAnHBEelxXzkAJwcg4EOFz9p+5hSasBPlZuGCMgIPIkwmiN50RjWg+22zDsFxHRnwR21cEKtzjADvTUx0OzMgjsY2VbEI/iq4ps+L3JiKslfPszJ2pS2exwMBZHMA+8Re709HAGxxELTtnACgWZNIa5ew/APY9c0xngno+qlBXHxfDP7tBlaOwSZjsn+GFLZJciAMOUQYRQI4dKxHBvWVJDAz9vKJz4rXAYjidiHA/sPRtQDWE4LGOwIt1e+2KxvgEsD7DPyotNPqXwQNO84ApIkxI3IJwXryMcPjnUAAVeCd1f6MaxsJgNX9WXjgKbzlCIwyX7vn3jJhpZCUAGBjRBCKTzjukoraOlfbp04iooTk04mFic4I6QiwvQkvp+XlL44cewYkZwF0uDZ1D2Ztu76VR8ZZPv5ZDxpOwwDr+X9P4ZV9b66B2HodRmgXnHEGrc8Tgz98B4GF4wJp0Bud7B+BqDu9fcxMn6hNaT+5llL/IsnNkMNMn9eZUDYC0M/5I2jXzxqowzaw9l1bZzsCl1p9I1zQJCHkhffeVH+HJBgA9HwysZYE4TA/Z/sZziECi+clPAXOKg62y5xLFHJMjZFU2ciVnA30GRJ4jD7Lxz/zVQ5AwFVa/rt3osAv5gIQ3A+25OFuenbefV6AlBLZeBb4U/hMNSLQC8gonPyzx7Xq7gapyObwfKJx4SfIOJmzjveYQM78VlW7PktU2eseCSCI9wegW5Y/SQwakDpksPYLM1juofVTQHFxE71NKGkJQmyGDTyt9qsFGeCYo8N5ZcfJtnMnsvo9smNm2mWBUHU50bFnjvvYY67H6wiAvvLLyQPgk3xWqKCFRZSdAbdti5KBilws8YrcAd70cgxfJYtAYQPI97uPEog62DbxCmNGE7UKJjx2duwz2kVjXLl/hiAihzEz5isCCFYByhzRCj0A37H92xjE1neuwtmP/V1nQBYKWfMbQ40MCKvtD5EMO6ErgBqMGQGBnWa6z37sdPujoUYUipy4f9a+R0A/c9zl277bXgXYRQABjsDUIK0Anym7DiW0m2CCaS0ZHsggafuzYO6GSwCQNkn0CwnojDESYUwFjDjcTL9osVHZTTwigCMgvu77txCAEkCy7s9IAcHI3IIGNoJwIAV0ppmwYD+4xgn9HoCpAuIQl0aDsF9nH0J6KDWo2v5DKk86zxy/QjCZtq9Tm+hcrtq/EUCn9M4LQIYwYL+x5mpABUgK8H0jgmH47IC/U38Sl1fBnwV+GryzuYILwd+GTl5ENPmyzNONkzx2xg7PklP2ujLtHqtNdJxov3YljQBEibW1t7Y34CVW/Wngt3vv9MXxB4sPd5w5CBY+6PESTvihCUzU7JzF68uCwzrnSnKudCx1MZmJUxo/itWTP+bMeWX7PEW7s46ZGSdq00IA+uYfou4DkEG9vX2W7Weqz8gBccjcAQNPRfnNuUjcCQPB6a7BZIMqBI32SfBVjhZNtm6sxPFL48HglX5XtM2OeWa7zFhWm+VbP6NPAgrYXOX3VH8fwFT9qEqg+rvq76izRxQZfEVlQXcOJ4nDBdgZY6TZKoZ6ZpLFo4iq8JZHj1Htf1X7K8bNjDnTZiCAyPLPxvs4LnUEiaW/HaifCPyReEXEkSGfM22/nO82OaKTTyP4QMOLQo/M5NdnfXWf6viZ9pk263Vm2m0hwOoAUK3NxUCBsrvEkFH9YI1AN3+zFYHki0M6UBog8bCDYcth0SUHOgW3pwxyAPiJ9wvMjp6Z7Gzsx+pXPU62/RntGgFYyt/IQVnS9au3DwHL6vc6RIjWASDIBntvOMvsSkAPwBZuuu0HQBuNUwUFPd+LwZ+diFc4kPSxyQ/52H2rx6u0z7bV7ZZvkRyAEddr694BP3IFmXyAE/NHlt8iAv2fjXju1wJ/Cvhq4AzOzDZO58y4mXxClUxObX/4IvqzyU547xqOjnGkf7VvpX2p7bd8eCIJKIpLXAFTfq322jl0feCOee00qC2HYIHfUt408GFgb26n5v0JawVmiOVUgHuDpX6E+GwqEzseLRcnXz3OzDVV+3jtl5UAEKAIOhO40WO+mZifOA5KBEG7DuCJhUADIcDkZPPUJIQDil21/dP4KXYsNs9g46HNgYGrkz1/UucRwHrMo+c527/abwwBdgLoSIAou1bjSNU98jD/81Ct/t7/IyAuRPocAH9F9be2pEM0x+l+tTEag03u11H55Zy2yTZzURUUH2xbBVDmcEfGfOy+yzfrEMBaCrzfTAbsiBwyYcGg/oSEAOu9sKi2oe2fUP3WJQnacN4XbH84lp6VB9xJZoKn25RPPD3yaQ2PAC5zEkfHP9I/03cjAAbgAegHFv9YBMEsPyqsPgcNbNaWgb+bh4QsNLHgjWV9Q4IxZoZFIubxghmWcRWZSVrgj/xwb8Df/VYZMEY/7hVjPBAAgIIqvKHGkfJ3Y0UEsl99+L4AaQcoxLmm593Z4Gfz2pvrw76kg5giBXIiV+EwHDdsEE336/efAaiZszzzuEfHWr7508k7ARXIEMjMGZhKnnkpKGnDxhu2ESWfAX8K0Jn/ZwBmgjn3E7Y/i5uIWDITM3uszFgdYV01cPVEgvZHwXP0dK46fmXc5Zs+nZcBN8BFqn10v7H8V5NMZ7kTVYHBoicBTMkgqaqhC3AaRHiJ9m8TccJZeBM4dUw2wIHrjABVmdjkJ2nDV8eJzuus/VeelzX2RgCDwnuLghxV74CbedQ3Uy5MvBQkUn53P7odreIJUFnzvdueGKdq+b3xLwF2NqE/zRxnweiDNc6VpLD+Uo0AGnjBWg92f6dVur2yNFhA59h4nEfb5+T6fw2MCPxU9ZV8mG3UXKNzn1yjnqIRZtz9RXIpinaIplkiCgd+08D9Bc4ihuUbMQRQkzXrDBAv4UNBcllR+IDK/Ejgb5MZZnVEIJ7V9J4M9EAdEUI7ZqZhVrkzZJawFslTegPvR/gFMiSxEYBW2PX7oPIROWTe+JsIHzoygS/6fDTwjiq/Bv8s8BmJAOfR2x6BxnMW1dDBIyxrTkbnt/VzGqX6PwIgjhxCX0MGXEeO9xh912t4IIAo5nfAj2o0kAaqeDLb341hHNcDf/QEoAvsI8lCA4nW5D/iAE5558ABxR/O/SDCD3a/DCuZ83q/E8HyDZ/mVAF2pCEoKcizdj5DJEIaVfAnlgJXwT/lApxS3wzoM2DLTNSK8mfHE+UvtS/A9apxM6fwlMeW81vJ5WrnsREAA/W2LQHsVMyfGKez/gr8Q1ignEXm8V8PzFXXYIHJUmY2mWbIwPq/EvWEzkzeTJuQNMgg2XEzIJwJb6rjHgp7zjrYI43D3MryX8EBWHZ+VvUtEmGAbseAGUSPWwT/2apvglntOAv0bRwDWRnAXdYmM/BkEvKpgZm8tEeC7nWH6QhgRvVdkColt9rKcT1ioC4gsP0V8LttjUnMwFkBvjXJhu2EFGcBEk3saL8cN5uHmD3PaMpnzzMax9v/GMc4cn5n9N0IANXXBWnmPQCi0Enwb8AO2mbAXwFw1fJXiKQBxLg7FYJAR8aGiyboZfvVwNFxMhN1ZoyZPplzie5hZYzXve3y9RICEBAOZJAEdQnQxpiuG3DWBWA//RnJhu5TdyskFTIDKwBPtU2qfwQGb3/Ut/utEo0TTUxczPSd6ZMF5pVjZ88hanfkHDcCiAC7HSAqFQJthi4icAlU8YMyImPtAcAOmLBtCHzCHikwR6GEvtMnVxQY6ZFD2vMt8TDTjFN5yj5Xgisa29t/BNSV4y5f/6nj04ADABNZfI8kqJor5XcVPwF+D7RybimSgF/PHDNQ5YhAPCC2vkl3EYF6VvlpP7VxZpJW+lTasntbAYLVduYcKse9evzoXJav+9RX6wBkMnUKfgH4U+VFDcTkcmANCAR/SBIF8M+CPOUUCDnijZwB9UyfDlSJmZpo0s3HTPtMm7McRMkNRcgK9s9e18HDDt03AugArx7qMfftQ0XKP+MmvD4U4HguhDi8PpV9mfUGTJFToJdrMGaGNWHO2u46iYCQjgAwC4RsuyxRZoA0c8xo3CvGjI7p3dvla4kD2Dqom06JIOsOEs8A4A9jOZCzwV9yBKpxBtSZNt01JY5h3cwzicA7p84VZGZech1AFhjZdjPneYTIop+iet7ReGed60YAFuBc9T8R/IPiF2N+Rh6RWtM+xEmIw/EmlEckacA6KnsGuL0JaO5LJv2ykztqF+2fBXV23LNApcc5cnyPCM4Yd/kv6ACyoM62q7wSTD+BaDiQlAuYLBNSIBeAGRGBSQbkTlZAf0bb4dySbqQ62TOTNtPGDVkIarJjnkkCR45Z/V1nHMPa5xUBwEQ/TfnhF3DHJC8TYa7gKPhLqg8Hi4Bd3W9ZbDZhzgB3ZYx2bs7szUzsqM3R/Y/pBqJzPZM0HgP4eD0bAaTi/WxeoBDvD6SQIAzG/K1bslJgEUF3o48+XUhi32EiFev8WYKYAjzOPBCDSFkicHj7o75Zlc+MQy4vurS2vzp+9ryvtveZ81i+5lPGMiBT3zRJ7J3Tig9UHvVxHYC6SxmQm22csVwC2q8lcgTbGGRWHQF4tq83KbYxjNkegWAW6NG4mUk84wYyx50Zt3K+FgFUzu2o+9gIIALeVeBHuxmdQxb8VeAP48IAEZCn9zvHsCZQFuDZdvQ4CeWPJudTE0F0fjNOoDLmEQKoHmfmWjRhLF8dOQA1KVygFpKDrwP4B7IwgDkNdOYIDJBlgXt2O7wPenJEE3IG7DN9qhM9Ou8rx5slgMo5zzoT5hY2AjBBfTL48cfZhs6+OhzOvANtArBpR5AA5mEiIHc5GjPrCLLEcIXyW5O3uj07sTNgybTJgjU7Vna8KtEebe/1X/6z5QAmwT+AnL1g9CD4hTzcsMAiDba9mPCLQEv3G2RlTfoMoDNtvEnZ+quBZlR6Buwzx7lCvTMAz7SZIYDsuFlyZCrvnddGAIMDCMDfgbxCFIkKgUcg2q6m1X3/VWj7yTUD7Ec1iSHhLrJEcAT0dLIVKxHRRKwSQQSAq/dH15PdX2030z76LRj4oz7LV2kHQJRqIAgB1GOD31DRChF0bR3lM8GcKO91fYvuwmJr73y8yeQSRlL5zwL1rOJHk/jo/oxyR8e4GtDZ41fPoyeAQhKvVBk4Q/kD8FdIYLvhCTLxQozIAWzDBwCLQB3tj87BnQwTyl8hgkrbzKSNAHD1/gxJZNtkrhfVPLo2rfyV9hsBlMH8RMpfBjn8MpbyZ8asEEEbT/1GFZWOgB/tD13EBcpfBfwVbiCa+FfvrwA7OpfKWLNksZ7D8p8+lFwI9AS2H1U0A1Rp47YlwLTaTwF/7xSB9Oj+I+pfeX15SCYGyWYm5etGAhlQPmabqxwFjrsRgAaO+f0k5ccTcI+dBGuaHJLjReByCSNQ16PAj/qHgIUBKqrN2h7tH6ncFQQRgSoCeLQ/Gj+65gxxasufPSZrt/zHrAN4jcCfBjyG4RPPCZQdgAOuCLgeqUSEFIIeZt0VQD46pjeBryCBCMRX788CNjqPCplYx9wIIHQAB8GfVvwT3gNAgTQBflflme0l7qJCIDMgzwCvtQmcSZpECi82rTiECBTVsWbHi/pl9kdtzgT20bGW/xA5gNcc/K4bOAh8D8DdD3/kPygplhVLoL9Q+TPnESlUFdTV9rPOIgLw0f1HQRv9rjpE8I63EYDpAF5D8LuAP2j5o7GpSkMn/UNXvlfaZtxCa3Oh8lcAWWk7C9yzjpEFmAes2X3ZY2dIKNNm+feWA3hC8FeASNuS9QxZNbeOTfur38i6edkxI2BnVFc7kyPWPnO8yvhntI0m9WOSwBGQRy7g6P4skWwEMDiASfDjzTFdxX5m3f4CYCNyyCzwicZIkQUBv6fiFYWvtDVB9cjKnyWLqrqfBehZsM4CcbZfFrjR+BFRynGWf6cdwCT4GahSJBCAPwJrtx++6GOnQK3icVO5T3p+oAL0qG13fYScvImVAW/p+CoIzYxfPb8qkUSAuIIgZseMzjWzP9NmPb+NABpYXgPwlwAPE02vZjwT8BHJsMn7ZG6AzLoMAM9qU7H5Z6j7GWNkVLd6nCwAFVe2r5HCn7V/+crVAVSeAUALbyjhrPJ7LsIC9NaHKN4lDsBQVtMpOI7CIyg2ebxjzKr/DOgzfSok8NhtI2CeCfQjID3SN7pG3L985cvEOgAE/ZFXfSceCio7AMO1uIShriflFhySqQL2DMKgx0yofwbAnnupALYCpsx5PUaY8H4ILSoAjxzG8hUvi88C7Ee3VB5PjrZJuA02BgVp4EBSwM7E/cn1BBVV90A2tQ86RQCOCCuz/ygRZAF/lETOBLSnypXz9Igssy8igIp7WP7tTgAhcCfVuyOBE8DfLq4A/shVuERhAGsKpBeFBNH/gmRNqogoov2PRQJHj/MYJDBDDkeAPHs8fcxGAJaiVwHMwLZtS4Df7Kst+8HKgQX44fj7hizYz24XKbH8rmjzItAe3R+dU9WmZ53AB5UEZoE8228ggH+TdQAFADMgpQhGAZ0SAlHkSOGj/VZ4MRNCZPvMtuv6JQgqA9gqKWTBmAV3tl32uGcpvgWy6vZZpT8L5CgQlAA85a2qtwZ6RflDB5AEfwT4aL+21Fb7LIhn+kfAzfzHIhVgR22j8zmq/BVQZc61SgKV41fH9n6bWXI4q9/y5SoJiAMfBb9Xm7ccwXB8cQVE7QayIW8groI0s5KwOmYEHm9Cm/suUP+MEp/V5oiaV8B6VdsZEphR9Jk+FXLYCMAE0oTtb2OpCZoBq+kAjLFMsgDP4x33TOsfugohMnJuEUEM56lmRaSIV+/PnP8RwGfHrxzjyrZnksPlBPBlRhlwxrpnwW8CnWXJC0RymBCS5b4zwV5Wf+hwBNhH+lqW9rHdwVF1P9r/dQZ6ljiWlQC0SjIbPLRRilYFv0cC7Yc9WOrLAFWf94y9n+ljnZurdie8YnzquMS9PAUJHAVshqCs63oMsFeuzzvPaB8eZ/lS7QCU4jJVNckgUGurH1XuiVJfilSYFTdUtUIgR0nA67/tU7OjouBll2GEKVnQZ4EWXUPFps8es3KM15EEskoPt3T7KP02AojUO0UCk+CnoCWAzII7Au2w3yG8o6COzoUBioKCnKPrFBjJqRlQcQLVY2WJIjNuBaCvIwlUVX0G0NVjdATwMXEAAYBdEnhC8Ecgc/efGPNH5xFNdhOQRdt/ptpHCh3tj675CFE8JTFUjv2UriFz7GUlgOp/DNKRwUHwdxPfUeMjDoCCq5BfOOoEZvpr2x+BLavolXEyAM6obnTMzHEqoMuc09HxKv2rbTPAVYZO/ydUbXfkKP4/BnecprBuissAAAAASUVORK5CYII=",
                t
            }();
            e.TextureTools = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this._mode = t.FitFrustumSidesMode,
                    this._radiusScale = 1,
                    this._positionScale = .5,
                    this._defaultElevation = .3,
                    this._elevationReturnTime = 1500,
                    this._elevationReturnWaitTime = 1e3,
                    this._zoomStopsAnimation = !1,
                    this._framingTime = 1500,
                    this.autoCorrectCameraLimitsAndSensibility = !0,
                    this._isPointerDown = !1,
                    this._lastInteractionTime = -1 / 0,
                    this._animatables = new Array,
                    this._betaIsAnimating = !1
                }
                return Object.defineProperty(t.prototype, "name", {
                    get: function() {
                        return "Framing"
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "mode", {
                    get: function() {
                        return this._mode
                    },
                    set: function(e) {
                        this._mode = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "radiusScale", {
                    get: function() {
                        return this._radiusScale
                    },
                    set: function(e) {
                        this._radiusScale = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "positionScale", {
                    get: function() {
                        return this._positionScale
                    },
                    set: function(e) {
                        this._positionScale = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "defaultElevation", {
                    get: function() {
                        return this._defaultElevation
                    },
                    set: function(e) {
                        this._defaultElevation = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "elevationReturnTime", {
                    get: function() {
                        return this._elevationReturnTime
                    },
                    set: function(e) {
                        this._elevationReturnTime = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "elevationReturnWaitTime", {
                    get: function() {
                        return this._elevationReturnWaitTime
                    },
                    set: function(e) {
                        this._elevationReturnWaitTime = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "zoomStopsAnimation", {
                    get: function() {
                        return this._zoomStopsAnimation
                    },
                    set: function(e) {
                        this._zoomStopsAnimation = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "framingTime", {
                    get: function() {
                        return this._framingTime
                    },
                    set: function(e) {
                        this._framingTime = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.init = function() {}
                ,
                t.prototype.attach = function(r) {
                    var i = this;
                    this._attachedCamera = r;
                    var n = this._attachedCamera.getScene();
                    t.EasingFunction.setEasingMode(t.EasingMode),
                    this._onPrePointerObservableObserver = n.onPrePointerObservable.add((function(t) {
                        t.type !== e.PointerEventTypes.POINTERDOWN ? t.type === e.PointerEventTypes.POINTERUP && (i._isPointerDown = !1) : i._isPointerDown = !0
                    }
                    )),
                    this._onMeshTargetChangedObserver = r.onMeshTargetChangedObservable.add((function(e) {
                        e && i.zoomOnMesh(e)
                    }
                    )),
                    this._onAfterCheckInputsObserver = r.onAfterCheckInputsObservable.add((function() {
                        i._applyUserInteraction(),
                        i._maintainCameraAboveGround()
                    }
                    ))
                }
                ,
                t.prototype.detach = function() {
                    if (this._attachedCamera) {
                        var e = this._attachedCamera.getScene();
                        this._onPrePointerObservableObserver && e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),
                        this._onAfterCheckInputsObserver && this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),
                        this._onMeshTargetChangedObserver && this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),
                        this._attachedCamera = null
                    }
                }
                ,
                t.prototype.zoomOnMesh = function(e, t, r) {
                    void 0 === t && (t = !1),
                    void 0 === r && (r = null),
                    e.computeWorldMatrix(!0);
                    var i = e.getBoundingInfo().boundingBox;
                    this.zoomOnBoundingInfo(i.minimumWorld, i.maximumWorld, t, r)
                }
                ,
                t.prototype.zoomOnMeshHierarchy = function(e, t, r) {
                    void 0 === t && (t = !1),
                    void 0 === r && (r = null),
                    e.computeWorldMatrix(!0);
                    var i = e.getHierarchyBoundingVectors(!0);
                    this.zoomOnBoundingInfo(i.min, i.max, t, r)
                }
                ,
                t.prototype.zoomOnMeshesHierarchy = function(t, r, i) {
                    void 0 === r && (r = !1),
                    void 0 === i && (i = null);
                    for (var n = new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE), o = new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE), a = 0; a < t.length; a++) {
                        var s = t[a].getHierarchyBoundingVectors(!0);
                        e.Tools.CheckExtends(s.min, n, o),
                        e.Tools.CheckExtends(s.max, n, o)
                    }
                    this.zoomOnBoundingInfo(n, o, r, i)
                }
                ,
                t.prototype.zoomOnBoundingInfo = function(r, i, n, o) {
                    var a, s = this;
                    if (void 0 === n && (n = !1),
                    void 0 === o && (o = null),
                    this._attachedCamera) {
                        var y = r.y
                          , l = y + (i.y - y) * this._positionScale
                          , c = i.subtract(r).scale(.5);
                        if (n)
                            a = new e.Vector3(0,l,0);
                        else {
                            var h = r.add(c);
                            a = new e.Vector3(h.x,l,h.z)
                        }
                        this._vectorTransition || (this._vectorTransition = e.Animation.CreateAnimation("target", e.Animation.ANIMATIONTYPE_VECTOR3, 60, t.EasingFunction)),
                        this._betaIsAnimating = !0;
                        var u = e.Animation.TransitionTo("target", a, this._attachedCamera, this._attachedCamera.getScene(), 60, this._vectorTransition, this._framingTime);
                        u && this._animatables.push(u);
                        var d = 0;
                        if (this._mode === t.FitFrustumSidesMode) {
                            var x = this._calculateLowerRadiusFromModelBoundingSphere(r, i);
                            this.autoCorrectCameraLimitsAndSensibility && (this._attachedCamera.lowerRadiusLimit = c.length() + this._attachedCamera.minZ),
                            d = x
                        } else
                            this._mode === t.IgnoreBoundsSizeMode && (d = this._calculateLowerRadiusFromModelBoundingSphere(r, i),
                            this.autoCorrectCameraLimitsAndSensibility && null === this._attachedCamera.lowerRadiusLimit && (this._attachedCamera.lowerRadiusLimit = this._attachedCamera.minZ));
                        if (this.autoCorrectCameraLimitsAndSensibility) {
                            var p = i.subtract(r).length();
                            this._attachedCamera.panningSensibility = 5e3 / p,
                            this._attachedCamera.wheelPrecision = 100 / d
                        }
                        this._radiusTransition || (this._radiusTransition = e.Animation.CreateAnimation("radius", e.Animation.ANIMATIONTYPE_FLOAT, 60, t.EasingFunction)),
                        (u = e.Animation.TransitionTo("radius", d, this._attachedCamera, this._attachedCamera.getScene(), 60, this._radiusTransition, this._framingTime, (function() {
                            s.stopAllAnimations(),
                            o && o(),
                            s._attachedCamera && s._attachedCamera.useInputToRestoreState && s._attachedCamera.storeState()
                        }
                        ))) && this._animatables.push(u)
                    }
                }
                ,
                t.prototype._calculateLowerRadiusFromModelBoundingSphere = function(e, r) {
                    var i = r.subtract(e).length()
                      , n = this._getFrustumSlope()
                      , o = .5 * i * this._radiusScale
                      , a = o * Math.sqrt(1 + 1 / (n.x * n.x))
                      , s = o * Math.sqrt(1 + 1 / (n.y * n.y))
                      , y = Math.max(a, s)
                      , l = this._attachedCamera;
                    return l ? (l.lowerRadiusLimit && this._mode === t.IgnoreBoundsSizeMode && (y = y < l.lowerRadiusLimit ? l.lowerRadiusLimit : y),
                    l.upperRadiusLimit && (y = y > l.upperRadiusLimit ? l.upperRadiusLimit : y),
                    y) : 0
                }
                ,
                t.prototype._maintainCameraAboveGround = function() {
                    var r = this;
                    if (!(this._elevationReturnTime < 0)) {
                        var i = e.Tools.Now - this._lastInteractionTime
                          , n = .5 * Math.PI - this._defaultElevation
                          , o = .5 * Math.PI;
                        if (this._attachedCamera && !this._betaIsAnimating && this._attachedCamera.beta > o && i >= this._elevationReturnWaitTime) {
                            this._betaIsAnimating = !0,
                            this.stopAllAnimations(),
                            this._betaTransition || (this._betaTransition = e.Animation.CreateAnimation("beta", e.Animation.ANIMATIONTYPE_FLOAT, 60, t.EasingFunction));
                            var a = e.Animation.TransitionTo("beta", n, this._attachedCamera, this._attachedCamera.getScene(), 60, this._betaTransition, this._elevationReturnTime, (function() {
                                r._clearAnimationLocks(),
                                r.stopAllAnimations()
                            }
                            ));
                            a && this._animatables.push(a)
                        }
                    }
                }
                ,
                t.prototype._getFrustumSlope = function() {
                    var t = this._attachedCamera;
                    if (!t)
                        return e.Vector2.Zero();
                    var r = t.getScene().getEngine().getAspectRatio(t)
                      , i = Math.tan(t.fov / 2)
                      , n = i * r;
                    return new e.Vector2(n,i)
                }
                ,
                t.prototype._clearAnimationLocks = function() {
                    this._betaIsAnimating = !1
                }
                ,
                t.prototype._applyUserInteraction = function() {
                    this.isUserIsMoving && (this._lastInteractionTime = e.Tools.Now,
                    this.stopAllAnimations(),
                    this._clearAnimationLocks())
                }
                ,
                t.prototype.stopAllAnimations = function() {
                    for (this._attachedCamera && (this._attachedCamera.animations = []); this._animatables.length; )
                        this._animatables[0] && (this._animatables[0].onAnimationEnd = null,
                        this._animatables[0].stop()),
                        this._animatables.shift()
                }
                ,
                Object.defineProperty(t.prototype, "isUserIsMoving", {
                    get: function() {
                        return !!this._attachedCamera && (0 !== this._attachedCamera.inertialAlphaOffset || 0 !== this._attachedCamera.inertialBetaOffset || 0 !== this._attachedCamera.inertialRadiusOffset || 0 !== this._attachedCamera.inertialPanningX || 0 !== this._attachedCamera.inertialPanningY || this._isPointerDown)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.EasingFunction = new e.ExponentialEase,
                t.EasingMode = e.EasingFunction.EASINGMODE_EASEINOUT,
                t.IgnoreBoundsSizeMode = 0,
                t.FitFrustumSidesMode = 1,
                t
            }();
            e.FramingBehavior = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.transitionDuration = 450,
                    this.lowerRadiusTransitionRange = 2,
                    this.upperRadiusTransitionRange = -2,
                    this._autoTransitionRange = !1,
                    this._radiusIsAnimating = !1,
                    this._radiusBounceTransition = null,
                    this._animatables = new Array
                }
                return Object.defineProperty(t.prototype, "name", {
                    get: function() {
                        return "Bouncing"
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "autoTransitionRange", {
                    get: function() {
                        return this._autoTransitionRange
                    },
                    set: function(e) {
                        var t = this;
                        if (this._autoTransitionRange !== e) {
                            this._autoTransitionRange = e;
                            var r = this._attachedCamera;
                            r && (e ? this._onMeshTargetChangedObserver = r.onMeshTargetChangedObservable.add((function(e) {
                                if (e) {
                                    e.computeWorldMatrix(!0);
                                    var r = e.getBoundingInfo().diagonalLength;
                                    t.lowerRadiusTransitionRange = .05 * r,
                                    t.upperRadiusTransitionRange = .05 * r
                                }
                            }
                            )) : this._onMeshTargetChangedObserver && r.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))
                        }
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.init = function() {}
                ,
                t.prototype.attach = function(e) {
                    var t = this;
                    this._attachedCamera = e,
                    this._onAfterCheckInputsObserver = e.onAfterCheckInputsObservable.add((function() {
                        t._attachedCamera && (t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit) && t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),
                        t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit) && t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))
                    }
                    ))
                }
                ,
                t.prototype.detach = function() {
                    this._attachedCamera && (this._onAfterCheckInputsObserver && this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),
                    this._onMeshTargetChangedObserver && this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),
                    this._attachedCamera = null)
                }
                ,
                t.prototype._isRadiusAtLimit = function(e) {
                    return !!this._attachedCamera && (this._attachedCamera.radius === e && !this._radiusIsAnimating)
                }
                ,
                t.prototype._applyBoundRadiusAnimation = function(r) {
                    var i = this;
                    if (this._attachedCamera) {
                        this._radiusBounceTransition || (t.EasingFunction.setEasingMode(t.EasingMode),
                        this._radiusBounceTransition = e.Animation.CreateAnimation("radius", e.Animation.ANIMATIONTYPE_FLOAT, 60, t.EasingFunction)),
                        this._cachedWheelPrecision = this._attachedCamera.wheelPrecision,
                        this._attachedCamera.wheelPrecision = 1 / 0,
                        this._attachedCamera.inertialRadiusOffset = 0,
                        this.stopAllAnimations(),
                        this._radiusIsAnimating = !0;
                        var n = e.Animation.TransitionTo("radius", this._attachedCamera.radius + r, this._attachedCamera, this._attachedCamera.getScene(), 60, this._radiusBounceTransition, this.transitionDuration, (function() {
                            return i._clearAnimationLocks()
                        }
                        ));
                        n && this._animatables.push(n)
                    }
                }
                ,
                t.prototype._clearAnimationLocks = function() {
                    this._radiusIsAnimating = !1,
                    this._attachedCamera && (this._attachedCamera.wheelPrecision = this._cachedWheelPrecision)
                }
                ,
                t.prototype.stopAllAnimations = function() {
                    for (this._attachedCamera && (this._attachedCamera.animations = []); this._animatables.length; )
                        this._animatables[0].onAnimationEnd = null,
                        this._animatables[0].stop(),
                        this._animatables.shift()
                }
                ,
                t.EasingFunction = new e.BackEase(.3),
                t.EasingMode = e.EasingFunction.EASINGMODE_EASEOUT,
                t
            }();
            e.BouncingBehavior = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this._zoomStopsAnimation = !1,
                    this._idleRotationSpeed = .05,
                    this._idleRotationWaitTime = 2e3,
                    this._idleRotationSpinupTime = 2e3,
                    this._isPointerDown = !1,
                    this._lastFrameTime = null,
                    this._lastInteractionTime = -1 / 0,
                    this._cameraRotationSpeed = 0,
                    this._lastFrameRadius = 0
                }
                return Object.defineProperty(t.prototype, "name", {
                    get: function() {
                        return "AutoRotation"
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "zoomStopsAnimation", {
                    get: function() {
                        return this._zoomStopsAnimation
                    },
                    set: function(e) {
                        this._zoomStopsAnimation = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "idleRotationSpeed", {
                    get: function() {
                        return this._idleRotationSpeed
                    },
                    set: function(e) {
                        this._idleRotationSpeed = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "idleRotationWaitTime", {
                    get: function() {
                        return this._idleRotationWaitTime
                    },
                    set: function(e) {
                        this._idleRotationWaitTime = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "idleRotationSpinupTime", {
                    get: function() {
                        return this._idleRotationSpinupTime
                    },
                    set: function(e) {
                        this._idleRotationSpinupTime = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "rotationInProgress", {
                    get: function() {
                        return Math.abs(this._cameraRotationSpeed) > 0
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.init = function() {}
                ,
                t.prototype.attach = function(t) {
                    var r = this;
                    this._attachedCamera = t;
                    var i = this._attachedCamera.getScene();
                    this._onPrePointerObservableObserver = i.onPrePointerObservable.add((function(t) {
                        t.type !== e.PointerEventTypes.POINTERDOWN ? t.type === e.PointerEventTypes.POINTERUP && (r._isPointerDown = !1) : r._isPointerDown = !0
                    }
                    )),
                    this._onAfterCheckInputsObserver = t.onAfterCheckInputsObservable.add((function() {
                        var t = e.Tools.Now
                          , i = 0;
                        null != r._lastFrameTime && (i = t - r._lastFrameTime),
                        r._lastFrameTime = t,
                        r._applyUserInteraction();
                        var n = t - r._lastInteractionTime - r._idleRotationWaitTime
                          , o = Math.max(Math.min(n / r._idleRotationSpinupTime, 1), 0);
                        r._cameraRotationSpeed = r._idleRotationSpeed * o,
                        r._attachedCamera && (r._attachedCamera.alpha -= r._cameraRotationSpeed * (i / 1e3))
                    }
                    ))
                }
                ,
                t.prototype.detach = function() {
                    if (this._attachedCamera) {
                        var e = this._attachedCamera.getScene();
                        this._onPrePointerObservableObserver && e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),
                        this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),
                        this._attachedCamera = null
                    }
                }
                ,
                t.prototype._userIsZooming = function() {
                    return !!this._attachedCamera && 0 !== this._attachedCamera.inertialRadiusOffset
                }
                ,
                t.prototype._shouldAnimationStopForInteraction = function() {
                    if (!this._attachedCamera)
                        return !1;
                    var e = !1;
                    return this._lastFrameRadius === this._attachedCamera.radius && 0 !== this._attachedCamera.inertialRadiusOffset && (e = !0),
                    this._lastFrameRadius = this._attachedCamera.radius,
                    this._zoomStopsAnimation ? e : this._userIsZooming()
                }
                ,
                t.prototype._applyUserInteraction = function() {
                    this._userIsMoving() && !this._shouldAnimationStopForInteraction() && (this._lastInteractionTime = e.Tools.Now)
                }
                ,
                t.prototype._userIsMoving = function() {
                    return !!this._attachedCamera && (0 !== this._attachedCamera.inertialAlphaOffset || 0 !== this._attachedCamera.inertialBetaOffset || 0 !== this._attachedCamera.inertialRadiusOffset || 0 !== this._attachedCamera.inertialPanningX || 0 !== this._attachedCamera.inertialPanningY || this._isPointerDown)
                }
                ,
                t
            }();
            e.AutoRotationBehavior = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                this.renderWidth = 512,
                this.renderHeight = 256,
                this.textureSize = 512,
                this.deterministicLockstep = !1,
                this.lockstepMaxSteps = 4
            };
            e.NullEngineOptions = t;
            var r = function(r) {
                function i(i) {
                    void 0 === i && (i = new t);
                    var n = r.call(this, null) || this;
                    return void 0 === i.deterministicLockstep && (i.deterministicLockstep = !1),
                    void 0 === i.lockstepMaxSteps && (i.lockstepMaxSteps = 4),
                    n._options = i,
                    n._caps = new e.EngineCapabilities,
                    n._caps.maxTexturesImageUnits = 16,
                    n._caps.maxVertexTextureImageUnits = 16,
                    n._caps.maxTextureSize = 512,
                    n._caps.maxCubemapTextureSize = 512,
                    n._caps.maxRenderTextureSize = 512,
                    n._caps.maxVertexAttribs = 16,
                    n._caps.maxVaryingVectors = 16,
                    n._caps.maxFragmentUniformVectors = 16,
                    n._caps.maxVertexUniformVectors = 16,
                    n._caps.standardDerivatives = !1,
                    n._caps.astc = null,
                    n._caps.s3tc = null,
                    n._caps.pvrtc = null,
                    n._caps.etc1 = null,
                    n._caps.etc2 = null,
                    n._caps.textureAnisotropicFilterExtension = null,
                    n._caps.maxAnisotropy = 0,
                    n._caps.uintIndices = !1,
                    n._caps.fragmentDepthSupported = !1,
                    n._caps.highPrecisionShaderSupported = !0,
                    n._caps.colorBufferFloat = !1,
                    n._caps.textureFloat = !1,
                    n._caps.textureFloatLinearFiltering = !1,
                    n._caps.textureFloatRender = !1,
                    n._caps.textureHalfFloat = !1,
                    n._caps.textureHalfFloatLinearFiltering = !1,
                    n._caps.textureHalfFloatRender = !1,
                    n._caps.textureLOD = !1,
                    n._caps.drawBuffersExtension = !1,
                    n._caps.depthTextureExtension = !1,
                    n._caps.vertexArrayObject = !1,
                    n._caps.instancedArrays = !1,
                    e.Tools.Log("Babylon.js null engine (v" + e.Engine.Version + ") launched"),
                    "undefined" == typeof URL && (URL = {
                        createObjectURL: function() {},
                        revokeObjectURL: function() {}
                    }),
                    "undefined" == typeof Blob && (Blob = function() {}
                    ),
                    n
                }
                return o(i, r),
                i.prototype.isDeterministicLockStep = function() {
                    return this._options.deterministicLockstep
                }
                ,
                i.prototype.getLockstepMaxSteps = function() {
                    return this._options.lockstepMaxSteps
                }
                ,
                i.prototype.getHardwareScalingLevel = function() {
                    return 1
                }
                ,
                i.prototype.createVertexBuffer = function(e) {
                    return {
                        capacity: 0,
                        references: 1,
                        is32Bits: !1
                    }
                }
                ,
                i.prototype.createIndexBuffer = function(e) {
                    return {
                        capacity: 0,
                        references: 1,
                        is32Bits: !1
                    }
                }
                ,
                i.prototype.clear = function(e, t, r, i) {
                    void 0 === i && (i = !1)
                }
                ,
                i.prototype.getRenderWidth = function(e) {
                    return void 0 === e && (e = !1),
                    !e && this._currentRenderTarget ? this._currentRenderTarget.width : this._options.renderWidth
                }
                ,
                i.prototype.getRenderHeight = function(e) {
                    return void 0 === e && (e = !1),
                    !e && this._currentRenderTarget ? this._currentRenderTarget.height : this._options.renderHeight
                }
                ,
                i.prototype.setViewport = function(e, t, r) {
                    this._cachedViewport = e
                }
                ,
                i.prototype.createShaderProgram = function(e, t, r, i) {
                    return {
                        transformFeedback: null,
                        __SPECTOR_rebuildProgram: null
                    }
                }
                ,
                i.prototype.getUniforms = function(e, t) {
                    return []
                }
                ,
                i.prototype.getAttributes = function(e, t) {
                    return []
                }
                ,
                i.prototype.bindSamplers = function(e) {
                    this._currentEffect = null
                }
                ,
                i.prototype.enableEffect = function(e) {
                    this._currentEffect = e,
                    e.onBind && e.onBind(e),
                    e._onBindObservable && e._onBindObservable.notifyObservers(e)
                }
                ,
                i.prototype.setState = function(e, t, r, i) {
                    void 0 === t && (t = 0),
                    void 0 === i && (i = !1)
                }
                ,
                i.prototype.setIntArray = function(e, t) {}
                ,
                i.prototype.setIntArray2 = function(e, t) {}
                ,
                i.prototype.setIntArray3 = function(e, t) {}
                ,
                i.prototype.setIntArray4 = function(e, t) {}
                ,
                i.prototype.setFloatArray = function(e, t) {}
                ,
                i.prototype.setFloatArray2 = function(e, t) {}
                ,
                i.prototype.setFloatArray3 = function(e, t) {}
                ,
                i.prototype.setFloatArray4 = function(e, t) {}
                ,
                i.prototype.setArray = function(e, t) {}
                ,
                i.prototype.setArray2 = function(e, t) {}
                ,
                i.prototype.setArray3 = function(e, t) {}
                ,
                i.prototype.setArray4 = function(e, t) {}
                ,
                i.prototype.setMatrices = function(e, t) {}
                ,
                i.prototype.setMatrix = function(e, t) {}
                ,
                i.prototype.setMatrix3x3 = function(e, t) {}
                ,
                i.prototype.setMatrix2x2 = function(e, t) {}
                ,
                i.prototype.setFloat = function(e, t) {}
                ,
                i.prototype.setFloat2 = function(e, t, r) {}
                ,
                i.prototype.setFloat3 = function(e, t, r, i) {}
                ,
                i.prototype.setBool = function(e, t) {}
                ,
                i.prototype.setFloat4 = function(e, t, r, i, n) {}
                ,
                i.prototype.setColor3 = function(e, t) {}
                ,
                i.prototype.setColor4 = function(e, t, r) {}
                ,
                i.prototype.setAlphaMode = function(t, r) {
                    void 0 === r && (r = !1),
                    this._alphaMode !== t && (this._alphaState.alphaBlend = t !== e.Engine.ALPHA_DISABLE,
                    r || this.setDepthWrite(t === e.Engine.ALPHA_DISABLE),
                    this._alphaMode = t)
                }
                ,
                i.prototype.bindBuffers = function(e, t, r) {}
                ,
                i.prototype.wipeCaches = function(e) {
                    this.preventCacheWipeBetweenFrames || (this.resetTextureCache(),
                    this._currentEffect = null,
                    e && (this._currentProgram = null,
                    this._stencilState.reset(),
                    this._depthCullingState.reset(),
                    this._alphaState.reset()),
                    this._cachedVertexBuffers = null,
                    this._cachedIndexBuffer = null,
                    this._cachedEffectForVertexBuffers = null)
                }
                ,
                i.prototype.draw = function(e, t, r, i) {}
                ,
                i.prototype.drawElementsType = function(e, t, r, i) {}
                ,
                i.prototype.drawArraysType = function(e, t, r, i) {}
                ,
                i.prototype._createTexture = function() {
                    return {}
                }
                ,
                i.prototype._releaseTexture = function(e) {}
                ,
                i.prototype.createTexture = function(t, r, i, n, o, a, s, y, l, c) {
                    void 0 === o && (o = e.Texture.TRILINEAR_SAMPLINGMODE),
                    void 0 === a && (a = null),
                    void 0 === s && (s = null),
                    void 0 === y && (y = null);
                    var h = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_URL)
                      , u = String(t);
                    return h.url = u,
                    h.generateMipMaps = !r,
                    h.samplingMode = o,
                    h.invertY = i,
                    h.baseWidth = this._options.textureSize,
                    h.baseHeight = this._options.textureSize,
                    h.width = this._options.textureSize,
                    h.height = this._options.textureSize,
                    c && (h.format = c),
                    h.isReady = !0,
                    a && a(),
                    this._internalTexturesCache.push(h),
                    h
                }
                ,
                i.prototype.createRenderTargetTexture = function(t, r) {
                    var i = new e.RenderTargetCreationOptions;
                    void 0 !== r && "object" == typeof r ? (i.generateMipMaps = r.generateMipMaps,
                    i.generateDepthBuffer = void 0 === r.generateDepthBuffer || r.generateDepthBuffer,
                    i.generateStencilBuffer = i.generateDepthBuffer && r.generateStencilBuffer,
                    i.type = void 0 === r.type ? e.Engine.TEXTURETYPE_UNSIGNED_INT : r.type,
                    i.samplingMode = void 0 === r.samplingMode ? e.Texture.TRILINEAR_SAMPLINGMODE : r.samplingMode) : (i.generateMipMaps = r,
                    i.generateDepthBuffer = !0,
                    i.generateStencilBuffer = !1,
                    i.type = e.Engine.TEXTURETYPE_UNSIGNED_INT,
                    i.samplingMode = e.Texture.TRILINEAR_SAMPLINGMODE);
                    var n = new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RENDERTARGET)
                      , o = t.width || t
                      , a = t.height || t;
                    return n._depthStencilBuffer = {},
                    n._framebuffer = {},
                    n.baseWidth = o,
                    n.baseHeight = a,
                    n.width = o,
                    n.height = a,
                    n.isReady = !0,
                    n.samples = 1,
                    n.generateMipMaps = !!i.generateMipMaps,
                    n.samplingMode = i.samplingMode,
                    n.type = i.type,
                    n._generateDepthBuffer = i.generateDepthBuffer,
                    n._generateStencilBuffer = !!i.generateStencilBuffer,
                    this._internalTexturesCache.push(n),
                    n
                }
                ,
                i.prototype.updateTextureSamplingMode = function(e, t) {
                    t.samplingMode = e
                }
                ,
                i.prototype.bindFramebuffer = function(e, t, r, i, n) {
                    this._currentRenderTarget && this.unBindFramebuffer(this._currentRenderTarget),
                    this._currentRenderTarget = e,
                    this._currentFramebuffer = e._MSAAFramebuffer ? e._MSAAFramebuffer : e._framebuffer,
                    this._cachedViewport && !n && this.setViewport(this._cachedViewport, r, i)
                }
                ,
                i.prototype.unBindFramebuffer = function(e, t, r) {
                    void 0 === t && (t = !1),
                    this._currentRenderTarget = null,
                    r && (e._MSAAFramebuffer && (this._currentFramebuffer = e._framebuffer),
                    r()),
                    this._currentFramebuffer = null
                }
                ,
                i.prototype.createDynamicVertexBuffer = function(e) {
                    return {
                        capacity: 1,
                        references: 1,
                        is32Bits: !1
                    }
                }
                ,
                i.prototype.updateDynamicTexture = function(e, t, r, i, n) {
                    void 0 === i && (i = !1)
                }
                ,
                i.prototype.getError = function() {
                    return 0
                }
                ,
                i.prototype._getUnpackAlignement = function() {
                    return 1
                }
                ,
                i.prototype._unpackFlipY = function(e) {}
                ,
                i.prototype.updateDynamicIndexBuffer = function(e, t, r) {
                    void 0 === r && (r = 0)
                }
                ,
                i.prototype.updateDynamicVertexBuffer = function(e, t, r, i) {}
                ,
                i.prototype._bindTextureDirectly = function(e, t) {
                    return this._boundTexturesCache[this._activeChannel] !== t && (this._boundTexturesCache[this._activeChannel] = t,
                    !0)
                }
                ,
                i.prototype._bindTexture = function(e, t) {
                    e < 0 || this._bindTextureDirectly(0, t)
                }
                ,
                i.prototype._releaseBuffer = function(e) {
                    return e.references--,
                    0 === e.references
                }
                ,
                i.prototype.releaseEffects = function() {}
                ,
                i.prototype.displayLoadingUI = function() {}
                ,
                i.prototype.hideLoadingUI = function() {}
                ,
                i.prototype._uploadCompressedDataToTextureDirectly = function(e, t, r, i, n, o, a) {
                    void 0 === o && (o = 0),
                    void 0 === a && (a = 0)
                }
                ,
                i.prototype._uploadDataToTextureDirectly = function(e, t, r, i) {
                    void 0 === r && (r = 0),
                    void 0 === i && (i = 0)
                }
                ,
                i.prototype._uploadArrayBufferViewToTexture = function(e, t, r, i) {
                    void 0 === r && (r = 0),
                    void 0 === i && (i = 0)
                }
                ,
                i.prototype._uploadImageToTexture = function(e, t, r, i) {
                    void 0 === r && (r = 0),
                    void 0 === i && (i = 0)
                }
                ,
                i
            }(e.Engine);
            e.NullEngine = r
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    this.engine = t,
                    this._captureGPUFrameTime = !1,
                    this._gpuFrameTime = new e.PerfCounter,
                    this._captureShaderCompilationTime = !1,
                    this._shaderCompilationTime = new e.PerfCounter,
                    this._onBeginFrameObserver = null,
                    this._onEndFrameObserver = null,
                    this._onBeforeShaderCompilationObserver = null,
                    this._onAfterShaderCompilationObserver = null
                }
                return Object.defineProperty(t.prototype, "gpuFrameTimeCounter", {
                    get: function() {
                        return this._gpuFrameTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "captureGPUFrameTime", {
                    get: function() {
                        return this._captureGPUFrameTime
                    },
                    set: function(e) {
                        var t = this;
                        e !== this._captureGPUFrameTime && (this._captureGPUFrameTime = e,
                        e ? (this._onBeginFrameObserver = this.engine.onBeginFrameObservable.add((function() {
                            t._gpuFrameTimeToken || (t._gpuFrameTimeToken = t.engine.startTimeQuery())
                        }
                        )),
                        this._onEndFrameObserver = this.engine.onEndFrameObservable.add((function() {
                            if (t._gpuFrameTimeToken) {
                                var e = t.engine.endTimeQuery(t._gpuFrameTimeToken);
                                e > -1 && (t._gpuFrameTimeToken = null,
                                t._gpuFrameTime.fetchNewFrame(),
                                t._gpuFrameTime.addCount(e, !0))
                            }
                        }
                        ))) : (this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),
                        this._onBeginFrameObserver = null,
                        this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),
                        this._onEndFrameObserver = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "shaderCompilationTimeCounter", {
                    get: function() {
                        return this._shaderCompilationTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "captureShaderCompilationTime", {
                    get: function() {
                        return this._captureShaderCompilationTime
                    },
                    set: function(e) {
                        var t = this;
                        e !== this._captureShaderCompilationTime && (this._captureShaderCompilationTime = e,
                        e ? (this._onBeforeShaderCompilationObserver = this.engine.onBeforeShaderCompilationObservable.add((function() {
                            t._shaderCompilationTime.fetchNewFrame(),
                            t._shaderCompilationTime.beginMonitoring()
                        }
                        )),
                        this._onAfterShaderCompilationObserver = this.engine.onAfterShaderCompilationObservable.add((function() {
                            t._shaderCompilationTime.endMonitoring()
                        }
                        ))) : (this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),
                        this._onBeforeShaderCompilationObserver = null,
                        this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),
                        this._onAfterShaderCompilationObserver = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.dispose = function() {
                    this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),
                    this._onBeginFrameObserver = null,
                    this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),
                    this._onEndFrameObserver = null,
                    this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),
                    this._onBeforeShaderCompilationObserver = null,
                    this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),
                    this._onAfterShaderCompilationObserver = null,
                    this.engine = null
                }
                ,
                t
            }();
            e.EngineInstrumentation = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t(t) {
                    var r = this;
                    this.scene = t,
                    this._captureActiveMeshesEvaluationTime = !1,
                    this._activeMeshesEvaluationTime = new e.PerfCounter,
                    this._captureRenderTargetsRenderTime = !1,
                    this._renderTargetsRenderTime = new e.PerfCounter,
                    this._captureFrameTime = !1,
                    this._frameTime = new e.PerfCounter,
                    this._captureRenderTime = !1,
                    this._renderTime = new e.PerfCounter,
                    this._captureInterFrameTime = !1,
                    this._interFrameTime = new e.PerfCounter,
                    this._captureParticlesRenderTime = !1,
                    this._particlesRenderTime = new e.PerfCounter,
                    this._captureSpritesRenderTime = !1,
                    this._spritesRenderTime = new e.PerfCounter,
                    this._capturePhysicsTime = !1,
                    this._physicsTime = new e.PerfCounter,
                    this._captureAnimationsTime = !1,
                    this._animationsTime = new e.PerfCounter,
                    this._captureCameraRenderTime = !1,
                    this._cameraRenderTime = new e.PerfCounter,
                    this._onBeforeActiveMeshesEvaluationObserver = null,
                    this._onAfterActiveMeshesEvaluationObserver = null,
                    this._onBeforeRenderTargetsRenderObserver = null,
                    this._onAfterRenderTargetsRenderObserver = null,
                    this._onAfterRenderObserver = null,
                    this._onBeforeDrawPhaseObserver = null,
                    this._onAfterDrawPhaseObserver = null,
                    this._onBeforeAnimationsObserver = null,
                    this._onBeforeParticlesRenderingObserver = null,
                    this._onAfterParticlesRenderingObserver = null,
                    this._onBeforeSpritesRenderingObserver = null,
                    this._onAfterSpritesRenderingObserver = null,
                    this._onBeforePhysicsObserver = null,
                    this._onAfterPhysicsObserver = null,
                    this._onAfterAnimationsObserver = null,
                    this._onBeforeCameraRenderObserver = null,
                    this._onAfterCameraRenderObserver = null,
                    this._onBeforeAnimationsObserver = t.onBeforeAnimationsObservable.add((function() {
                        r._captureActiveMeshesEvaluationTime && r._activeMeshesEvaluationTime.fetchNewFrame(),
                        r._captureRenderTargetsRenderTime && r._renderTargetsRenderTime.fetchNewFrame(),
                        r._captureFrameTime && (e.Tools.StartPerformanceCounter("Scene rendering"),
                        r._frameTime.beginMonitoring()),
                        r._captureInterFrameTime && r._interFrameTime.endMonitoring(),
                        r._captureParticlesRenderTime && r._particlesRenderTime.fetchNewFrame(),
                        r._captureSpritesRenderTime && r._spritesRenderTime.fetchNewFrame(),
                        r._captureAnimationsTime && r._animationsTime.beginMonitoring(),
                        r.scene.getEngine()._drawCalls.fetchNewFrame(),
                        r.scene.getEngine()._textureCollisions.fetchNewFrame()
                    }
                    )),
                    this._onAfterRenderObserver = t.onAfterRenderObservable.add((function() {
                        r._captureFrameTime && (e.Tools.EndPerformanceCounter("Scene rendering"),
                        r._frameTime.endMonitoring()),
                        r._captureRenderTime && r._renderTime.endMonitoring(!1),
                        r._captureInterFrameTime && r._interFrameTime.beginMonitoring()
                    }
                    ))
                }
                return Object.defineProperty(t.prototype, "activeMeshesEvaluationTimeCounter", {
                    get: function() {
                        return this._activeMeshesEvaluationTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "captureActiveMeshesEvaluationTime", {
                    get: function() {
                        return this._captureActiveMeshesEvaluationTime
                    },
                    set: function(t) {
                        var r = this;
                        t !== this._captureActiveMeshesEvaluationTime && (this._captureActiveMeshesEvaluationTime = t,
                        t ? (this._onBeforeActiveMeshesEvaluationObserver = this.scene.onBeforeActiveMeshesEvaluationObservable.add((function() {
                            e.Tools.StartPerformanceCounter("Active meshes evaluation"),
                            r._activeMeshesEvaluationTime.beginMonitoring()
                        }
                        )),
                        this._onAfterActiveMeshesEvaluationObserver = this.scene.onAfterActiveMeshesEvaluationObservable.add((function() {
                            e.Tools.EndPerformanceCounter("Active meshes evaluation"),
                            r._activeMeshesEvaluationTime.endMonitoring()
                        }
                        ))) : (this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),
                        this._onBeforeActiveMeshesEvaluationObserver = null,
                        this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),
                        this._onAfterActiveMeshesEvaluationObserver = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "renderTargetsRenderTimeCounter", {
                    get: function() {
                        return this._renderTargetsRenderTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "captureRenderTargetsRenderTime", {
                    get: function() {
                        return this._captureRenderTargetsRenderTime
                    },
                    set: function(t) {
                        var r = this;
                        t !== this._captureRenderTargetsRenderTime && (this._captureRenderTargetsRenderTime = t,
                        t ? (this._onBeforeRenderTargetsRenderObserver = this.scene.onBeforeRenderTargetsRenderObservable.add((function() {
                            e.Tools.StartPerformanceCounter("Render targets rendering"),
                            r._renderTargetsRenderTime.beginMonitoring()
                        }
                        )),
                        this._onAfterRenderTargetsRenderObserver = this.scene.onAfterRenderTargetsRenderObservable.add((function() {
                            e.Tools.EndPerformanceCounter("Render targets rendering"),
                            r._renderTargetsRenderTime.endMonitoring(!1)
                        }
                        ))) : (this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),
                        this._onBeforeRenderTargetsRenderObserver = null,
                        this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),
                        this._onAfterRenderTargetsRenderObserver = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "particlesRenderTimeCounter", {
                    get: function() {
                        return this._particlesRenderTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "captureParticlesRenderTime", {
                    get: function() {
                        return this._captureParticlesRenderTime
                    },
                    set: function(t) {
                        var r = this;
                        t !== this._captureParticlesRenderTime && (this._captureParticlesRenderTime = t,
                        t ? (this._onBeforeParticlesRenderingObserver = this.scene.onBeforeParticlesRenderingObservable.add((function() {
                            e.Tools.StartPerformanceCounter("Particles"),
                            r._particlesRenderTime.beginMonitoring()
                        }
                        )),
                        this._onAfterParticlesRenderingObserver = this.scene.onAfterParticlesRenderingObservable.add((function() {
                            e.Tools.EndPerformanceCounter("Particles"),
                            r._particlesRenderTime.endMonitoring(!1)
                        }
                        ))) : (this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),
                        this._onBeforeParticlesRenderingObserver = null,
                        this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),
                        this._onAfterParticlesRenderingObserver = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "spritesRenderTimeCounter", {
                    get: function() {
                        return this._spritesRenderTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "captureSpritesRenderTime", {
                    get: function() {
                        return this._captureSpritesRenderTime
                    },
                    set: function(t) {
                        var r = this;
                        t !== this._captureSpritesRenderTime && (this._captureSpritesRenderTime = t,
                        this.scene.spriteManagers && (t ? (this._onBeforeSpritesRenderingObserver = this.scene.onBeforeSpritesRenderingObservable.add((function() {
                            e.Tools.StartPerformanceCounter("Sprites"),
                            r._spritesRenderTime.beginMonitoring()
                        }
                        )),
                        this._onAfterSpritesRenderingObserver = this.scene.onAfterSpritesRenderingObservable.add((function() {
                            e.Tools.EndPerformanceCounter("Sprites"),
                            r._spritesRenderTime.endMonitoring(!1)
                        }
                        ))) : (this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),
                        this._onBeforeSpritesRenderingObserver = null,
                        this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),
                        this._onAfterSpritesRenderingObserver = null)))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "physicsTimeCounter", {
                    get: function() {
                        return this._physicsTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "capturePhysicsTime", {
                    get: function() {
                        return this._capturePhysicsTime
                    },
                    set: function(t) {
                        var r = this;
                        t !== this._capturePhysicsTime && this.scene.onBeforePhysicsObservable && (this._capturePhysicsTime = t,
                        t ? (this._onBeforePhysicsObserver = this.scene.onBeforePhysicsObservable.add((function() {
                            e.Tools.StartPerformanceCounter("Physics"),
                            r._physicsTime.beginMonitoring()
                        }
                        )),
                        this._onAfterPhysicsObserver = this.scene.onAfterPhysicsObservable.add((function() {
                            e.Tools.EndPerformanceCounter("Physics"),
                            r._physicsTime.endMonitoring()
                        }
                        ))) : (this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),
                        this._onBeforePhysicsObserver = null,
                        this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),
                        this._onAfterPhysicsObserver = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "animationsTimeCounter", {
                    get: function() {
                        return this._animationsTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "captureAnimationsTime", {
                    get: function() {
                        return this._captureAnimationsTime
                    },
                    set: function(e) {
                        var t = this;
                        e !== this._captureAnimationsTime && (this._captureAnimationsTime = e,
                        e ? this._onAfterAnimationsObserver = this.scene.onAfterAnimationsObservable.add((function() {
                            t._animationsTime.endMonitoring()
                        }
                        )) : (this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),
                        this._onAfterAnimationsObserver = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "frameTimeCounter", {
                    get: function() {
                        return this._frameTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "captureFrameTime", {
                    get: function() {
                        return this._captureFrameTime
                    },
                    set: function(e) {
                        this._captureFrameTime = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "interFrameTimeCounter", {
                    get: function() {
                        return this._interFrameTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "captureInterFrameTime", {
                    get: function() {
                        return this._captureInterFrameTime
                    },
                    set: function(e) {
                        this._captureInterFrameTime = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "renderTimeCounter", {
                    get: function() {
                        return this._renderTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "captureRenderTime", {
                    get: function() {
                        return this._captureRenderTime
                    },
                    set: function(t) {
                        var r = this;
                        t !== this._captureRenderTime && (this._captureRenderTime = t,
                        t ? (this._onBeforeDrawPhaseObserver = this.scene.onBeforeDrawPhaseObservable.add((function() {
                            r._renderTime.beginMonitoring(),
                            e.Tools.StartPerformanceCounter("Main render")
                        }
                        )),
                        this._onAfterDrawPhaseObserver = this.scene.onAfterDrawPhaseObservable.add((function() {
                            r._renderTime.endMonitoring(!1),
                            e.Tools.EndPerformanceCounter("Main render")
                        }
                        ))) : (this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),
                        this._onBeforeDrawPhaseObserver = null,
                        this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),
                        this._onAfterDrawPhaseObserver = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "cameraRenderTimeCounter", {
                    get: function() {
                        return this._cameraRenderTime
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "captureCameraRenderTime", {
                    get: function() {
                        return this._captureCameraRenderTime
                    },
                    set: function(t) {
                        var r = this;
                        t !== this._captureCameraRenderTime && (this._captureCameraRenderTime = t,
                        t ? (this._onBeforeCameraRenderObserver = this.scene.onBeforeCameraRenderObservable.add((function(t) {
                            r._cameraRenderTime.beginMonitoring(),
                            e.Tools.StartPerformanceCounter("Rendering camera " + t.name)
                        }
                        )),
                        this._onAfterCameraRenderObserver = this.scene.onAfterCameraRenderObservable.add((function(t) {
                            r._cameraRenderTime.endMonitoring(!1),
                            e.Tools.EndPerformanceCounter("Rendering camera " + t.name)
                        }
                        ))) : (this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),
                        this._onBeforeCameraRenderObserver = null,
                        this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),
                        this._onAfterCameraRenderObserver = null))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "drawCallsCounter", {
                    get: function() {
                        return this.scene.getEngine()._drawCalls
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "textureCollisionsCounter", {
                    get: function() {
                        return this.scene.getEngine()._textureCollisions
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.dispose = function() {
                    this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),
                    this._onAfterRenderObserver = null,
                    this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),
                    this._onBeforeActiveMeshesEvaluationObserver = null,
                    this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),
                    this._onAfterActiveMeshesEvaluationObserver = null,
                    this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),
                    this._onBeforeRenderTargetsRenderObserver = null,
                    this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),
                    this._onAfterRenderTargetsRenderObserver = null,
                    this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),
                    this._onBeforeAnimationsObserver = null,
                    this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),
                    this._onBeforeParticlesRenderingObserver = null,
                    this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),
                    this._onAfterParticlesRenderingObserver = null,
                    this._onBeforeSpritesRenderingObserver && (this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),
                    this._onBeforeSpritesRenderingObserver = null),
                    this._onAfterSpritesRenderingObserver && (this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),
                    this._onAfterSpritesRenderingObserver = null),
                    this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),
                    this._onBeforeDrawPhaseObserver = null,
                    this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),
                    this._onAfterDrawPhaseObserver = null,
                    this._onBeforePhysicsObserver && (this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),
                    this._onBeforePhysicsObserver = null),
                    this._onAfterPhysicsObserver && (this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),
                    this._onAfterPhysicsObserver = null),
                    this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),
                    this._onAfterAnimationsObserver = null,
                    this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),
                    this._onBeforeCameraRenderObserver = null,
                    this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),
                    this._onAfterCameraRenderObserver = null,
                    this.scene = null
                }
                ,
                t
            }();
            e.SceneInstrumentation = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                this._timeElapsedQueryEnded = !1
            };
            e._TimeToken = t
        }(s || (s = {})),
        function(e) {
            var t = function(e) {
                function t() {
                    var t = e.call(this) || this;
                    return t.DIFFUSE = !1,
                    t.DIFFUSEDIRECTUV = 0,
                    t.GAMMADIFFUSE = !1,
                    t.DIFFUSEHASALPHA = !1,
                    t.OPACITYFRESNEL = !1,
                    t.REFLECTIONBLUR = !1,
                    t.REFLECTIONFRESNEL = !1,
                    t.REFLECTIONFALLOFF = !1,
                    t.TEXTURELODSUPPORT = !1,
                    t.PREMULTIPLYALPHA = !1,
                    t.USERGBCOLOR = !1,
                    t.USEHIGHLIGHTANDSHADOWCOLORS = !1,
                    t.NOISE = !1,
                    t.REFLECTIONBGR = !1,
                    t.IMAGEPROCESSING = !1,
                    t.VIGNETTE = !1,
                    t.VIGNETTEBLENDMODEMULTIPLY = !1,
                    t.VIGNETTEBLENDMODEOPAQUE = !1,
                    t.TONEMAPPING = !1,
                    t.TONEMAPPING_ACES = !1,
                    t.CONTRAST = !1,
                    t.COLORCURVES = !1,
                    t.COLORGRADING = !1,
                    t.COLORGRADING3D = !1,
                    t.SAMPLER3DGREENDEPTH = !1,
                    t.SAMPLER3DBGRMAP = !1,
                    t.IMAGEPROCESSINGPOSTPROCESS = !1,
                    t.EXPOSURE = !1,
                    t.REFLECTION = !1,
                    t.REFLECTIONMAP_3D = !1,
                    t.REFLECTIONMAP_SPHERICAL = !1,
                    t.REFLECTIONMAP_PLANAR = !1,
                    t.REFLECTIONMAP_CUBIC = !1,
                    t.REFLECTIONMAP_PROJECTION = !1,
                    t.REFLECTIONMAP_SKYBOX = !1,
                    t.REFLECTIONMAP_SKYBOX_TRANSFORMED = !1,
                    t.REFLECTIONMAP_EXPLICIT = !1,
                    t.REFLECTIONMAP_EQUIRECTANGULAR = !1,
                    t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !1,
                    t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !1,
                    t.INVERTCUBICMAP = !1,
                    t.REFLECTIONMAP_OPPOSITEZ = !1,
                    t.LODINREFLECTIONALPHA = !1,
                    t.GAMMAREFLECTION = !1,
                    t.RGBDREFLECTION = !1,
                    t.EQUIRECTANGULAR_RELFECTION_FOV = !1,
                    t.MAINUV1 = !1,
                    t.MAINUV2 = !1,
                    t.UV1 = !1,
                    t.UV2 = !1,
                    t.CLIPPLANE = !1,
                    t.CLIPPLANE2 = !1,
                    t.CLIPPLANE3 = !1,
                    t.CLIPPLANE4 = !1,
                    t.POINTSIZE = !1,
                    t.FOG = !1,
                    t.NORMAL = !1,
                    t.NUM_BONE_INFLUENCERS = 0,
                    t.BonesPerMesh = 0,
                    t.INSTANCES = !1,
                    t.SHADOWFLOAT = !1,
                    t.rebuild(),
                    t
                }
                return o(t, e),
                t
            }(e.MaterialDefines)
              , r = function(r) {
                function i(t, i) {
                    var n = r.call(this, t, i) || this;
                    return n.primaryColor = e.Color3.White(),
                    n._primaryColorShadowLevel = 0,
                    n._primaryColorHighlightLevel = 0,
                    n.reflectionTexture = null,
                    n.reflectionBlur = 0,
                    n.diffuseTexture = null,
                    n._shadowLights = null,
                    n.shadowLights = null,
                    n.shadowLevel = 0,
                    n.sceneCenter = e.Vector3.Zero(),
                    n.opacityFresnel = !0,
                    n.reflectionFresnel = !1,
                    n.reflectionFalloffDistance = 0,
                    n.reflectionAmount = 1,
                    n.reflectionReflectance0 = .05,
                    n.reflectionReflectance90 = .5,
                    n.useRGBColor = !0,
                    n.enableNoise = !1,
                    n._fovMultiplier = 1,
                    n.useEquirectangularFOV = !1,
                    n._maxSimultaneousLights = 4,
                    n.maxSimultaneousLights = 4,
                    n._imageProcessingObserver = null,
                    n.switchToBGR = !1,
                    n._renderTargets = new e.SmartArray(16),
                    n._reflectionControls = e.Vector4.Zero(),
                    n._white = e.Color3.White(),
                    n._primaryShadowColor = e.Color3.Black(),
                    n._primaryHighlightColor = e.Color3.Black(),
                    n._attachImageProcessingConfiguration(null),
                    n.getRenderTargetTextures = function() {
                        return n._renderTargets.reset(),
                        n._diffuseTexture && n._diffuseTexture.isRenderTarget && n._renderTargets.push(n._diffuseTexture),
                        n._reflectionTexture && n._reflectionTexture.isRenderTarget && n._renderTargets.push(n._reflectionTexture),
                        n._renderTargets
                    }
                    ,
                    n
                }
                return o(i, r),
                Object.defineProperty(i.prototype, "_perceptualColor", {
                    get: function() {
                        return this.__perceptualColor
                    },
                    set: function(e) {
                        this.__perceptualColor = e,
                        this._computePrimaryColorFromPerceptualColor(),
                        this._markAllSubMeshesAsLightsDirty()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "primaryColorShadowLevel", {
                    get: function() {
                        return this._primaryColorShadowLevel
                    },
                    set: function(e) {
                        this._primaryColorShadowLevel = e,
                        this._computePrimaryColors(),
                        this._markAllSubMeshesAsLightsDirty()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "primaryColorHighlightLevel", {
                    get: function() {
                        return this._primaryColorHighlightLevel
                    },
                    set: function(e) {
                        this._primaryColorHighlightLevel = e,
                        this._computePrimaryColors(),
                        this._markAllSubMeshesAsLightsDirty()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "reflectionStandardFresnelWeight", {
                    set: function(e) {
                        var t = e;
                        t < .5 ? (t *= 2,
                        this.reflectionReflectance0 = i.StandardReflectance0 * t,
                        this.reflectionReflectance90 = i.StandardReflectance90 * t) : (t = 2 * t - 1,
                        this.reflectionReflectance0 = i.StandardReflectance0 + (1 - i.StandardReflectance0) * t,
                        this.reflectionReflectance90 = i.StandardReflectance90 + (1 - i.StandardReflectance90) * t)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "fovMultiplier", {
                    get: function() {
                        return this._fovMultiplier
                    },
                    set: function(e) {
                        isNaN(e) && (e = 1),
                        this._fovMultiplier = Math.max(0, Math.min(2, e))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype._attachImageProcessingConfiguration = function(e) {
                    var t = this;
                    e !== this._imageProcessingConfiguration && (this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),
                    this._imageProcessingConfiguration = e || this.getScene().imageProcessingConfiguration,
                    this._imageProcessingConfiguration && (this._imageProcessingObserver = this._imageProcessingConfiguration.onUpdateParameters.add((function(e) {
                        t._computePrimaryColorFromPerceptualColor(),
                        t._markAllSubMeshesAsImageProcessingDirty()
                    }
                    ))))
                }
                ,
                Object.defineProperty(i.prototype, "imageProcessingConfiguration", {
                    get: function() {
                        return this._imageProcessingConfiguration
                    },
                    set: function(e) {
                        this._attachImageProcessingConfiguration(e),
                        this._markAllSubMeshesAsTexturesDirty()
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraColorCurvesEnabled", {
                    get: function() {
                        return this.imageProcessingConfiguration.colorCurvesEnabled
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorCurvesEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraColorGradingEnabled", {
                    get: function() {
                        return this.imageProcessingConfiguration.colorGradingEnabled
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorGradingEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraToneMappingEnabled", {
                    get: function() {
                        return this._imageProcessingConfiguration.toneMappingEnabled
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.toneMappingEnabled = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraExposure", {
                    get: function() {
                        return this._imageProcessingConfiguration.exposure
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.exposure = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraContrast", {
                    get: function() {
                        return this._imageProcessingConfiguration.contrast
                    },
                    set: function(e) {
                        this._imageProcessingConfiguration.contrast = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraColorGradingTexture", {
                    get: function() {
                        return this._imageProcessingConfiguration.colorGradingTexture
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorGradingTexture = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "cameraColorCurves", {
                    get: function() {
                        return this.imageProcessingConfiguration.colorCurves
                    },
                    set: function(e) {
                        this.imageProcessingConfiguration.colorCurves = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(i.prototype, "hasRenderTargetTextures", {
                    get: function() {
                        return !(!this._diffuseTexture || !this._diffuseTexture.isRenderTarget) || !(!this._reflectionTexture || !this._reflectionTexture.isRenderTarget)
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                i.prototype.needAlphaTesting = function() {
                    return !0
                }
                ,
                i.prototype.needAlphaBlending = function() {
                    return this.alpha < 0 || null != this._diffuseTexture && this._diffuseTexture.hasAlpha
                }
                ,
                i.prototype.isReadyForSubMesh = function(r, i, n) {
                    var o = this;
                    if (void 0 === n && (n = !1),
                    i.effect && this.isFrozen && this._wasPreviouslyReady)
                        return !0;
                    i._materialDefines || (i._materialDefines = new t);
                    var a = this.getScene()
                      , s = i._materialDefines;
                    if (!this.checkReadyOnEveryCall && i.effect && s._renderId === a.getRenderId())
                        return !0;
                    var y = a.getEngine();
                    if (e.MaterialHelper.PrepareDefinesForLights(a, r, s, !1, this._maxSimultaneousLights),
                    s._needNormals = !0,
                    s._areTexturesDirty) {
                        if (s._needUVs = !1,
                        a.texturesEnabled) {
                            if (a.getEngine().getCaps().textureLOD && (s.TEXTURELODSUPPORT = !0),
                            this._diffuseTexture && e.StandardMaterial.DiffuseTextureEnabled) {
                                if (!this._diffuseTexture.isReadyOrNotBlocking())
                                    return !1;
                                e.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture, s, "DIFFUSE"),
                                s.DIFFUSEHASALPHA = this._diffuseTexture.hasAlpha,
                                s.GAMMADIFFUSE = this._diffuseTexture.gammaSpace,
                                s.OPACITYFRESNEL = this._opacityFresnel
                            } else
                                s.DIFFUSE = !1,
                                s.DIFFUSEHASALPHA = !1,
                                s.GAMMADIFFUSE = !1,
                                s.OPACITYFRESNEL = !1;
                            var l = this._reflectionTexture;
                            if (l && e.StandardMaterial.ReflectionTextureEnabled) {
                                if (!l.isReadyOrNotBlocking())
                                    return !1;
                                switch (s.REFLECTION = !0,
                                s.GAMMAREFLECTION = l.gammaSpace,
                                s.RGBDREFLECTION = l.isRGBD,
                                s.REFLECTIONBLUR = this._reflectionBlur > 0,
                                s.REFLECTIONMAP_OPPOSITEZ = this.getScene().useRightHandedSystem ? !l.invertZ : l.invertZ,
                                s.LODINREFLECTIONALPHA = l.lodLevelInAlpha,
                                s.EQUIRECTANGULAR_RELFECTION_FOV = this.useEquirectangularFOV,
                                s.REFLECTIONBGR = this.switchToBGR,
                                l.coordinatesMode === e.Texture.INVCUBIC_MODE && (s.INVERTCUBICMAP = !0),
                                s.REFLECTIONMAP_3D = l.isCube,
                                l.coordinatesMode) {
                                case e.Texture.EXPLICIT_MODE:
                                    s.REFLECTIONMAP_EXPLICIT = !0;
                                    break;
                                case e.Texture.PLANAR_MODE:
                                    s.REFLECTIONMAP_PLANAR = !0;
                                    break;
                                case e.Texture.PROJECTION_MODE:
                                    s.REFLECTIONMAP_PROJECTION = !0;
                                    break;
                                case e.Texture.SKYBOX_MODE:
                                    s.REFLECTIONMAP_SKYBOX = !0,
                                    s.REFLECTIONMAP_SKYBOX_TRANSFORMED = !l.getReflectionTextureMatrix().isIdentity();
                                    break;
                                case e.Texture.SPHERICAL_MODE:
                                    s.REFLECTIONMAP_SPHERICAL = !0;
                                    break;
                                case e.Texture.EQUIRECTANGULAR_MODE:
                                    s.REFLECTIONMAP_EQUIRECTANGULAR = !0;
                                    break;
                                case e.Texture.FIXED_EQUIRECTANGULAR_MODE:
                                    s.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !0;
                                    break;
                                case e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:
                                    s.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !0;
                                    break;
                                case e.Texture.CUBIC_MODE:
                                case e.Texture.INVCUBIC_MODE:
                                default:
                                    s.REFLECTIONMAP_CUBIC = !0
                                }
                                this.reflectionFresnel ? (s.REFLECTIONFRESNEL = !0,
                                s.REFLECTIONFALLOFF = this.reflectionFalloffDistance > 0,
                                this._reflectionControls.x = this.reflectionAmount,
                                this._reflectionControls.y = this.reflectionReflectance0,
                                this._reflectionControls.z = this.reflectionReflectance90,
                                this._reflectionControls.w = 1 / this.reflectionFalloffDistance) : (s.REFLECTIONFRESNEL = !1,
                                s.REFLECTIONFALLOFF = !1)
                            } else
                                s.REFLECTION = !1,
                                s.REFLECTIONFRESNEL = !1,
                                s.REFLECTIONFALLOFF = !1,
                                s.REFLECTIONBLUR = !1,
                                s.REFLECTIONMAP_3D = !1,
                                s.REFLECTIONMAP_SPHERICAL = !1,
                                s.REFLECTIONMAP_PLANAR = !1,
                                s.REFLECTIONMAP_CUBIC = !1,
                                s.REFLECTIONMAP_PROJECTION = !1,
                                s.REFLECTIONMAP_SKYBOX = !1,
                                s.REFLECTIONMAP_SKYBOX_TRANSFORMED = !1,
                                s.REFLECTIONMAP_EXPLICIT = !1,
                                s.REFLECTIONMAP_EQUIRECTANGULAR = !1,
                                s.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !1,
                                s.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !1,
                                s.INVERTCUBICMAP = !1,
                                s.REFLECTIONMAP_OPPOSITEZ = !1,
                                s.LODINREFLECTIONALPHA = !1,
                                s.GAMMAREFLECTION = !1,
                                s.RGBDREFLECTION = !1
                        }
                        s.PREMULTIPLYALPHA = this.alphaMode === e.Engine.ALPHA_PREMULTIPLIED || this.alphaMode === e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,
                        s.USERGBCOLOR = this._useRGBColor,
                        s.NOISE = this._enableNoise
                    }
                    if (s._areLightsDirty && (s.USEHIGHLIGHTANDSHADOWCOLORS = !this._useRGBColor && (0 !== this._primaryColorShadowLevel || 0 !== this._primaryColorHighlightLevel)),
                    s._areImageProcessingDirty && this._imageProcessingConfiguration) {
                        if (!this._imageProcessingConfiguration.isReady())
                            return !1;
                        this._imageProcessingConfiguration.prepareDefines(s)
                    }
                    if (e.MaterialHelper.PrepareDefinesForMisc(r, a, !1, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(r), s),
                    e.MaterialHelper.PrepareDefinesForFrameBoundValues(a, y, s, n),
                    e.MaterialHelper.PrepareDefinesForAttributes(r, s, !1, !0, !1) && r && (a.getEngine().getCaps().standardDerivatives || r.isVerticesDataPresent(e.VertexBuffer.NormalKind) || (r.createNormals(!0),
                    e.Tools.Warn("BackgroundMaterial: Normals have been created for the mesh: " + r.name))),
                    s.isDirty) {
                        s.markAsProcessed(),
                        a.resetCachedMaterial();
                        var c = new e.EffectFallbacks;
                        s.FOG && c.addFallback(0, "FOG"),
                        s.POINTSIZE && c.addFallback(1, "POINTSIZE"),
                        e.MaterialHelper.HandleFallbacksForShadows(s, c, this._maxSimultaneousLights),
                        s.NUM_BONE_INFLUENCERS > 0 && c.addCPUSkinningFallback(0, r);
                        var h = [e.VertexBuffer.PositionKind];
                        s.NORMAL && h.push(e.VertexBuffer.NormalKind),
                        s.UV1 && h.push(e.VertexBuffer.UVKind),
                        s.UV2 && h.push(e.VertexBuffer.UV2Kind),
                        e.MaterialHelper.PrepareAttributesForBones(h, r, s, c),
                        e.MaterialHelper.PrepareAttributesForInstances(h, s);
                        var u = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vFogInfos", "vFogColor", "pointSize", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "mBones", "vPrimaryColor", "vPrimaryColorShadow", "vReflectionInfos", "reflectionMatrix", "vReflectionMicrosurfaceInfos", "fFovMultiplier", "shadowLevel", "alpha", "vBackgroundCenter", "vReflectionControl", "vDiffuseInfos", "diffuseMatrix"]
                          , d = ["diffuseSampler", "reflectionSampler", "reflectionSamplerLow", "reflectionSamplerHigh"]
                          , x = ["Material", "Scene"];
                        e.ImageProcessingConfiguration && (e.ImageProcessingConfiguration.PrepareUniforms(u, s),
                        e.ImageProcessingConfiguration.PrepareSamplers(d, s)),
                        e.MaterialHelper.PrepareUniformsAndSamplersList({
                            uniformsNames: u,
                            uniformBuffersNames: x,
                            samplers: d,
                            defines: s,
                            maxSimultaneousLights: this._maxSimultaneousLights
                        });
                        var p = s.toString();
                        i.setEffect(a.getEngine().createEffect("background", {
                            attributes: h,
                            uniformsNames: u,
                            uniformBuffersNames: x,
                            samplers: d,
                            defines: p,
                            fallbacks: c,
                            onCompiled: function(e) {
                                o.onCompiled && o.onCompiled(e),
                                o.bindSceneUniformBuffer(e, a.getSceneUniformBuffer())
                            },
                            onError: this.onError,
                            indexParameters: {
                                maxSimultaneousLights: this._maxSimultaneousLights
                            }
                        }, y), s),
                        this.buildUniformLayout()
                    }
                    return !(!i.effect || !i.effect.isReady()) && (s._renderId = a.getRenderId(),
                    this._wasPreviouslyReady = !0,
                    !0)
                }
                ,
                i.prototype._computePrimaryColorFromPerceptualColor = function() {
                    this.__perceptualColor && (this._primaryColor.copyFrom(this.__perceptualColor),
                    this._primaryColor.toLinearSpaceToRef(this._primaryColor),
                    this._imageProcessingConfiguration && this._primaryColor.scaleToRef(1 / this._imageProcessingConfiguration.exposure, this._primaryColor),
                    this._computePrimaryColors())
                }
                ,
                i.prototype._computePrimaryColors = function() {
                    0 === this._primaryColorShadowLevel && 0 === this._primaryColorHighlightLevel || (this._primaryColor.scaleToRef(this._primaryColorShadowLevel, this._primaryShadowColor),
                    this._primaryColor.subtractToRef(this._primaryShadowColor, this._primaryShadowColor),
                    this._white.subtractToRef(this._primaryColor, this._primaryHighlightColor),
                    this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel, this._primaryHighlightColor),
                    this._primaryColor.addToRef(this._primaryHighlightColor, this._primaryHighlightColor))
                }
                ,
                i.prototype.buildUniformLayout = function() {
                    this._uniformBuffer.addUniform("vPrimaryColor", 4),
                    this._uniformBuffer.addUniform("vPrimaryColorShadow", 4),
                    this._uniformBuffer.addUniform("vDiffuseInfos", 2),
                    this._uniformBuffer.addUniform("vReflectionInfos", 2),
                    this._uniformBuffer.addUniform("diffuseMatrix", 16),
                    this._uniformBuffer.addUniform("reflectionMatrix", 16),
                    this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos", 3),
                    this._uniformBuffer.addUniform("fFovMultiplier", 1),
                    this._uniformBuffer.addUniform("pointSize", 1),
                    this._uniformBuffer.addUniform("shadowLevel", 1),
                    this._uniformBuffer.addUniform("alpha", 1),
                    this._uniformBuffer.addUniform("vBackgroundCenter", 3),
                    this._uniformBuffer.addUniform("vReflectionControl", 4),
                    this._uniformBuffer.create()
                }
                ,
                i.prototype.unbind = function() {
                    this._diffuseTexture && this._diffuseTexture.isRenderTarget && this._uniformBuffer.setTexture("diffuseSampler", null),
                    this._reflectionTexture && this._reflectionTexture.isRenderTarget && this._uniformBuffer.setTexture("reflectionSampler", null),
                    r.prototype.unbind.call(this)
                }
                ,
                i.prototype.bindOnlyWorldMatrix = function(e) {
                    this._activeEffect.setMatrix("world", e)
                }
                ,
                i.prototype.bindForSubMesh = function(t, r, i) {
                    var n = this.getScene()
                      , o = i._materialDefines;
                    if (o) {
                        var a = i.effect;
                        if (a) {
                            this._activeEffect = a,
                            this.bindOnlyWorldMatrix(t),
                            e.MaterialHelper.BindBonesParameters(r, this._activeEffect);
                            var s = this._mustRebind(n, a, r.visibility);
                            if (s) {
                                this._uniformBuffer.bindToEffect(a, "Material"),
                                this.bindViewProjection(a);
                                var y = this._reflectionTexture;
                                this._uniformBuffer.useUbo && this.isFrozen && this._uniformBuffer.isSync || (n.texturesEnabled && (this._diffuseTexture && e.StandardMaterial.DiffuseTextureEnabled && (this._uniformBuffer.updateFloat2("vDiffuseInfos", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level),
                                e.MaterialHelper.BindTextureMatrix(this._diffuseTexture, this._uniformBuffer, "diffuse")),
                                y && e.StandardMaterial.ReflectionTextureEnabled && (this._uniformBuffer.updateMatrix("reflectionMatrix", y.getReflectionTextureMatrix()),
                                this._uniformBuffer.updateFloat2("vReflectionInfos", y.level, this._reflectionBlur),
                                this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos", y.getSize().width, y.lodGenerationScale, y.lodGenerationOffset))),
                                this.shadowLevel > 0 && this._uniformBuffer.updateFloat("shadowLevel", this.shadowLevel),
                                this._uniformBuffer.updateFloat("alpha", this.alpha),
                                this.pointsCloud && this._uniformBuffer.updateFloat("pointSize", this.pointSize),
                                o.USEHIGHLIGHTANDSHADOWCOLORS ? (this._uniformBuffer.updateColor4("vPrimaryColor", this._primaryHighlightColor, 1),
                                this._uniformBuffer.updateColor4("vPrimaryColorShadow", this._primaryShadowColor, 1)) : this._uniformBuffer.updateColor4("vPrimaryColor", this._primaryColor, 1)),
                                this._uniformBuffer.updateFloat("fFovMultiplier", this._fovMultiplier),
                                n.texturesEnabled && (this._diffuseTexture && e.StandardMaterial.DiffuseTextureEnabled && this._uniformBuffer.setTexture("diffuseSampler", this._diffuseTexture),
                                y && e.StandardMaterial.ReflectionTextureEnabled && (o.REFLECTIONBLUR && o.TEXTURELODSUPPORT ? this._uniformBuffer.setTexture("reflectionSampler", y) : o.REFLECTIONBLUR ? (this._uniformBuffer.setTexture("reflectionSampler", y._lodTextureMid || y),
                                this._uniformBuffer.setTexture("reflectionSamplerLow", y._lodTextureLow || y),
                                this._uniformBuffer.setTexture("reflectionSamplerHigh", y._lodTextureHigh || y)) : this._uniformBuffer.setTexture("reflectionSampler", y),
                                o.REFLECTIONFRESNEL && (this._uniformBuffer.updateFloat3("vBackgroundCenter", this.sceneCenter.x, this.sceneCenter.y, this.sceneCenter.z),
                                this._uniformBuffer.updateFloat4("vReflectionControl", this._reflectionControls.x, this._reflectionControls.y, this._reflectionControls.z, this._reflectionControls.w)))),
                                e.MaterialHelper.BindClipPlane(this._activeEffect, n),
                                e.MaterialHelper.BindEyePosition(a, n)
                            }
                            !s && this.isFrozen || (n.lightsEnabled && e.MaterialHelper.BindLights(n, r, this._activeEffect, o, this._maxSimultaneousLights, !1),
                            this.bindView(a),
                            e.MaterialHelper.BindFogParameters(n, r, this._activeEffect, !0),
                            this._imageProcessingConfiguration && this._imageProcessingConfiguration.bind(this._activeEffect)),
                            this._uniformBuffer.update(),
                            this._afterBind(r, this._activeEffect)
                        }
                    }
                }
                ,
                i.prototype.dispose = function(e, t) {
                    void 0 === e && (e = !1),
                    void 0 === t && (t = !1),
                    t && (this.diffuseTexture && this.diffuseTexture.dispose(),
                    this.reflectionTexture && this.reflectionTexture.dispose()),
                    this._renderTargets.dispose(),
                    this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),
                    r.prototype.dispose.call(this, e)
                }
                ,
                i.prototype.clone = function(t) {
                    var r = this;
                    return e.SerializationHelper.Clone((function() {
                        return new i(t,r.getScene())
                    }
                    ), this)
                }
                ,
                i.prototype.serialize = function() {
                    var t = e.SerializationHelper.Serialize(this);
                    return t.customType = "BABYLON.BackgroundMaterial",
                    t
                }
                ,
                i.prototype.getClassName = function() {
                    return "BackgroundMaterial"
                }
                ,
                i.Parse = function(t, r, n) {
                    return e.SerializationHelper.Parse((function() {
                        return new i(t.name,r)
                    }
                    ), t, r, n)
                }
                ,
                i.StandardReflectance0 = .05,
                i.StandardReflectance90 = .5,
                n([e.serializeAsColor3()], i.prototype, "_primaryColor", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")], i.prototype, "primaryColor", void 0),
                n([e.serializeAsColor3()], i.prototype, "__perceptualColor", void 0),
                n([e.serialize()], i.prototype, "_primaryColorShadowLevel", void 0),
                n([e.serialize()], i.prototype, "_primaryColorHighlightLevel", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")], i.prototype, "primaryColorHighlightLevel", null),
                n([e.serializeAsTexture()], i.prototype, "_reflectionTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "reflectionTexture", void 0),
                n([e.serialize()], i.prototype, "_reflectionBlur", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "reflectionBlur", void 0),
                n([e.serializeAsTexture()], i.prototype, "_diffuseTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "diffuseTexture", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "shadowLights", void 0),
                n([e.serialize()], i.prototype, "_shadowLevel", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "shadowLevel", void 0),
                n([e.serializeAsVector3()], i.prototype, "_sceneCenter", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "sceneCenter", void 0),
                n([e.serialize()], i.prototype, "_opacityFresnel", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "opacityFresnel", void 0),
                n([e.serialize()], i.prototype, "_reflectionFresnel", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "reflectionFresnel", void 0),
                n([e.serialize()], i.prototype, "_reflectionFalloffDistance", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "reflectionFalloffDistance", void 0),
                n([e.serialize()], i.prototype, "_reflectionAmount", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "reflectionAmount", void 0),
                n([e.serialize()], i.prototype, "_reflectionReflectance0", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "reflectionReflectance0", void 0),
                n([e.serialize()], i.prototype, "_reflectionReflectance90", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "reflectionReflectance90", void 0),
                n([e.serialize()], i.prototype, "_useRGBColor", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "useRGBColor", void 0),
                n([e.serialize()], i.prototype, "_enableNoise", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "enableNoise", void 0),
                n([e.serialize()], i.prototype, "_maxSimultaneousLights", void 0),
                n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")], i.prototype, "maxSimultaneousLights", void 0),
                n([e.serializeAsImageProcessingConfiguration()], i.prototype, "_imageProcessingConfiguration", void 0),
                i
            }(e.PushMaterial);
            e.BackgroundMaterial = r
        }(s || (s = {}));
        a = this && this.__assign || function() {
            return (a = Object.assign || function(e) {
                for (var t, r = 1, i = arguments.length; r < i; r++)
                    for (var n in t = arguments[r])
                        Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]);
                return e
            }
            ).apply(this, arguments)
        }
        ;
        !function(e) {
            var t = function() {
                function t(r, i) {
                    var n = this;
                    this._errorHandler = function(e, t) {
                        n.onErrorObservable.notifyObservers({
                            message: e,
                            exception: t
                        })
                    }
                    ,
                    this._options = a({}, t._getDefaultOptions(), r),
                    this._scene = i,
                    this.onErrorObservable = new e.Observable,
                    this._setupBackground(),
                    this._setupImageProcessing()
                }
                return t._getDefaultOptions = function() {
                    return {
                        createGround: !0,
                        groundSize: 15,
                        groundTexture: this._groundTextureCDNUrl,
                        groundColor: new e.Color3(.2,.2,.3).toLinearSpace().scale(3),
                        groundOpacity: .9,
                        enableGroundShadow: !0,
                        groundShadowLevel: .5,
                        enableGroundMirror: !1,
                        groundMirrorSizeRatio: .3,
                        groundMirrorBlurKernel: 64,
                        groundMirrorAmount: 1,
                        groundMirrorFresnelWeight: 1,
                        groundMirrorFallOffDistance: 0,
                        groundMirrorTextureType: e.Engine.TEXTURETYPE_UNSIGNED_INT,
                        groundYBias: 1e-5,
                        createSkybox: !0,
                        skyboxSize: 20,
                        skyboxTexture: this._skyboxTextureCDNUrl,
                        skyboxColor: new e.Color3(.2,.2,.3).toLinearSpace().scale(3),
                        backgroundYRotation: 0,
                        sizeAuto: !0,
                        rootPosition: e.Vector3.Zero(),
                        setupImageProcessing: !0,
                        environmentTexture: this._environmentTextureCDNUrl,
                        cameraExposure: .8,
                        cameraContrast: 1.2,
                        toneMappingEnabled: !0
                    }
                }
                ,
                Object.defineProperty(t.prototype, "rootMesh", {
                    get: function() {
                        return this._rootMesh
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "skybox", {
                    get: function() {
                        return this._skybox
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "skyboxTexture", {
                    get: function() {
                        return this._skyboxTexture
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "skyboxMaterial", {
                    get: function() {
                        return this._skyboxMaterial
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "ground", {
                    get: function() {
                        return this._ground
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "groundTexture", {
                    get: function() {
                        return this._groundTexture
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "groundMirror", {
                    get: function() {
                        return this._groundMirror
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "groundMirrorRenderList", {
                    get: function() {
                        return this._groundMirror ? this._groundMirror.renderList : null
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(t.prototype, "groundMaterial", {
                    get: function() {
                        return this._groundMaterial
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.updateOptions = function(e) {
                    var t = a({}, this._options, e);
                    this._ground && !t.createGround && (this._ground.dispose(),
                    this._ground = null),
                    this._groundMaterial && !t.createGround && (this._groundMaterial.dispose(),
                    this._groundMaterial = null),
                    this._groundTexture && this._options.groundTexture != t.groundTexture && (this._groundTexture.dispose(),
                    this._groundTexture = null),
                    this._skybox && !t.createSkybox && (this._skybox.dispose(),
                    this._skybox = null),
                    this._skyboxMaterial && !t.createSkybox && (this._skyboxMaterial.dispose(),
                    this._skyboxMaterial = null),
                    this._skyboxTexture && this._options.skyboxTexture != t.skyboxTexture && (this._skyboxTexture.dispose(),
                    this._skyboxTexture = null),
                    this._groundMirror && !t.enableGroundMirror && (this._groundMirror.dispose(),
                    this._groundMirror = null),
                    this._scene.environmentTexture && this._options.environmentTexture != t.environmentTexture && this._scene.environmentTexture.dispose(),
                    this._options = t,
                    this._setupBackground(),
                    this._setupImageProcessing()
                }
                ,
                t.prototype.setMainColor = function(t) {
                    this.groundMaterial && (this.groundMaterial.primaryColor = t),
                    this.skyboxMaterial && (this.skyboxMaterial.primaryColor = t),
                    this.groundMirror && (this.groundMirror.clearColor = new e.Color4(t.r,t.g,t.b,1))
                }
                ,
                t.prototype._setupImageProcessing = function() {
                    this._options.setupImageProcessing && (this._scene.imageProcessingConfiguration.contrast = this._options.cameraContrast,
                    this._scene.imageProcessingConfiguration.exposure = this._options.cameraExposure,
                    this._scene.imageProcessingConfiguration.toneMappingEnabled = this._options.toneMappingEnabled,
                    this._setupEnvironmentTexture())
                }
                ,
                t.prototype._setupEnvironmentTexture = function() {
                    if (!this._scene.environmentTexture)
                        if (this._options.environmentTexture instanceof e.BaseTexture)
                            this._scene.environmentTexture = this._options.environmentTexture;
                        else {
                            var t = e.CubeTexture.CreateFromPrefilteredData(this._options.environmentTexture, this._scene);
                            this._scene.environmentTexture = t
                        }
                }
                ,
                t.prototype._setupBackground = function() {
                    this._rootMesh || (this._rootMesh = new e.Mesh("BackgroundHelper",this._scene)),
                    this._rootMesh.rotation.y = this._options.backgroundYRotation;
                    var t = this._getSceneSize();
                    this._options.createGround && (this._setupGround(t),
                    this._setupGroundMaterial(),
                    this._setupGroundDiffuseTexture(),
                    this._options.enableGroundMirror && this._setupGroundMirrorTexture(t),
                    this._setupMirrorInGroundMaterial()),
                    this._options.createSkybox && (this._setupSkybox(t),
                    this._setupSkyboxMaterial(),
                    this._setupSkyboxReflectionTexture()),
                    this._rootMesh.position.x = t.rootPosition.x,
                    this._rootMesh.position.z = t.rootPosition.z,
                    this._rootMesh.position.y = t.rootPosition.y
                }
                ,
                t.prototype._getSceneSize = function() {
                    var t = this
                      , r = this._options.groundSize
                      , i = this._options.skyboxSize
                      , n = this._options.rootPosition;
                    if (!this._scene.meshes || 1 === this._scene.meshes.length)
                        return {
                            groundSize: r,
                            skyboxSize: i,
                            rootPosition: n
                        };
                    var o = this._scene.getWorldExtends((function(e) {
                        return e !== t._ground && e !== t._rootMesh && e !== t._skybox
                    }
                    ))
                      , a = o.max.subtract(o.min);
                    if (this._options.sizeAuto) {
                        this._scene.activeCamera instanceof e.ArcRotateCamera && this._scene.activeCamera.upperRadiusLimit && (i = r = 2 * this._scene.activeCamera.upperRadiusLimit);
                        var s = a.length();
                        s > r && (i = r = 2 * s),
                        r *= 1.1,
                        i *= 1.5,
                        (n = o.min.add(a.scale(.5))).y = o.min.y - this._options.groundYBias
                    }
                    return {
                        groundSize: r,
                        skyboxSize: i,
                        rootPosition: n
                    }
                }
                ,
                t.prototype._setupGround = function(t) {
                    var r = this;
                    this._ground && !this._ground.isDisposed() || (this._ground = e.Mesh.CreatePlane("BackgroundPlane", t.groundSize, this._scene),
                    this._ground.rotation.x = Math.PI / 2,
                    this._ground.parent = this._rootMesh,
                    this._ground.onDisposeObservable.add((function() {
                        r._ground = null
                    }
                    ))),
                    this._ground.receiveShadows = this._options.enableGroundShadow
                }
                ,
                t.prototype._setupGroundMaterial = function() {
                    this._groundMaterial || (this._groundMaterial = new e.BackgroundMaterial("BackgroundPlaneMaterial",this._scene)),
                    this._groundMaterial.alpha = this._options.groundOpacity,
                    this._groundMaterial.alphaMode = e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,
                    this._groundMaterial.shadowLevel = this._options.groundShadowLevel,
                    this._groundMaterial.primaryColor = this._options.groundColor,
                    this._groundMaterial.useRGBColor = !1,
                    this._groundMaterial.enableNoise = !0,
                    this._ground && (this._ground.material = this._groundMaterial)
                }
                ,
                t.prototype._setupGroundDiffuseTexture = function() {
                    if (this._groundMaterial && !this._groundTexture)
                        if (this._options.groundTexture instanceof e.BaseTexture)
                            this._groundMaterial.diffuseTexture = this._options.groundTexture;
                        else {
                            var t = new e.Texture(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler);
                            t.gammaSpace = !1,
                            t.hasAlpha = !0,
                            this._groundMaterial.diffuseTexture = t
                        }
                }
                ,
                t.prototype._setupGroundMirrorTexture = function(t) {
                    var r = e.Texture.CLAMP_ADDRESSMODE;
                    if (!this._groundMirror && (this._groundMirror = new e.MirrorTexture("BackgroundPlaneMirrorTexture",{
                        ratio: this._options.groundMirrorSizeRatio
                    },this._scene,!1,this._options.groundMirrorTextureType,e.Texture.BILINEAR_SAMPLINGMODE,!0),
                    this._groundMirror.mirrorPlane = new e.Plane(0,-1,0,t.rootPosition.y),
                    this._groundMirror.anisotropicFilteringLevel = 1,
                    this._groundMirror.wrapU = r,
                    this._groundMirror.wrapV = r,
                    this._groundMirror.gammaSpace = !1,
                    this._groundMirror.renderList))
                        for (var i = 0; i < this._scene.meshes.length; i++) {
                            var n = this._scene.meshes[i];
                            n !== this._ground && n !== this._skybox && n !== this._rootMesh && this._groundMirror.renderList.push(n)
                        }
                    this._groundMirror.clearColor = new e.Color4(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),
                    this._groundMirror.adaptiveBlurKernel = this._options.groundMirrorBlurKernel
                }
                ,
                t.prototype._setupMirrorInGroundMaterial = function() {
                    this._groundMaterial && (this._groundMaterial.reflectionTexture = this._groundMirror,
                    this._groundMaterial.reflectionFresnel = !0,
                    this._groundMaterial.reflectionAmount = this._options.groundMirrorAmount,
                    this._groundMaterial.reflectionStandardFresnelWeight = this._options.groundMirrorFresnelWeight,
                    this._groundMaterial.reflectionFalloffDistance = this._options.groundMirrorFallOffDistance)
                }
                ,
                t.prototype._setupSkybox = function(t) {
                    var r = this;
                    this._skybox && !this._skybox.isDisposed() || (this._skybox = e.Mesh.CreateBox("BackgroundSkybox", t.skyboxSize, this._scene, void 0, e.Mesh.BACKSIDE),
                    this._skybox.onDisposeObservable.add((function() {
                        r._skybox = null
                    }
                    ))),
                    this._skybox.parent = this._rootMesh
                }
                ,
                t.prototype._setupSkyboxMaterial = function() {
                    this._skybox && (this._skyboxMaterial || (this._skyboxMaterial = new e.BackgroundMaterial("BackgroundSkyboxMaterial",this._scene)),
                    this._skyboxMaterial.useRGBColor = !1,
                    this._skyboxMaterial.primaryColor = this._options.skyboxColor,
                    this._skyboxMaterial.enableNoise = !0,
                    this._skybox.material = this._skyboxMaterial)
                }
                ,
                t.prototype._setupSkyboxReflectionTexture = function() {
                    this._skyboxMaterial && (this._skyboxTexture || (this._options.skyboxTexture instanceof e.BaseTexture ? this._skyboxMaterial.reflectionTexture = this._options.skyboxTexture : (this._skyboxTexture = new e.CubeTexture(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),
                    this._skyboxTexture.coordinatesMode = e.Texture.SKYBOX_MODE,
                    this._skyboxTexture.gammaSpace = !1,
                    this._skyboxMaterial.reflectionTexture = this._skyboxTexture)))
                }
                ,
                t.prototype.dispose = function() {
                    this._groundMaterial && this._groundMaterial.dispose(!0, !0),
                    this._skyboxMaterial && this._skyboxMaterial.dispose(!0, !0),
                    this._rootMesh.dispose(!1)
                }
                ,
                t._groundTextureCDNUrl = "https://assets.babylonjs.com/environments/backgroundGround.png",
                t._skyboxTextureCDNUrl = "https://assets.babylonjs.com/environments/backgroundSkybox.dds",
                t._environmentTextureCDNUrl = "https://assets.babylonjs.com/environments/environmentSpecular.env",
                t
            }();
            e.EnvironmentHelper = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {
                    this.systems = new Array
                }
                return Object.defineProperty(t.prototype, "emitterNode", {
                    get: function() {
                        return this._emitterNode
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.setEmitterAsSphere = function(t, r, i) {
                    this._emitterNode && this._emitterNode.dispose(),
                    this._emitterCreationOptions = {
                        kind: "Sphere",
                        options: t,
                        renderingGroupId: r
                    };
                    var n = e.MeshBuilder.CreateSphere("emitterSphere", {
                        diameter: t.diameter,
                        segments: t.segments
                    }, i);
                    n.renderingGroupId = r;
                    var o = new e.StandardMaterial("emitterSphereMaterial",i);
                    o.emissiveColor = t.color,
                    n.material = o;
                    for (var a = 0, s = this.systems; a < s.length; a++) {
                        s[a].emitter = n
                    }
                    this._emitterNode = n
                }
                ,
                t.prototype.start = function(e) {
                    for (var t = 0, r = this.systems; t < r.length; t++) {
                        var i = r[t];
                        e && (i.emitter = e),
                        i.start()
                    }
                }
                ,
                t.prototype.dispose = function() {
                    for (var e = 0, t = this.systems; e < t.length; e++) {
                        t[e].dispose()
                    }
                    this.systems = [],
                    this._emitterNode && (this._emitterNode.dispose(),
                    this._emitterNode = null)
                }
                ,
                t.prototype.serialize = function() {
                    for (var e = {
                        systems: []
                    }, t = 0, r = this.systems; t < r.length; t++) {
                        var i = r[t];
                        e.systems.push(i.serialize())
                    }
                    return this._emitterNode && (e.emitter = this._emitterCreationOptions),
                    e
                }
                ,
                t.Parse = function(r, i, n) {
                    void 0 === n && (n = !1);
                    var o = new t
                      , a = e.ParticleHelper.BaseAssetsUrl + "/textures/";
                    i = i || e.Engine.LastCreatedScene;
                    for (var s = 0, y = r.systems; s < y.length; s++) {
                        var l = y[s];
                        o.systems.push(n ? e.GPUParticleSystem.Parse(l, i, a, !0) : e.ParticleSystem.Parse(l, i, a, !0))
                    }
                    if (r.emitter) {
                        var c = r.emitter.options;
                        switch (r.emitter.kind) {
                        case "Sphere":
                            o.setEmitterAsSphere({
                                diameter: c.diameter,
                                segments: c.segments,
                                color: e.Color3.FromArray(c.color)
                            }, r.emitter.renderingGroupId, i)
                        }
                    }
                    return o
                }
                ,
                t
            }();
            e.ParticleSystemSet = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                function t() {}
                return t.CreateDefault = function(t, r, i, n) {
                    var o;
                    return void 0 === r && (r = 500),
                    void 0 === n && (n = !1),
                    (o = n ? new e.GPUParticleSystem("default system",{
                        capacity: r
                    },i) : new e.ParticleSystem("default system",r,i)).emitter = t,
                    o.particleTexture = new e.Texture("https://www.babylonjs.com/assets/Flare.png",o.getScene()),
                    o.createConeEmitter(.1, Math.PI / 4),
                    o.color1 = new e.Color4(1,1,1,1),
                    o.color2 = new e.Color4(1,1,1,1),
                    o.colorDead = new e.Color4(1,1,1,0),
                    o.minSize = .1,
                    o.maxSize = .1,
                    o.minEmitPower = 2,
                    o.maxEmitPower = 2,
                    o.updateSpeed = 1 / 60,
                    o.emitRate = 30,
                    o
                }
                ,
                t.CreateAsync = function(r, i, n) {
                    void 0 === n && (n = !1),
                    i || (i = e.Engine.LastCreatedScene);
                    var o = {};
                    return i._addPendingData(o),
                    new Promise((function(a, s) {
                        if (n && !e.GPUParticleSystem.IsSupported)
                            return i._removePendingData(o),
                            s("Particle system with GPU is not supported.");
                        e.Tools.LoadFile(t.BaseAssetsUrl + "/systems/" + r + ".json", (function(t, r) {
                            i._removePendingData(o);
                            var s = JSON.parse(t.toString());
                            return a(e.ParticleSystemSet.Parse(s, i, n))
                        }
                        ), void 0, void 0, void 0, (function(e, t) {
                            return i._removePendingData(o),
                            s("An error occured while the creation of your particle system. Check if your type '" + r + "' exists.")
                        }
                        ))
                    }
                    ))
                }
                ,
                t.ExportSet = function(t) {
                    for (var r = new e.ParticleSystemSet, i = 0, n = t; i < n.length; i++) {
                        var o = n[i];
                        r.systems.push(o)
                    }
                    return r
                }
                ,
                t.BaseAssetsUrl = "https://assets.babylonjs.com/particles",
                t
            }();
            e.ParticleHelper = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o) {
                    var a = t.call(this, r, o) || this;
                    a._useDirectMapping = !1,
                    r = r || "videoDome",
                    n.resolution = 0 | Math.abs(n.resolution) || 32,
                    n.clickToPlay = Boolean(n.clickToPlay),
                    n.autoPlay = void 0 === n.autoPlay || Boolean(n.autoPlay),
                    n.loop = void 0 === n.loop || Boolean(n.loop),
                    n.size = Math.abs(n.size) || (o.activeCamera ? .48 * o.activeCamera.maxZ : 1e3),
                    void 0 === n.useDirectMapping ? a._useDirectMapping = !0 : a._useDirectMapping = n.useDirectMapping,
                    a._setReady(!1);
                    var s = {
                        loop: n.loop,
                        autoPlay: n.autoPlay,
                        autoUpdateTexture: !0,
                        poster: n.poster
                    }
                      , y = a._material = new e.BackgroundMaterial(r + "_material",o)
                      , l = a._videoTexture = new e.VideoTexture(r + "_texture",i,o,!1,a._useDirectMapping,e.Texture.TRILINEAR_SAMPLINGMODE,s);
                    return a._mesh = e.Mesh.CreateSphere(r + "_mesh", n.resolution, n.size, o, !1, e.Mesh.BACKSIDE),
                    l.onLoadObservable.addOnce((function() {
                        a._setReady(!0)
                    }
                    )),
                    y.useEquirectangularFOV = !0,
                    y.fovMultiplier = 1,
                    y.opacityFresnel = !1,
                    a._useDirectMapping ? (l.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                    l.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    y.diffuseTexture = l) : (l.coordinatesMode = e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,
                    l.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                    y.reflectionTexture = l),
                    a._mesh.material = y,
                    a._mesh.parent = a,
                    n.clickToPlay && (o.onPointerUp = function() {
                        a._videoTexture.video.play()
                    }
                    ),
                    a
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "videoTexture", {
                    get: function() {
                        return this._videoTexture
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "fovMultiplier", {
                    get: function() {
                        return this._material.fovMultiplier
                    },
                    set: function(e) {
                        this._material.fovMultiplier = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.dispose = function(e, r) {
                    void 0 === r && (r = !1),
                    this._videoTexture.dispose(),
                    this._mesh.dispose(),
                    this._material.dispose(),
                    t.prototype.dispose.call(this, e, r)
                }
                ,
                r
            }(e.TransformNode);
            e.VideoDome = t
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a) {
                    void 0 === a && (a = null);
                    var s = t.call(this, r, o) || this;
                    s._useDirectMapping = !1,
                    s.onLoadErrorObservable = new e.Observable,
                    r = r || "photoDome",
                    n.resolution = 0 | Math.abs(n.resolution) || 32,
                    n.size = Math.abs(n.size) || (o.activeCamera ? .48 * o.activeCamera.maxZ : 1e3),
                    void 0 === n.useDirectMapping ? s._useDirectMapping = !0 : s._useDirectMapping = n.useDirectMapping,
                    s._setReady(!1);
                    var y = s._material = new e.BackgroundMaterial(r + "_material",o);
                    return s._mesh = e.Mesh.CreateSphere(r + "_mesh", n.resolution, n.size, o, !1, e.Mesh.BACKSIDE),
                    y.opacityFresnel = !1,
                    y.useEquirectangularFOV = !0,
                    y.fovMultiplier = 1,
                    s.photoTexture = new e.Texture(i,o,!0,!s._useDirectMapping,void 0,void 0,(function(e, t) {
                        s.onLoadErrorObservable.notifyObservers(e || "Unknown error occured"),
                        a && a(e, t)
                    }
                    )),
                    s.photoTexture.onLoadObservable.addOnce((function() {
                        s._setReady(!0)
                    }
                    )),
                    s._mesh.material = y,
                    s._mesh.parent = s,
                    s
                }
                return o(r, t),
                Object.defineProperty(r.prototype, "photoTexture", {
                    get: function() {
                        return this._photoTexture
                    },
                    set: function(t) {
                        this._photoTexture !== t && (this._photoTexture = t,
                        this._useDirectMapping ? (this._photoTexture.wrapU = e.Texture.CLAMP_ADDRESSMODE,
                        this._photoTexture.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                        this._material.diffuseTexture = this._photoTexture) : (this._photoTexture.coordinatesMode = e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,
                        this._photoTexture.wrapV = e.Texture.CLAMP_ADDRESSMODE,
                        this._material.reflectionTexture = this._photoTexture))
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                Object.defineProperty(r.prototype, "fovMultiplier", {
                    get: function() {
                        return this._material.fovMultiplier
                    },
                    set: function(e) {
                        this._material.fovMultiplier = e
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                r.prototype.dispose = function(e, r) {
                    void 0 === r && (r = !1),
                    this._photoTexture.dispose(),
                    this._mesh.dispose(),
                    this._material.dispose(),
                    this.onLoadErrorObservable.clear(),
                    t.prototype.dispose.call(this, e, r)
                }
                ,
                r
            }(e.TransformNode);
            e.PhotoDome = t
        }(s || (s = {})),
        function(e) {
            var t = function() {
                this.occlusionInternalRetryCounter = 0,
                this.isOcclusionQueryInProgress = !1,
                this.isOccluded = !1,
                this.occlusionRetryCount = -1,
                this.occlusionType = e.AbstractMesh.OCCLUSION_TYPE_NONE,
                this.occlusionQueryAlgorithmType = e.AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE
            };
            e.Engine.prototype.createQuery = function() {
                return this._gl.createQuery()
            }
            ,
            e.Engine.prototype.deleteQuery = function(e) {
                return this._gl.deleteQuery(e),
                this
            }
            ,
            e.Engine.prototype.isQueryResultAvailable = function(e) {
                return this._gl.getQueryParameter(e, this._gl.QUERY_RESULT_AVAILABLE)
            }
            ,
            e.Engine.prototype.getQueryResult = function(e) {
                return this._gl.getQueryParameter(e, this._gl.QUERY_RESULT)
            }
            ,
            e.Engine.prototype.beginOcclusionQuery = function(e, t) {
                var r = this._getGlAlgorithmType(e);
                return this._gl.beginQuery(r, t),
                this
            }
            ,
            e.Engine.prototype.endOcclusionQuery = function(e) {
                var t = this._getGlAlgorithmType(e);
                return this._gl.endQuery(t),
                this
            }
            ,
            e.Engine.prototype._createTimeQuery = function() {
                var e = this.getCaps().timerQuery;
                return e.createQueryEXT ? e.createQueryEXT() : this.createQuery()
            }
            ,
            e.Engine.prototype._deleteTimeQuery = function(e) {
                var t = this.getCaps().timerQuery;
                t.deleteQueryEXT ? t.deleteQueryEXT(e) : this.deleteQuery(e)
            }
            ,
            e.Engine.prototype._getTimeQueryResult = function(e) {
                var t = this.getCaps().timerQuery;
                return t.getQueryObjectEXT ? t.getQueryObjectEXT(e, t.QUERY_RESULT_EXT) : this.getQueryResult(e)
            }
            ,
            e.Engine.prototype._getTimeQueryAvailability = function(e) {
                var t = this.getCaps().timerQuery;
                return t.getQueryObjectEXT ? t.getQueryObjectEXT(e, t.QUERY_RESULT_AVAILABLE_EXT) : this.isQueryResultAvailable(e)
            }
            ,
            e.Engine.prototype.startTimeQuery = function() {
                var t = this.getCaps()
                  , r = t.timerQuery;
                if (!r)
                    return null;
                var i = new e._TimeToken;
                if (this._gl.getParameter(r.GPU_DISJOINT_EXT),
                t.canUseTimestampForTimerQuery)
                    i._startTimeQuery = this._createTimeQuery(),
                    r.queryCounterEXT(i._startTimeQuery, r.TIMESTAMP_EXT);
                else {
                    if (this._currentNonTimestampToken)
                        return this._currentNonTimestampToken;
                    i._timeElapsedQuery = this._createTimeQuery(),
                    r.beginQueryEXT ? r.beginQueryEXT(r.TIME_ELAPSED_EXT, i._timeElapsedQuery) : this._gl.beginQuery(r.TIME_ELAPSED_EXT, i._timeElapsedQuery),
                    this._currentNonTimestampToken = i
                }
                return i
            }
            ,
            e.Engine.prototype.endTimeQuery = function(e) {
                var t = this.getCaps()
                  , r = t.timerQuery;
                if (!r || !e)
                    return -1;
                if (t.canUseTimestampForTimerQuery) {
                    if (!e._startTimeQuery)
                        return -1;
                    e._endTimeQuery || (e._endTimeQuery = this._createTimeQuery(),
                    r.queryCounterEXT(e._endTimeQuery, r.TIMESTAMP_EXT))
                } else if (!e._timeElapsedQueryEnded) {
                    if (!e._timeElapsedQuery)
                        return -1;
                    r.endQueryEXT ? r.endQueryEXT(r.TIME_ELAPSED_EXT) : this._gl.endQuery(r.TIME_ELAPSED_EXT),
                    e._timeElapsedQueryEnded = !0
                }
                var i = this._gl.getParameter(r.GPU_DISJOINT_EXT)
                  , n = !1;
                if (e._endTimeQuery ? n = this._getTimeQueryAvailability(e._endTimeQuery) : e._timeElapsedQuery && (n = this._getTimeQueryAvailability(e._timeElapsedQuery)),
                n && !i) {
                    var o = 0;
                    if (t.canUseTimestampForTimerQuery) {
                        if (!e._startTimeQuery || !e._endTimeQuery)
                            return -1;
                        var a = this._getTimeQueryResult(e._startTimeQuery);
                        o = this._getTimeQueryResult(e._endTimeQuery) - a,
                        this._deleteTimeQuery(e._startTimeQuery),
                        this._deleteTimeQuery(e._endTimeQuery),
                        e._startTimeQuery = null,
                        e._endTimeQuery = null
                    } else {
                        if (!e._timeElapsedQuery)
                            return -1;
                        o = this._getTimeQueryResult(e._timeElapsedQuery),
                        this._deleteTimeQuery(e._timeElapsedQuery),
                        e._timeElapsedQuery = null,
                        e._timeElapsedQueryEnded = !1,
                        this._currentNonTimestampToken = null
                    }
                    return o
                }
                return -1
            }
            ,
            e.Engine.prototype._getGlAlgorithmType = function(t) {
                return t === e.AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE ? this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE : this._gl.ANY_SAMPLES_PASSED
            }
            ,
            Object.defineProperty(e.AbstractMesh.prototype, "isOcclusionQueryInProgress", {
                get: function() {
                    return this._occlusionDataStorage.isOcclusionQueryInProgress
                },
                enumerable: !1,
                configurable: !0
            }),
            Object.defineProperty(e.AbstractMesh.prototype, "_occlusionDataStorage", {
                get: function() {
                    return this.__occlusionDataStorage || (this.__occlusionDataStorage = new t),
                    this.__occlusionDataStorage
                },
                enumerable: !1,
                configurable: !0
            }),
            Object.defineProperty(e.AbstractMesh.prototype, "isOccluded", {
                get: function() {
                    return this._occlusionDataStorage.isOccluded
                },
                set: function(e) {
                    this._occlusionDataStorage.isOccluded = e
                },
                enumerable: !0,
                configurable: !0
            }),
            Object.defineProperty(e.AbstractMesh.prototype, "occlusionQueryAlgorithmType", {
                get: function() {
                    return this._occlusionDataStorage.occlusionQueryAlgorithmType
                },
                set: function(e) {
                    this._occlusionDataStorage.occlusionQueryAlgorithmType = e
                },
                enumerable: !0,
                configurable: !0
            }),
            Object.defineProperty(e.AbstractMesh.prototype, "occlusionType", {
                get: function() {
                    return this._occlusionDataStorage.occlusionType
                },
                set: function(e) {
                    this._occlusionDataStorage.occlusionType = e
                },
                enumerable: !0,
                configurable: !0
            }),
            Object.defineProperty(e.AbstractMesh.prototype, "occlusionRetryCount", {
                get: function() {
                    return this._occlusionDataStorage.occlusionRetryCount
                },
                set: function(e) {
                    this._occlusionDataStorage.occlusionRetryCount = e
                },
                enumerable: !0,
                configurable: !0
            }),
            e.AbstractMesh.prototype._checkOcclusionQuery = function() {
                var t = this._occlusionDataStorage;
                if (t.occlusionType === e.AbstractMesh.OCCLUSION_TYPE_NONE)
                    return t.isOccluded = !1,
                    !1;
                var r = this.getEngine();
                if (r.webGLVersion < 2)
                    return t.isOccluded = !1,
                    !1;
                if (!r.isQueryResultAvailable)
                    return t.isOccluded = !1,
                    !1;
                if (this.isOcclusionQueryInProgress && this._occlusionQuery)
                    if (r.isQueryResultAvailable(this._occlusionQuery)) {
                        var i = r.getQueryResult(this._occlusionQuery);
                        t.isOcclusionQueryInProgress = !1,
                        t.occlusionInternalRetryCounter = 0,
                        t.isOccluded = 1 !== i
                    } else {
                        if (t.occlusionInternalRetryCounter++,
                        !(-1 !== t.occlusionRetryCount && t.occlusionInternalRetryCounter > t.occlusionRetryCount))
                            return !1;
                        t.isOcclusionQueryInProgress = !1,
                        t.occlusionInternalRetryCounter = 0,
                        t.isOccluded = t.occlusionType !== e.AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC && t.isOccluded
                    }
                var n = this.getScene();
                if (n.getBoundingBoxRenderer) {
                    var o = n.getBoundingBoxRenderer();
                    this._occlusionQuery || (this._occlusionQuery = r.createQuery()),
                    r.beginOcclusionQuery(t.occlusionQueryAlgorithmType, this._occlusionQuery),
                    o.renderOcclusionBoundingBox(this),
                    r.endOcclusionQuery(t.occlusionQueryAlgorithmType),
                    this._occlusionDataStorage.isOcclusionQueryInProgress = !0
                }
                return t.isOccluded
            }
        }(s || (s = {})),
        function(e) {
            var t = function(t) {
                function r(r, i, n, o, a) {
                    void 0 === i && (i = 256),
                    void 0 === n && (n = e.Engine.LastCreatedScene);
                    var s = t.call(this, r, i, "noise", n, o, a) || this;
                    return s._time = 0,
                    s.brightness = .2,
                    s.octaves = 3,
                    s.persistence = .8,
                    s.animationSpeedFactor = 1,
                    s.autoClear = !1,
                    s._updateShaderUniforms(),
                    s
                }
                return o(r, t),
                r.prototype._updateShaderUniforms = function() {
                    var e = this.getScene();
                    e && (this._time += e.getAnimationRatio() * this.animationSpeedFactor * .01,
                    this.setFloat("brightness", this.brightness),
                    this.setFloat("persistence", this.persistence),
                    this.setFloat("timeScale", this._time))
                }
                ,
                r.prototype._getDefines = function() {
                    return "#define OCTAVES " + (0 | this.octaves)
                }
                ,
                r.prototype.render = function(e) {
                    this._updateShaderUniforms(),
                    t.prototype.render.call(this, e)
                }
                ,
                r.prototype.serialize = function() {
                    var e = {
                        customType: "BABYLON.NoiseProceduralTexture"
                    };
                    return e.brightness = this.brightness,
                    e.octaves = this.octaves,
                    e.persistence = this.persistence,
                    e.animationSpeedFactor = this.animationSpeedFactor,
                    e.size = this.getSize().width,
                    e.generateMipMaps = this._generateMipMaps,
                    e
                }
                ,
                r.Parse = function(e, t, i) {
                    var n = new r(e.name,e.size,t,void 0,e.generateMipMaps);
                    return n.brightness = e.brightness,
                    n.octaves = e.octaves,
                    n.persistence = e.persistence,
                    n.animationSpeedFactor = e.animationSpeedFactor,
                    n
                }
                ,
                r
            }(e.ProceduralTexture);
            e.NoiseProceduralTexture = t
        }(s || (s = {}));
        var s;
        a = this && this.__assign || function() {
            return (a = Object.assign || function(e) {
                for (var t, r = 1, i = arguments.length; r < i; r++)
                    for (var n in t = arguments[r])
                        Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]);
                return e
            }
            ).apply(this, arguments)
        }
        ;
        !function(e) {
            var t = function() {
                function t(e, r) {
                    if (void 0 === r && (r = null),
                    !t.IsSupported(e))
                        throw "Your browser does not support recording so far.";
                    var i = e.getRenderingCanvas();
                    if (!i)
                        throw "The babylon engine must have a canvas to be recorded";
                    this._canvas = i,
                    this._canvas.isRecording = !1,
                    this._options = a({}, t._defaultOptions, r);
                    var n = this._canvas.captureStream(this._options.fps);
                    this._mediaRecorder = new MediaRecorder(n,{
                        mimeType: this._options.mimeType
                    }),
                    this._mediaRecorder.ondataavailable = this._handleDataAvailable.bind(this),
                    this._mediaRecorder.onerror = this._handleError.bind(this),
                    this._mediaRecorder.onstop = this._handleStop.bind(this)
                }
                return t.IsSupported = function(e) {
                    var t = e.getRenderingCanvas();
                    return !!t && "function" == typeof t.captureStream
                }
                ,
                Object.defineProperty(t.prototype, "isRecording", {
                    get: function() {
                        return !!this._canvas && this._canvas.isRecording
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                t.prototype.stopRecording = function() {
                    this._canvas && this._mediaRecorder && this.isRecording && (this._canvas.isRecording = !1,
                    this._mediaRecorder.stop())
                }
                ,
                t.prototype.startRecording = function(e, t) {
                    var r = this;
                    if (void 0 === e && (e = "babylonjs.webm"),
                    void 0 === t && (t = 7),
                    !this._canvas || !this._mediaRecorder)
                        throw "Recorder has already been disposed";
                    if (this.isRecording)
                        throw "Recording already in progress";
                    return t > 0 && setTimeout((function() {
                        r.stopRecording()
                    }
                    ), 1e3 * t),
                    this._fileName = e,
                    this._recordedChunks = [],
                    this._resolve = null,
                    this._reject = null,
                    this._canvas.isRecording = !0,
                    this._mediaRecorder.start(this._options.recordChunckSize),
                    new Promise((function(e, t) {
                        r._resolve = e,
                        r._reject = t
                    }
                    ))
                }
                ,
                t.prototype.dispose = function() {
                    this._canvas = null,
                    this._mediaRecorder = null,
                    this._recordedChunks = [],
                    this._fileName = null,
                    this._resolve = null,
                    this._reject = null
                }
                ,
                t.prototype._handleDataAvailable = function(e) {
                    e.data.size > 0 && this._recordedChunks.push(e.data)
                }
                ,
                t.prototype._handleError = function(e) {
                    if (this.stopRecording(),
                    !this._reject)
                        throw new e.error;
                    this._reject(e.error)
                }
                ,
                t.prototype._handleStop = function() {
                    this.stopRecording();
                    var t = new Blob(this._recordedChunks);
                    this._resolve && this._resolve(t),
                    window.URL.createObjectURL(t),
                    this._fileName && e.Tools.Download(t, this._fileName)
                }
                ,
                t._defaultOptions = {
                    mimeType: "video/webm",
                    fps: 25,
                    recordChunckSize: 3e3
                },
                t
            }();
            e.VideoRecorder = t
        }(s || (s = {})),
        function(e) {
            e.Scene.prototype.createDefaultLight = function(t) {
                if (void 0 === t && (t = !1),
                t && this.lights)
                    for (var r = 0; r < this.lights.length; r++)
                        this.lights[r].dispose();
                0 === this.lights.length && new e.HemisphericLight("default light",e.Vector3.Up(),this)
            }
            ,
            e.Scene.prototype.createDefaultCamera = function(t, r, i) {
                if (void 0 === t && (t = !1),
                void 0 === r && (r = !1),
                void 0 === i && (i = !1),
                r && this.activeCamera && (this.activeCamera.dispose(),
                this.activeCamera = null),
                !this.activeCamera) {
                    var n, o = this.getWorldExtends(), a = o.max.subtract(o.min), s = o.min.add(a.scale(.5)), y = 1.5 * a.length();
                    if (isFinite(y) || (y = 1,
                    s.copyFromFloats(0, 0, 0)),
                    t) {
                        var l = new e.ArcRotateCamera("default camera",-Math.PI / 2,Math.PI / 2,y,s,this);
                        l.lowerRadiusLimit = .01 * y,
                        l.wheelPrecision = 100 / y,
                        n = l
                    } else {
                        var c = new e.FreeCamera("default camera",new e.Vector3(s.x,s.y,-y),this);
                        c.setTarget(s),
                        n = c
                    }
                    n.minZ = .01 * y,
                    n.maxZ = 1e3 * y,
                    n.speed = .2 * y,
                    this.activeCamera = n;
                    var h = this.getEngine().getRenderingCanvas();
                    i && h && n.attachControl(h)
                }
            }
            ,
            e.Scene.prototype.createDefaultCameraOrLight = function(e, t, r) {
                void 0 === e && (e = !1),
                void 0 === t && (t = !1),
                void 0 === r && (r = !1),
                this.createDefaultLight(t),
                this.createDefaultCamera(e, t, r)
            }
            ,
            e.Scene.prototype.createDefaultSkybox = function(t, r, i, n, o) {
                if (void 0 === r && (r = !1),
                void 0 === i && (i = 1e3),
                void 0 === n && (n = 0),
                void 0 === o && (o = !0),
                !t)
                    return e.Tools.Warn("Can not create default skybox without environment texture."),
                    null;
                o && t && (this.environmentTexture = t);
                var a = e.Mesh.CreateBox("hdrSkyBox", i, this);
                if (r) {
                    var s = new e.PBRMaterial("skyBox",this);
                    s.backFaceCulling = !1,
                    s.reflectionTexture = t.clone(),
                    s.reflectionTexture && (s.reflectionTexture.coordinatesMode = e.Texture.SKYBOX_MODE),
                    s.microSurface = 1 - n,
                    s.disableLighting = !0,
                    s.twoSidedLighting = !0,
                    a.infiniteDistance = !0,
                    a.material = s
                } else {
                    var y = new e.StandardMaterial("skyBox",this);
                    y.backFaceCulling = !1,
                    y.reflectionTexture = t.clone(),
                    y.reflectionTexture && (y.reflectionTexture.coordinatesMode = e.Texture.SKYBOX_MODE),
                    y.disableLighting = !0,
                    a.infiniteDistance = !0,
                    a.material = y
                }
                return a
            }
            ,
            e.Scene.prototype.createDefaultEnvironment = function(t) {
                return e.EnvironmentHelper ? new e.EnvironmentHelper(t,this) : null
            }
            ,
            e.Scene.prototype.createDefaultVRExperience = function(t) {
                return void 0 === t && (t = {}),
                new e.VRExperienceHelper(this,t)
            }
        }(s || (s = {})),
        s.Effect.ShadersStore = {
            defaultVertexShader: "#include<__decl__defaultVertex>\n\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL \nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;\n#else\nvPositionUVW=position;\n#endif\n#endif \n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n",
            defaultPixelShader: "#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY \n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=toGammaSpace(refractionColor);\n#endif\nrefractionColor*=vRefractionInfos.x;\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb;\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=toGammaSpace(reflectionColor);\n#endif\nreflectionColor*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=color;\n}\n",
            pbrVertexShader: "precision highp float;\n#include<__decl__pbrVertex>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2; \n#endif \n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nvarying vec2 vAlbedoUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nvarying vec2 vReflectivityUV;\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(positionUpdated,1.0)).xyz;\n#else\nvPositionUVW=positionUpdated;\n#endif\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=environmentIrradianceJones(reflectionVector);\n#endif\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif \n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif \n#if defined(ALBEDO) && ALBEDODIRECTUV == 0 \nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0 \nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0 \nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0 \nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0 \nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0 \nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0 \nif (vMicroSurfaceSamplerInfos.x == 0.)\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0 \nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<bumpVertex>\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}",
            pbrPixelShader: "#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n#include<__decl__pbrFragment>\nuniform vec4 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vCameraInfos;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif \n#ifdef MAINUV2 \nvarying vec2 vMainUV2;\n#endif \n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\n#if ALBEDODIRECTUV == 1\n#define vAlbedoUV vMainUV1\n#elif ALBEDODIRECTUV == 2\n#define vAlbedoUV vMainUV2\n#else\nvarying vec2 vAlbedoUV;\n#endif\nuniform sampler2D albedoSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFLECTIVITY\n#if REFLECTIVITYDIRECTUV == 1\n#define vReflectivityUV vMainUV1\n#elif REFLECTIVITYDIRECTUV == 2\n#define vReflectivityUV vMainUV2\n#else\nvarying vec2 vReflectivityUV;\n#endif\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef MICROSURFACEMAP\n#if MICROSURFACEMAPDIRECTUV == 1\n#define vMicroSurfaceSamplerUV vMainUV1\n#elif MICROSURFACEMAPDIRECTUV == 2\n#define vMicroSurfaceSamplerUV vMainUV2\n#else\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\nuniform sampler2D microSurfaceSampler;\n#endif\n\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#endif\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n\n#include<shadowsFragmentFunctions>\n#include<pbrFunctions>\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n\n\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\n#include<bumpFragment>\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalW.xyz);\nvec3 nDfdy=dFdy(normalW.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\n\nfloat geometricRoughnessFactor=pow(clamp(slopeSquare ,0.,1.),0.333);\n\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\n#else\nfloat geometricRoughnessFactor=0.;\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n\n\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\nsurfaceAlbedo*=vAlbedoInfos.y;\n#endif\n\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#if !defined(LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nsurfaceAlbedo*=vColor.rgb;\n#endif\n\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#endif\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);\nambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicColorMap.g;\n#endif\n#endif\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n\nmicroSurface=1.0-metallicRoughness.g;\n\nvec3 baseColor=surfaceAlbedo;\n\n\nconst vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);\n\nsurfaceAlbedo=mix(baseColor.rgb*(1.0-DefaultSpecularReflectanceDielectric.r),vec3(0.,0.,0.),metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallicRoughness.r);\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nsurfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);\nsurfaceReflectivityColor*=vReflectivityInfos.y;\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceReflectivityColorMap.a;\nmicroSurface*=vReflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#endif\n#endif\n#endif\n\nmicroSurface=clamp(microSurface,0.,1.);\n\nfloat roughness=1.-microSurface;\n\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\n\n\n\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\n\nalpha=fresnelSchlickEnvironmentGGX(clamp(dot(viewDirectionW,normalForward),0.0,1.0),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#endif\n\n\nfloat NdotVUnclamped=dot(normalW,viewDirectionW);\nfloat NdotV=clamp(NdotVUnclamped,0.,1.)+0.00001;\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n#ifdef SPECULARAA\n\n\nalphaG+=(0.75*geometricAlphaGFactor);\n#endif\n\n#ifdef REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODINREFRACTIONALPHA\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,1.0);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef LODINREFRACTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#else\nfloat lodRefractionNormalized=clamp(refractionLOD/log2(vRefractionMicrosurfaceInfos.x),0.,1.);\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif(lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n}else{\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef GAMMAREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef RGBDREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\n\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n\n#ifdef REFLECTION\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,1.);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD);\n#else\nfloat lodReflectionNormalized=clamp(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x),0.,1.);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentSpecularMid,\nlodReflectionNormalizedDoubled\n);\n}else{\nenvironmentRadiance=mix(\nenvironmentSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\n\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\nenvironmentIrradiance=environmentIrradianceJones(irradianceVector);\n#endif\n#endif\n\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\nenvironmentIrradiance*=vReflectionColor.rgb;\n#endif\n\n\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n\nvec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb;\n#ifdef GAMMALIGHTMAP\nlightmapColor=toLinearSpace(lightmapColor);\n#endif\nlightmapColor*=vLightmapInfos.y;\n#endif\nlightingInfo info;\npointLightingInfo pointInfo;\nspotLightingInfo spotInfo;\nfloat shadow=1.; \nfloat NdotL=-1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n\nvec2 brdfSamplerUV=vec2(NdotV,roughness);\n\nvec4 environmentBrdf=texture2D(environmentBrdfSampler,brdfSamplerUV);\nvec3 specularEnvironmentReflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW);\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\n\nvec3 specularEnvironmentReflectance=fresnelSchlickEnvironmentGGX(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n\n#ifdef REFRACTION\nvec3 refractance=vec3(0.0,0.0,0.0);\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedo;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedo*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nenvironmentRefraction.rgb*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=transmission;\n#endif\n\n\n\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n\n#ifdef REFLECTION\nvec3 finalIrradiance=environmentIrradiance;\nfinalIrradiance*=surfaceAlbedo.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\n\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#endif\n\n#ifdef REFLECTION\nvec3 finalRadiance=environmentRadiance.rgb;\nfinalRadiance*=specularEnvironmentReflectance;\n\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#endif\n\n#ifdef REFRACTION\nvec3 finalRefraction=environmentRefraction.rgb;\nfinalRefraction*=refractance;\n#endif\n\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)\nalpha=clamp(alpha+luminanceOverAlpha*luminanceOverAlpha,0.,1.);\n#endif\n#endif\n#endif\n\nvec3 finalDiffuse=diffuseBase;\nfinalDiffuse.rgb+=vAmbientColor;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\n\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\nfinalEmissive*=vEmissiveInfos.y;\n#endif\n\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=ambientOcclusionColor;\n#endif\n\n\n\nvec4 finalColor=vec4(\nfinalDiffuse*ambientOcclusionForDirectDiffuse*vLightingIntensity.x +\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance*ambientOcclusionColor*vLightingIntensity.z +\n#endif\n#ifdef SPECULARTERM\n\n\nfinalSpecularScaled +\n#endif\n#ifdef REFLECTION\n\n\nfinalRadianceScaled +\n#endif\n#ifdef REFRACTION\nfinalRefraction*vLightingIntensity.z +\n#endif\n#endif\nfinalEmissive*vLightingIntensity.y,\nalpha);\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n\nfinalColor=max(finalColor,0.0);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#else\n\nfinalColor=applyImageProcessing(finalColor);\n#endif\n#ifdef PREMULTIPLYALPHA\n\nfinalColor.rgb*=finalColor.a;\n#endif\ngl_FragColor=finalColor;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n}",
            rgbdEncodePixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void) \n{\ngl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);\n}",
            rgbdDecodePixelShader: "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void) \n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}",
            spritesVertexShader: "\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nvFogDistance=viewPos;\n#endif\n}",
            spritesPixelShader: "uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",
            particlesVertexShader: "\nattribute vec3 position;\nattribute vec4 color;\nattribute float angle;\nattribute vec2 size;\n#ifdef ANIMATESHEET \nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD \nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction; \n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n#ifdef ANIMATESHEET \nuniform vec3 particlesInfos; \n#endif\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition; \n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner; \n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner; \n}\n#endif\nvoid main(void) { \nvec2 cornerPos;\ncornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;\n#ifdef BILLBOARD \n\nvec3 rotatedCorner;\n#ifdef BILLBOARDY \nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz; \n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition; \nvec3 worldPos=rotateAlign(toCamera,rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz; \n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner; \n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\n\ngl_Position=projection*vec4(viewPos,1.0); \n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=normalize(direction);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\ngl_Position=projection*view*vec4(worldPos,1.0); \n#endif \nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/particlesInfos.z);\nfloat columnOffset=cell</script>
  </head>
  <body>
    <iframe src="https://mathactivity.club/" height="750" width="100%"></iframe>
  </body>
</html>
